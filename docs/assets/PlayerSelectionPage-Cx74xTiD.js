import{a as me,r as M,g as te,f as $e,u as ne,j as e,d as ye,e as Le,q as Ie}from"./index-BqmqAPep.js";import{u as ue}from"./useJoueursData-CIWACoZQ.js";import{u as ve}from"./baseStatsHook-Ck0-2a9c.js";import{g as We}from"./gameUtils-DYpUb-C5.js";import{a as Ne,g as ce,c as Ae,b as qe}from"./datasyncExport-CjB7UYqV.js";import{u as he,g as Ee,b as oe,l as Ge,C as ie,f as Ce}from"./api-Cj37jc88.js";import{f as se,d as Ve}from"./durationFormatters-C9UyWcKX.js";import{F as U,C as J,X as Q,Y as X,a as Y}from"./FullscreenChart-VtMsAfYH.js";import{R as O,T as K}from"./CategoricalChart-Cai51s21.js";import{L as Be,a as Oe}from"./LineChart-BR7qESyA.js";import{B as ee,a as Z}from"./BarChart-DAdWxtnH.js";import{P as je,a as be}from"./PieChart-DQjJctSs.js";import{g as de}from"./deathTypes-gHH1w6_X.js";import{i as we,g as Se,V as Ke,a as He}from"./roleUtils-CLjkiQQc.js";import{S as _e,R as ae,e as Ue,f as Ye,h as pe,a as Je,b as Qe,d as Xe}from"./deathLocationUtils-C-hwwwSt.js";import{L as Ze}from"./Legend-CKTplvnQ.js";import{a as et,u as tt}from"./useClips-CaMk29QM.js";import{C as rt,f as Re,a as st}from"./ClipViewer-BXcRG4Wi.js";import"./ActivePoints-Chz5f39W.js";import"./PolarChart-v6wBQ4Rz.js";function at(r){const{settings:o}=me(),{joueursData:y}=ue(),[d,v]=M.useState(null),[a,x]=M.useState(!1),[l,s]=M.useState(null);M.useEffect(()=>{let c=!0;return(async()=>{try{x(!0),s(null);const p=o.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",i=await fetch(p);if(!i.ok)throw new Error(`Failed to load achievements: ${i.status} ${i.statusText}`);const m=await i.json();c&&v(m)}catch(p){c&&s(p instanceof Error?p.message:"Failed to load achievements")}finally{c&&x(!1)}})(),()=>{c=!1}},[o.dataSource]);const u=(()=>{if(!r||!d)return null;const n=y?.Players?.find(p=>p.Joueur===r)?.SteamID;return n&&d.achievements[n]||null})();return M.useEffect(()=>{r&&d&&y&&y.Players?.find(p=>p.Joueur===r)?.SteamID},[r,d,y,o.dataSource]),{data:u,isLoading:a,error:l,metadata:{generatedAt:d?.generatedAt||null,totalPlayers:d?.totalPlayers||0,totalGames:d?.totalGames||0,totalModdedGames:d?.totalModdedGames||0}}}function it(r,o,y){if(!r||r.trim()===""||o.length===0)return null;const d=[];let v=r;o.forEach(n=>{const p=n.PlayerStats.find(i=>te(i)===r||i.Username.toLowerCase()===r.toLowerCase());if(p){v=p.Username;const i=p.MainRoleInitial==="Louveteau"?p.MainRoleInitial:Ne(p.MainRoleInitial,p.MainRoleChanges||[]),m=ce(i);if(y&&y!=="Tous les camps"&&m!==y)return;const R=We(n),h=p.Victorious,j=$e(new Date(n.StartDate)),D=Ae(n.StartDate,n.EndDate)||0;d.push({gameId:n.Id,date:j,camp:m,won:h,winnerCamp:R,playersInGame:n.PlayerStats.length,mapName:n.MapName,duration:D})}}),d.sort((n,p)=>{const i=m=>{const R=m.split("/");return R.length===3?new Date(parseInt(R[2]),parseInt(R[1])-1,parseInt(R[0])):new Date(m)};return i(p.date).getTime()-i(n.date).getTime()});const a=d.length,x=d.filter(n=>n.won).length,l=a>0?(x/a*100).toFixed(2):"0.00",s={};d.forEach(n=>{s[n.camp]||(s[n.camp]={appearances:0,wins:0,winRate:"0.00"}),s[n.camp].appearances++,n.won&&s[n.camp].wins++}),Object.keys(s).forEach(n=>{const p=s[n];p.winRate=p.appearances>0?(p.wins/p.appearances*100).toFixed(2):"0.00"});const u={};d.forEach(n=>{u[n.mapName]||(u[n.mapName]={appearances:0,wins:0,winRate:"0.00"}),u[n.mapName].appearances++,n.won&&u[n.mapName].wins++}),Object.keys(u).forEach(n=>{const p=u[n];p.winRate=p.appearances>0?(p.wins/p.appearances*100).toFixed(2):"0.00"});const c=d.reduce((n,p)=>n+p.duration,0);return{playerName:v,totalGames:a,totalWins:x,winRate:l,totalPlayTime:c,games:d,campStats:s,mapStats:u}}function ge(r,o){const{data:y,isLoading:d,error:v}=ve(a=>r?it(r,a,o):null);return{data:y,isLoading:d,error:v}}function nt(r){const{settings:o}=me(),[y,d]=M.useState(null),[v,a]=M.useState(null),[x,l]=M.useState(!0),[s,u]=M.useState(null);return M.useEffect(()=>{(async()=>{l(!0),u(null);try{const n=o.dataSource==="discord"?"/data/discord/playerTitles.json":"/data/playerTitles.json",p=await fetch(n);if(!p.ok){if(p.status===404)d(null),a(null),u("Les titres n'ont pas encore Ã©tÃ© gÃ©nÃ©rÃ©s. Ils seront disponibles aprÃ¨s la prochaine synchronisation hebdomadaire.");else throw new Error(`HTTP error! status: ${p.status}`);return}const i=await p.json();if(d(i),r&&i.players){const m=Object.entries(i.players).find(([R,h])=>h.playerName===r);a(m?m[1]:null)}else a(null)}catch(n){console.error("Error loading player titles:",n),u(n instanceof Error?n.message:"Erreur inconnue"),d(null),a(null)}finally{l(!1)}})()},[o.dataSource,r]),{data:y,playerData:v,isLoading:x,error:s}}function ot({achievements:r,title:o,emptyMessage:y,achievementType:d="all"}){const{navigateToTab:v,updateNavigationState:a,clearNavigation:x}=ne(),{settings:l,updateSettings:s}=me(),{joueursData:u}=ue(),c=he(u),n=(t,P)=>{if(P.stopPropagation(),!t.redirectTo)return;x();const W=l.highlightedPlayer;if(s(d==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:W,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:W,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const w=l.highlightedPlayer||"",f=p(t.description,w);f&&a({playerComparisonState:{selectedPlayer1:w,selectedPlayer2:f,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const w=t.description.toLowerCase().includes("loup");a({selectedPairingTab:w?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const w=t.description.match(/(Villageois|Loups|Autres)/i);w&&a({deathStatsSelectedCamp:w[1]});let f=10;const g=t.description.match(/min\.\s*(\d+)/);g&&(f=parseInt(g[1],10));let S="totalKills",b="killers";const k=t.redirectTo.chartSection;k&&(k==="killers-total"?(S="totalKills",b="killers"):k==="killers-average"?(S="averageKills",b="killers"):k==="deaths-total"?(S="totalDeaths",b="deaths"):k==="survivors-average"?(S="survivalRate",b="deaths"):(k==="hunters-good"||k==="hunters-bad")&&(b="hunter",S="averageKills")),a({deathStatisticsState:{selectedCamp:w?.[1]||"Tous les camps",minGamesForAverage:f,selectedView:b,focusChart:S}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const w=t.redirectTo.mapFilter||"all";let f=10;const g=t.description.match(/min\.\s*(\d+)/);g&&(f=parseInt(g[1])),s(d==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:w,playerFilter:{mode:"none",players:[]},highlightedPlayer:W,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:w,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:w,playerFilter:{mode:"none",players:[]},highlightedPlayer:W,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:w,playerFilter:{mode:"none",players:[]}}}),a({playersGeneralState:{minGamesForWinRate:f,winRateOrder:"best",focusChart:"winRate"}}),v("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&a({selectedPlayerName:l.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let w="wins";const f=t.title.toLowerCase(),g=t.description.toLowerCase();f.includes("dÃ©faite")||g.includes("dÃ©faite")?w="losses":f.includes("loup")||g.includes("loup")?w="loup":f.includes("villageois")||g.includes("villageois")?w="villageois":(f.includes("victoire")||g.includes("victoire"))&&(w="wins"),a({selectedSeriesType:w})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let w=10;const f=t.description.match(/min\.\s*(\d+)/);f&&(w=parseInt(f[1],10));let g="winRate",S="best";const b=t.title.toLowerCase(),k=t.description.toLowerCase();b.includes("participation")||k.includes("participation")?g="participation":(b.includes("taux de victoire")||k.includes("taux de victoire"))&&(g="winRate",(b.includes("moins bon")||b.includes("mauvais")||k.includes("moins bon")||k.includes("mauvais"))&&(S="worst")),a({playersGeneralState:{minGamesForWinRate:w,winRateOrder:S,focusChart:g}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const w=t.redirectTo.chartSection;let f="Villageois",g=1;w&&(w==="camp-loup"?f="Loup":w==="camp-villageois"?f="Villageois":w==="camp-idiot"?f="Idiot du Village":w==="camp-amoureux"?f="Amoureux":(w==="solo-roles"||w==="hall-of-fame")&&(f="Villageois"));const S=t.description.match(/min\.\s*(\d+)/);S&&(g=parseInt(S[1],10)),w==="solo-roles"?f="RÃ´les spÃ©ciaux":w==="hall-of-fame"&&(f="Tous les camps"),a({campPerformanceState:{selectedCampPerformanceCamp:f,selectedCampPerformanceMinGames:g,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const w=t.title.toLowerCase();let f="overview",g="behavior";w.includes("agressivitÃ©")?(f="overview",g="behavior"):w.includes("taux de vote")?(f="behavior",g="voteRate"):w.includes("prÃ©cision")&&(f="overview",g="accuracy"),a({votingStatsState:{selectedCategory:f,selectedView:g}})}if(t.category==="loot"&&t.redirectTo.subTab==="lootStats"){const w=t.redirectTo,f=w.minGames||5,g=w.view||"normalized";a({lootStatsState:{minGames:f,campFilter:"all",view:g}})}v(t.redirectTo.tab,t.redirectTo.subTab)},p=(t,P)=>{const W=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const w of W){const f=t.match(w);if(f&&f[1]){const g=f[1].trim();if(g!==P)return g}}return null},i=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const w=t.description.match(/min\.\s*(\d+)/),f=w?parseInt(w[1],10):10,g=t.title.toLowerCase(),S=d==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return g.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${f} parties)${S}`:g.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${S}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${S}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const w=t.redirectTo.mapFilter,f=w==="village"?"Village":w==="chateau"?"ChÃ¢teau":"map",g=d==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${f}${g}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${p(t.description,l.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const w=t.description.match(/(Villageois|Loups|Autres)/i),f=t.description.match(/min\.\s*(\d+)/),g=f?parseInt(f[1],10):10,S=w?.[1]||"Tous les camps",b=t.redirectTo.chartSection;let k="kills et morts";return b==="killers-total"?k="total des kills":b==="killers-average"?k=`moyenne des kills (min. ${g} parties)`:b==="deaths-total"?k="total des morts":b==="survivors-average"&&(k=`taux de survie (min. ${g} parties)`),`Cliquez pour voir les statistiques de ${k} ${S!=="Tous les camps"?`en ${S}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const w=t.title.toLowerCase(),f=t.description.toLowerCase();return w.includes("dÃ©faite")||f.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":w.includes("loup")||f.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":w.includes("villageois")||f.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":w.includes("victoire")||f.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const w=t.redirectTo.chartSection,f=d==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return w==="camp-loup"?`Cliquez pour voir les performances camp Loup${f}`:w==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${f}`:w==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${f}`:w==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${f}`:w==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${f}`:w==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${f}`:`Cliquez pour voir les performances par camp${f}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const w=t.description.match(/min\.\s*(\d+)/),f=w?parseInt(w[1],10):25,g=d==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",S=t.title.toLowerCase();return S.includes("agressivitÃ©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${f} meetings)${g}`:S.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${f} meetings)${g}`:S.includes("prÃ©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${g}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${g}`}break;case"loot":if(t.redirectTo.subTab==="lootStats"){const w=t.description.match(/min\.\s*(\d+)/),f=w?parseInt(w[1],10):25,g=d==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de rÃ©colte (min. ${f} parties)${g}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(d==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},m=t=>c[t]||Ee(t),R=t=>{const P=[/avec ([^:]+?):/,/contre ([^:]+?):/];let W=t;return P.forEach(w=>{const f=t.match(w);if(f&&f[1]){const g=f[1].trim(),b=`<span class="player-name-highlight" style="color: ${m(g)};">${g}</span>`;W=W.replace(g,b)}}),W};if(r.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:o}),e.jsx("p",{children:y||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const h=t=>t===1?"ðŸ¥‡":t===2?"ðŸ¥ˆ":t===3?"ðŸ¥‰":"",j=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",D=(t,P)=>{if(!t||t<=3||!P)return;const W=t-3,w=P-3;return w<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(W-1)/(w-1))}, 70%, 50%)`},z=(t,P)=>{if(!t||!P)return;if(P<=1)return"hsl(0, 70%, 50%)";const W=(t-1)/(P-1),w=W*15,f=50-W*15;return`hsl(${w}, 70%, ${f}%)`},T=t=>{if(!t)return;const P=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(P){const[,W,w]=P;return`hsl(${W}, ${w}%, 40%)`}return t},N=r.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,P)=>(t.rank??999)-(P.rank??999)),F=r.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,P)=>(t.rank??999)-(P.rank??999)),V=r.filter(t=>t.category==="comparison"),I=[...N,...F].sort((t,P)=>(t.rank??999)-(P.rank??999)),$=N.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:o}),$>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:N.filter(t=>t.rank&&t.rank<=3).map((t,P)=>e.jsxs("div",{className:`top3-card ${j(t.rank)} animate-slide-in`,style:{animationDelay:`${P*.15}s`},onClick:W=>n(t,W),title:i(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:h(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:t.title}),e.jsx("p",{className:"top3-achievement-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},t.id))})]}),I.length>0&&e.jsxs("div",{className:"achievements-section unified-rankings",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:I.filter(t=>t.type==="bad"?!0:!t.rank||t.rank>3).map((t,P)=>{const W=t.type==="bad",w=W?z(t.rank,t.totalRanked):D(t.rank,t.totalRanked),f=T(w),g=W?"":j(t.rank);return e.jsxs("div",{className:`achievement-card ${W?"bad":"good"} ${g}`,onClick:S=>n(t,S),title:i(t),style:{animationDelay:`${P*.05}s`,borderLeftColor:f,borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsxs("span",{className:"achievement-title",children:[W&&"ðŸ’€ ",t.title]}),e.jsxs("span",{className:"achievement-rank",style:w?{backgroundColor:w}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:t.description})]},t.id)})})]}),V.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques CoÃ©quipiers et Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:V.map(t=>e.jsxs("div",{className:"achievement-card comparison",onClick:P=>n(t,P),title:i(t),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:t.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:R(t.description)}})]},t.id))})]})]})}function lt({selectedPlayerName:r,groupingMethod:o,campFilter:y="all"}){const{navigateToGameDetails:d}=ne(),{data:v,isLoading:a,error:x}=ge(r),l=M.useMemo(()=>{switch(o){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[o]),s=M.useMemo(()=>{if(!v?.games)return new Map;const p=new Map;return v.games.forEach(i=>{if(!p.has(i.date)){const m=i.date.split("/");m.length===3?p.set(i.date,new Date(parseInt(m[2]),parseInt(m[1])-1,parseInt(m[0])).getTime()):p.set(i.date,new Date(i.date).getTime())}}),p},[v?.games]),u=M.useMemo(()=>{if(!v?.games)return[];const p={};return v.games.forEach(i=>{if(y!=="all"){if(y==="solo"){if(i.camp==="Villageois"||i.camp==="Loup")return}else if(i.camp!==y)return}let m;const R=i.date.split("/");if(o==="month")if(R.length===3)m=`${R[1].padStart(2,"0")}/${R[2]}`;else{const h=new Date(i.date);m=`${String(h.getMonth()+1).padStart(2,"0")}/${h.getFullYear()}`}else if(o==="quarter")if(R.length===3){const h=parseInt(R[1],10);m=`T${Math.floor((h-1)/3)+1}/${R[2]}`}else{const h=new Date(i.date);m=`T${Math.floor(h.getMonth()/3)+1}/${h.getFullYear()}`}else o==="year"?R.length===3?m=`${R[2]}`:m=`${new Date(i.date).getFullYear()}`:m=i.date;p[m]||(p[m]={games:[],wins:0,total:0}),p[m].games.push(i),p[m].total++,i.won&&p[m].wins++}),Object.entries(p).map(([i,m])=>({period:i,totalGames:m.total,victories:m.wins,defeats:m.total-m.wins,winRate:m.total>0?(m.wins/m.total*100).toFixed(1):"0.0",winRateNum:m.total>0?m.wins/m.total*100:0})).sort((i,m)=>{if(o==="month"){const[R,h]=i.period.split("/"),[j,D]=m.period.split("/"),z=new Date(parseInt(h),parseInt(R)-1,1),T=new Date(parseInt(D),parseInt(j)-1,1);return z.getTime()-T.getTime()}else if(o==="quarter"){const[R,h]=i.period.split("/"),[j,D]=m.period.split("/"),z=parseInt(R.replace(/\D/g,""),10)||1,T=parseInt(j.replace(/\D/g,""),10)||1,N=new Date(parseInt(h,10),(z-1)*3,1),F=new Date(parseInt(D,10),(T-1)*3,1);return N.getTime()-F.getTime()}else if(o==="year"){const R=parseInt(i.period,10),h=parseInt(m.period,10);return R-h}else{const R=s.get(i.period)||0,h=s.get(m.period)||0;return R-h}})},[v,o,s,y]),n=(p=>p<=15?{fontSize:12,angle:-45,height:80,interval:0}:p<=30?{fontSize:12,angle:-45,height:85,interval:1}:p<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(p/12)})(u.length);return a?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):x?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",x]}):v?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",l]}),e.jsx(U,{title:`Ã‰volution des Performances ${l}`,children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(Be,{data:u,margin:{top:20,right:30,left:20,bottom:20},onClick:p=>{if(p&&p.activeLabel){const i=u.find(m=>m.period===p.activeLabel);i&&d({selectedPlayer:r,selectedDate:i.period,fromComponent:`Ã‰volution des Performances ${l}`})}},style:{cursor:"pointer"},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"period",angle:n.angle,textAnchor:"end",height:n.height,interval:n.interval,fontSize:n.fontSize}),e.jsx(X,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(K,{content:({active:p,payload:i})=>{if(p&&i&&i.length>0){const m=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.period})}),e.jsxs("div",{children:["Parties: ",m.totalGames]}),e.jsxs("div",{children:["Victoires: ",m.victories]}),e.jsxs("div",{children:["Taux: ",m.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Oe,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",l]}),e.jsx(U,{title:`RÃ©partition Victoires/DÃ©faites ${l}`,children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:u,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"period",angle:n.angle,textAnchor:"end",height:n.height,interval:n.interval,fontSize:n.fontSize}),e.jsx(X,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:p,payload:i})=>{if(p&&i&&i.length>0){const m=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.period})}),e.jsxs("div",{children:["Total: ",m.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",m.victories]}),e.jsxs("div",{children:["DÃ©faites: ",m.defeats]}),e.jsxs("div",{children:["Taux: ",m.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Z,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:u.map((p,i)=>e.jsx(Y,{fill:"var(--accent-tertiary)",onClick:()=>{d({selectedPlayer:r,selectedDate:p.period,fromComponent:`Historique Joueur - Victoires ${l}`})},style:{cursor:"pointer"}},`cell-victories-${i}`))}),e.jsx(Z,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:u.map((p,i)=>e.jsx(Y,{fill:"var(--chart-color-4)",onClick:()=>{d({selectedPlayer:r,selectedDate:p.period,fromComponent:`Historique Joueur - DÃ©faites ${l}`})},style:{cursor:"pointer"}},`cell-defeats-${i}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function ct({selectedPlayerName:r}){const{navigateToGameDetails:o}=ne(),{data:y,isLoading:d,error:v}=ge(r),a=oe(),x=M.useMemo(()=>y?.campStats?Object.entries(y.campStats).map(([s,u])=>({name:s,value:u.appearances,winRate:u.winRate,winRateDisplay:Math.max(parseFloat(u.winRate),1),wins:u.wins,percentage:(u.appearances/y.totalGames*100).toFixed(1)})):[],[y]),l=M.useMemo(()=>{if(!x.length)return[];const s=5;let u=0;const c=[],n=[];if(x.forEach(p=>{parseFloat(p.percentage)<s?(u+=Number(p.value),c.push(p)):n.push(p)}),u>0){const p=x.reduce((i,m)=>i+Number(m.value),0);n.push({name:"Autres",value:u,winRate:"0.0",winRateDisplay:1,wins:c.reduce((i,m)=>i+m.wins,0),percentage:(u/p*100).toFixed(1),_details:c})}return n},[x]);return d?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):v?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",v]}):y?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(je,{children:[e.jsx(be,{data:l,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:s=>{const u=s.percent!==void 0?s.percent:0;return s.name==="Autres"?`Autres : ${s.value} (${(u*100).toFixed(1)}%)`:`${s.name}: ${s.value} (${(u*100).toFixed(1)}%)`},children:l.map((s,u)=>e.jsx(Y,{fill:s.name==="Autres"?Ge:a[s.name]||`var(--chart-color-${u%6+1})`,onClick:()=>{if(s.name==="Autres"){const c=s._details?.map(n=>n.name)||[];o({selectedPlayer:r,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:c},fromComponent:"Distribution par Camps"})}else s.name==="TraÃ®tre"||s.name==="Louveteau"?o({selectedPlayer:r,campFilter:{selectedCamp:s.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):s.name==="Loup"?o({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):o({selectedPlayer:r,campFilter:{selectedCamp:s.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${u}`))}),e.jsx(K,{content:({active:s,payload:u})=>{if(s&&u&&u.length>0){const c=u[0].payload;if(c.name==="Autres"&&c._details){const n=[...c._details].sort((p,i)=>i.value-p.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",c.value," parties (",c.percentage,"%)"]})}),e.jsx("div",{children:n.map((p,i)=>e.jsxs("div",{children:[p.name,": ",p.value," parties (",p.percentage,"%)"]},i))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[c.name," - ",c.value," parties (",c.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(U,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:x,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(K,{content:({active:s,payload:u})=>{if(s&&u&&u.length>0){const c=u[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:c.name})}),e.jsxs("div",{children:["Victoires: ",c.wins," / ",c.value]}),e.jsxs("div",{children:["Taux: ",c.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Z,{dataKey:"winRateDisplay",children:x.map((s,u)=>e.jsx(Y,{fill:parseFloat(s.winRate)===0?`${a[s.name]||`var(--chart-color-${u%6+1})`}50`:a[s.name]||`var(--chart-color-${u%6+1})`,onClick:()=>{s.name==="TraÃ®tre"||s.name==="Louveteau"?o({selectedPlayer:r,campFilter:{selectedCamp:s.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):s.name==="Loup"?o({selectedPlayer:r,campFilter:{selectedCamp:s.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):o({selectedPlayer:r,campFilter:{selectedCamp:s.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${u}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function dt({selectedPlayerName:r}){const{gameData:o}=ye(),{joueursData:y}=ue(),d=he(y),v=oe(),a=M.useMemo(()=>{if(!o||!r)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const l={},s={},u={},c=new Set;o.forEach(R=>{const h=R.PlayerStats.find(j=>j.Username.toLowerCase()===r.toLowerCase());if(h&&(R.PlayerStats.forEach(j=>{j.KillerName?.toLowerCase()===r.toLowerCase()&&(l[j.Username]=(l[j.Username]||0)+1)}),h.KillerName&&(s[h.KillerName]=(s[h.KillerName]||0)+1),h.DeathType)){const j=h.DeathType,D=de(j);u[D]||(u[D]={count:0,byDeathType:{}}),u[D].count+=1,u[D].byDeathType[j]=(u[D].byDeathType[j]||0)+1,c.add(j)}});const n=Object.entries(l).map(([R,h])=>({player:R,kills:h})).sort((R,h)=>h.kills-R.kills).slice(0,ie.TOP_10),p=Object.entries(s).map(([R,h])=>({player:R,kills:h})).sort((R,h)=>h.kills-R.kills).slice(0,ie.TOP_10),i=Object.entries(u).map(([R,h])=>{const j={deathType:R,count:h.count};return j[R]=h.count,j}).sort((R,h)=>h.count-R.count).slice(0,ie.TOP_10),m=Object.keys(u);return{playersKilled:n,killedBy:p,deathTypes:i,availableDeathTypes:m}},[o,r]),x=M.useMemo(()=>{const l={};a.availableDeathTypes.forEach(c=>{c==="TuÃ© par Loup"?l[c]=v.Loup:c==="Mort aux votes"?l[c]="var(--chart-color-1)":c.includes("Chasseur")?l[c]=v.Chasseur:c==="TuÃ© par Zombie"?l[c]=v.Vaudou:c==="TuÃ© par potion assassin"?l[c]=v.Alchimiste:c==="TuÃ© par Vengeur"?l[c]="var(--chart-color-2)":c==="Amoureux mort"?l[c]=v.Amoureux:c==="TuÃ© par La BÃªte"?l[c]="var(--chart-color-3)":c==="TuÃ© par ShÃ©rif"&&(l[c]="var(--chart-color-4)")});const s=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let u=0;return a.availableDeathTypes.forEach(c=>{l[c]||(l[c]=s[u%s.length],u++)}),l},[a.availableDeathTypes,v]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[a.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(U,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:l,payload:s})=>{if(l&&s&&s.length>0){const u=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:u.player})}),e.jsxs("div",{children:["TuÃ© ",u.kills," fois par ",r]})]})}return null}}),e.jsx(Z,{dataKey:"kills",children:a.playersKilled.map((l,s)=>e.jsx(Y,{fill:d[l.player]||"var(--chart-color-3)"},`cell-killed-${s}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[r," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),a.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(U,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:l,payload:s})=>{if(l&&s&&s.length>0){const u=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:u.player})}),e.jsxs("div",{children:["A tuÃ© ",r," ",u.kills," fois"]})]})}return null}}),e.jsx(Z,{dataKey:"kills",children:a.killedBy.map((l,s)=>e.jsx(Y,{fill:d[l.player]||"var(--chart-color-4)"},`cell-killer-${s}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[r," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),a.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(U,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:l,payload:s})=>{if(l&&s&&s.length>0){const u=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:u.deathType})}),e.jsxs("div",{children:[r," est mort ",u.count," fois ainsi"]})]})}return null}}),a.availableDeathTypes.map(l=>e.jsx(Z,{dataKey:l,name:l,stackId:"deaths",fill:x[l]||"var(--chart-color-5)"},l))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",r,"."]})]})]})}function ut(r,o){if(!r||r.trim()===""||o.length===0)return null;const y=new Map,d=new Map,v=new Map;o.forEach(u=>{if(!u.Modded)return;const c=u.PlayerStats.find(n=>te(n)===r||n.Username.toLowerCase()===r.toLowerCase());if(c){if(c.MainRoleInitial==="Inconnu")return;const n=c.Victorious,i=Ne(c.MainRoleInitial,c.MainRoleChanges||[])!==c.MainRoleInitial,m=ce(c.MainRoleInitial),R=m==="Loup"||m==="TraÃ®tre"||m==="Louveteau";if(m==="Villageois"&&we(c)){const h=Se(c);if(h&&Ke.includes(h)){const j=y.get(h)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};y.set(h,{appearances:j.appearances+1,wins:j.wins+(n?1:0),winsWithoutRoleChange:j.winsWithoutRoleChange+(!i&&n?1:0),gamesWithoutRoleChange:j.gamesWithoutRoleChange+(i?0:1)})}}else if(c.Power&&c.Power.trim()!==""&&c.Power!=="Inconnu"){if(m==="Villageois"){const h=y.get(c.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};y.set(c.Power,{appearances:h.appearances+1,wins:h.wins+(n?1:0),winsWithoutRoleChange:h.winsWithoutRoleChange+(!i&&n?1:0),gamesWithoutRoleChange:h.gamesWithoutRoleChange+(i?0:1)})}else if(R){const h=d.get(c.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},j=h.roleBreakdown;j.set(c.MainRoleInitial,(j.get(c.MainRoleInitial)||0)+1),d.set(c.Power,{appearances:h.appearances+1,wins:h.wins+(n?1:0),winsWithoutRoleChange:h.winsWithoutRoleChange+(!i&&n?1:0),gamesWithoutRoleChange:h.gamesWithoutRoleChange+(i?0:1),roleBreakdown:j})}}else if((m==="Villageois"||R)&&c.Power!=="Inconnu")if(m==="Villageois"){const h=y.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};y.set("Aucun pouvoir",{appearances:h.appearances+1,wins:h.wins+(n?1:0),winsWithoutRoleChange:h.winsWithoutRoleChange+(!i&&n?1:0),gamesWithoutRoleChange:h.gamesWithoutRoleChange+(i?0:1)})}else{const h=d.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},j=h.roleBreakdown;j.set(c.MainRoleInitial,(j.get(c.MainRoleInitial)||0)+1),d.set("Aucun pouvoir",{appearances:h.appearances+1,wins:h.wins+(n?1:0),winsWithoutRoleChange:h.winsWithoutRoleChange+(!i&&n?1:0),gamesWithoutRoleChange:h.gamesWithoutRoleChange+(i?0:1),roleBreakdown:j})}if(c.SecondaryRole&&c.SecondaryRole.trim()!==""&&c.SecondaryRole!=="Inconnu"){const h=v.get(c.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};v.set(c.SecondaryRole,{appearances:h.appearances+1,wins:h.wins+(n?1:0),winsWithoutRoleChange:h.winsWithoutRoleChange+(!i&&n?1:0),gamesWithoutRoleChange:h.gamesWithoutRoleChange+(i?0:1)})}}});const a=new Map;o.forEach(u=>{const c=u.PlayerStats.find(n=>te(n)===r||n.Username.toLowerCase()===r.toLowerCase());if(c&&we(c)){const n=Se(c);n&&a.set(n,(a.get(n)||0)+1)}});const x=u=>Array.from(u.entries()).map(([c,n])=>({name:c,appearances:n.appearances,wins:n.wins,winsWithoutRoleChange:n.winsWithoutRoleChange,gamesWithoutRoleChange:n.gamesWithoutRoleChange,winRate:n.gamesWithoutRoleChange>0?(n.winsWithoutRoleChange/n.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...a.has(c)&&{totalGamesAllModes:a.get(c)}})).sort((c,n)=>n.appearances-c.appearances),l=u=>Array.from(u.entries()).map(([c,n])=>({name:c,appearances:n.appearances,wins:n.wins,winsWithoutRoleChange:n.winsWithoutRoleChange,gamesWithoutRoleChange:n.gamesWithoutRoleChange,winRate:n.gamesWithoutRoleChange>0?(n.winsWithoutRoleChange/n.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(n.roleBreakdown.entries()).map(([p,i])=>({role:p,count:i})).sort((p,i)=>i.count-p.count)})).sort((c,n)=>n.appearances-c.appearances),s=u=>Array.from(u.entries()).map(([c,n])=>({name:c,appearances:n.appearances,wins:n.wins,winsWithoutRoleChange:n.winsWithoutRoleChange,gamesWithoutRoleChange:n.gamesWithoutRoleChange,winRate:n.gamesWithoutRoleChange>0?(n.winsWithoutRoleChange/n.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((c,n)=>n.appearances-c.appearances);return{villageoisPowers:x(y),loupPowers:l(d),secondaryRoles:s(v)}}function pt({selectedPlayerName:r}){const{navigateToGameDetails:o,navigationState:y,updateNavigationState:d}=ne(),v=oe(),[a,x]=M.useState(y.playerHistoryRolesState?.chartMode||"appearances"),{data:l,isLoading:s,error:u}=ve(j=>ut(r,j));M.useEffect(()=>{(!y.playerHistoryRolesState||y.playerHistoryRolesState.chartMode!==a)&&d({playerHistoryRolesState:{chartMode:a}})},[a,y.playerHistoryRolesState,d]);const c=j=>{x(j),d({playerHistoryRolesState:{chartMode:j}})},n=M.useMemo(()=>{if(!l)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const j=1,D=1,z=15,T=a==="winRate"?(F,V)=>parseFloat(V.winRate)-parseFloat(F.winRate):(F,V)=>V.appearances-F.appearances,N=F=>({...F,winRateDisplay:Math.max(parseFloat(F.winRate),1)});return{villageoisPowers:l.villageoisPowers.filter(F=>F.appearances>=j).map(N).sort(T).slice(0,z),loupPowers:l.loupPowers.filter(F=>F.appearances>=j).map(N).sort(T).slice(0,z),secondaryRoles:l.secondaryRoles.filter(F=>F.appearances>=D).map(N).sort(T).slice(0,z)}},[l,a]);if(s)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(u)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",u]});if(!l)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const p=n.villageoisPowers.length>0,i=n.loupPowers.length>0,m=n.secondaryRoles.length>0;if(!p&&!i&&!m)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const R=({active:j,payload:D})=>{if(j&&D&&D.length>0){const z=D[0].payload,T=z.gamesWithoutRoleChange<z.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:z.name})}),e.jsxs("div",{children:["Apparitions: ",z.appearances]}),T&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",z.appearances-z.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",z.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",z.winRate,"%"]})}),z.totalGamesAllModes&&z.totalGamesAllModes!==z.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",z.totalGamesAllModes,")"]}),z.roleBreakdown&&z.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),z.roleBreakdown.map((N,F)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",N.role,": ",N.count]},F))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},h=(j,D,z,T,N)=>{const F=a==="appearances"?"appearances":"winRateDisplay",V=a==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",I=a==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:D}),e.jsx(U,{title:D,children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:j,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:V,angle:270,position:"left",style:{textAnchor:"middle"}},domain:I}),e.jsx(K,{content:e.jsx(R,{})}),e.jsx(Z,{dataKey:F,label:a==="winRate"?$=>{const{x:t,y:P,width:W,payload:w}=$;if(t===void 0||P===void 0||W===void 0||!w)return null;const f=w.winRate||"0";return e.jsxs("text",{x:t+W/2,y:P-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[f,"%"]})}:void 0,children:j.map(($,t)=>e.jsx(Y,{fill:N?N($.name,t):z,onClick:()=>T($.name),style:{cursor:"pointer"}},`cell-${t}`))})]})})})})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:a,onChange:j=>c(j.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[p&&h(n.villageoisPowers,"Camp Villageois","var(--chart-color-1)",j=>{o({selectedPlayer:r,campFilter:{selectedCamp:"Villageois",campFilterMode:a==="winRate"?"wins-only":"all-assignments"},selectedPower:j,fromComponent:`Historique des RÃ´les - Pouvoir: ${j}`})},j=>j==="Chasseur"&&v.Chasseur?v.Chasseur:j==="Alchimiste"&&v.Alchimiste?v.Alchimiste:j==="Protecteur"&&v.Protecteur?v.Protecteur:j==="Disciple"&&v.Disciple?v.Disciple:"var(--chart-color-1)"),i&&h(n.loupPowers,"Camp Loups","var(--chart-color-2)",j=>{o({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:a==="winRate"?"wins-only":"all-assignments"},selectedPower:j,fromComponent:`Historique des RÃ´les - Pouvoir: ${j}`})},()=>v.Loup||"var(--chart-color-2)"),m&&h(n.secondaryRoles,"RÃ´les Secondaires","var(--chart-color-3)",j=>{o({selectedPlayer:r,selectedSecondaryRole:j,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${j}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}function mt(r){return r.ActionType}function ke(r){return`${mt(r)}|${r.Timing||""}|${r.ActionName||""}|${r.ActionTarget||""}`}function ht(r,o){const y=[],d=new Set;if(r&&Array.isArray(r))for(const v of r){if(v.ActionType==="UseGadget"&&v.ActionName==="Balle")continue;const a=ke(v);d.add(a),y.push({...v,hasGameLogData:!0,source:"gamelog"})}if(o&&Array.isArray(o))for(const v of o){const a=ke(v);d.has(a)||y.push({...v,Date:v.Date||null,Position:v.Position||null,hasGameLogData:!1,source:"legacy"})}return y.sort((v,a)=>gt(v.Timing,a.Timing))}function gt(r,o){if(!r&&!o)return 0;if(!r)return 1;if(!o)return-1;const y=a=>{const x=a.match(/^([JNM])(\d+)$/i);if(!x)return{phase:0,day:0,raw:a};const l=x[1].toUpperCase(),s=parseInt(x[2],10);return{phase:{J:1,M:2,N:3}[l]||0,day:s,raw:a}},d=y(r),v=y(o);return d.day!==v.day?d.day-v.day:d.phase-v.phase}function Te(r,o){const y=o.Actions;let d;if(r.LegacyData?.PlayerStats){const v=o.ID,a=o.Username.toLowerCase();let x;v&&(x=r.LegacyData.PlayerStats.find(l=>l.ID===v)),x||(x=r.LegacyData.PlayerStats.find(l=>l.Username.toLowerCase()===a)),x&&(d=x.Actions)}return ht(y,d)}function xt(r){return r.ActionType==="HunterShoot"?{isHunterShot:!0,target:r.ActionTarget}:{isHunterShot:!1,target:null}}const Pe=["Transform","Untransform","UseGadget","HunterShoot","DrinkPotion"],ft={Transform:"Transformation (Loup)",Untransform:"DÃ©transformation",UseGadget:"Utilisation Gadget",HunterShoot:"Tir du Chasseur",DrinkPotion:"Potion bue"},yt={Transform:"var(--wolf-color, #8B0000)",Untransform:"var(--wolf-color-light, #CD5C5C)",UseGadget:"var(--chart-color-1, #8884d8)",HunterShoot:"var(--chart-color-2, #82ca9d)",DrinkPotion:"var(--chart-color-3, #ffc658)"};function vt({selectedPlayerName:r}){const{gameData:o}=ye(),{joueursData:y}=ue(),d=oe(),v=he(y),a=M.useMemo(()=>{if(!o||!r)return{actionTypeCounts:[],gadgetDetails:[],potionDetails:[],hunterTargets:[],transformationsPerGame:0,totalGamesWithActions:0,totalGamesPlayed:0};const l={Transform:0,Untransform:0,UseGadget:0,HunterShoot:0,DrinkPotion:0},s={},u={},c={};let n=0,p=0;o.forEach(T=>{const N=T.PlayerStats.find(I=>I.Username.toLowerCase()===r.toLowerCase());if(!N)return;p++;let F=!1;Te(T,N).forEach(I=>{const $=xt(I);if($.isHunterShot){l.HunterShoot++,F=!0,$.target&&(c[$.target]=(c[$.target]||0)+1);return}const t=I.ActionType;Pe.includes(t)&&(l[t]++,F=!0,t==="UseGadget"&&I.ActionName&&I.ActionName!=="Balle"&&(s[I.ActionName]=(s[I.ActionName]||0)+1),t==="DrinkPotion"&&I.ActionName&&(u[I.ActionName]=(u[I.ActionName]||0)+1))}),F&&n++});const i=Pe.filter(T=>l[T]>0).map(T=>({actionType:T,label:ft[T],count:l[T],color:yt[T]})).sort((T,N)=>N.count-T.count),m=Object.entries(s).map(([T,N])=>({gadgetName:T,count:N})).sort((T,N)=>N.count-T.count).slice(0,ie.TOP_10),R=Object.entries(u).map(([T,N])=>({potionName:T,count:N})).sort((T,N)=>N.count-T.count).slice(0,ie.TOP_10),h=Object.entries(c).map(([T,N])=>({target:T,count:N})).sort((T,N)=>N.count-T.count).slice(0,ie.TOP_10),j=l.Transform,D=j>0?Math.max(1,o.filter(T=>{const N=T.PlayerStats.find(V=>V.Username.toLowerCase()===r.toLowerCase());return N?Te(T,N).some(V=>V.ActionType==="Transform"):!1}).length):0,z=D>0?j/D:0;return{actionTypeCounts:i,gadgetDetails:m,potionDetails:R,hunterTargets:h,transformationsPerGame:z,totalGamesWithActions:n,totalGamesPlayed:p}},[o,r]);return a.actionTypeCounts.length>0?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ® Parties avec actions"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:a.totalGamesWithActions}),e.jsxs("p",{children:["sur ",a.totalGamesPlayed," parties analysÃ©es"]})]}),a.actionTypeCounts.find(l=>l.actionType==="Transform")&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸº Transformations / partie loup"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:d.Loup||"var(--wolf-color)"},children:a.transformationsPerGame.toFixed(1)}),e.jsx("p",{children:"en moyenne par partie loup"})]}),a.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ”§ Gadgets utilisÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:a.gadgetDetails.reduce((l,s)=>l+s.count,0)}),e.jsxs("p",{children:[a.gadgetDetails.length," types diffÃ©rents"]})]}),a.potionDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ§ª Potions bues"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:a.potionDetails.reduce((l,s)=>l+s.count,0)}),e.jsxs("p",{children:[a.potionDetails.length," types diffÃ©rents"]})]})]}),a.actionTypeCounts.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"RÃ©partition des Types d'Actions"}),e.jsx(U,{title:"RÃ©partition des Types d'Actions",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(je,{children:[e.jsx(be,{data:a.actionTypeCounts,dataKey:"count",nameKey:"label",cx:"50%",cy:"50%",outerRadius:120,label:l=>{const s=l.percent!==void 0?l.percent:0;return`${l.label}: ${l.count} (${(s*100).toFixed(0)}%)`},labelLine:!0,children:a.actionTypeCounts.map((l,s)=>e.jsx(Y,{fill:l.color},`cell-${s}`))}),e.jsx(K,{content:({active:l,payload:s})=>{if(l&&s&&s.length>0){const u=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:u.label})}),e.jsxs("div",{children:[u.count," fois"]})]})}return null}})]})})})})]}),a.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Gadgets UtilisÃ©s"}),e.jsx(U,{title:"Gadgets UtilisÃ©s",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.gadgetDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"gadgetName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Utilisations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:l,payload:s})=>{if(l&&s&&s.length>0){const u=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:u.gadgetName})}),e.jsxs("div",{children:["UtilisÃ© ",u.count," fois"]})]})}return null}}),e.jsx(Z,{dataKey:"count",fill:"var(--chart-color-1)",children:a.gadgetDetails.map((l,s)=>e.jsx(Y,{fill:`hsl(${200+s*20}, 70%, 50%)`},`cell-gadget-${s}`))})]})})})})]}),a.potionDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Potions Bues"}),e.jsx(U,{title:"Potions Bues",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.potionDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"potionName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Consommations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:l,payload:s})=>{if(l&&s&&s.length>0){const u=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:u.potionName})}),e.jsxs("div",{children:["Bue ",u.count," fois"]})]})}return null}}),e.jsx(Z,{dataKey:"count",fill:"var(--chart-color-3)",children:a.potionDetails.map((l,s)=>e.jsx(Y,{fill:`hsl(${40+s*15}, 80%, 55%)`},`cell-potion-${s}`))})]})})})})]}),a.hunterTargets.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Cibles du Chasseur"}),e.jsx(U,{title:"Cibles du Chasseur",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.hunterTargets,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"target",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Nombre de tirs",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:l,payload:s})=>{if(l&&s&&s.length>0){const u=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:u.target})}),e.jsxs("div",{children:["TuÃ© par le chasseur ",u.count," fois"]})]})}return null}}),e.jsx(Z,{dataKey:"count",fill:d.Chasseur||"var(--chart-color-2)",children:a.hunterTargets.map((l,s)=>e.jsx(Y,{fill:v[l.target]||d.Chasseur||`hsl(${120+s*15}, 60%, 45%)`},`cell-hunter-${s}`))})]})})})})]})]}):e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune donnÃ©e d'actions disponible pour ",r,"."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es d'actions ne sont disponibles que pour les parties rÃ©centes."})]})}function jt({viewMode:r,setViewMode:o,selectedMap:y,setSelectedMap:d,availableMaps:v,clusterRadius:a,setClusterRadius:x,availableDeathTypes:l,selectedDeathTypes:s,setSelectedDeathTypes:u,deathTypeColors:c,isDeathTypesExpanded:n,setIsDeathTypesExpanded:p}){return e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>o("deaths"),style:{background:r==="deaths"?"var(--accent-primary)":"transparent",color:r==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"ðŸ’€ Morts"}),e.jsx("button",{type:"button",onClick:()=>o("kills"),style:{background:r==="kills"?"var(--accent-primary)":"transparent",color:r==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="kills"?"bold":"normal",transition:"all 0.2s"},children:"âš”ï¸ Kills"}),e.jsx("button",{type:"button",onClick:()=>o("transformations"),style:{background:r==="transformations"?"var(--accent-primary)":"transparent",color:r==="transformations"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="transformations"?"bold":"normal",transition:"all 0.2s"},children:"ðŸº Transfos"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:y,onChange:i=>d(i.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:v.map(i=>e.jsx("option",{value:i,children:i},i))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:a,onChange:i=>x(parseInt(i.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:a===0?"Aucun":`${a} unitÃ©${a>1?"s":""}`})]}),r!=="transformations"&&e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>p(!n),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:n?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:n?"rotate(90deg)":"rotate(0deg)"},children:"â–¶"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[s.length," / ",l.length," sÃ©lectionnÃ©",s.length>1?"s":""]})]}),n&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),u(l)},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),u([])},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:l.map(i=>{const m=s.includes(i),R=c[i]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",background:m?"var(--bg-tertiary)":"transparent",borderRadius:"4px",border:`1px solid ${m?R:"var(--border-color)"}`,cursor:"pointer",transition:"all 0.2s",fontSize:"0.9rem"},onClick:h=>{h.stopPropagation(),u(m?j=>j.filter(D=>D!==i):j=>[...j,i])},children:[e.jsx("input",{type:"checkbox",checked:m,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:R,flexShrink:0}}),e.jsx("span",{children:de(i)})]},i)})})]})]})]})}function bt({zoneAnalysis:r,selectedMap:o,viewMode:y,selectedPlayerName:d,hoveredZone:v,setHoveredZone:a}){return!r||o!=="Village"||y!=="deaths"?null:e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"0rem",padding:"1.5rem",background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",borderRadius:"12px",border:"2px solid var(--accent-primary)",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",color:"var(--accent-primary)",fontSize:"1.3rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"ðŸ“Š Analyse par zone (Village)"}),e.jsx("p",{style:{fontSize:"0.95rem",marginBottom:"1rem",color:"var(--text-secondary)",lineHeight:"1.5"},children:"Distribution des morts (selon les types sÃ©lectionnÃ©s) comparÃ©e Ã  la moyenne de tous les joueurs:"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:r.zoneStats.map(x=>{const l=x.zone===r.dominantZone&&r.maxDeviation>10;return e.jsxs("div",{onMouseEnter:()=>a(x.zone),onMouseLeave:()=>a(null),style:{padding:"1rem",background:"var(--bg-primary)",borderRadius:"8px",border:v===x.zone?"1px solid var(--accent-primary)":"1px solid var(--border-color)",color:"var(--text-primary)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.95rem"},children:x.zone}),e.jsxs("div",{style:{fontSize:"0.85rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[d,": ",e.jsxs("strong",{children:[x.playerPercent.toFixed(1),"%"]})," (",x.playerCount,")"]}),e.jsxs("div",{style:{opacity:.85},children:["Moyenne: ",x.avgPercent.toFixed(1),"%"]}),e.jsxs("div",{style:{marginTop:"0.25rem",color:l?"var(--accent-secondary)":x.deviation>0?"var(--accent-primary)":"var(--text-secondary)",fontWeight:Math.abs(x.deviation)>5?"bold":"normal"},children:[x.deviation>0?"+":"",x.deviation.toFixed(1),"% vs moyenne"]})]})]},x.zone)})}),r.dominantZone&&r.maxDeviation>10&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",fontSize:"0.95rem",color:"var(--accent-primary)",fontWeight:"bold",background:"var(--bg-primary)",borderRadius:"8px",border:"2px solid var(--accent-primary)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"âš ï¸"}),e.jsxs("span",{children:[d," meurt significativement plus souvent en zone ",r.dominantZone,"(","+"+r.maxDeviation.toFixed(1),"% par rapport Ã  la moyenne)"]})]})]})}function Ct({locationData:r,clusteredData:o,viewMode:y,selectedPlayerName:d,selectedMap:v,mapConfig:a,xDomain:x,zDomain:l,hoveredZone:s,getDeathColor:u,handleLocationClick:c}){const n=({active:p,payload:i})=>{if(!p||!i||i.length===0)return null;const m=i[0].payload,R=m.allLocations||[m],h=R.length>1,j=y==="transformations";if(h){const z=new Map,T=new Map,N=new Set,F=new Map;R.forEach(t=>{if(z.set(t.victimName,(z.get(t.victimName)||0)+1),j)F.set(t.camp,(F.get(t.camp)||0)+1);else{const P=t.deathType?de(t.deathType):"Inconnu";T.set(P,(T.get(P)||0)+1)}N.add(t.gameId)});const V=Array.from(z.entries()).sort((t,P)=>P[1]-t[1]).slice(0,3),I=Array.from(T.entries()).sort((t,P)=>P[1]-t[1]).slice(0,3),$=Array.from(F.entries()).sort((t,P)=>P[1]-t[1]);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[j?"ðŸº":y==="deaths"?"ðŸ’€":"âš”ï¸"," ",R.length," ",j?"transformations":y==="deaths"?"morts":"kills"," Ã  cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[j?e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Camps loup:"}),$.map(([t,P])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",P,"Ã—)"]},t))]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:y==="deaths"?"Victimes:":"Kills sur:"}),V.map(([t,P])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",P,"Ã—)"]},t))]}),e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Types de mort:"}),I.map(([t,P])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",P,"Ã—)"]},t))]})]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["ðŸ“ ",N.size," partie",N.size>1?"s":""," diffÃ©rente",N.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const D=R[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[j?"ðŸº":y==="deaths"?"ðŸ’€":"âš”ï¸"," ",j?"Transformation de":y==="deaths"?"Mort de":"Kill de"," ",d]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[j?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ‘¤ ",e.jsx("strong",{children:"Joueur:"})," ",D.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp loup:"})," ",D.camp]}),e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",D.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",D.gameId]})]}):y==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Victime:"})," ",D.victimName]}),e.jsxs("div",{children:["âš”ï¸ ",e.jsx("strong",{children:"Tueur:"})," ",D.killerName||"Inconnu"]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",D.deathType?de(D.deathType):"Inconnu"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Victime:"})," ",D.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp victime:"})," ",D.camp]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",D.deathType?de(D.deathType):"Inconnu"]})]}),!j&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",D.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",D.gameId]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})};return e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:r.length>0?e.jsx(U,{title:y==="deaths"?`Carte des Morts de ${d}`:`Carte des Kills de ${d}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(_e,{margin:{top:20,right:30,left:60,bottom:20},children:[a&&e.jsx(ae,{x1:a.zMin,x2:a.zMax,y1:a.xMin,y2:a.xMax,fill:"transparent",stroke:"none",shape:p=>{const{x:i,y:m,width:R,height:h}=p;return e.jsx("image",{x:i,y:m,width:R,height:h,href:a.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),v==="Village"&&s&&e.jsxs(e.Fragment,{children:[s==="Ruines"&&e.jsx(ae,{x1:-220,x2:200,y1:100,y2:450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),s==="Village Principal"&&e.jsx(ae,{x1:-250,x2:100,y1:-120,y2:-450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),s==="Ferme"&&e.jsx(ae,{x1:-550,x2:-250,y1:150,y2:-150,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),s==="Village PÃªcheur"&&e.jsx(ae,{x1:150,x2:500,y1:80,y2:-320,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),s==="Reste de la Carte"&&e.jsx(ae,{x1:a?.zMin??-600,x2:a?.zMax??600,y1:a?.xMin??-500,y2:a?.xMax??500,fill:"var(--accent-primary)",fillOpacity:.15,stroke:"var(--accent-primary)",strokeWidth:2,strokeDasharray:"5 5"})]}),e.jsx(J,{strokeDasharray:"3 3",stroke:a?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(Q,{dataKey:"z",type:"number",name:"Position Z",domain:l,hide:!0}),e.jsx(X,{dataKey:"x",type:"number",name:"Position X",domain:x,hide:!0}),e.jsx(K,{content:e.jsx(n,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Ue,{data:o,onClick:p=>c(p),style:{cursor:"pointer"},isAnimationActive:!1,children:o.map((p,i)=>{const m=Math.min(Math.log2(p.count+1)*3+5,18),R=Math.round(m);return e.jsx(Y,{fill:u(p.deathType,p.camp),stroke:p.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:p.count>1?2:1,opacity:.85,r:R},`cell-${i}`)})})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:y==="deaths"?`Aucune mort localisÃ©e pour ${d} sur cette carte.`:y==="kills"?`Aucun kill localisÃ© pour ${d} sur cette carte.`:`Aucune transformation en loup localisÃ©e pour ${d} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes."})]})})}function De(r,o){return o>=-250&&o<=100&&r>=-450&&r<=-120?"Village Principal":o>=-550&&o<=-250&&r>=-150&&r<=150?"Ferme":o>=150&&o<=500&&r>=-320&&r<=80?"Village PÃªcheur":o>=-220&&o<=200&&r>=100&&r<=450?"Ruines":"Reste de la Carte"}function le(r){return r==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":r}function wt({selectedPlayerName:r}){const{navigateToGameDetails:o}=ne(),{gameData:y,isLoading:d,error:v}=ye(),a=oe(),[x,l]=M.useState("deaths"),[s,u]=M.useState(""),[c,n]=M.useState(0),[p,i]=M.useState(null),[m,R]=M.useState([]),[h,j]=M.useState(!1),{data:D}=ge(r,"Tous les camps"),z=M.useMemo(()=>{if(!y)return[];const S=new Set;return y.forEach(b=>{const k=b.PlayerStats.find(A=>A.Username.toLowerCase()===r.toLowerCase());k&&(k.DeathPosition!==null&&b.MapName&&S.add(b.MapName),b.PlayerStats.forEach(A=>{A.KillerName?.toLowerCase()===r.toLowerCase()&&A.DeathPosition!==null&&b.MapName&&S.add(b.MapName)}),k.Actions&&Array.isArray(k.Actions)&&k.Actions.some(A=>A.ActionType==="Transform")&&b.MapName&&S.add(b.MapName))}),Array.from(S).filter(b=>b==="Village"||b==="ChÃ¢teau").sort((b,k)=>b==="Village"?-1:k==="Village"?1:b.localeCompare(k))},[y,r]),T=z.length>0?z[0]:"";s===""&&T!==""&&u(T);const{availableDeathTypes:N,deathTypeColors:F}=M.useMemo(()=>{if(!y||!r)return{availableDeathTypes:[],deathTypeColors:{}};const S=new Set,b={};return y.forEach(k=>{const A=k.PlayerStats.find(L=>L.Username.toLowerCase()===r.toLowerCase());if(A){if(A.DeathPosition&&A.DeathType){const L=le(A.DeathType);L&&S.add(L)}k.PlayerStats.forEach(L=>{if(L.KillerName?.toLowerCase()===r.toLowerCase()&&L.DeathPosition&&L.DeathType){const B=le(L.DeathType);B&&S.add(B)}})}}),S.forEach(k=>{b[k]=Ye(k,a)}),{availableDeathTypes:Array.from(S).sort(),deathTypeColors:b}},[y,r,a]),V=(S,b)=>x==="transformations"&&b?a[b]||"var(--text-secondary)":S&&F[S]||"var(--text-secondary)";M.useEffect(()=>{if(m.length===0&&N.length>0){const S=N.filter(b=>b!=="VOTED");R(S)}},[N.length]);const I=M.useMemo(()=>{if(!y||!r)return[];const S=[];return y.forEach(b=>{if(s&&b.MapName!==s)return;const k=b.PlayerStats.find(A=>A.Username.toLowerCase()===r.toLowerCase());if(k)if(x==="deaths"){if(k.DeathPosition){const A=ce(k.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),L=pe(k.DeathPosition.x,k.DeathPosition.z,b.MapName);S.push({x:L.x,z:L.z,victimName:k.Username,killerName:k.KillerName||null,deathType:le(k.DeathType),mapName:b.MapName,camp:A,gameId:b.DisplayedId,displayedGameId:b.DisplayedId})}}else x==="kills"?b.PlayerStats.forEach(A=>{if(A.KillerName?.toLowerCase()===r.toLowerCase()&&A.DeathPosition){const L=ce(A.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),B=pe(A.DeathPosition.x,A.DeathPosition.z,b.MapName);S.push({x:B.x,z:B.z,victimName:A.Username,killerName:r,deathType:le(A.DeathType),mapName:b.MapName,camp:L,gameId:b.DisplayedId,displayedGameId:b.DisplayedId})}}):x==="transformations"&&k.Actions&&Array.isArray(k.Actions)&&k.Actions.forEach(A=>{if(A.ActionType==="Transform"&&A.Position){const L=ce(k.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),B=pe(A.Position.x,A.Position.z,b.MapName);S.push({x:B.x,z:B.z,victimName:k.Username,killerName:null,deathType:null,mapName:b.MapName,camp:L,gameId:b.DisplayedId,displayedGameId:b.DisplayedId})}})}),x!=="transformations"&&m.length>0&&m.length<N.length?S.filter(b=>b.deathType&&m.includes(b.deathType)):S},[y,r,x,s,m,N]),$=M.useMemo(()=>{if(s!=="Village"||x!=="deaths"||I.length===0)return null;const S={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};if(I.forEach(G=>{const E=De(G.x,G.z);S[E]=(S[E]||0)+1}),!y)return null;const b={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};y.forEach(G=>{G.MapName==="Village"&&G.PlayerStats.forEach(E=>{if(!E.DeathPosition)return;const H=le(E.DeathType);if(m.length>0&&m.length<N.length&&(!H||!m.includes(H)))return;const _=pe(E.DeathPosition.x,E.DeathPosition.z,"Village"),xe=De(_.x,_.z);b[xe]=(b[xe]||0)+1})});const k=Object.values(b).reduce((G,E)=>G+E,0),A=Object.values(S).reduce((G,E)=>G+E,0);if(k===0||A===0)return null;const L=["Village Principal","Village PÃªcheur","Ferme","Ruines","Reste de la Carte"];let B=0,C=null;const q=L.map(G=>{const E=S[G]/A*100,H=b[G]/k*100,_=E-H;return _>B&&S[G]>=2&&(B=_,C=G),{zone:G,playerCount:S[G],playerPercent:E,avgPercent:H,deviation:_}});return{totalPlayerDeaths:A,totalAllDeaths:k,zoneStats:q,dominantZone:C,maxDeviation:B}},[I,s,x,y,m,N]),t=M.useMemo(()=>Je(I,c).map((b,k)=>{const A=b.items[0],L=Qe(b.items);return{x:b.centroidX,z:b.centroidZ,count:b.items.length,allLocations:b.items,victimName:b.items.length===1?A.victimName:null,killerName:b.items.length===1?A.killerName:null,deathType:L,mapName:A.mapName,camp:A.camp,gameId:b.items.length===1?A.gameId:null,displayedGameId:b.items.length===1?A.displayedGameId:null,clusterIndex:k}}),[I,c]),P=M.useMemo(()=>Xe(s),[s]),{xDomain:W,zDomain:w}=M.useMemo(()=>{if(P)return{xDomain:[P.xMin,P.xMax],zDomain:[P.zMin,P.zMax]};if(t.length===0)return{xDomain:[0,100],zDomain:[0,100]};const S=t.map(G=>G.x),b=t.map(G=>G.z),k=Math.min(...S),A=Math.max(...S),L=Math.min(...b),B=Math.max(...b),C=(A-k)*.1||10,q=(B-L)*.1||10;return{xDomain:[k-C,A+C],zDomain:[L-q,B+q]}},[t,P]),f=S=>{if(!S)return;const b=S.allLocations||[S];if(b.length===1)o({selectedGame:b[0].gameId,fromComponent:"Player Death Map"});else{const k=b.map(A=>A.gameId).filter(A=>A);o({selectedGameIds:k,fromComponent:"Player Death Map"})}},g=M.useMemo(()=>{if(!D?.mapStats||!s)return null;const S=D.mapStats[s];return S?{winRate:S.winRate,wins:S.wins,total:S.appearances}:null},[D,s]);return d?e.jsx("div",{className:"donnees-attente",children:"Chargement des donnÃ©es..."}):v?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",v]}):y?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsx(jt,{viewMode:x,setViewMode:l,selectedMap:s,setSelectedMap:u,availableMaps:z,clusterRadius:c,setClusterRadius:n,availableDeathTypes:N,selectedDeathTypes:m,setSelectedDeathTypes:R,deathTypeColors:F,isDeathTypesExpanded:h,setIsDeathTypesExpanded:j}),e.jsx(Ct,{locationData:I,clusteredData:t,viewMode:x,selectedPlayerName:r,selectedMap:s,mapConfig:P,xDomain:W,zDomain:w,hoveredZone:p,getDeathColor:V,handleLocationClick:f}),e.jsx(bt,{zoneAnalysis:$,selectedMap:s,viewMode:x,selectedPlayerName:r,hoveredZone:p,setHoveredZone:i}),g&&e.jsxs("div",{style:{flex:"1 1 100%",textAlign:"center",padding:"0.75rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)",marginTop:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginRight:"1rem"},children:["Taux de victoire sur ",e.jsx("strong",{children:s})," :"]}),e.jsxs("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:parseFloat(g.winRate)>=50?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[g.winRate,"%"]}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["(",g.wins," / ",g.total," victoires)"]})]}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"Ã€ propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",x==="deaths"?`les emplacements oÃ¹ ${r} est mort`:x==="kills"?`les emplacements oÃ¹ ${r} a Ã©liminÃ© d'autres joueurs`:`les emplacements oÃ¹ ${r} s'est transformÃ© en loup`," au cours des parties.",x!=="transformations"&&"Les couleurs indiquent le type de mort."," Cliquez sur un point pour voir les dÃ©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroupÃ©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’€ Morts:"})," OÃ¹ le joueur a Ã©tÃ© Ã©liminÃ©",e.jsx("br",{}),e.jsx("strong",{children:"âš”ï¸ Kills:"})," OÃ¹ le joueur a Ã©liminÃ© d'autres joueurs",e.jsx("br",{}),e.jsx("strong",{children:"ðŸº Transformations:"})," OÃ¹ le joueur s'est transformÃ© en loup"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function Me(r){return r.PlayerStats.some(o=>o.SecondsTalkedOutsideMeeting>0||o.SecondsTalkedDuringMeeting>0)}function fe(r,o){const y=o.DeathDateIrl||r.EndDate,d=Ae(r.StartDate,y);return d&&d>0?d:0}function St(r){const o=r.filter(Me),y=new Map;return o.forEach(d=>{d.PlayerStats.forEach(v=>{const a=te(v),x=Le(v),l=fe(d,v);if(l<=0)return;y.has(a)||y.set(a,{displayName:x,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const s=y.get(a);s.gamesPlayed++,s.totalSecondsAll+=(v.SecondsTalkedOutsideMeeting||0)+(v.SecondsTalkedDuringMeeting||0),s.totalGameDuration+=l})}),{playerStats:y,gamesWithTalkingData:o.length}}function Rt(r,o){if(!o||o.length===0||!r)return null;const y=St(o),d=o.filter(Me);if(d.length===0||y.playerStats.size===0)return null;let v=null;for(const[f,g]of y.playerStats)if(g.displayName===r){v=f;break}if(!v)return null;let a=0,x=0,l=0,s=0;const u={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},c=new Map;let n=0,p=0,i=0,m=0;if(d.forEach(f=>{const g=f.PlayerStats.find(q=>te(q)===v);if(!g)return;const S=fe(f,g);if(S<=0)return;a++;const b=g.SecondsTalkedOutsideMeeting||0,k=g.SecondsTalkedDuringMeeting||0,A=b+k;x+=b,l+=k,s+=S;const L=qe(g.MainRoleInitial,g.Power);u[L].gamesPlayed++,u[L].secondsOutside+=b,u[L].secondsDuring+=k,u[L].gameDuration+=S;const B=He(g);c.has(B)||c.set(B,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const C=c.get(B);C.gamesPlayed++,C.totalSecondsAll+=A,C.totalGameDuration+=S}),a===0||s<=0)return null;const R=3600/s,h=x*R,j=l*R,D=(x+l)*R,z=x+l>0?l/(x+l)*100:0,T=[];for(const[f,g]of Object.entries(u)){if(g.gamesPlayed===0)continue;const S=g.gameDuration>0?3600/g.gameDuration:0,b=g.secondsOutside+g.secondsDuring;T.push({camp:f,gamesPlayed:g.gamesPlayed,totalSecondsOutside:g.secondsOutside,totalSecondsDuring:g.secondsDuring,totalSecondsAll:b,totalGameDurationSeconds:g.gameDuration,secondsOutsidePer60Min:g.secondsOutside*S,secondsDuringPer60Min:g.secondsDuring*S,secondsAllPer60Min:b*S,meetingRatio:b>0?g.secondsDuring/b*100:0})}T.sort((f,g)=>g.gamesPlayed-f.gamesPlayed);const N=Array.from(c.entries()).filter(([f,g])=>g.gamesPlayed>=1).map(([f,g])=>({role:f,gamesPlayed:g.gamesPlayed,secondsAllPer60Min:g.totalGameDuration>0?g.totalSecondsAll/g.totalGameDuration*3600:0,totalSecondsAll:g.totalSecondsAll})).sort((f,g)=>g.secondsAllPer60Min-f.secondsAllPer60Min),F=[];for(const[f,g]of y.playerStats)g.totalGameDuration>0&&F.push({id:f,name:g.displayName,per60:g.totalSecondsAll/g.totalGameDuration*3600});F.sort((f,g)=>g.per60-f.per60);const V=F.reduce((f,g)=>f+g.per60,0),I=F.length>0?V/F.length:0,$=F.findIndex(f=>f.id===v)+1,t=F.length,P=t>0?Math.round((1-($-1)/t)*100):0,W=D;d.forEach(f=>{const g=f.PlayerStats.find(A=>te(A)===v);if(!g)return;const S=fe(f,g);if(S<=0)return;((g.SecondsTalkedOutsideMeeting||0)+(g.SecondsTalkedDuringMeeting||0))/S*3600>=W?(n++,g.Victorious&&p++):(i++,g.Victorious&&m++)});const w={gamesAboveAverage:n,winsAboveAverage:p,winRateAboveAverage:n>0?p/n*100:0,gamesBelowAverage:i,winsBelowAverage:m,winRateBelowAverage:i>0?m/i*100:0};return{playerName:r,gamesPlayed:a,gamesWithTalkingData:y.gamesWithTalkingData,totalSecondsOutside:x,totalSecondsDuring:l,totalSecondsAll:x+l,totalGameDurationSeconds:s,secondsOutsidePer60Min:h,secondsDuringPer60Min:j,secondsAllPer60Min:D,meetingRatio:z,campBreakdown:T,globalAverageSecondsAllPer60Min:I,playerRank:$,totalPlayersWithData:t,percentile:P,roleBreakdown:N,winCorrelation:w}}function kt(r,o){return r?r.roleBreakdown.slice(0,o):[]}function Tt(r){const{data:o,isLoading:y,error:d}=ve(v=>r?Rt(r,v):null);return{data:o,isLoading:y,error:d}}function Pt({selectedPlayerName:r}){const{data:o,isLoading:y,error:d}=Tt(r),v=oe(),[a,x]=M.useState("both"),l=M.useMemo(()=>o?.campBreakdown?o.campBreakdown.map(i=>({camp:i.camp,"Hors rÃ©union":Math.round(i.secondsOutsidePer60Min),"En rÃ©union":Math.round(i.secondsDuringPer60Min),total:Math.round(i.secondsAllPer60Min),gamesPlayed:i.gamesPlayed,meetingRatio:i.meetingRatio.toFixed(1)})):[],[o]),s=M.useMemo(()=>o?[{name:"En rÃ©union",value:o.totalSecondsDuring,color:"#2196F3"},{name:"Hors rÃ©union",value:o.totalSecondsOutside,color:"#FF9800"}]:[],[o]);if(y)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(d)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",d]});if(!o)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de temps de parole ne sont disponibles que pour les parties rÃ©centes."})]});const u=o.secondsAllPer60Min-o.globalAverageSecondsAllPer60Min,c=o.globalAverageSecondsAllPer60Min>0?(u/o.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",n=u>0,p=o.winCorrelation.winRateAboveAverage-o.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¤ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:se(o.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:n?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[n?"+":"",c,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",o.playerRank," / ",o.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-o.percentile+1,"% ",o.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“ˆ Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:o.gamesPlayed}),e.jsxs("p",{children:["sur ",o.gamesWithTalkingData," avec donnÃ©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ—£ï¸ Ratio en rÃ©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[o.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),l.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(U,{title:"Temps de parole par camp (par 60min de jeu)",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>x("meeting"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="meeting"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="meeting"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="meeting"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="meeting"?"bold":"normal"},children:"En rÃ©union"}),e.jsx("button",{onClick:()=>x("outside"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="outside"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="outside"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="outside"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="outside"?"bold":"normal"},children:"Hors rÃ©union"}),e.jsx("button",{onClick:()=>x("both"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="both"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="both"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="both"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="both"?"bold":"normal"},children:"Les deux"})]}),e.jsx("div",{style:{height:350},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:l,layout:"vertical",children:[e.jsx(J,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(Q,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:i=>`${Math.floor(i/60)}m`}),e.jsx(X,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(K,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(i,m)=>[se(i),m],labelFormatter:i=>{const m=l.find(R=>R.camp===i);return`${i} (${m?.gamesPlayed||0} parties)`}}),e.jsx(Ze,{}),(a==="both"||a==="outside")&&e.jsx(Z,{dataKey:"Hors rÃ©union",stackId:"talk",fill:"#FF9800"}),(a==="both"||a==="meeting")&&e.jsx(Z,{dataKey:"En rÃ©union",stackId:"talk",fill:"#2196F3"})]})})})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:(()=>{const i=l.find(j=>j.camp==="Villageois"),m=l.find(j=>j.camp==="Loup");if(!i||!m)return e.jsx("p",{children:"ðŸ’¡ Pas assez de donnÃ©es pour comparer les camps Villageois et Loups."});const R=i.total-m.total,h=m.total>0?(Math.abs(R)/m.total*100).toFixed(0):"0";return R>0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:Ce("Villageois")},children:[se(R)," de plus (+",h,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Villageois"})," qu'en tant que"," ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]}):R<0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:Ce("Loup")},children:[se(Math.abs(R))," de plus (+",h,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Loup"})," qu'en tant que"," ",e.jsx("strong",{children:"Villageois"})," (par heure de jeu)."]}):e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle exactement autant en tant que"," ",e.jsx("strong",{children:"Villageois"})," qu'en tant que ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(U,{title:"RÃ©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(je,{children:[e.jsx(be,{data:s,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:i=>`${i.name}: ${((i.percent||0)*100).toFixed(1)}%`,children:s.map((i,m)=>e.jsx(Y,{fill:i.color},`cell-${m}`))}),e.jsx(K,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:i=>se(i)})]})})})})}),o&&o.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(U,{title:i=>i?"Top 15 rÃ´les les plus bavards (par 60min)":"Top 5 rÃ´les les plus bavards (par 60min)",children:i=>{const R=kt(o,i?15:5).map(h=>({role:h.role,secondsPer60Min:Math.round(h.secondsAllPer60Min),gamesPlayed:h.gamesPlayed}));return e.jsx("div",{style:{height:i?400:300},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:R,children:[e.jsx(J,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(Q,{dataKey:"role",tick:{fill:"var(--text-primary)",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(X,{tick:{fill:"var(--text-secondary)"},tickFormatter:h=>`${Math.floor(h/60)}m`}),e.jsx(K,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:h=>[se(h),"Temps de parole"],labelFormatter:h=>{const j=R.find(D=>D.role===h);return`${h} (${j?.gamesPlayed||0} parties)`}}),e.jsx(Z,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",children:R.map((h,j)=>e.jsx(Y,{fill:v[h.role]||v.Villageois},`cell-${j}`))})]})})})}})}),(o.winCorrelation.gamesAboveAverage>0||o.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"ðŸŽ¯ CorrÃ©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[o.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",o.winCorrelation.winsAboveAverage,"/",o.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[o.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",o.winCorrelation.winsBelowAverage,"/",o.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(p)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:p>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[p>0?"supÃ©rieur":"infÃ©rieur"," de ",Math.abs(p).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function Dt({playerTitles:r,titlesLoading:o}){if(o)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des titres..."})]})});if(!r||r.titles.length===0)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-empty",children:[e.jsx("p",{children:"ðŸ“œ Aucun titre disponible"}),e.jsx("p",{className:"empty-subtitle",children:r?.gamesPlayed?`${r.gamesPlayed} parties jouÃ©es - minimum 25 parties requises pour obtenir des titres`:"Les titres sont gÃ©nÃ©rÃ©s chaque dimanche pour les joueurs avec 25+ parties en mode moddÃ©"})]})});const y=[...r.titles].sort((d,v)=>{const a=r.titles.indexOf(d),l=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(d.category||"")?100-(d.percentile||50):d.percentile||50,s=(d.priority||0)*1e3+l*10-a,u=r.titles.indexOf(v),n=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(v.category||"")?100-(v.percentile||50):v.percentile||50;return(v.priority||0)*1e3+n*10-u-s});return e.jsxs("div",{className:"titles-section",children:[e.jsxs("div",{className:"titles-header",children:[e.jsx("h3",{children:"ðŸ·ï¸ Titres actuels"}),e.jsxs("p",{className:"titles-info",children:[r.titles.length," titre",r.titles.length>1?"s":""," â€¢",r.gamesPlayed," parties jouÃ©es"]})]}),e.jsx("div",{className:"titles-grid",children:y.map((d,v)=>{const a=r.primaryTitle?.id===d.id;return e.jsxs("div",{className:`title-card ${d.type} ${a?"primary":""}`,title:`${d.description}${d.percentile!==void 0?`
MeilleurÂ·e que ${d.percentile.toFixed(1)}% des joueurs`:""}`,children:[e.jsx("div",{className:"title-rank",children:v+1}),"            ",a&&e.jsx("div",{className:"title-crown",children:"ðŸ‘‘"}),"            ",e.jsx("div",{className:"title-emoji",children:d.emoji}),e.jsxs("div",{className:"title-info",children:[e.jsx("div",{className:"title-name",children:d.title}),e.jsx("div",{className:"title-description",children:d.description}),d.percentile!==void 0&&d.type!=="combination"&&e.jsxs("div",{className:"title-percentile",children:["Top ",(100-d.percentile).toFixed(0),"%"]}),e.jsx("div",{className:"title-type-badge",children:d.type==="combination"?"Combo":d.type==="role"?"RÃ´le":"Stat"}),!a&&d.primaryOwner&&e.jsxs("div",{className:"title-primary-owner",children:["ðŸ‘¤ Titre principal de: ",e.jsx("strong",{children:d.primaryOwner})]}),d.type==="combination"&&d.conditions&&d.conditions.length>0&&e.jsxs("div",{className:"title-conditions-breakdown",children:[e.jsx("div",{className:"breakdown-header",children:"Conditions:"}),d.conditions.map((x,l)=>e.jsxs("div",{className:"condition-item",children:[e.jsxs("span",{className:"condition-stat",children:[x.stat==="winRate"?"Victoires":x.stat==="loot"?"RÃ©colte":x.stat==="lootVillageois"?"RÃ©colte (Villageois)":x.stat==="lootLoup"?"RÃ©colte (Loup)":x.stat==="survival"?"Survie":x.stat==="killRate"?"Kills":x.stat==="talking"?"Parole":x.stat==="talkingOutsideMeeting"?"Parole (hors dÃ©bats)":x.stat==="talkingDuringMeeting"?"Parole (meeting)":x.stat==="votingAggressive"?"Vote agressif":x.stat==="votingAccuracy"?"PrÃ©cision vote":x.stat==="votingFirst"?"Vote rapide":x.stat==="survivalDay1"?"Survie J1":x.stat==="winRateVillageois"?"Victoires Villageois":x.stat==="winRateLoup"?"Victoires Loup":x.stat==="winRateSolo"?"Victoires Solo":x.stat==="hunterAccuracy"?"PrÃ©cision chasseur":x.stat,":"]}),e.jsx("span",{className:`condition-category ${x.category?.toLowerCase()}`,children:x.category}),x.actualPercentile!==void 0&&e.jsxs("span",{className:"condition-percentile",children:["(Top ",(100-x.actualPercentile).toFixed(0),"%)"]})]},l))]})]})]},d.id)})})]})}function Jt(){const{settings:r,updateSettings:o}=me(),{navigateToGameDetails:y,navigationState:d,updateNavigationState:v}=ne(),{data:a,isLoading:x,error:l}=Ie(),{joueursData:s,isLoading:u}=ue(),{data:c,isLoading:n,error:p}=at(r.highlightedPlayer),{playerData:i,isLoading:m}=nt(r.highlightedPlayer),R=he(s),[h,j]=M.useState(""),[D,z]=M.useState(null),{clips:T}=et(r.highlightedPlayer),{clips:N}=tt(),[F,V]=M.useState(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded"?"modded":"all":r.gameFilter==="modded"?"modded":"all"),I=M.useMemo(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded":r.gameFilter==="modded",[r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter,r.gameFilter]),[$,t]=M.useState(r.selectedPlayerSelectionView||d.selectedPlayerSelectionView||"achievements"),[P,W]=M.useState("session"),[w,f]=M.useState("all");M.useEffect(()=>{if(r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled){const C=r.independentFilters.gameFilter==="modded"?"modded":"all";V(C)}else if(!r.useIndependentFilters){const C=r.gameFilter==="modded"?"modded":"all";V(C)}},[r.gameFilter,r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter]),M.useEffect(()=>{I&&F!=="modded"&&V("modded")},[I,F]),M.useEffect(()=>{const C=r.selectedPlayerSelectionView||d.selectedPlayerSelectionView;C&&C!==$&&t(C)},[r.selectedPlayerSelectionView,d.selectedPlayerSelectionView]);const{data:g}=ge(r.highlightedPlayer||""),S=M.useMemo(()=>{if(!a||!a.GameStats)return[];const C=I?a.GameStats.filter(G=>G.Modded===!0):a.GameStats,q=new Map;return C.forEach(G=>{const E=new Date(G.StartDate);G.PlayerStats.forEach(H=>{const _=te(H),Fe=s?.Players?.find(ze=>ze.SteamID===_)?.Joueur||H.Username;q.has(_)||q.set(_,{games:0,wins:0,firstDate:E,lastDate:E,displayName:Fe});const re=q.get(_);re.games++,H.Victorious&&re.wins++,E<re.firstDate&&(re.firstDate=E),E>re.lastDate&&(re.lastDate=E)})}),Array.from(q.entries()).map(([G,E])=>{let H=s?.Players?.find(_=>_.SteamID===G);return H||(H=s?.Players?.find(_=>_.Joueur===E.displayName)),{id:G,name:E.displayName,totalGames:E.games,totalWins:E.wins,winRate:E.games>0?E.wins/E.games*100:0,firstGameDate:E.firstDate.toLocaleDateString("fr-FR"),lastGameDate:E.lastDate.toLocaleDateString("fr-FR"),isHighlighted:E.displayName===r.highlightedPlayer,image:H?.Image||null,twitch:H?.Twitch||null,youtube:H?.Youtube||null}})},[a,r.highlightedPlayer,s,I]),b=M.useMemo(()=>{if(!h.trim())return S;const C=h.toLowerCase();return S.filter(q=>q.name.toLowerCase().includes(C))},[S,h]),k=M.useMemo(()=>[...b].sort((C,q)=>q.totalGames-C.totalGames),[b]),A=C=>{o({highlightedPlayer:C}),j("")},L=C=>{t(C),v({selectedPlayerSelectionView:C}),o({selectedPlayerSelectionView:C,tab:"playerSelection"})},B=()=>{if(T.length===0)return;const C=Math.floor(Math.random()*T.length);z(T[C])};return x||u?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):l?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",l]})]}):!a||S.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!r.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:h,onChange:C=>j(C.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[b.length," joueur",b.length!==1?"s":"",h&&` (filtrÃ©${b.length!==1?"s":""} de ${S.length})`]})]})]}),e.jsx("div",{className:"player-display",children:h?b.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>j(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:k.map(C=>e.jsxs("button",{type:"button",className:`suggestion-btn ${C.isHighlighted?"highlighted":""}`,onClick:()=>A(C.name),children:[C.image?e.jsx("img",{src:C.image,alt:`Photo de profil de ${C.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":R[C.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[C.name,C.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[C.totalGames," parties â€¢ ",C.winRate.toFixed(1),"% victoires"]})]})]},C.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',h,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>j(""),children:"Effacer la recherche"})]}):r.highlightedPlayer?(()=>{const C=S.find(q=>q.name===r.highlightedPlayer);return C?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:C.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[C.image?e.jsx("img",{src:C.image,alt:`Photo de profil de ${C.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":R[C.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[C.totalGames," parties â€¢ ",C.totalWins," victoires â€¢ ",C.winRate.toFixed(1),"% taux de victoire"]}),i?.primaryTitle?e.jsxs("div",{className:"player-primary-title",title:i.primaryTitle.description,style:{marginTop:"0.5rem",display:"inline-flex",alignItems:"center",gap:"0.3rem",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("span",{className:"title-emoji",children:i.primaryTitle.emoji}),e.jsx("span",{className:"title-text",children:i.primaryTitle.title})]}):e.jsx("div",{className:"player-no-title",style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic"},children:"ðŸ“œ 25 parties moddÃ©es minimum pour obtenir un titre"}),(C.twitch||C.youtube||T.length>0)&&e.jsxs("div",{className:"social-links",children:[C.twitch&&e.jsx("a",{href:C.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),C.youtube&&e.jsx("a",{href:C.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"}),T.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:q=>{q.stopPropagation(),B()},title:`${T.length} clip${T.length>1?"s":""} disponible${T.length>1?"s":""}`,children:["ðŸŽ¬ Clip alÃ©atoire (",T.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="achievements"?"active":""}`,onClick:()=>L("achievements"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="titles"?"active":""}`,onClick:()=>L("titles"),children:"Titres"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="evolution"?"active":""}`,onClick:()=>L("evolution"),children:"Ã‰volution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="camps"?"active":""}`,onClick:()=>L("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="roles"?"active":""}`,onClick:()=>L("roles"),children:"RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="actions"?"active":""}`,onClick:()=>L("actions"),children:"Actions"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="kills"?"active":""}`,onClick:()=>L("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="deathmap"?"active":""}`,onClick:()=>L("deathmap"),children:"Cartes"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="talkingtime"?"active":""}`,onClick:()=>L("talkingtime"),children:"Parole"})]}),$==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[n?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):p?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",p]})}):c?e.jsx(ot,{achievements:F==="all"?c.allGamesAchievements:c.moddedOnlyAchievements,title:F==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:F}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[!I&&e.jsx("button",{type:"button",className:`filter-btn ${F==="all"?"active":""}`,onClick:q=>{q.stopPropagation(),V("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${F==="modded"?"active":""}`,onClick:q=>{q.stopPropagation(),V("modded")},disabled:I,children:"Parties moddÃ©es"})]})]}),$==="titles"&&e.jsx(Dt,{playerTitles:i,titlesLoading:m}),$==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[g&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{y({selectedPlayer:C.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${C.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:g.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:Ve(g.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{y({selectedPlayer:C.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${C.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:g.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[g.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:P,onChange:q=>W(q.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:w,onChange:q=>f(q.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(lt,{selectedPlayerName:C.name,groupingMethod:P,campFilter:w})]}),$==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ct,{selectedPlayerName:C.name})}),$==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(pt,{selectedPlayerName:C.name})}),$==="actions"&&e.jsx("div",{className:"player-history-section",children:e.jsx(vt,{selectedPlayerName:C.name})}),$==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(dt,{selectedPlayerName:C.name})}),$==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(wt,{selectedPlayerName:C.name})}),$==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Pt,{selectedPlayerName:C.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:q=>{q.stopPropagation(),o({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[C.firstGameDate," - ",C.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',r.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>o({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:k.map(C=>e.jsxs("div",{className:`character-card ${C.isHighlighted?"highlighted":""}`,onClick:()=>A(C.name),title:`${C.name} - ${C.totalGames} parties, ${C.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:C.image?e.jsx("img",{src:C.image,alt:`Photo de profil de ${C.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":R[C.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:C.name}),(C.twitch||C.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[C.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),C.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},C.id))})})}),D&&e.jsx(rt,{clip:D,onClose:()=>z(null),relatedClips:st(D,N),nextClip:Re(D,N),onNextClip:()=>{const C=Re(D,N);C&&z(C)},onRelatedClip:C=>{const q=N.find(G=>G.ClipId===C);q&&z(q)}})]})}export{Jt as PlayerSelectionPage};
