import{u as V}from"./baseStatsHook-on70_lDu.js";import{g as L,a as C}from"./datasyncExport-D6_8Fmuy.js";import{i as K,D as r}from"./deathTypes-CGUOTngO.js";import{c as k}from"./api-CwWxZwOP.js";import{g as R}from"./index-BlE2yhdl.js";function M(u,i){if(!u||!i)return!1;const l=u.split(".").map(Number),o=i.split(".").map(Number);for(let t=0;t<Math.max(l.length,o.length);t++){const e=l[t]||0,n=o[t]||0;if(e>n)return!0;if(e<n)return!1}return!0}function P(u){return u===r.SURVIVALIST_NOT_SAVED?r.BY_WOLF:u}function b(u){const i=new Set;u.filter(e=>!e.LegacyData||e.LegacyData.deathInformationFilled===!0).forEach(e=>{e.PlayerStats.forEach(n=>{const p=L(n.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});i.add(p)})});const o=Array.from(i);return[...k.filter(e=>o.includes(e)),...o.filter(e=>!k.includes(e)).sort()]}function x(u){switch(u){case r.VOTED:return"Mort aux votes";case r.BY_WOLF:case r.SURVIVALIST_NOT_SAVED:return"Kill en Loup";case r.BY_ZOMBIE:return"Kill en Zombie";case r.BY_BEAST:return"Kill en Bête";case r.BY_AVATAR_CHAIN:return"Mort d'Avatar";case r.BULLET:return"Tir de Chasseur";case r.BULLET_HUMAN:return"Kill de Chasseur (sur humain)";case r.BULLET_WOLF:return"Kill de Chasseur (sur loup)";case r.SHERIF_SUCCESS:return"Kill de Shérif";case r.OTHER_AGENT:return"Kill d'Agent";case r.AVENGER:return"Kill de Vengeur";case r.SEER:return"Kill de Devin";case r.HANTED:return"Kill avec Potion hantée";case r.ASSASSIN:return"Kill avec Potion (Assassin)";case r.LOVER_DEATH:return"Kill d'amoureux";case r.BOMB:return"Explosion";case r.CRUSHED:return"Écrasement";case r.STARVATION:return"Famine";case r.STARVATION_AS_BEAST:return"Tuerie bestiale";case r.FALL:return"Chute mortelle";case r.UNKNOWN:return"Kill inconnu";default:return""}}function j(u){const i=new Set;u.forEach(t=>{t.PlayerStats.forEach(e=>{if(e.DeathType&&K(e.DeathType)){const n=P(e.DeathType);n&&i.add(n)}})});const l=Array.from(i),o=[r.BY_WOLF,r.VOTED,r.BULLET,r.BULLET_HUMAN,r.BULLET_WOLF,r.BY_ZOMBIE,r.ASSASSIN,r.AVENGER,r.LOVER_DEATH];return[...o.filter(t=>l.includes(t)),...l.filter(t=>!o.includes(t)).sort()]}function O(u,i){return u.PlayerStats.filter(l=>l.DeathType&&K(l.DeathType)&&(l.DeathTiming||l.DeathType)).map(l=>{let o=null,t=null;if(l.KillerName){const e=u.PlayerStats.find(n=>n.Username===l.KillerName);if(e){t=R(e);const n=C(e.MainRoleInitial,e.MainRoleChanges||[]);o=L(n,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1}),n&&n!==e.MainRoleInitial&&(n==="Loup"?o="Loup":n==="Zombie"&&(o="Vaudou"))}}return{playerId:R(l),playerName:l.Username,deathType:P(l.DeathType),killerId:t,killerName:l.KillerName,killerCamp:o}}).filter(l=>{if(!i||i==="Tous les camps")return!0;const o=u.PlayerStats.find(e=>e.Username===l.playerName);return o?L(o.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===i:!1})}function U(u,i,l){const o=[];u.PlayerStats.forEach(e=>{if(e.KillerName&&e.DeathType){if(e.DeathType===r.VOTED||e.DeathType===r.STARVATION||e.DeathType===r.FALL||e.DeathType===r.BY_AVATAR_CHAIN)return;const n=u.PlayerStats.find(h=>h.Username===e.KillerName);if(!n)return;let p=L(n.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});const E=C(n.MainRoleInitial,n.MainRoleChanges||[]);E&&E!==n.MainRoleInitial&&(E==="Loup"?p="Loup":E==="Zombie"&&(p="Vaudou"));const B=L(e.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0});o.push({killerId:R(n),killerName:n.Username,victimId:R(e),victimName:e.Username,deathType:P(e.DeathType),killerCamp:p,victimCamp:B})}});let t=o;return i&&i!=="Tous les camps"&&(t=t.filter(e=>e.killerCamp===i)),l&&l!=="Tous les camps"&&(t=t.filter(e=>l==="Roles solo"?e.victimCamp!=="Villageois"&&e.victimCamp!=="Loup":e.victimCamp===l)),t}function _(u,i,l){if(u.length===0)return null;const o=u.filter(s=>!s.LegacyData||s.LegacyData.deathInformationFilled===!0);if(o.length===0)return null;const t=[],e={},n={};o.forEach(s=>{O(s,i).forEach(a=>{t.push({...a,gameId:s.Id})}),s.PlayerStats.forEach(a=>{const T=R(a),I=a.Username;n[T]=I,(!i||i==="Tous les camps"||L(a.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===i)&&(e[T]=(e[T]||0)+1)})});const p=t.length,E=o.length,B=E>0?p/E:0,h={};t.forEach(s=>{h[s.deathType]=(h[s.deathType]||0)+1});const m=Object.entries(h).map(([s,c])=>({type:s,count:c||0,percentage:p>0?(c||0)/p*100:0})).sort((s,c)=>c.count-s.count),f={};o.forEach(s=>{U(s,i,l).forEach(a=>{n[a.killerId]=a.killerName,n[a.victimId]=a.victimName,f[a.killerId]||(f[a.killerId]={kills:0,victims:new Set,killsByDeathType:{}}),f[a.killerId].kills++,f[a.killerId].victims.add(a.victimId),f[a.killerId].killsByDeathType[a.deathType]=(f[a.killerId].killsByDeathType[a.deathType]||0)+1})});const D=Object.entries(f).map(([s,c])=>{const a=e[s]||0,T=a>0?c.kills/a:0;return{killerName:n[s]||s,kills:c.kills,victims:Array.from(c.victims).map(I=>n[I]||I),percentage:p>0?c.kills/p*100:0,gamesPlayed:a,averageKillsPerGame:T,killsByDeathType:c.killsByDeathType}}).sort((s,c)=>c.kills-s.kills),y={};t.forEach(s=>{y[s.playerId]||(y[s.playerId]={totalDeaths:0,deathsByType:{},killedById:{},deathDays:[]});const c=y[s.playerId];c.totalDeaths++,c.deathsByType[s.deathType]=(c.deathsByType[s.deathType]||0)+1,s.killerId&&(c.killedById[s.killerId]=(c.killedById[s.killerId]||0)+1)});const d=[];Object.entries(y).forEach(([s,c])=>{const a=n[s]||s,T={};Object.entries(c.killedById).forEach(([I,A])=>{const v=n[I]||I;T[v]=(T[v]||0)+A}),d.push({playerName:a,totalDeaths:c.totalDeaths,deathsByType:c.deathsByType,killedBy:T,deathRate:e[s]>0?c.totalDeaths/e[s]:0,gamesPlayed:e[s]||0})}),Object.entries(e).forEach(([s,c])=>{y[s]||d.push({playerName:n[s]||s,totalDeaths:0,deathsByType:{},killedBy:{},deathRate:0,gamesPlayed:c})});const g=d.sort((s,c)=>c.totalDeaths-s.totalDeaths),S=m.length>0?m[0].type:null,N=D.length>0?D[0].killerName:null;return{totalDeaths:p,totalGames:E,averageDeathsPerGame:B,deathsByType:m,killerStats:D,playerDeathStats:g,mostCommonDeathType:S,mostDeadlyKiller:N}}function G(u,i){const l=u.filter(h=>!h.LegacyData||h.LegacyData.deathInformationFilled===!0),o={},t={},e=l.length,n=[r.BULLET,r.BULLET_HUMAN,r.BULLET_WOLF];l.forEach(h=>{const m=new Set;h.PlayerStats.forEach(f=>{const D=f.MainRoleInitial,y=C(f.MainRoleInitial,f.MainRoleChanges||[]);if(D==="Chasseur"||y==="Chasseur"){const d=R(f);t[d]=f.Username,m.add(d),o[d]||(o[d]={kills:[],gamesPlayed:0,victimsCamps:[],gameVersions:[],gameModded:[]}),o[d].gamesPlayed++}}),h.PlayerStats.forEach(f=>{const D=f.DeathType,y=f.KillerName,d=y?h.PlayerStats.find(S=>S.Username===y):null,g=d?R(d):null;if(g&&d&&(t[g]=d.Username),D&&n.includes(D)&&g&&m.has(g)){const S=L(f.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});o[g].kills.push(D),o[g].victimsCamps.push(S),o[g].gameVersions.push(h.Version),o[g].gameModded.push(h.Modded)}})});const p=Object.entries(o).map(([h,m])=>{const f=m.kills.length,D={};m.kills.forEach(a=>{D[a]=(D[a]||0)+1});const y={};m.victimsCamps.forEach(a=>{y[a]=(y[a]||0)+1});let d=0,g=0;const S={},N={};m.victimsCamps.forEach((a,T)=>{const I=m.gameVersions[T],A=m.gameModded[T];a==="Idiot du Village"?A&&M(I,"0.202")?(g++,N[a]=(N[a]||0)+1):(d++,S[a]=(S[a]||0)+1):a==="Villageois"?(g++,N[a]=(N[a]||0)+1):(d++,S[a]=(S[a]||0)+1)});const s=m.gamesPlayed>0?f/m.gamesPlayed:0,c=m.gamesPlayed>0?d/m.gamesPlayed:0;return{hunterName:t[h]||h,totalKills:f,nonVillageoisKills:d,villageoisKills:g,gamesPlayedAsHunter:m.gamesPlayed,averageKillsPerGame:s,averageNonVillageoisKillsPerGame:c,killsByDeathType:D,victimsByCamp:y,goodVictimsByCamp:S,badVictimsByCamp:N}}).sort((h,m)=>m.totalKills-h.totalKills),E=p.length>0?p[0].hunterName:null,B=p.length>0?p.sort((h,m)=>m.averageNonVillageoisKillsPerGame-h.averageNonVillageoisKillsPerGame)[0].hunterName:null;return{totalHunters:p.length,totalGames:e,hunterStats:p,bestHunter:E,bestAverageHunter:B}}function Z(u,i){const l=[];return u.forEach(o=>{o.PlayerStats.filter(t=>t.DeathPosition!==null).filter(t=>!i||i==="Tous les camps"?!0:L(t.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===i).forEach(t=>{if(t.DeathPosition){const e=L(t.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});l.push({x:t.DeathPosition.x,z:t.DeathPosition.z,playerName:t.Username,deathType:P(t.DeathType),mapName:o.MapName,killerName:t.KillerName||null,camp:e,gameId:o.DisplayedId,displayedGameId:o.DisplayedId})}})}),l}function z(u){const i=new Set;return u.forEach(l=>{l.PlayerStats.some(t=>t.DeathPosition!==null)&&l.MapName&&i.add(l.MapName)}),Array.from(i).sort()}function q(u,i){return V(l=>_(l,u,i))}function J(){return V(u=>b(u))}function Q(u){return V(i=>G(i))}export{q as a,Q as b,j as c,z as d,Z as e,x as g,J as u};
