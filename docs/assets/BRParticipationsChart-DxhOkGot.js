import{a as L,r as S,j as t}from"./index-eHe-rjIr.js";import{F as N,B as R,C as B,X as w,Y as A,a as m,b as x}from"./FullscreenChart-B6qD8r1j.js";import{u as M,a as W}from"./useRawBRData-DOVStjh9.js";import{u as K}from"./useJoueursData-DA9E_9t-.js";import{u as $,g as I}from"./api-B9aH1QUe.js";import{R as D,T as H}from"./CategoricalChart-D_SOyRH3.js";function Q(){const{data:h,isLoading:C,error:u}=M(),{data:p,isLoading:k,error:v}=W(),{settings:n}=L(),{joueursData:F}=K(),[y,g]=S.useState(null),T=$(F),j=["var(--chart-color-1)","var(--chart-color-2)","var(--chart-color-3)","var(--chart-color-4)","var(--chart-color-5)","var(--chart-color-6)"],z=i=>T[i]||I(i),l=S.useMemo(()=>{if(!h||!p)return null;const i=p.length,r=h.length,e=h.filter(a=>a.Gagnant).length,c=h.reduce((a,s)=>{const d=s.Participants;return a[d]||(a[d]={name:d,participations:0,wins:0,totalScore:0,averageScore:0,winRate:0}),a[d].participations++,a[d].totalScore+=s.Score,s.Gagnant&&a[d].wins++,a},{});Object.values(c).forEach(a=>{a.averageScore=a.totalScore/a.participations,a.winRate=a.wins/a.participations*100});const o=Object.values(c).sort((a,s)=>s.participations-a.participations),P=o.slice(0,15),E=n.highlightedPlayer&&P.some(a=>a.name===n.highlightedPlayer);let f=!1,b=[...P];if(n.highlightedPlayer&&!E){const a=o.find(s=>s.name===n.highlightedPlayer);a&&(b.push({...a,isHighlightedAddition:!0}),f=!0)}const G=p.reduce((a,s)=>{const d=s["Nombre de participants"];return a[d]||(a[d]=0),a[d]++,a},{}),q=Object.entries(G).map(([a,s])=>({participants:parseInt(a),games:s,percentage:(s/i*100).toFixed(1)})).sort((a,s)=>a.participants-s.participants);return{totalGames:i,totalParticipations:r,totalWins:e,winRate:(e/r*100).toFixed(1),averageParticipantsPerGame:(r/i).toFixed(1),topPlayersByParticipations:b,participantData:q,highlightedPlayerInParticipations:f}},[h,p,n.highlightedPlayer]);return C||k?t.jsx("div",{className:"statistiques-chargement",children:"Chargement des donn√©es Battle Royale..."}):u||v?t.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",u||v]}):l?t.jsxs("div",{className:"lycans-chart-container",children:[t.jsx("div",{className:"lycans-chart-header",children:t.jsx("h2",{children:"Participations - Battle Royale"})}),t.jsxs("div",{className:"lycans-stats-grid",children:[t.jsxs("div",{className:"lycans-stat-card",children:[t.jsx("h3",{children:"Parties totales"}),t.jsx("div",{className:"lycans-stat-value",children:l.totalGames})]}),t.jsxs("div",{className:"lycans-stat-card",children:[t.jsx("h3",{children:"Participations"}),t.jsx("div",{className:"lycans-stat-value",children:l.totalParticipations})]}),t.jsxs("div",{className:"lycans-stat-card",children:[t.jsx("h3",{children:"Moy. participants/partie"}),t.jsx("div",{className:"lycans-stat-value",children:l.averageParticipantsPerGame})]})]}),t.jsxs("div",{className:"lycans-graphiques-groupe",children:[t.jsxs("div",{className:"lycans-graphique-section",children:[t.jsx("h3",{children:"Participations"}),l.highlightedPlayerInParticipations&&n.highlightedPlayer&&t.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--accent-primary)",margin:"0.5rem 0"},children:["üéØ ",n.highlightedPlayer," affich√© en plus du top 15"]}),t.jsx(N,{title:"Participations - Battle Royale",className:"lycans-chart-wrapper",children:t.jsx(D,{width:"100%",height:400,children:t.jsxs(R,{data:l.topPlayersByParticipations,children:[t.jsx(B,{strokeDasharray:"3 3"}),t.jsx(w,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12,interval:0,tick:({x:i,y:r,payload:e})=>t.jsx("text",{x:i,y:r,dy:16,textAnchor:"end",fill:n.highlightedPlayer===e.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:n.highlightedPlayer===e.value?14:12,fontWeight:n.highlightedPlayer===e.value?"bold":"normal",transform:`rotate(-45 ${i} ${r})`,children:e.value})}),t.jsx(A,{}),t.jsx(H,{content:({active:i,payload:r})=>{if(i&&r&&r.length>0){const e=r[0].payload,c=e.isHighlightedAddition,o=n.highlightedPlayer===e.name;return t.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:"12px",borderRadius:"8px",border:"1px solid var(--border-color)",boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},children:[t.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem"},children:[e.name,o&&" üéØ"]}),t.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.5"},children:[t.jsxs("div",{children:["Participations: ",t.jsx("strong",{children:e.participations})]}),t.jsxs("div",{children:["Victoires: ",t.jsx("strong",{children:e.wins})]}),t.jsxs("div",{children:["Taux de victoire: ",t.jsxs("strong",{children:[e.winRate.toFixed(1),"%"]})]})]}),c&&t.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"8px",fontStyle:"italic",paddingTop:"8px",borderTop:"1px solid var(--border-color)"},children:"üéØ Affich√© via s√©lection (hors top 15)"})]})}return null}}),t.jsx(m,{dataKey:"participations",name:"Participations",children:l.topPlayersByParticipations.map((i,r)=>{const e=n.highlightedPlayer===i.name,c=y===i.name,o=i.isHighlightedAddition;return t.jsx(x,{fill:e?"var(--accent-primary)":o?"var(--accent-secondary)":z(i.name),stroke:e?"var(--accent-primary)":c?"var(--text-primary)":"none",strokeWidth:e?3:c?2:0,strokeDasharray:o?"5,5":"none",opacity:o?.8:1,onMouseEnter:()=>g(i.name),onMouseLeave:()=>g(null),style:{cursor:"pointer"}},`cell-${r}`)})}),t.jsx(m,{dataKey:"wins",fill:"var(--chart-color-2)",name:"Victoires",children:l.topPlayersByParticipations.map((i,r)=>{const e=n.highlightedPlayer===i.name,c=y===i.name,o=i.isHighlightedAddition;return t.jsx(x,{fill:e?"var(--accent-primary)":o?"var(--accent-secondary)":"var(--chart-color-2)",stroke:e?"var(--accent-primary)":c?"var(--text-primary)":"none",strokeWidth:e?3:c?2:0,strokeDasharray:o?"5,5":"none",opacity:o?.8:1,onMouseEnter:()=>g(i.name),onMouseLeave:()=>g(null),style:{cursor:"pointer"}},`cell-${r}`)})})]})})})]}),t.jsxs("div",{className:"lycans-graphique-section",children:[t.jsx("h3",{children:"R√©partition par Nombre de Participants"}),t.jsx(N,{title:"R√©partition par Nombre de Participants - Battle Royale",className:"lycans-chart-wrapper",children:t.jsx(D,{width:"100%",height:400,children:t.jsxs(R,{data:l.participantData,margin:{bottom:15},children:[t.jsx(B,{strokeDasharray:"3 3"}),t.jsx(w,{dataKey:"participants",label:{value:"Nombre de participants",position:"insideBottom",offset:-5}}),t.jsx(A,{}),t.jsx(H,{content:({active:i,payload:r})=>{if(i&&r&&r.length>0){const e=r[0].payload;return t.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:"12px",borderRadius:"8px",border:"1px solid var(--border-color)",boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},children:[t.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem"},children:[e.participants," ",e.participants===1?"participant":"participants"]}),t.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.5"},children:[t.jsxs("div",{children:["Nombre de parties: ",t.jsx("strong",{children:e.games})]}),t.jsxs("div",{children:["Pourcentage: ",t.jsxs("strong",{children:[e.percentage,"%"]})]})]})]})}return null}}),t.jsx(m,{dataKey:"games",name:"Nombre de parties",children:l.participantData.map((i,r)=>t.jsx(x,{fill:j[r%j.length]},`cell-${r}`))})]})})})]})]})]}):t.jsx("div",{className:"statistiques-vide",children:"Aucune donn√©e Battle Royale disponible"})}export{Q as BRParticipationsChart};
