import{u as U,a as _,r as M,j as e,d as ae}from"./index-C-ZULyY2.js";import{g as X,a as Z,u as re,b as se,c as le,d as ne}from"./useDeathStatisticsFromRaw-CjfKhRkw.js";import{u as oe}from"./baseStatsHook-CNba4Zlz.js";import{g as ce,D as E}from"./datasyncExport-D6_8Fmuy.js";import{m as Y,a as ee,u as te}from"./api-8K_w8ath.js";import{D as C}from"./deathTypes-CGUOTngO.js";import{F as W,B as F,C as V,X as q,Y as O,a as G,b as J}from"./FullscreenChart-nTpy9jQQ.js";import{R as $,T as w}from"./CategoricalChart-sckzBPcI.js";import{u as ie}from"./useJoueursData-7BIbKuX8.js";function Q(n){if(!n||n.trim()==="")return null;const g=n.trim().slice(1),f=parseInt(g,10);return isNaN(f)||f<1?null:f}function de(n,S){if(n.length===0)return null;const g=n.filter(l=>!l.LegacyData||l.LegacyData.deathInformationFilled===!0);if(g.length===0)return null;const f={},c={};g.forEach(l=>{let y=1;if(l.EndTiming){const m=Q(l.EndTiming);m&&(y=m)}l.PlayerStats.forEach(m=>{if(S&&S!=="Tous les camps"&&ce(m.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})!==S)return;const H=m.Username;f[H]||(f[H]={playerName:H,totalGames:0,survivalsByDay:{},survivalRatesByDay:{},gamesPlayedByDay:{}});const A=f[H];A.totalGames++;let K=null;m.DeathTiming&&(K=Q(m.DeathTiming));for(let T=1;T<=y;T++)A.gamesPlayedByDay[T]||(A.gamesPlayedByDay[T]=0,A.survivalsByDay[T]=0),c[T]||(c[T]={gamesReachingDay:0,playersOnDay:0,survivorsOnDay:0}),A.gamesPlayedByDay[T]++,c[T].playersOnDay++,(!K||K>T)&&(A.survivalsByDay[T]++,c[T].survivorsOnDay++)});for(let m=1;m<=y;m++)c[m]||(c[m]={gamesReachingDay:0,playersOnDay:0,survivorsOnDay:0}),c[m].gamesReachingDay++}),Object.values(f).forEach(l=>{Object.keys(l.gamesPlayedByDay).forEach(y=>{const m=parseInt(y),H=l.gamesPlayedByDay[m],A=l.survivalsByDay[m];H>0?l.survivalRatesByDay[m]=A/H*100:l.survivalRatesByDay[m]=0})});const z=Object.values(f).filter(l=>l.totalGames>0).sort((l,y)=>y.totalGames-l.totalGames),k=Object.entries(c).map(([l,y])=>({dayNumber:parseInt(l),totalGamesReachingDay:y.gamesReachingDay,totalPlayersOnDay:y.playersOnDay,averageSurvivalRate:y.playersOnDay>0?y.survivorsOnDay/y.playersOnDay*100:0})).sort((l,y)=>l.dayNumber-y.dayNumber);return{totalGames:g.length,totalPlayersAnalyzed:z.length,playerSurvivalStats:z,dayStats:k}}function he(n,S,g=10){return n.playerSurvivalStats.filter(f=>(f.gamesPlayedByDay[S]||0)>=g).map(f=>({playerName:f.playerName,survivalRate:f.survivalRatesByDay[S]||0,gamesPlayed:f.totalGames,timesReachedDay:f.gamesPlayedByDay[S]||0,timesSurvivedDay:f.survivalsByDay[S]||0})).sort((f,c)=>c.survivalRate-f.survivalRate).slice(0,15)}function ge(n,S,g=10){return n.playerSurvivalStats.filter(f=>(f.gamesPlayedByDay[S]||0)>=g).map(f=>({playerName:f.playerName,survivalRate:f.survivalRatesByDay[S]||0,gamesPlayed:f.totalGames,timesReachedDay:f.gamesPlayedByDay[S]||0,timesSurvivedDay:f.survivalsByDay[S]||0})).sort((f,c)=>f.survivalRate-c.survivalRate).slice(0,15)}function me(n){return oe(S=>de(S,n))}function ue({deathStats:n,selectedCamp:S,victimCampFilter:g,minGamesForAverage:f,onMinGamesChange:c,availableDeathTypes:z,deathTypeColors:k,totalEligibleForAverage:l}){const{navigateToGameDetails:y}=U(),{settings:m}=_(),H=r=>{if(g==="Tous les camps"){const t=r.filter(i=>i!==C.BULLET_HUMAN&&i!==C.BULLET_WOLF);return(r.includes(C.BULLET_HUMAN)||r.includes(C.BULLET_WOLF))&&!t.includes(C.BULLET)&&t.push(C.BULLET),t}return r},A=M.useMemo(()=>H(z),[z,g]),K=M.useMemo(()=>{const r={...k};if(g==="Tous les camps"&&!r[C.BULLET]){const t=k[C.BULLET_HUMAN]||k[C.BULLET_WOLF];t&&(r[C.BULLET]=t)}return r},[k,g]),T=r=>{if(g==="Tous les camps"){const t=r.killsByDeathType[C.BULLET_HUMAN]||0,i=r.killsByDeathType[C.BULLET_WOLF]||0,s=r.killsByDeathType[C.BULLET]||0,v={...r.killsByDeathType};return v[C.BULLET]=t+i+s,delete v[C.BULLET_HUMAN],delete v[C.BULLET_WOLF],{...r,killsByDeathType:v}}return r},p=r=>{let t="Top Tueurs";return S!=="Tous les camps"&&(t+=` en ${S}`),g!=="Tous les camps"&&(g==="Roles solo"?t+=" (victimes: Roles solo)":t+=` (victimes: ${g})`),r==="total"?t+=" (Total)":t+=" (Moyenne par Partie)",t},{totalKillsData:h,averageKillsData:o,highlightedPlayerAddedToTotal:x,highlightedPlayerAddedToAverage:D}=M.useMemo(()=>{if(!n)return{totalKillsData:[],averageKillsData:[],highlightedPlayerAddedToTotal:!1,highlightedPlayerAddedToAverage:!1};const r=n.killerStats.sort((d,u)=>u.kills-d.kills).slice(0,15),t=m.highlightedPlayer&&r.some(d=>d.killerName===m.highlightedPlayer),i=r.map(d=>{const u=T(d),B={name:u.killerName,value:u.kills,victims:u.victims.length,percentage:u.percentage,gamesPlayed:u.gamesPlayed,averageKillsPerGame:u.averageKillsPerGame,isHighlightedAddition:!1};return A.forEach(P=>{B[P]=u.killsByDeathType[P]||0}),B});let s=!1;if(m.highlightedPlayer&&!t){const d=n.killerStats.find(u=>u.killerName===m.highlightedPlayer);if(d){const u=T(d),B={name:u.killerName,value:u.kills,victims:u.victims.length,percentage:u.percentage,gamesPlayed:u.gamesPlayed,averageKillsPerGame:u.averageKillsPerGame,isHighlightedAddition:!0};A.forEach(P=>{B[P]=u.killsByDeathType[P]||0}),i.push(B),s=!0}}const a=n.killerStats.filter(d=>d.gamesPlayed>=f).sort((d,u)=>u.averageKillsPerGame-d.averageKillsPerGame).slice(0,15),b=m.highlightedPlayer&&a.some(d=>d.killerName===m.highlightedPlayer),R=a.map(d=>{const u=T(d),B={name:u.killerName,value:u.averageKillsPerGame,victims:u.victims.length,percentage:u.percentage,gamesPlayed:u.gamesPlayed,averageKillsPerGame:u.averageKillsPerGame,isHighlightedAddition:!1};return A.forEach(P=>{const I=u.killsByDeathType[P]||0;B[P]=u.gamesPlayed>0?I/u.gamesPlayed:0}),B});let L=!1;if(m.highlightedPlayer&&!b){const d=n.killerStats.find(u=>u.killerName===m.highlightedPlayer);if(d){const u=T(d),B={name:u.killerName,value:u.averageKillsPerGame,victims:u.victims.length,percentage:u.percentage,gamesPlayed:u.gamesPlayed,averageKillsPerGame:u.averageKillsPerGame,isHighlightedAddition:!0};A.forEach(P=>{const I=u.killsByDeathType[P]||0;B[P]=u.gamesPlayed>0?I/u.gamesPlayed:0}),R.push(B),L=!0}}return{totalKillsData:i,averageKillsData:R,highlightedPlayerAddedToTotal:s,highlightedPlayerAddedToAverage:L}},[n,m.highlightedPlayer,f,A,g]),j=({active:r,payload:t,label:i})=>{if(r&&t&&t.length){const s=t[0].payload,v=s.isHighlightedAddition,a=m.highlightedPlayer===s.name,b=A.reduce((R,L)=>R+(s[L]||0),0);return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:a?"var(--accent-primary)":"var(--text-primary)"},children:[i,v&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Victimes totales:"})," ",b]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouÃ©es:"})," ",s.gamesPlayed]}),e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"RÃ©partition par type de kill:"}),A.map(R=>({deathType:R,count:s[R]||0})).filter(R=>R.count>0).sort((R,L)=>L.count-R.count).map(({deathType:R,count:L})=>e.jsxs("p",{style:{color:K[R],margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[X(R),":"]})," ",L]},R))]}),v&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"}),a&&!v&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},N=({active:r,payload:t,label:i})=>{if(r&&t&&t.length){const s=t[0].payload,v=s.isHighlightedAddition,a=m.highlightedPlayer===s.name,b=s.gamesPlayed>=f,R=n?.killerStats.find(B=>B.killerName===s.name),L=R?T(R):null,d=A.reduce((B,P)=>B+(s[P]||0),0),u=L?L.kills:Math.round(d*s.gamesPlayed);return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:a?"var(--accent-primary)":"var(--text-primary)"},children:[i,v&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Moyenne par partie:"})," ",d.toFixed(2)," (",u," kills /",s.gamesPlayed," games)"]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouÃ©es:"})," ",s.gamesPlayed]}),e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"RÃ©partition par type de kill (moyenne):"}),A.map(B=>({deathType:B,avgCount:s[B]||0,totalKillsForDeathType:L?L.killsByDeathType[B]||0:Math.round((s[B]||0)*s.gamesPlayed)})).filter(B=>B.avgCount>0).sort((B,P)=>P.avgCount-B.avgCount).map(({deathType:B,avgCount:P,totalKillsForDeathType:I})=>e.jsxs("p",{style:{color:K[B],margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[X(B),":"]})," ",P.toFixed(2)," (",I," kills /",s.gamesPlayed," games)"]},B))]}),v&&!b&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",f," parties)"]}),v&&b&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"}),a&&!v&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null};return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:p("total")}),x&&m.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',m.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(W,{title:p("total"),children:e.jsx("div",{style:{height:440},children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(F,{data:h,margin:{top:60,right:30,left:20,bottom:10},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:r,y:t,payload:i})=>e.jsx("text",{x:r,y:t,dy:10,fill:m.highlightedPlayer===i.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:m.highlightedPlayer===i.value?14:12,fontWeight:m.highlightedPlayer===i.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${r} ${t})`,children:i.value})}),e.jsx(O,{label:{value:"Nombre total de victimes",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(j,{})}),A.map(r=>e.jsx(G,{dataKey:r,name:r,stackId:"kills",fill:K[r],onClick:t=>{const i={selectedPlayer:t?.name,fromComponent:"Statistiques de Mort"};S!=="Tous les camps"&&(i.campFilter={selectedCamp:S,campFilterMode:"all-assignments"}),y(i)}},r))]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,h.filter(r=>!r.isHighlightedAddition).length)," des tueurs les plus actifs (total)"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:p("average")}),D&&m.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',m.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"min-games-average-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-average-select",value:f,onChange:r=>c(Number(r.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:Y.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsx(W,{title:p("average"),children:e.jsx("div",{style:{height:400},children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(F,{data:o,margin:{top:20,right:30,left:20,bottom:10},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:r,y:t,payload:i})=>e.jsx("text",{x:r,y:t,dy:10,fill:m.highlightedPlayer===i.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:m.highlightedPlayer===i.value?14:12,fontWeight:m.highlightedPlayer===i.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${r} ${t})`,children:i.value})}),e.jsx(O,{label:{value:"Moyenne de victimes par partie",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(N,{})}),A.map(r=>e.jsx(G,{dataKey:r,name:r,stackId:"averageKills",fill:K[r],onClick:t=>{const i={selectedPlayer:t?.name,fromComponent:"Statistiques de Mort"};S!=="Tous les camps"&&(i.campFilter={selectedCamp:S,campFilterMode:"all-assignments"}),y(i)}},r))]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,o.filter(r=>!r.isHighlightedAddition).length)," des tueurs les plus efficaces (sur ",l," ayant au moins ",f," partie",f>1?"s":"",")"]})]})]})}function ye({deathStats:n,selectedCamp:S,minGamesForAverage:g,onMinGamesChange:f,availableDeathTypes:c,deathTypeColors:z}){const{navigateToGameDetails:k}=U(),{settings:l}=_(),{totalDeathsData:y,survivalRateData:m,highlightedPlayerAddedToDeaths:H,highlightedPlayerAddedToSurvival:A}=M.useMemo(()=>{if(!n)return{totalDeathsData:[],survivalRateData:[],highlightedPlayerAddedToDeaths:!1,highlightedPlayerAddedToSurvival:!1};const p=n.playerDeathStats.sort((i,s)=>s.totalDeaths-i.totalDeaths).slice(0,15),h=l.highlightedPlayer&&p.some(i=>i.playerName===l.highlightedPlayer),o=p.map(i=>{const s=i.gamesPlayed,v=s>0?(s-i.totalDeaths)/s*100:0,a={name:i.playerName,value:i.totalDeaths,totalDeaths:i.totalDeaths,gamesPlayed:s,deathRate:i.deathRate,survivalRate:v,isHighlightedAddition:!1};return c.forEach(b=>{a[b]=i.deathsByType[b]||0}),a});let x=!1;if(l.highlightedPlayer&&!h){const i=n.playerDeathStats.find(s=>s.playerName===l.highlightedPlayer);if(i){const s=i.gamesPlayed,v=s>0?(s-i.totalDeaths)/s*100:0,a={name:i.playerName,value:i.totalDeaths,totalDeaths:i.totalDeaths,gamesPlayed:s,deathRate:i.deathRate,survivalRate:v,isHighlightedAddition:!0};c.forEach(b=>{a[b]=i.deathsByType[b]||0}),o.push(a),x=!0}}const j=n.playerDeathStats.filter(i=>i.gamesPlayed>=g).map(i=>({...i,survivalRate:i.gamesPlayed>0?(i.gamesPlayed-i.totalDeaths)/i.gamesPlayed*100:0})).sort((i,s)=>s.survivalRate-i.survivalRate).slice(0,15),N=l.highlightedPlayer&&j.some(i=>i.playerName===l.highlightedPlayer),r=j.map(i=>{const s={name:i.playerName,value:i.survivalRate,totalDeaths:i.totalDeaths,gamesPlayed:i.gamesPlayed,deathRate:i.deathRate,survivalRate:i.survivalRate,isHighlightedAddition:!1};return c.forEach(v=>{const a=i.deathsByType[v]||0;s[v]=i.gamesPlayed>0?a/i.gamesPlayed*100:0}),s});let t=!1;if(l.highlightedPlayer&&!N){const i=n.playerDeathStats.find(s=>s.playerName===l.highlightedPlayer);if(i){const s=i.gamesPlayed>0?(i.gamesPlayed-i.totalDeaths)/i.gamesPlayed*100:0,v={name:i.playerName,value:s,totalDeaths:i.totalDeaths,gamesPlayed:i.gamesPlayed,deathRate:i.deathRate,survivalRate:s,isHighlightedAddition:!0};c.forEach(a=>{const b=i.deathsByType[a]||0;v[a]=i.gamesPlayed>0?b/i.gamesPlayed*100:0}),r.push(v),t=!0}}return{totalDeathsData:o,survivalRateData:r,highlightedPlayerAddedToDeaths:x,highlightedPlayerAddedToSurvival:t}},[n,l.highlightedPlayer,g,c]),K=({active:p,payload:h,label:o})=>{if(p&&h&&h.length){const x=h[0].payload,D=x.isHighlightedAddition,j=l.highlightedPlayer===x.name,N=c.reduce((r,t)=>r+(x[t]||0),0);return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:j?"var(--accent-primary)":"var(--text-primary)"},children:[o,D&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Morts totales:"})," ",N]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouÃ©es:"})," ",x.gamesPlayed]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Taux de survie:"})," ",x.survivalRate.toFixed(1),"%"]}),e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"RÃ©partition par type de mort:"}),c.map(r=>{const t=x[r]||0;return t===0?null:e.jsxs("p",{style:{color:z[r],margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[Z(r),":"]})," ",t]},r)})]}),D&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"}),j&&!D&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},T=({active:p,payload:h,label:o})=>{if(p&&h&&h.length){const x=h[0].payload,D=x.isHighlightedAddition,j=l.highlightedPlayer===x.name,N=x.gamesPlayed>=g;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:j?"var(--accent-primary)":"var(--text-primary)"},children:[o,D&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Taux de survie:"})," ",x.survivalRate.toFixed(1),"% (",x.gamesPlayed-x.totalDeaths," survies / ",x.gamesPlayed," parties)"]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Morts totales:"})," ",x.totalDeaths]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouÃ©es:"})," ",x.gamesPlayed]}),e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"RÃ©partition par type de mort (taux %):"}),c.map(r=>{const t=x[r]||0;return t===0?null:e.jsxs("p",{style:{color:z[r],margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[Z(r),":"]})," ",t.toFixed(1),"%"]},r)})]}),D&&!N&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",g," parties)"]}),D&&N&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"}),j&&!D&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null};return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:S==="Tous les camps"?"Morts (Total)":`Morts en ${S} (Total)`}),H&&l.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',l.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(W,{title:S==="Tous les camps"?"Morts (Total)":`Morts en ${S} (Total)`,children:e.jsx("div",{style:{height:440},children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(F,{data:y,margin:{top:60,right:30,left:20,bottom:10},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:p,y:h,payload:o})=>e.jsx("text",{x:p,y:h,dy:10,fill:l.highlightedPlayer===o.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:l.highlightedPlayer===o.value?14:12,fontWeight:l.highlightedPlayer===o.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${p} ${h})`,children:o.value})}),e.jsx(O,{label:{value:"Nombre total de morts",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(K,{})}),c.map(p=>e.jsx(G,{dataKey:p,name:p,stackId:"deaths",fill:z[p],onClick:h=>{const o={selectedPlayer:h?.name,fromComponent:"Statistiques de Mort"};S!=="Tous les camps"&&(o.campFilter={selectedCamp:S,campFilterMode:"all-assignments"}),k(o)}},p))]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,y.filter(p=>!p.isHighlightedAddition).length)," des joueurs les plus souvent morts"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsxs("h3",{children:["Meilleurs Survivants ",S==="Tous les camps"?"(Total)":` en ${S}`]}),A&&l.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',l.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"min-games-survival-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-survival-select",value:g,onChange:p=>f(Number(p.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:Y.map(p=>e.jsx("option",{value:p,children:p},p))})]}),e.jsx(W,{title:"Meilleurs Survivants",children:e.jsx("div",{style:{height:400},children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(F,{data:m,margin:{top:20,right:30,left:20,bottom:10},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:p,y:h,payload:o})=>e.jsx("text",{x:p,y:h,dy:10,fill:l.highlightedPlayer===o.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:l.highlightedPlayer===o.value?14:12,fontWeight:l.highlightedPlayer===o.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${p} ${h})`,children:o.value})}),e.jsx(O,{label:{value:"Taux de survie (%)",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(T,{})}),c.map(p=>e.jsx(G,{dataKey:p,name:p,stackId:"survivalRate",fill:z[p],onClick:h=>{const o={selectedPlayer:h?.name,fromComponent:"Statistiques de Mort"};S!=="Tous les camps"&&(o.campFilter={selectedCamp:S,campFilterMode:"all-assignments"}),k(o)}},p))]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,m.filter(p=>!p.isHighlightedAddition).length)," des joueurs avec le plus haut taux de survie (ayant au moins ",g," partie",g>1?"s":"",")"]})]})]})}function ve({hunterStats:n,isLoading:S,error:g}){const{navigateToGameDetails:f}=U(),{settings:c}=_(),z=ee(),{joueursData:k}=ie(),l=te(k),[y,m]=M.useState(null);if(S)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques chasseurs..."});if(g)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]});if(!n||n.hunterStats.length===0)return e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e Chasseur"}),e.jsx("p",{children:"Aucune statistique de chasseur disponible avec les filtres actuels."})]});const{finalBestHuntersData:H,highlightedPlayerAddedToBest:A,finalBadHuntersData:K,highlightedPlayerAddedToBad:T}=(()=>{const x=n.hunterStats.filter(a=>a.gamesPlayedAsHunter>=5).sort((a,b)=>b.averageNonVillageoisKillsPerGame-a.averageNonVillageoisKillsPerGame).slice(0,15),D=c.highlightedPlayer&&x.some(a=>a.hunterName===c.highlightedPlayer);let j=[...x],N=!1;if(c.highlightedPlayer&&!D){const a=n.hunterStats.find(b=>b.hunterName===c.highlightedPlayer);a&&(j.push({...a,isHighlightedAddition:!0}),N=!0)}const r=n.hunterStats.filter(a=>a.gamesPlayedAsHunter>=5).map(a=>({name:a.hunterName,averageVillageoisKills:Number((a.villageoisKills/a.gamesPlayedAsHunter).toFixed(2)),totalVillageoisKills:a.villageoisKills,totalNonVillageoisKills:a.nonVillageoisKills,totalKills:a.totalKills,gamesPlayed:a.gamesPlayedAsHunter,victimsByCamp:a.victimsByCamp,goodVictimsByCamp:a.goodVictimsByCamp,badVictimsByCamp:a.badVictimsByCamp,hunterName:a.hunterName})),t=r.sort((a,b)=>b.averageVillageoisKills-a.averageVillageoisKills).slice(0,15),i=c.highlightedPlayer&&t.some(a=>a.hunterName===c.highlightedPlayer);let s=[...t],v=!1;if(c.highlightedPlayer&&!i){const a=r.find(b=>b.hunterName===c.highlightedPlayer);a&&(s.push({...a,isHighlightedAddition:!0}),v=!0)}return{finalBestHuntersData:j,highlightedPlayerAddedToBest:N,finalBadHuntersData:s,highlightedPlayerAddedToBad:v}})(),p=({active:o,payload:x,label:D})=>{if(o&&x&&x.length){const j=x[0].payload,N=j.isHighlightedAddition,r=c.highlightedPlayer===j.hunterName;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:r?"var(--accent-primary)":"var(--text-primary)"},children:[D,N&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Kills non-Villageois/partie:"})," ",j.averageNonVillageoisKillsPerGame.toFixed(2)]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Total non-Villageois tuÃ©s:"})," ",j.nonVillageoisKills]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties en Chasseur:"})," ",j.gamesPlayedAsHunter]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Total kills:"})," ",j.totalKills]}),j.goodVictimsByCamp&&Object.keys(j.goodVictimsByCamp).length>0&&e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"Bonnes victimes:"}),Object.entries(j.goodVictimsByCamp).map(([t,i])=>e.jsxs("p",{style:{color:z[t]||"var(--text-secondary)",margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[t,":"]})," ",i]},t))]}),N&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"}),r&&!N&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},h=({active:o,payload:x,label:D})=>{if(o&&x&&x.length){const j=x[0].payload,N=j.isHighlightedAddition,r=c.highlightedPlayer===j.hunterName;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:r?"var(--accent-primary)":"var(--text-primary)"},children:[D,N&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Villageois tuÃ©s/partie:"})," ",j.averageVillageoisKills]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Total Villageois tuÃ©s:"})," ",j.totalVillageoisKills]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Total non-Villageois tuÃ©s:"})," ",j.totalNonVillageoisKills]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties en Chasseur:"})," ",j.gamesPlayed]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Total kills:"})," ",j.totalKills]}),j.badVictimsByCamp&&Object.keys(j.badVictimsByCamp).length>0&&e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"Mauvaises victimes:"}),Object.entries(j.badVictimsByCamp).map(([t,i])=>e.jsxs("p",{style:{color:z[t]||"var(--text-secondary)",margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[t,":"]})," ",i]},t))]}),N&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"}),r&&!N&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null};return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Bons Chasseurs"}),A&&c.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',c.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(W,{title:"Bons Chasseurs",children:e.jsx("div",{style:{height:440},children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(F,{data:H,margin:{top:60,right:30,left:20,bottom:10},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"hunterName",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:o,y:x,payload:D})=>e.jsx("text",{x:o,y:x,dy:10,fill:c.highlightedPlayer===D.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:c.highlightedPlayer===D.value?14:12,fontWeight:c.highlightedPlayer===D.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${o} ${x})`,children:D.value})}),e.jsx(O,{label:{value:"Moyenne kills non-Villageois/partie",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(p,{})}),e.jsx(G,{dataKey:"averageNonVillageoisKillsPerGame",fill:"var(--chart-primary)",onClick:o=>{o?.hunterName&&f({selectedPlayer:o.hunterName,campFilter:{selectedCamp:"Chasseur",campFilterMode:"all-assignments"},fromComponent:"Statistiques de Mort - Bons Chasseurs"})},onMouseEnter:o=>m(o?.hunterName||null),onMouseLeave:()=>m(null),style:{cursor:"pointer"},children:H.map((o,x)=>{const D=c.highlightedPlayer===o.hunterName,j=o.isHighlightedAddition;return e.jsx(J,{fill:l[o.hunterName]||z.Chasseur||"#8884d8",stroke:D?"var(--accent-primary)":y===o.hunterName?"var(--text-primary)":"none",strokeWidth:D?3:y===o.hunterName?2:0,strokeDasharray:j?"5,5":"none",opacity:j?.8:1},`cell-${x}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,H.filter(o=>!o.isHighlightedAddition).length)," des chasseurs les plus efficaces contre les non-Villageois (minimum 5 parties en Chasseur)"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Mauvais Chasseurs"}),T&&c.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',c.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(W,{title:"Mauvais Chasseurs",children:e.jsx("div",{style:{height:440},children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(F,{data:K,margin:{top:60,right:30,left:20,bottom:10},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"hunterName",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:o,y:x,payload:D})=>e.jsx("text",{x:o,y:x,dy:10,fill:c.highlightedPlayer===D.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:c.highlightedPlayer===D.value?14:12,fontWeight:c.highlightedPlayer===D.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${o} ${x})`,children:D.value})}),e.jsx(O,{label:{value:"Moyenne Villageois tuÃ©s/partie",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(h,{})}),e.jsx(G,{dataKey:"averageVillageoisKills",fill:"var(--chart-primary)",onClick:o=>{o?.hunterName&&f({selectedPlayer:o.hunterName,campFilter:{selectedCamp:"Chasseur",campFilterMode:"all-assignments"},fromComponent:"Statistiques de Mort - Mauvais Chasseurs"})},onMouseEnter:o=>m(o?.hunterName||null),onMouseLeave:()=>m(null),style:{cursor:"pointer"},children:K.map((o,x)=>{const D=c.highlightedPlayer===o.hunterName,j=o.isHighlightedAddition;return e.jsx(J,{fill:l[o.hunterName]||z.Chasseur||"#8884d8",stroke:D?"var(--accent-primary)":y===o.hunterName?"var(--text-primary)":"none",strokeWidth:D?3:y===o.hunterName?2:0,strokeDasharray:j?"5,5":"none",opacity:j?.8:1},`cell-${x}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,K.filter(o=>!o.isHighlightedAddition).length)," des chasseurs ayant le plus tuÃ© de Villageois (minimum 5 parties en Chasseur)"]})]})]})}function pe({survivalStats:n,selectedCamp:S,minGamesForAverage:g,onMinGamesChange:f,isLoading:c,error:z}){const{navigateToGameDetails:k}=U(),{settings:l}=_(),{joueursData:y}=ie(),m=te(y),[H,A]=M.useState(1),[K,T]=M.useState(null),p=M.useMemo(()=>n?n.dayStats.filter(i=>i.totalGamesReachingDay>0).map(i=>i.dayNumber).sort((i,s)=>i-s):[],[n]),h=M.useMemo(()=>p.includes(H)?H:p.length>0?p[0]:1,[H,p]),{highestSurvivalData:o,highlightedPlayerAddedToHighest:x}=M.useMemo(()=>{if(!n)return{highestSurvivalData:[],highlightedPlayerAddedToHighest:!1};const t=he(n,h,g),i=l.highlightedPlayer&&t.some(a=>a.playerName===l.highlightedPlayer),s=t.map(a=>({name:a.playerName,value:a.survivalRate,gamesPlayed:a.gamesPlayed,timesReachedDay:a.timesReachedDay,timesSurvivedDay:a.timesSurvivedDay,isHighlightedAddition:!1}));let v=!1;if(l.highlightedPlayer&&!i){const a=n.playerSurvivalStats.find(b=>b.playerName===l.highlightedPlayer);if(a&&(a.gamesPlayedByDay[h]||0)>=1){const b=a.survivalRatesByDay[h]||0;s.push({name:l.highlightedPlayer,value:b,gamesPlayed:a.totalGames,timesReachedDay:a.gamesPlayedByDay[h]||0,timesSurvivedDay:a.survivalsByDay[h]||0,isHighlightedAddition:!0}),v=!0}}return{highestSurvivalData:s,highlightedPlayerAddedToHighest:v}},[n,h,g,l.highlightedPlayer]),{lowestSurvivalData:D,highlightedPlayerAddedToLowest:j}=M.useMemo(()=>{if(!n)return{lowestSurvivalData:[],highlightedPlayerAddedToLowest:!1};const t=ge(n,h,g),i=l.highlightedPlayer&&t.some(a=>a.playerName===l.highlightedPlayer),s=t.map(a=>({name:a.playerName,value:a.survivalRate,gamesPlayed:a.gamesPlayed,timesReachedDay:a.timesReachedDay,timesSurvivedDay:a.timesSurvivedDay,isHighlightedAddition:!1}));let v=!1;if(l.highlightedPlayer&&!i){const a=n.playerSurvivalStats.find(b=>b.playerName===l.highlightedPlayer);if(a&&(a.gamesPlayedByDay[h]||0)>=1){const b=a.survivalRatesByDay[h]||0;s.push({name:l.highlightedPlayer,value:b,gamesPlayed:a.totalGames,timesReachedDay:a.gamesPlayedByDay[h]||0,timesSurvivedDay:a.survivalsByDay[h]||0,isHighlightedAddition:!0}),v=!0}}return{lowestSurvivalData:s,highlightedPlayerAddedToLowest:v}},[n,h,g,l.highlightedPlayer]),N=t=>{k({selectedPlayer:t,fromComponent:"Statistiques de Survie"})},r=({active:t,payload:i,label:s})=>{if(t&&i&&i.length>0){const v=i[0].payload,a=v.isHighlightedAddition,b=l.highlightedPlayer===v.name,R=v.timesReachedDay>=g;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:s})}),e.jsx("div",{children:e.jsxs("span",{style:{color:"var(--accent-primary)"},children:["Taux de survie Jour ",h,": ",v.value.toFixed(1),"%"]})}),e.jsxs("div",{children:["Parties atteignant le Jour ",h,": ",v.timesReachedDay]}),e.jsxs("div",{children:["A survÃ©cu au Jour ",h,": ",v.timesSurvivedDay]}),e.jsxs("div",{children:["Total de parties: ",v.gamesPlayed]}),a&&!R&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",g," parties ce jour)"]}),a&&R&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"}),b&&!a&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null};return c?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de survie..."}):z?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",z]}):n?e.jsxs("div",{className:"lycans-survival-stats",children:[e.jsx("div",{className:"lycans-graphique-controles",style:{marginBottom:"1.5rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"day-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Jour :"}),e.jsx("select",{id:"day-select",value:h,onChange:t=>A(parseInt(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"80px"},children:p.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"min-games-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Min. parties :"}),e.jsx("select",{id:"min-games-select",value:g,onChange:t=>f(parseInt(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"80px"},children:Y.map(t=>e.jsx("option",{value:t,children:t},t))})]})]})}),h&&n.dayStats.find(t=>t.dayNumber===h)&&e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsxs("h3",{children:["Parties atteignant le Jour ",h]}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary)"},children:n.dayStats.find(t=>t.dayNumber===h)?.totalGamesReachingDay||0})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsxs("h3",{children:["Taux de survie moyen Jour ",h]}),e.jsxs("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)"},children:[(n.dayStats.find(t=>t.dayNumber===h)?.averageSurvivalRate||0).toFixed(1),"%"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsxs("h3",{children:["Joueurs Ã©ligibles (min. ",g," parties)"]}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-1)"},children:n.playerSurvivalStats.filter(t=>(t.gamesPlayedByDay[h]||0)>=g).length})]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsxs("h3",{children:["ðŸ›¡ï¸ Meilleurs Taux de Survie - Jour ",h]}),x&&l.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',l.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(W,{title:`ðŸ›¡ï¸ Meilleurs Taux de Survie - Jour ${h}`,children:e.jsx("div",{style:{height:400},children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(F,{data:o,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(V,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(q,{dataKey:"name",angle:-45,textAnchor:"end",height:80,tick:({x:t,y:i,payload:s})=>e.jsx("text",{x:t,y:i,dy:16,textAnchor:"end",transform:`rotate(-45, ${t}, ${i})`,fill:l.highlightedPlayer===s.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:l.highlightedPlayer===s.value?14:12,fontWeight:l.highlightedPlayer===s.value?"bold":"normal",children:s.value})}),e.jsx(O,{tickFormatter:t=>`${t.toFixed(0)}%`,tick:{fill:"var(--text-secondary)"},label:{value:"Taux de survie (%)",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(r,{})}),e.jsx(G,{dataKey:"value",name:"Taux de survie",cursor:"pointer",children:o.map((t,i)=>{const s=l.highlightedPlayer===t.name,v=K===t.name,a=t.isHighlightedAddition;return e.jsx(J,{fill:m[t.name]||"var(--chart-primary)",stroke:s?"var(--accent-primary)":v?"var(--text-primary)":"none",strokeWidth:s?3:v?2:0,strokeDasharray:a?"5,5":"none",opacity:a?.8:1,onClick:()=>N(t.name),onMouseEnter:()=>T(t.name),onMouseLeave:()=>T(null),style:{cursor:"pointer"}},`cell-highest-${i}`)})})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsxs("h3",{children:["âš°ï¸ Plus Faibles Taux de Survie - Jour ",h]}),j&&l.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',l.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(W,{title:`âš°ï¸ Plus Faibles Taux de Survie - Jour ${h}`,children:e.jsx("div",{style:{height:400},children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(F,{data:D,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(V,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(q,{dataKey:"name",angle:-45,textAnchor:"end",height:80,tick:({x:t,y:i,payload:s})=>e.jsx("text",{x:t,y:i,dy:16,textAnchor:"end",transform:`rotate(-45, ${t}, ${i})`,fill:l.highlightedPlayer===s.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:l.highlightedPlayer===s.value?14:12,fontWeight:l.highlightedPlayer===s.value?"bold":"normal",children:s.value})}),e.jsx(O,{tickFormatter:t=>`${t.toFixed(0)}%`,tick:{fill:"var(--text-secondary)"},label:{value:"Taux de survie (%)",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(r,{})}),e.jsx(G,{dataKey:"value",name:"Taux de survie",cursor:"pointer",children:D.map((t,i)=>{const s=l.highlightedPlayer===t.name,v=K===t.name,a=t.isHighlightedAddition;return e.jsx(J,{fill:m[t.name]||"var(--chart-color-4)",stroke:s?"var(--accent-primary)":v?"var(--text-primary)":"none",strokeWidth:s?3:v?2:0,strokeDasharray:a?"5,5":"none",opacity:a?.8:1,onClick:()=>N(t.name),onMouseEnter:()=>T(t.name),onMouseLeave:()=>T(null),style:{cursor:"pointer"}},`cell-lowest-${i}`)})})]})})})})]}),e.jsx("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note :"})," Les statistiques de survie montrent le pourcentage de fois qu'un joueur survit au Jour ",h," parmi toutes les parties qu'il a jouÃ©es et qui ont atteint ce jour. ",x||j?"Les joueurs mis en Ã©vidence apparaissent mÃªme s'ils ne sont pas dans le top 15.":""]})})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de survie disponible"})}function Be(){const{navigationState:n,updateNavigationState:S}=U(),[g,f]=M.useState(n.deathStatisticsState?.selectedCamp||n.deathStatsSelectedCamp||"Tous les camps"),[c,z]=M.useState(n.deathStatisticsState?.victimCampFilter||"Tous les camps"),[k,l]=M.useState(n.deathStatisticsState?.minGamesForAverage||25),[y,m]=M.useState(n.deathStatisticsState?.selectedView||"killers"),{data:H}=re(),{data:A,isLoading:K,error:T}=se(g,c),{data:p,isLoading:h,error:o}=le(),{data:x,isLoading:D,error:j}=me(g),{data:N}=ae(),r=ee();M.useEffect(()=>{(!n.deathStatisticsState||n.deathStatisticsState.selectedCamp!==g||n.deathStatisticsState.victimCampFilter!==c||n.deathStatisticsState.minGamesForAverage!==k||n.deathStatisticsState.selectedView!==y)&&S({deathStatisticsState:{selectedCamp:g,victimCampFilter:c,minGamesForAverage:k,selectedView:y,focusChart:n.deathStatisticsState?.focusChart}})},[g,c,k,y,n.deathStatisticsState,S]);const t=M.useMemo(()=>N?ne(N):[],[N]),i=M.useMemo(()=>{const d={};t.forEach(P=>{P===E.BY_WOLF?d[P]=r.Loup:P===E.VOTED?d[P]="var(--chart-color-1)":P===E.BULLET||P===E.BULLET_HUMAN||P===E.BULLET_WOLF?d[P]=r.Chasseur:P===E.BY_ZOMBIE?d[P]=r.Vaudou:P===E.ASSASSIN?d[P]=r.Alchimiste:P===E.AVENGER?d[P]="var(--chart-color-2)":P===E.LOVER_DEATH?d[P]=r.Amoureux:P===E.BY_BEAST?d[P]="var(--chart-color-3)":P===E.SHERIF_SUCCESS&&(d[P]="var(--chart-color-4)")});const u=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let B=0;return t.forEach(P=>{d[P]||(d[P]=u[B%u.length],B++)}),d},[t,r]),s=d=>{f(d),S({deathStatsSelectedCamp:d,deathStatisticsState:{selectedCamp:d,victimCampFilter:c,minGamesForAverage:k,selectedView:y,focusChart:n.deathStatisticsState?.focusChart}})},v=d=>{z(d),S({deathStatisticsState:{selectedCamp:g,victimCampFilter:d,minGamesForAverage:k,selectedView:y,focusChart:n.deathStatisticsState?.focusChart}})},a=d=>{l(d),S({deathStatisticsState:{selectedCamp:g,victimCampFilter:c,minGamesForAverage:d,selectedView:y,focusChart:n.deathStatisticsState?.focusChart}})},b=d=>{m(d),S({deathStatisticsState:{selectedCamp:g,victimCampFilter:c,minGamesForAverage:k,selectedView:d,focusChart:n.deathStatisticsState?.focusChart}})},{gamesWithKillers:R,totalEligibleForAverage:L}=M.useMemo(()=>{if(!A)return{gamesWithKillers:0,totalEligibleForAverage:0};const d=A.killerStats.filter(u=>u.gamesPlayed>=k);return{gamesWithKillers:A.totalGames,totalEligibleForAverage:d.length}},[A,k]);return K?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de mort..."}):T?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",T]}):A?e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"ðŸ’€ Statistiques de Morts & Kills"}),e.jsxs("div",{className:"lycans-categories-selection",children:[e.jsx("button",{className:`lycans-categorie-btn ${y==="killers"?"active":""}`,onClick:()=>b("killers"),children:"Tueurs"}),e.jsx("button",{className:`lycans-categorie-btn ${y==="deaths"?"active":""}`,onClick:()=>b("deaths"),children:"Morts"}),e.jsx("button",{className:`lycans-categorie-btn ${y==="survival"?"active":""}`,onClick:()=>b("survival"),children:"Survie"}),e.jsx("button",{className:`lycans-categorie-btn ${y==="hunter"?"active":""}`,onClick:()=>b("hunter"),children:"Chasseur"})]}),(y==="killers"||y==="deaths"||y==="survival")&&e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select",value:g,onChange:d=>s(d.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),H?.map(d=>e.jsx("option",{value:d,children:d},d))]})]}),y==="killers"&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"victim-camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp de la victime :"}),e.jsxs("select",{id:"victim-camp-select",value:c,onChange:d=>v(d.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loup"}),e.jsx("option",{value:"Roles solo",children:"Roles solo"})]})]})]}),(y==="killers"||y==="deaths")&&e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total des morts"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)"},children:A.totalDeaths})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Tueurs identifiÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-1)"},children:A.killerStats.length})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Nombre de parties enregistrÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary)"},children:R})]})]}),y==="killers"&&e.jsx(ue,{deathStats:A,selectedCamp:g,victimCampFilter:c,minGamesForAverage:k,onMinGamesChange:a,availableDeathTypes:t,deathTypeColors:i,totalEligibleForAverage:L}),y==="deaths"&&e.jsx(ye,{deathStats:A,selectedCamp:g,minGamesForAverage:k,onMinGamesChange:a,availableDeathTypes:t,deathTypeColors:i}),y==="hunter"&&e.jsx(ve,{hunterStats:p,isLoading:h,error:o}),y==="survival"&&e.jsx(pe,{survivalStats:x,selectedCamp:g,minGamesForAverage:k,onMinGamesChange:a,isLoading:D,error:j}),e.jsx("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note : "}),"DonnÃ©es en cours de rÃ©cupÃ©ration (donnÃ©es partielles)."]})})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de mort disponible"})}export{Be as DeathStatisticsChart};
