import{u as P,r as L,j as s}from"./index-cDfRqOA6.js";import{b as w,s as y,e as F,a as T,u as z}from"./baseStatsHook-BYOrLSBm.js";import{p as R}from"./api-beq3FXpM.js";import{F as k,B as q,C as $,X as B,Y as M,a as J,b as K}from"./FullscreenChart-CWohCwJ2.js";import{R as X,T as Y}from"./CategoricalChart-BXXmvohJ.js";function U(e){const l=new Set;return e.forEach(t=>{const r=t["Liste des joueurs"];r&&y(r.toString()).forEach(i=>{l.add(i.trim())})}),l}function H(e){const l={};return e.forEach(t=>{l[t]={currentVillageoisSeries:0,currentLoupsSeries:0,longestVillageoisSeries:null,longestLoupsSeries:null,currentWinSeries:0,longestWinSeries:null,currentWinCamps:[],lastCamp:null,lastWon:!1,villageoisSeriesStart:null,loupsSeriesStart:null,winSeriesStart:null}}),l}function Q(e,l,t,r,i){t==="Villageois"||t==="Loups"?(t==="Villageois"&&(e.lastCamp==="Villageois"?e.currentVillageoisSeries++:(e.currentVillageoisSeries=1,e.villageoisSeriesStart={game:r,date:i}),(!e.longestVillageoisSeries||e.currentVillageoisSeries>e.longestVillageoisSeries.seriesLength)&&(e.longestVillageoisSeries={player:l,camp:"Villageois",seriesLength:e.currentVillageoisSeries,startGame:e.villageoisSeriesStart?.game||r,endGame:r,startDate:e.villageoisSeriesStart?.date||i,endDate:i,isOngoing:!1}),e.currentLoupsSeries=0,e.loupsSeriesStart=null),t==="Loups"&&(e.lastCamp==="Loups"?e.currentLoupsSeries++:(e.currentLoupsSeries=1,e.loupsSeriesStart={game:r,date:i}),(!e.longestLoupsSeries||e.currentLoupsSeries>e.longestLoupsSeries.seriesLength)&&(e.longestLoupsSeries={player:l,camp:"Loups",seriesLength:e.currentLoupsSeries,startGame:e.loupsSeriesStart?.game||r,endGame:r,startDate:e.loupsSeriesStart?.date||i,endDate:i,isOngoing:!1}),e.currentVillageoisSeries=0,e.villageoisSeriesStart=null),e.lastCamp=t):(e.currentVillageoisSeries=0,e.currentLoupsSeries=0,e.villageoisSeriesStart=null,e.loupsSeriesStart=null,e.lastCamp="Autres")}function Z(e,l,t,r,i,a){if(t){if(e.lastWon?(e.currentWinSeries++,e.currentWinCamps.push(r)):(e.currentWinSeries=1,e.currentWinCamps=[r],e.winSeriesStart={game:i,date:a}),!e.longestWinSeries||e.currentWinSeries>e.longestWinSeries.seriesLength){const p={};e.currentWinCamps.forEach(S=>{p[S]=(p[S]||0)+1}),e.longestWinSeries={player:l,seriesLength:e.currentWinSeries,startGame:e.winSeriesStart?.game||i,endGame:i,startDate:e.winSeriesStart?.date||a,endDate:a,campCounts:p,isOngoing:!1}}e.lastWon=!0}else e.currentWinSeries=0,e.currentWinCamps=[],e.winSeriesStart=null,e.lastWon=!1}function _(e){const l=[],t=[],r=[];return Object.values(e).forEach(i=>{i.longestVillageoisSeries&&l.push(i.longestVillageoisSeries),i.longestLoupsSeries&&t.push(i.longestLoupsSeries),i.longestWinSeries&&r.push(i.longestWinSeries)}),l.sort((i,a)=>a.seriesLength-i.seriesLength),t.sort((i,a)=>a.seriesLength-i.seriesLength),r.sort((i,a)=>a.seriesLength-i.seriesLength),{longestVillageoisSeries:l.slice(0,20),longestLoupsSeries:t.slice(0,20),longestWinSeries:r.slice(0,20)}}function I(e,l){const t=[],r=[],i=[];Object.values(e).forEach(c=>{t.push(c.longestVillageoisSeries?.seriesLength||0),r.push(c.longestLoupsSeries?.seriesLength||0),i.push(c.longestWinSeries?.seriesLength||0)});const a=l>0?t.reduce((c,h)=>c+h,0)/l:0,p=l>0?r.reduce((c,h)=>c+h,0)/l:0,S=l>0?i.reduce((c,h)=>c+h,0)/l:0,g=t.filter(c=>c>=5).length,v=r.filter(c=>c>=3).length,x=i.filter(c=>c>=5).length;return{averageVillageoisSeries:Math.round(a*10)/10,averageLoupsSeries:Math.round(p*10)/10,averageWinSeries:Math.round(S*10)/10,eliteVillageoisCount:g,eliteLoupsCount:v,eliteWinCount:x}}function ee(e,l){if(e.length===0||l.length===0)return null;const t=w(l),r=[...e].sort((n,m)=>(n.Game||0)-(m.Game||0)),i=U(r),a=H(i);r.forEach(n=>{const m=n.Game?.toString(),C=n["Liste des joueurs"],D=n["Liste des gagnants"],W=n.Date?.toString()||"";if(!m||!C)return;const O=y(C.toString()),V=parseInt(m);O.forEach(E=>{const f=E.trim();if(!f)return;const b=a[f],A=F(t,m,f),G=T(f,D?.toString()),N=t[m]&&t[m][f]||"Villageois";Q(b,f,A,V,W),Z(b,f,G,N,V,W)})});const{longestVillageoisSeries:p,longestLoupsSeries:S,longestWinSeries:g}=_(a);Object.values(a).forEach(n=>{n.longestVillageoisSeries&&n.currentVillageoisSeries===n.longestVillageoisSeries.seriesLength&&n.currentVillageoisSeries>0&&(n.longestVillageoisSeries.isOngoing=!0),n.longestLoupsSeries&&n.currentLoupsSeries===n.longestLoupsSeries.seriesLength&&n.currentLoupsSeries>0&&(n.longestLoupsSeries.isOngoing=!0),n.longestWinSeries&&n.currentWinSeries===n.longestWinSeries.seriesLength&&n.currentWinSeries>0&&(n.longestWinSeries.isOngoing=!0)});const v=I(a,i.size);let x=0,c=0,h=0,d=0,u=0,o=0;Object.values(a).forEach(n=>{n.currentVillageoisSeries>0&&x++,n.currentLoupsSeries>0&&c++,n.currentWinSeries>0&&h++,n.longestVillageoisSeries?.isOngoing&&d++,n.longestLoupsSeries?.isOngoing&&u++,n.longestWinSeries?.isOngoing&&o++});const j=r.length>0&&r[r.length-1]?.Date?.toString()||"";return{longestVillageoisSeries:p,longestLoupsSeries:S,longestWinSeries:g,totalGamesAnalyzed:r.length,lastRecordedGameDate:j,totalPlayersCount:i.size,activeVillageoisCount:x,activeLoupsCount:c,activeWinCount:h,ongoingVillageoisCount:d,ongoingLoupsCount:u,ongoingWinCount:o,...v}}function se(){const{data:e,isLoading:l,error:t}=z((r,i)=>ee(r,i));return{data:e,isLoading:l,error:t}}function te(){const{data:e,isLoading:l,error:t}=se(),{navigateToGameDetails:r}=P(),[i,a]=L.useState("villageois"),p=L.useRef(null);if(L.useEffect(()=>{const u=setTimeout(()=>{const o=S(),j=p.current?.querySelectorAll(".recharts-bar-rectangle");j&&j.forEach((n,m)=>{n.classList.remove("lycans-ongoing-series"),o[m]&&o[m].isOngoing&&n.classList.add("lycans-ongoing-series")})},100);return()=>{clearTimeout(u);const o=p.current?.querySelectorAll(".recharts-bar-rectangle");o&&o.forEach(j=>{j.classList.remove("lycans-ongoing-series")})}},[e,i]),l)return s.jsx("div",{className:"donnees-attente",children:"R√©cup√©ration des s√©ries de joueurs..."});if(t)return s.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",t]});if(!e)return s.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de s√©rie disponible"});const S=()=>{switch(i){case"villageois":return e.longestVillageoisSeries.slice(0,20);case"loups":return e.longestLoupsSeries.slice(0,20);case"wins":return e.longestWinSeries.slice(0,20);default:return[]}},g=S(),v=d=>Object.entries(d).map(([u,o])=>`${u} (${o})`).join(", "),x=()=>{switch(i){case"villageois":return"Plus Longues S√©ries Villageois Cons√©cutives";case"loups":return"Plus Longues S√©ries Loups Cons√©cutives";case"wins":return"Plus Longues S√©ries de Victoires";default:return""}},c=({active:d,payload:u})=>{if(!d||!u||u.length===0)return null;const o=u[0].payload;return i==="wins"?s.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[s.jsxs("div",{children:[s.jsx("strong",{children:o.player}),o.isOngoing&&s.jsx("span",{style:{marginLeft:"8px",fontSize:"1.2em"},children:"üî•"})]}),s.jsxs("div",{children:["S√©rie de victoires : ",o.seriesLength," parties ",o.isOngoing?"(En cours)":""]}),s.jsxs("div",{children:["Du jeu #",o.startGame," au jeu #",o.endGame]}),s.jsxs("div",{children:["Du ",o.startDate," au ",o.endDate]}),s.jsxs("div",{children:["Camps jou√©s : ",v(o.campCounts)]}),o.isOngoing&&s.jsx("div",{style:{fontSize:"0.8rem",color:"#FF8C00",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center"},children:"üî• S√©rie en cours - Aucun jeu depuis !"}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]}):s.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[s.jsxs("div",{children:[s.jsx("strong",{children:o.player}),o.isOngoing&&s.jsx("span",{style:{marginLeft:"8px",fontSize:"1.2em"},children:"üî•"})]}),s.jsxs("div",{children:["S√©rie ",o.camp," : ",o.seriesLength," parties cons√©cutives ",o.isOngoing?"(En cours)":""]}),s.jsxs("div",{children:["Du jeu #",o.startGame," au jeu #",o.endGame]}),s.jsxs("div",{children:["Du ",o.startDate," au ",o.endDate]}),o.isOngoing&&s.jsx("div",{style:{fontSize:"0.8rem",color:"#FF8C00",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center"},children:"üî• S√©rie en cours - Aucun jeu depuis !"}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})},h=d=>{if(i==="wins")r({selectedPlayer:d.player,fromComponent:"S√©ries de Victoires"});else{const u=i==="villageois"?"Villageois":"Loups";r({selectedPlayer:d.player,selectedCamp:u,fromComponent:`S√©ries ${u}`})}};return s.jsxs("div",{className:"lycans-players-series",children:[s.jsx("h2",{children:"S√©ries des Joueurs"}),s.jsxs("p",{className:"lycans-stats-info",children:["Bas√© sur ",e.totalGamesAnalyzed," parties analys√©es"]}),e.lastRecordedGameDate&&s.jsx("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",margin:"1rem 0",textAlign:"center"},children:s.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",margin:"0",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:["üìÖ ",s.jsx("strong",{children:"Donn√©es √† jour jusqu'au :"})," ",e.lastRecordedGameDate]})}),s.jsx("div",{className:"lycans-section-description",children:s.jsxs("p",{children:[s.jsx("strong",{children:"S√©ries de camps :"})," Parties cons√©cutives dans le m√™me camp principal (Villageois ou Loups). Jouer dans n'importe quel autre camp brise la s√©rie.",s.jsx("br",{}),s.jsx("strong",{children:"S√©ries de victoires :"})," Victoires cons√©cutives dans n'importe quel camp. Une d√©faite brise la s√©rie.",s.jsx("br",{}),s.jsx("strong",{children:"üî• S√©ries en cours :"})," Les s√©ries avec l'effet de flamme sont encore actives"]})}),s.jsxs("div",{className:"lycans-categories-selection",children:[s.jsx("button",{className:`lycans-categorie-btn ${i==="villageois"?"active":""}`,onClick:()=>a("villageois"),children:"S√©ries Villageois"}),s.jsx("button",{className:`lycans-categorie-btn ${i==="loups"?"active":""}`,onClick:()=>a("loups"),children:"S√©ries Loups"}),s.jsx("button",{className:`lycans-categorie-btn ${i==="wins"?"active":""}`,onClick:()=>a("wins"),children:"S√©ries de Victoires"})]}),s.jsxs("div",{className:"lycans-graphique-section",children:[s.jsx(k,{title:x(),children:s.jsx("div",{ref:p,style:{height:500},children:s.jsx(X,{width:"100%",height:"100%",children:s.jsxs(q,{data:g,margin:{top:20,right:30,left:20,bottom:10},children:[s.jsx($,{strokeDasharray:"3 3"}),s.jsx(B,{dataKey:"player",angle:-45,textAnchor:"end",height:120,interval:0}),s.jsx(M,{label:{value:i==="wins"?"Victoires cons√©cutives":"Parties cons√©cutives",angle:-90,position:"insideLeft"}}),s.jsx(Y,{content:c}),s.jsx(J,{dataKey:"seriesLength",name:i==="wins"?"Victoires cons√©cutives":"Parties cons√©cutives",fill:i==="villageois"?"#82ca9d":i==="loups"?"#FF8042":"#8884d8",children:g.map((d,u)=>s.jsx(K,{fill:R[d.player]||(i==="villageois"?"#82ca9d":i==="loups"?"#FF8042":"#8884d8"),onClick:()=>h(d),style:{cursor:"pointer"},className:d.isOngoing?"lycans-ongoing-series":""},`cell-${i}-${u}`))})]})})})}),g.length>0&&s.jsxs("div",{className:"lycans-stats-grid",style:{marginTop:"0rem",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))"},children:[s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"üèÜ Record Absolu"}),s.jsxs("div",{className:"lycans-stat-value",children:[g[0].seriesLength,g[0].isOngoing&&s.jsx("span",{style:{fontSize:"0.6em",marginLeft:"5px"},children:"üî•"})]}),s.jsxs("p",{children:["par ",s.jsx("strong",{children:g[0].player}),g[0].isOngoing&&s.jsx("span",{style:{color:"#FF8C00",fontWeight:"bold"},children:" (En cours)"})]}),i==="wins"?s.jsxs("p",{className:"lycans-h2h-description",children:["Camps : ",v(g[0].campCounts||{})]}):s.jsxs("p",{className:"lycans-h2h-description",children:["Camp : ",g[0].camp]})]}),s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"üìä Moyenne (tous les joueurs)"}),s.jsx("div",{className:"lycans-stat-value",children:i==="villageois"?e.averageVillageoisSeries:i==="loups"?e.averageLoupsSeries:e.averageWinSeries}),s.jsx("p",{children:"parties en moyenne"}),s.jsxs("p",{className:"lycans-h2h-description",children:["Bas√© sur ",e.totalPlayersCount," joueurs"]})]}),s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"üî• S√©ries En Cours"}),s.jsx("div",{className:"lycans-stat-value",children:i==="villageois"?e.activeVillageoisCount:i==="loups"?e.activeLoupsCount:e.activeWinCount}),s.jsx("p",{children:"s√©ries encore actives"}),s.jsx("p",{className:"lycans-h2h-description",children:(i==="villageois"?e.activeVillageoisCount:i==="loups"?e.activeLoupsCount:e.activeWinCount)>0?"Joueurs actuellement dans une s√©rie de ce type":"Aucune s√©rie active de ce type"})]})]}),g.length===0&&s.jsxs("div",{className:"lycans-empty-section",children:[s.jsx("h3",{children:"Aucune s√©rie trouv√©e"}),s.jsx("p",{children:"Aucune s√©rie n'a √©t√© trouv√©e pour ce type avec les filtres actuels."})]})]})]})}export{te as PlayerSeriesChart};
