import{c as R,r as i,j as e}from"./index-DIb-vKvs.js";function P(){const{generateUrlWithSettings:s}=R(),[r,c]=i.useState(!1),m=async()=>{const g=s();try{await navigator.clipboard.writeText(g),c(!0),setTimeout(()=>c(!1),2e3)}catch{const p=document.createElement("textarea");p.value=g,document.body.appendChild(p),p.select(),document.execCommand("copy"),document.body.removeChild(p),c(!0),setTimeout(()=>c(!1),2e3)}};return e.jsx("div",{className:"shareable-url-container",children:e.jsx("button",{onClick:m,className:"shareable-url-btn",type:"button",title:"Copier le lien avec les param√®tres actuels",children:r?"‚úÖ Copi√©!":"üîó Copier le lien"})})}function T(){const{settings:s,updateSettings:r,resetSettings:c}=R(),[m,g]=i.useState(null),o=i.useRef({filterMode:s.filterMode,gameFilter:s.gameFilter,dateStart:s.dateRange.start,dateEnd:s.dateRange.end});i.useEffect(()=>{(async()=>{try{const l=await(await fetch("/data/gameLog.json")).json();g(l.data||[])}catch(t){console.error("Error fetching game log data:",t)}})()},[]),i.useEffect(()=>{const a={filterMode:s.filterMode,gameFilter:s.gameFilter,dateStart:s.dateRange.start,dateEnd:s.dateRange.end};(o.current.filterMode!==a.filterMode||o.current.gameFilter!==a.gameFilter||o.current.dateStart!==a.dateStart||o.current.dateEnd!==a.dateEnd)&&s.playerFilter.players.length>0&&r({playerFilter:{mode:s.playerFilter.mode,players:[]}}),o.current=a},[s.filterMode,s.gameFilter,s.dateRange.start,s.dateRange.end,s.playerFilter.players.length,r]);const p=a=>{if(!a)return null;try{return new Date(a)}catch{return null}},u=i.useMemo(()=>m?m.filter(a=>{if(s.filterMode==="gameType"&&(s.gameFilter==="modded"&&!a.Modded||s.gameFilter==="non-modded"&&a.Modded))return!1;if(s.filterMode==="dateRange"&&(s.dateRange.start||s.dateRange.end)){const t=p(a.StartDate);if(!t)return!1;if(s.dateRange.start){const l=new Date(s.dateRange.start);if(t<l)return!1}if(s.dateRange.end){const l=new Date(s.dateRange.end);if(t>l)return!1}}return!0}):[],[m,s.filterMode,s.gameFilter,s.dateRange]),f=i.useMemo(()=>{const a=new Set;return u.forEach(t=>{t.PlayerStats.forEach(l=>{a.add(l.Username)})}),Array.from(a)},[u]),v=i.useMemo(()=>{const a={};return u.forEach(t=>{const l=t.PlayerStats.map(n=>n.Username);l.forEach(n=>{a[n]||(a[n]=new Set),l.forEach(d=>{n!==d&&a[n].add(d)})})}),a},[u]),{availablePlayers:C,selectablePlayers:h}=i.useMemo(()=>{const a=f.sort();if(s.playerFilter.mode==="none"||s.playerFilter.players.length===0)return{availablePlayers:a,selectablePlayers:new Set(a)};const t=new Set;return s.playerFilter.mode==="include"?a.forEach(l=>{(s.playerFilter.players.includes(l)||s.playerFilter.players.every(d=>v[l]?.has(d)||!1))&&t.add(l)}):s.playerFilter.mode==="exclude"&&a.forEach(l=>{(s.playerFilter.players.includes(l)||u.some(d=>{const N=d.PlayerStats.map(j=>j.Username.toLowerCase());return N.includes(l.toLowerCase())?!s.playerFilter.players.some(j=>N.includes(j.toLowerCase())):!1}))&&t.add(l)}),{availablePlayers:a,selectablePlayers:t}},[f,s.playerFilter,v,u]),F=a=>{r({filterMode:a})},x=a=>{r({gameFilter:a})},b=(a,t)=>{r({dateRange:{...s.dateRange,[a]:t||null}})},y=a=>{r({playerFilter:{...s.playerFilter,mode:a}})},S=a=>{const t=s.playerFilter.players;if(t.includes(a)){const n=t.filter(d=>d!==a);r({playerFilter:{...s.playerFilter,players:n}})}else r({playerFilter:{...s.playerFilter,players:[...t,a]}})},k=()=>{r({playerFilter:{...s.playerFilter,players:[...h]}})},M=()=>{r({playerFilter:{...s.playerFilter,players:[]}})};return e.jsxs("div",{className:"settings-panel",children:[e.jsxs("div",{className:"settings-header",children:[e.jsx("h3",{children:"Param√®tres de Filtrage"}),e.jsx("button",{onClick:c,className:"settings-reset-btn",type:"button",children:"R√©initialiser"})]}),e.jsxs("div",{className:"settings-sections-container",children:[e.jsxs("div",{className:"settings-section",children:[e.jsx("div",{className:"settings-section-header",children:e.jsx("h3",{children:"1. Filtre Principal"})}),e.jsxs("div",{className:"settings-group",children:[e.jsx("h4",{children:"Mode de Filtrage"}),e.jsx("p",{className:"settings-explanation",children:"Choisissez le type de filtre principal √† appliquer aux donn√©es :"}),e.jsxs("div",{className:"settings-radio-group",style:{flexDirection:"row",gap:"2rem"},children:[e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"filterMode",value:"gameType",checked:s.filterMode==="gameType",onChange:()=>F("gameType")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Filtrer par type de partie",e.jsx("small",{children:"S√©lectionner selon le type de jeu (modd√©/standard)"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"filterMode",value:"dateRange",checked:s.filterMode==="dateRange",onChange:()=>F("dateRange")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Filtrer par p√©riode",e.jsx("small",{children:"S√©lectionner selon une plage de dates"})]})]})]})]}),s.filterMode==="gameType"&&e.jsxs("div",{className:"settings-group",children:[e.jsx("h4",{children:"Filtres de Type de Partie"}),e.jsxs("div",{className:"settings-radio-group",children:[e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"all",checked:s.gameFilter==="all",onChange:()=>x("all")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Tous les types de parties",e.jsx("small",{children:"Inclut toutes les parties, modd√©es et non-modd√©es"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"modded",checked:s.gameFilter==="modded",onChange:()=>x("modded")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Parties modd√©es uniquement",e.jsx("small",{children:"Affiche uniquement les parties avec des r√¥les modifi√©s"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"non-modded",checked:s.gameFilter==="non-modded",onChange:()=>x("non-modded")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Parties non-modd√©es uniquement",e.jsx("small",{children:"Affiche uniquement les parties avec des r√¥les standards"})]})]})]})]}),s.filterMode==="dateRange"&&e.jsxs("div",{className:"settings-group",children:[e.jsx("h4",{children:"Filtres de Dates"}),e.jsxs("div",{className:"settings-radio-group",children:[e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"dateFilter",value:"all",checked:!s.dateRange.start&&!s.dateRange.end,onChange:()=>{r({dateRange:{start:null,end:null}})}}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Toutes les dates",e.jsx("small",{children:"Affiche toutes les parties sans restriction de date"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"dateFilter",value:"custom",checked:!!(s.dateRange.start||s.dateRange.end),onChange:()=>{if(!s.dateRange.start&&!s.dateRange.end){const a=new Date,t=new Date(a.getFullYear(),a.getMonth()-1,a.getDate());r({dateRange:{start:t.toISOString().split("T")[0],end:a.toISOString().split("T")[0]}})}}}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Plage de dates personnalis√©e",e.jsx("small",{children:"D√©finir une p√©riode sp√©cifique √† analyser"})]})]})]}),(s.dateRange.start||s.dateRange.end)&&e.jsxs("div",{className:"settings-nested-group",children:[e.jsxs("div",{className:"settings-date-inputs",children:[e.jsxs("label",{className:"settings-date-label",children:["Date de d√©but",e.jsx("input",{type:"date",value:s.dateRange.start||"",onChange:a=>b("start",a.target.value),className:"settings-date-input",max:s.dateRange.end||void 0})]}),e.jsx("span",{className:"settings-date-separator",children:"‚Äî"}),e.jsxs("label",{className:"settings-date-label",children:["Date de fin",e.jsx("input",{type:"date",value:s.dateRange.end||"",onChange:a=>b("end",a.target.value),className:"settings-date-input",min:s.dateRange.start||void 0})]})]}),e.jsx("small",{style:{color:"var(--text-secondary, #6c757d)",marginTop:8,display:"block"},children:"Laissez vide pour ne pas limiter le d√©but ou la fin de la p√©riode."})]})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("div",{className:"settings-section-header",children:e.jsx("h3",{children:"2. Filtre Additionnel par Joueurs"})}),e.jsxs("div",{className:"settings-group",children:[e.jsxs("div",{className:"settings-radio-group",children:[e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"playerFilterMode",value:"none",checked:s.playerFilter.mode==="none",onChange:()=>y("none")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Aucun filtre par joueur",e.jsx("small",{children:"Affiche toutes les parties sans restriction par joueur"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"playerFilterMode",value:"include",checked:s.playerFilter.mode==="include",onChange:()=>y("include")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Inclure seulement les parties avec ces joueurs",e.jsx("small",{children:"Affiche uniquement les parties o√π TOUS les joueurs s√©lectionn√©s ont particip√© ensemble"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"playerFilterMode",value:"exclude",checked:s.playerFilter.mode==="exclude",onChange:()=>y("exclude")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Exclure les parties avec ces joueurs",e.jsx("small",{children:"Affiche uniquement les parties o√π aucun des joueurs list√©s n'a particip√©"})]})]})]}),(s.playerFilter.mode==="include"||s.playerFilter.mode==="exclude")&&e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[e.jsxs("label",{style:{fontWeight:500},children:["S√©lection des joueurs (",s.playerFilter.players.length," s√©lectionn√©",s.playerFilter.players.length!==1?"s":""," sur ",h.size," disponible",h.size!==1?"s":"",")"]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:k,style:{padding:"4px 8px",fontSize:"0.8rem",border:"1px solid var(--border-color, #ccc)",borderRadius:"4px",background:"var(--bg-tertiary, #f0f0f0)",color:"var(--text-primary, #333)",cursor:"pointer"},children:"Tout s√©lectionner"}),e.jsx("button",{type:"button",onClick:M,style:{padding:"4px 8px",fontSize:"0.8rem",border:"1px solid var(--border-color, #ccc)",borderRadius:"4px",background:"var(--bg-tertiary, #f0f0f0)",color:"var(--text-primary, #333)",cursor:"pointer"},children:"Tout d√©s√©lectionner"})]})]}),e.jsx("div",{className:"settings-player-grid",children:C.map(a=>{const t=h.has(a),l=s.playerFilter.players.includes(a);return e.jsxs("label",{className:`settings-player-checkbox ${t?"":"disabled"}`,style:{opacity:t?1:.5,cursor:t?"pointer":"not-allowed"},children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>t&&S(a),disabled:!t}),e.jsx("span",{className:"settings-player-checkmark"}),e.jsx("span",{className:"settings-player-name",title:!t&&!l?`${a} n'a ${s.playerFilter.mode==="include"?"pas jou√© avec tous les joueurs s√©lectionn√©s":"que des parties avec les joueurs exclus"}`:a,children:a})]},a)})}),e.jsxs("small",{style:{color:"var(--text-secondary, #6c757d)",marginTop:8,display:"block"},children:["S√©lectionnez les joueurs √† ",s.playerFilter.mode==="include"?"inclure":"exclure"," dans le filtrage."]})]})]})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("div",{className:"settings-section-header",children:e.jsx("h3",{children:"3. Partage des Param√®tres"})}),e.jsxs("div",{className:"settings-group",children:[e.jsx("p",{className:"settings-explanation",children:"Copiez le lien ci-dessous pour partager les param√®tres actuels avec d'autres personnes. Ils pourront ouvrir le site avec ces m√™mes filtres appliqu√©s."}),e.jsx(P,{})]})]}),e.jsx("div",{className:"settings-info",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," Les changements de param√®tres sont sauvegard√©s automatiquement et s'appliquent √† toutes les statistiques affich√©es."]})})]})}export{T as SettingsPanel};
