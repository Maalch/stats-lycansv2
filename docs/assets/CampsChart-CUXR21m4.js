import{s as E,h as V,i as S,u as k,r as g,j as e}from"./index-DQzlEoxb.js";import{g as R,a as b,d as W}from"./datasyncExport-CaXlnps6.js";import{a as z,l as L}from"./api-1hecDvOQ.js";import{b as v,F as w,B as A,C as F,X as N,Y as P,a as M}from"./FullscreenChart-DWVmRigZ.js";import{R as j,T as C}from"./CategoricalChart-DL7QZjbC.js";import{P as D,a as _}from"./PieChart-Dob73gTL.js";import{L as q}from"./Legend-DKKI-T2s.js";import"./PolarChart-Bb-7w386.js";function I(r){const s={};return r.forEach(n=>{const i=n.Id;s[i]||(s[i]={}),n.PlayerStats.forEach(c=>{const l=c.Username;let f=R(b(c.MainRoleInitial,c.MainRoleChanges||[]));l&&f&&(s[i][l]=f)})}),s}function T(r,s,n){return r[s]?.[n]||"Villageois"}function O(r){const s=[],n=["Villageois","Loup"];return r.PlayerStats.forEach(i=>{let c=R(b(i.MainRoleInitial,i.MainRoleChanges||[]));c&&!n.includes(c)&&s.push(c)}),s}function $(r){const s=r.PlayerStats.filter(i=>i.Victorious);return s.length===0?null:R(b(s[0].MainRoleInitial,s[0].MainRoleChanges||[]),{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0})}function B(r){return r.PlayerStats.map(s=>s.Username).join(", ")}function K(r){return r.PlayerStats.filter(s=>s.Victorious).map(s=>s.Username).join(", ")}function U(r,s){r.forEach(n=>{const i=n.trim();i!==""&&(s[i]||(s[i]=0),s[i]++)})}function X(r,s){return r&&r.trim()!==""?(s[r]||(s[r]=0),s[r]++,!0):!1}function Y(r,s,n,i,c,l){const f=E(s),x=new Set;f.forEach(d=>{const u=d.trim();if(u){const p=T(c,r,u);x.add(p)}}),x.forEach(d=>{l[d]||(l[d]={totalGames:0,wins:0,winRate:0,players:{}}),l[d].totalGames++}),x.forEach(d=>{V(d,n)&&l[d].wins++}),f.forEach(d=>{const u=d.trim();if(u){const p=T(c,r,d);l[p].players[u]||(l[p].players[u]={games:0,wins:0,winRate:0}),l[p].players[u].games++,S(u,i)&&l[p].players[u].wins++}})}function J(r){Object.keys(r).forEach(s=>{r[s].totalGames>0&&(r[s].winRate=parseFloat((r[s].wins/r[s].totalGames*100).toFixed(2))),Object.keys(r[s].players).forEach(n=>{const i=r[s].players[n];i.games>0&&(i.winRate=parseFloat((i.wins/i.games*100).toFixed(2)))})})}function H(r,s){const n=[];return Object.keys(r).forEach(i=>{n.push({camp:i,wins:r[i],winRate:(r[i]/s*100).toFixed(2)})}),n.sort((i,c)=>c.wins-i.wins),n}function Q(r){return Object.keys(r).map(s=>({camp:s,totalGames:r[s].totalGames,wins:r[s].wins,winRate:r[s].winRate.toFixed(2)}))}function Z(r){const s=new Set;return Object.keys(r).forEach(n=>{Object.keys(r[n].players).forEach(i=>{s.add(i)})}),s.size}function ee(r){const s=[];return Object.keys(r).forEach(n=>{s.push({soloRole:n,appearances:r[n]})}),s.sort((n,i)=>i.appearances-n.appearances),s}function se(r){if(r.length===0)return null;const s=I(r),n={},i={},c={};let l=0;r.forEach(p=>{const t=p.Id,a=O(p),o=$(p),h=B(p),m=K(p);U(a,n),X(o||"",i)&&l++,t&&h&&o&&m&&Y(t,h,o,m,s,c)}),J(c);const f=H(i,l),x=Q(c),d=Z(c),u=ee(n);return{totalGames:l,campStats:f,soloCamps:u,campAverages:x,totalPlayersAnalyzed:d}}function re(){const{data:r,isLoading:s,error:n}=W(se);return{campWinStats:r,isLoading:s,errorInfo:n}}const te="#607D8B";function pe(){const{navigateToGameDetails:r}=k(),{campWinStats:s,isLoading:n,errorInfo:i}=re(),c=z(),l=g.useMemo(()=>s?.campAverages?s.campAverages.map(t=>({...t,winRateNum:parseFloat(t.winRate)})).sort((t,a)=>a.winRateNum-t.winRateNum):[],[s]),f=g.useMemo(()=>s?.campStats?.map(t=>({...t,winRateNum:typeof t.winRate=="string"?parseFloat(t.winRate):t.winRate}))||[],[s]),x=g.useMemo(()=>{if(!f.length)return[];const t=5;let a=0;const o=[],h=[];return f.forEach(m=>{m.winRateNum<t?(a+=m.winRateNum,o.push(m)):h.push(m)}),a>0&&h.push({camp:"Autres",wins:o.reduce((m,y)=>m+y.wins,0),winRate:a.toFixed(1),winRateNum:a,_details:o}),h},[f]),d=g.useMemo(()=>l.length?l.slice().filter(t=>t.camp!=="Villageois"&&t.camp!=="Loup").sort((t,a)=>a.totalGames-t.totalGames):[],[l]),u=n,p=i;return u?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques des camps..."}):p?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",p]}):s?e.jsxs("div",{className:"lycans-camps-container",children:[e.jsx("h2",{children:"Statistiques des Camps"}),s&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camps Analysés"}),e.jsx("div",{className:"lycans-valeur-principale",children:s.campAverages?.length||0}),e.jsx("p",{children:"camps différents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Joueurs Évalués"}),e.jsx("div",{className:"lycans-valeur-principale",children:s.totalPlayersAnalyzed||0}),e.jsx("p",{children:"joueurs analysés"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:s?.totalGames||0}),e.jsx("p",{children:"parties analysées"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[s&&x.length>0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Répartition des Victoires par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Distribution des victoires sur ",s.totalGames," parties"]}),e.jsx("div",{style:{height:450},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(D,{children:[e.jsx(_,{data:x,cx:"50%",cy:"50%",labelLine:!1,outerRadius:140,fill:"#8884d8",dataKey:"winRateNum",nameKey:"camp",onClick:t=>{if(t&&t.camp)if(t.camp==="Autres"&&t._details){const a=t._details.map(o=>o.camp);r({campFilter:{selectedCamp:"Autres",campFilterMode:"wins-only",_smallCamps:a},fromComponent:"Répartition des Victoires par Camp"})}else r({campFilter:{selectedCamp:t.camp,campFilterMode:"wins-only"},fromComponent:"Répartition des Victoires par Camp"})},style:{cursor:"pointer"},label:({camp:t,winRate:a})=>t==="Autres"?`Autres: ${a}%`:`${t}: ${a}%`,children:x.map((t,a)=>e.jsx(v,{fill:t.camp==="Autres"?L:c[t.camp]||te,onClick:()=>{if(t.camp==="Autres"&&t._details){const o=t._details.map(h=>h.camp);r({campFilter:{selectedCamp:"Autres",campFilterMode:"wins-only",_smallCamps:o},fromComponent:"Répartition des Victoires par Camp"})}else r({campFilter:{selectedCamp:t.camp,campFilterMode:"wins-only"},fromComponent:"Répartition des Victoires par Camp"})},style:{cursor:"pointer"}},`cellule-camp-${a}`))}),e.jsx(C,{content:({active:t,payload:a})=>{if(t&&a&&a.length>0){const o=a[0].payload;if(o.camp==="Autres"&&o._details){const h=[...o._details].sort((m,y)=>y.winRateNum-m.winRateNum);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:"Autres"})}),e.jsx("div",{children:h.map((m,y)=>e.jsxs("div",{children:[m.camp,": ",m.wins," victoires (",m.winRate,"%)"]},y))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold"},children:["Total: ",o.wins," victoires (",o.winRate,"%)"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:o.camp}),e.jsxs("div",{children:["Victoires: ",o.wins]}),e.jsxs("div",{children:["Taux de victoire: ",o.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(q,{})]})})})]})}),s?.campAverages&&l.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire Moyen par Camp"}),e.jsx(w,{title:"Taux de Victoire Moyen par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(A,{data:l,margin:{top:50,right:30,left:20,bottom:0},children:[e.jsx(F,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(P,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(C,{content:({active:t,payload:a})=>{if(t&&a&&a.length>0){const o=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:o.camp})}),e.jsxs("div",{children:["Victoires : ",o.wins," / ",o.totalGames]}),e.jsxs("div",{children:["Taux de victoire: ",o.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(M,{dataKey:"winRateNum",onClick:t=>{t&&t.camp&&r({campFilter:{selectedCamp:t.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Taux de Victoire Moyen par Camp"})},style:{cursor:"pointer"},children:l.map((t,a)=>e.jsx(v,{fill:c[t.camp]||`var(--chart-color-${a%6+1})`,onClick:()=>{r({campFilter:{selectedCamp:t.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Taux de Victoire Moyen par Camp"})},style:{cursor:"pointer"}},`cell-${a}`))})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Parties par Camp (hors villageois et loups)"}),e.jsx(w,{title:"Distribution des Parties par Camp (hors villageois et loups)",children:e.jsx("div",{style:{height:400},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(A,{data:d,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(F,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(P,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(C,{content:({active:t,payload:a})=>{if(t&&a&&a.length>0){const o=a[0].payload,h=d.reduce((y,G)=>y+G.totalGames,0),m=(o.totalGames/h*100).toFixed(1);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:o.camp})}),e.jsxs("div",{children:["Parties: ",o.totalGames," (",m,"%)"]}),e.jsxs("div",{children:["Taux victoire: ",o.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(M,{dataKey:"totalGames",onClick:t=>{t&&t.camp&&r({campFilter:{selectedCamp:t.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Distribution des Parties par Camp"})},style:{cursor:"pointer"},children:d.map((t,a)=>e.jsx(v,{fill:c[t.camp]||`var(--chart-color-${a%6+1})`,onClick:()=>{r({campFilter:{selectedCamp:t.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Distribution des Parties par Camp"})},style:{cursor:"pointer"}},`cell-${a}`))})]})})})})]})]})]}),e.jsx("div",{className:"lycans-stats-note",style:{marginTop:"2rem",padding:"1rem",textAlign:"center",color:"var(--text-secondary)",fontSize:"0.9rem",fontStyle:"italic"},children:"Statistiques basées sur les rôles effectifs des joueurs à la fin des parties."})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de camp disponible"})}export{pe as CampsChart};
