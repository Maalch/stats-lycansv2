import{g as q,e as _,a as w,b as O,r as f,j as e}from"./index-DBGRQR6K.js";import{a as K}from"./baseStatsHook-Chof8dKQ.js";import{b as V,c as X}from"./datasyncExport-BirWLS1z.js";import{u as Y}from"./useJoueursData-BQiNihWa.js";import{M as J,u as U,C as A,c as Q}from"./api-C59Mtlah.js";import{F as D,C as z,X as G,Y as M,a as I}from"./FullscreenChart-DHC8_uz0.js";import{R as N,T as R}from"./CategoricalChart-DlidMfHQ.js";import{B as k,a as H}from"./BarChart-B2BvLLs6.js";function Z(g){return g.PlayerStats.some(p=>p.TotalCollectedLoot!==void 0&&p.TotalCollectedLoot!==null)}function ee(g,p="all"){if(!g||g.length===0)return null;const y=g.filter(Z);if(y.length===0)return{playerStats:[],totalGames:g.length,gamesWithLootData:0};const a=new Map;return y.forEach(u=>{u.PlayerStats.forEach(l=>{const m=q(l),j=_(l);if(l.TotalCollectedLoot===void 0||l.TotalCollectedLoot===null||p!=="all"&&V(l.MainRoleInitial,l.Power)!=={all:"",villageois:"Villageois",loup:"Loup",autres:"Autres"}[p])return;const x=l.DeathDateIrl||u.EndDate,d=X(u.StartDate,x);if(!d||d<=0)return;a.has(m)||a.set(m,{displayName:j,gamesPlayed:0,totalLoot:0,maxLootInGame:0,recordGameId:u.DisplayedId,totalGameDurationSeconds:0});const v=a.get(m);v.gamesPlayed++,v.totalLoot+=l.TotalCollectedLoot,l.TotalCollectedLoot>v.maxLootInGame&&(v.maxLootInGame=l.TotalCollectedLoot,v.recordGameId=u.DisplayedId),v.totalGameDurationSeconds+=d})}),{playerStats:Array.from(a.entries()).map(([u,l])=>{const m=l.totalGameDurationSeconds>0?3600/l.totalGameDurationSeconds:0;return{player:l.displayName,gamesPlayed:l.gamesPlayed,totalLoot:l.totalLoot,averageLoot:l.gamesPlayed>0?l.totalLoot/l.gamesPlayed:0,maxLootInGame:l.maxLootInGame,recordGameId:l.recordGameId,totalGameDurationSeconds:l.totalGameDurationSeconds,lootPer60Min:l.totalLoot*m}}),totalGames:g.length,gamesWithLootData:y.length}}function te(g="all"){const{data:p,isLoading:y,error:a}=K(c=>ee(c,g));return{data:p,isLoading:y,error:a}}const re=Q.COMPACT;function he(){const{navigateToGameDetails:g,navigationState:p,updateNavigationState:y}=w(),{settings:a}=O(),[c,u]=f.useState(p.lootStatsState?.minGames||J.STANDARD),[l,m]=f.useState(p.lootStatsState?.campFilter||"all"),[j,x]=f.useState(null),{data:d,isLoading:v,error:P}=te(l),{joueursData:F}=Y(),S=U(F);f.useEffect(()=>{const t=p.lootStatsState;(!t||t.minGames!==c||t.campFilter!==l)&&y({lootStatsState:{minGames:c,campFilter:l}})},[c,l,y]);const{totalLootChartData:L,highlightedPlayerAddedTotal:W}=f.useMemo(()=>{if(!d?.playerStats)return{totalLootChartData:[],highlightedPlayerAddedTotal:!1};const t=d.playerStats,o=t.sort((s,h)=>h.totalLoot-s.totalLoot).slice(0,A.TOP_20),r=a.highlightedPlayer&&o.some(s=>s.player===a.highlightedPlayer);let i=[...o],n=!1;if(a.highlightedPlayer&&!r){const s=t.find(h=>h.player===a.highlightedPlayer);s&&(i.push({...s,isHighlightedAddition:!0}),n=!0)}return{totalLootChartData:i,highlightedPlayerAddedTotal:n}},[d,a.highlightedPlayer]),{recordLootChartData:T,highlightedPlayerAddedRecord:E}=f.useMemo(()=>{if(!d?.playerStats)return{recordLootChartData:[],highlightedPlayerAddedRecord:!1};const t=d.playerStats,o=t.sort((s,h)=>h.maxLootInGame-s.maxLootInGame).slice(0,A.TOP_20),r=a.highlightedPlayer&&o.some(s=>s.player===a.highlightedPlayer);let i=[...o],n=!1;if(a.highlightedPlayer&&!r){const s=t.find(h=>h.player===a.highlightedPlayer);s&&(i.push({...s,isHighlightedAddition:!0}),n=!0)}return{recordLootChartData:i,highlightedPlayerAddedRecord:n}},[d,a.highlightedPlayer]),{normalizedLootChartData:b,highlightedPlayerAddedNormalized:B}=f.useMemo(()=>{if(!d?.playerStats)return{normalizedLootChartData:[],highlightedPlayerAddedNormalized:!1};const t=d.playerStats,r=t.filter(h=>h.gamesPlayed>=c).sort((h,C)=>C.lootPer60Min-h.lootPer60Min).slice(0,A.TOP_20),i=a.highlightedPlayer&&r.some(h=>h.player===a.highlightedPlayer);let n=[...r],s=!1;if(a.highlightedPlayer&&!i){const h=t.find(C=>C.player===a.highlightedPlayer);h&&(n.push({...h,isHighlightedAddition:!0}),s=!0)}return{normalizedLootChartData:n,highlightedPlayerAddedNormalized:s}},[d,c,a.highlightedPlayer]);if(v)return e.jsx("div",{className:"donnees-attente",children:"R√©cup√©ration des statistiques de loot..."});if(P)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",P]});if(!d)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de loot disponible"});const $=d.playerStats.filter(t=>t.gamesPlayed>=c).length;return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques de R√©colte de Loot"}),e.jsxs("p",{className:"lycans-stats-info",children:[d.gamesWithLootData," parties avec donn√©es de loot collect√©."]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Total Loot Collect√©"}),W&&a.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',a.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:l,onChange:t=>m(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"villageois",children:"Camp Villageois"}),e.jsx("option",{value:"loup",children:"Camp Loup"}),e.jsx("option",{value:"autres",children:"Autres (Solo)"})]})]}),e.jsx(D,{title:"Total Loot Collect√©",children:e.jsx("div",{style:{height:400},children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(k,{data:L,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(z,{strokeDasharray:"3 3"}),e.jsx(G,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:o,payload:r})=>e.jsx("text",{x:t,y:o,dy:16,textAnchor:"end",fill:a.highlightedPlayer===r.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:a.highlightedPlayer===r.value?14:13,fontWeight:a.highlightedPlayer===r.value?"bold":"italic",transform:`rotate(-45 ${t} ${o})`,children:r.value})}),e.jsx(M,{label:{value:"Loot total collect√©",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(R,{content:({active:t,payload:o})=>{if(t&&o&&o.length>0){const r=o[0].payload,i=r.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:r.player}),e.jsxs("div",{children:["Parties jou√©es: ",r.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Loot collect√©:"})}),e.jsxs("div",{children:["Total: ",r.totalLoot.toLocaleString()]}),e.jsxs("div",{children:["Moyenne par partie: ",r.averageLoot.toFixed(1)]}),e.jsxs("div",{children:["Taux (par 60 min): ",r.lootPer60Min.toFixed(1)]}),i&&e.jsxs("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:["üéØ Affich√© via s√©lection personnelle",r.gamesPlayed<c&&` (< ${c} parties)`]})]})}return null}}),e.jsx(H,{dataKey:"totalLoot",children:L.map((t,o)=>{const r=a.highlightedPlayer===t.player,i=j===t.player,n=t.isHighlightedAddition,s=S[t.player]||"var(--chart-primary)";return e.jsx(I,{fill:r?"var(--accent-primary)":n?"var(--accent-secondary)":s,stroke:r?"var(--accent-primary)":i?"#000000":"none",strokeWidth:r?3:i?2:0,strokeDasharray:n?"5,5":"none",opacity:n?.8:1,onClick:()=>g({selectedPlayer:t.player,fromComponent:"Total Loot Collect√©"}),onMouseEnter:()=>x(t.player),onMouseLeave:()=>x(null),style:{cursor:"pointer"}},`cell-${o}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",L.length," des joueurs (tous joueurs inclus)"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Calcul√© sur ",d.gamesWithLootData," parties avec donn√©es de loot"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Taux de R√©colte (par 60 min)"}),B&&a.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',a.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select-normalized",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select-normalized",value:l,onChange:t=>m(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"villageois",children:"Camp Villageois"}),e.jsx("option",{value:"loup",children:"Camp Loup"}),e.jsx("option",{value:"autres",children:"Autres (Solo)"})]}),e.jsx("label",{htmlFor:"min-games-select-normalized",style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginLeft:"1rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select-normalized",value:c,onChange:t=>u(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:re.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx(D,{title:"Taux de R√©colte (par 60 min)",children:e.jsx("div",{style:{height:400},children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(k,{data:b,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(z,{strokeDasharray:"3 3"}),e.jsx(G,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:o,payload:r})=>e.jsx("text",{x:t,y:o,dy:16,textAnchor:"end",fill:a.highlightedPlayer===r.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:a.highlightedPlayer===r.value?14:13,fontWeight:a.highlightedPlayer===r.value?"bold":"italic",transform:`rotate(-45 ${t} ${o})`,children:r.value})}),e.jsx(M,{label:{value:"Loot par 60 minutes",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(R,{content:({active:t,payload:o})=>{if(t&&o&&o.length>0){const r=o[0].payload,i=r.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:r.player}),e.jsxs("div",{children:["Parties jou√©es: ",r.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Taux normalis√© (par 60 min):"})}),e.jsxs("div",{children:[r.lootPer60Min.toFixed(1)," loot/heure"]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Statistiques globales:"})}),e.jsxs("div",{children:["Total: ",r.totalLoot.toLocaleString()]}),e.jsxs("div",{children:["Moyenne par partie: ",r.averageLoot.toFixed(1)]}),i&&e.jsxs("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:["üéØ Affich√© via s√©lection personnelle",r.gamesPlayed<c&&` (< ${c} parties)`]})]})}return null}}),e.jsx(H,{dataKey:"lootPer60Min",children:b.map((t,o)=>{const r=a.highlightedPlayer===t.player,i=j===t.player,n=t.isHighlightedAddition,s=S[t.player]||"var(--chart-primary)";return e.jsx(I,{fill:r?"var(--accent-primary)":n?"var(--accent-secondary)":s,stroke:r?"var(--accent-primary)":i?"#000000":"none",strokeWidth:r?3:i?2:0,strokeDasharray:n?"5,5":"none",opacity:n?.8:1,onClick:()=>g({selectedPlayer:t.player,fromComponent:"Taux de R√©colte (par 60 min)"}),onMouseEnter:()=>x(t.player),onMouseLeave:()=>x(null),style:{cursor:"pointer"}},`cell-${o}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",b.length," des joueurs (sur ",$," ayant au moins ",c," partie",c>1?"s":"",")"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Taux normalis√© par 60 minutes de jeu ¬∑ Calcul√© sur ",d.gamesWithLootData," parties avec donn√©es"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Record de Loot par Partie"}),E&&a.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',a.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select-record",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select-record",value:l,onChange:t=>m(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"villageois",children:"Camp Villageois"}),e.jsx("option",{value:"loup",children:"Camp Loup"}),e.jsx("option",{value:"autres",children:"Autres (Solo)"})]})]}),e.jsx(D,{title:"Record de Loot par Partie",children:e.jsx("div",{style:{height:400},children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(k,{data:T,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(z,{strokeDasharray:"3 3"}),e.jsx(G,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:o,payload:r})=>e.jsx("text",{x:t,y:o,dy:16,textAnchor:"end",fill:a.highlightedPlayer===r.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:a.highlightedPlayer===r.value?14:13,fontWeight:a.highlightedPlayer===r.value?"bold":"italic",transform:`rotate(-45 ${t} ${o})`,children:r.value})}),e.jsx(M,{label:{value:"Loot record en une partie",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(R,{content:({active:t,payload:o})=>{if(t&&o&&o.length>0){const r=o[0].payload,i=r.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:r.player}),e.jsxs("div",{children:["Parties jou√©es: ",r.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Record de loot:"})}),e.jsxs("div",{children:[r.maxLootInGame.toLocaleString()," loot en une partie"]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Statistiques globales:"})}),e.jsxs("div",{children:["Total: ",r.totalLoot.toLocaleString()]}),e.jsxs("div",{children:["Moyenne par partie: ",r.averageLoot.toFixed(1)]}),i&&e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:"üéØ Affich√© via s√©lection personnelle"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir la partie record"})]})}return null}}),e.jsx(H,{dataKey:"maxLootInGame",children:T.map((t,o)=>{const r=a.highlightedPlayer===t.player,i=j===t.player,n=t.isHighlightedAddition,s=S[t.player]||"var(--chart-primary)";return e.jsx(I,{fill:r?"var(--accent-primary)":n?"var(--accent-secondary)":s,stroke:r?"var(--accent-primary)":i?"#000000":"none",strokeWidth:r?3:i?2:0,strokeDasharray:n?"5,5":"none",opacity:n?.8:1,onClick:()=>g({selectedPlayer:t.player,selectedGame:t.recordGameId,fromComponent:"Record de Loot"}),onMouseEnter:()=>x(t.player),onMouseLeave:()=>x(null),style:{cursor:"pointer"}},`cell-${o}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",T.length," des joueurs (tous joueurs inclus)"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Meilleur score de loot collect√© en une seule partie ¬∑ Calcul√© sur ",d.gamesWithLootData," parties avec donn√©es"]})]})]})]})}export{he as LootStatisticsChart};
