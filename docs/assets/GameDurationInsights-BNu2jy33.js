import{r as N,j as e}from"./index-D_x1uEpI.js";import{q as C,R as x,B as g,C as p,X as j,Y as D,T as f,o as b,a9 as R}from"./useRawGameData-B1KsWxQ4.js";import{L as W,a as P}from"./LineChart-Di1G-Vju.js";import{L as B}from"./Legend-B8D9DSdQ.js";function L(){const{data:i,isLoading:m,error:c}=C();return{durationAnalysis:N.useMemo(()=>{if(!i||i.length===0)return null;const a={averageDays:"0",maxDays:0,minDays:99,dayDistribution:{},daysByWinnerCamp:{},daysByPlayerCount:{},daysByWolfRatio:{}};let r=0,t=0;i.forEach(n=>{const s=n["Nombre de journées"],l=n["Camp victorieux"],d=n["Nombre de joueurs"],h=n["Nombre de loups"];if(s&&!isNaN(s)&&s>0){if(t++,r+=s,s>a.maxDays&&(a.maxDays=s),s<a.minDays&&(a.minDays=s),a.dayDistribution[s]||(a.dayDistribution[s]=0),a.dayDistribution[s]++,l&&l.trim()!==""&&(a.daysByWinnerCamp[l]||(a.daysByWinnerCamp[l]={totalDays:0,count:0,average:"0"}),a.daysByWinnerCamp[l].totalDays+=s,a.daysByWinnerCamp[l].count++),d&&!isNaN(d)&&d>0){const y=d.toString();a.daysByPlayerCount[y]||(a.daysByPlayerCount[y]={totalDays:0,count:0,average:"0"}),a.daysByPlayerCount[y].totalDays+=s,a.daysByPlayerCount[y].count++}if(d&&h&&!isNaN(d)&&!isNaN(h)&&d>0){const y=Math.round(h/d*100),u=(Math.round(y/1)*1).toString();a.daysByWolfRatio[u]||(a.daysByWolfRatio[u]={totalDays:0,count:0,average:"0"}),a.daysByWolfRatio[u].totalDays+=s,a.daysByWolfRatio[u].count++}}}),t>0&&(a.averageDays=(r/t).toFixed(1),Object.keys(a.daysByWinnerCamp).forEach(n=>{const s=a.daysByWinnerCamp[n];s.count>0&&(s.average=(s.totalDays/s.count).toFixed(1))}),Object.keys(a.daysByPlayerCount).forEach(n=>{const s=a.daysByPlayerCount[n];s.count>0&&(s.average=(s.totalDays/s.count).toFixed(1))}),Object.keys(a.daysByWolfRatio).forEach(n=>{const s=a.daysByWolfRatio[n];s.count>0&&(s.average=(s.totalDays/s.count).toFixed(1))}));const o=Object.keys(a.dayDistribution).map(n=>({days:parseInt(n),count:a.dayDistribution[parseInt(n)]}));return o.sort((n,s)=>n.days-s.days),{averageDays:a.averageDays,maxDays:a.maxDays,minDays:a.minDays,dayDistribution:o,daysByWinnerCamp:a.daysByWinnerCamp,daysByPlayerCount:a.daysByPlayerCount,daysByWolfRatio:a.daysByWolfRatio}},[i]),fetchingData:m,apiError:c}}function q(){const{durationAnalysis:i,fetchingData:m,apiError:c}=L();if(m)return e.jsx("div",{className:"statistiques-attente",children:"Analyse des durées de partie en cours..."});if(c)return e.jsxs("div",{className:"statistiques-echec",children:["Problème rencontré: ",c]});if(!i)return e.jsx("div",{className:"statistiques-indisponibles",children:"Données d'analyse non disponibles"});const v=i?Object.entries(i.daysByWolfRatio).map(([r,t])=>({ratio:`${parseFloat(r).toFixed(0)}%`,moyenne:parseFloat(t.average),parties:t.count})).sort((r,t)=>parseFloat(r.ratio)-parseFloat(t.ratio)):[],a=i?Object.entries(i.daysByWinnerCamp).map(([r,t])=>({camp:r,moyenne:parseFloat(t.average),parties:t.count})).sort((r,t)=>t.moyenne-r.moyenne):[];return e.jsxs("div",{className:"lycans-duree-analyse",children:[e.jsx("h2",{children:"Analyse des Durées de Partie"}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Moyenne"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[i.averageDays," jours"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Minimum"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[i.minDays," jours"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Maximum"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[i.maxDays," jours"]})]})]}),e.jsxs("div",{className:"lycans-graphiques-section",children:[e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Distribution des Durées de Partie"}),e.jsx("div",{style:{height:300},children:e.jsx(x,{width:"100%",height:"100%",children:e.jsxs(g,{data:i?.dayDistribution||[],margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(p,{strokeDasharray:"3 3"}),e.jsx(j,{dataKey:"days",label:{value:"Nombre de Jours",position:"insideBottom",offset:-5}}),e.jsx(D,{label:{value:"Nombre de Parties",angle:-90,position:"insideLeft"}}),e.jsx(f,{content:({active:r,payload:t})=>{if(r&&t&&t.length>0){const o=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsxs("strong",{children:[o.days," jours"]})}),e.jsxs("div",{children:[o.count," parties"]})]})}return null}}),e.jsx(b,{dataKey:"count",name:"Nombre de Parties",fill:"var(--chart-color-2)"})]})})})]}),e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Durée Moyenne par Ratio Loups/Joueurs"}),e.jsx("div",{style:{height:300},children:e.jsx(x,{width:"100%",height:"100%",children:e.jsxs(W,{data:v,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(p,{strokeDasharray:"3 3"}),e.jsx(j,{dataKey:"ratio",label:{value:"Ratio Loups/Joueurs (%)",position:"insideBottom",offset:-5}}),e.jsx(D,{label:{value:"Durée Moyenne (jours)",angle:-90,position:"insideLeft"}}),e.jsx(f,{content:({active:r,payload:t})=>{if(r&&t&&t.length>0){const o=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Pourcentage de loups : ",o.ratio]})}),e.jsxs("div",{children:["Durée moyenne : ",o.moyenne," jours"]}),e.jsxs("div",{children:["Nombre de parties : ",o.parties]})]})}return null}}),e.jsx(B,{}),e.jsx(P,{type:"monotone",dataKey:"moyenne",name:"Durée Moyenne",stroke:"var(--chart-color-5)",activeDot:{r:8}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Durée Moyenne par Camp Victorieux"}),e.jsx("div",{style:{height:300},children:e.jsx(x,{width:"100%",height:"100%",children:e.jsxs(g,{data:a,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(p,{strokeDasharray:"3 3"}),e.jsx(j,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(D,{label:{value:"Durée Moyenne (jours)",angle:-90,position:"insideLeft"}}),e.jsx(f,{content:({active:r,payload:t})=>{if(r&&t&&t.length>0){const o=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:o.camp})}),e.jsxs("div",{children:["Durée moyenne : ",o.moyenne," jours"]}),e.jsxs("div",{children:["Nombre de parties : ",o.parties]})]})}return null}}),e.jsx(B,{formatter:r=>r==="moyenne"?"Durée Moyenne":r}),e.jsx(b,{dataKey:"moyenne",name:"moyenne",fill:"var(--chart-color-4)",children:e.jsx(R,{dataKey:"moyenne",position:"top",formatter:r=>{const t=typeof r=="number"?r:Number(r);return isNaN(t)?"":`${t.toFixed(1)}j`},fill:"var(--text-primary)",fontSize:12})})]})})})]})]})]})}export{q as GameDurationInsights};
