import{a as R,r as c}from"./index-6OCtjujQ.js";function b(a){if(!a)return null;const[e,t,r]=a.split("/");return!e||!t||!r?null:new Date(Number(r),Number(t)-1,Number(e))}function P(a){return a?a.split(",").map(e=>e.trim()).filter(Boolean):[]}function L(a,e){return e&&e.trim()!==""?P(e).some(r=>r.toLowerCase()===a.toLowerCase()):!1}function A(a,e,t){return a[e]&&a[e][t]||"Villageois"}function B(a){const e={};return a.forEach(t=>{const r=t.Game?.toString();if(!r)return;e[r]||(e[r]={});const n=(i,s)=>{if(i&&i.toString().trim()!==""){const u=i.toString().trim();e[r][u]||(e[r][u]=s)}},l=(i,s)=>{i&&P(i.toString()).forEach(f=>{e[r][f]||(e[r][f]=s)})};l(t.Loups,"Loups"),n(t.Traître,"Traître"),n(t["Idiot du village"],"Idiot du Village"),n(t.Cannibale,"Cannibale"),n(t.Espion,"Espion"),n(t["La Bête"],"La Bête"),n(t["Chasseur de primes"],"Chasseur de primes"),n(t.Vaudou,"Vaudou"),l(t.Agent,"Agent"),l(t.Scientifique,"Scientifique"),l(t.Amoureux,"Amoureux")}),e}function E(a,e){return a===e||a==="Traître"&&e==="Loups"}function F(){const[a,e]=c.useState(null),[t,r]=c.useState(!0),[n,l]=c.useState(null);return c.useEffect(()=>{(async()=>{try{r(!0),l(null);const[s,u,f,d]=await Promise.all([fetch("/stats-lycansv2/data/rawGameData.json"),fetch("/stats-lycansv2/data/rawRoleData.json"),fetch("/stats-lycansv2/data/rawPonceData.json"),fetch("/stats-lycansv2/data/rawBRData.json")]);if(!s.ok)throw new Error("Failed to fetch game data");if(!u.ok)throw new Error("Failed to fetch role data");if(!f.ok)throw new Error("Failed to fetch ponce data");if(!d.ok)throw new Error("Failed to fetch BR data");const[o,m,y,D]=await Promise.all([s.json(),u.json(),f.json(),d.json()]);e({gameData:o.data||[],roleData:m.data||[],ponceData:y.data||[],brPartiesData:D.BRParties?.data||[],brRefPartiesData:D.BRRefParties?.data||[]})}catch(s){console.error("Error fetching combined raw data:",s),l(s instanceof Error?s.message:"Unknown error")}finally{r(!1)}})()},[]),{data:a,isLoading:t,error:n}}function p(a,e,t){return a.filter(r=>{let n=r;if(t&&r.Game){const l=t.find(i=>i.Game===r.Game);if(!l)return!1;n=l}if(e.filterMode==="gameType"&&e.gameFilter!=="all"){if(e.gameFilter==="modded"){if(!n["Game Moddée"])return!1}else if(e.gameFilter==="non-modded"&&n["Game Moddée"])return!1}else if(e.filterMode==="dateRange"&&(e.dateRange.start||e.dateRange.end)){const l=b(n.Date);if(!l)return!1;if(e.dateRange.start){const i=new Date(e.dateRange.start);if(l<i)return!1}if(e.dateRange.end){const i=new Date(e.dateRange.end);if(l>i)return!1}}return!0})}function G(a,e){return e.playerFilter.mode==="none"||e.playerFilter.players.length===0?a:a.filter(t=>{const r=t["Liste des joueurs"].toLowerCase();return e.playerFilter.mode==="include"?e.playerFilter.players.every(l=>r.includes(l.toLowerCase())):e.playerFilter.mode==="exclude"?!e.playerFilter.players.some(l=>r.includes(l.toLowerCase())):!0})}function h(a,e){return e.playerFilter.mode==="none"||e.playerFilter.players.length===0?a:a.filter(t=>{const r=t.Participants.toLowerCase();return e.playerFilter.mode==="include"?e.playerFilter.players.some(n=>r.includes(n.toLowerCase())):e.playerFilter.mode==="exclude"?!e.playerFilter.players.some(n=>r.includes(n.toLowerCase())):!0})}function w(){const{settings:a}=R(),{data:e,isLoading:t,error:r}=F();return{...c.useMemo(()=>{if(!e)return{gameData:null,roleData:null,ponceData:null,brPartiesData:null,brRefPartiesData:null};let l=p(e.gameData,a);l=G(l,a);const i=new Set(l.map(o=>o.Game)),s=e.roleData.filter(o=>i.has(o.Game)),u=e.ponceData.filter(o=>i.has(o.Game));let f=e.brPartiesData.filter(o=>{if(!o.Game||!o.Participants)return!1;const m=e.brRefPartiesData.find(D=>D.Game===o.Game);return m?p([o],a,[m]).length===0?!1:h([o],a).length>0:h([o],a).length>0});const d=p(e.brRefPartiesData,a);return{gameData:l,roleData:s,ponceData:u,brPartiesData:f,brRefPartiesData:d}},[e,a]),isLoading:t,error:r}}function g(a,e={requireGameData:!0,requireRoleData:!1,requirePonceData:!1}){const{gameData:t,roleData:r,ponceData:n,isLoading:l,error:i}=w();return{data:c.useMemo(()=>e.requireGameData&&(!t||t.length===0)||e.requireRoleData&&(!r||r.length===0)||e.requirePonceData&&(!n||n.length===0)?null:a({gameData:t||[],roleData:r||[],ponceData:n||[]}),[t,r,n,a,e]),isLoading:l,error:i}}function S(a){return g(({gameData:e})=>a(e),{requireGameData:!0})}function j(a){return g(({gameData:e,roleData:t})=>a(e,t),{requireGameData:!0,requireRoleData:!0})}export{L as a,B as b,S as c,E as d,A as g,P as s,j as u};
