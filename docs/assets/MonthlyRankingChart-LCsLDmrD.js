import{u as te,a as re,d as ae,r as d,g as E,j as e}from"./index-B6-ZDmny.js";import{u as ne}from"./useJoueursData-Bma9qUaM.js";import{u as se,C as ie}from"./api-ma3lPlZA.js";import{F as oe,C as le,X as de,Y as ce}from"./FullscreenChart-DU237GTc.js";import{R as me,T as he,a as ue}from"./CategoricalChart-CtlM5tN3.js";import{B as ge,a as ye}from"./BarChart-DhWC9GbS.js";import{R as pe}from"./ReferenceLine-C8bfpJQi.js";import"./CartesianScaleHelper-B5QcuZLv.js";const z=.4,fe=["Janvier","FÃ©vrier","Mars","Avril","Mai","Juin","Juillet","AoÃ»t","Septembre","Octobre","Novembre","DÃ©cembre"];function K(S){const[F,D]=S.split("-"),m=parseInt(D,10)-1;return`${fe[m]} ${F}`}function Ce(){const{navigationState:S,updateNavigationState:F,navigateToGameDetails:D}=te(),{settings:m}=re(),{gameData:M}=ae(),{joueursData:L}=ne(),O=se(L),[J,W]=d.useState(null),[P,H]=d.useState(S.monthlyRankingState?.selectedMonth||null),[v,T]=d.useState(!1),[a,I]=d.useState(S.monthlyRankingState?.currentGameIndex||0),[w,V]=d.useState(S.monthlyRankingState?.playSpeed||1e3),j=d.useRef(null);d.useEffect(()=>{const t=S.monthlyRankingState;(!t||t.selectedMonth!==P||t.currentGameIndex!==a||t.playSpeed!==w)&&F({monthlyRankingState:{selectedMonth:P||void 0,currentGameIndex:a,playSpeed:w}})},[P,a,w,F]);const{months:_,monthKeys:u}=d.useMemo(()=>{if(!M||M.length===0)return{months:new Map,monthKeys:[]};const t=new Map;for(const h of M){const c=new Date(h.StartDate),s=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`;t.has(s)||t.set(s,[]),t.get(s).push(h)}const l=new Map;for(const[h,c]of t){const s=c.length,p=Math.ceil(s*z),f=new Map;for(const i of c)for(const x of i.PlayerStats){const o=E(x);f.has(o)||f.set(o,{displayName:x.Username,gamesPlayed:0,wins:0});const g=f.get(o);g.gamesPlayed++,x.Victorious&&g.wins++}const b=[];for(const[,i]of f)i.gamesPlayed>=p&&b.push({player:i.displayName,gamesPlayed:i.gamesPlayed,wins:i.wins,winPercent:i.gamesPlayed>0?(i.wins/i.gamesPlayed*100).toFixed(1):"0.0"});b.sort((i,x)=>parseFloat(x.winPercent)-parseFloat(i.winPercent)),l.set(h,{key:h,label:K(h),totalGames:s,players:b,sortedGames:c})}const n=[...l.keys()].sort();return{months:l,monthKeys:n}},[M]),G=d.useMemo(()=>P&&u.includes(P)?P:u.length>0?u[u.length-1]:null,[P,u]),r=G?_.get(G):null;d.useEffect(()=>{I(0),T(!1),j.current&&(clearInterval(j.current),j.current=null)},[G]);const{chartData:N,highlightedPlayerAdded:Y,averageWinRate:q,minGamesRequired:C,effectiveTotalGames:$}=d.useMemo(()=>{if(!r)return{chartData:[],highlightedPlayerAdded:!1,averageWinRate:"0",minGamesRequired:0,effectiveTotalGames:0};const t=a>0,l=t?r.sortedGames.slice(0,a):r.sortedGames,n=t?a:r.totalGames,h=Math.ceil(n*z),c=new Map;for(const o of l)for(const g of o.PlayerStats){const y=E(g);c.has(y)||c.set(y,{displayName:g.Username,gamesPlayed:0,wins:0});const B=c.get(y);B.gamesPlayed++,g.Victorious&&B.wins++}const s=[];for(const[,o]of c)o.gamesPlayed>=h&&s.push({player:o.displayName,gamesPlayed:o.gamesPlayed,wins:o.wins,winPercent:o.gamesPlayed>0?(o.wins/o.gamesPlayed*100).toFixed(1):"0.0"});s.sort((o,g)=>parseFloat(g.winPercent)-parseFloat(o.winPercent));const p=s.slice(0,ie.TOP_15);let f=0;for(const o of s)f+=parseFloat(o.winPercent);const b=s.length>0?(f/s.length).toFixed(1):"0";let i=[...p],x=!1;if(m.highlightedPlayer&&!p.some(g=>g.player===m.highlightedPlayer)){const g=s.find(y=>y.player===m.highlightedPlayer);if(g)i.push({...g,isHighlightedAddition:!0}),x=!0;else{const y=c.get(m.highlightedPlayer);y&&y.gamesPlayed>0&&(i.push({player:m.highlightedPlayer,gamesPlayed:y.gamesPlayed,wins:y.wins,winPercent:(y.wins/y.gamesPlayed*100).toFixed(1),isHighlightedAddition:!0}),x=!0)}}return{chartData:i,highlightedPlayerAdded:x,averageWinRate:b,minGamesRequired:h,effectiveTotalGames:n}},[r,m.highlightedPlayer,a]),R=G?u.indexOf(G):-1,k=R>0,A=R<u.length-1,U=d.useCallback(()=>{k&&H(u[R-1])},[k,R,u]),X=d.useCallback(()=>{A&&H(u[R+1])},[A,R,u]);d.useEffect(()=>{if(!(!v||!r))return j.current=setInterval(()=>{I(t=>{const l=t+1;return l>r.totalGames?(T(!1),0):l})},w),()=>{j.current&&(clearInterval(j.current),j.current=null)}},[v,w,r]);const Q=d.useCallback(()=>{a===0&&!v&&I(1),T(!v)},[v,a]),Z=d.useCallback(()=>{T(!1),r&&I(t=>t===0?Math.max(1,r.totalGames-1):Math.max(1,t-1))},[r]),ee=d.useCallback(()=>{T(!1),I(t=>r?t===0?0:Math.min(r.totalGames,t+1):t)},[r]);return!M||M.length===0?e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible pour le classement mensuel"}):u.length===0?e.jsx("div",{className:"donnees-manquantes",children:"Aucun mois avec des parties trouvÃ©"}):e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Classement Mensuel"}),e.jsxs("p",{className:"lycans-stats-info",children:["Classement des joueurs par taux de victoire pour chaque mois",e.jsx("br",{}),e.jsx("span",{style:{fontSize:"0.85rem",fontStyle:"italic"},children:"Seuls les joueurs ayant participÃ© Ã  au moins 40% des parties du mois sont classÃ©s"})]}),e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Classement Mensuel â€” Taux de Victoire"}),Y&&m.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',m.highlightedPlayer,'" affichÃ© en plus du classement']})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1rem"},children:[e.jsx("button",{onClick:U,disabled:!k,style:{background:"var(--bg-tertiary)",color:k?"var(--text-primary)":"var(--text-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.4rem 0.8rem",fontSize:"1rem",cursor:k?"pointer":"not-allowed",opacity:k?1:.5},children:"â—€"}),e.jsx("select",{value:G||"",onChange:t=>H(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.95rem",fontWeight:"bold",minWidth:"180px",textAlign:"center"},children:u.map(t=>e.jsx("option",{value:t,children:K(t)},t))}),e.jsx("button",{onClick:X,disabled:!A,style:{background:"var(--bg-tertiary)",color:A?"var(--text-primary)":"var(--text-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.4rem 0.8rem",fontSize:"1rem",cursor:A?"pointer":"not-allowed",opacity:A?1:.5},children:"â–¶"})]}),r&&r.totalGames>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1rem",padding:"0.75rem",background:"var(--bg-tertiary)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:[e.jsx("button",{onClick:Z,disabled:!r||r.totalGames===0,style:{background:"var(--bg-secondary)",color:r&&r.totalGames>0?"var(--text-primary)":"var(--text-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.4rem 0.8rem",fontSize:"0.9rem",cursor:r&&r.totalGames>0?"pointer":"not-allowed",opacity:r&&r.totalGames>0?1:.5},children:"â—€ PrÃ©cÃ©dente"}),e.jsx("button",{onClick:Q,disabled:r.totalGames===0,style:{background:v?"var(--accent-primary)":"var(--bg-secondary)",color:v?"var(--accent-primary-text)":"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem 1.2rem",fontSize:"1rem",fontWeight:"bold",cursor:r.totalGames>0?"pointer":"not-allowed",opacity:r.totalGames>0?1:.5,minWidth:"120px"},children:v?"â¸ Pause":"â–¶ Play"}),e.jsx("button",{onClick:ee,disabled:a===0||a>=r.totalGames,style:{background:"var(--bg-secondary)",color:a>0&&a<r.totalGames?"var(--text-primary)":"var(--text-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.4rem 0.8rem",fontSize:"0.9rem",cursor:a>0&&a<r.totalGames?"pointer":"not-allowed",opacity:a>0&&a<r.totalGames?1:.5},children:"Suivante â–¶"}),e.jsxs("select",{value:w,onChange:t=>V(Number(t.target.value)),style:{background:"var(--bg-secondary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.4rem 0.6rem",fontSize:"0.9rem",marginLeft:"0.5rem"},children:[e.jsx("option",{value:2e3,children:"Lent (2s)"}),e.jsx("option",{value:1e3,children:"Normal (1s)"}),e.jsx("option",{value:500,children:"Rapide (0.5s)"})]}),a>0&&e.jsxs("div",{style:{marginLeft:"1rem",fontSize:"0.9rem",color:"var(--text-primary)",fontWeight:"bold"},children:["Partie ",a," / ",r.totalGames]})]}),e.jsx(oe,{title:`Classement Mensuel â€” ${r?.label||""}`,children:e.jsx("div",{style:{height:400},children:N.length===0?e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--text-secondary)",fontSize:"1rem"},children:["Aucun joueur n'a jouÃ© au moins ",C," partie",C>1?"s":""," ce mois-ci (",Math.round(z*100),"% de ",r?.totalGames??0," parties)"]}):e.jsx(me,{width:"100%",height:"100%",children:e.jsxs(ge,{data:N,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(le,{strokeDasharray:"3 3"}),e.jsx(de,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:l,payload:n})=>e.jsx("text",{x:t,y:l,dy:16,textAnchor:"end",fill:m.highlightedPlayer===n.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:m.highlightedPlayer===n.value?14:13,fontWeight:m.highlightedPlayer===n.value?"bold":"italic",transform:`rotate(-45 ${t} ${l})`,children:n.value})}),e.jsx(ce,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(he,{content:({active:t,payload:l})=>{if(t&&l&&l.length>0){const n=l[0].payload,h=n.isHighlightedAddition,c=m.highlightedPlayer===n.player,s=n.gamesPlayed>=C;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:n.player})}),e.jsxs("div",{children:["Taux de victoire : ",n.winPercent,"%"]}),e.jsxs("div",{children:["Victoires : ",n.wins," / ",n.gamesPlayed," parties"]}),h&&!s&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",C," parties requises)"]}),h&&s&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"}),c&&!h&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(ye,{dataKey:"winPercent",name:"Taux de Victoire",fill:"#8884d8",shape:t=>{const{x:l,y:n,width:h,height:c,payload:s}=t,p=s,f=m.highlightedPlayer===p.player,b=J===p.player,i=p.isHighlightedAddition;return e.jsx(ue,{x:l,y:n,width:h,height:c,fill:O[p.player]||"#8884d8",stroke:f?"var(--accent-primary)":b?"var(--text-primary)":"none",strokeWidth:f?3:b?2:0,strokeDasharray:i?"5,5":"none",opacity:i?.8:1,onClick:()=>{D({selectedPlayer:p.player,selectedPlayerWinMode:"wins-only",fromComponent:`Classement Mensuel â€” ${r?.label||""}`})},onMouseEnter:()=>W(p.player),onMouseLeave:()=>W(null),style:{cursor:"pointer"}})}}),e.jsx(pe,{y:parseFloat(q),stroke:"red",strokeDasharray:"3 3",label:{value:`Moyenne: ${q}%`,position:"insideBottomRight",fill:"red",fontSize:12,fontWeight:"bold"}})]})})})}),e.jsx("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:r&&e.jsxs(e.Fragment,{children:[N.filter(t=>!t.isHighlightedAddition).length," joueur",N.filter(t=>!t.isHighlightedAddition).length>1?"s":""," classÃ©",N.filter(t=>!t.isHighlightedAddition).length>1?"s":""," sur"," ",$," partie",$>1?"s":"",a>0?" (animation)":" ce mois"," ","(min. ",C," partie",C>1?"s":""," â€” ",Math.round(z*100),"%)"]})})]})})]})}export{Ce as MonthlyRankingChart};
