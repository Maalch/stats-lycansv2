import{u as O,r as B,a as w,j as t}from"./index-B5n87rWV.js";import{u as V}from"./baseStatsHook-C0TGBs8o.js";import{g as z}from"./gameUtils-C0qLdSzT.js";import{F as G,B as E,C as H,X as L,Y as F,a as W,b as I}from"./FullscreenChart-CsSk3B25.js";import{u as $}from"./api-D-WjL4AB.js";import{R,T as q}from"./CategoricalChart-Bxejipb4.js";function J(h){const s=new Set;h.filter(l=>!l.LegacyData||l.LegacyData.deathInformationFilled===!0).forEach(l=>{l.PlayerStats.forEach(x=>{if(l.PlayerStats.some(n=>n.KillerName===x.Username)){const n=z(x.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupTraitor:!0});s.add(n)}})});const m=Array.from(s),u=["Villageois","Loup","Amoureux"];return[...u.filter(l=>m.includes(l)),...m.filter(l=>!u.includes(l)).sort()]}function U(h){if(!h)return null;const s=h.match(/^([NJM])(\d+)$/);if(!s)return null;const[,g,m]=s,u=parseInt(m,10);let y;switch(g){case"N":y="Nuit";break;case"J":y="Jour";break;case"M":y="Meeting";break;default:return null}return{phase:y,day:u,originalString:h}}function Y(h){if(!h||h=="N/A")return"Survivant";const s=h.trim();return s.includes("vote")||s.includes("Vote")?"Mort aux votes":s.includes("Loup")||s.includes("loup")?"Tué par Loup":s.includes("Zombie")||s.includes("zombie")?"Tué par Zombie":s.includes("Chasseur")||s.includes("chasseur")?"Tué par Chasseur":s.includes("Déco")||s.includes("déco")?"Déconnexion":s.includes("Potion")||s.includes("potion")?"Tué par Potion":s}function X(h,s){return h.PlayerStats.filter(g=>g.DeathTiming||g.DeathType).map(g=>{let m=null;if(g.KillerName){const u=h.PlayerStats.find(y=>y.Username===g.KillerName);u&&(m=z(u.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupTraitor:!0}))}return{playerName:g.Username,deathTiming:U(g.DeathTiming),deathType:Y(g.DeathType),killerName:g.KillerName,killerCamp:m}}).filter(g=>!s||s==="Tous les camps"?!0:g.killerCamp===s)}function Z(h,s){if(h.length===0)return null;const g=h.filter(e=>!e.LegacyData||e.LegacyData.deathInformationFilled===!0);if(g.length===0)return null;const m=[],u={},y=new Set;g.forEach(e=>{const a=X(e,s);a.length>0&&y.add(e.Id),a.forEach(o=>{m.push({...o,gameId:e.Id})}),e.PlayerStats.forEach(o=>{const p=o.Username;(!s||s==="Tous les camps"||z(o.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupTraitor:!0})===s)&&(u[p]=(u[p]||0)+1)})});const l=m.length,x=g.length,D=y.size,n=x>0?l/x:0,T={},v={Nuit:0,Jour:0,Meeting:0};m.forEach(e=>{if(e.deathTiming){const a=`${e.deathTiming.phase}-${e.deathTiming.day}`;T[a]=(T[a]||0)+1,v[e.deathTiming.phase]++}});const b=Object.entries(T).map(([e,a])=>{const[o,p]=e.split("-");return{phase:o,day:parseInt(p,10),count:a,percentage:l>0?a/l*100:0}}).sort((e,a)=>{if(e.phase!==a.phase){const o={Nuit:0,Jour:1,Meeting:2};return o[e.phase]-o[a.phase]}return e.day-a.day}),N={};m.forEach(e=>{N[e.deathType]=(N[e.deathType]||0)+1});const j=Object.entries(N).map(([e,a])=>({type:e,count:a,percentage:l>0?a/l*100:0})).sort((e,a)=>a.count-e.count),f={};m.forEach(e=>{e.killerName&&(f[e.killerName]||(f[e.killerName]={kills:0,victims:new Set}),f[e.killerName].kills++,f[e.killerName].victims.add(e.playerName))});const k=Object.entries(f).map(([e,a])=>{const o=u[e]||0,p=o>0?a.kills/o:0;return{killerName:e,kills:a.kills,victims:Array.from(a.victims),percentage:l>0?a.kills/l*100:0,gamesPlayed:o,averageKillsPerGame:p}}).sort((e,a)=>a.kills-e.kills),S={};m.forEach(e=>{S[e.playerName]||(S[e.playerName]={totalDeaths:0,deathsByPhase:{Nuit:0,Jour:0,Meeting:0},deathsByType:{},killedBy:{},deathDays:[]});const a=S[e.playerName];a.totalDeaths++,e.deathTiming&&(a.deathsByPhase[e.deathTiming.phase]++,a.deathDays.push(e.deathTiming.day)),a.deathsByType[e.deathType]=(a.deathsByType[e.deathType]||0)+1,e.killerName&&(a.killedBy[e.killerName]=(a.killedBy[e.killerName]||0)+1)});const C=Object.entries(S).map(([e,a])=>({playerName:e,totalDeaths:a.totalDeaths,deathsByPhase:a.deathsByPhase,deathsByType:a.deathsByType,killedBy:a.killedBy,averageDeathDay:a.deathDays.length>0?a.deathDays.reduce((o,p)=>o+p,0)/a.deathDays.length:null,deathRate:u[e]>0?a.totalDeaths/u[e]:0})).sort((e,a)=>a.totalDeaths-e.totalDeaths),K=Object.entries(v).reduce((e,[a,o])=>o>e.count?{phase:a,count:o}:e,{phase:"Nuit",count:0}).phase,A={};m.forEach(e=>{e.deathTiming&&(A[e.deathTiming.day]=(A[e.deathTiming.day]||0)+1)});const r=Object.entries(A).reduce((e,[a,o])=>o>e.count?{day:parseInt(a,10),count:o}:e,{day:1,count:0}).day,d=j.length>0?j[0].type:"",c=k.length>0?k[0].killerName:null;return{totalDeaths:l,totalGames:x,gamesWithDeaths:D,averageDeathsPerGame:n,deathsByTiming:b,deathsByPhase:v,deathsByType:j,killerStats:k,playerDeathStats:C,mostDeadlyPhase:K,mostDeadlyDay:r,mostCommonDeathType:d,mostDeadlyKiller:c}}function Q(h){return V(s=>Z(s,h))}function _(){return V(h=>J(h))}function le(){const{navigateToGameDetails:h,navigationState:s,updateNavigationState:g}=O(),[m,u]=B.useState(s.deathStatsSelectedCamp||"Tous les camps"),{data:y}=_(),{data:l,isLoading:x,error:D}=Q(m),{settings:n}=w(),[T,v]=B.useState(null),b=$(),N=r=>{u(r),g({deathStatsSelectedCamp:r})},{totalKillsData:j,averageKillsData:f,highlightedPlayerAddedToTotal:k,highlightedPlayerAddedToAverage:S,gamesWithKillers:C}=B.useMemo(()=>{if(!l)return{totalKillsData:[],averageKillsData:[],highlightedPlayerAddedToTotal:!1,highlightedPlayerAddedToAverage:!1,gamesWithKillers:0};const r=l.killerStats.sort((i,P)=>P.kills-i.kills).slice(0,20),d=n.highlightedPlayer&&r.some(i=>i.killerName===n.highlightedPlayer),c=r.map(i=>({name:i.killerName,value:i.kills,victims:i.victims.length,percentage:i.percentage,gamesPlayed:i.gamesPlayed,averageKillsPerGame:i.averageKillsPerGame,isHighlightedAddition:!1}));let e=!1;if(n.highlightedPlayer&&!d){const i=l.killerStats.find(P=>P.killerName===n.highlightedPlayer);i&&(c.push({name:i.killerName,value:i.kills,victims:i.victims.length,percentage:i.percentage,gamesPlayed:i.gamesPlayed,averageKillsPerGame:i.averageKillsPerGame,isHighlightedAddition:!0}),e=!0)}const a=l.killerStats.sort((i,P)=>P.averageKillsPerGame-i.averageKillsPerGame).slice(0,20),o=n.highlightedPlayer&&a.some(i=>i.killerName===n.highlightedPlayer),p=a.map(i=>({name:i.killerName,value:i.averageKillsPerGame,victims:i.victims.length,percentage:i.percentage,gamesPlayed:i.gamesPlayed,averageKillsPerGame:i.averageKillsPerGame,isHighlightedAddition:!1}));let M=!1;if(n.highlightedPlayer&&!o){const i=l.killerStats.find(P=>P.killerName===n.highlightedPlayer);i&&(p.push({name:i.killerName,value:i.averageKillsPerGame,victims:i.victims.length,percentage:i.percentage,gamesPlayed:i.gamesPlayed,averageKillsPerGame:i.averageKillsPerGame,isHighlightedAddition:!0}),M=!0)}return{totalKillsData:c,averageKillsData:p,highlightedPlayerAddedToTotal:e,highlightedPlayerAddedToAverage:M,gamesWithKillers:l.gamesWithDeaths}},[l,n.highlightedPlayer]);if(x)return t.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de mort..."});if(D)return t.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",D]});if(!l)return t.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de mort disponible"});const K=({active:r,payload:d,label:c})=>{if(r&&d&&d.length){const e=d[0].payload,a=e.isHighlightedAddition,o=n.highlightedPlayer===e.name;return t.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[t.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:o?"var(--accent-primary)":"var(--text-primary)"},children:[c,a&&t.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (🎯)"})]}),t.jsxs("p",{style:{color:"var(--accent-secondary)",margin:"4px 0"},children:[t.jsx("strong",{children:"Victimes totales:"})," ",e.value]}),t.jsxs("p",{style:{color:"var(--accent-tertiary)",margin:"4px 0"},children:[t.jsx("strong",{children:"Parties jouées:"})," ",e.gamesPlayed]}),t.jsxs("p",{style:{color:"var(--chart-color-5)",margin:"4px 0"},children:[t.jsx("strong",{children:"Victimes uniques:"})," ",e.victims]}),t.jsxs("p",{style:{color:"var(--chart-color-2)",margin:"4px 0"},children:[t.jsx("strong",{children:"Moyenne par partie:"})," ",e.averageKillsPerGame.toFixed(2)]}),a&&t.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection personnelle"}),o&&!a&&t.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"}),t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null},A=({active:r,payload:d,label:c})=>{if(r&&d&&d.length){const e=d[0].payload,a=e.isHighlightedAddition,o=n.highlightedPlayer===e.name;return t.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[t.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:o?"var(--accent-primary)":"var(--text-primary)"},children:[c,a&&t.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (🎯)"})]}),t.jsxs("p",{style:{color:"var(--accent-secondary)",margin:"4px 0"},children:[t.jsx("strong",{children:"Moyenne par partie:"})," ",e.value.toFixed(2)]}),t.jsxs("p",{style:{color:"var(--accent-tertiary)",margin:"4px 0"},children:[t.jsx("strong",{children:"Parties jouées:"})," ",e.gamesPlayed]}),t.jsxs("p",{style:{color:"var(--chart-color-5)",margin:"4px 0"},children:[t.jsx("strong",{children:"Victimes uniques:"})," ",e.victims]}),t.jsxs("p",{style:{color:"var(--chart-color-2)",margin:"4px 0"},children:[t.jsx("strong",{children:"Victimes totales:"})," ",Math.round(e.averageKillsPerGame*e.gamesPlayed)]}),a&&t.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection personnelle"}),o&&!a&&t.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"}),t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null};return t.jsxs("div",{className:"lycans-players-stats",children:[t.jsx("h2",{children:"Statistiques de Tueurs (VERSION PROTOTYPE)"}),t.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp du tueur :"}),t.jsxs("select",{id:"camp-select",value:m,onChange:r=>N(r.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[t.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),y?.map(r=>t.jsx("option",{value:r,children:r},r))]})]}),t.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Total des morts"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)"},children:l.totalDeaths})]}),t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Tueurs identifiés"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-1)"},children:l.killerStats.length})]}),t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Nombre de parties enregistrées"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary)"},children:C})]})]}),t.jsxs("div",{className:"lycans-graphiques-groupe",children:[t.jsxs("div",{className:"lycans-graphique-section",children:[t.jsxs("div",{children:[t.jsx("h3",{children:"Top Tueurs (Total)"}),k&&n.highlightedPlayer&&t.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['🎯 "',n.highlightedPlayer,'" affiché en plus du top 20']})]}),t.jsx(G,{title:"Top Tueurs (Total)",children:t.jsx("div",{style:{height:400},children:t.jsx(R,{width:"100%",height:"100%",children:t.jsxs(E,{data:j,margin:{top:20,right:30,left:20,bottom:10},onMouseEnter:()=>{},onMouseLeave:()=>v(null),children:[t.jsx(H,{strokeDasharray:"3 3"}),t.jsx(L,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:r,y:d,payload:c})=>t.jsx("text",{x:r,y:d,dy:16,textAnchor:"end",fill:n.highlightedPlayer===c.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:n.highlightedPlayer===c.value?14:13,fontWeight:n.highlightedPlayer===c.value?"bold":"italic",transform:`rotate(-45 ${r} ${d})`,children:c.value})}),t.jsx(F,{label:{value:"Nombre total de victimes",angle:270,position:"left",style:{textAnchor:"middle"}}}),t.jsx(q,{content:t.jsx(K,{})}),t.jsx(W,{dataKey:"value",name:"Victimes",onMouseEnter:r=>v(r?.name||null),children:j.map(r=>{const d=n.highlightedPlayer===r.name,c=T===r.name,e=r.isHighlightedAddition;return t.jsx(I,{fill:b[r.name]||"#e53e3e",stroke:d?"var(--accent-primary)":c?"var(--text-primary)":"none",strokeWidth:d?3:c?2:0,strokeDasharray:e?"5,5":"none",opacity:e?.8:1,onClick:()=>{const a={selectedPlayer:r.name,fromComponent:"Statistiques de Mort"};m!=="Tous les camps"&&(a.campFilter={selectedCamp:m,campFilterMode:"all-assignments"}),h(a)},onMouseEnter:()=>v(r.name),onMouseLeave:()=>v(null),style:{cursor:"pointer"}},`cell-total-${r.name}`)})})]})})})}),t.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(20,j.filter(r=>!r.isHighlightedAddition).length)," des tueurs les plus actifs (total)"]})]}),t.jsxs("div",{className:"lycans-graphique-section",children:[t.jsxs("div",{children:[t.jsx("h3",{children:"Top Tueurs (Moyenne par Partie)"}),S&&n.highlightedPlayer&&t.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['🎯 "',n.highlightedPlayer,'" affiché en plus du top 20']})]}),t.jsx(G,{title:"Top Tueurs (Moyenne par Partie)",children:t.jsx("div",{style:{height:400},children:t.jsx(R,{width:"100%",height:"100%",children:t.jsxs(E,{data:f,margin:{top:20,right:30,left:20,bottom:10},onMouseEnter:()=>{},onMouseLeave:()=>v(null),children:[t.jsx(H,{strokeDasharray:"3 3"}),t.jsx(L,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:r,y:d,payload:c})=>t.jsx("text",{x:r,y:d,dy:16,textAnchor:"end",fill:n.highlightedPlayer===c.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:n.highlightedPlayer===c.value?14:13,fontWeight:n.highlightedPlayer===c.value?"bold":"italic",transform:`rotate(-45 ${r} ${d})`,children:c.value})}),t.jsx(F,{label:{value:"Moyenne de victimes par partie",angle:270,position:"left",style:{textAnchor:"middle"}}}),t.jsx(q,{content:t.jsx(A,{})}),t.jsx(W,{dataKey:"value",name:"Moyenne",onMouseEnter:r=>v(r?.name||null),children:f.map(r=>{const d=n.highlightedPlayer===r.name,c=T===r.name,e=r.isHighlightedAddition;return t.jsx(I,{fill:b[r.name]||"#8884d8",stroke:d?"var(--accent-primary)":c?"var(--text-primary)":"none",strokeWidth:d?3:c?2:0,strokeDasharray:e?"5,5":"none",opacity:e?.8:1,onClick:()=>{const a={selectedPlayer:r.name,fromComponent:"Statistiques de Mort"};m!=="Tous les camps"&&(a.campFilter={selectedCamp:m,campFilterMode:"all-assignments"}),h(a)},onMouseEnter:()=>v(r.name),onMouseLeave:()=>v(null),style:{cursor:"pointer"}},`cell-average-${r.name}`)})})]})})})}),t.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(20,f.filter(r=>!r.isHighlightedAddition).length)," des tueurs les plus efficaces (moyenne)"]})]})]}),t.jsx("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:t.jsxs("p",{children:[t.jsx("strong",{children:"Note : "}),"Les morts lors de votes aux conseils ne sont pas comptabilisées ici. ","Données en cours de récupération (données partielles)."]})})]})}export{le as DeathStatisticsChart};
