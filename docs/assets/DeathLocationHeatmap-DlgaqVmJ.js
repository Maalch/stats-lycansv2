import{r as E,j as e,u as te,a as ue,e as re}from"./index-mVkbdXau.js";import{u as fe,c as he}from"./useDeathStatisticsFromRaw-C132POsf.js";import{D as F}from"./datasyncExport-D6_8Fmuy.js";import{a as me}from"./api-BfXzialC.js";import{F as xe,C as pe,X as ge,Y as ve,a as ye}from"./FullscreenChart-DURYIO7N.js";import{g as be,c as J,a as je,R as Me}from"./deathLocationUtils-CJxVVigC.js";import{g as O}from"./deathTypes-CGUOTngO.js";import{ak as ze,al as ne,am as Q,an as Se,ao as U,R as Ce,T as Ee}from"./CategoricalChart-B4OHOSCd.js";import{S as ke,a as we}from"./ScatterChart-KzS_h2My.js";import"./baseStatsHook-DmPqT9H6.js";const Re=Ne(Ae);function Ne(t){return function(a,d,n=d){if(!((d=+d)>=0))throw new RangeError("invalid rx");if(!((n=+n)>=0))throw new RangeError("invalid ry");let{data:r,width:c,height:h}=a;if(!((c=Math.floor(c))>=0))throw new RangeError("invalid width");if(!((h=Math.floor(h!==void 0?h:r.length/c))>=0))throw new RangeError("invalid height");if(!c||!h||!d&&!n)return a;const v=d&&t(d),g=n&&t(n),i=r.slice();return v&&g?(Y(v,i,r,c,h),Y(v,r,i,c,h),Y(v,i,r,c,h),G(g,r,i,c,h),G(g,i,r,c,h),G(g,r,i,c,h)):v?(Y(v,r,i,c,h),Y(v,i,r,c,h),Y(v,r,i,c,h)):g&&(G(g,r,i,c,h),G(g,i,r,c,h),G(g,r,i,c,h)),a}}function Y(t,a,d,n,r){for(let c=0,h=n*r;c<h;)t(a,d,c,c+=n,1)}function G(t,a,d,n,r){for(let c=0,h=n*r;c<n;++c)t(a,d,c,c+h,n)}function Ae(t){const a=Math.floor(t);if(a===t)return De(t);const d=t-a,n=2*t+1;return(r,c,h,v,g)=>{if(!((v-=g)>=h))return;let i=a*c[h];const o=g*a,y=o+g;for(let m=h,x=h+o;m<x;m+=g)i+=c[Math.min(v,m)];for(let m=h,x=v;m<=x;m+=g)i+=c[Math.min(v,m+o)],r[m]=(i+d*(c[Math.max(h,m-y)]+c[Math.min(v,m+y)]))/n,i-=c[Math.max(h,m-o)]}}function De(t){const a=2*t+1;return(d,n,r,c,h)=>{if(!((c-=h)>=r))return;let v=t*n[r];const g=h*t;for(let i=r,o=r+g;i<o;i+=h)v+=n[Math.min(c,i)];for(let i=r,o=c;i<=o;i+=h)v+=n[Math.min(c,i+g)],d[i]=v/a,v-=n[Math.max(r,i-g)]}}function Ie(t,a){let d=0;for(let n of t)n!=null&&(n=+n)>=n&&++d;return d}function Le(t,a){let d,n;if(a===void 0)for(const r of t)r!=null&&(d===void 0?r>=r&&(d=n=r):(d>r&&(d=r),n<r&&(n=r)));else{let r=-1;for(let c of t)(c=a(c,++r,t))!=null&&(d===void 0?c>=c&&(d=n=c):(d>c&&(d=c),n<c&&(n=c)))}return[d,n]}function Te(t,a,d){let n;for(;;){const r=ze(t,a,d);if(r===n||r===0||!isFinite(r))return[t,a];r>0?(t=Math.floor(t/r)*r,a=Math.ceil(a/r)*r):r<0&&(t=Math.ceil(t*r)/r,a=Math.floor(a*r)/r),n=r}}function We(t){return Math.max(1,Math.ceil(Math.log(Ie(t))/Math.LN2)+1)}var Pe=Array.prototype,oe=Pe.slice;function Be(t,a){return t-a}function Xe(t){for(var a=0,d=t.length,n=t[d-1][1]*t[0][0]-t[d-1][0]*t[0][1];++a<d;)n+=t[a-1][1]*t[a][0]-t[a-1][0]*t[a][1];return n}const Z=t=>()=>t;function Fe(t,a){for(var d=-1,n=a.length,r;++d<n;)if(r=qe(t,a[d]))return r;return 0}function qe(t,a){for(var d=a[0],n=a[1],r=-1,c=0,h=t.length,v=h-1;c<h;v=c++){var g=t[c],i=g[0],o=g[1],y=t[v],m=y[0],x=y[1];if(Ve(g,y,a))return 0;o>n!=x>n&&d<(m-i)*(n-o)/(x-o)+i&&(r=-r)}return r}function Ve(t,a,d){var n;return He(t,a,d)&&Ze(t[n=+(t[0]===a[0])],d[n],a[n])}function He(t,a,d){return(a[0]-t[0])*(d[1]-t[1])===(d[0]-t[0])*(a[1]-t[1])}function Ze(t,a,d){return t<=a&&a<=d||d<=a&&a<=t}function $e(){}var H=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function _(){var t=1,a=1,d=We,n=g;function r(i){var o=d(i);if(Array.isArray(o))o=o.slice().sort(Be);else{const y=Le(i,Ye);for(o=ne(...Te(y[0],y[1],o),o);o[o.length-1]>=y[1];)o.pop();for(;o[1]<y[0];)o.shift()}return o.map(y=>c(i,y))}function c(i,o){const y=o==null?NaN:+o;if(isNaN(y))throw new Error(`invalid value: ${o}`);var m=[],x=[];return h(i,y,function(b){n(b,i,y),Xe(b)>0?m.push([b]):x.push(b)}),x.forEach(function(b){for(var w=0,z=m.length,f;w<z;++w)if(Fe((f=m[w])[0],b)!==-1){f.push(b);return}}),{type:"MultiPolygon",value:o,coordinates:m}}function h(i,o,y){var m=new Array,x=new Array,b,w,z,f,l,p;for(b=w=-1,f=$(i[0],o),H[f<<1].forEach(s);++b<t-1;)z=f,f=$(i[b+1],o),H[z|f<<1].forEach(s);for(H[f<<0].forEach(s);++w<a-1;){for(b=-1,f=$(i[w*t+t],o),l=$(i[w*t],o),H[f<<1|l<<2].forEach(s);++b<t-1;)z=f,f=$(i[w*t+t+b+1],o),p=l,l=$(i[w*t+b+1],o),H[z|f<<1|l<<2|p<<3].forEach(s);H[f|l<<3].forEach(s)}for(b=-1,l=i[w*t]>=o,H[l<<2].forEach(s);++b<t-1;)p=l,l=$(i[w*t+b+1],o),H[l<<2|p<<3].forEach(s);H[l<<3].forEach(s);function s(M){var S=[M[0][0]+b,M[0][1]+w],N=[M[1][0]+b,M[1][1]+w],A=v(S),L=v(N),j,I;(j=x[A])?(I=m[L])?(delete x[j.end],delete m[I.start],j===I?(j.ring.push(N),y(j.ring)):m[j.start]=x[I.end]={start:j.start,end:I.end,ring:j.ring.concat(I.ring)}):(delete x[j.end],j.ring.push(N),x[j.end=L]=j):(j=m[L])?(I=x[A])?(delete m[j.start],delete x[I.end],j===I?(j.ring.push(N),y(j.ring)):m[I.start]=x[j.end]={start:I.start,end:j.end,ring:I.ring.concat(j.ring)}):(delete m[j.start],j.ring.unshift(S),m[j.start=A]=j):m[A]=x[L]={start:A,end:L,ring:[S,N]}}}function v(i){return i[0]*2+i[1]*(t+1)*4}function g(i,o,y){i.forEach(function(m){var x=m[0],b=m[1],w=x|0,z=b|0,f=K(o[z*t+w]);x>0&&x<t&&w===x&&(m[0]=ee(x,K(o[z*t+w-1]),f,y)),b>0&&b<a&&z===b&&(m[1]=ee(b,K(o[(z-1)*t+w]),f,y))})}return r.contour=c,r.size=function(i){if(!arguments.length)return[t,a];var o=Math.floor(i[0]),y=Math.floor(i[1]);if(!(o>=0&&y>=0))throw new Error("invalid size");return t=o,a=y,r},r.thresholds=function(i){return arguments.length?(d=typeof i=="function"?i:Array.isArray(i)?Z(oe.call(i)):Z(i),r):d},r.smooth=function(i){return arguments.length?(n=i?g:$e,r):n===g},r}function Ye(t){return isFinite(t)?t:NaN}function $(t,a){return t==null?!1:+t>=a}function K(t){return t==null||isNaN(t=+t)?-1/0:t}function ee(t,a,d,n){const r=n-a,c=d-a,h=isFinite(r)||isFinite(c)?r/c:Math.sign(r)/Math.sign(c);return isNaN(h)?t:t+h-.5}function Ge(t){return t[0]}function Oe(t){return t[1]}function Ue(){return 1}function se(){var t=Ge,a=Oe,d=Ue,n=960,r=500,c=20,h=2,v=c*3,g=n+v*2>>h,i=r+v*2>>h,o=Z(20);function y(l){var p=new Float32Array(g*i),s=Math.pow(2,-h),M=-1;for(const u of l){var S=(t(u,++M,l)+v)*s,N=(a(u,M,l)+v)*s,A=+d(u,M,l);if(A&&S>=0&&S<g&&N>=0&&N<i){var L=Math.floor(S),j=Math.floor(N),I=S-L-.5,q=N-j-.5;p[L+j*g]+=(1-I)*(1-q)*A,p[L+1+j*g]+=I*(1-q)*A,p[L+1+(j+1)*g]+=I*q*A,p[L+(j+1)*g]+=(1-I)*q*A}}return Re({data:p,width:g,height:i},c*s),p}function m(l){var p=y(l),s=o(p),M=Math.pow(2,2*h);return Array.isArray(s)||(s=ne(Number.MIN_VALUE,Q(p)/M,s)),_().size([g,i]).thresholds(s.map(S=>S*M))(p).map((S,N)=>(S.value=+s[N],x(S)))}m.contours=function(l){var p=y(l),s=_().size([g,i]),M=Math.pow(2,2*h),S=N=>{N=+N;var A=x(s.contour(p,N*M));return A.value=N,A};return Object.defineProperty(S,"max",{get:()=>Q(p)/M}),S};function x(l){return l.coordinates.forEach(b),l}function b(l){l.forEach(w)}function w(l){l.forEach(z)}function z(l){l[0]=l[0]*Math.pow(2,h)-v,l[1]=l[1]*Math.pow(2,h)-v}function f(){return v=c*3,g=n+v*2>>h,i=r+v*2>>h,m}return m.x=function(l){return arguments.length?(t=typeof l=="function"?l:Z(+l),m):t},m.y=function(l){return arguments.length?(a=typeof l=="function"?l:Z(+l),m):a},m.weight=function(l){return arguments.length?(d=typeof l=="function"?l:Z(+l),m):d},m.size=function(l){if(!arguments.length)return[n,r];var p=+l[0],s=+l[1];if(!(p>=0&&s>=0))throw new Error("invalid size");return n=p,r=s,f()},m.cellSize=function(l){if(!arguments.length)return 1<<h;if(!((l=+l)>=1))throw new Error("invalid cell size");return h=Math.floor(Math.log(l)/Math.LN2),f()},m.thresholds=function(l){return arguments.length?(o=typeof l=="function"?l:Array.isArray(l)?Z(oe.call(l)):Z(l),m):o},m.bandwidth=function(l){if(!arguments.length)return Math.sqrt(c*(c+1));if(!((l=+l)>=0))throw new Error("invalid bandwidth");return c=(Math.sqrt(4*l*l+1)-1)/2,f()},m}function Ke(t){for(var a=t.length/6|0,d=new Array(a),n=0;n<a;)d[n]="#"+t.slice(n*6,++n*6);return d}const Je=t=>Se(t[t.length-1]);var Qe=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Ke);const ae=Je(Qe);function _e({deathLocations:t,xDomain:a,zDomain:d,width:n=800,height:r=600,bandwidth:c=25,onRegionClick:h,mapConfig:v}){const g=E.useRef(null),i=E.useRef(null),o=E.useRef(null),y=E.useRef(null),[,m]=E.useState(!1),x=E.useMemo(()=>U().domain(d).range([0,n]),[d,n]),b=E.useMemo(()=>U().domain(a).range([r,0]),[a,r]),w=E.useMemo(()=>t.length===0?[]:se().x(s=>x(s.z)).y(s=>b(s.x)).size([n,r]).bandwidth(c).thresholds(15)(t),[t,b,x,n,r,c]),z=E.useMemo(()=>{const p=w.length>0?Math.max(...w.map(s=>s.value)):1;return s=>{const M=s/p;return ae(M)}},[w]);E.useEffect(()=>{const p=o.current;if(!p||!v){m(!1);return}const s=p.getContext("2d");if(!s)return;s.clearRect(0,0,n,r);const M=new Image;M.onload=()=>{s.globalAlpha=.85,s.drawImage(M,0,0,n,r),s.globalAlpha=1,m(!0)},M.onerror=()=>{m(!1)},M.src=v.src},[v,n,r]),E.useEffect(()=>{const p=g.current;if(!p||w.length===0)return;const s=p.getContext("2d");s&&(s.clearRect(0,0,n,r),w.forEach(M=>{s.fillStyle=z(M.value),s.globalAlpha=.6,M.coordinates.forEach(S=>{S.forEach(N=>{s.beginPath(),N.forEach((A,L)=>{L===0?s.moveTo(A[0],A[1]):s.lineTo(A[0],A[1])}),s.closePath(),s.fill()})})}),s.globalAlpha=1)},[w,n,r,z]),E.useEffect(()=>{const p=i.current;if(!p||t.length===0)return;const s=p.getContext("2d");s&&(s.clearRect(0,0,n,r),t.forEach(M=>{const S=x(M.z),N=b(M.x);s.beginPath(),s.arc(S,N,2,0,2*Math.PI),s.fillStyle="rgba(0, 0, 0, 0.3)",s.fill(),s.strokeStyle="rgba(255, 255, 255, 0.5)",s.lineWidth=.5,s.stroke()}))},[t,b,x,n,r]);const f=p=>{if(!h||!y.current)return;const s=y.current.getBoundingClientRect(),M=p.clientX-s.left,S=p.clientY-s.top,N=30,A=t.filter(L=>{const j=x(L.z),I=b(L.x);return Math.sqrt(Math.pow(j-M,2)+Math.pow(I-S,2))<=N});A.length>0&&h(A)},l=p=>{if(!y.current)return;const s=y.current.getBoundingClientRect(),M=p.clientX-s.left,S=p.clientY-s.top,N=20,A=t.filter(L=>{const j=x(L.z),I=b(L.x);return Math.sqrt(Math.pow(j-M,2)+Math.pow(I-S,2))<=N});y.current&&(y.current.style.cursor=A.length>0?"pointer":"default")};return e.jsxs("div",{ref:y,style:{position:"relative",width:`${n}px`,height:`${r}px`,margin:"0 auto"},onClick:f,onMouseMove:l,children:[e.jsx("canvas",{ref:o,width:n,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),e.jsx("canvas",{ref:g,width:n,height:r,style:{position:"absolute",top:0,left:0,borderRadius:"4px",pointerEvents:"none"}}),e.jsx("canvas",{ref:i,width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),e.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),e.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),e.jsxs("svg",{width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(p=>{const s=n*p,M=d[0]+(d[1]-d[0])*p;return e.jsxs("g",{children:[e.jsx("line",{x1:s,y1:r,x2:s,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:s,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(M)})]},`z-${p}`)}),[0,.25,.5,.75,1].map(p=>{const s=r*(1-p),M=a[0]+(a[1]-a[0])*p;return e.jsxs("g",{children:[e.jsx("line",{x1:0,y1:s,x2:5,y2:s,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:10,y:s,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(M)})]},`x-${p}`)})]})]})}function et({selectedCamp:t,availableDeathTypes:a,deathTypeColors:d}){const{navigateToGameDetails:n}=te(),{settings:r}=ue(),{data:c,isLoading:h,error:v}=re(),[g,i]=E.useState(""),[o,y]=E.useState("all"),[m,x]=E.useState(null),[b,w]=E.useState("heatmap"),[z,f]=E.useState(20),l=E.useMemo(()=>{if(!c)return[];const u=be(c),R=J(c,t),C=new Map;return R.forEach(k=>{C.set(k.mapName,(C.get(k.mapName)||0)+1)}),u.sort((k,P)=>{const D=C.get(k)||0;return(C.get(P)||0)-D})},[c,t]),p=l.length>0?l[0]:"";g===""&&p!==""&&i(p);const s=E.useMemo(()=>{if(!c)return[];let u=J(c,t);return g&&(u=u.filter(R=>R.mapName===g)),o!=="all"&&(u=u.filter(R=>R.deathType===o)),u},[c,t,g,o]),M=E.useMemo(()=>{const u=[];return s.forEach(R=>{let C=!1;for(const k of u)if(Math.sqrt(Math.pow(R.x-k.centroidX,2)+Math.pow(R.z-k.centroidZ,2))<=z){const D=k.deaths.length;k.centroidX=(k.centroidX*D+R.x)/(D+1),k.centroidZ=(k.centroidZ*D+R.z)/(D+1),k.deaths.push(R),C=!0;break}C||u.push({centroidX:R.x,centroidZ:R.z,deaths:[R]})}),u},[s,z]),S=E.useMemo(()=>M.map((u,R)=>{const C=u.deaths[0],k=new Map;u.deaths.forEach(W=>{k.set(W.deathType,(k.get(W.deathType)||0)+1)});let P=C.deathType,D=0;return k.forEach((W,B)=>{W>D&&(D=W,P=B)}),{x:u.centroidX,z:u.centroidZ,deathCount:u.deaths.length,allDeaths:u.deaths,dominantDeathType:P,playerName:u.deaths.length===1?C.playerName:null,gameId:u.deaths.length===1?C.gameId:null,camp:C.camp,mapName:C.mapName,deathType:P,killerName:u.deaths.length===1?C.killerName:null,clusterIndex:R}}),[M]),N=({active:u,payload:R})=>{if(!u||!R||R.length===0)return null;const C=R[0].payload,k=C.allDeaths||[C];if(k.length>1){const W=new Map,B=new Set,V=new Map;k.forEach(T=>{const X=T.deathType?O(T.deathType):"Inconnu";W.set(X,(W.get(X)||0)+1),B.add(T.gameId),V.set(T.playerName,(V.get(T.playerName)||0)+1)});const ie=Array.from(V.entries()).sort((T,X)=>X[1]-T[1]).slice(0,3),le=V.size>3,ce=Array.from(W.entries()).sort((T,X)=>X[1]-T[1]).slice(0,3),de=W.size>3;return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:[k.length," morts dans cette zone"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Centre:"})," (",Math.round(C.x),", ",Math.round(C.z),")"]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Joueurs:"}),e.jsxs("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:[ie.map(([T,X])=>e.jsxs("li",{children:[T," ",X>1?`(${X} morts)`:""]},T)),le&&e.jsxs("li",{style:{color:"var(--text-secondary)"},children:["...et ",V.size-3," autres"]})]})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Types de mort:"}),e.jsxs("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:[ce.map(([T,X])=>e.jsxs("li",{children:[T," (",X,")"]},T)),de&&e.jsxs("li",{style:{color:"var(--text-secondary)"},children:["...et ",W.size-3," autres"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Parties:"})," ",B.size," parties",B.size<=5&&e.jsxs("span",{children:[" (",Array.from(B).filter(T=>T).map(T=>`#${T}`).join(", "),")"]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const D=k[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:D.playerName}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Camp:"})," ",D.camp]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type de mort:"})," ",D.deathType?O(D.deathType):"Inconnu"]}),D.killerName&&e.jsxs("div",{children:[e.jsx("strong",{children:"TuÃ© par:"})," ",D.killerName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Carte:"})," ",D.mapName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Partie:"})," #",D.gameId]}),e.jsxs("div",{style:{marginTop:"4px",fontSize:"0.85rem",color:"var(--text-secondary)"},children:["Position: (",Math.round(D.x),", ",Math.round(D.z),")"]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})},A=u=>{if(!u)return;const R=u.allDeaths||[u];if(R.length===1)n({selectedGame:R[0].gameId,fromComponent:"Death Location View"});else{const C=R.map(k=>k.gameId).filter(k=>k);n({selectedGameIds:C,fromComponent:"Death Location View"})}},L=u=>u&&d[u]||"var(--text-secondary)",j=E.useMemo(()=>je(g),[g]),{xDomain:I,zDomain:q}=E.useMemo(()=>{if(j)return{xDomain:[j.xMin,j.xMax],zDomain:[j.zMin,j.zMax]};if(S.length===0)return{xDomain:[0,100],zDomain:[0,100]};const u=S.map(V=>V.x),R=S.map(V=>V.z),C=Math.min(...u),k=Math.max(...u),P=Math.min(...R),D=Math.max(...R),W=(k-C)*.1||10,B=(D-P)*.1||10;return{xDomain:[C-W,k+W],zDomain:[P-B,D+B]}},[S,j]);return h?e.jsx("div",{className:"donnees-attente",children:"Chargement des localisations de mort..."}):v?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",v]}):c?e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Mode :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{onClick:()=>w("heatmap"),style:{background:b==="heatmap"?"var(--accent-primary)":"transparent",color:b==="heatmap"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:b==="heatmap"?"bold":"normal",transition:"all 0.2s"},children:"Carte de chaleur"}),e.jsx("button",{onClick:()=>w("scatter"),style:{background:b==="scatter"?"var(--accent-primary)":"transparent",color:b==="scatter"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:b==="scatter"?"bold":"normal",transition:"all 0.2s"},children:"Points"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"map-select",value:g,onChange:u=>i(u.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:l.filter(u=>u==="Village"||u==="ChÃ¢teau").map(u=>e.jsx("option",{value:u,children:u},u))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"death-type-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Type de mort :"}),e.jsxs("select",{id:"death-type-select",value:o,onChange:u=>y(u.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"all",children:"Tous les types"}),a.map(u=>e.jsx("option",{value:u,children:O(u)},u))]})]}),b==="scatter"&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-radius",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-radius",type:"range",min:"0",max:"60",step:"5",value:z,onChange:u=>f(Number(u.target.value)),style:{width:"100px",cursor:"pointer"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.85rem",minWidth:"70px"},children:z===0?"Aucun":`${z} unitÃ©s`})]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Morts localisÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary)"},children:s.length}),b==="scatter"&&z>0&&S.length<s.length&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"4px"},children:["â†’ ",S.length," points groupÃ©s"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camp filtrÃ©"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)",fontSize:"1.2rem"},children:t})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Type de mort"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-2)",fontSize:"1.2rem"},children:o==="all"?"Tous":O(o)})]})]}),s.length>0?e.jsx(xe,{title:b==="scatter"?"Carte des Morts":"Carte de Chaleur des Morts",children:b==="scatter"?e.jsx("div",{style:{height:700,width:"100%",maxWidth:1e3,margin:"0 auto"},children:e.jsx(Ce,{width:"100%",height:"100%",children:e.jsxs(ke,{margin:{top:20,right:30,left:60,bottom:60},children:[j&&e.jsx(Me,{x1:j.zMin,x2:j.zMax,y1:j.xMin,y2:j.xMax,fill:"transparent",stroke:"none",shape:u=>{const{x:R,y:C,width:k,height:P}=u;return e.jsx("image",{x:R,y:C,width:k,height:P,href:j.src,preserveAspectRatio:"none",style:{opacity:.85}})}}),e.jsx(pe,{strokeDasharray:"3 3",stroke:j?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(ge,{dataKey:"z",type:"number",name:"Position Z",label:{value:"Position Z",position:"bottom",offset:10,style:{fill:"var(--text-secondary)"}},domain:q,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:u=>Math.round(u).toString()}),e.jsx(ve,{dataKey:"x",type:"number",name:"Position X",label:{value:"Position X",angle:-90,position:"left",offset:20,style:{fill:"var(--text-secondary)"}},domain:I,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:u=>Math.round(u).toString()}),e.jsx(Ee,{content:e.jsx(N,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(we,{data:S,onClick:u=>A(u),onMouseEnter:u=>x(u),onMouseLeave:()=>x(null),style:{cursor:"pointer"},children:S.map((u,R)=>{const C=u.allDeaths.some(B=>r.highlightedPlayer===B.playerName),k=m&&u.clusterIndex===m.clusterIndex,P=Math.min(Math.log2(u.deathCount+1)*3+4,18),D=Math.round(P),W=D+2;return e.jsx(ye,{fill:C?"var(--accent-primary)":L(u.deathType),stroke:C||k?"white":u.deathCount>1?"rgba(255,255,255,0.6)":"none",strokeWidth:C?3:k?2:u.deathCount>1?1.5:0,opacity:C?1:.8,r:C?W:k?D+1:D},`cell-${R}`)})})]})})}):e.jsx("div",{style:{padding:"2rem 0",display:"flex",justifyContent:"center"},children:e.jsx(_e,{deathLocations:s,xDomain:I,zDomain:q,width:1e3,height:700,bandwidth:25,mapConfig:j,onRegionClick:u=>{if(u.length===1)n({selectedGame:u[0].gameId,fromComponent:"Death Location View (Heatmap)"});else{const R=u.map(C=>C.gameId).filter(C=>C);n({selectedGameIds:R,fromComponent:"Death Location View (Heatmap)"})}}})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1rem"},children:"Aucune localisation de mort disponible pour les filtres sÃ©lectionnÃ©s"}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes (non-legacy)."})]}),e.jsxs("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:[e.jsx("p",{children:e.jsx("strong",{children:"Ã€ propos de cette visualisation :"})}),e.jsxs("ul",{style:{marginTop:"0.5rem",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Les positions sont basÃ©es sur les coordonnÃ©es Z (horizontal) et X (vertical) - vue 2D de la carte"}),b==="scatter"?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:'Les morts proches sont regroupÃ©es en un seul point - ajustez le curseur "Regroupement" pour contrÃ´ler la distance'}),e.jsx("li",{children:"La couleur indique le type de mort dominant dans le groupe"}),e.jsx("li",{children:"Survolez un point pour voir tous les joueurs, types de mort et parties concernÃ©s"}),e.jsxs("li",{children:["Le joueur sÃ©lectionnÃ© est affichÃ© en "," ",e.jsx("span",{style:{color:"var(--accent-primary)",fontWeight:"bold"},children:"couleur primaire"})]}),e.jsx("li",{children:"Cliquez sur un point pour voir les dÃ©tails de la ou des parties"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"La carte de chaleur montre les zones de forte densitÃ© de morts (du jaune au rouge)"}),e.jsx("li",{children:"Les points noirs indiquent l'emplacement exact de chaque mort"}),e.jsx("li",{children:"Les zones rouges indiquent une concentration Ã©levÃ©e de morts"}),e.jsx("li",{children:"Cliquez sur une zone pour voir les dÃ©tails des parties associÃ©es"}),e.jsx("li",{children:'Utilisez le mode "Points" pour voir les dÃ©tails individuels par type de mort'})]})]}),e.jsx("p",{style:{marginTop:"0.5rem",fontStyle:"italic",color:"var(--text-secondary)"},children:"Note : Seules les parties rÃ©centes contiennent des donnÃ©es de position."})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function ut({deathLocations:t,xDomain:a,zDomain:d,width:n=800,height:r=600,bandwidth:c=25,onRegionClick:h}){const v=E.useRef(null),g=E.useRef(null),i=E.useRef(null),o=E.useMemo(()=>U().domain(a).range([0,n]),[a,n]),y=E.useMemo(()=>U().domain(d).range([r,0]),[d,r]),m=E.useMemo(()=>t.length===0?[]:se().x(f=>o(f.x)).y(f=>y(f.z)).size([n,r]).bandwidth(c).thresholds(15)(t),[t,o,y,n,r,c]),x=E.useMemo(()=>{const z=m.length>0?Math.max(...m.map(f=>f.value)):1;return f=>{const l=f/z;return ae(l)}},[m]);E.useEffect(()=>{const z=v.current;if(!z||m.length===0)return;const f=z.getContext("2d");f&&(f.clearRect(0,0,n,r),m.forEach(l=>{f.fillStyle=x(l.value),f.globalAlpha=.6,l.coordinates.forEach(p=>{p.forEach(s=>{f.beginPath(),s.forEach((M,S)=>{S===0?f.moveTo(M[0],M[1]):f.lineTo(M[0],M[1])}),f.closePath(),f.fill()})})}),f.globalAlpha=1)},[m,n,r,x]),E.useEffect(()=>{const z=g.current;if(!z||t.length===0)return;const f=z.getContext("2d");f&&(f.clearRect(0,0,n,r),t.forEach(l=>{const p=o(l.x),s=y(l.z);f.beginPath(),f.arc(p,s,2,0,2*Math.PI),f.fillStyle="rgba(0, 0, 0, 0.3)",f.fill(),f.strokeStyle="rgba(255, 255, 255, 0.5)",f.lineWidth=.5,f.stroke()}))},[t,o,y,n,r]);const b=z=>{if(!h||!i.current)return;const f=i.current.getBoundingClientRect(),l=z.clientX-f.left,p=z.clientY-f.top,s=30,M=t.filter(S=>{const N=o(S.x),A=y(S.z);return Math.sqrt(Math.pow(N-l,2)+Math.pow(A-p,2))<=s});M.length>0&&h(M)},w=z=>{if(!i.current)return;const f=i.current.getBoundingClientRect(),l=z.clientX-f.left,p=z.clientY-f.top,s=20,M=t.filter(S=>{const N=o(S.x),A=y(S.z);return Math.sqrt(Math.pow(N-l,2)+Math.pow(A-p,2))<=s});i.current&&(i.current.style.cursor=M.length>0?"pointer":"default")};return e.jsxs("div",{ref:i,style:{position:"relative",width:`${n}px`,height:`${r}px`,margin:"0 auto"},onClick:b,onMouseMove:w,children:[e.jsx("canvas",{ref:v,width:n,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),e.jsx("canvas",{ref:g,width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),e.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),e.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),e.jsxs("svg",{width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(z=>{const f=n*z,l=a[0]+(a[1]-a[0])*z;return e.jsxs("g",{children:[e.jsx("line",{x1:f,y1:r,x2:f,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:f,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(l)})]},`x-${z}`)}),[0,.25,.5,.75,1].map(z=>{const f=r*(1-z),l=d[0]+(d[1]-d[0])*z;return e.jsxs("g",{children:[e.jsx("line",{x1:0,y1:f,x2:5,y2:f,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:10,y:f,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(l)})]},`z-${z}`)})]})]})}function ft(){const{navigationState:t,updateNavigationState:a}=te(),[d,n]=E.useState(t.deathLocationState?.selectedCamp||"Tous les camps"),{data:r}=fe(),{data:c}=re(),h=me();E.useEffect(()=>{(!t.deathLocationState||t.deathLocationState.selectedCamp!==d)&&a({deathLocationState:{selectedCamp:d}})},[d,t.deathLocationState,a]);const v=E.useMemo(()=>c?he(c):[],[c]),g=E.useMemo(()=>{const o={};v.forEach(x=>{x===F.BY_WOLF?o[x]=h.Loup:x===F.VOTED?o[x]="var(--chart-color-1)":x===F.BULLET||x===F.BULLET_HUMAN||x===F.BULLET_WOLF?o[x]=h.Chasseur:x===F.BY_ZOMBIE?o[x]=h.Vaudou:x===F.ASSASSIN?o[x]=h.Alchimiste:x===F.AVENGER?o[x]="var(--chart-color-2)":x===F.LOVER_DEATH?o[x]=h.Amoureux:x===F.BY_BEAST?o[x]="var(--chart-color-3)":x===F.SHERIF_SUCCESS&&(o[x]="var(--chart-color-4)")});const y=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let m=0;return v.forEach(x=>{o[x]||(o[x]=y[m%y.length],m++)}),o},[v,h]),i=o=>{n(o),a({deathLocationState:{selectedCamp:o}})};return e.jsxs("div",{className:"lycans-general-stats",children:[e.jsx("h2",{children:"ðŸ—ºï¸ Carte de Chaleur des Morts"}),e.jsx("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select",value:d,onChange:o=>i(o.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"},"tous"),r?.filter(o=>o!=="Tous les camps").map(o=>e.jsx("option",{value:o,children:o},o))]})]})}),e.jsx(et,{selectedCamp:d,availableDeathTypes:v,deathTypeColors:g})]})}export{ft as DeathLocationHeatmap,ut as DeathLocationHeatmapCanvas};
