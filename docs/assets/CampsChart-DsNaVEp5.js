import{r as v,j as e}from"./index-DWfrD1eM.js";import{q as T,R,p as y,T as b,B as E,C as F,X as D,Y as S,o as $}from"./useRawGameData-BVqoB0l1.js";import{u as L}from"./usePlayerCampPerformanceFromRaw-ByktNw3x.js";import{l as C,a as w}from"./api-DftpR04q.js";import{P as A,a as G}from"./PieChart-Cf8e5Ed7.js";import{L as W}from"./Legend-BOYJeMPB.js";function k(){const{data:l,isLoading:g,error:f}=T();return{campWinStats:v.useMemo(()=>{if(!l||l.length===0)return null;const h={},m={};let c=0;const j=i=>i?i.split(",").map(s=>s.trim()).filter(Boolean):[];l.forEach(i=>{const s=i["Rôles solo"],a=i["Camp victorieux"];s&&s.toString().trim()!==""&&j(s.toString()).forEach(o=>{const t=o.trim();t!==""&&(h[t]||(h[t]=0),h[t]++)}),a&&a.trim()!==""&&(c++,m[a]||(m[a]=0),m[a]++)});const u=[];Object.keys(m).forEach(i=>{u.push({camp:i,wins:m[i],winRate:(m[i]/c*100).toFixed(2)})}),u.sort((i,s)=>s.wins-i.wins);const p=[];return Object.keys(h).forEach(i=>{p.push({soloRole:i,appearances:h[i]})}),p.sort((i,s)=>s.appearances-i.appearances),{totalGames:c,campStats:u,soloCamps:p}},[l]),isLoading:g,errorInfo:f}}const q="#607D8B";function O(){const{campWinStats:l,isLoading:g,errorInfo:f}=k(),{playerCampPerformance:d,isLoading:h,error:m}=L(),c=v.useMemo(()=>d?.campAverages?d.campAverages.map(s=>({...s,winRateNum:parseFloat(s.winRate)})).sort((s,a)=>a.winRateNum-s.winRateNum):[],[d]),j=v.useMemo(()=>l?.campStats?.map(s=>({...s,winRateNum:typeof s.winRate=="string"?parseFloat(s.winRate):s.winRate}))||[],[l]),u=v.useMemo(()=>{if(!j.length)return[];const s=5;let a=0;const r=[],o=[];return j.forEach(t=>{t.winRateNum<s?(a+=t.winRateNum,r.push(t)):o.push(t)}),a>0&&o.push({camp:"Autres",wins:r.reduce((t,n)=>t+n.wins,0),winRate:a.toFixed(1),winRateNum:a,_details:r}),o},[j]),p=v.useMemo(()=>{if(!c.length)return[];const s=5,a=c.reduce((n,x)=>n+x.totalGames,0);let r=0;const o=[],t=[];if(c.forEach(n=>{const x=n.totalGames/a*100;x<s?(r+=n.totalGames,o.push({...n,winRate:x.toFixed(1)})):t.push(n)}),r>0){const n=o.length>0?(o.reduce((x,P)=>x+P.winRateNum,0)/o.length).toFixed(1):"0.0";t.push({camp:"Autres",totalGames:r,winRate:n,winRateNum:parseFloat(n),_details:o})}return t},[c]),N=g||h,i=f||m;return N?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques des camps..."}):i?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",i]}):!l&&!d?e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de camp disponible"}):e.jsxs("div",{className:"lycans-camps-container",children:[e.jsx("h2",{children:"Statistiques des Camps"}),d&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camps Analysés"}),e.jsx("div",{className:"lycans-valeur-principale",children:d.campAverages.length}),e.jsx("p",{children:"camps différents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Joueurs Évalués"}),e.jsx("div",{className:"lycans-valeur-principale",children:d.playerPerformance.length}),e.jsx("p",{children:"joueurs analysés"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:l?.totalGames||0}),e.jsx("p",{children:"parties analysées"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[l&&u.length>0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Répartition des Victoires par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Distribution des victoires sur ",l.totalGames," parties"]}),e.jsx("div",{style:{height:450},children:e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(A,{children:[e.jsx(G,{data:u,cx:"50%",cy:"50%",labelLine:!1,outerRadius:140,fill:"#8884d8",dataKey:"winRateNum",nameKey:"camp",label:({camp:s,winRate:a})=>s==="Autres"?`Autres: ${a}%`:`${s}: ${a}%`,children:u.map((s,a)=>e.jsx(y,{fill:s.camp==="Autres"?C:w[s.camp]||q},`cellule-camp-${a}`))}),e.jsx(b,{content:({active:s,payload:a})=>{if(s&&a&&a.length>0){const r=a[0].payload;if(r.camp==="Autres"&&r._details){const o=[...r._details].sort((t,n)=>n.winRateNum-t.winRateNum);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:"Autres"})}),e.jsx("div",{children:o.map((t,n)=>e.jsxs("div",{children:[t.camp,": ",t.wins," victoires (",t.winRate,"%)"]},n))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold"},children:["Total: ",r.wins," victoires (",r.winRate,"%)"]})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:r.camp}),e.jsxs("div",{children:["Victoires: ",r.wins]}),e.jsxs("div",{children:["Taux de victoire: ",r.winRate,"%"]})]})}return null}}),e.jsx(W,{})]})})})]})}),d&&c.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire Moyen par Camp"}),e.jsx("div",{style:{height:400},children:e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(E,{data:c,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(F,{strokeDasharray:"3 3"}),e.jsx(D,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(S,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(b,{content:({active:s,payload:a})=>{if(s&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.camp})}),e.jsxs("div",{children:["Parties totales: ",r.totalGames]}),e.jsxs("div",{children:["Taux de victoire: ",r.winRate,"%"]})]})}return null}}),e.jsx($,{dataKey:"winRateNum",children:c.map((s,a)=>e.jsx(y,{fill:w[s.camp]||`var(--chart-color-${a%6+1})`},`cell-${a}`))})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Parties par Camp"}),e.jsx("div",{style:{height:400},children:e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(A,{children:[e.jsx(G,{data:p,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"totalGames",label:({camp:s,totalGames:a,percent:r})=>{const o=r!==void 0?r:0;return s==="Autres"?`Autres: ${a} (${(o*100).toFixed(1)}%)`:`${s}: ${a} (${(o*100).toFixed(1)}%)`},children:p.map((s,a)=>e.jsx(y,{fill:s.camp==="Autres"?C:w[s.camp]||`var(--chart-color-${a%6+1})`},`cell-${a}`))}),e.jsx(b,{content:({active:s,payload:a})=>{if(s&&a&&a.length>0){const r=a[0].payload;if(r.camp==="Autres"&&r._details){const o=[...r._details].sort((t,n)=>n.totalGames-t.totalGames);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:"Autres"})}),e.jsx("div",{children:o.map((t,n)=>e.jsxs("div",{children:[t.camp,": ",t.totalGames," parties"]},n))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold"},children:["Total: ",r.totalGames," parties"]})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.camp})}),e.jsxs("div",{children:["Parties: ",r.totalGames]}),e.jsxs("div",{children:["Taux victoire: ",r.winRate,"%"]})]})}return null}})]})})})]})]})]})]})}export{O as CampsChart};
