import{u as C}from"./baseStatsHook-C58galQR.js";import{g as L,a as V}from"./datasyncExport-D6_8Fmuy.js";import{i as K,D as a}from"./deathTypes-CGUOTngO.js";import{c as k}from"./api-7DwBFA5S.js";import{g as R}from"./index-B6UqpM5A.js";function M(u,c){if(!u||!c)return!1;const i=u.split(".").map(Number),l=c.split(".").map(Number);for(let o=0;o<Math.max(i.length,l.length);o++){const e=i[o]||0,r=l[o]||0;if(e>r)return!0;if(e<r)return!1}return!0}function P(u){return u===a.SURVIVALIST_NOT_SAVED?a.BY_WOLF:u}function O(u){const c=new Set;u.filter(e=>!e.LegacyData||e.LegacyData.deathInformationFilled===!0).forEach(e=>{e.PlayerStats.forEach(r=>{const d=L(r.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});c.add(d)})});const l=Array.from(c);return[...k.filter(e=>l.includes(e)),...l.filter(e=>!k.includes(e)).sort()]}function j(u){switch(u){case a.VOTED:return"Mort aux votes";case a.BY_WOLF:case a.SURVIVALIST_NOT_SAVED:return"Kill en Loup";case a.BY_ZOMBIE:return"Kill en Zombie";case a.BY_BEAST:return"Kill en Bête";case a.BY_AVATAR_CHAIN:return"Mort d'Avatar";case a.BULLET:return"Tir de Chasseur";case a.BULLET_HUMAN:return"Kill de Chasseur (sur humain)";case a.BULLET_WOLF:return"Kill de Chasseur (sur loup)";case a.SHERIF_SUCCESS:return"Kill de Shérif";case a.OTHER_AGENT:return"Kill d'Agent";case a.AVENGER:return"Kill de Vengeur";case a.SEER:return"Kill de Devin";case a.HANTED:return"Kill avec Potion hantée";case a.ASSASSIN:return"Kill avec Potion (Assassin)";case a.LOVER_DEATH:return"Kill d'amoureux";case a.BOMB:return"Explosion";case a.CRUSHED:return"Écrasement";case a.STARVATION:return"Famine";case a.STARVATION_AS_BEAST:return"Tuerie bestiale";case a.FALL:return"Chute mortelle";case a.UNKNOWN:return"Kill inconnu";default:return""}}function x(u){const c=new Set;u.forEach(o=>{o.PlayerStats.forEach(e=>{if(e.DeathType&&K(e.DeathType)){const r=P(e.DeathType);r&&c.add(r)}})});const i=Array.from(c),l=[a.BY_WOLF,a.VOTED,a.BULLET,a.BULLET_HUMAN,a.BULLET_WOLF,a.BY_ZOMBIE,a.ASSASSIN,a.AVENGER,a.LOVER_DEATH];return[...l.filter(o=>i.includes(o)),...i.filter(o=>!l.includes(o)).sort()]}function U(u,c){return u.PlayerStats.filter(i=>i.DeathType&&K(i.DeathType)&&(i.DeathTiming||i.DeathType)).map(i=>{let l=null,o=null;if(i.KillerName){const e=u.PlayerStats.find(r=>r.Username===i.KillerName);if(e){o=R(e);const r=V(e.MainRoleInitial,e.MainRoleChanges||[]);l=L(r,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1}),r&&r!==e.MainRoleInitial&&(r==="Loup"?l="Loup":r==="Zombie"&&(l="Vaudou"))}}return{playerId:R(i),playerName:i.Username,deathType:P(i.DeathType),killerId:o,killerName:i.KillerName,killerCamp:l}}).filter(i=>{if(!c||c==="Tous les camps")return!0;const l=u.PlayerStats.find(e=>e.Username===i.playerName);return l?L(l.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===c:!1})}function _(u,c,i){const l=[];u.PlayerStats.forEach(e=>{if(e.KillerName&&e.DeathType){if(e.DeathType===a.VOTED||e.DeathType===a.STARVATION||e.DeathType===a.FALL||e.DeathType===a.BY_AVATAR_CHAIN)return;const r=u.PlayerStats.find(f=>f.Username===e.KillerName);if(!r)return;let d=L(r.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});const E=V(r.MainRoleInitial,r.MainRoleChanges||[]);E&&E!==r.MainRoleInitial&&(E==="Loup"?d="Loup":E==="Zombie"&&(d="Vaudou"));const A=L(e.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0});l.push({killerId:R(r),killerName:r.Username,victimId:R(e),victimName:e.Username,deathType:P(e.DeathType),killerCamp:d,victimCamp:A})}});let o=l;return c&&c!=="Tous les camps"&&(o=o.filter(e=>e.killerCamp===c)),i&&i!=="Tous les camps"&&(o=o.filter(e=>i==="Roles solo"?e.victimCamp!=="Villageois"&&e.victimCamp!=="Loup":e.victimCamp===i)),o}function b(u,c,i){if(u.length===0)return null;const l=u.filter(t=>!t.LegacyData||t.LegacyData.deathInformationFilled===!0);if(l.length===0)return null;const o=[],e={},r={};l.forEach(t=>{U(t,c).forEach(s=>{o.push({...s,gameId:t.Id})}),t.PlayerStats.forEach(s=>{const T=R(s),I=s.Username;r[T]=I,(!c||c==="Tous les camps"||L(s.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===c)&&(e[T]=(e[T]||0)+1)})});const d=o.length,E=l.length,A=E>0?d/E:0,f={};o.forEach(t=>{f[t.deathType]=(f[t.deathType]||0)+1});const m=Object.entries(f).map(([t,n])=>({type:t,count:n||0,percentage:d>0?(n||0)/d*100:0})).sort((t,n)=>n.count-t.count),h={};l.forEach(t=>{_(t,c,i).forEach(s=>{r[s.killerId]=s.killerName,r[s.victimId]=s.victimName,h[s.killerId]||(h[s.killerId]={kills:0,victims:new Set,killsByDeathType:{}}),h[s.killerId].kills++,h[s.killerId].victims.add(s.victimId),h[s.killerId].killsByDeathType[s.deathType]=(h[s.killerId].killsByDeathType[s.deathType]||0)+1})});const D=Object.entries(h).map(([t,n])=>{const s=e[t]||0,T=s>0?n.kills/s:0;return{killerName:r[t]||t,kills:n.kills,victims:Array.from(n.victims).map(I=>r[I]||I),percentage:d>0?n.kills/d*100:0,gamesPlayed:s,averageKillsPerGame:T,killsByDeathType:n.killsByDeathType}}).sort((t,n)=>n.kills-t.kills),y={};o.forEach(t=>{y[t.playerId]||(y[t.playerId]={totalDeaths:0,deathsByType:{},killedById:{},deathDays:[]});const n=y[t.playerId];n.totalDeaths++,n.deathsByType[t.deathType]=(n.deathsByType[t.deathType]||0)+1,t.killerId&&(n.killedById[t.killerId]=(n.killedById[t.killerId]||0)+1)});const p=[];Object.entries(y).forEach(([t,n])=>{const s=r[t]||t,T={};Object.entries(n.killedById).forEach(([I,N])=>{const v=r[I]||I;T[v]=(T[v]||0)+N}),p.push({playerName:s,totalDeaths:n.totalDeaths,deathsByType:n.deathsByType,killedBy:T,deathRate:e[t]>0?n.totalDeaths/e[t]:0,gamesPlayed:e[t]||0})}),Object.entries(e).forEach(([t,n])=>{y[t]||p.push({playerName:r[t]||t,totalDeaths:0,deathsByType:{},killedBy:{},deathRate:0,gamesPlayed:n})});const g=p.sort((t,n)=>n.totalDeaths-t.totalDeaths),S=m.length>0?m[0].type:null,B=D.length>0?D[0].killerName:null;return{totalDeaths:d,totalGames:E,averageDeathsPerGame:A,deathsByType:m,killerStats:D,playerDeathStats:g,mostCommonDeathType:S,mostDeadlyKiller:B}}function G(u,c){const i=u.filter(f=>!f.LegacyData||f.LegacyData.deathInformationFilled===!0),l={},o={},e=i.length,r=[a.BULLET,a.BULLET_HUMAN,a.BULLET_WOLF];i.forEach(f=>{const m=new Set;f.PlayerStats.forEach(h=>{const D=h.MainRoleInitial,y=V(h.MainRoleInitial,h.MainRoleChanges||[]);if(D==="Chasseur"||y==="Chasseur"){const p=R(h);o[p]=h.Username,m.add(p),l[p]||(l[p]={kills:[],gamesPlayed:0,victimsCamps:[],gameVersions:[],gameModded:[]}),l[p].gamesPlayed++}}),f.PlayerStats.forEach(h=>{const D=h.DeathType,y=h.KillerName,p=y?f.PlayerStats.find(S=>S.Username===y):null,g=p?R(p):null;if(g&&p&&(o[g]=p.Username),D&&r.includes(D)&&g&&m.has(g)){const S=L(h.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});l[g].kills.push(D),l[g].victimsCamps.push(S),l[g].gameVersions.push(f.Version),l[g].gameModded.push(f.Modded)}})});const d=Object.entries(l).map(([f,m])=>{const h=m.kills.length,D={};m.kills.forEach(s=>{D[s]=(D[s]||0)+1});const y={};m.victimsCamps.forEach(s=>{y[s]=(y[s]||0)+1});let p=0,g=0;const S={},B={};m.victimsCamps.forEach((s,T)=>{const I=m.gameVersions[T],N=m.gameModded[T];s==="Idiot du Village"?N&&M(I,"0.202")?(g++,B[s]=(B[s]||0)+1):(p++,S[s]=(S[s]||0)+1):s==="Villageois"?(g++,B[s]=(B[s]||0)+1):(p++,S[s]=(S[s]||0)+1)});const t=m.gamesPlayed>0?h/m.gamesPlayed:0,n=m.gamesPlayed>0?p/m.gamesPlayed:0;return{hunterName:o[f]||f,totalKills:h,nonVillageoisKills:p,villageoisKills:g,gamesPlayedAsHunter:m.gamesPlayed,averageKillsPerGame:t,averageNonVillageoisKillsPerGame:n,killsByDeathType:D,victimsByCamp:y,goodVictimsByCamp:S,badVictimsByCamp:B}}).sort((f,m)=>m.totalKills-f.totalKills),E=d.length>0?d[0].hunterName:null,A=d.length>0?d.sort((f,m)=>m.averageNonVillageoisKillsPerGame-f.averageNonVillageoisKillsPerGame)[0].hunterName:null;return{totalHunters:d.length,totalGames:e,hunterStats:d,bestHunter:E,bestAverageHunter:A}}function Z(u,c){return C(i=>b(i,u,c))}function z(){return C(u=>O(u))}function q(u){return C(c=>G(c))}export{Z as a,q as b,x as c,j as g,z as u};
