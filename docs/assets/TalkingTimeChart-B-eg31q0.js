import{g as E,d as H,u as z,a as W,r as x,j as e}from"./index-Cfzfcorz.js";import{a as w}from"./baseStatsHook-C4ktb9fY.js";import{c as B}from"./datasyncExport-D6_8Fmuy.js";import{u as F}from"./useJoueursData-Ckjpw8Va.js";import{u as R}from"./api-DTCaUVcf.js";import{F as q,B as L,C as I,X as $,Y,a as K,b as V}from"./FullscreenChart-DilW2pxG.js";import{f as u}from"./durationFormatters-C9UyWcKX.js";import{R as X,T as J}from"./CategoricalChart-BiIkuSnD.js";function _(i){return i.PlayerStats.some(d=>d.SecondsTalkedOutsideMeeting>0||d.SecondsTalkedDuringMeeting>0)}function Q(i){if(!i||i.length===0)return null;const d=i.filter(_);if(d.length===0)return{playerStats:[],totalGames:i.length,gamesWithTalkingData:0};const g=new Map;return d.forEach(h=>{h.PlayerStats.forEach(r=>{const s=E(r),n=H(r),S=r.DeathDateIrl||h.EndDate,o=B(h.StartDate,S);if(!o||o<=0)return;g.has(s)||g.set(s,{displayName:n,gamesPlayed:0,totalSecondsOutside:0,totalSecondsDuring:0,totalGameDurationSeconds:0});const p=g.get(s);p.gamesPlayed++,p.totalSecondsOutside+=r.SecondsTalkedOutsideMeeting||0,p.totalSecondsDuring+=r.SecondsTalkedDuringMeeting||0,p.totalGameDurationSeconds+=o})}),{playerStats:Array.from(g.entries()).map(([h,r])=>{const s=r.totalSecondsOutside+r.totalSecondsDuring,n=r.totalGameDurationSeconds>0?3600/r.totalGameDurationSeconds:0;return{player:r.displayName,gamesPlayed:r.gamesPlayed,totalSecondsOutside:r.totalSecondsOutside,totalSecondsDuring:r.totalSecondsDuring,totalSecondsAll:s,totalGameDurationSeconds:r.totalGameDurationSeconds,secondsOutsidePer60Min:r.totalSecondsOutside*n,secondsDuringPer60Min:r.totalSecondsDuring*n,secondsAllPer60Min:s*n}}),totalGames:i.length,gamesWithTalkingData:d.length}}function U(){const{data:i,isLoading:d,error:g}=w(f=>Q(f));return{data:i,isLoading:d,error:g}}const Z=[3,5,15,25,50,100];function le(){const{data:i,isLoading:d,error:g}=U(),{navigateToGameDetails:f,navigationState:h,updateNavigationState:r}=z(),{settings:s}=W(),[n,S]=x.useState(h.talkingTimeState?.minGames||5),[o,p]=x.useState(h.talkingTimeState?.displayMode||"total"),[M,P]=x.useState(null),{joueursData:k}=F(),A=R(k);x.useEffect(()=>{const t=h.talkingTimeState;(!t||t.minGames!==n||t.displayMode!==o)&&r({talkingTimeState:{minGames:n,displayMode:o,focusChart:t?.focusChart}})},[n,o,r]);const{chartData:T,highlightedPlayerAdded:C}=x.useMemo(()=>{if(!i?.playerStats)return{chartData:[],highlightedPlayerAdded:!1};const t=i.playerStats,c=t.filter(l=>l.gamesPlayed>=n),a=l=>{switch(o){case"outside":return l.secondsOutsidePer60Min;case"during":return l.secondsDuringPer60Min;case"total":default:return l.secondsAllPer60Min}},m=c.sort((l,j)=>a(j)-a(l)).slice(0,20),y=s.highlightedPlayer&&m.some(l=>l.player===s.highlightedPlayer);let v=[...m],b=!1;if(s.highlightedPlayer&&!y){const l=t.find(j=>j.player===s.highlightedPlayer);l&&(v.push({...l,isHighlightedAddition:!0}),b=!0)}return{chartData:v,highlightedPlayerAdded:b}},[i,n,o,s.highlightedPlayer]);if(d)return e.jsx("div",{className:"donnees-attente",children:"R√©cup√©ration des statistiques de temps de parole..."});if(g)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]});if(!i)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de temps de parole disponible"});const G=t=>{switch(o){case"outside":return t.secondsOutsidePer60Min;case"during":return t.secondsDuringPer60Min;case"total":default:return t.secondsAllPer60Min}},D=()=>{switch(o){case"outside":return"Temps de Parole Hors Meeting (par 60 min)";case"during":return"Temps de Parole En Meeting (par 60 min)";case"total":default:return"Temps de Parole Total (par 60 min)"}},N=()=>{switch(o){case"outside":return"Temps hors meeting (par 60 min)";case"during":return"Temps en meeting (par 60 min)";case"total":default:return"Temps de parole (par 60 min)"}},O=i.playerStats.filter(t=>t.gamesPlayed>=n).length;return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques de Temps de Parole"}),e.jsxs("p",{className:"lycans-stats-info",children:[i.gamesWithTalkingData," parties avec donn√©es de temps de parole (depuis la version 0.215 uniquement)"]}),e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:D()}),C&&s.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',s.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"display-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Mode d'affichage:"}),e.jsxs("select",{id:"display-mode-select",value:o,onChange:t=>p(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"total",children:"Temps Total"}),e.jsx("option",{value:"outside",children:"Hors Meeting"}),e.jsx("option",{value:"during",children:"En Meeting"})]}),e.jsx("label",{htmlFor:"min-games-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginLeft:"1rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select",value:n,onChange:t=>S(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:Z.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx(q,{title:D(),children:e.jsx("div",{style:{height:400},children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(L,{data:T,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(I,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:c,payload:a})=>e.jsx("text",{x:t,y:c,dy:16,textAnchor:"end",fill:s.highlightedPlayer===a.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:s.highlightedPlayer===a.value?14:13,fontWeight:s.highlightedPlayer===a.value?"bold":"italic",transform:`rotate(-45 ${t} ${c})`,children:a.value})}),e.jsx(Y,{label:{value:N(),angle:270,position:"left",offset:15,style:{textAnchor:"middle"}},tickFormatter:t=>u(t)}),e.jsx(J,{content:({active:t,payload:c})=>{if(t&&c&&c.length>0){const a=c[0].payload,m=a.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:a.player}),e.jsxs("div",{children:["Parties jou√©es: ",a.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Par 60 minutes:"})}),e.jsxs("div",{children:["Total: ",u(a.secondsAllPer60Min)]}),e.jsxs("div",{children:["Hors meeting: ",u(a.secondsOutsidePer60Min)]}),e.jsxs("div",{children:["En meeting: ",u(a.secondsDuringPer60Min)]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Temps cumul√©s:"})}),e.jsxs("div",{children:["Total: ",u(a.totalSecondsAll)]}),e.jsxs("div",{children:["Hors meeting: ",u(a.totalSecondsOutside)]}),e.jsxs("div",{children:["En meeting: ",u(a.totalSecondsDuring)]}),m&&e.jsxs("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:["üéØ Affich√© via s√©lection personnelle",a.gamesPlayed<n&&` (< ${n} parties)`]})]})}return null}}),e.jsx(K,{dataKey:t=>G(t),children:T.map((t,c)=>{const a=s.highlightedPlayer===t.player,m=M===t.player,y=t.isHighlightedAddition,v=A[t.player]||"var(--chart-primary)";return e.jsx(V,{fill:a?"var(--accent-primary)":y?"var(--accent-secondary)":v,stroke:a?"var(--accent-primary)":m?"#000000":"none",strokeWidth:a?3:m?2:0,strokeDasharray:y?"5,5":"none",opacity:y?.8:1,onClick:()=>f({selectedPlayer:t.player}),onMouseEnter:()=>P(t.player),onMouseLeave:()=>P(null),style:{cursor:"pointer"}},`cell-${c}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",T.length," des joueurs (sur ",O," ayant au moins ",n," partie",n>1?"s":"",")"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Temps normalis√© par 60 minutes de jeu ¬∑ Calcul√© sur ",i.gamesWithTalkingData," parties avec donn√©es"]})]})})]})}export{le as TalkingTimeChart};
