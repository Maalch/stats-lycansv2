import{a as G,p as k,r as R,j as e}from"./index-D7S6jFiA.js";import{F as S,B,C as A,X as F,Y as T,a as b,b as N}from"./FullscreenChart-Cbx9ZJ7P.js";import{u as Z,g as ee}from"./api-CGiD5xL_.js";import{R as D,T as w}from"./CategoricalChart-B8LqodGe.js";import{P as te,a as ae}from"./PieChart-D_Jtk6tA.js";import{L as ie}from"./Legend-0s-hmgZo.js";import"./PolarChart-Ci__pC97.js";function J(){const[o,p]=R.useState(null),[f,m]=R.useState(null),[x,u]=R.useState(!0),[a,h]=R.useState(null);return R.useEffect(()=>{(async()=>{try{u(!0),h(null);const y=await fetch("/data/rawBRData.json");if(!y.ok)throw new Error("Failed to fetch rawBRData");const j=await y.json();p(j.BRParties?.data||[]),m(j.BRRefParties?.data||[])}catch(y){console.error("Error fetching raw BR data:",y),h(y instanceof Error?y.message:"Unknown error")}finally{u(!1)}})()},[]),{brPartiesData:o,brRefPartiesData:f,isLoading:x,error:a}}function re(){const{settings:o}=G(),{brPartiesData:p,brRefPartiesData:f,isLoading:m,error:x}=J();return{data:p?.filter(a=>{if(!a.Game||!a.Participants)return!1;const h=f?.find(n=>n.Game===a.Game);if(!h)return K(a,o);if(o.independentFilters){const n=o.independentFilters;if(n.gameTypeEnabled&&n.gameFilter!=="all"){if(n.gameFilter==="modded"){if(!h["Game Modd√©e"])return!1}else if(n.gameFilter==="non-modded"&&h["Game Modd√©e"])return!1}if(n.dateRangeEnabled&&(n.dateRange.start||n.dateRange.end)){const y=k(h.Date);if(!y)return!1;if(n.dateRange.start){const j=new Date(n.dateRange.start);if(y<j)return!1}if(n.dateRange.end){const j=new Date(n.dateRange.end);if(y>j)return!1}}}return K(a,o)})||null,isLoading:m,error:x}}function se(){const{settings:o}=G(),{brRefPartiesData:p,isLoading:f,error:m}=J();return{data:p?.filter(u=>{if(!u.Game||!u.Date)return!1;if(o.independentFilters){const a=o.independentFilters;if(a.gameTypeEnabled&&a.gameFilter!=="all"){if(a.gameFilter==="modded"){if(!u["Game Modd√©e"])return!1}else if(a.gameFilter==="non-modded"&&u["Game Modd√©e"])return!1}if(a.dateRangeEnabled&&(a.dateRange.start||a.dateRange.end)){const h=k(u.Date);if(!h)return!1;if(a.dateRange.start){const n=new Date(a.dateRange.start);if(h<n)return!1}if(a.dateRange.end){const n=new Date(a.dateRange.end);if(h>n)return!1}}}return!0})||null,isLoading:f,error:m}}function K(o,p){if(p.playerFilter.mode!=="none"&&p.playerFilter.players.length>0){const f=o.Participants.toLowerCase();if(p.playerFilter.mode==="include"){if(!p.playerFilter.players.some(x=>x.toLowerCase()===f))return!1}else if(p.playerFilter.mode==="exclude"&&p.playerFilter.players.some(x=>x.toLowerCase()===f))return!1}return!0}function fe(){const{data:o,isLoading:p,error:f}=re(),{data:m,isLoading:x,error:u}=se(),{settings:a}=G(),[h,n]=R.useState(null),y=Z(),j=["var(--chart-color-1)","var(--chart-color-2)","var(--chart-color-3)","var(--chart-color-4)","var(--chart-color-5)","var(--chart-color-6)"],E=i=>y[i]||ee(i),d=R.useMemo(()=>{if(!o||!m)return null;const i=m.length,r=o.length,l=o.filter(t=>t.Gagnant).length,g=o.reduce((t,s)=>{const c=s.Participants;return t[c]||(t[c]={name:c,participations:0,wins:0,totalScore:0,averageScore:0,winRate:0}),t[c].participations++,t[c].totalScore+=s.Score,s.Gagnant&&t[c].wins++,t},{});Object.values(g).forEach(t=>{t.averageScore=t.totalScore/t.participations,t.winRate=t.wins/t.participations*100});const v=Object.values(g).sort((t,s)=>s.participations-t.participations),P=v.slice(0,20),$=a.highlightedPlayer&&P.some(t=>t.name===a.highlightedPlayer);let C=!1,M=[...P];if(a.highlightedPlayer&&!$){const t=v.find(s=>s.name===a.highlightedPlayer);t&&(M.push({...t,isHighlightedAddition:!0}),C=!0)}const z=Object.values(g).filter(t=>t.participations>=3).sort((t,s)=>s.winRate-t.winRate).slice(0,20),V=a.highlightedPlayer&&z.some(t=>t.name===a.highlightedPlayer);let H=!1,I=[...z];if(a.highlightedPlayer&&!V){const t=v.find(s=>s.name===a.highlightedPlayer);t&&(I.push({...t,isHighlightedAddition:!0}),H=!0)}const W=Object.values(g).filter(t=>t.participations>=3).sort((t,s)=>s.averageScore-t.averageScore).slice(0,20),X=a.highlightedPlayer&&W.some(t=>t.name===a.highlightedPlayer);let O=!1,q=[...W];if(a.highlightedPlayer&&!X){const t=v.find(s=>s.name===a.highlightedPlayer);t&&(q.push({...t,isHighlightedAddition:!0}),O=!0)}const Y=o.reduce((t,s)=>{const c=s.Score,L=c===0?"0":c===1?"1":c===2?"2":c===3?"3":c===4?"4":c<=6?"5-6":"7+";return t[L]||(t[L]=0),t[L]++,t},{}),U=Object.entries(Y).map(([t,s])=>({range:t,count:s,percentage:(s/r*100).toFixed(1)})),_=m.reduce((t,s)=>{const c=s["Nombre de participants"];return t[c]||(t[c]=0),t[c]++,t},{}),Q=Object.entries(_).map(([t,s])=>({participants:parseInt(t),games:s,percentage:(s/i*100).toFixed(1)})).sort((t,s)=>t.participants-s.participants);return{totalGames:i,totalParticipations:r,totalWins:l,winRate:(l/r*100).toFixed(1),averageParticipantsPerGame:(r/i).toFixed(1),topPlayersByParticipations:M,topPlayersByWins:I,topPlayersByAverageScore:q,scoreData:U,participantData:Q,highlightedPlayerInParticipations:C,highlightedPlayerInWinRate:H,highlightedPlayerInAverageScore:O}},[o,m]);return p||x?e.jsx("div",{className:"statistiques-chargement",children:"Chargement des donn√©es Battle Royale..."}):f||u?e.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",f||u]}):d?e.jsxs("div",{className:"lycans-chart-container",children:[e.jsx("div",{className:"lycans-chart-header",children:e.jsx("h2",{children:"Statistiques Battle Royale"})}),e.jsxs("div",{className:"lycans-stats-grid",children:[e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Parties totales"}),e.jsx("div",{className:"lycans-stat-value",children:d.totalGames})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Participations"}),e.jsx("div",{className:"lycans-stat-value",children:d.totalParticipations})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Moy. participants/partie"}),e.jsx("div",{className:"lycans-stat-value",children:d.averageParticipantsPerGame})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Participations"}),d.highlightedPlayerInParticipations&&a.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--accent-primary)",margin:"0.5rem 0"},children:["üéØ ",a.highlightedPlayer," affich√© en plus du top 20"]}),e.jsx(S,{title:"Top Joueurs par Participations - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(D,{width:"100%",height:400,children:e.jsxs(B,{data:d.topPlayersByParticipations,onMouseEnter:i=>n(i?.activeLabel||null),onMouseLeave:()=>n(null),children:[e.jsx(A,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(T,{}),e.jsx(w,{content:({active:i,payload:r})=>{if(i&&r&&r.length>0){const l=r[0].payload,g=l.isHighlightedAddition,v=a.highlightedPlayer===l.name;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:l.name})}),e.jsxs("div",{children:["Participations : ",l.participations]}),e.jsxs("div",{children:["Victoires : ",l.wins]}),g&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"üéØ Affich√© via s√©lection (hors top 20)"}),v&&!g&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"üéØ Joueur s√©lectionn√©"})]})}return null}}),e.jsx(b,{dataKey:"participations",name:"Participations",children:d.topPlayersByParticipations.map((i,r)=>e.jsx(N,{fill:a.highlightedPlayer===i.name?"var(--accent-primary)":h===i.name?"var(--accent-hover)":E(i.name)},`cell-${r}`))}),e.jsx(b,{dataKey:"wins",fill:"var(--chart-color-2)",name:"Victoires"})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Taux de Victoire (min. 3 parties)"}),d.highlightedPlayerInWinRate&&a.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--accent-primary)",margin:"0.5rem 0"},children:["üéØ ",a.highlightedPlayer," affich√© en plus du top 20"]}),e.jsx(S,{title:"Top Joueurs par Taux de Victoire - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(D,{width:"100%",height:400,children:e.jsxs(B,{data:d.topPlayersByWins,onMouseEnter:i=>n(i?.activeLabel||null),onMouseLeave:()=>n(null),children:[e.jsx(A,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(T,{}),e.jsx(w,{content:({active:i,payload:r})=>{if(i&&r&&r.length>0){const l=r[0].payload,g=l.isHighlightedAddition,v=a.highlightedPlayer===l.name,P=l.participations>=3;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:l.name})}),e.jsxs("div",{children:["Taux de victoire : ",l.winRate.toFixed(2),"%"]}),e.jsxs("div",{children:["Victoires : ",l.wins," / ",l.participations]}),g&&!P&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"üéØ Affich√© via s√©lection (< 3 parties)"}),g&&P&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"üéØ Affich√© via s√©lection (hors top 20)"}),v&&!g&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"üéØ Joueur s√©lectionn√©"})]})}return null}}),e.jsx(b,{dataKey:"winRate",name:"Taux de victoire (%)",children:d.topPlayersByWins.map((i,r)=>e.jsx(N,{fill:a.highlightedPlayer===i.name?"var(--accent-primary)":h===i.name?"var(--accent-hover)":E(i.name)},`cell-${r}`))})]})})})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Score Moyen par Partie (min. 3 parties)"}),d.highlightedPlayerInAverageScore&&a.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--accent-primary)",margin:"0.5rem 0"},children:["üéØ ",a.highlightedPlayer," affich√© en plus du top 20"]}),e.jsx(S,{title:"Top Joueurs par Score Moyen - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(D,{width:"100%",height:400,children:e.jsxs(B,{data:d.topPlayersByAverageScore,onMouseEnter:i=>n(i?.activeLabel||null),onMouseLeave:()=>n(null),children:[e.jsx(A,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(T,{}),e.jsx(w,{content:({active:i,payload:r})=>{if(i&&r&&r.length>0){const l=r[0].payload,g=l.isHighlightedAddition,v=a.highlightedPlayer===l.name,P=l.participations>=3;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:l.name})}),e.jsxs("div",{children:["Score moyen : ",l.averageScore.toFixed(2)]}),e.jsxs("div",{children:["Score total : ",l.totalScore," / ",l.participations," parties"]}),g&&!P&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"üéØ Affich√© via s√©lection (< 3 parties)"}),g&&P&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"üéØ Affich√© via s√©lection (hors top 20)"}),v&&!g&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"üéØ Joueur s√©lectionn√©"})]})}return null}}),e.jsx(b,{dataKey:"averageScore",name:"Score moyen par partie",children:d.topPlayersByAverageScore.map((i,r)=>e.jsx(N,{fill:a.highlightedPlayer===i.name?"var(--accent-primary)":h===i.name?"var(--accent-hover)":E(i.name)},`cell-${r}`))})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Scores"}),e.jsx(S,{title:"Distribution des Scores - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(D,{width:"100%",height:400,children:e.jsxs(te,{children:[e.jsx(ae,{data:d.scoreData,cx:"50%",cy:"50%",labelLine:!1,label:({range:i,percentage:r})=>`${i}: ${r}%`,outerRadius:140,fill:"#8884d8",dataKey:"count",children:d.scoreData.map((i,r)=>e.jsx(N,{fill:j[r%j.length]},`cell-${r}`))}),e.jsx(w,{formatter:i=>[i,"Participations"]})]})})})]})]}),e.jsxs("div",{className:"lycans-chart-section",children:[e.jsx("h3",{children:"R√©partition par Nombre de Participants"}),e.jsx(S,{title:"R√©partition par Nombre de Participants - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(D,{width:"100%",height:400,children:e.jsxs(B,{data:d.participantData,children:[e.jsx(A,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"participants"}),e.jsx(T,{}),e.jsx(w,{formatter:(i,r)=>[i,r==="games"?"Parties":r]}),e.jsx(ie,{}),e.jsx(b,{dataKey:"games",fill:"var(--chart-color-4)",name:"Nombre de parties"})]})})})]})]}):e.jsx("div",{className:"statistiques-vide",children:"Aucune donn√©e Battle Royale disponible"})}export{fe as BRGeneralStatsChart};
