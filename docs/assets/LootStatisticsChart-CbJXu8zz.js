import{g as B,e as _,u as $,a as q,r as v,j as e}from"./index-D60v_CPe.js";import{a as w}from"./baseStatsHook-DKyZyLUD.js";import{b as O,c as K}from"./datasyncExport-BirWLS1z.js";import{u as V}from"./useJoueursData-Fs3JGpx9.js";import{M as X,u as Y,C as A,c as J}from"./api-CvAxa4LW.js";import{F as D,C as M,X as z,Y as N,a as G}from"./FullscreenChart-0kD5Ml4S.js";import{R as F,T as k}from"./CategoricalChart-Cw7_UQLP.js";import{B as H,a as R}from"./BarChart-B-e1Tz_j.js";function U(h){return h.PlayerStats.some(m=>m.TotalCollectedLoot!==void 0&&m.TotalCollectedLoot!==null)}function Q(h,m="all"){if(!h||h.length===0)return null;const p=h.filter(U);if(p.length===0)return{playerStats:[],totalGames:h.length,gamesWithLootData:0};const r=new Map;return p.forEach(y=>{y.PlayerStats.forEach(o=>{const u=B(o),j=_(o);if(o.TotalCollectedLoot===void 0||o.TotalCollectedLoot===null||m!=="all"&&O(o.MainRoleInitial,o.Power)!=={all:"",villageois:"Villageois",loup:"Loup",autres:"Autres"}[m])return;const x=o.DeathDateIrl||y.EndDate,s=K(y.StartDate,x);if(!s||s<=0)return;r.has(u)||r.set(u,{displayName:j,gamesPlayed:0,totalLoot:0,totalGameDurationSeconds:0});const f=r.get(u);f.gamesPlayed++,f.totalLoot+=o.TotalCollectedLoot,f.totalGameDurationSeconds+=s})}),{playerStats:Array.from(r.entries()).map(([y,o])=>{const u=o.totalGameDurationSeconds>0?3600/o.totalGameDurationSeconds:0;return{player:o.displayName,gamesPlayed:o.gamesPlayed,totalLoot:o.totalLoot,averageLoot:o.gamesPlayed>0?o.totalLoot/o.gamesPlayed:0,totalGameDurationSeconds:o.totalGameDurationSeconds,lootPer60Min:o.totalLoot*u}}),totalGames:h.length,gamesWithLootData:p.length}}function Z(h="all"){const{data:m,isLoading:p,error:r}=w(i=>Q(i,h));return{data:m,isLoading:p,error:r}}const ee=J.COMPACT;function de(){const{navigateToGameDetails:h,navigationState:m,updateNavigationState:p}=$(),{settings:r}=q(),[i,y]=v.useState(m.lootStatsState?.minGames||X.STANDARD),[o,u]=v.useState(m.lootStatsState?.campFilter||"all"),[j,x]=v.useState(null),{data:s,isLoading:f,error:P}=Z(o),{joueursData:b}=V(),C=Y(b);v.useEffect(()=>{const t=m.lootStatsState;(!t||t.minGames!==i||t.campFilter!==o)&&p({lootStatsState:{minGames:i,campFilter:o}})},[i,o,p]);const{totalLootChartData:S,highlightedPlayerAddedTotal:E}=v.useMemo(()=>{if(!s?.playerStats)return{totalLootChartData:[],highlightedPlayerAddedTotal:!1};const t=s.playerStats,l=t.sort((c,g)=>g.totalLoot-c.totalLoot).slice(0,A.TOP_20),a=r.highlightedPlayer&&l.some(c=>c.player===r.highlightedPlayer);let n=[...l],d=!1;if(r.highlightedPlayer&&!a){const c=t.find(g=>g.player===r.highlightedPlayer);c&&(n.push({...c,isHighlightedAddition:!0}),d=!0)}return{totalLootChartData:n,highlightedPlayerAddedTotal:d}},[s,r.highlightedPlayer]),{normalizedLootChartData:T,highlightedPlayerAddedNormalized:I}=v.useMemo(()=>{if(!s?.playerStats)return{normalizedLootChartData:[],highlightedPlayerAddedNormalized:!1};const t=s.playerStats,a=t.filter(g=>g.gamesPlayed>=i).sort((g,L)=>L.lootPer60Min-g.lootPer60Min).slice(0,A.TOP_20),n=r.highlightedPlayer&&a.some(g=>g.player===r.highlightedPlayer);let d=[...a],c=!1;if(r.highlightedPlayer&&!n){const g=t.find(L=>L.player===r.highlightedPlayer);g&&(d.push({...g,isHighlightedAddition:!0}),c=!0)}return{normalizedLootChartData:d,highlightedPlayerAddedNormalized:c}},[s,i,r.highlightedPlayer]);if(f)return e.jsx("div",{className:"donnees-attente",children:"R√©cup√©ration des statistiques de loot..."});if(P)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",P]});if(!s)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de loot disponible"});const W=s.playerStats.filter(t=>t.gamesPlayed>=i).length;return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques de R√©colte de Loot"}),e.jsxs("p",{className:"lycans-stats-info",children:[s.gamesWithLootData," parties avec donn√©es de loot collect√©."]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Total Loot Collect√©"}),E&&r.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',r.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:o,onChange:t=>u(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"villageois",children:"Camp Villageois"}),e.jsx("option",{value:"loup",children:"Camp Loup"}),e.jsx("option",{value:"autres",children:"Autres (Solo)"})]})]}),e.jsx(D,{title:"Total Loot Collect√©",children:e.jsx("div",{style:{height:400},children:e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(H,{data:S,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:l,payload:a})=>e.jsx("text",{x:t,y:l,dy:16,textAnchor:"end",fill:r.highlightedPlayer===a.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:r.highlightedPlayer===a.value?14:13,fontWeight:r.highlightedPlayer===a.value?"bold":"italic",transform:`rotate(-45 ${t} ${l})`,children:a.value})}),e.jsx(N,{label:{value:"Loot total collect√©",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(k,{content:({active:t,payload:l})=>{if(t&&l&&l.length>0){const a=l[0].payload,n=a.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:a.player}),e.jsxs("div",{children:["Parties jou√©es: ",a.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Loot collect√©:"})}),e.jsxs("div",{children:["Total: ",a.totalLoot.toLocaleString()]}),e.jsxs("div",{children:["Moyenne par partie: ",a.averageLoot.toFixed(1)]}),e.jsxs("div",{children:["Taux (par 60 min): ",a.lootPer60Min.toFixed(1)]}),n&&e.jsxs("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:["üéØ Affich√© via s√©lection personnelle",a.gamesPlayed<i&&` (< ${i} parties)`]})]})}return null}}),e.jsx(R,{dataKey:"totalLoot",children:S.map((t,l)=>{const a=r.highlightedPlayer===t.player,n=j===t.player,d=t.isHighlightedAddition,c=C[t.player]||"var(--chart-primary)";return e.jsx(G,{fill:a?"var(--accent-primary)":d?"var(--accent-secondary)":c,stroke:a?"var(--accent-primary)":n?"#000000":"none",strokeWidth:a?3:n?2:0,strokeDasharray:d?"5,5":"none",opacity:d?.8:1,onClick:()=>h({selectedPlayer:t.player}),onMouseEnter:()=>x(t.player),onMouseLeave:()=>x(null),style:{cursor:"pointer"}},`cell-${l}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",S.length," des joueurs (tous joueurs inclus)"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Calcul√© sur ",s.gamesWithLootData," parties avec donn√©es de loot"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Taux de R√©colte (par 60 min)"}),I&&r.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',r.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select-normalized",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select-normalized",value:o,onChange:t=>u(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"villageois",children:"Camp Villageois"}),e.jsx("option",{value:"loup",children:"Camp Loup"}),e.jsx("option",{value:"autres",children:"Autres (Solo)"})]}),e.jsx("label",{htmlFor:"min-games-select-normalized",style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginLeft:"1rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select-normalized",value:i,onChange:t=>y(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:ee.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx(D,{title:"Taux de R√©colte (par 60 min)",children:e.jsx("div",{style:{height:400},children:e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(H,{data:T,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:l,payload:a})=>e.jsx("text",{x:t,y:l,dy:16,textAnchor:"end",fill:r.highlightedPlayer===a.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:r.highlightedPlayer===a.value?14:13,fontWeight:r.highlightedPlayer===a.value?"bold":"italic",transform:`rotate(-45 ${t} ${l})`,children:a.value})}),e.jsx(N,{label:{value:"Loot par 60 minutes",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(k,{content:({active:t,payload:l})=>{if(t&&l&&l.length>0){const a=l[0].payload,n=a.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:a.player}),e.jsxs("div",{children:["Parties jou√©es: ",a.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Taux normalis√© (par 60 min):"})}),e.jsxs("div",{children:[a.lootPer60Min.toFixed(1)," loot/heure"]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Statistiques globales:"})}),e.jsxs("div",{children:["Total: ",a.totalLoot.toLocaleString()]}),e.jsxs("div",{children:["Moyenne par partie: ",a.averageLoot.toFixed(1)]}),n&&e.jsxs("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:["üéØ Affich√© via s√©lection personnelle",a.gamesPlayed<i&&` (< ${i} parties)`]})]})}return null}}),e.jsx(R,{dataKey:"lootPer60Min",children:T.map((t,l)=>{const a=r.highlightedPlayer===t.player,n=j===t.player,d=t.isHighlightedAddition,c=C[t.player]||"var(--chart-primary)";return e.jsx(G,{fill:a?"var(--accent-primary)":d?"var(--accent-secondary)":c,stroke:a?"var(--accent-primary)":n?"#000000":"none",strokeWidth:a?3:n?2:0,strokeDasharray:d?"5,5":"none",opacity:d?.8:1,onClick:()=>h({selectedPlayer:t.player}),onMouseEnter:()=>x(t.player),onMouseLeave:()=>x(null),style:{cursor:"pointer"}},`cell-${l}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",T.length," des joueurs (sur ",W," ayant au moins ",i," partie",i>1?"s":"",")"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Taux normalis√© par 60 minutes de jeu ¬∑ Calcul√© sur ",s.gamesWithLootData," parties avec donn√©es"]})]})]})]})}export{de as LootStatisticsChart};
