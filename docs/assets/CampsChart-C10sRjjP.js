import{r as C,j as e}from"./index-v7zYDCC4.js";import{y as _,z as X,R as D,p as P,v as Y,w as T,T as k,F as q,B,C as M,X as O,Y as $,o as I}from"./FullscreenChart-CYXHJiMV.js";import{P as J,a as H}from"./PieChart-wiadiFVd.js";import{L as Q}from"./Legend-D2xwABrM.js";function U(){const{data:c,isLoading:E,error:A}=_(),{data:p,isLoading:y,error:w}=X();return{campWinStats:C.useMemo(()=>{if(!c||c.length===0||!p||p.length===0)return null;const a=s=>s?s.split(",").map(r=>r.trim()).filter(Boolean):[],t=(s,r,l)=>s[r]&&s[r][l]||"Villageois",n=(s,r)=>r&&r.trim()!==""?a(r).some(u=>u.toLowerCase()===s.toLowerCase()):!1,x=(s,r)=>s===r||s==="Traître"&&r==="Loups",i={};p.forEach(s=>{const r=s.Game;if(!r)return;i[r]||(i[r]={});const l=(m,d)=>{m&&m.trim()&&(i[r][m.trim()]=d)},u=s.Loups;u&&a(u).forEach(m=>{i[r][m]="Loups"}),l(s.Traître,"Traître"),l(s["Idiot du village"],"Idiot du Village"),l(s.Cannibale,"Cannibale"),l(s.Espion,"Espion"),l(s["La Bête"],"La Bête"),l(s["Chasseur de primes"],"Chasseur de primes"),l(s.Vaudou,"Vaudou");const R=s.Agent;R&&a(R).forEach(m=>{i[r][m]="Agent"});const b=s.Scientifique;b&&a(b).forEach(m=>{i[r][m]="Scientifique"});const j=s.Amoureux;j&&a(j).forEach(m=>{i[r][m]="Amoureux"})});const h={},f={},o={};let G=0;c.forEach(s=>{const r=s.Game,l=s["Rôles solo"],u=s["Camp victorieux"],R=s["Liste des joueurs"],b=s["Liste des gagnants"];if(l&&l.toString().trim()!==""&&a(l.toString()).forEach(m=>{const d=m.trim();d!==""&&(h[d]||(h[d]=0),h[d]++)}),u&&u.trim()!==""&&(G++,f[u]||(f[u]=0),f[u]++),r&&R&&u&&b){const j=a(R),m=new Set;j.forEach(d=>{const g=d.trim();if(g){const v=t(i,r,g);m.add(v)}}),m.forEach(d=>{o[d]||(o[d]={totalGames:0,wins:0,winRate:0,players:{}}),o[d].totalGames++}),m.forEach(d=>{x(d,u)&&o[d].wins++}),j.forEach(d=>{const g=d.trim();if(g){const v=t(i,r,d);o[v].players[g]||(o[v].players[g]={games:0,wins:0,winRate:0}),o[v].players[g].games++,n(g,b)&&o[v].players[g].wins++}})}}),Object.keys(o).forEach(s=>{o[s].totalGames>0&&(o[s].winRate=parseFloat((o[s].wins/o[s].totalGames*100).toFixed(2))),Object.keys(o[s].players).forEach(r=>{const l=o[s].players[r];l.games>0&&(l.winRate=parseFloat((l.wins/l.games*100).toFixed(2)))})});const S=[];Object.keys(f).forEach(s=>{S.push({camp:s,wins:f[s],winRate:(f[s]/G*100).toFixed(2)})}),S.sort((s,r)=>r.wins-s.wins);const z=Object.keys(o).map(s=>({camp:s,totalGames:o[s].totalGames,winRate:o[s].winRate.toFixed(2)})),W=new Set;Object.keys(o).forEach(s=>{Object.keys(o[s].players).forEach(r=>{W.add(r)})});const K=W.size,F=[];return Object.keys(h).forEach(s=>{F.push({soloRole:s,appearances:h[s]})}),F.sort((s,r)=>r.appearances-s.appearances),{totalGames:G,campStats:S,soloCamps:F,campAverages:z,totalPlayersAnalyzed:K}},[c,p]),isLoading:E||y,errorInfo:A||w}}const Z="#607D8B";function ne(){const{campWinStats:c,isLoading:E,errorInfo:A}=U(),p=C.useMemo(()=>c?.campAverages?c.campAverages.map(a=>({...a,winRateNum:parseFloat(a.winRate)})).sort((a,t)=>t.winRateNum-a.winRateNum):[],[c]),y=C.useMemo(()=>c?.campStats?.map(a=>({...a,winRateNum:typeof a.winRate=="string"?parseFloat(a.winRate):a.winRate}))||[],[c]),w=C.useMemo(()=>{if(!y.length)return[];const a=5;let t=0;const n=[],x=[];return y.forEach(i=>{i.winRateNum<a?(t+=i.winRateNum,n.push(i)):x.push(i)}),t>0&&x.push({camp:"Autres",wins:n.reduce((i,h)=>i+h.wins,0),winRate:t.toFixed(1),winRateNum:t,_details:n}),x},[y]),N=C.useMemo(()=>p.length?p.slice().filter(a=>a.camp!=="Villageois"&&a.camp!=="Loups").sort((a,t)=>t.totalGames-a.totalGames):[],[p]),V=E,L=A;return V?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques des camps..."}):L?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",L]}):c?e.jsxs("div",{className:"lycans-camps-container",children:[e.jsx("h2",{children:"Statistiques des Camps"}),c&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camps Analysés"}),e.jsx("div",{className:"lycans-valeur-principale",children:c.campAverages?.length||0}),e.jsx("p",{children:"camps différents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Joueurs Évalués"}),e.jsx("div",{className:"lycans-valeur-principale",children:c.totalPlayersAnalyzed||0}),e.jsx("p",{children:"joueurs analysés"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:c?.totalGames||0}),e.jsx("p",{children:"parties analysées"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[c&&w.length>0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Répartition des Victoires par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Distribution des victoires sur ",c.totalGames," parties"]}),e.jsx("div",{style:{height:450},children:e.jsx(D,{width:"100%",height:"100%",children:e.jsxs(J,{children:[e.jsx(H,{data:w,cx:"50%",cy:"50%",labelLine:!1,outerRadius:140,fill:"#8884d8",dataKey:"winRateNum",nameKey:"camp",label:({camp:a,winRate:t})=>a==="Autres"?`Autres: ${t}%`:`${a}: ${t}%`,children:w.map((a,t)=>e.jsx(P,{fill:a.camp==="Autres"?Y:T[a.camp]||Z},`cellule-camp-${t}`))}),e.jsx(k,{content:({active:a,payload:t})=>{if(a&&t&&t.length>0){const n=t[0].payload;if(n.camp==="Autres"&&n._details){const x=[...n._details].sort((i,h)=>h.winRateNum-i.winRateNum);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:"Autres"})}),e.jsx("div",{children:x.map((i,h)=>e.jsxs("div",{children:[i.camp,": ",i.wins," victoires (",i.winRate,"%)"]},h))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold"},children:["Total: ",n.wins," victoires (",n.winRate,"%)"]})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:n.camp}),e.jsxs("div",{children:["Victoires: ",n.wins]}),e.jsxs("div",{children:["Taux de victoire: ",n.winRate,"%"]})]})}return null}}),e.jsx(Q,{})]})})})]})}),c?.campAverages&&p.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire Moyen par Camp"}),e.jsx(q,{title:"Taux de Victoire Moyen par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(D,{width:"100%",height:"100%",children:e.jsxs(B,{data:p,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx($,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(k,{content:({active:a,payload:t})=>{if(a&&t&&t.length>0){const n=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.camp})}),e.jsxs("div",{children:["Parties totales: ",n.totalGames]}),e.jsxs("div",{children:["Taux de victoire: ",n.winRate,"%"]})]})}return null}}),e.jsx(I,{dataKey:"winRateNum",children:p.map((a,t)=>e.jsx(P,{fill:T[a.camp]||`var(--chart-color-${t%6+1})`},`cell-${t}`))})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Parties par Camp (hors villageois et loups)"}),e.jsx(q,{title:"Distribution des Parties par Camp (hors villageois et loups)",children:e.jsx("div",{style:{height:400},children:e.jsx(D,{width:"100%",height:"100%",children:e.jsxs(B,{data:N,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx($,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(k,{content:({active:a,payload:t})=>{if(a&&t&&t.length>0){const n=t[0].payload,x=N.reduce((h,f)=>h+f.totalGames,0),i=(n.totalGames/x*100).toFixed(1);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.camp})}),e.jsxs("div",{children:["Parties: ",n.totalGames," (",i,"%)"]}),e.jsxs("div",{children:["Taux victoire: ",n.winRate,"%"]})]})}return null}}),e.jsx(I,{dataKey:"totalGames",children:N.map((a,t)=>e.jsx(P,{fill:T[a.camp]||`var(--chart-color-${t%6+1})`},`cell-${t}`))})]})})})})]})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de camp disponible"})}export{ne as CampsChart};
