import{u as A,a as P,r as b,j as s}from"./index-DVl0V-7M.js";import{u as y}from"./baseStatsHook-C1oRsk5F.js";import{g as O}from"./gameUtils-C0qLdSzT.js";import{u as D}from"./api-Bh9ua3d5.js";import{F as z,B as T,C as w,X as F,Y as I,a as N,b as E}from"./FullscreenChart-BnGG-gMe.js";import{R as k,T as R}from"./CategoricalChart-g9SaZdkj.js";function M(e){return e?(e=O(e),["Loup","Tra√Ætre"].includes(e)?"Loup":e==="Villageois"?"Villageois":"Autres"):"Villageois"}function $(e){const t=new Set;return e.forEach(c=>{c.PlayerStats.forEach(l=>{t.add(l.Username.trim())})}),t}function H(e){const t={};return e.forEach(c=>{t[c]={currentVillageoisSeries:0,currentLoupsSeries:0,longestVillageoisSeries:null,longestLoupsSeries:null,currentWinSeries:0,longestWinSeries:null,currentWinCamps:[],currentLossSeries:0,longestLossSeries:null,currentLossCamps:[],lastCamp:null,lastWon:!1,villageoisSeriesStart:null,loupsSeriesStart:null,winSeriesStart:null,lossSeriesStart:null,currentVillageoisGameIds:[],currentLoupsGameIds:[],currentWinGameIds:[],currentLossGameIds:[]}}),t}function J(e,t,c,l,o){c==="Villageois"||c==="Loup"?(c==="Villageois"&&(e.lastCamp==="Villageois"?(e.currentVillageoisSeries++,e.currentVillageoisGameIds.push(l)):(e.currentVillageoisSeries=1,e.villageoisSeriesStart={game:l,date:o},e.currentVillageoisGameIds=[l]),(!e.longestVillageoisSeries||e.currentVillageoisSeries>=e.longestVillageoisSeries.seriesLength)&&(e.longestVillageoisSeries={player:t,camp:"Villageois",seriesLength:e.currentVillageoisSeries,startGame:e.villageoisSeriesStart?.game||l,endGame:l,startDate:e.villageoisSeriesStart?.date||o,endDate:o,isOngoing:!1,gameIds:[...e.currentVillageoisGameIds]}),e.currentLoupsSeries=0,e.loupsSeriesStart=null,e.currentLoupsGameIds=[]),c==="Loup"&&(e.lastCamp==="Loup"?(e.currentLoupsSeries++,e.currentLoupsGameIds.push(l)):(e.currentLoupsSeries=1,e.loupsSeriesStart={game:l,date:o},e.currentLoupsGameIds=[l]),(!e.longestLoupsSeries||e.currentLoupsSeries>=e.longestLoupsSeries.seriesLength)&&(e.longestLoupsSeries={player:t,camp:"Loups",seriesLength:e.currentLoupsSeries,startGame:e.loupsSeriesStart?.game||l,endGame:l,startDate:e.loupsSeriesStart?.date||o,endDate:o,isOngoing:!1,gameIds:[...e.currentLoupsGameIds]}),e.currentVillageoisSeries=0,e.villageoisSeriesStart=null,e.currentVillageoisGameIds=[]),e.lastCamp=c):(e.currentVillageoisSeries=0,e.currentLoupsSeries=0,e.villageoisSeriesStart=null,e.loupsSeriesStart=null,e.currentVillageoisGameIds=[],e.currentLoupsGameIds=[],e.lastCamp="Autres")}function q(e,t,c,l,o,i){if(c){if(e.lastWon?(e.currentWinSeries++,e.currentWinCamps.push(l),e.currentWinGameIds.push(o)):(e.currentWinSeries=1,e.currentWinCamps=[l],e.winSeriesStart={game:o,date:i},e.currentWinGameIds=[o]),!e.longestWinSeries||e.currentWinSeries>=e.longestWinSeries.seriesLength){const u={};e.currentWinCamps.forEach(v=>{u[v]=(u[v]||0)+1}),e.longestWinSeries={player:t,seriesLength:e.currentWinSeries,startGame:e.winSeriesStart?.game||o,endGame:o,startDate:e.winSeriesStart?.date||i,endDate:i,campCounts:u,isOngoing:!1,gameIds:[...e.currentWinGameIds]}}e.lastWon=!0}else e.currentWinSeries=0,e.currentWinCamps=[],e.winSeriesStart=null,e.currentWinGameIds=[],e.lastWon=!1}function B(e,t,c,l,o,i){if(c)e.currentLossSeries=0,e.currentLossCamps=[],e.lossSeriesStart=null,e.currentLossGameIds=[];else if(e.currentLossSeries>0?(e.currentLossSeries++,e.currentLossCamps.push(l),e.currentLossGameIds.push(o)):(e.currentLossSeries=1,e.currentLossCamps=[l],e.lossSeriesStart={game:o,date:i},e.currentLossGameIds=[o]),!e.longestLossSeries||e.currentLossSeries>=e.longestLossSeries.seriesLength){const u={};e.currentLossCamps.forEach(v=>{u[v]=(u[v]||0)+1}),e.longestLossSeries={player:t,seriesLength:e.currentLossSeries,startGame:e.lossSeriesStart?.game||o,endGame:o,startDate:e.lossSeriesStart?.date||i,endDate:i,campCounts:u,isOngoing:!1,gameIds:[...e.currentLossGameIds]}}}function U(e){const t=[],c=[],l=[],o=[];return Object.values(e).forEach(i=>{i.longestVillageoisSeries&&t.push(i.longestVillageoisSeries),i.longestLoupsSeries&&c.push(i.longestLoupsSeries),i.longestWinSeries&&l.push(i.longestWinSeries),i.longestLossSeries&&o.push(i.longestLossSeries)}),t.sort((i,u)=>u.seriesLength-i.seriesLength),c.sort((i,u)=>u.seriesLength-i.seriesLength),l.sort((i,u)=>u.seriesLength-i.seriesLength),o.sort((i,u)=>u.seriesLength-i.seriesLength),{allVillageoisSeries:t,allLoupsSeries:c,allWinSeries:l,allLossSeries:o}}function K(e,t){const c=[],l=[],o=[],i=[];Object.values(e).forEach(a=>{c.push(a.longestVillageoisSeries?.seriesLength||0),l.push(a.longestLoupsSeries?.seriesLength||0),o.push(a.longestWinSeries?.seriesLength||0),i.push(a.longestLossSeries?.seriesLength||0)});const u=t>0?c.reduce((a,p)=>a+p,0)/t:0,v=t>0?l.reduce((a,p)=>a+p,0)/t:0,L=t>0?o.reduce((a,p)=>a+p,0)/t:0,x=t>0?i.reduce((a,p)=>a+p,0)/t:0,j=c.filter(a=>a>=5).length,h=l.filter(a=>a>=3).length,C=o.filter(a=>a>=5).length,S=i.filter(a=>a>=5).length;return{averageVillageoisSeries:Math.round(u*10)/10,averageLoupsSeries:Math.round(v*10)/10,averageWinSeries:Math.round(L*10)/10,averageLossSeries:Math.round(x*10)/10,eliteVillageoisCount:j,eliteLoupsCount:h,eliteWinCount:C,eliteLossCount:S}}function X(e){if(e.length===0)return null;const t=[...e].sort((r,g)=>parseInt(r.DisplayedId)-parseInt(g.DisplayedId)),c=$(t),l=H(c);t.forEach(r=>{const g=r.DisplayedId,n=new Date(r.StartDate).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});r.PlayerStats.forEach(d=>{const m=d.Username.trim();if(!m)return;const f=l[m],V=M(d.MainRoleInitial),G=d.Victorious;J(f,m,V,g,n),q(f,m,G,V,g,n),B(f,m,G,V,g,n)})});const{allVillageoisSeries:o,allLoupsSeries:i,allWinSeries:u,allLossSeries:v}=U(l);Object.values(l).forEach(r=>{r.longestVillageoisSeries&&r.currentVillageoisSeries===r.longestVillageoisSeries.seriesLength&&r.currentVillageoisSeries>0&&(r.longestVillageoisSeries.isOngoing=!0),r.longestLoupsSeries&&r.currentLoupsSeries===r.longestLoupsSeries.seriesLength&&r.currentLoupsSeries>0&&(r.longestLoupsSeries.isOngoing=!0),r.longestWinSeries&&r.currentWinSeries===r.longestWinSeries.seriesLength&&r.currentWinSeries>0&&(r.longestWinSeries.isOngoing=!0),r.longestLossSeries&&r.currentLossSeries===r.longestLossSeries.seriesLength&&r.currentLossSeries>0&&(r.longestLossSeries.isOngoing=!0)});const L=K(l,c.size);let x=0,j=0,h=0,C=0,S=0,a=0,p=0,W=0;return Object.values(l).forEach(r=>{r.currentVillageoisSeries>0&&x++,r.currentLoupsSeries>0&&j++,r.currentWinSeries>0&&h++,r.currentLossSeries>0&&C++,r.longestVillageoisSeries?.isOngoing&&S++,r.longestLoupsSeries?.isOngoing&&a++,r.longestWinSeries?.isOngoing&&p++,r.longestLossSeries?.isOngoing&&W++}),{allVillageoisSeries:o,allLoupsSeries:i,allWinSeries:u,allLossSeries:v,totalGamesAnalyzed:t.length,totalPlayersCount:c.size,activeVillageoisCount:x,activeLoupsCount:j,activeWinCount:h,activeLossCount:C,ongoingVillageoisCount:S,ongoingLoupsCount:a,ongoingWinCount:p,ongoingLossCount:W,...L}}function Y(){const{data:e,isLoading:t,error:c}=y(l=>X(l));return{data:e,isLoading:t,error:c}}function re(){const{data:e,isLoading:t,error:c}=Y(),{navigateToGameDetails:l}=A(),{settings:o}=P(),[i,u]=b.useState("villageois"),[v,L]=b.useState(null),x=b.useRef(null),j=D(),{currentData:h,highlightedPlayerAdded:C}=b.useMemo(()=>{if(!e)return{currentData:[],highlightedPlayerAdded:!1};let r=[];switch(i){case"villageois":r=e.allVillageoisSeries;break;case"loup":r=e.allLoupsSeries;break;case"wins":r=e.allWinSeries;break;case"losses":r=e.allLossSeries;break;default:r=[]}const g=r.slice(0,20),n=o.highlightedPlayer&&g.some(f=>f.player===o.highlightedPlayer);let d=[...g],m=!1;if(o.highlightedPlayer&&!n){const f=r.find(V=>V.player===o.highlightedPlayer);f&&(d.push({...f,isHighlightedAddition:!0}),m=!0)}return{currentData:d,highlightedPlayerAdded:m}},[e,i,o.highlightedPlayer]);if(t)return s.jsx("div",{className:"donnees-attente",children:"R√©cup√©ration des s√©ries de joueurs..."});if(c)return s.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",c]});if(!e)return s.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de s√©rie disponible"});const S=r=>Object.entries(r).map(([g,n])=>`${g} (${n})`).join(", "),a=()=>{switch(i){case"villageois":return"Plus Longues S√©ries Villageois Cons√©cutives";case"loup":return"Plus Longues S√©ries Loups Cons√©cutives";case"wins":return"Plus Longues S√©ries de Victoires";case"losses":return"Plus Longues S√©ries de D√©faites";default:return""}},p=({active:r,payload:g})=>{if(!r||!g||g.length===0)return null;const n=g[0].payload,d=n.isHighlightedAddition,m=o.highlightedPlayer===n.player;return i==="wins"?s.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[s.jsxs("div",{children:[s.jsx("strong",{children:n.player}),n.isOngoing&&s.jsx("span",{style:{marginLeft:"8px",fontSize:"1.2em"},children:"üî•"})]}),s.jsxs("div",{children:["S√©rie de victoires : ",n.seriesLength," parties ",n.isOngoing?"(En cours)":""]}),s.jsxs("div",{children:["Du ",n.startGame," au ",n.endGame]}),s.jsxs("div",{children:["Du ",n.startDate," au ",n.endDate]}),s.jsxs("div",{children:["Camps jou√©s : ",S(n.campCounts)]}),d&&s.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontStyle:"italic",textAlign:"center"},children:"üéØ Joueur mis en √©vidence (hors top 20)"}),m&&!d&&s.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontStyle:"italic",textAlign:"center"},children:"üéØ Joueur mis en √©vidence"}),n.isOngoing&&s.jsx("div",{style:{fontSize:"0.8rem",color:"#FF8C00",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center"},children:"üî• S√©rie en cours - Aucun jeu depuis !"}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]}):i==="losses"?s.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[s.jsxs("div",{children:[s.jsx("strong",{children:n.player}),n.isOngoing&&s.jsx("span",{style:{marginLeft:"8px",fontSize:"1.2em"},children:"üî•"})]}),s.jsxs("div",{children:["S√©rie de d√©faites : ",n.seriesLength," parties ",n.isOngoing?"(En cours)":""]}),s.jsxs("div",{children:["Du ",n.startGame," au ",n.endGame]}),s.jsxs("div",{children:["Du ",n.startDate," au ",n.endDate]}),s.jsxs("div",{children:["Camps jou√©s : ",S(n.campCounts)]}),d&&s.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontStyle:"italic",textAlign:"center"},children:"üéØ Joueur mis en √©vidence (hors top 20)"}),m&&!d&&s.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontStyle:"italic",textAlign:"center"},children:"üéØ Joueur mis en √©vidence"}),n.isOngoing&&s.jsx("div",{style:{fontSize:"0.8rem",color:"#FF8C00",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center"},children:"üî• S√©rie en cours - Aucun jeu depuis !"}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]}):s.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[s.jsxs("div",{children:[s.jsx("strong",{children:n.player}),n.isOngoing&&s.jsx("span",{style:{marginLeft:"8px",fontSize:"1.2em"},children:"üî•"})]}),s.jsxs("div",{children:["S√©rie ",n.camp," : ",n.seriesLength," parties cons√©cutives ",n.isOngoing?"(En cours)":""]}),s.jsxs("div",{children:["Du ",n.startGame," au ",n.endGame]}),s.jsxs("div",{children:["Du ",n.startDate," au ",n.endDate]}),d&&s.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontStyle:"italic",textAlign:"center"},children:"üéØ Joueur mis en √©vidence (hors top 20)"}),m&&!d&&s.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontStyle:"italic",textAlign:"center"},children:"üéØ Joueur mis en √©vidence"}),n.isOngoing&&s.jsx("div",{style:{fontSize:"0.8rem",color:"#FF8C00",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center"},children:"üî• S√©rie en cours - Aucun jeu depuis !"}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})},W=r=>{if(i==="wins")l({selectedPlayer:r.player,selectedGameIds:r.gameIds,fromComponent:"S√©ries de Victoires"});else if(i==="losses")l({selectedPlayer:r.player,selectedGameIds:r.gameIds,fromComponent:"S√©ries de D√©faites"});else{const g=i==="villageois"?"Villageois":"Loup";l({selectedPlayer:r.player,selectedGameIds:r.gameIds,campFilter:{selectedCamp:g,campFilterMode:"all-assignments"},fromComponent:`S√©ries ${g}`})}};return s.jsxs("div",{className:"lycans-players-series",children:[s.jsx("h2",{children:"S√©ries des Joueurs"}),s.jsxs("p",{className:"lycans-stats-info",children:["Bas√© sur ",e.totalGamesAnalyzed," parties analys√©es"]}),s.jsx("div",{className:"lycans-section-description",children:s.jsxs("p",{children:[s.jsx("strong",{children:"S√©ries de camps :"})," Parties cons√©cutives dans le m√™me camp principal (Villageois ou Loups). Jouer dans n'importe quel autre camp brise la s√©rie.",s.jsx("br",{}),s.jsx("strong",{children:"S√©ries de victoires :"})," Victoires cons√©cutives dans n'importe quel camp. Une d√©faite brise la s√©rie.",s.jsx("br",{}),s.jsx("strong",{children:"S√©ries de d√©faites :"})," D√©faites cons√©cutives dans n'importe quel camp. Une victoire brise la s√©rie.",s.jsx("br",{}),s.jsx("strong",{children:"üî• S√©ries en cours :"})," Les s√©ries avec l'effet de flamme sont encore actives"]})}),s.jsxs("div",{className:"lycans-categories-selection",children:[s.jsx("button",{className:`lycans-categorie-btn ${i==="villageois"?"active":""}`,onClick:()=>u("villageois"),children:"S√©ries Villageois"}),s.jsx("button",{className:`lycans-categorie-btn ${i==="loup"?"active":""}`,onClick:()=>u("loup"),children:"S√©ries Loups"}),s.jsx("button",{className:`lycans-categorie-btn ${i==="wins"?"active":""}`,onClick:()=>u("wins"),children:"S√©ries de Victoires"}),s.jsx("button",{className:`lycans-categorie-btn ${i==="losses"?"active":""}`,onClick:()=>u("losses"),children:"S√©ries de D√©faites"})]}),s.jsxs("div",{className:"lycans-graphique-section",children:[s.jsxs("div",{children:[s.jsx("h3",{children:a()}),C&&o.highlightedPlayer&&s.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',o.highlightedPlayer,'" affich√© en plus du top 20']})]}),s.jsx(z,{title:a(),children:s.jsx("div",{ref:x,style:{height:500},children:s.jsx(k,{width:"100%",height:"100%",children:s.jsxs(T,{data:h,margin:{top:20,right:30,left:20,bottom:10},children:[s.jsx(w,{strokeDasharray:"3 3"}),s.jsx(F,{dataKey:"player",angle:-45,textAnchor:"end",height:120,interval:0,tick:({x:r,y:g,payload:n})=>s.jsx("text",{x:r,y:g,dy:16,textAnchor:"end",fill:o.highlightedPlayer===n.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:o.highlightedPlayer===n.value?14:13,fontWeight:o.highlightedPlayer===n.value?"bold":"italic",transform:`rotate(-45 ${r} ${g})`,children:n.value})}),s.jsx(I,{label:{value:i==="wins"?"Victoires cons√©cutives":i==="losses"?"D√©faites cons√©cutives":"Parties cons√©cutives",angle:270,position:"insideLeft",style:{textAnchor:"middle"}}}),s.jsx(R,{content:p}),s.jsx(N,{dataKey:"seriesLength",name:i==="wins"?"Victoires cons√©cutives":i==="losses"?"D√©faites cons√©cutives":"Parties cons√©cutives",fill:i==="villageois"?"#82ca9d":i==="loup"?"#FF8042":i==="wins"?"#8884d8":"#dc3545",children:h.map((r,g)=>{const n=o.highlightedPlayer===r.player,d=v===r.player,m=r.isHighlightedAddition,f=j[r.player]||(i==="villageois"?"#82ca9d":i==="loup"?"#FF8042":i==="wins"?"#8884d8":"#dc3545");return s.jsx(E,{fill:f,stroke:n?"var(--accent-primary)":d?"var(--text-primary)":"none",strokeWidth:n?3:d?2:0,strokeDasharray:m?"5,5":"none",opacity:m?.8:1,onClick:()=>W(r),onMouseEnter:()=>L(r.player),onMouseLeave:()=>L(null),style:{cursor:"pointer"},className:r.isOngoing?"lycans-ongoing-series":""},`cell-${i}-${g}`)})})]})})})}),h.length>0&&s.jsxs("div",{className:"lycans-stats-grid",style:{marginTop:"0rem",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))"},children:[s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"üèÜ Record Absolu"}),s.jsxs("div",{className:"lycans-stat-value",children:[h[0].seriesLength,h[0].isOngoing&&s.jsx("span",{style:{fontSize:"0.6em",marginLeft:"5px"},children:"üî•"})]}),s.jsxs("p",{children:["par ",s.jsx("strong",{children:h[0].player}),h[0].isOngoing&&s.jsx("span",{style:{color:"#FF8C00",fontWeight:"bold"},children:" (En cours)"})]}),i==="wins"||i==="losses"?s.jsxs("p",{className:"lycans-h2h-description",children:["Camps : ",S(h[0].campCounts||{})]}):s.jsxs("p",{className:"lycans-h2h-description",children:["Camp : ",h[0].camp]})]}),s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"üìä Meilleure s√©rie moyenne (tous les joueurs)"}),s.jsx("div",{className:"lycans-stat-value",children:i==="villageois"?e.averageVillageoisSeries:i==="loup"?e.averageLoupsSeries:i==="wins"?e.averageWinSeries:e.averageLossSeries}),s.jsx("p",{children:"parties en moyenne"}),s.jsxs("p",{className:"lycans-h2h-description",children:["Bas√© sur ",e.totalPlayersCount," joueurs"]})]}),s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"üî• S√©ries En Cours"}),s.jsx("div",{className:"lycans-stat-value",children:i==="villageois"?e.activeVillageoisCount:i==="loup"?e.activeLoupsCount:i==="wins"?e.activeWinCount:e.activeLossCount}),s.jsx("p",{children:"s√©ries encore actives"}),s.jsx("p",{className:"lycans-h2h-description",children:(i==="villageois"?e.activeVillageoisCount:i==="loup"?e.activeLoupsCount:i==="wins"?e.activeWinCount:e.activeLossCount)>0?"Joueurs actuellement dans une s√©rie de ce type":"Aucune s√©rie active de ce type"})]})]}),h.length===0&&s.jsxs("div",{className:"lycans-empty-section",children:[s.jsx("h3",{children:"Aucune s√©rie trouv√©e"}),s.jsx("p",{children:"Aucune s√©rie n'a √©t√© trouv√©e pour ce type avec les filtres actuels."})]})]})]})}export{re as PlayerSeriesChart};
