import{u as G,j as t}from"./index-BgHXmNuz.js";import{a as I}from"./baseStatsHook-jvItowi9.js";import{a as N,c as C}from"./gameUtils-ZH6YLU-8.js";import{a as A,l as B}from"./api-DmJeUsCZ.js";import{F as d,B as g,C as h,X as p,Y as D,a as v,b as R}from"./FullscreenChart-B4-ly98a.js";import{R as x,T as y,V as k}from"./CategoricalChart-CWY-YEVQ.js";import{L,a as F}from"./LineChart-DWcvA5tv.js";import{L as T}from"./Legend-rJlqxQOC.js";import"./ActivePoints-B12Y4G-A.js";function m(e){const r=Math.floor(e/3600),n=Math.floor(e%3600/60),o=e%60;return r>0?`${r}h${n.toString().padStart(2,"0")}m${o.toString().padStart(2,"0")}s`:n>0?`${n}m${o.toString().padStart(2,"0")}s`:`${o}s`}function W(e,r=10){const n=Math.round(e/60);return Math.round(n/r)*r}function P(){return{averageDuration:"0s",maxDuration:0,minDuration:1/0,maxDurationGameId:null,minDurationGameId:null,durationDistribution:{},durationsByWinnerCamp:{},durationsByPlayerCount:{},durationsByWolfRatio:{}}}function $(e,r,n){e>n.maxDuration&&(n.maxDuration=e,n.maxDurationGameId=r),e<n.minDuration&&(n.minDuration=e,n.minDurationGameId=r)}function S(e,r){const n=W(e,2);r[n]||(r[n]=0),r[n]++}function q(e,r,n){e&&e.trim()!==""&&(n[e]||(n[e]={totalDuration:0,count:0,average:"0s"}),n[e].totalDuration+=r,n[e].count++)}function E(e,r,n){if(e&&!isNaN(e)&&e>0){const o=e.toString();n[o]||(n[o]={totalDuration:0,count:0,average:"0s"}),n[o].totalDuration+=r,n[o].count++}}function w(e,r,n,o){if(e&&r&&!isNaN(e)&&!isNaN(r)&&e>0){const s=e-r;if(s>0){const u=Math.round(r/s*100),a=(Math.round(u/1)*1).toString();o[a]||(o[a]={totalDuration:0,count:0,average:"0s"}),o[a].totalDuration+=n,o[a].count++}}}function z(e,r,n,o){const s=e.PlayerStats.length,u=e.PlayerStats.filter(i=>i.MainRoleInitial==="Loup").length;let l=N(e);const a=C(e.StartDate,e.EndDate);a&&!isNaN(a)&&a>0&&(n.gamesWithDuration++,n.totalDuration+=a,$(a,o+1,r),S(a,r.durationDistribution),q(l,a,r.durationsByWinnerCamp),E(s,a,r.durationsByPlayerCount),w(s,u,a,r.durationsByWolfRatio))}function K(e,r){if(r.gamesWithDuration>0){const n=r.totalDuration/r.gamesWithDuration;e.averageDuration=m(Math.round(n)),Object.keys(e.durationsByWinnerCamp).forEach(o=>{const s=e.durationsByWinnerCamp[o];if(s.count>0){const u=s.totalDuration/s.count;s.average=m(Math.round(u))}}),Object.keys(e.durationsByPlayerCount).forEach(o=>{const s=e.durationsByPlayerCount[o];if(s.count>0){const u=s.totalDuration/s.count;s.average=m(Math.round(u))}}),Object.keys(e.durationsByWolfRatio).forEach(o=>{const s=e.durationsByWolfRatio[o];if(s.count>0){const u=s.totalDuration/s.count;s.average=m(Math.round(u))}})}}function V(e){const r=Object.keys(e).map(n=>({duration:parseInt(n),count:e[parseInt(n)]}));return r.sort((n,o)=>n.duration-o.duration),r}function O(e){if(e.length===0)return null;const r=P(),n={totalDuration:0,gamesWithDuration:0};e.forEach((s,u)=>{z(s,r,n,u)}),K(r,n);const o=V(r.durationDistribution);return{averageDuration:r.averageDuration,maxDuration:r.maxDuration,minDuration:r.minDuration===1/0?0:r.minDuration,maxDurationGameId:r.maxDurationGameId,minDurationGameId:r.minDurationGameId,durationDistribution:o,durationsByWinnerCamp:r.durationsByWinnerCamp,durationsByPlayerCount:r.durationsByPlayerCount,durationsByWolfRatio:r.durationsByWolfRatio}}function Y(){const{data:e,isLoading:r,error:n}=I(O);return{durationAnalysis:e,fetchingData:r,apiError:n}}function ae(){const{durationAnalysis:e,fetchingData:r,apiError:n}=Y(),{navigateToGameDetails:o}=G();if(r)return t.jsx("div",{className:"statistiques-attente",children:"Analyse des durées de partie en cours..."});if(n)return t.jsxs("div",{className:"statistiques-echec",children:["Problème rencontré: ",n]});if(!e)return t.jsx("div",{className:"statistiques-indisponibles",children:"Données d'analyse non disponibles"});const s=a=>{const i=a.match(/(\d+)h/),c=a.match(/(\d+)m/),f=a.match(/(\d+)s/),j=i?parseInt(i[1]):0,b=c?parseInt(c[1]):0,M=f?parseInt(f[1]):0;return j*60+b+M/60},u=e?Object.entries(e.durationsByWolfRatio).map(([a,i])=>({ratio:parseFloat(a),moyenne:s(i.average),parties:i.count,dureeFormatee:i.average})).sort((a,i)=>a.ratio-i.ratio):[],l=e?Object.entries(e.durationsByWinnerCamp).map(([a,i])=>({camp:a,moyenne:s(i.average),parties:i.count,dureeFormatee:i.average})).sort((a,i)=>i.moyenne-a.moyenne):[];return t.jsxs("div",{className:"lycans-duree-analyse",children:[t.jsx("h2",{children:"Analyse des Durées de Partie"}),t.jsxs("div",{className:"lycans-resume-conteneur",children:[t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Durée Moyenne"}),t.jsx("p",{className:"lycans-valeur-principale",children:e.averageDuration||"N/A"})]}),t.jsxs("div",{className:"lycans-stat-carte",onClick:()=>{e.minDurationGameId&&o({selectedGame:e.minDurationGameId,fromComponent:"Analyse des Durées de Partie"})},style:{cursor:e.minDurationGameId?"pointer":"default",opacity:e.minDurationGameId?1:.7,transition:"transform 0.2s ease, box-shadow 0.2s ease"},onMouseEnter:a=>{e.minDurationGameId&&(a.currentTarget.style.transform="translateY(-2px)",a.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)")},onMouseLeave:a=>{e.minDurationGameId&&(a.currentTarget.style.transform="translateY(0)",a.currentTarget.style.boxShadow="")},title:e.minDurationGameId?"Cliquez pour voir cette partie":"Aucune partie trouvée",children:[t.jsx("h3",{children:"Durée Minimum"}),t.jsxs("p",{className:"lycans-valeur-principale",children:[Math.floor(e.minDuration/60),"min ",e.minDuration%60,"s"]}),e.minDurationGameId&&t.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:["🖱️ Partie #",e.minDurationGameId]})]}),t.jsxs("div",{className:"lycans-stat-carte",onClick:()=>{e.maxDurationGameId&&o({selectedGame:e.maxDurationGameId,fromComponent:"Analyse des Durées de Partie"})},style:{cursor:e.maxDurationGameId?"pointer":"default",opacity:e.maxDurationGameId?1:.7,transition:"transform 0.2s ease, box-shadow 0.2s ease"},onMouseEnter:a=>{e.maxDurationGameId&&(a.currentTarget.style.transform="translateY(-2px)",a.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)")},onMouseLeave:a=>{e.maxDurationGameId&&(a.currentTarget.style.transform="translateY(0)",a.currentTarget.style.boxShadow="")},title:e.maxDurationGameId?"Cliquez pour voir cette partie":"Aucune partie trouvée",children:[t.jsx("h3",{children:"Durée Maximum"}),t.jsxs("p",{className:"lycans-valeur-principale",children:[Math.floor(e.maxDuration/60),"min ",e.maxDuration%60,"s"]}),e.maxDurationGameId&&t.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:["🖱️ Partie #",e.maxDurationGameId]})]})]}),t.jsxs("div",{className:"lycans-graphiques-section",children:[t.jsxs("div",{className:"lycans-graphique-element",children:[t.jsx("h3",{children:"Distribution des Durées de Partie"}),t.jsx(d,{title:"Distribution des Durées de Partie",children:t.jsx("div",{style:{height:300},children:t.jsx(x,{width:"100%",height:"100%",children:t.jsxs(g,{data:e?.durationDistribution||[],margin:{top:20,right:30,left:20,bottom:5},children:[t.jsx(h,{strokeDasharray:"3 3"}),t.jsx(p,{dataKey:"duration",label:{value:"Durée (minutes)",position:"insideBottom",offset:-5},tickFormatter:a=>`${a}min`}),t.jsx(D,{label:{value:"Nombre de Parties",angle:-90,position:"insideLeft"}}),t.jsx(y,{content:({active:a,payload:i})=>{if(a&&i&&i.length>0){const c=i[0].payload;return t.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[t.jsx("div",{children:t.jsxs("strong",{children:["~",c.duration," minutes"]})}),t.jsxs("div",{children:[c.count," parties"]}),t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:"Durées regroupées par intervalles de 2 minutes"})]})}return null}}),t.jsx(v,{dataKey:"count",name:"Nombre de Parties",fill:"var(--chart-color-2)"})]})})})})]}),t.jsxs("div",{className:"lycans-graphique-element",children:[t.jsx("h3",{children:"Durée Moyenne par Ratio Loups/Villageois"}),t.jsx(d,{title:"Durée Moyenne par Ratio Loups/Villageois",children:t.jsx("div",{style:{height:300},children:t.jsx(x,{width:"100%",height:"100%",children:t.jsxs(L,{data:u,margin:{top:20,right:30,left:20,bottom:5},children:[t.jsx(h,{strokeDasharray:"3 3"}),t.jsx(p,{dataKey:"ratio",type:"number",domain:["auto","auto"],allowDecimals:!1,tickFormatter:a=>`${a}%`,label:{value:"Ratio Loups/Joueurs (%)",position:"insideBottom",offset:-5}}),t.jsx(D,{label:{value:"Durée Moyenne (minutes)",angle:-90,position:"insideLeft"},tickFormatter:a=>`${Math.round(a)}min`}),t.jsx(y,{content:({active:a,payload:i})=>{if(a&&i&&i.length>0){const c=i[0].payload;return t.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[t.jsx("div",{children:t.jsxs("strong",{children:["Pourcentage de loups : ",c.ratio,"%"]})}),t.jsxs("div",{children:["Durée moyenne : ",c.dureeFormatee]}),t.jsxs("div",{children:["Nombre de parties : ",c.parties]})]})}return null}}),t.jsx(T,{}),t.jsx(F,{type:"monotone",dataKey:"moyenne",name:"Durée Moyenne",stroke:"var(--chart-color-5)",activeDot:{r:8}})]})})})})]}),t.jsxs("div",{className:"lycans-graphique-element",children:[t.jsx("h3",{children:"Durée Moyenne par Camp Victorieux"}),t.jsx(d,{title:"Durée Moyenne par Camp Victorieux",children:t.jsx("div",{style:{height:300},children:t.jsx(x,{width:"100%",height:"100%",children:t.jsxs(g,{data:l,margin:{top:20,right:30,left:20,bottom:60},children:[t.jsx(h,{strokeDasharray:"3 3"}),t.jsx(p,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0}),t.jsx(D,{label:{value:"Durée Moyenne (minutes)",angle:-90,position:"insideLeft"},tickFormatter:a=>`${Math.round(a)}min`}),t.jsx(y,{content:({active:a,payload:i})=>{if(a&&i&&i.length>0){const c=i[0].payload;return t.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[t.jsx("div",{children:t.jsx("strong",{children:c.camp})}),t.jsxs("div",{children:["Durée moyenne : ",c.dureeFormatee]}),t.jsxs("div",{children:["Nombre de parties : ",c.parties]}),t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),t.jsxs(v,{dataKey:"moyenne",name:"moyenne",isAnimationActive:!1,onClick:a=>{a&&a.camp&&o({campFilter:{selectedCamp:a.camp,campFilterMode:"wins-only"},fromComponent:"Durée Moyenne par Camp Victorieux"})},style:{cursor:"pointer"},children:[l.map(a=>t.jsx(R,{fill:A[a.camp]||B},`cell-${a.camp}`)),t.jsx(k,{dataKey:"moyenne",position:"top",formatter:a=>{const i=typeof a=="number"?a:Number(a);return isNaN(i)?"":`${Math.round(i)}min`},fill:"var(--text-primary)",fontSize:12})]})]})})})})]})]})]})}export{ae as GameDurationInsights};
