import{b as k,s as T,g as w,d as E,a as M,u as S,r as y,j as e}from"./index-fQGPSwzF.js";import{u as L}from"./baseStatsHook-DH41hxrD.js";import{l as V,a as v}from"./api-beq3FXpM.js";import{b as j,F as R,B as F,C as A,X as N,Y as G,a as P}from"./FullscreenChart-CNf7WybZ.js";import{R as C,T as b}from"./CategoricalChart-CyY_1z8_.js";import{P as z,a as D}from"./PieChart-iEIUC0q6.js";import{L as _}from"./Legend-CHoZHd1F.js";import"./PolarChart-Bru0Yg6g.js";function W(i,t){i&&i.toString().trim()!==""&&T(i.toString()).forEach(n=>{const l=n.trim();l!==""&&(t[l]||(t[l]=0),t[l]++)})}function q(i,t){return i&&i.trim()!==""?(t[i]||(t[i]=0),t[i]++,!0):!1}function O(i,t,o,n,l,d){const h=T(t),f=new Set;h.forEach(m=>{const p=m.trim();if(p){const s=w(l,i,p);f.add(s)}}),f.forEach(m=>{d[m]||(d[m]={totalGames:0,wins:0,winRate:0,players:{}}),d[m].totalGames++}),f.forEach(m=>{E(m,o)&&d[m].wins++}),h.forEach(m=>{const p=m.trim();if(p){const s=w(l,i,m);d[s].players[p]||(d[s].players[p]={games:0,wins:0,winRate:0}),d[s].players[p].games++,M(p,n)&&d[s].players[p].wins++}})}function $(i){Object.keys(i).forEach(t=>{i[t].totalGames>0&&(i[t].winRate=parseFloat((i[t].wins/i[t].totalGames*100).toFixed(2))),Object.keys(i[t].players).forEach(o=>{const n=i[t].players[o];n.games>0&&(n.winRate=parseFloat((n.wins/n.games*100).toFixed(2)))})})}function B(i,t){const o=[];return Object.keys(i).forEach(n=>{o.push({camp:n,wins:i[n],winRate:(i[n]/t*100).toFixed(2)})}),o.sort((n,l)=>l.wins-n.wins),o}function K(i){return Object.keys(i).map(t=>({camp:t,totalGames:i[t].totalGames,winRate:i[t].winRate.toFixed(2)}))}function I(i){const t=new Set;return Object.keys(i).forEach(o=>{Object.keys(i[o].players).forEach(n=>{t.add(n)})}),t.size}function X(i){const t=[];return Object.keys(i).forEach(o=>{t.push({soloRole:o,appearances:i[o]})}),t.sort((o,n)=>n.appearances-o.appearances),t}function Y(i,t){if(i.length===0||t.length===0)return null;const o=k(t),n={},l={},d={};let h=0;i.forEach(a=>{const r=a.Game.toString(),u=a["Rôles solo"],c=a["Camp victorieux"],x=a["Liste des joueurs"],g=a["Liste des gagnants"];W(u,n),q(c,l)&&h++,r&&x&&c&&g&&O(r,x,c,g,o,d)}),$(d);const f=B(l,h),m=K(d),p=I(d),s=X(n);return{totalGames:h,campStats:f,soloCamps:s,campAverages:m,totalPlayersAnalyzed:p}}function J(){const{data:i,isLoading:t,error:o}=L(Y);return{campWinStats:i,isLoading:t,errorInfo:o}}const H="#607D8B";function re(){const{navigateToGameDetails:i}=S(),{campWinStats:t,isLoading:o,errorInfo:n}=J(),l=y.useMemo(()=>t?.campAverages?t.campAverages.map(s=>({...s,winRateNum:parseFloat(s.winRate)})).sort((s,a)=>a.winRateNum-s.winRateNum):[],[t]),d=y.useMemo(()=>t?.campStats?.map(s=>({...s,winRateNum:typeof s.winRate=="string"?parseFloat(s.winRate):s.winRate}))||[],[t]),h=y.useMemo(()=>{if(!d.length)return[];const s=5;let a=0;const r=[],u=[];return d.forEach(c=>{c.winRateNum<s?(a+=c.winRateNum,r.push(c)):u.push(c)}),a>0&&u.push({camp:"Autres",wins:r.reduce((c,x)=>c+x.wins,0),winRate:a.toFixed(1),winRateNum:a,_details:r}),u},[d]),f=y.useMemo(()=>l.length?l.slice().filter(s=>s.camp!=="Villageois"&&s.camp!=="Loups").sort((s,a)=>a.totalGames-s.totalGames):[],[l]),m=o,p=n;return m?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques des camps..."}):p?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",p]}):t?e.jsxs("div",{className:"lycans-camps-container",children:[e.jsx("h2",{children:"Statistiques des Camps"}),t&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camps Analysés"}),e.jsx("div",{className:"lycans-valeur-principale",children:t.campAverages?.length||0}),e.jsx("p",{children:"camps différents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Joueurs Évalués"}),e.jsx("div",{className:"lycans-valeur-principale",children:t.totalPlayersAnalyzed||0}),e.jsx("p",{children:"joueurs analysés"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:t?.totalGames||0}),e.jsx("p",{children:"parties analysées"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[t&&h.length>0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Répartition des Victoires par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Distribution des victoires sur ",t.totalGames," parties"]}),e.jsx("div",{style:{height:450},children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(z,{children:[e.jsx(D,{data:h,cx:"50%",cy:"50%",labelLine:!1,outerRadius:140,fill:"#8884d8",dataKey:"winRateNum",nameKey:"camp",onClick:s=>{if(s&&s.camp)if(s.camp==="Autres"&&s._details){const a=s._details.map(r=>r.camp);i({campFilter:{selectedCamp:"Autres",campFilterMode:"wins-only",_smallCamps:a},fromComponent:"Répartition des Victoires par Camp"})}else i({campFilter:{selectedCamp:s.camp,campFilterMode:"wins-only"},fromComponent:"Répartition des Victoires par Camp"})},style:{cursor:"pointer"},label:({camp:s,winRate:a})=>s==="Autres"?`Autres: ${a}%`:`${s}: ${a}%`,children:h.map((s,a)=>e.jsx(j,{fill:s.camp==="Autres"?V:v[s.camp]||H,onClick:()=>{if(s.camp==="Autres"&&s._details){const r=s._details.map(u=>u.camp);i({campFilter:{selectedCamp:"Autres",campFilterMode:"wins-only",_smallCamps:r},fromComponent:"Répartition des Victoires par Camp"})}else i({campFilter:{selectedCamp:s.camp,campFilterMode:"wins-only"},fromComponent:"Répartition des Victoires par Camp"})},style:{cursor:"pointer"}},`cellule-camp-${a}`))}),e.jsx(b,{content:({active:s,payload:a})=>{if(s&&a&&a.length>0){const r=a[0].payload;if(r.camp==="Autres"&&r._details){const u=[...r._details].sort((c,x)=>x.winRateNum-c.winRateNum);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:"Autres"})}),e.jsx("div",{children:u.map((c,x)=>e.jsxs("div",{children:[c.camp,": ",c.wins," victoires (",c.winRate,"%)"]},x))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold"},children:["Total: ",r.wins," victoires (",r.winRate,"%)"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:r.camp}),e.jsxs("div",{children:["Victoires: ",r.wins]}),e.jsxs("div",{children:["Taux de victoire: ",r.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(_,{})]})})})]})}),t?.campAverages&&l.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire Moyen par Camp"}),e.jsx(R,{title:"Taux de Victoire Moyen par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(F,{data:l,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(A,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(G,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(b,{content:({active:s,payload:a})=>{if(s&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.camp})}),e.jsxs("div",{children:["Parties totales: ",r.totalGames]}),e.jsxs("div",{children:["Taux de victoire: ",r.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(P,{dataKey:"winRateNum",onClick:s=>{s&&s.camp&&i({campFilter:{selectedCamp:s.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Taux de Victoire Moyen par Camp"})},style:{cursor:"pointer"},children:l.map((s,a)=>e.jsx(j,{fill:v[s.camp]||`var(--chart-color-${a%6+1})`,onClick:()=>{i({campFilter:{selectedCamp:s.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Taux de Victoire Moyen par Camp"})},style:{cursor:"pointer"}},`cell-${a}`))})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Parties par Camp (hors villageois et loups)"}),e.jsx(R,{title:"Distribution des Parties par Camp (hors villageois et loups)",children:e.jsx("div",{style:{height:400},children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(F,{data:f,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(A,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(G,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(b,{content:({active:s,payload:a})=>{if(s&&a&&a.length>0){const r=a[0].payload,u=f.reduce((x,g)=>x+g.totalGames,0),c=(r.totalGames/u*100).toFixed(1);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.camp})}),e.jsxs("div",{children:["Parties: ",r.totalGames," (",c,"%)"]}),e.jsxs("div",{children:["Taux victoire: ",r.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(P,{dataKey:"totalGames",onClick:s=>{s&&s.camp&&i({campFilter:{selectedCamp:s.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Distribution des Parties par Camp"})},style:{cursor:"pointer"},children:f.map((s,a)=>e.jsx(j,{fill:v[s.camp]||`var(--chart-color-${a%6+1})`,onClick:()=>{i({campFilter:{selectedCamp:s.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Distribution des Parties par Camp"})},style:{cursor:"pointer"}},`cell-${a}`))})]})})})})]})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de camp disponible"})}export{re as CampsChart};
