import{r as o,j as e}from"./index-DV88Is_b.js";import{g as C}from"./api-CzvsImqf.js";import{R as g,B as m,C as v,X as f,Y as P,T as j,a as b,b as D,L as S}from"./BarChart-CQ431gI_.js";import{P as E,a as w}from"./PieChart-DVv_7L6d.js";function F(){const[r,x]=o.useState(null),[c,i]=o.useState(!0),[d,u]=o.useState(null);return o.useEffect(()=>{(async()=>{try{i(!0),u(null);const l=await fetch("https://script.google.com/macros/s/AKfycbw7amBQVger2k8MpFhueGGtAMUsYioIvdU2yVcixtFuk66a2DRWEpZ_c3xf2nncKjuHPg/exec?action=playerStats");if(!l.ok)throw new Error(`Erreur API: ${l.status}`);const h=await l.json();x(h)}catch(n){console.error("Erreur lors de la récupération des statistiques des joueurs:",n),u(n instanceof Error?n.message:"Erreur inconnue")}finally{i(!1)}})()},[]),{playerStatsData:r,dataLoading:c,fetchError:d}}function k(){const{playerStatsData:r,dataLoading:x,fetchError:c}=F(),[i,d]=o.useState(null);if(x)return e.jsx("div",{className:"donnees-attente",children:"Récupération des statistiques des joueurs..."});if(c)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",c]});if(!r)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de joueur disponible"});const u=r.playerStats.filter(a=>a.gamesPlayed>2).sort((a,s)=>s.gamesPlayed-a.gamesPlayed).slice(0,20),y=r.playerStats.filter(a=>a.gamesPlayed>=5).sort((a,s)=>parseFloat(s.winPercent)-parseFloat(a.winPercent)).slice(0,20),n=a=>{const s=r.playerStats.find(t=>t.player===a);return s?Object.entries(s.camps).filter(([t,p])=>p>0).map(([t,p])=>({name:t,value:p,percentage:(p/s.gamesPlayed*100).toFixed(1)})):[]},l={Villageois:"#4CAF50",Loups:"#F44336",Traître:"#9C27B0","Idiot du Village":"#FF9800",Cannibale:"#795548",Agent:"#2196F3",Espion:"#607D8B",Scientifique:"#00BCD4",Amoureux:"#E91E63","La Bête":"#673AB7","Chasseur de primes":"#FFC107",Vaudou:"#3F51B5"},h=i?n(i):[];return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques des Joueurs"}),e.jsxs("p",{className:"lycans-stats-info",children:["Total de ",r.totalGames," parties analysées avec ",r.playerStats.length," joueurs"]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Participations"}),e.jsx("div",{style:{height:400},children:e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(m,{data:u,margin:{top:20,right:30,left:20,bottom:70},children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(f,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(P,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(j,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const t=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:t.player})}),e.jsxs("div",{children:["Parties jouées : ",t.gamesPlayed]}),e.jsxs("div",{children:["Pourcentage : ",t.gamesPlayedPercent,"%"]})]})}return null}}),e.jsx(b,{dataKey:"gamesPlayed",name:"Parties jouées",fill:"var(--chart-color-2)",onClick:a=>d(a?.payload?.player)})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Meilleurs Taux de Victoire (min. 5 parties)"}),e.jsx("div",{style:{height:400},children:e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(m,{data:y,margin:{top:20,right:30,left:20,bottom:70},children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(f,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(P,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(j,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const t=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:t.player})}),e.jsxs("div",{children:["Taux de victoire : ",t.winPercent,"%"]}),e.jsxs("div",{children:["Victoires : ",t.wins," / ",t.gamesPlayed]})]})}return null}}),e.jsx(b,{dataKey:"winPercent",name:"Taux de Victoire",fill:"var(--chart-color-5)",onClick:a=>d(a?.payload?.player)})]})})})]})]}),i&&e.jsxs("div",{className:"lycans-graphique-section lycans-joueur-details",children:[e.jsxs("h3",{children:["Distribution des Camps - ",i]}),e.jsx("div",{style:{height:300},children:e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(E,{children:[e.jsx(w,{data:h,cx:"50%",cy:"50%",labelLine:!0,outerRadius:80,fill:"#8884d8",dataKey:"value",nameKey:"name",label:({name:a,percentage:s})=>`${a}: ${s}%`,children:h.map((a,s)=>e.jsx(D,{fill:l[a.name]||C(a.name)},`cell-${s}`))}),e.jsx(j,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const t=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:t.name})}),e.jsxs("div",{children:[t.value," parties (",t.percentage,"%)"]})]})}return null}}),e.jsx(S,{})]})})})]})]})}export{k as PlayersGeneralStatisticsChart};
