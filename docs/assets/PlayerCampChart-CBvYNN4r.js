import{g as ie,b as ye,j as e,u as Pe,a as je,r as M}from"./index-C3nKP7nN.js";import{u as ve}from"./baseStatsHook-D9udRBc8.js";import{a as X,b as ne,g as Re}from"./datasyncExport-CjB7UYqV.js";import{g as Y}from"./roleUtils-CLjkiQQc.js";import{u as be}from"./useJoueursData-d-XH-j9k.js";import{a as Te,u as Ce,m as we}from"./api-Civ0mq_q.js";import{F as te,C as oe,X as le,Y as ce,a as Ae}from"./FullscreenChart-B3MygqK8.js";import{R as me,T as pe}from"./CategoricalChart-Dnt1YB7q.js";import{B as Fe,a as Ne}from"./BarChart-DD2auIcS.js";import{S as Ve,a as Le}from"./ScatterChart-DIU3lTDE.js";function U(i,r){const c=X(i.MainRoleInitial,i.MainRoleChanges||[]),n=Y(i);return Re(c,r,n)}function se(i,r=!1,c=!1){const n={};return i.forEach(p=>{const m=new Set;p.PlayerStats.forEach(t=>{const l=U(t,{regroupWolfSubRoles:r,regroupVillagers:c});m.add(l)}),m.forEach(t=>{n[t]||(n[t]={totalGames:0,wins:0,winRate:0,players:{}}),n[t].totalGames++});const f=new Set;p.PlayerStats.forEach(t=>{if(t.Victorious){const l=U(t,{regroupWolfSubRoles:r,regroupVillagers:c});f.add(l)}}),f.forEach(t=>{n[t]&&n[t].wins++})}),n}function ae(i,r,c=!1,n=!1){const p={};return i.forEach(m=>{m.PlayerStats.forEach(f=>{const t=ie(f),l=f.Username,s=U(f,{regroupWolfSubRoles:c,regroupVillagers:n}),o=s==="Autres"?"R√¥les sp√©ciaux":s;r[o].players[t]||(r[o].players[t]={games:0,wins:0,winRate:0,displayName:l}),r[o].players[t].games++,r[o].players[t].displayName=l,f.Victorious&&r[o].players[t].wins++,p[t]||(p[t]={totalGames:0,camps:{},displayName:l}),p[t].displayName=l,p[t].camps[o]||(p[t].camps[o]={games:0,wins:0,winRate:0,performance:0}),p[t].totalGames++,p[t].camps[o].games++,f.Victorious&&p[t].camps[o].wins++})}),p}function We(i){const r={};return r["R√¥les sp√©ciaux"]={totalGames:0,wins:0,winRate:0,players:{}},i.forEach(c=>{c.PlayerStats.forEach(n=>{const p=Y(n),m=X(n.MainRoleInitial,n.MainRoleChanges||[]);ne(m,p)==="Autres"&&(r["R√¥les sp√©ciaux"].totalGames++,n.Victorious&&r["R√¥les sp√©ciaux"].wins++)})}),r}function Ge(i,r){const c={};return i.forEach(n=>{n.PlayerStats.forEach(p=>{const m=ie(p),f=p.Username,t=Y(p);if(ne(X(p.MainRoleInitial,p.MainRoleChanges||[]),t)==="Autres"){const s="R√¥les sp√©ciaux";r[s].players[m]||(r[s].players[m]={games:0,wins:0,winRate:0,displayName:f}),r[s].players[m].games++,r[s].players[m].displayName=f,p.Victorious&&r[s].players[m].wins++,c[m]||(c[m]={totalGames:0,camps:{},displayName:f}),c[m].displayName=f,c[m].camps[s]||(c[m].camps[s]={games:0,wins:0,winRate:0,performance:0}),c[m].totalGames++,c[m].camps[s].games++,p.Victorious&&c[m].camps[s].wins++}})}),c}function K(i){Object.keys(i).forEach(r=>{i[r].totalGames>0&&(i[r].winRate=parseFloat((i[r].wins/i[r].totalGames*100).toFixed(2))),Object.keys(i[r].players).forEach(c=>{const n=i[r].players[c];n.games>0&&(n.winRate=parseFloat((n.wins/n.games*100).toFixed(2)))})})}function O(i,r){Object.keys(i).forEach(c=>{Object.keys(i[c].camps).forEach(n=>{const p=i[c].camps[n];p.games>0&&(p.winRate=parseFloat((p.wins/p.games*100).toFixed(2)),r[n]&&r[n].winRate!==void 0?p.performance=parseFloat((p.winRate-r[n].winRate).toFixed(2)):p.performance=0)})})}function Me(i,r,c){const n=[];return Object.keys(i).forEach(m=>{const f=i[m],t=[];Object.keys(f.camps).forEach(l=>{const s=f.camps[l];if(s.games>=c){const o=r[l]&&r[l].winRate!==void 0?r[l].winRate.toFixed(2):"0.00";t.push({camp:l,games:s.games,wins:s.wins,winRate:s.winRate.toFixed(2),campAvgWinRate:o,performance:s.performance.toFixed(2)})}}),t.sort((l,s)=>parseFloat(s.performance)-parseFloat(l.performance)),t.length>0&&n.push({player:f.displayName,totalGames:f.totalGames,campPerformance:t})}),n.sort((m,f)=>f.totalGames-m.totalGames),{campAverages:Object.keys(r).map(m=>({camp:m,totalGames:r[m].totalGames,wins:r[m].wins,winRate:r[m].winRate.toFixed(2)})),playerPerformanceArray:n}}function De(i){if(i.length===0)return null;const r=se(i,!1,!1),c=se(i,!0,!0),n=We(i),p=ae(i,r,!1,!1),m=ae(i,c,!0,!0),f=Ge(i,n);K(r),K(c),K(n),O(p,r),O(m,c),O(f,n);const t={...r},l={...p};c.Loup&&(t["Camp Loup"]=c.Loup,Object.keys(m).forEach(y=>{l[y]||(l[y]=m[y]),m[y].camps.Loup&&(l[y].camps["Camp Loup"]=m[y].camps.Loup)})),c.Villageois&&(t["Camp Villageois"]=c.Villageois,Object.keys(m).forEach(y=>{l[y]||(l[y]=m[y]),m[y].camps.Villageois&&(l[y].camps["Camp Villageois"]=m[y].camps.Villageois)})),n["R√¥les sp√©ciaux"]&&(t["R√¥les sp√©ciaux"]=n["R√¥les sp√©ciaux"],Object.keys(f).forEach(y=>{l[y]||(l[y]=f[y]),f[y].camps["R√¥les sp√©ciaux"]&&(l[y].camps["R√¥les sp√©ciaux"]=f[y].camps["R√¥les sp√©ciaux"])}));const s=3,{campAverages:o,playerPerformanceArray:R}=Me(l,t,s);return{campAverages:o,playerPerformance:R,minGamesRequired:s}}function ke(){const{data:i,isLoading:r,error:c}=ve(De);return{playerCampPerformance:i,isLoading:r,error:c}}function ue({infoId:i,title:r,children:c}){const{activeInfo:n,toggleInfo:p}=ye(),m=n===i;return e.jsxs("div",{className:"info-bubble-container",children:[e.jsx("button",{className:"info-bubble-trigger",onClick:()=>p(i),"aria-label":"Afficher les informations",title:"Informations sur ce graphique",children:"‚ÑπÔ∏è"}),m&&e.jsxs("div",{className:"info-bubble-content",children:[e.jsxs("div",{className:"info-bubble-header",children:[e.jsx("h4",{children:r}),e.jsx("button",{className:"info-bubble-close",onClick:()=>p(i),"aria-label":"Fermer",children:"‚úï"})]}),e.jsx("div",{className:"info-bubble-body",children:c})]})]})}function $e({viewMode:i,selectedCamp:r,minGames:c,chartData:n,highlightedPlayer:p,lycansColorScheme:m,playersColor:f,onBarClick:t}){return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("h3",{style:{margin:0},children:i==="performance"?r==="Tous les camps"?"Meilleures performances - Tous les camps":`Meilleurs joueurs en ${r}`:r==="Tous les camps"?"Plus grand % de parties - Tous les camps":`Plus grand % de parties en ${r}`}),e.jsx(ue,{infoId:`bar-chart-${i}-${r}`,title:"√Ä propos de ce graphique",children:i==="performance"?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:"Filtres actuels :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Affichage :"})," Meilleures Performances"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Camp/R√¥le :"})," ",r]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Minimum de parties :"})," ",c]})]}),(r==="Tous les camps"||r==="Camp Villageois"||r==="Camp Loup"||r==="R√¥les sp√©ciaux")&&e.jsxs("p",{style:{background:"var(--bg-primary)",padding:"0.75rem",borderRadius:"6px",marginTop:"0.5rem"},children:[e.jsxs("strong",{children:["‚ÑπÔ∏è ",r," :"]})," ",r==="Tous les camps"&&"Affiche le meilleur r√¥le de chaque joueur (toutes cat√©gories confondues).",r==="Camp Villageois"&&"Inclut Villageois, Chasseur, Alchimiste, Protecteur et Disciple.",r==="Camp Loup"&&"Inclut Loup, Tra√Ætre et Louveteau.",r==="R√¥les sp√©ciaux"&&"Inclut les r√¥les solo comme Amoureux, Idiot du Village, Agent, etc."]}),e.jsx("p",{children:e.jsx("strong",{children:"Comment √ßa marche :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Taux personnel"})," : Le pourcentage de victoires du joueur dans ce camp"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Moyenne du camp"})," : Le taux de victoire moyen de tous les joueurs dans ce camp"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Performance"})," : La diff√©rence entre le taux personnel et la moyenne du camp"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Interpr√©tation :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Performance positive (+)"})," : Le joueur performe mieux que la moyenne"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Performance n√©gative (-)"})," : Le joueur performe moins bien que la moyenne"]})]}),e.jsxs("p",{children:[e.jsx("em",{children:"Exemple :"})," Si un joueur a 60% de victoires en Camp Villageois et que la moyenne est 45%, sa performance est de ",e.jsx("code",{children:"+15%"}),"."]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:"Filtres actuels :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Affichage :"})," Pourcentage de Parties Jou√©es"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Camp/R√¥le :"})," ",r]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Minimum de parties :"})," ",c]})]}),(r==="Tous les camps"||r==="Camp Villageois"||r==="Camp Loup"||r==="R√¥les sp√©ciaux")&&e.jsxs("p",{style:{background:"var(--bg-primary)",padding:"0.75rem",borderRadius:"6px",marginTop:"0.5rem"},children:[e.jsxs("strong",{children:["‚ÑπÔ∏è ",r," :"]})," ",r==="Tous les camps"&&"Affiche le r√¥le le plus jou√© par chaque joueur (toutes cat√©gories confondues).",r==="Camp Villageois"&&"Inclut Villageois, Chasseur, Alchimiste, Protecteur et Disciple.",r==="Camp Loup"&&"Inclut Loup, Tra√Ætre et Louveteau.",r==="R√¥les sp√©ciaux"&&"Inclut les r√¥les solo comme Amoureux, Idiot du Village, Agent, etc."]}),e.jsx("p",{children:e.jsx("strong",{children:"Comment √ßa marche :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Parties dans ce r√¥le"})," : Nombre de parties jou√©es avec ce r√¥le/camp"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Total parties"})," : Nombre total de parties jou√©es par le joueur"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Pourcentage"})," : (Parties dans ce r√¥le / Total parties) √ó 100"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Interpr√©tation :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Un ",e.jsx("strong",{children:"pourcentage √©lev√©"})," indique que le joueur a souvent eu ce r√¥le"]}),e.jsxs("li",{children:["Permet d'identifier les ",e.jsx("strong",{children:"r√¥les r√©currents"})," pour chaque joueur"]}),e.jsxs("li",{children:["Utile pour comprendre l'",e.jsx("strong",{children:"exp√©rience de jeu"})," de chacun"]})]})]})})]}),e.jsx(te,{title:i==="performance"?r==="Tous les camps"?"Meilleures Performances - Tous les camps":`Meilleurs Joueurs - ${r}`:r==="Tous les camps"?"Pourcentage de Parties Jou√©es - Tous les camps":`Pourcentage de Parties Jou√©es - ${r}`,children:e.jsx("div",{style:{height:500},children:e.jsx(me,{width:"100%",height:"100%",children:e.jsxs(Fe,{data:n,margin:{top:20,right:30,left:20,bottom:0},children:[e.jsx(oe,{strokeDasharray:"3 3"}),e.jsx(le,{dataKey:r==="Tous les camps"?"uniqueKey":"player",angle:-45,textAnchor:"end",height:110,interval:0,fontSize:15,tick:({x:l,y:s,payload:o,index:R})=>{const y=n[R],V=y?.player||o.value,q=p===(y?.player||o.value);return e.jsx("text",{x:l,y:s,dy:16,textAnchor:"end",fill:q?"var(--accent-primary)":"var(--text-secondary)",fontSize:q?14:13,fontWeight:q?"bold":"italic",transform:`rotate(-45 ${l} ${s})`,children:V})}}),e.jsx(ce,{domain:["auto","auto"],label:{value:i==="performance"?"Performance vs moyenne (%)":"Pourcentage de parties jou√©es (%)",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(pe,{content:({active:l,payload:s})=>{if(l&&s&&s.length>0){const o=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r==="Tous les camps"?`${o.player} - ${o.camp}`:o.player})}),i==="performance"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Parties: ",o.games]}),e.jsxs("div",{children:["Victoires: ",o.wins]}),e.jsxs("div",{children:["Taux personnel: ",o.winRate,"%"]}),r!=="Tous les camps"&&e.jsxs("div",{children:["Moyenne camp: ",o.campAvgWinRate,"%"]}),e.jsxs("div",{children:["Performance: ",o.performance>0?"+":"",o.performance]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Parties dans ce r√¥le: ",o.games]}),e.jsxs("div",{children:["Total parties: ",o.totalGames]}),e.jsxs("div",{children:["Pourcentage: ",o.playPercentage?.toFixed(1),"%"]}),e.jsxs("div",{children:["Moyenne tous joueurs: ",o.campAvgPlayPercentage?.toFixed(1),"%"]}),e.jsxs("div",{children:["Taux de victoire: ",o.winRate,"%"]})]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(Ne,{dataKey:i==="performance"?"performanceNum":"playPercentage",style:{cursor:"pointer"},onClick:t,children:n.map((l,s)=>{const o=p===l.player,R=l.isHighlightedAddition;let y;return r==="Tous les camps"?y=m[l.camp]||`var(--chart-color-${s%6+1})`:y=f[l.player]||"var(--accent-primary)",e.jsx(Ae,{fill:y,stroke:o?"var(--accent-primary)":"transparent",strokeWidth:o?3:0,strokeDasharray:R?"5,5":"none",opacity:R?.8:1},`cell-${s}`)})})]})})})})]})}function qe({viewMode:i,selectedCamp:r,minGames:c,chartData:n,highlightedPlayer:p,lycansColorScheme:m,playersColor:f,onScatterClick:t}){return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("h3",{style:{margin:0},children:i==="performance"?r==="Tous les camps"?"Vue Partie/Performance - Tous les camps":`Vue Partie/Performance - ${r}`:r==="Tous les camps"?"Vue Pourcentage/Taux de victoire - Tous les camps":`Vue Pourcentage/Taux de victoire - ${r}`}),e.jsx(ue,{infoId:`scatter-chart-${i}-${r}`,title:"√Ä propos de ce graphique",children:i==="performance"?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:"Filtres actuels :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Affichage :"})," Vue Nuage de Points (Parties vs Performance)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Camp/R√¥le :"})," ",r]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Minimum de parties :"})," ",c]})]}),(r==="Tous les camps"||r==="Camp Villageois"||r==="Camp Loup"||r==="R√¥les sp√©ciaux")&&e.jsxs("p",{style:{background:"var(--bg-primary)",padding:"0.75rem",borderRadius:"6px",marginTop:"0.5rem"},children:[e.jsxs("strong",{children:["‚ÑπÔ∏è ",r," :"]})," ",r==="Tous les camps"&&"Affiche le meilleur r√¥le de chaque joueur (toutes cat√©gories confondues).",r==="Camp Villageois"&&"Inclut Villageois, Chasseur, Alchimiste, Protecteur et Disciple.",r==="Camp Loup"&&"Inclut Loup, Tra√Ætre et Louveteau.",r==="R√¥les sp√©ciaux"&&"Inclut les r√¥les solo comme Amoureux, Idiot du Village, Agent, etc."]}),e.jsx("p",{children:e.jsx("strong",{children:"Comment lire ce graphique :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Axe horizontal (X)"})," : Nombre de parties jou√©es"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Axe vertical (Y)"})," : Performance par rapport √† la moyenne du camp"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Chaque point"})," : Repr√©sente un joueur (initiale affich√©e)"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Interpr√©tation :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Points hauts"})," : Joueurs avec meilleure performance que la moyenne"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Points bas"})," : Joueurs avec performance inf√©rieure √† la moyenne"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Points √† droite"})," : Joueurs avec plus d'exp√©rience (plus de parties)"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:"Filtres actuels :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Affichage :"})," Vue Nuage de Points (Pourcentage vs Taux de victoire)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Camp/R√¥le :"})," ",r]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Minimum de parties :"})," ",c]})]}),(r==="Tous les camps"||r==="Camp Villageois"||r==="Camp Loup"||r==="R√¥les sp√©ciaux")&&e.jsxs("p",{style:{background:"var(--bg-primary)",padding:"0.75rem",borderRadius:"6px",marginTop:"0.5rem"},children:[e.jsxs("strong",{children:["‚ÑπÔ∏è ",r," :"]})," ",r==="Tous les camps"&&"Affiche le r√¥le le plus jou√© par chaque joueur (toutes cat√©gories confondues).",r==="Camp Villageois"&&"Inclut Villageois, Chasseur, Alchimiste, Protecteur et Disciple.",r==="Camp Loup"&&"Inclut Loup, Tra√Ætre et Louveteau.",r==="R√¥les sp√©ciaux"&&"Inclut les r√¥les solo comme Amoureux, Idiot du Village, Agent, etc."]}),e.jsx("p",{children:e.jsx("strong",{children:"Comment lire ce graphique :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Axe horizontal (X)"})," : ",r==="Tous les camps"?"Nombre de parties dans ce r√¥le":"Nombre de parties"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Axe vertical (Y)"})," : ",r==="Tous les camps"?"Pourcentage de parties jou√©es avec ce r√¥le":"Taux de victoire (%)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Chaque point"})," : Repr√©sente un joueur (initiale affich√©e)"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Interpr√©tation :"})}),e.jsxs("ul",{children:[r==="Tous les camps"?e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Points hauts"})," : Joueurs qui ont souvent ce r√¥le"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Points bas"})," : Joueurs qui ont rarement ce r√¥le"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Points hauts"})," : Joueurs avec taux de victoire √©lev√©"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Points bas"})," : Joueurs avec taux de victoire faible"]})]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Points √† droite"})," : Plus d'exp√©rience avec ce camp/r√¥le"]})]})]})})]}),e.jsx(te,{title:i==="performance"?r==="Tous les camps"?"Vue Partie/Performance - Tous les camps":`Vue Partie/Performance - ${r}`:r==="Tous les camps"?"Vue Pourcentage/Taux de victoire - Tous les camps":`Vue Pourcentage/Taux de victoire - ${r}`,children:e.jsx("div",{style:{height:500},children:e.jsx(me,{width:"100%",height:"100%",children:e.jsxs(Ve,{margin:{top:20,right:30,left:20,bottom:40},children:[e.jsx(oe,{strokeDasharray:"3 3"}),e.jsx(le,{type:"number",dataKey:"games",name:"Parties",label:{value:"Nombre de parties",position:"bottom"}}),e.jsx(ce,{type:"number",dataKey:i==="performance"?"performanceNum":r==="Tous les camps"?"playPercentage":"winRateNum",name:i==="performance"?"Performance":r==="Tous les camps"?"Pourcentage":"Taux de victoire",domain:["auto","auto"],label:{value:i==="performance"?"Performance vs moyenne (%)":r==="Tous les camps"?"Pourcentage de parties jou√©es (%)":"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(pe,{cursor:{strokeDasharray:"3 3"},content:({active:l,payload:s})=>{if(l&&s&&s.length>0){const o=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r==="Tous les camps"?`${o.player} - ${o.camp}`:o.player})}),i==="performance"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Parties: ",o.games]}),e.jsxs("div",{children:["Victoires: ",o.wins]}),e.jsxs("div",{children:["Taux personnel: ",o.winRate,"%"]}),r!=="Tous les camps"&&e.jsxs("div",{children:["Moyenne camp: ",o.campAvgWinRate,"%"]}),e.jsxs("div",{children:["Performance: ",o.performance>0?"+":"",o.performance]})]}):e.jsx(e.Fragment,{children:r==="Tous les camps"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Parties dans ce r√¥le: ",o.games]}),e.jsxs("div",{children:["Total parties: ",o.totalGames]}),e.jsxs("div",{children:["Pourcentage: ",o.playPercentage?.toFixed(1),"%"]}),e.jsxs("div",{children:["Moyenne tous joueurs: ",o.campAvgPlayPercentage?.toFixed(1),"%"]}),e.jsxs("div",{children:["Taux de victoire: ",o.winRate,"%"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Parties: ",o.games]}),e.jsxs("div",{children:["Taux de victoire: ",o.winRate,"%"]})]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(Le,{data:n,onClick:t,shape:l=>{const s=p===l.payload?.player,o=l.payload?.isHighlightedAddition;return e.jsxs("g",{style:{cursor:"pointer"},children:[e.jsx("circle",{cx:l.cx,cy:l.cy,r:s?15:12,fill:r==="Tous les camps"?m[l.payload?.camp]||"var(--accent-primary)":f[l.payload?.player]||"var(--accent-primary)",stroke:s?"var(--accent-primary)":"#222",strokeWidth:s?3:1,strokeDasharray:o?"5,5":"none",opacity:o?.8:1}),e.jsx("text",{x:l.cx,y:l.cy,textAnchor:"middle",dominantBaseline:"middle",fill:"#fff",fontSize:s?"12":"10",fontWeight:"bold",pointerEvents:"none",children:l.payload?.player?.charAt(0).toUpperCase()})]})}})]})})})})]})}function Xe(){const{navigateToGameDetails:i,navigationState:r,updateNavigationState:c}=Pe(),{settings:n}=je(),p=Te(),{joueursData:m}=be(),f=Ce(m),[t,l]=M.useState(r.campPerformanceState?.viewMode||"performance"),[s,o]=M.useState(r.campPerformanceState?.selectedCampPerformanceCamp||"Camp Villageois"),[R,y]=M.useState(r.campPerformanceState?.selectedCampPerformanceMinGames||50),{playerCampPerformance:V,isLoading:q,error:Q}=ke();M.useEffect(()=>{r.campPerformanceState||c({campPerformanceState:{viewMode:t,selectedCampPerformanceCamp:s,selectedCampPerformanceMinGames:R}})},[t,s,R,r.campPerformanceState,c]);const de=M.useMemo(()=>{if(!V?.campAverages)return["Tous les camps"];const a=V.campAverages.map(W=>W.camp),u=["Tous les camps"];a.includes("Camp Villageois")&&u.push("Camp Villageois"),a.includes("Villageois")&&u.push("Villageois"),a.includes("Chasseur")&&u.push("Chasseur"),a.includes("Alchimiste")&&u.push("Alchimiste"),a.includes("Protecteur")&&u.push("Protecteur"),a.includes("Disciple")&&u.push("Disciple"),a.includes("Camp Loup")&&u.push("Camp Loup"),a.includes("Loup")&&u.push("Loup"),a.includes("Tra√Ætre")&&u.push("Tra√Ætre"),a.includes("Louveteau")&&u.push("Louveteau"),a.includes("R√¥les sp√©ciaux")&&u.push("R√¥les sp√©ciaux");const j=["Camp Villageois","Camp Loup","R√¥les sp√©ciaux"],L=[...["Camp Villageois","Villageois","Chasseur","Alchimiste","Protecteur","Disciple","Camp Loup","Loup","Tra√Ætre","Louveteau"],...j],D=a.filter(W=>!L.includes(W)).sort();return[...u,...D]},[V]),{campPlayPercentageData:he,topPlayPercentageData:ge,totalPlayPercentagePlayers:z}=M.useMemo(()=>{if(!V?.playerPerformance||t!=="playPercentage")return{campPlayPercentageData:[],topPlayPercentageData:[],totalPlayPercentagePlayers:0};const{playerPerformance:a}=V,u=new Map,j=new Map;for(const g of a){const h=g.campPerformance.reduce((d,N)=>d+N.games,0);j.set(g.player,h);for(const d of g.campPerformance)if(d.games>=R){const N=u.get(d.camp)||{totalGames:0,totalPlayersWithCamp:0};N.totalGames+=d.games,N.totalPlayersWithCamp+=1,u.set(d.camp,N)}}const C=new Map;for(const[g,h]of u.entries()){const d=h.totalGames/h.totalPlayersWithCamp,N=h.totalPlayersWithCamp;let b=0;for(const x of a)x.campPerformance.find($=>$.camp===g&&$.games>=R)&&(b+=j.get(x.player)||0);const F=b/N,G=d/F*100;C.set(g,G)}const L=[],D=[],W=new Map;for(const g of a){const h=j.get(g.player)||0;for(const d of g.campPerformance)if(d.games>=R){const N=C.get(d.camp)||0,b=d.games/h*100,F=`${g.player}-${d.camp}`,G={player:g.player,camp:d.camp,games:d.games,wins:d.wins,winRate:d.winRate,performance:d.performance,winRateNum:parseFloat(d.winRate),performanceNum:parseFloat(d.performance),campAvgWinRateNum:parseFloat(d.campAvgWinRate),totalGames:h,playPercentage:b,campAvgPlayPercentage:N,isHighlightedAddition:!1,uniqueKey:F,playerCamp:F},x=W.get(g.player);(!x||G.playPercentage>x.playPercentage)&&W.set(g.player,G),s!=="Tous les camps"&&d.camp===s&&L.push(G)}}D.push(...W.values());const S=(g,h,d=!1)=>{if(!n.highlightedPlayer||g.some(x=>x.player===n.highlightedPlayer&&(!h||x.camp===h)))return g;const b=a.find(x=>x.player===n.highlightedPlayer);if(!b)return g;const F=j.get(n.highlightedPlayer)||b.campPerformance.reduce((x,T)=>x+T.games,0);if(d){let x=null;for(const T of b.campPerformance)if(T.games>=1){const $=T.games/F*100,H=C.get(T.camp)||0,ee=`${b.player}-${T.camp}`,re={player:b.player,camp:T.camp,games:T.games,wins:T.wins,winRate:T.winRate,performance:T.performance,winRateNum:parseFloat(T.winRate),performanceNum:parseFloat(T.performance),campAvgWinRateNum:parseFloat(T.campAvgWinRate),totalGames:F,playPercentage:$,campAvgPlayPercentage:H,isHighlightedAddition:!0,uniqueKey:ee,playerCamp:ee};(!x||re.playPercentage>x.playPercentage)&&(x=re)}return x?[...g,x]:g}const G=[];for(const x of b.campPerformance)if((!h||x.camp===h)&&x.games>=1){const T=x.games/F*100,$=C.get(x.camp)||0,H=`${b.player}-${x.camp}`;G.push({player:b.player,camp:x.camp,games:x.games,wins:x.wins,winRate:x.winRate,performance:x.performance,winRateNum:parseFloat(x.winRate),performanceNum:parseFloat(x.performance),campAvgWinRateNum:parseFloat(x.campAvgWinRate),totalGames:F,playPercentage:T,campAvgPlayPercentage:$,isHighlightedAddition:!0,uniqueKey:H,playerCamp:H})}return[...g,...G]},B=s!=="Tous les camps"?S(L,s,!1):[],I=S(D,void 0,!0),E=B.sort((g,h)=>h.playPercentage-g.playPercentage),v=I.sort((g,h)=>h.playPercentage-g.playPercentage),P=(g,h)=>{const d=g.slice(0,h);if(d.some(F=>F.player===n.highlightedPlayer)||!n.highlightedPlayer)return d;const b=g.find(F=>F.player===n.highlightedPlayer);if(b){const F={...b,isHighlightedAddition:!0};return[...d,F]}return d};let w=0;s==="Tous les camps"?w=W.size:w=L.length;const k=P(E,15),A=P(v,15);return{campPlayPercentageData:k,topPlayPercentageData:A,totalPlayPercentagePlayers:w}},[V,s,R,n.highlightedPlayer,t]),{campPlayerData:fe,topPerformersData:xe,totalMatchingPlayers:J}=M.useMemo(()=>{if(!V?.playerPerformance||t!=="performance")return{campPlayerData:[],topPerformersData:[],totalMatchingPlayers:0};const{playerPerformance:a}=V,u=[],j=[],C=new Map;for(const v of a)for(const P of v.campPerformance)if(P.games>=R){const w=`${v.player}-${P.camp}`,k={player:v.player,camp:P.camp,games:P.games,wins:P.wins,winRate:P.winRate,performance:P.performance,winRateNum:parseFloat(P.winRate),performanceNum:parseFloat(P.performance),campAvgWinRateNum:parseFloat(P.campAvgWinRate),isHighlightedAddition:!1,uniqueKey:w,playerCamp:w},A=C.get(v.player);(!A||k.performanceNum>A.performanceNum)&&C.set(v.player,k),s!=="Tous les camps"&&P.camp===s&&u.push({player:v.player,...P,winRateNum:parseFloat(P.winRate),performanceNum:parseFloat(P.performance),campAvgWinRateNum:parseFloat(P.campAvgWinRate),isHighlightedAddition:!1,uniqueKey:w,playerCamp:w})}j.push(...C.values());const L=(v,P,w=!1)=>{if(!n.highlightedPlayer||v.some(h=>h.player===n.highlightedPlayer&&(!P||h.camp===P)))return v;const A=a.find(h=>h.player===n.highlightedPlayer);if(!A)return v;if(w){let h=null;for(const d of A.campPerformance)if(d.games>=1){const N=`${A.player}-${d.camp}`,b={player:A.player,camp:d.camp,games:d.games,wins:d.wins,winRate:d.winRate,performance:d.performance,winRateNum:parseFloat(d.winRate),performanceNum:parseFloat(d.performance),campAvgWinRateNum:parseFloat(d.campAvgWinRate),isHighlightedAddition:!0,uniqueKey:N,playerCamp:N};(!h||b.performanceNum>h.performanceNum)&&(h=b)}return h?[...v,h]:v}const g=[];for(const h of A.campPerformance)if((!P||h.camp===P)&&h.games>=1){const d=`${A.player}-${h.camp}`;g.push({player:A.player,camp:h.camp,games:h.games,wins:h.wins,winRate:h.winRate,performance:h.performance,winRateNum:parseFloat(h.winRate),performanceNum:parseFloat(h.performance),campAvgWinRateNum:parseFloat(h.campAvgWinRate),isHighlightedAddition:!0,uniqueKey:d,playerCamp:d})}return[...v,...g]},D=s!=="Tous les camps"?L(u,s,!1):[],W=L(j,void 0,!0),S=D.sort((v,P)=>P.performanceNum-v.performanceNum),B=W.sort((v,P)=>P.performanceNum-v.performanceNum),I=(v,P)=>{const w=v.slice(0,P);if(w.some(g=>g.player===n.highlightedPlayer)||!n.highlightedPlayer)return w;const A=v.find(g=>g.player===n.highlightedPlayer);if(A){const g={...A,isHighlightedAddition:!0};return[...w,g]}return w};let E=0;return s==="Tous les camps"?E=C.size:E=u.length,{campPlayerData:I(S,15),topPerformersData:I(B,15),totalMatchingPlayers:E}},[V,s,R,n.highlightedPlayer,t]),Z=a=>{a&&a.player&&(s!=="Tous les camps"?i(s==="Camp Loup"?{selectedPlayer:a.player,campFilter:{selectedCamp:"Camp Loup",campFilterMode:"wins-only",excludeWolfSubRoles:!1},fromComponent:`Performance des Joueurs - ${s}`}:s==="Camp Villageois"?{selectedPlayer:a.player,campFilter:{selectedCamp:"Villageois",campFilterMode:"wins-only",excludeVillagers:!1},fromComponent:`Performance des Joueurs - ${s}`}:s==="R√¥les sp√©ciaux"?{selectedPlayer:a.player,fromComponent:`Performance des Joueurs - ${s}`}:{selectedPlayer:a.player,campFilter:{selectedCamp:s,campFilterMode:"wins-only",excludeWolfSubRoles:s==="Tra√Ætre"||s==="Louveteau",excludeVillagers:s==="Chasseur"||s==="Alchimiste"||s==="Protecteur"||s==="Disciple"},fromComponent:`Performance des Joueurs - ${s}`}):a.camp==="Camp Loup"?i({selectedPlayer:a.player,campFilter:{selectedCamp:"Loup",campFilterMode:"wins-only",excludeWolfSubRoles:!1},fromComponent:"Performance des Joueurs - Tous les camps"}):a.camp==="Camp Villageois"?i({selectedPlayer:a.player,campFilter:{selectedCamp:"Villageois",campFilterMode:"wins-only",excludeWolfSubRoles:!0},fromComponent:"Performance des Joueurs - Tous les camps"}):a.camp==="R√¥les sp√©ciaux"?i({selectedPlayer:a.player,fromComponent:"Performance des Joueurs - Tous les camps"}):i({selectedPlayer:a.player,campFilter:{selectedCamp:a.camp,campFilterMode:"wins-only",excludeWolfSubRoles:a.camp==="Tra√Ætre"||a.camp==="Louveteau",excludeVillagers:a.camp==="Chasseur"||a.camp==="Alchimiste"||a.camp==="Protecteur"||a.camp==="Disciple"},fromComponent:"Performance des Joueurs - Tous les camps"}))};if(q)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de performance par camp..."});if(Q)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",Q]});if(!V)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de performance par camp disponible"});const _=t==="performance"?s==="Tous les camps"?xe:fe:s==="Tous les camps"?ge:he;return e.jsxs("div",{className:"lycans-player-camp-performance",children:[e.jsx("h2",{children:t==="performance"?"Meilleures Performances par Camp":"Pourcentage de Parties Jou√©es par R√¥le"}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"view-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Affichage:"}),e.jsxs("select",{id:"view-mode-select",value:t,onChange:a=>{const u=a.target.value;l(u),c({campPerformanceState:{viewMode:u,selectedCampPerformanceCamp:s,selectedCampPerformanceMinGames:R}})},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"200px"},children:[e.jsx("option",{value:"performance",children:"üèÜ Meilleures performances"}),e.jsx("option",{value:"playPercentage",children:"üìä % parties jou√©es"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsx("select",{id:"camp-select",value:s,onChange:a=>{const u=a.target.value;o(u),c({campPerformanceState:{viewMode:t,selectedCampPerformanceCamp:u,selectedCampPerformanceMinGames:R}})},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"200px"},children:de.map(a=>{let u=a,j=!1,C=!1,L=!1;return a==="Tous les camps"?(u="üìä Tous les camps",L=!0):a==="Camp Villageois"?(u="   üèòÔ∏è Camp Villageois",j=!0,C=!0):a==="Villageois"?(u="   Villageois",j=!0):a==="Chasseur"?(u="     Chasseur",j=!0):a==="Alchimiste"?(u="     Alchimiste",j=!0):a==="Protecteur"?(u="     Protecteur",j=!0):a==="Disciple"?(u="     Disciple",j=!0):a==="Camp Loup"?(u="   üê∫ Camp Loup",j=!0,C=!0):a==="Loup"?(u="     Loup",j=!0):a==="Tra√Ætre"?(u="     Tra√Ætre",j=!0):a==="Louveteau"?(u="     Louveteau",j=!0):a==="R√¥les sp√©ciaux"?(u="   ‚≠ê R√¥les sp√©ciaux",j=!0,C=!0):(u=`     ${a}`,j=!0),e.jsx("option",{value:a,style:{fontFamily:"monospace",fontSize:j?"0.85rem":"0.9rem",fontWeight:C?"bold":"normal",color:C?"var(--accent-primary)":L?"var(--accent-secondary)":"inherit"},children:u},a)})})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"min-games-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select",value:R,onChange:a=>{const u=Number(a.target.value);y(u),c({campPerformanceState:{viewMode:t,selectedCampPerformanceCamp:s,selectedCampPerformanceMinGames:u}})},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",width:"90px"},children:we.map(a=>e.jsx("option",{value:a,children:a},a))})]})]}),e.jsx("div",{style:{textAlign:"center",marginBottom:"1.5rem",padding:"0.75rem",background:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.95rem",fontWeight:"500"},children:[t==="performance"?J:z," joueur",(t==="performance"?J:z)!==1?"s":""," ",(t==="performance"?J:z)!==1?"correspondent":"correspond"," aux crit√®res"]})}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsx($e,{viewMode:t,selectedCamp:s,minGames:R,chartData:_,highlightedPlayer:n.highlightedPlayer,lycansColorScheme:p,playersColor:f,onBarClick:Z}),e.jsx(qe,{viewMode:t,selectedCamp:s,minGames:R,chartData:_,highlightedPlayer:n.highlightedPlayer,lycansColorScheme:p,playersColor:f,onScatterClick:Z})]})]})}export{Xe as PlayerCampChart};
