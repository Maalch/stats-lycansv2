import{a as ue,r as D,g as te,f as Me,u as ie,j as e,d as Se,e as Fe,q as ze}from"./index-DtM853-E.js";import{u as pe}from"./useJoueursData-DLcxUTt-.js";import{u as fe}from"./baseStatsHook-Dbg9yhWE.js";import{g as $e}from"./gameUtils-DYpUb-C5.js";import{a as Re,g as oe,c as ke,b as Ie}from"./datasyncExport-CjB7UYqV.js";import{u as ye,g as We,b as ce,l as Le,C as ge,f as ve}from"./api-D_4YJ4Uq.js";import{f as se,d as qe}from"./durationFormatters-C9UyWcKX.js";import{F as U,C as Y,X as J,Y as Q,a as Z}from"./FullscreenChart-Cja2UcBF.js";import{R as H,T as _}from"./CategoricalChart-CRg0SFK9.js";import{L as Ee,a as Ve}from"./LineChart-DN8K9WmU.js";import{B as ee,a as X}from"./BarChart-IGlhZ6l0.js";import{P as Pe,a as Te}from"./PieChart-BajzqSEq.js";import{g as le}from"./deathTypes-gHH1w6_X.js";import{i as je,g as be,V as Ge,a as Be}from"./roleUtils-CLjkiQQc.js";import{S as Oe,R as ae,e as Ke,f as He,h as de,a as _e,b as Ue,d as Ye}from"./deathLocationUtils-BrD3Ulrs.js";import{L as Je}from"./Legend-Cpsi91HL.js";import{a as Qe,u as Xe}from"./useClips-LNQuZ0pe.js";import{C as Ze,f as Ce,a as et}from"./ClipViewer-6hZ3inic.js";import"./ActivePoints-D3ujltSF.js";import"./PolarChart-3A1qCJUX.js";function tt(r){const{settings:o}=ue(),{joueursData:C}=pe(),[p,R]=D.useState(null),[n,y]=D.useState(!1),[f,i]=D.useState(null);D.useEffect(()=>{let l=!0;return(async()=>{try{y(!0),i(null);const c=o.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",s=await fetch(c);if(!s.ok)throw new Error(`Failed to load achievements: ${s.status} ${s.statusText}`);const d=await s.json();l&&R(d)}catch(c){l&&i(c instanceof Error?c.message:"Failed to load achievements")}finally{l&&y(!1)}})(),()=>{l=!1}},[o.dataSource]);const h=(()=>{if(!r||!p)return null;const a=C?.Players?.find(c=>c.Joueur===r)?.SteamID;return a&&p.achievements[a]||null})();return D.useEffect(()=>{r&&p&&C&&C.Players?.find(c=>c.Joueur===r)?.SteamID},[r,p,C,o.dataSource]),{data:h,isLoading:n,error:f,metadata:{generatedAt:p?.generatedAt||null,totalPlayers:p?.totalPlayers||0,totalGames:p?.totalGames||0,totalModdedGames:p?.totalModdedGames||0}}}function rt(r,o,C){if(!r||r.trim()===""||o.length===0)return null;const p=[];let R=r;o.forEach(a=>{const c=a.PlayerStats.find(s=>te(s)===r||s.Username.toLowerCase()===r.toLowerCase());if(c){R=c.Username;const s=c.MainRoleInitial==="Louveteau"?c.MainRoleInitial:Re(c.MainRoleInitial,c.MainRoleChanges||[]),d=oe(s);if(C&&C!=="Tous les camps"&&d!==C)return;const S=$e(a),u=c.Victorious,v=Me(new Date(a.StartDate)),T=ke(a.StartDate,a.EndDate)||0;p.push({gameId:a.Id,date:v,camp:d,won:u,winnerCamp:S,playersInGame:a.PlayerStats.length,mapName:a.MapName,duration:T})}}),p.sort((a,c)=>{const s=d=>{const S=d.split("/");return S.length===3?new Date(parseInt(S[2]),parseInt(S[1])-1,parseInt(S[0])):new Date(d)};return s(c.date).getTime()-s(a.date).getTime()});const n=p.length,y=p.filter(a=>a.won).length,f=n>0?(y/n*100).toFixed(2):"0.00",i={};p.forEach(a=>{i[a.camp]||(i[a.camp]={appearances:0,wins:0,winRate:"0.00"}),i[a.camp].appearances++,a.won&&i[a.camp].wins++}),Object.keys(i).forEach(a=>{const c=i[a];c.winRate=c.appearances>0?(c.wins/c.appearances*100).toFixed(2):"0.00"});const h={};p.forEach(a=>{h[a.mapName]||(h[a.mapName]={appearances:0,wins:0,winRate:"0.00"}),h[a.mapName].appearances++,a.won&&h[a.mapName].wins++}),Object.keys(h).forEach(a=>{const c=h[a];c.winRate=c.appearances>0?(c.wins/c.appearances*100).toFixed(2):"0.00"});const l=p.reduce((a,c)=>a+c.duration,0);return{playerName:R,totalGames:n,totalWins:y,winRate:f,totalPlayTime:l,games:p,campStats:i,mapStats:h}}function me(r,o){const{data:C,isLoading:p,error:R}=fe(n=>r?rt(r,n,o):null);return{data:C,isLoading:p,error:R}}function st(r){const{settings:o}=ue(),[C,p]=D.useState(null),[R,n]=D.useState(null),[y,f]=D.useState(!0),[i,h]=D.useState(null);return D.useEffect(()=>{(async()=>{f(!0),h(null);try{const a=o.dataSource==="discord"?"/data/discord/playerTitles.json":"/data/playerTitles.json",c=await fetch(a);if(!c.ok){if(c.status===404)p(null),n(null),h("Les titres n'ont pas encore Ã©tÃ© gÃ©nÃ©rÃ©s. Ils seront disponibles aprÃ¨s la prochaine synchronisation hebdomadaire.");else throw new Error(`HTTP error! status: ${c.status}`);return}const s=await c.json();if(p(s),r&&s.players){const d=Object.entries(s.players).find(([S,u])=>u.playerName===r);n(d?d[1]:null)}else n(null)}catch(a){console.error("Error loading player titles:",a),h(a instanceof Error?a.message:"Erreur inconnue"),p(null),n(null)}finally{f(!1)}})()},[o.dataSource,r]),{data:C,playerData:R,isLoading:y,error:i}}function at({achievements:r,title:o,emptyMessage:C,achievementType:p="all"}){const{navigateToTab:R,updateNavigationState:n,clearNavigation:y}=ie(),{settings:f,updateSettings:i}=ue(),{joueursData:h}=pe(),l=ye(h),a=(t,P)=>{if(P.stopPropagation(),!t.redirectTo)return;y();const I=f.highlightedPlayer;if(i(p==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:I,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:I,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const b=f.highlightedPlayer||"",g=c(t.description,b);g&&n({playerComparisonState:{selectedPlayer1:b,selectedPlayer2:g,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const b=t.description.toLowerCase().includes("loup");n({selectedPairingTab:b?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const b=t.description.match(/(Villageois|Loups|Autres)/i);b&&n({deathStatsSelectedCamp:b[1]});let g=10;const m=t.description.match(/min\.\s*(\d+)/);m&&(g=parseInt(m[1],10));let w="totalKills",x="killers";const k=t.redirectTo.chartSection;k&&(k==="killers-total"?(w="totalKills",x="killers"):k==="killers-average"?(w="averageKills",x="killers"):k==="deaths-total"?(w="totalDeaths",x="deaths"):k==="survivors-average"?(w="survivalRate",x="deaths"):(k==="hunters-good"||k==="hunters-bad")&&(x="hunter",w="averageKills")),n({deathStatisticsState:{selectedCamp:b?.[1]||"Tous les camps",minGamesForAverage:g,selectedView:x,focusChart:w}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const b=t.redirectTo.mapFilter||"all";let g=10;const m=t.description.match(/min\.\s*(\d+)/);m&&(g=parseInt(m[1])),i(p==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:b,playerFilter:{mode:"none",players:[]},highlightedPlayer:I,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:b,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:b,playerFilter:{mode:"none",players:[]},highlightedPlayer:I,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:b,playerFilter:{mode:"none",players:[]}}}),n({playersGeneralState:{minGamesForWinRate:g,winRateOrder:"best",focusChart:"winRate"}}),R("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&n({selectedPlayerName:f.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let b="wins";const g=t.title.toLowerCase(),m=t.description.toLowerCase();g.includes("dÃ©faite")||m.includes("dÃ©faite")?b="losses":g.includes("loup")||m.includes("loup")?b="loup":g.includes("villageois")||m.includes("villageois")?b="villageois":(g.includes("victoire")||m.includes("victoire"))&&(b="wins"),n({selectedSeriesType:b})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let b=10;const g=t.description.match(/min\.\s*(\d+)/);g&&(b=parseInt(g[1],10));let m="winRate",w="best";const x=t.title.toLowerCase(),k=t.description.toLowerCase();x.includes("participation")||k.includes("participation")?m="participation":(x.includes("taux de victoire")||k.includes("taux de victoire"))&&(m="winRate",(x.includes("moins bon")||x.includes("mauvais")||k.includes("moins bon")||k.includes("mauvais"))&&(w="worst")),n({playersGeneralState:{minGamesForWinRate:b,winRateOrder:w,focusChart:m}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const b=t.redirectTo.chartSection;let g="Villageois",m=1;b&&(b==="camp-loup"?g="Loup":b==="camp-villageois"?g="Villageois":b==="camp-idiot"?g="Idiot du Village":b==="camp-amoureux"?g="Amoureux":(b==="solo-roles"||b==="hall-of-fame")&&(g="Villageois"));const w=t.description.match(/min\.\s*(\d+)/);w&&(m=parseInt(w[1],10)),b==="solo-roles"?g="RÃ´les spÃ©ciaux":b==="hall-of-fame"&&(g="Tous les camps"),n({campPerformanceState:{selectedCampPerformanceCamp:g,selectedCampPerformanceMinGames:m,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const b=t.title.toLowerCase();let g="overview",m="behavior";b.includes("agressivitÃ©")?(g="overview",m="behavior"):b.includes("taux de vote")?(g="behavior",m="voteRate"):b.includes("prÃ©cision")&&(g="overview",m="accuracy"),n({votingStatsState:{selectedCategory:g,selectedView:m}})}if(t.category==="loot"&&t.redirectTo.subTab==="lootStats"){const b=t.redirectTo,g=b.minGames||5,m=b.view||"normalized";n({lootStatsState:{minGames:g,campFilter:"all",view:m}})}R(t.redirectTo.tab,t.redirectTo.subTab)},c=(t,P)=>{const I=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const b of I){const g=t.match(b);if(g&&g[1]){const m=g[1].trim();if(m!==P)return m}}return null},s=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const b=t.description.match(/min\.\s*(\d+)/),g=b?parseInt(b[1],10):10,m=t.title.toLowerCase(),w=p==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return m.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${g} parties)${w}`:m.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${w}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${w}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const b=t.redirectTo.mapFilter,g=b==="village"?"Village":b==="chateau"?"ChÃ¢teau":"map",m=p==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${g}${m}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${c(t.description,f.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const b=t.description.match(/(Villageois|Loups|Autres)/i),g=t.description.match(/min\.\s*(\d+)/),m=g?parseInt(g[1],10):10,w=b?.[1]||"Tous les camps",x=t.redirectTo.chartSection;let k="kills et morts";return x==="killers-total"?k="total des kills":x==="killers-average"?k=`moyenne des kills (min. ${m} parties)`:x==="deaths-total"?k="total des morts":x==="survivors-average"&&(k=`taux de survie (min. ${m} parties)`),`Cliquez pour voir les statistiques de ${k} ${w!=="Tous les camps"?`en ${w}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const b=t.title.toLowerCase(),g=t.description.toLowerCase();return b.includes("dÃ©faite")||g.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":b.includes("loup")||g.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":b.includes("villageois")||g.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":b.includes("victoire")||g.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const b=t.redirectTo.chartSection,g=p==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return b==="camp-loup"?`Cliquez pour voir les performances camp Loup${g}`:b==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${g}`:b==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${g}`:b==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${g}`:b==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${g}`:b==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${g}`:`Cliquez pour voir les performances par camp${g}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const b=t.description.match(/min\.\s*(\d+)/),g=b?parseInt(b[1],10):25,m=p==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",w=t.title.toLowerCase();return w.includes("agressivitÃ©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${g} meetings)${m}`:w.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${g} meetings)${m}`:w.includes("prÃ©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${m}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${m}`}break;case"loot":if(t.redirectTo.subTab==="lootStats"){const b=t.description.match(/min\.\s*(\d+)/),g=b?parseInt(b[1],10):25,m=p==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de rÃ©colte (min. ${g} parties)${m}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(p==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},d=t=>l[t]||We(t),S=t=>{const P=[/avec ([^:]+?):/,/contre ([^:]+?):/];let I=t;return P.forEach(b=>{const g=t.match(b);if(g&&g[1]){const m=g[1].trim(),x=`<span class="player-name-highlight" style="color: ${d(m)};">${m}</span>`;I=I.replace(m,x)}}),I};if(r.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:o}),e.jsx("p",{children:C||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const u=t=>t===1?"ðŸ¥‡":t===2?"ðŸ¥ˆ":t===3?"ðŸ¥‰":"",v=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",T=(t,P)=>{if(!t||t<=3||!P)return;const I=t-3,b=P-3;return b<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(I-1)/(b-1))}, 70%, 50%)`},M=(t,P)=>{if(!t||!P)return;if(P<=1)return"hsl(0, 70%, 50%)";const I=(t-1)/(P-1),b=I*15,g=50-I*15;return`hsl(${b}, 70%, ${g}%)`},$=t=>{if(!t)return;const P=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(P){const[,I,b]=P;return`hsl(${I}, ${b}%, 40%)`}return t},z=r.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,P)=>(t.rank??999)-(P.rank??999)),A=r.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,P)=>(t.rank??999)-(P.rank??999)),B=r.filter(t=>t.category==="comparison"),V=[...z,...A].sort((t,P)=>(t.rank??999)-(P.rank??999)),q=z.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:o}),q>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:z.filter(t=>t.rank&&t.rank<=3).map((t,P)=>e.jsxs("div",{className:`top3-card ${v(t.rank)} animate-slide-in`,style:{animationDelay:`${P*.15}s`},onClick:I=>a(t,I),title:s(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:u(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:t.title}),e.jsx("p",{className:"top3-achievement-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},t.id))})]}),V.length>0&&e.jsxs("div",{className:"achievements-section unified-rankings",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:V.filter(t=>t.type==="bad"?!0:!t.rank||t.rank>3).map((t,P)=>{const I=t.type==="bad",b=I?M(t.rank,t.totalRanked):T(t.rank,t.totalRanked),g=$(b),m=I?"":v(t.rank);return e.jsxs("div",{className:`achievement-card ${I?"bad":"good"} ${m}`,onClick:w=>a(t,w),title:s(t),style:{animationDelay:`${P*.05}s`,borderLeftColor:g,borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsxs("span",{className:"achievement-title",children:[I&&"ðŸ’€ ",t.title]}),e.jsxs("span",{className:"achievement-rank",style:b?{backgroundColor:b}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:t.description})]},t.id)})})]}),B.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques CoÃ©quipiers et Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:B.map(t=>e.jsxs("div",{className:"achievement-card comparison",onClick:P=>a(t,P),title:s(t),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:t.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:S(t.description)}})]},t.id))})]})]})}function it({selectedPlayerName:r,groupingMethod:o,campFilter:C="all"}){const{navigateToGameDetails:p}=ie(),{data:R,isLoading:n,error:y}=me(r),f=D.useMemo(()=>{switch(o){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[o]),i=D.useMemo(()=>{if(!R?.games)return new Map;const c=new Map;return R.games.forEach(s=>{if(!c.has(s.date)){const d=s.date.split("/");d.length===3?c.set(s.date,new Date(parseInt(d[2]),parseInt(d[1])-1,parseInt(d[0])).getTime()):c.set(s.date,new Date(s.date).getTime())}}),c},[R?.games]),h=D.useMemo(()=>{if(!R?.games)return[];const c={};return R.games.forEach(s=>{if(C!=="all"){if(C==="solo"){if(s.camp==="Villageois"||s.camp==="Loup")return}else if(s.camp!==C)return}let d;const S=s.date.split("/");if(o==="month")if(S.length===3)d=`${S[1].padStart(2,"0")}/${S[2]}`;else{const u=new Date(s.date);d=`${String(u.getMonth()+1).padStart(2,"0")}/${u.getFullYear()}`}else if(o==="quarter")if(S.length===3){const u=parseInt(S[1],10);d=`T${Math.floor((u-1)/3)+1}/${S[2]}`}else{const u=new Date(s.date);d=`T${Math.floor(u.getMonth()/3)+1}/${u.getFullYear()}`}else o==="year"?S.length===3?d=`${S[2]}`:d=`${new Date(s.date).getFullYear()}`:d=s.date;c[d]||(c[d]={games:[],wins:0,total:0}),c[d].games.push(s),c[d].total++,s.won&&c[d].wins++}),Object.entries(c).map(([s,d])=>({period:s,totalGames:d.total,victories:d.wins,defeats:d.total-d.wins,winRate:d.total>0?(d.wins/d.total*100).toFixed(1):"0.0",winRateNum:d.total>0?d.wins/d.total*100:0})).sort((s,d)=>{if(o==="month"){const[S,u]=s.period.split("/"),[v,T]=d.period.split("/"),M=new Date(parseInt(u),parseInt(S)-1,1),$=new Date(parseInt(T),parseInt(v)-1,1);return M.getTime()-$.getTime()}else if(o==="quarter"){const[S,u]=s.period.split("/"),[v,T]=d.period.split("/"),M=parseInt(S.replace(/\D/g,""),10)||1,$=parseInt(v.replace(/\D/g,""),10)||1,z=new Date(parseInt(u,10),(M-1)*3,1),A=new Date(parseInt(T,10),($-1)*3,1);return z.getTime()-A.getTime()}else if(o==="year"){const S=parseInt(s.period,10),u=parseInt(d.period,10);return S-u}else{const S=i.get(s.period)||0,u=i.get(d.period)||0;return S-u}})},[R,o,i,C]),a=(c=>c<=15?{fontSize:12,angle:-45,height:80,interval:0}:c<=30?{fontSize:12,angle:-45,height:85,interval:1}:c<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(c/12)})(h.length);return n?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):y?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",y]}):R?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",f]}),e.jsx(U,{title:`Ã‰volution des Performances ${f}`,children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(Ee,{data:h,margin:{top:20,right:30,left:20,bottom:20},onClick:c=>{if(c&&c.activeLabel){const s=h.find(d=>d.period===c.activeLabel);s&&p({selectedPlayer:r,selectedDate:s.period,fromComponent:`Ã‰volution des Performances ${f}`})}},style:{cursor:"pointer"},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"period",angle:a.angle,textAnchor:"end",height:a.height,interval:a.interval,fontSize:a.fontSize}),e.jsx(Q,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(_,{content:({active:c,payload:s})=>{if(c&&s&&s.length>0){const d=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:d.period})}),e.jsxs("div",{children:["Parties: ",d.totalGames]}),e.jsxs("div",{children:["Victoires: ",d.victories]}),e.jsxs("div",{children:["Taux: ",d.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Ve,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",f]}),e.jsx(U,{title:`RÃ©partition Victoires/DÃ©faites ${f}`,children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:h,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"period",angle:a.angle,textAnchor:"end",height:a.height,interval:a.interval,fontSize:a.fontSize}),e.jsx(Q,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(_,{content:({active:c,payload:s})=>{if(c&&s&&s.length>0){const d=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:d.period})}),e.jsxs("div",{children:["Total: ",d.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",d.victories]}),e.jsxs("div",{children:["DÃ©faites: ",d.defeats]}),e.jsxs("div",{children:["Taux: ",d.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(X,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:h.map((c,s)=>e.jsx(Z,{fill:"var(--accent-tertiary)",onClick:()=>{p({selectedPlayer:r,selectedDate:c.period,fromComponent:`Historique Joueur - Victoires ${f}`})},style:{cursor:"pointer"}},`cell-victories-${s}`))}),e.jsx(X,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:h.map((c,s)=>e.jsx(Z,{fill:"var(--chart-color-4)",onClick:()=>{p({selectedPlayer:r,selectedDate:c.period,fromComponent:`Historique Joueur - DÃ©faites ${f}`})},style:{cursor:"pointer"}},`cell-defeats-${s}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function nt({selectedPlayerName:r}){const{navigateToGameDetails:o}=ie(),{data:C,isLoading:p,error:R}=me(r),n=ce(),y=D.useMemo(()=>C?.campStats?Object.entries(C.campStats).map(([i,h])=>({name:i,value:h.appearances,winRate:h.winRate,winRateDisplay:Math.max(parseFloat(h.winRate),1),wins:h.wins,percentage:(h.appearances/C.totalGames*100).toFixed(1)})):[],[C]),f=D.useMemo(()=>{if(!y.length)return[];const i=5;let h=0;const l=[],a=[];if(y.forEach(c=>{parseFloat(c.percentage)<i?(h+=Number(c.value),l.push(c)):a.push(c)}),h>0){const c=y.reduce((s,d)=>s+Number(d.value),0);a.push({name:"Autres",value:h,winRate:"0.0",winRateDisplay:1,wins:l.reduce((s,d)=>s+d.wins,0),percentage:(h/c*100).toFixed(1),_details:l})}return a},[y]);return p?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):R?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",R]}):C?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(Pe,{children:[e.jsx(Te,{data:f,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:i=>{const h=i.percent!==void 0?i.percent:0;return i.name==="Autres"?`Autres : ${i.value} (${(h*100).toFixed(1)}%)`:`${i.name}: ${i.value} (${(h*100).toFixed(1)}%)`},children:f.map((i,h)=>e.jsx(Z,{fill:i.name==="Autres"?Le:n[i.name]||`var(--chart-color-${h%6+1})`,onClick:()=>{if(i.name==="Autres"){const l=i._details?.map(a=>a.name)||[];o({selectedPlayer:r,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:l},fromComponent:"Distribution par Camps"})}else i.name==="TraÃ®tre"||i.name==="Louveteau"?o({selectedPlayer:r,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):i.name==="Loup"?o({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):o({selectedPlayer:r,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${h}`))}),e.jsx(_,{content:({active:i,payload:h})=>{if(i&&h&&h.length>0){const l=h[0].payload;if(l.name==="Autres"&&l._details){const a=[...l._details].sort((c,s)=>s.value-c.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",l.value," parties (",l.percentage,"%)"]})}),e.jsx("div",{children:a.map((c,s)=>e.jsxs("div",{children:[c.name,": ",c.value," parties (",c.percentage,"%)"]},s))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[l.name," - ",l.value," parties (",l.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(U,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:y,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Q,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(_,{content:({active:i,payload:h})=>{if(i&&h&&h.length>0){const l=h[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:l.name})}),e.jsxs("div",{children:["Victoires: ",l.wins," / ",l.value]}),e.jsxs("div",{children:["Taux: ",l.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(X,{dataKey:"winRateDisplay",children:y.map((i,h)=>e.jsx(Z,{fill:parseFloat(i.winRate)===0?`${n[i.name]||`var(--chart-color-${h%6+1})`}50`:n[i.name]||`var(--chart-color-${h%6+1})`,onClick:()=>{i.name==="TraÃ®tre"||i.name==="Louveteau"?o({selectedPlayer:r,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):i.name==="Loup"?o({selectedPlayer:r,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):o({selectedPlayer:r,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${h}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function ot({selectedPlayerName:r}){const{gameData:o}=Se(),{joueursData:C}=pe(),p=ye(C),R=ce(),n=D.useMemo(()=>{if(!o||!r)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const f={},i={},h={},l=new Set;o.forEach(S=>{const u=S.PlayerStats.find(v=>v.Username.toLowerCase()===r.toLowerCase());if(u&&(S.PlayerStats.forEach(v=>{v.KillerName?.toLowerCase()===r.toLowerCase()&&(f[v.Username]=(f[v.Username]||0)+1)}),u.KillerName&&(i[u.KillerName]=(i[u.KillerName]||0)+1),u.DeathType)){const v=u.DeathType,T=le(v);h[T]||(h[T]={count:0,byDeathType:{}}),h[T].count+=1,h[T].byDeathType[v]=(h[T].byDeathType[v]||0)+1,l.add(v)}});const a=Object.entries(f).map(([S,u])=>({player:S,kills:u})).sort((S,u)=>u.kills-S.kills).slice(0,ge.TOP_10),c=Object.entries(i).map(([S,u])=>({player:S,kills:u})).sort((S,u)=>u.kills-S.kills).slice(0,ge.TOP_10),s=Object.entries(h).map(([S,u])=>{const v={deathType:S,count:u.count};return v[S]=u.count,v}).sort((S,u)=>u.count-S.count).slice(0,ge.TOP_10),d=Object.keys(h);return{playersKilled:a,killedBy:c,deathTypes:s,availableDeathTypes:d}},[o,r]),y=D.useMemo(()=>{const f={};n.availableDeathTypes.forEach(l=>{l==="TuÃ© par Loup"?f[l]=R.Loup:l==="Mort aux votes"?f[l]="var(--chart-color-1)":l.includes("Chasseur")?f[l]=R.Chasseur:l==="TuÃ© par Zombie"?f[l]=R.Vaudou:l==="TuÃ© par potion assassin"?f[l]=R.Alchimiste:l==="TuÃ© par Vengeur"?f[l]="var(--chart-color-2)":l==="Amoureux mort"?f[l]=R.Amoureux:l==="TuÃ© par La BÃªte"?f[l]="var(--chart-color-3)":l==="TuÃ© par ShÃ©rif"&&(f[l]="var(--chart-color-4)")});const i=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let h=0;return n.availableDeathTypes.forEach(l=>{f[l]||(f[l]=i[h%i.length],h++)}),f},[n.availableDeathTypes,R]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[n.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(U,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Q,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(_,{content:({active:f,payload:i})=>{if(f&&i&&i.length>0){const h=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:h.player})}),e.jsxs("div",{children:["TuÃ© ",h.kills," fois par ",r]})]})}return null}}),e.jsx(X,{dataKey:"kills",children:n.playersKilled.map((f,i)=>e.jsx(Z,{fill:p[f.player]||"var(--chart-color-3)"},`cell-killed-${i}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[r," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),n.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(U,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Q,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(_,{content:({active:f,payload:i})=>{if(f&&i&&i.length>0){const h=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:h.player})}),e.jsxs("div",{children:["A tuÃ© ",r," ",h.kills," fois"]})]})}return null}}),e.jsx(X,{dataKey:"kills",children:n.killedBy.map((f,i)=>e.jsx(Z,{fill:p[f.player]||"var(--chart-color-4)"},`cell-killer-${i}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[r," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),n.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(U,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(Q,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(_,{content:({active:f,payload:i})=>{if(f&&i&&i.length>0){const h=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:h.deathType})}),e.jsxs("div",{children:[r," est mort ",h.count," fois ainsi"]})]})}return null}}),n.availableDeathTypes.map(f=>e.jsx(X,{dataKey:f,name:f,stackId:"deaths",fill:y[f]||"var(--chart-color-5)"},f))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",r,"."]})]})]})}function lt(r,o){if(!r||r.trim()===""||o.length===0)return null;const C=new Map,p=new Map,R=new Map;o.forEach(h=>{if(!h.Modded)return;const l=h.PlayerStats.find(a=>te(a)===r||a.Username.toLowerCase()===r.toLowerCase());if(l){if(l.MainRoleInitial==="Inconnu")return;const a=l.Victorious,s=Re(l.MainRoleInitial,l.MainRoleChanges||[])!==l.MainRoleInitial,d=oe(l.MainRoleInitial),S=d==="Loup"||d==="TraÃ®tre"||d==="Louveteau";if(d==="Villageois"&&je(l)){const u=be(l);if(u&&Ge.includes(u)){const v=C.get(u)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};C.set(u,{appearances:v.appearances+1,wins:v.wins+(a?1:0),winsWithoutRoleChange:v.winsWithoutRoleChange+(!s&&a?1:0),gamesWithoutRoleChange:v.gamesWithoutRoleChange+(s?0:1)})}}else if(l.Power&&l.Power.trim()!==""&&l.Power!=="Inconnu"){if(d==="Villageois"){const u=C.get(l.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};C.set(l.Power,{appearances:u.appearances+1,wins:u.wins+(a?1:0),winsWithoutRoleChange:u.winsWithoutRoleChange+(!s&&a?1:0),gamesWithoutRoleChange:u.gamesWithoutRoleChange+(s?0:1)})}else if(S){const u=p.get(l.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},v=u.roleBreakdown;v.set(l.MainRoleInitial,(v.get(l.MainRoleInitial)||0)+1),p.set(l.Power,{appearances:u.appearances+1,wins:u.wins+(a?1:0),winsWithoutRoleChange:u.winsWithoutRoleChange+(!s&&a?1:0),gamesWithoutRoleChange:u.gamesWithoutRoleChange+(s?0:1),roleBreakdown:v})}}else if((d==="Villageois"||S)&&l.Power!=="Inconnu")if(d==="Villageois"){const u=C.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};C.set("Aucun pouvoir",{appearances:u.appearances+1,wins:u.wins+(a?1:0),winsWithoutRoleChange:u.winsWithoutRoleChange+(!s&&a?1:0),gamesWithoutRoleChange:u.gamesWithoutRoleChange+(s?0:1)})}else{const u=p.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},v=u.roleBreakdown;v.set(l.MainRoleInitial,(v.get(l.MainRoleInitial)||0)+1),p.set("Aucun pouvoir",{appearances:u.appearances+1,wins:u.wins+(a?1:0),winsWithoutRoleChange:u.winsWithoutRoleChange+(!s&&a?1:0),gamesWithoutRoleChange:u.gamesWithoutRoleChange+(s?0:1),roleBreakdown:v})}if(l.SecondaryRole&&l.SecondaryRole.trim()!==""&&l.SecondaryRole!=="Inconnu"){const u=R.get(l.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};R.set(l.SecondaryRole,{appearances:u.appearances+1,wins:u.wins+(a?1:0),winsWithoutRoleChange:u.winsWithoutRoleChange+(!s&&a?1:0),gamesWithoutRoleChange:u.gamesWithoutRoleChange+(s?0:1)})}}});const n=new Map;o.forEach(h=>{const l=h.PlayerStats.find(a=>te(a)===r||a.Username.toLowerCase()===r.toLowerCase());if(l&&je(l)){const a=be(l);a&&n.set(a,(n.get(a)||0)+1)}});const y=h=>Array.from(h.entries()).map(([l,a])=>({name:l,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...n.has(l)&&{totalGamesAllModes:n.get(l)}})).sort((l,a)=>a.appearances-l.appearances),f=h=>Array.from(h.entries()).map(([l,a])=>({name:l,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(a.roleBreakdown.entries()).map(([c,s])=>({role:c,count:s})).sort((c,s)=>s.count-c.count)})).sort((l,a)=>a.appearances-l.appearances),i=h=>Array.from(h.entries()).map(([l,a])=>({name:l,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((l,a)=>a.appearances-l.appearances);return{villageoisPowers:y(C),loupPowers:f(p),secondaryRoles:i(R)}}function ct({selectedPlayerName:r}){const{navigateToGameDetails:o,navigationState:C,updateNavigationState:p}=ie(),R=ce(),[n,y]=D.useState(C.playerHistoryRolesState?.chartMode||"appearances"),{data:f,isLoading:i,error:h}=fe(v=>lt(r,v));D.useEffect(()=>{(!C.playerHistoryRolesState||C.playerHistoryRolesState.chartMode!==n)&&p({playerHistoryRolesState:{chartMode:n}})},[n,C.playerHistoryRolesState,p]);const l=v=>{y(v),p({playerHistoryRolesState:{chartMode:v}})},a=D.useMemo(()=>{if(!f)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const v=1,T=1,M=15,$=n==="winRate"?(A,B)=>parseFloat(B.winRate)-parseFloat(A.winRate):(A,B)=>B.appearances-A.appearances,z=A=>({...A,winRateDisplay:Math.max(parseFloat(A.winRate),1)});return{villageoisPowers:f.villageoisPowers.filter(A=>A.appearances>=v).map(z).sort($).slice(0,M),loupPowers:f.loupPowers.filter(A=>A.appearances>=v).map(z).sort($).slice(0,M),secondaryRoles:f.secondaryRoles.filter(A=>A.appearances>=T).map(z).sort($).slice(0,M)}},[f,n]);if(i)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(h)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",h]});if(!f)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const c=a.villageoisPowers.length>0,s=a.loupPowers.length>0,d=a.secondaryRoles.length>0;if(!c&&!s&&!d)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const S=({active:v,payload:T})=>{if(v&&T&&T.length>0){const M=T[0].payload,$=M.gamesWithoutRoleChange<M.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:M.name})}),e.jsxs("div",{children:["Apparitions: ",M.appearances]}),$&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",M.appearances-M.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",M.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",M.winRate,"%"]})}),M.totalGamesAllModes&&M.totalGamesAllModes!==M.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",M.totalGamesAllModes,")"]}),M.roleBreakdown&&M.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),M.roleBreakdown.map((z,A)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",z.role,": ",z.count]},A))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},u=(v,T,M,$,z)=>{const A=n==="appearances"?"appearances":"winRateDisplay",B=n==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",V=n==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:T}),e.jsx(U,{title:T,children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:v,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Q,{label:{value:B,angle:270,position:"left",style:{textAnchor:"middle"}},domain:V}),e.jsx(_,{content:e.jsx(S,{})}),e.jsx(X,{dataKey:A,label:n==="winRate"?q=>{const{x:t,y:P,width:I,payload:b}=q;if(t===void 0||P===void 0||I===void 0||!b)return null;const g=b.winRate||"0";return e.jsxs("text",{x:t+I/2,y:P-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[g,"%"]})}:void 0,children:v.map((q,t)=>e.jsx(Z,{fill:z?z(q.name,t):M,onClick:()=>$(q.name),style:{cursor:"pointer"}},`cell-${t}`))})]})})})})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:n,onChange:v=>l(v.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[c&&u(a.villageoisPowers,"Camp Villageois","var(--chart-color-1)",v=>{o({selectedPlayer:r,campFilter:{selectedCamp:"Villageois",campFilterMode:n==="winRate"?"wins-only":"all-assignments"},selectedPower:v,fromComponent:`Historique des RÃ´les - Pouvoir: ${v}`})},v=>v==="Chasseur"&&R.Chasseur?R.Chasseur:v==="Alchimiste"&&R.Alchimiste?R.Alchimiste:v==="Protecteur"&&R.Protecteur?R.Protecteur:v==="Disciple"&&R.Disciple?R.Disciple:"var(--chart-color-1)"),s&&u(a.loupPowers,"Camp Loups","var(--chart-color-2)",v=>{o({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:n==="winRate"?"wins-only":"all-assignments"},selectedPower:v,fromComponent:`Historique des RÃ´les - Pouvoir: ${v}`})},()=>R.Loup||"var(--chart-color-2)"),d&&u(a.secondaryRoles,"RÃ´les Secondaires","var(--chart-color-3)",v=>{o({selectedPlayer:r,selectedSecondaryRole:v,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${v}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}function dt({viewMode:r,setViewMode:o,selectedMap:C,setSelectedMap:p,availableMaps:R,clusterRadius:n,setClusterRadius:y,availableDeathTypes:f,selectedDeathTypes:i,setSelectedDeathTypes:h,deathTypeColors:l,isDeathTypesExpanded:a,setIsDeathTypesExpanded:c}){return e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>o("deaths"),style:{background:r==="deaths"?"var(--accent-primary)":"transparent",color:r==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"ðŸ’€ Morts"}),e.jsx("button",{type:"button",onClick:()=>o("kills"),style:{background:r==="kills"?"var(--accent-primary)":"transparent",color:r==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="kills"?"bold":"normal",transition:"all 0.2s"},children:"âš”ï¸ Kills"}),e.jsx("button",{type:"button",onClick:()=>o("transformations"),style:{background:r==="transformations"?"var(--accent-primary)":"transparent",color:r==="transformations"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="transformations"?"bold":"normal",transition:"all 0.2s"},children:"ðŸº Transfos"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:C,onChange:s=>p(s.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:R.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:n,onChange:s=>y(parseInt(s.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:n===0?"Aucun":`${n} unitÃ©${n>1?"s":""}`})]}),r!=="transformations"&&e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>c(!a),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:a?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:a?"rotate(90deg)":"rotate(0deg)"},children:"â–¶"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[i.length," / ",f.length," sÃ©lectionnÃ©",i.length>1?"s":""]})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),h(f)},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),h([])},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:f.map(s=>{const d=i.includes(s),S=l[s]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",background:d?"var(--bg-tertiary)":"transparent",borderRadius:"4px",border:`1px solid ${d?S:"var(--border-color)"}`,cursor:"pointer",transition:"all 0.2s",fontSize:"0.9rem"},onClick:u=>{u.stopPropagation(),h(d?v=>v.filter(T=>T!==s):v=>[...v,s])},children:[e.jsx("input",{type:"checkbox",checked:d,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:S,flexShrink:0}}),e.jsx("span",{children:le(s)})]},s)})})]})]})]})}function ut({zoneAnalysis:r,selectedMap:o,viewMode:C,selectedPlayerName:p,hoveredZone:R,setHoveredZone:n}){return!r||o!=="Village"||C!=="deaths"?null:e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"0rem",padding:"1.5rem",background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",borderRadius:"12px",border:"2px solid var(--accent-primary)",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",color:"var(--accent-primary)",fontSize:"1.3rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"ðŸ“Š Analyse par zone (Village)"}),e.jsx("p",{style:{fontSize:"0.95rem",marginBottom:"1rem",color:"var(--text-secondary)",lineHeight:"1.5"},children:"Distribution des morts (selon les types sÃ©lectionnÃ©s) comparÃ©e Ã  la moyenne de tous les joueurs:"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:r.zoneStats.map(y=>{const f=y.zone===r.dominantZone&&r.maxDeviation>10;return e.jsxs("div",{onMouseEnter:()=>n(y.zone),onMouseLeave:()=>n(null),style:{padding:"1rem",background:"var(--bg-primary)",borderRadius:"8px",border:R===y.zone?"1px solid var(--accent-primary)":"1px solid var(--border-color)",color:"var(--text-primary)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.95rem"},children:y.zone}),e.jsxs("div",{style:{fontSize:"0.85rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[p,": ",e.jsxs("strong",{children:[y.playerPercent.toFixed(1),"%"]})," (",y.playerCount,")"]}),e.jsxs("div",{style:{opacity:.85},children:["Moyenne: ",y.avgPercent.toFixed(1),"%"]}),e.jsxs("div",{style:{marginTop:"0.25rem",color:f?"var(--accent-secondary)":y.deviation>0?"var(--accent-primary)":"var(--text-secondary)",fontWeight:Math.abs(y.deviation)>5?"bold":"normal"},children:[y.deviation>0?"+":"",y.deviation.toFixed(1),"% vs moyenne"]})]})]},y.zone)})}),r.dominantZone&&r.maxDeviation>10&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",fontSize:"0.95rem",color:"var(--accent-primary)",fontWeight:"bold",background:"var(--bg-primary)",borderRadius:"8px",border:"2px solid var(--accent-primary)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"âš ï¸"}),e.jsxs("span",{children:[p," meurt significativement plus souvent en zone ",r.dominantZone,"(","+"+r.maxDeviation.toFixed(1),"% par rapport Ã  la moyenne)"]})]})]})}function pt({locationData:r,clusteredData:o,viewMode:C,selectedPlayerName:p,selectedMap:R,mapConfig:n,xDomain:y,zDomain:f,hoveredZone:i,getDeathColor:h,handleLocationClick:l}){const a=({active:c,payload:s})=>{if(!c||!s||s.length===0)return null;const d=s[0].payload,S=d.allLocations||[d],u=S.length>1,v=C==="transformations";if(u){const M=new Map,$=new Map,z=new Set,A=new Map;S.forEach(t=>{if(M.set(t.victimName,(M.get(t.victimName)||0)+1),v)A.set(t.camp,(A.get(t.camp)||0)+1);else{const P=t.deathType?le(t.deathType):"Inconnu";$.set(P,($.get(P)||0)+1)}z.add(t.gameId)});const B=Array.from(M.entries()).sort((t,P)=>P[1]-t[1]).slice(0,3),V=Array.from($.entries()).sort((t,P)=>P[1]-t[1]).slice(0,3),q=Array.from(A.entries()).sort((t,P)=>P[1]-t[1]);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[v?"ðŸº":C==="deaths"?"ðŸ’€":"âš”ï¸"," ",S.length," ",v?"transformations":C==="deaths"?"morts":"kills"," Ã  cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[v?e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Camps loup:"}),q.map(([t,P])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",P,"Ã—)"]},t))]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:C==="deaths"?"Victimes:":"Kills sur:"}),B.map(([t,P])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",P,"Ã—)"]},t))]}),e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Types de mort:"}),V.map(([t,P])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",P,"Ã—)"]},t))]})]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["ðŸ“ ",z.size," partie",z.size>1?"s":""," diffÃ©rente",z.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const T=S[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[v?"ðŸº":C==="deaths"?"ðŸ’€":"âš”ï¸"," ",v?"Transformation de":C==="deaths"?"Mort de":"Kill de"," ",p]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[v?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ‘¤ ",e.jsx("strong",{children:"Joueur:"})," ",T.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp loup:"})," ",T.camp]}),e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",T.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",T.gameId]})]}):C==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Victime:"})," ",T.victimName]}),e.jsxs("div",{children:["âš”ï¸ ",e.jsx("strong",{children:"Tueur:"})," ",T.killerName||"Inconnu"]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",T.deathType?le(T.deathType):"Inconnu"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Victime:"})," ",T.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp victime:"})," ",T.camp]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",T.deathType?le(T.deathType):"Inconnu"]})]}),!v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",T.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",T.gameId]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})};return e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:r.length>0?e.jsx(U,{title:C==="deaths"?`Carte des Morts de ${p}`:`Carte des Kills de ${p}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(Oe,{margin:{top:20,right:30,left:60,bottom:20},children:[n&&e.jsx(ae,{x1:n.zMin,x2:n.zMax,y1:n.xMin,y2:n.xMax,fill:"transparent",stroke:"none",shape:c=>{const{x:s,y:d,width:S,height:u}=c;return e.jsx("image",{x:s,y:d,width:S,height:u,href:n.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),R==="Village"&&i&&e.jsxs(e.Fragment,{children:[i==="Ruines"&&e.jsx(ae,{x1:-220,x2:200,y1:100,y2:450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Village Principal"&&e.jsx(ae,{x1:-250,x2:100,y1:-120,y2:-450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Ferme"&&e.jsx(ae,{x1:-550,x2:-250,y1:150,y2:-150,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Village PÃªcheur"&&e.jsx(ae,{x1:150,x2:500,y1:80,y2:-320,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Reste de la Carte"&&e.jsx(ae,{x1:n?.zMin??-600,x2:n?.zMax??600,y1:n?.xMin??-500,y2:n?.xMax??500,fill:"var(--accent-primary)",fillOpacity:.15,stroke:"var(--accent-primary)",strokeWidth:2,strokeDasharray:"5 5"})]}),e.jsx(Y,{strokeDasharray:"3 3",stroke:n?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(J,{dataKey:"z",type:"number",name:"Position Z",domain:f,hide:!0}),e.jsx(Q,{dataKey:"x",type:"number",name:"Position X",domain:y,hide:!0}),e.jsx(_,{content:e.jsx(a,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Ke,{data:o,onClick:c=>l(c),style:{cursor:"pointer"},isAnimationActive:!1,children:o.map((c,s)=>{const d=Math.min(Math.log2(c.count+1)*3+5,18),S=Math.round(d);return e.jsx(Z,{fill:h(c.deathType,c.camp),stroke:c.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:c.count>1?2:1,opacity:.85,r:S},`cell-${s}`)})})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:C==="deaths"?`Aucune mort localisÃ©e pour ${p} sur cette carte.`:C==="kills"?`Aucun kill localisÃ© pour ${p} sur cette carte.`:`Aucune transformation en loup localisÃ©e pour ${p} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes."})]})})}function we(r,o){return o>=-250&&o<=100&&r>=-450&&r<=-120?"Village Principal":o>=-550&&o<=-250&&r>=-150&&r<=150?"Ferme":o>=150&&o<=500&&r>=-320&&r<=80?"Village PÃªcheur":o>=-220&&o<=200&&r>=100&&r<=450?"Ruines":"Reste de la Carte"}function ne(r){return r==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":r}function mt({selectedPlayerName:r}){const{navigateToGameDetails:o}=ie(),{gameData:C,isLoading:p,error:R}=Se(),n=ce(),[y,f]=D.useState("deaths"),[i,h]=D.useState(""),[l,a]=D.useState(0),[c,s]=D.useState(null),[d,S]=D.useState([]),[u,v]=D.useState(!1),{data:T}=me(r,"Tous les camps"),M=D.useMemo(()=>{if(!C)return[];const w=new Set;return C.forEach(x=>{const k=x.PlayerStats.find(N=>N.Username.toLowerCase()===r.toLowerCase());k&&(k.DeathPosition!==null&&x.MapName&&w.add(x.MapName),x.PlayerStats.forEach(N=>{N.KillerName?.toLowerCase()===r.toLowerCase()&&N.DeathPosition!==null&&x.MapName&&w.add(x.MapName)}),k.Actions&&Array.isArray(k.Actions)&&k.Actions.some(N=>N.ActionType==="Transform")&&x.MapName&&w.add(x.MapName))}),Array.from(w).filter(x=>x==="Village"||x==="ChÃ¢teau").sort((x,k)=>x==="Village"?-1:k==="Village"?1:x.localeCompare(k))},[C,r]),$=M.length>0?M[0]:"";i===""&&$!==""&&h($);const{availableDeathTypes:z,deathTypeColors:A}=D.useMemo(()=>{if(!C||!r)return{availableDeathTypes:[],deathTypeColors:{}};const w=new Set,x={};return C.forEach(k=>{const N=k.PlayerStats.find(F=>F.Username.toLowerCase()===r.toLowerCase());if(N){if(N.DeathPosition&&N.DeathType){const F=ne(N.DeathType);F&&w.add(F)}k.PlayerStats.forEach(F=>{if(F.KillerName?.toLowerCase()===r.toLowerCase()&&F.DeathPosition&&F.DeathType){const G=ne(F.DeathType);G&&w.add(G)}})}}),w.forEach(k=>{x[k]=He(k,n)}),{availableDeathTypes:Array.from(w).sort(),deathTypeColors:x}},[C,r,n]),B=(w,x)=>y==="transformations"&&x?n[x]||"var(--text-secondary)":w&&A[w]||"var(--text-secondary)";D.useEffect(()=>{if(d.length===0&&z.length>0){const w=z.filter(x=>x!=="VOTED");S(w)}},[z.length]);const V=D.useMemo(()=>{if(!C||!r)return[];const w=[];return C.forEach(x=>{if(i&&x.MapName!==i)return;const k=x.PlayerStats.find(N=>N.Username.toLowerCase()===r.toLowerCase());if(k)if(y==="deaths"){if(k.DeathPosition){const N=oe(k.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),F=de(k.DeathPosition.x,k.DeathPosition.z,x.MapName);w.push({x:F.x,z:F.z,victimName:k.Username,killerName:k.KillerName||null,deathType:ne(k.DeathType),mapName:x.MapName,camp:N,gameId:x.DisplayedId,displayedGameId:x.DisplayedId})}}else y==="kills"?x.PlayerStats.forEach(N=>{if(N.KillerName?.toLowerCase()===r.toLowerCase()&&N.DeathPosition){const F=oe(N.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),G=de(N.DeathPosition.x,N.DeathPosition.z,x.MapName);w.push({x:G.x,z:G.z,victimName:N.Username,killerName:r,deathType:ne(N.DeathType),mapName:x.MapName,camp:F,gameId:x.DisplayedId,displayedGameId:x.DisplayedId})}}):y==="transformations"&&k.Actions&&Array.isArray(k.Actions)&&k.Actions.forEach(N=>{if(N.ActionType==="Transform"&&N.Position){const F=oe(k.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),G=de(N.Position.x,N.Position.z,x.MapName);w.push({x:G.x,z:G.z,victimName:k.Username,killerName:null,deathType:null,mapName:x.MapName,camp:F,gameId:x.DisplayedId,displayedGameId:x.DisplayedId})}})}),y!=="transformations"&&d.length>0&&d.length<z.length?w.filter(x=>x.deathType&&d.includes(x.deathType)):w},[C,r,y,i,d,z]),q=D.useMemo(()=>{if(i!=="Village"||y!=="deaths"||V.length===0)return null;const w={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};if(V.forEach(E=>{const L=we(E.x,E.z);w[L]=(w[L]||0)+1}),!C)return null;const x={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};C.forEach(E=>{E.MapName==="Village"&&E.PlayerStats.forEach(L=>{if(!L.DeathPosition)return;const O=ne(L.DeathType);if(d.length>0&&d.length<z.length&&(!O||!d.includes(O)))return;const K=de(L.DeathPosition.x,L.DeathPosition.z,"Village"),he=we(K.x,K.z);x[he]=(x[he]||0)+1})});const k=Object.values(x).reduce((E,L)=>E+L,0),N=Object.values(w).reduce((E,L)=>E+L,0);if(k===0||N===0)return null;const F=["Village Principal","Village PÃªcheur","Ferme","Ruines","Reste de la Carte"];let G=0,j=null;const W=F.map(E=>{const L=w[E]/N*100,O=x[E]/k*100,K=L-O;return K>G&&w[E]>=2&&(G=K,j=E),{zone:E,playerCount:w[E],playerPercent:L,avgPercent:O,deviation:K}});return{totalPlayerDeaths:N,totalAllDeaths:k,zoneStats:W,dominantZone:j,maxDeviation:G}},[V,i,y,C,d,z]),t=D.useMemo(()=>_e(V,l).map((x,k)=>{const N=x.items[0],F=Ue(x.items);return{x:x.centroidX,z:x.centroidZ,count:x.items.length,allLocations:x.items,victimName:x.items.length===1?N.victimName:null,killerName:x.items.length===1?N.killerName:null,deathType:F,mapName:N.mapName,camp:N.camp,gameId:x.items.length===1?N.gameId:null,displayedGameId:x.items.length===1?N.displayedGameId:null,clusterIndex:k}}),[V,l]),P=D.useMemo(()=>Ye(i),[i]),{xDomain:I,zDomain:b}=D.useMemo(()=>{if(P)return{xDomain:[P.xMin,P.xMax],zDomain:[P.zMin,P.zMax]};if(t.length===0)return{xDomain:[0,100],zDomain:[0,100]};const w=t.map(E=>E.x),x=t.map(E=>E.z),k=Math.min(...w),N=Math.max(...w),F=Math.min(...x),G=Math.max(...x),j=(N-k)*.1||10,W=(G-F)*.1||10;return{xDomain:[k-j,N+j],zDomain:[F-W,G+W]}},[t,P]),g=w=>{if(!w)return;const x=w.allLocations||[w];if(x.length===1)o({selectedGame:x[0].gameId,fromComponent:"Player Death Map"});else{const k=x.map(N=>N.gameId).filter(N=>N);o({selectedGameIds:k,fromComponent:"Player Death Map"})}},m=D.useMemo(()=>{if(!T?.mapStats||!i)return null;const w=T.mapStats[i];return w?{winRate:w.winRate,wins:w.wins,total:w.appearances}:null},[T,i]);return p?e.jsx("div",{className:"donnees-attente",children:"Chargement des donnÃ©es..."}):R?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",R]}):C?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsx(dt,{viewMode:y,setViewMode:f,selectedMap:i,setSelectedMap:h,availableMaps:M,clusterRadius:l,setClusterRadius:a,availableDeathTypes:z,selectedDeathTypes:d,setSelectedDeathTypes:S,deathTypeColors:A,isDeathTypesExpanded:u,setIsDeathTypesExpanded:v}),e.jsx(pt,{locationData:V,clusteredData:t,viewMode:y,selectedPlayerName:r,selectedMap:i,mapConfig:P,xDomain:I,zDomain:b,hoveredZone:c,getDeathColor:B,handleLocationClick:g}),e.jsx(ut,{zoneAnalysis:q,selectedMap:i,viewMode:y,selectedPlayerName:r,hoveredZone:c,setHoveredZone:s}),m&&e.jsxs("div",{style:{flex:"1 1 100%",textAlign:"center",padding:"0.75rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)",marginTop:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginRight:"1rem"},children:["Taux de victoire sur ",e.jsx("strong",{children:i})," :"]}),e.jsxs("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:parseFloat(m.winRate)>=50?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[m.winRate,"%"]}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["(",m.wins," / ",m.total," victoires)"]})]}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"Ã€ propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",y==="deaths"?`les emplacements oÃ¹ ${r} est mort`:y==="kills"?`les emplacements oÃ¹ ${r} a Ã©liminÃ© d'autres joueurs`:`les emplacements oÃ¹ ${r} s'est transformÃ© en loup`," au cours des parties.",y!=="transformations"&&"Les couleurs indiquent le type de mort."," Cliquez sur un point pour voir les dÃ©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroupÃ©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’€ Morts:"})," OÃ¹ le joueur a Ã©tÃ© Ã©liminÃ©",e.jsx("br",{}),e.jsx("strong",{children:"âš”ï¸ Kills:"})," OÃ¹ le joueur a Ã©liminÃ© d'autres joueurs",e.jsx("br",{}),e.jsx("strong",{children:"ðŸº Transformations:"})," OÃ¹ le joueur s'est transformÃ© en loup"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function Ne(r){return r.PlayerStats.some(o=>o.SecondsTalkedOutsideMeeting>0||o.SecondsTalkedDuringMeeting>0)}function xe(r,o){const C=o.DeathDateIrl||r.EndDate,p=ke(r.StartDate,C);return p&&p>0?p:0}function ht(r){const o=r.filter(Ne),C=new Map;return o.forEach(p=>{p.PlayerStats.forEach(R=>{const n=te(R),y=Fe(R),f=xe(p,R);if(f<=0)return;C.has(n)||C.set(n,{displayName:y,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const i=C.get(n);i.gamesPlayed++,i.totalSecondsAll+=(R.SecondsTalkedOutsideMeeting||0)+(R.SecondsTalkedDuringMeeting||0),i.totalGameDuration+=f})}),{playerStats:C,gamesWithTalkingData:o.length}}function gt(r,o){if(!o||o.length===0||!r)return null;const C=ht(o),p=o.filter(Ne);if(p.length===0||C.playerStats.size===0)return null;let R=null;for(const[g,m]of C.playerStats)if(m.displayName===r){R=g;break}if(!R)return null;let n=0,y=0,f=0,i=0;const h={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},l=new Map;let a=0,c=0,s=0,d=0;if(p.forEach(g=>{const m=g.PlayerStats.find(W=>te(W)===R);if(!m)return;const w=xe(g,m);if(w<=0)return;n++;const x=m.SecondsTalkedOutsideMeeting||0,k=m.SecondsTalkedDuringMeeting||0,N=x+k;y+=x,f+=k,i+=w;const F=Ie(m.MainRoleInitial,m.Power);h[F].gamesPlayed++,h[F].secondsOutside+=x,h[F].secondsDuring+=k,h[F].gameDuration+=w;const G=Be(m);l.has(G)||l.set(G,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const j=l.get(G);j.gamesPlayed++,j.totalSecondsAll+=N,j.totalGameDuration+=w}),n===0||i<=0)return null;const S=3600/i,u=y*S,v=f*S,T=(y+f)*S,M=y+f>0?f/(y+f)*100:0,$=[];for(const[g,m]of Object.entries(h)){if(m.gamesPlayed===0)continue;const w=m.gameDuration>0?3600/m.gameDuration:0,x=m.secondsOutside+m.secondsDuring;$.push({camp:g,gamesPlayed:m.gamesPlayed,totalSecondsOutside:m.secondsOutside,totalSecondsDuring:m.secondsDuring,totalSecondsAll:x,totalGameDurationSeconds:m.gameDuration,secondsOutsidePer60Min:m.secondsOutside*w,secondsDuringPer60Min:m.secondsDuring*w,secondsAllPer60Min:x*w,meetingRatio:x>0?m.secondsDuring/x*100:0})}$.sort((g,m)=>m.gamesPlayed-g.gamesPlayed);const z=Array.from(l.entries()).filter(([g,m])=>m.gamesPlayed>=1).map(([g,m])=>({role:g,gamesPlayed:m.gamesPlayed,secondsAllPer60Min:m.totalGameDuration>0?m.totalSecondsAll/m.totalGameDuration*3600:0,totalSecondsAll:m.totalSecondsAll})).sort((g,m)=>m.secondsAllPer60Min-g.secondsAllPer60Min),A=[];for(const[g,m]of C.playerStats)m.totalGameDuration>0&&A.push({id:g,name:m.displayName,per60:m.totalSecondsAll/m.totalGameDuration*3600});A.sort((g,m)=>m.per60-g.per60);const B=A.reduce((g,m)=>g+m.per60,0),V=A.length>0?B/A.length:0,q=A.findIndex(g=>g.id===R)+1,t=A.length,P=t>0?Math.round((1-(q-1)/t)*100):0,I=T;p.forEach(g=>{const m=g.PlayerStats.find(N=>te(N)===R);if(!m)return;const w=xe(g,m);if(w<=0)return;((m.SecondsTalkedOutsideMeeting||0)+(m.SecondsTalkedDuringMeeting||0))/w*3600>=I?(a++,m.Victorious&&c++):(s++,m.Victorious&&d++)});const b={gamesAboveAverage:a,winsAboveAverage:c,winRateAboveAverage:a>0?c/a*100:0,gamesBelowAverage:s,winsBelowAverage:d,winRateBelowAverage:s>0?d/s*100:0};return{playerName:r,gamesPlayed:n,gamesWithTalkingData:C.gamesWithTalkingData,totalSecondsOutside:y,totalSecondsDuring:f,totalSecondsAll:y+f,totalGameDurationSeconds:i,secondsOutsidePer60Min:u,secondsDuringPer60Min:v,secondsAllPer60Min:T,meetingRatio:M,campBreakdown:$,globalAverageSecondsAllPer60Min:V,playerRank:q,totalPlayersWithData:t,percentile:P,roleBreakdown:z,winCorrelation:b}}function xt(r,o){return r?r.roleBreakdown.slice(0,o):[]}function ft(r){const{data:o,isLoading:C,error:p}=fe(R=>r?gt(r,R):null);return{data:o,isLoading:C,error:p}}function yt({selectedPlayerName:r}){const{data:o,isLoading:C,error:p}=ft(r),R=ce(),[n,y]=D.useState("both"),f=D.useMemo(()=>o?.campBreakdown?o.campBreakdown.map(s=>({camp:s.camp,"Hors rÃ©union":Math.round(s.secondsOutsidePer60Min),"En rÃ©union":Math.round(s.secondsDuringPer60Min),total:Math.round(s.secondsAllPer60Min),gamesPlayed:s.gamesPlayed,meetingRatio:s.meetingRatio.toFixed(1)})):[],[o]),i=D.useMemo(()=>o?[{name:"En rÃ©union",value:o.totalSecondsDuring,color:"#2196F3"},{name:"Hors rÃ©union",value:o.totalSecondsOutside,color:"#FF9800"}]:[],[o]);if(C)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(p)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",p]});if(!o)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de temps de parole ne sont disponibles que pour les parties rÃ©centes."})]});const h=o.secondsAllPer60Min-o.globalAverageSecondsAllPer60Min,l=o.globalAverageSecondsAllPer60Min>0?(h/o.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",a=h>0,c=o.winCorrelation.winRateAboveAverage-o.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¤ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:se(o.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:a?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[a?"+":"",l,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",o.playerRank," / ",o.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-o.percentile+1,"% ",o.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“ˆ Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:o.gamesPlayed}),e.jsxs("p",{children:["sur ",o.gamesWithTalkingData," avec donnÃ©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ—£ï¸ Ratio en rÃ©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[o.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),f.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(U,{title:"Temps de parole par camp (par 60min de jeu)",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>y("meeting"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:n==="meeting"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:n==="meeting"?"var(--accent-primary)":"var(--bg-secondary)",color:n==="meeting"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:n==="meeting"?"bold":"normal"},children:"En rÃ©union"}),e.jsx("button",{onClick:()=>y("outside"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:n==="outside"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:n==="outside"?"var(--accent-primary)":"var(--bg-secondary)",color:n==="outside"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:n==="outside"?"bold":"normal"},children:"Hors rÃ©union"}),e.jsx("button",{onClick:()=>y("both"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:n==="both"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:n==="both"?"var(--accent-primary)":"var(--bg-secondary)",color:n==="both"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:n==="both"?"bold":"normal"},children:"Les deux"})]}),e.jsx("div",{style:{height:350},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:f,layout:"vertical",children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(J,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:s=>`${Math.floor(s/60)}m`}),e.jsx(Q,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(_,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(s,d)=>[se(s),d],labelFormatter:s=>{const d=f.find(S=>S.camp===s);return`${s} (${d?.gamesPlayed||0} parties)`}}),e.jsx(Je,{}),(n==="both"||n==="outside")&&e.jsx(X,{dataKey:"Hors rÃ©union",stackId:"talk",fill:"#FF9800"}),(n==="both"||n==="meeting")&&e.jsx(X,{dataKey:"En rÃ©union",stackId:"talk",fill:"#2196F3"})]})})})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:(()=>{const s=f.find(v=>v.camp==="Villageois"),d=f.find(v=>v.camp==="Loup");if(!s||!d)return e.jsx("p",{children:"ðŸ’¡ Pas assez de donnÃ©es pour comparer les camps Villageois et Loups."});const S=s.total-d.total,u=d.total>0?(Math.abs(S)/d.total*100).toFixed(0):"0";return S>0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:ve("Villageois")},children:[se(S)," de plus (+",u,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Villageois"})," qu'en tant que"," ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]}):S<0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:ve("Loup")},children:[se(Math.abs(S))," de plus (+",u,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Loup"})," qu'en tant que"," ",e.jsx("strong",{children:"Villageois"})," (par heure de jeu)."]}):e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle exactement autant en tant que"," ",e.jsx("strong",{children:"Villageois"})," qu'en tant que ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(U,{title:"RÃ©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(Pe,{children:[e.jsx(Te,{data:i,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:s=>`${s.name}: ${((s.percent||0)*100).toFixed(1)}%`,children:i.map((s,d)=>e.jsx(Z,{fill:s.color},`cell-${d}`))}),e.jsx(_,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:s=>se(s)})]})})})})}),o&&o.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(U,{title:s=>s?"Top 15 rÃ´les les plus bavards (par 60min)":"Top 5 rÃ´les les plus bavards (par 60min)",children:s=>{const S=xt(o,s?15:5).map(u=>({role:u.role,secondsPer60Min:Math.round(u.secondsAllPer60Min),gamesPlayed:u.gamesPlayed}));return e.jsx("div",{style:{height:s?400:300},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:S,children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(J,{dataKey:"role",tick:{fill:"var(--text-primary)",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(Q,{tick:{fill:"var(--text-secondary)"},tickFormatter:u=>`${Math.floor(u/60)}m`}),e.jsx(_,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:u=>[se(u),"Temps de parole"],labelFormatter:u=>{const v=S.find(T=>T.role===u);return`${u} (${v?.gamesPlayed||0} parties)`}}),e.jsx(X,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",children:S.map((u,v)=>e.jsx(Z,{fill:R[u.role]||R.Villageois},`cell-${v}`))})]})})})}})}),(o.winCorrelation.gamesAboveAverage>0||o.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"ðŸŽ¯ CorrÃ©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[o.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",o.winCorrelation.winsAboveAverage,"/",o.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[o.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",o.winCorrelation.winsBelowAverage,"/",o.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(c)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:c>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[c>0?"supÃ©rieur":"infÃ©rieur"," de ",Math.abs(c).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function vt({playerTitles:r,titlesLoading:o}){if(o)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des titres..."})]})});if(!r||r.titles.length===0)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-empty",children:[e.jsx("p",{children:"ðŸ“œ Aucun titre disponible"}),e.jsx("p",{className:"empty-subtitle",children:r?.gamesPlayed?`${r.gamesPlayed} parties jouÃ©es - minimum 25 parties requises pour obtenir des titres`:"Les titres sont gÃ©nÃ©rÃ©s chaque dimanche pour les joueurs avec 25+ parties en mode moddÃ©"})]})});const C=[...r.titles].sort((p,R)=>{const n=r.titles.indexOf(p),f=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(p.category||"")?100-(p.percentile||50):p.percentile||50,i=(p.priority||0)*1e3+f*10-n,h=r.titles.indexOf(R),a=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(R.category||"")?100-(R.percentile||50):R.percentile||50;return(R.priority||0)*1e3+a*10-h-i});return e.jsxs("div",{className:"titles-section",children:[e.jsxs("div",{className:"titles-header",children:[e.jsx("h3",{children:"ðŸ·ï¸ Titres actuels"}),e.jsxs("p",{className:"titles-info",children:[r.titles.length," titre",r.titles.length>1?"s":""," â€¢",r.gamesPlayed," parties jouÃ©es"]})]}),e.jsx("div",{className:"titles-grid",children:C.map((p,R)=>{const n=r.primaryTitle?.id===p.id;return e.jsxs("div",{className:`title-card ${p.type} ${n?"primary":""}`,title:`${p.description}${p.percentile!==void 0?`
MeilleurÂ·e que ${p.percentile.toFixed(1)}% des joueurs`:""}`,children:[e.jsx("div",{className:"title-rank",children:R+1}),"            ",n&&e.jsx("div",{className:"title-crown",children:"ðŸ‘‘"}),"            ",e.jsx("div",{className:"title-emoji",children:p.emoji}),e.jsxs("div",{className:"title-info",children:[e.jsx("div",{className:"title-name",children:p.title}),e.jsx("div",{className:"title-description",children:p.description}),p.percentile!==void 0&&p.type!=="combination"&&e.jsxs("div",{className:"title-percentile",children:["Top ",(100-p.percentile).toFixed(0),"%"]}),e.jsx("div",{className:"title-type-badge",children:p.type==="combination"?"Combo":p.type==="role"?"RÃ´le":"Stat"}),!n&&p.primaryOwner&&e.jsxs("div",{className:"title-primary-owner",children:["ðŸ‘¤ Titre principal de: ",e.jsx("strong",{children:p.primaryOwner})]}),p.type==="combination"&&p.conditions&&p.conditions.length>0&&e.jsxs("div",{className:"title-conditions-breakdown",children:[e.jsx("div",{className:"breakdown-header",children:"Conditions:"}),p.conditions.map((y,f)=>e.jsxs("div",{className:"condition-item",children:[e.jsxs("span",{className:"condition-stat",children:[y.stat==="winRate"?"Victoires":y.stat==="loot"?"RÃ©colte":y.stat==="lootVillageois"?"RÃ©colte (Villageois)":y.stat==="lootLoup"?"RÃ©colte (Loup)":y.stat==="survival"?"Survie":y.stat==="killRate"?"Kills":y.stat==="talking"?"Parole":y.stat==="talkingOutsideMeeting"?"Parole (hors dÃ©bats)":y.stat==="talkingDuringMeeting"?"Parole (meeting)":y.stat==="votingAggressive"?"Vote agressif":y.stat==="votingAccuracy"?"PrÃ©cision vote":y.stat==="votingFirst"?"Vote rapide":y.stat==="survivalDay1"?"Survie J1":y.stat==="winRateVillageois"?"Victoires Villageois":y.stat==="winRateLoup"?"Victoires Loup":y.stat==="winRateSolo"?"Victoires Solo":y.stat==="hunterAccuracy"?"PrÃ©cision chasseur":y.stat,":"]}),e.jsx("span",{className:`condition-category ${y.category?.toLowerCase()}`,children:y.category}),y.actualPercentile!==void 0&&e.jsxs("span",{className:"condition-percentile",children:["(Top ",(100-y.actualPercentile).toFixed(0),"%)"]})]},f))]})]})]},p.id)})})]})}function Et(){const{settings:r,updateSettings:o}=ue(),{navigateToGameDetails:C,navigationState:p,updateNavigationState:R}=ie(),{data:n,isLoading:y,error:f}=ze(),{joueursData:i,isLoading:h}=pe(),{data:l,isLoading:a,error:c}=tt(r.highlightedPlayer),{playerData:s,isLoading:d}=st(r.highlightedPlayer),S=ye(i),[u,v]=D.useState(""),[T,M]=D.useState(null),{clips:$}=Qe(r.highlightedPlayer),{clips:z}=Xe(),[A,B]=D.useState(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded"?"modded":"all":r.gameFilter==="modded"?"modded":"all"),V=D.useMemo(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded":r.gameFilter==="modded",[r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter,r.gameFilter]),[q,t]=D.useState(r.selectedPlayerSelectionView||p.selectedPlayerSelectionView||"achievements"),[P,I]=D.useState("session"),[b,g]=D.useState("all");D.useEffect(()=>{if(r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled){const j=r.independentFilters.gameFilter==="modded"?"modded":"all";B(j)}else if(!r.useIndependentFilters){const j=r.gameFilter==="modded"?"modded":"all";B(j)}},[r.gameFilter,r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter]),D.useEffect(()=>{V&&A!=="modded"&&B("modded")},[V,A]),D.useEffect(()=>{const j=r.selectedPlayerSelectionView||p.selectedPlayerSelectionView;j&&j!==q&&t(j)},[r.selectedPlayerSelectionView,p.selectedPlayerSelectionView]);const{data:m}=me(r.highlightedPlayer||""),w=D.useMemo(()=>{if(!n||!n.GameStats)return[];const j=V?n.GameStats.filter(E=>E.Modded===!0):n.GameStats,W=new Map;return j.forEach(E=>{const L=new Date(E.StartDate);E.PlayerStats.forEach(O=>{const K=te(O),De=i?.Players?.find(Ae=>Ae.SteamID===K)?.Joueur||O.Username;W.has(K)||W.set(K,{games:0,wins:0,firstDate:L,lastDate:L,displayName:De});const re=W.get(K);re.games++,O.Victorious&&re.wins++,L<re.firstDate&&(re.firstDate=L),L>re.lastDate&&(re.lastDate=L)})}),Array.from(W.entries()).map(([E,L])=>{let O=i?.Players?.find(K=>K.SteamID===E);return O||(O=i?.Players?.find(K=>K.Joueur===L.displayName)),{id:E,name:L.displayName,totalGames:L.games,totalWins:L.wins,winRate:L.games>0?L.wins/L.games*100:0,firstGameDate:L.firstDate.toLocaleDateString("fr-FR"),lastGameDate:L.lastDate.toLocaleDateString("fr-FR"),isHighlighted:L.displayName===r.highlightedPlayer,image:O?.Image||null,twitch:O?.Twitch||null,youtube:O?.Youtube||null}})},[n,r.highlightedPlayer,i,V]),x=D.useMemo(()=>{if(!u.trim())return w;const j=u.toLowerCase();return w.filter(W=>W.name.toLowerCase().includes(j))},[w,u]),k=D.useMemo(()=>[...x].sort((j,W)=>W.totalGames-j.totalGames),[x]),N=j=>{o({highlightedPlayer:j}),v("")},F=j=>{t(j),R({selectedPlayerSelectionView:j}),o({selectedPlayerSelectionView:j,tab:"playerSelection"})},G=()=>{if($.length===0)return;const j=Math.floor(Math.random()*$.length);M($[j])};return y||h?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):f?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",f]})]}):!n||w.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!r.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:u,onChange:j=>v(j.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[x.length," joueur",x.length!==1?"s":"",u&&` (filtrÃ©${x.length!==1?"s":""} de ${w.length})`]})]})]}),e.jsx("div",{className:"player-display",children:u?x.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>v(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:k.map(j=>e.jsxs("button",{type:"button",className:`suggestion-btn ${j.isHighlighted?"highlighted":""}`,onClick:()=>N(j.name),children:[j.image?e.jsx("img",{src:j.image,alt:`Photo de profil de ${j.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":S[j.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[j.name,j.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[j.totalGames," parties â€¢ ",j.winRate.toFixed(1),"% victoires"]})]})]},j.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',u,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>v(""),children:"Effacer la recherche"})]}):r.highlightedPlayer?(()=>{const j=w.find(W=>W.name===r.highlightedPlayer);return j?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:j.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[j.image?e.jsx("img",{src:j.image,alt:`Photo de profil de ${j.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":S[j.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[j.totalGames," parties â€¢ ",j.totalWins," victoires â€¢ ",j.winRate.toFixed(1),"% taux de victoire"]}),s?.primaryTitle?e.jsxs("div",{className:"player-primary-title",title:s.primaryTitle.description,style:{marginTop:"0.5rem",display:"inline-flex",alignItems:"center",gap:"0.3rem",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("span",{className:"title-emoji",children:s.primaryTitle.emoji}),e.jsx("span",{className:"title-text",children:s.primaryTitle.title})]}):e.jsx("div",{className:"player-no-title",style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic"},children:"ðŸ“œ 25 parties moddÃ©es minimum pour obtenir un titre"}),(j.twitch||j.youtube||$.length>0)&&e.jsxs("div",{className:"social-links",children:[j.twitch&&e.jsx("a",{href:j.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),j.youtube&&e.jsx("a",{href:j.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"}),$.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:W=>{W.stopPropagation(),G()},title:`${$.length} clip${$.length>1?"s":""} disponible${$.length>1?"s":""}`,children:["ðŸŽ¬ Clip alÃ©atoire (",$.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${q==="achievements"?"active":""}`,onClick:()=>F("achievements"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${q==="titles"?"active":""}`,onClick:()=>F("titles"),children:"Titres"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${q==="evolution"?"active":""}`,onClick:()=>F("evolution"),children:"Ã‰volution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${q==="camps"?"active":""}`,onClick:()=>F("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${q==="roles"?"active":""}`,onClick:()=>F("roles"),children:"RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${q==="kills"?"active":""}`,onClick:()=>F("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${q==="deathmap"?"active":""}`,onClick:()=>F("deathmap"),children:"Cartes"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${q==="talkingtime"?"active":""}`,onClick:()=>F("talkingtime"),children:"Parole"})]}),q==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[a?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):c?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",c]})}):l?e.jsx(at,{achievements:A==="all"?l.allGamesAchievements:l.moddedOnlyAchievements,title:A==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:A}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[!V&&e.jsx("button",{type:"button",className:`filter-btn ${A==="all"?"active":""}`,onClick:W=>{W.stopPropagation(),B("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${A==="modded"?"active":""}`,onClick:W=>{W.stopPropagation(),B("modded")},disabled:V,children:"Parties moddÃ©es"})]})]}),q==="titles"&&e.jsx(vt,{playerTitles:s,titlesLoading:d}),q==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[m&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{C({selectedPlayer:j.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${j.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:m.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:qe(m.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{C({selectedPlayer:j.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${j.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:m.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[m.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:P,onChange:W=>I(W.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:b,onChange:W=>g(W.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(it,{selectedPlayerName:j.name,groupingMethod:P,campFilter:b})]}),q==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(nt,{selectedPlayerName:j.name})}),q==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ct,{selectedPlayerName:j.name})}),q==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ot,{selectedPlayerName:j.name})}),q==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(mt,{selectedPlayerName:j.name})}),q==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(yt,{selectedPlayerName:j.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:W=>{W.stopPropagation(),o({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[j.firstGameDate," - ",j.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',r.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>o({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:k.map(j=>e.jsxs("div",{className:`character-card ${j.isHighlighted?"highlighted":""}`,onClick:()=>N(j.name),title:`${j.name} - ${j.totalGames} parties, ${j.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:j.image?e.jsx("img",{src:j.image,alt:`Photo de profil de ${j.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":S[j.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:j.name}),(j.twitch||j.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[j.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),j.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},j.id))})})}),T&&e.jsx(Ze,{clip:T,onClose:()=>M(null),relatedClips:et(T,z),nextClip:Ce(T,z),onNextClip:()=>{const j=Ce(T,z);j&&M(j)},onRelatedClip:j=>{const W=z.find(E=>E.ClipId===j);W&&M(W)}})]})}export{Et as PlayerSelectionPage};
