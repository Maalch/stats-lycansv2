import{r as f,j as e}from"./index-C3nKP7nN.js";import{a as B}from"./baseStatsHook-D9udRBc8.js";import{a as j,g as v}from"./datasyncExport-CjB7UYqV.js";import{g as V}from"./gameUtils-DYpUb-C5.js";import{F as W,C as b,X as F,Y as N,a as $}from"./FullscreenChart-B3MygqK8.js";import{R as S,T as R}from"./CategoricalChart-Dnt1YB7q.js";import{B as L,a as y}from"./BarChart-DD2auIcS.js";import{L as k}from"./Legend-rxJirynK.js";function T(a){const l=a.PlayerStats.length;let x=0,d=0,m=0;const p=a.PlayerStats.filter(r=>{const c=j(r.MainRoleInitial,r.MainRoleChanges||[]),u=v(c,{regroupWolfSubRoles:!1}),n=u==="Loup"||u==="Traître"||u==="Louveteau";return n&&(u==="Loup"?x++:u==="Traître"?d++:u==="Louveteau"&&m++),n}),i=a.PlayerStats.filter(r=>{const c=j(r.MainRoleInitial,r.MainRoleChanges||[]),u=v(c);return u!=="Villageois"&&u!=="Loup"});return{playerCount:l,wolfCount:p.length,pureWolfCount:x,traitreCount:d,louveteuCount:m,soloCount:i.length,villageoisCount:l-p.length-i.length}}function P(a){if(a.length===0)return null;const l={};a.forEach(m=>{const p=T(m),{playerCount:i,wolfCount:r,pureWolfCount:c,traitreCount:u,louveteuCount:n,soloCount:t,villageoisCount:o}=p;l[i]||(l[i]={});const s=`${c}L-${u}T-${n}Lou`,h=`${r}w-${t}s-${s}`;l[i][h]||(l[i][h]={wolfCount:r,pureWolfCount:c,traitreCount:u,louveteuCount:n,soloCount:t,villageoisCount:o,appearances:0,winsByWolves:0,winsByVillageois:0,winsBySolo:0,wolfWinRate:0,villageoisWinRate:0,soloWinRate:0,configKey:h,wolfBreakdownKey:s}),l[i][h].appearances++;const C=V(m);C==="Loup"?l[i][h].winsByWolves++:C==="Villageois"?l[i][h].winsByVillageois++:l[i][h].winsBySolo++});const x=[];let d=0;return Object.keys(l).map(Number).sort((m,p)=>m-p).forEach(m=>{const p=l[m],i=[];Object.values(p).forEach(o=>{const s=o.appearances>0?o.winsByWolves/o.appearances*100:0,h=o.appearances>0?o.winsByVillageois/o.appearances*100:0,C=o.appearances>0?o.winsBySolo/o.appearances*100:0;i.push({...o,wolfWinRate:s,villageoisWinRate:h,soloWinRate:C}),o.appearances>=5&&d++}),i.sort((o,s)=>s.appearances-o.appearances);const r=i.filter(o=>o.appearances>=5),c=r.length>0?r[0]:void 0,u=r.length>0?r.reduce((o,s)=>s.wolfWinRate>o.wolfWinRate?s:o):void 0,n=r.length>0?r.reduce((o,s)=>s.villageoisWinRate>o.villageoisWinRate?s:o):void 0,t=i.reduce((o,s)=>o+s.appearances,0);x.push({playerCount:m,totalGames:t,configurations:i,mostCommon:c,bestWolfWinRate:u,bestVillageoisWinRate:n})}),{compositionsByPlayerCount:x,totalGamesAnalyzed:a.length,configurationsWithMinAppearances:d}}function w(){const{data:a,isLoading:l,error:x}=B(P);return{teamCompositionStats:a,isLoading:l,error:x}}function g(a){const l=[];return a.pureWolfCount>0&&l.push(`${a.pureWolfCount}L`),a.traitreCount>0&&l.push(`${a.traitreCount}T`),a.louveteuCount>0&&l.push(`${a.louveteuCount}Lou`),l.length>0?l.join("+"):"0L"}function O(){const{teamCompositionStats:a,isLoading:l,error:x}=w(),[d,m]=f.useState(null),[p,i]=f.useState("overview");if(l)return e.jsx("div",{children:"Chargement des compositions d'équipe..."});if(x)return e.jsxs("div",{children:["Erreur: ",x]});if(!a||a.compositionsByPlayerCount.length===0)return e.jsx("div",{children:"Aucune donnée de composition disponible"});const r=a.compositionsByPlayerCount.map(t=>{const o=t.mostCommon;return{playerCount:t.playerCount,totalGames:t.totalGames,mostCommonConfig:o?`${g(o)}/${o.soloCount}S`:"N/A",mostCommonWolfBreakdown:o?g(o):"N/A",mostCommonAppearances:o?o.appearances:0,mostCommonWolfWinRate:o?o.wolfWinRate:0,mostCommonVillageoisWinRate:o?o.villageoisWinRate:0,mostCommonSoloWinRate:o?o.soloWinRate:0,hasEnoughData:o&&o.appearances>=5,mostCommonFullConfig:o}}),c=d!==null?a.compositionsByPlayerCount.find(t=>t.playerCount===d):null,u=c?c.configurations.filter(t=>t.appearances>=5):[],n={wolf:"#dc2626",villageois:"#16a34a",solo:"#f59e0b"};return e.jsxs("div",{className:"lycans-camps-container",children:[e.jsx("h2",{children:"Statistiques des Compositions d'Équipe"}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.totalGamesAnalyzed}),e.jsx("p",{children:"parties analysées"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Configurations Fréquentes"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.configurationsWithMinAppearances}),e.jsx("p",{children:"≥5 parties"})]})]}),e.jsxs("div",{className:"lycans-categories-selection",children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${p==="overview"?"active":""}`,onClick:()=>{i("overview"),m(null)},children:"Vue d'ensemble"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${p==="detailed"?"active":""}`,onClick:()=>i("detailed"),children:"Vue détaillée"})]}),e.jsx("div",{className:"lycans-graphiques-groupe",children:p==="overview"?e.jsx(W,{title:"Compositions les Plus Fréquentes par Nombre de Joueurs",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Configuration la plus jouée pour chaque nombre de joueurs (minimum 5 parties)."}),e.jsx(S,{width:"100%",height:400,children:e.jsxs(L,{data:r,children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"playerCount",label:{value:"Nombre de joueurs",position:"insideBottom",offset:-5}}),e.jsx(N,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(R,{content:({active:t,payload:o})=>{if(t&&o&&o.length>0){const s=o[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:4},children:[s.playerCount," joueurs"]}),e.jsxs("p",{style:{fontSize:"0.875rem"},children:["Total: ",s.totalGames," parties"]}),s.hasEnoughData?e.jsxs(e.Fragment,{children:[e.jsxs("p",{style:{fontSize:"0.875rem",fontWeight:500,marginTop:8},children:["Config la + fréquente: ",s.mostCommonConfig]}),s.mostCommonFullConfig&&e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(",s.mostCommonFullConfig.pureWolfCount," Loup",s.mostCommonFullConfig.traitreCount>0?`, ${s.mostCommonFullConfig.traitreCount} Traître`:"",s.mostCommonFullConfig.louveteuCount>0?`, ${s.mostCommonFullConfig.louveteuCount} Louveteau`:"",")"]}),e.jsxs("p",{style:{fontSize:"0.875rem"},children:["Parties: ",s.mostCommonAppearances]}),e.jsxs("div",{style:{marginTop:8,fontSize:"0.875rem"},children:[e.jsxs("p",{style:{color:n.wolf},children:["Victoires Loups: ",s.mostCommonWolfWinRate.toFixed(1),"%"]}),e.jsxs("p",{style:{color:n.villageois},children:["Victoires Villageois:"," ",s.mostCommonVillageoisWinRate.toFixed(1),"%"]}),e.jsxs("p",{style:{color:n.solo},children:["Victoires Solo: ",s.mostCommonSoloWinRate.toFixed(1),"%"]})]})]}):e.jsx("p",{style:{fontSize:"0.875rem",fontStyle:"italic",marginTop:8,color:"var(--text-secondary)"},children:"Pas assez de données (minimum 5 parties requises)"})]})}return null}}),e.jsx(y,{dataKey:"mostCommonAppearances",fill:"#3b82f6",name:"Parties",children:r.map((t,o)=>e.jsx($,{cursor:"pointer",fill:t.hasEnoughData?"#3b82f6":"#d1d5db",opacity:t.hasEnoughData?1:.3,onClick:()=>{m(t.playerCount),i("detailed")}},`cell-${o}`))})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-center",children:"Joueurs"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"Total Parties"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"Détails"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"Parties"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"% Loups"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"% Villageois"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"% Solo"})]})}),e.jsx("tbody",{children:r.map((t,o)=>e.jsxs("tr",{className:`${o%2===0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-900"} hover:bg-blue-50 dark:hover:bg-blue-900 cursor-pointer`,onClick:()=>{m(t.playerCount),i("detailed")},children:[e.jsx("td",{className:"px-6 py-3 font-medium text-center",children:t.playerCount}),e.jsx("td",{className:"px-6 py-3 text-center",children:t.totalGames}),e.jsx("td",{className:"px-6 py-3 text-center",children:t.hasEnoughData&&t.mostCommonFullConfig?e.jsxs(e.Fragment,{children:[t.mostCommonFullConfig.pureWolfCount>0&&`${t.mostCommonFullConfig.pureWolfCount} Loup${t.mostCommonFullConfig.pureWolfCount>1?"s":""}`,t.mostCommonFullConfig.traitreCount>0&&e.jsxs(e.Fragment,{children:[t.mostCommonFullConfig.pureWolfCount>0?", ":"",t.mostCommonFullConfig.traitreCount," Traître",t.mostCommonFullConfig.traitreCount>1?"s":""]}),t.mostCommonFullConfig.louveteuCount>0&&e.jsxs(e.Fragment,{children:[t.mostCommonFullConfig.pureWolfCount>0||t.mostCommonFullConfig.traitreCount>0?", ":"",t.mostCommonFullConfig.louveteuCount," Louveteau",t.mostCommonFullConfig.louveteuCount>1?"x":""]}),t.mostCommonFullConfig.soloCount>0&&e.jsxs(e.Fragment,{children:[t.mostCommonFullConfig.pureWolfCount>0||t.mostCommonFullConfig.traitreCount>0||t.mostCommonFullConfig.louveteuCount>0?", ":"",t.mostCommonFullConfig.soloCount," Solo"]}),t.mostCommonFullConfig.villageoisCount>0&&e.jsxs(e.Fragment,{children:[", ",t.mostCommonFullConfig.villageoisCount," Villageois"]})]}):"N/A"}),e.jsx("td",{className:"px-6 py-3 text-center",children:t.hasEnoughData?t.mostCommonAppearances:"-"}),e.jsx("td",{className:"px-6 py-3 text-center font-medium",style:{color:t.hasEnoughData?n.wolf:"var(--text-secondary)"},children:t.hasEnoughData?`${t.mostCommonWolfWinRate.toFixed(1)}%`:"-"}),e.jsx("td",{className:"px-6 py-3 text-center font-medium",style:{color:t.hasEnoughData?n.villageois:"var(--text-secondary)"},children:t.hasEnoughData?`${t.mostCommonVillageoisWinRate.toFixed(1)}%`:"-"}),e.jsx("td",{className:"px-6 py-3 text-center font-medium",style:{color:t.hasEnoughData?n.solo:"var(--text-secondary)"},children:t.hasEnoughData?`${t.mostCommonSoloWinRate.toFixed(1)}%`:"-"})]},t.playerCount))})]})})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{style:{background:"var(--bg-tertiary)",padding:"1rem",borderRadius:"8px",marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-primary)",fontWeight:500,fontSize:"0.9rem"},children:"Sélectionner le nombre de joueurs:"}),e.jsxs("select",{value:d||"",onChange:t=>m(t.target.value?Number(t.target.value):null),style:{background:"var(--bg-primary)",color:"var(--text-primary)",border:"2px solid var(--border-color)",borderRadius:"8px",padding:"10px 12px",fontSize:"0.9rem",width:"100%",cursor:"pointer"},children:[e.jsx("option",{value:"",children:"-- Choisir --"}),a.compositionsByPlayerCount.map(t=>e.jsxs("option",{value:t.playerCount,children:[t.playerCount," joueurs (",t.totalGames," parties)"]},t.playerCount))]})]}),d!==null&&c&&e.jsx(W,{title:`Configurations pour ${d} joueurs (${c.totalGames} parties)`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Toutes les configurations jouées au moins 5 fois. Format: Loups (L=Loup pur, T=Traître, Lou=Louveteau) / S=Rôles Solo / V=Villageois"}),u.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["Aucune configuration jouée au moins 5 fois pour ",d," joueurs"]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{width:"100%",height:400,children:e.jsxs(L,{data:u.map(t=>({name:`${g(t)}/${t.soloCount}S`,config:t,Loups:t.wolfWinRate,Villageois:t.villageoisWinRate,Solo:t.soloWinRate})),children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"name"}),e.jsx(N,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"}}),e.jsx(R,{content:({active:t,payload:o})=>{if(t&&o&&o.length>0){const s=o[0].payload.config;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:4},children:[g(s)," / ",s.soloCount,"S /"," ",s.villageoisCount,"V"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(",s.pureWolfCount," Loup",s.traitreCount>0?`, ${s.traitreCount} Traître`:"",s.louveteuCount>0?`, ${s.louveteuCount} Louveteau`:"",")"]}),e.jsxs("p",{style:{fontSize:"0.875rem"},children:["Parties jouées: ",s.appearances]}),e.jsxs("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:4},children:[e.jsxs("p",{style:{fontSize:"0.875rem",color:n.wolf},children:["Loups: ",s.winsByWolves," victoires (",s.wolfWinRate.toFixed(1),"%)"]}),e.jsxs("p",{style:{fontSize:"0.875rem",color:n.villageois},children:["Villageois: ",s.winsByVillageois," ","victoires (",s.villageoisWinRate.toFixed(1),"%)"]}),e.jsxs("p",{style:{fontSize:"0.875rem",color:n.solo},children:["Solo: ",s.winsBySolo," victoires (",s.soloWinRate.toFixed(1),"%)"]})]})]})}return null}}),e.jsx(k,{}),e.jsx(y,{dataKey:"Loups",fill:n.wolf}),e.jsx(y,{dataKey:"Villageois",fill:n.villageois}),e.jsx(y,{dataKey:"Solo",fill:n.solo})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-center",children:"Détails"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"Parties"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"V. Loups"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"V. Villageois"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"V. Solo"})]})}),e.jsx("tbody",{children:u.map((t,o)=>e.jsxs("tr",{className:o%2===0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-900",children:[e.jsxs("td",{className:"px-6 py-3 text-xs text-center",style:{color:"var(--text-secondary)"},children:[t.pureWolfCount>0&&`${t.pureWolfCount} Loup${t.pureWolfCount>1?"s":""}`,t.traitreCount>0&&e.jsxs(e.Fragment,{children:[t.pureWolfCount>0?", ":"",t.traitreCount," Traître",t.traitreCount>1?"s":""]}),t.louveteuCount>0&&e.jsxs(e.Fragment,{children:[t.pureWolfCount>0||t.traitreCount>0?", ":"",t.louveteuCount," Louveteau",t.louveteuCount>1?"x":""]}),t.soloCount>0&&e.jsxs(e.Fragment,{children:[t.pureWolfCount>0||t.traitreCount>0||t.louveteuCount>0?", ":"",t.soloCount," Solo"]}),t.villageoisCount>0&&e.jsxs(e.Fragment,{children:[", ",t.villageoisCount," Villageois"]})]}),e.jsx("td",{className:"px-6 py-3 text-center font-medium",children:t.appearances}),e.jsxs("td",{className:"px-6 py-3 text-center",children:[e.jsx("span",{style:{color:n.wolf,fontWeight:500},children:t.winsByWolves}),e.jsxs("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginLeft:"0.25rem"},children:["(",t.wolfWinRate.toFixed(1),"%)"]})]}),e.jsxs("td",{className:"px-6 py-3 text-center",children:[e.jsx("span",{style:{color:n.villageois,fontWeight:500},children:t.winsByVillageois}),e.jsxs("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginLeft:"0.25rem"},children:["(",t.villageoisWinRate.toFixed(1),"%)"]})]}),e.jsxs("td",{className:"px-6 py-3 text-center",children:[e.jsx("span",{style:{color:n.solo,fontWeight:500},children:t.winsBySolo}),e.jsxs("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginLeft:"0.25rem"},children:["(",t.soloWinRate.toFixed(1),"%)"]})]})]},t.configKey))})]})})]})]})})]})})]})}export{O as TeamCompositionChart};
