import{a as _,r as F,g as U,k as se,u as B,j as e,c as ae,l as te}from"./index-Cin4BaLL.js";import{u as H}from"./useJoueursData-Dl8pSJpK.js";import{g as re,a as ie,c as le,u as ne}from"./datasyncExport-CB50MWLg.js";import{g as oe}from"./gameUtils-Cf4hdjyU.js";import{u as J,g as ce,a as X,l as Q}from"./api-C0W34Rzp.js";import{d as de}from"./durationFormatters-Br-IfF5C.js";import{F as I,C as G,X as z,Y as M,B as K,a as E,b as L}from"./FullscreenChart-BVTrhgUa.js";import{R as A,T as q}from"./CategoricalChart-Dhaxec9B.js";import{L as ue,a as me}from"./LineChart-dyieggM7.js";import{P as pe,a as he}from"./PieChart-Dxbndjd8.js";import{R as Y}from"./ReferenceLine-DV6J-jtC.js";import{g as ge}from"./deathTypes-CGUOTngO.js";import"./ActivePoints-_eQXfM1R.js";import"./PolarChart-Cr9qm8aT.js";function fe(l){const{settings:x}=_(),{joueursData:v}=H(),[j,C]=F.useState(null),[g,y]=F.useState(!1),[c,t]=F.useState(null);F.useEffect(()=>{let r=!0;return(async()=>{try{y(!0),t(null);const n=x.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",o=await fetch(n);if(!o.ok)throw new Error(`Failed to load achievements: ${o.status} ${o.statusText}`);const d=await o.json();r&&C(d)}catch(n){r&&t(n instanceof Error?n.message:"Failed to load achievements")}finally{r&&y(!1)}})(),()=>{r=!1}},[x.dataSource]);const i=(()=>{if(!l||!j)return null;const m=v?.Players?.find(n=>n.Joueur===l)?.SteamID;return m?j.achievements[m]||null:(console.warn(`âš ï¸ No Steam ID found for player: ${l}`),null)})();return F.useEffect(()=>{if(l&&j&&v){const m=v.Players?.find(o=>o.Joueur===l)?.SteamID;if(!m){console.log(`âŒ No Steam ID found for player: ${l}`);return}const n=j.achievements[m];n?console.log(`ðŸ† Achievements for ${l} [ID: ${m}] (${x.dataSource}):`,{allGames:n.allGamesAchievements.length,moddedOnly:n.moddedOnlyAchievements.length,categories:[...new Set([...n.allGamesAchievements.map(o=>o.category),...n.moddedOnlyAchievements.map(o=>o.category)])]}):console.log(`âŒ No achievements found for ${l} [ID: ${m}] in ${x.dataSource} data source`)}},[l,j,v,x.dataSource]),{data:i,isLoading:g,error:c,metadata:{generatedAt:j?.generatedAt||null,totalPlayers:j?.totalPlayers||0,totalGames:j?.totalGames||0,totalModdedGames:j?.totalModdedGames||0}}}function xe(l,x){if(!l||l.trim()===""||x.length===0)return null;const v=[];let j=l;x.forEach(r=>{const m=r.PlayerStats.find(n=>U(n)===l||n.Username.toLowerCase()===l.toLowerCase());if(m){j=m.Username;const n=re(ie(m.MainRoleInitial,m.MainRoleChanges||[])),o=oe(r),d=m.Victorious,b=se(new Date(r.StartDate)),h=le(r.StartDate,r.EndDate)||0;v.push({gameId:r.Id,date:b,camp:n,won:d,winnerCamp:o,playersInGame:r.PlayerStats.length,mapName:r.MapName,duration:h})}}),v.sort((r,m)=>{const n=o=>{const d=o.split("/");return d.length===3?new Date(parseInt(d[2]),parseInt(d[1])-1,parseInt(d[0])):new Date(o)};return n(m.date).getTime()-n(r.date).getTime()});const C=v.length,g=v.filter(r=>r.won).length,y=C>0?(g/C*100).toFixed(2):"0.00",c={};v.forEach(r=>{c[r.camp]||(c[r.camp]={appearances:0,wins:0,winRate:"0.00"}),c[r.camp].appearances++,r.won&&c[r.camp].wins++}),Object.keys(c).forEach(r=>{const m=c[r];m.winRate=m.appearances>0?(m.wins/m.appearances*100).toFixed(2):"0.00"});const t={};v.forEach(r=>{t[r.mapName]||(t[r.mapName]={appearances:0,wins:0,winRate:"0.00"}),t[r.mapName].appearances++,r.won&&t[r.mapName].wins++}),Object.keys(t).forEach(r=>{const m=t[r];m.winRate=m.appearances>0?(m.wins/m.appearances*100).toFixed(2):"0.00"});const i=v.reduce((r,m)=>r+m.duration,0);return{playerName:j,totalGames:C,totalWins:g,winRate:y,totalPlayTime:i,games:v,campStats:c,mapStats:t}}function ve(l){const x={};let v=0,j=0;return Object.entries(l).forEach(([C,g])=>{C==="Village"||C==="ChÃ¢teau"?x[C]={...g}:(v+=g.appearances,j+=g.wins)}),v>=10&&(x.Autres={appearances:v,wins:j,winRate:v>0?(j/v*100).toFixed(2):"0.00"}),x}function O(l){const{data:x,isLoading:v,error:j}=ne(C=>l?xe(l,C):null);return{data:x,isLoading:v,error:j}}function je({achievements:l,title:x,emptyMessage:v,achievementType:j="all"}){const{navigateToTab:C,updateNavigationState:g,clearNavigation:y}=B(),{settings:c,updateSettings:t}=_(),{joueursData:i}=H(),r=J(i),m=(s,T)=>{if(T.stopPropagation(),!s.redirectTo)return;y();const S=c.highlightedPlayer;if(t(j==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:S,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:S,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),s.category==="comparison"&&s.redirectTo.subTab==="comparison"){const u=c.highlightedPlayer||"",p=n(s.description,u);p&&g({playerComparisonState:{selectedPlayer1:u,selectedPlayer2:p,showDetailedStats:!0}})}if(s.category==="comparison"&&s.redirectTo.subTab==="pairing"){const u=s.description.toLowerCase().includes("loup");g({selectedPairingTab:u?"wolves":"lovers"})}if(s.category==="kills"&&s.redirectTo.subTab==="deathStats"){const u=s.description.match(/(Villageois|Loups|Autres)/i);u&&g({deathStatsSelectedCamp:u[1]});let p=10;const a=s.description.match(/min\.\s*(\d+)/);a&&(p=parseInt(a[1],10));let f="totalKills",N="killers";const w=s.redirectTo.chartSection;w&&(w==="killers-total"?(f="totalKills",N="killers"):w==="killers-average"?(f="averageKills",N="killers"):w==="deaths-total"?(f="totalDeaths",N="deaths"):w==="survivors-average"?(f="survivalRate",N="deaths"):(w==="hunters-good"||w==="hunters-bad")&&(N="hunter",f="averageKills")),g({deathStatisticsState:{selectedCamp:u?.[1]||"Tous les camps",minGamesForAverage:p,selectedView:N,focusChart:f}})}if(s.category==="map"&&s.redirectTo.subTab==="playersGeneral"){const u=s.redirectTo.mapFilter||"all";let p=10;const a=s.description.match(/min\.\s*(\d+)/);a&&(p=parseInt(a[1])),t(j==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:u,playerFilter:{mode:"none",players:[]},highlightedPlayer:S,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:u,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:u,playerFilter:{mode:"none",players:[]},highlightedPlayer:S,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:u,playerFilter:{mode:"none",players:[]}}}),g({playersGeneralState:{minGamesForWinRate:p,winRateOrder:"best",focusChart:"winRate"}}),C("players","playersGeneral");return}if(s.category==="history"&&s.redirectTo.subTab==="history"&&g({selectedPlayerName:c.highlightedPlayer||"",groupingMethod:"session"}),s.category==="series"&&s.redirectTo.subTab==="series"){let u="wins";const p=s.title.toLowerCase(),a=s.description.toLowerCase();p.includes("dÃ©faite")||a.includes("dÃ©faite")?u="losses":p.includes("loup")||a.includes("loup")?u="loup":p.includes("villageois")||a.includes("villageois")?u="villageois":(p.includes("victoire")||a.includes("victoire"))&&(u="wins"),g({selectedSeriesType:u})}if(s.category==="general"&&s.redirectTo.subTab==="playersGeneral"){let u=10;const p=s.description.match(/min\.\s*(\d+)/);p&&(u=parseInt(p[1],10));let a="winRate",f="best";const N=s.title.toLowerCase(),w=s.description.toLowerCase();N.includes("participation")||w.includes("participation")?a="participation":(N.includes("taux de victoire")||w.includes("taux de victoire"))&&(a="winRate",(N.includes("moins bon")||N.includes("mauvais")||w.includes("moins bon")||w.includes("mauvais"))&&(f="worst")),g({playersGeneralState:{minGamesForWinRate:u,winRateOrder:f,focusChart:a}})}if(s.category==="performance"&&s.redirectTo.subTab==="campPerformance"){const u=s.redirectTo.chartSection;let p="Villageois",a=1;u&&(u==="camp-loup"?p="Loup":u==="camp-villageois"?p="Villageois":u==="camp-idiot"?p="Idiot du Village":u==="camp-amoureux"?p="Amoureux":(u==="solo-roles"||u==="hall-of-fame")&&(p="Villageois"));const f=s.description.match(/min\.\s*(\d+)/);f&&(a=parseInt(f[1],10)),u==="solo-roles"?p="RÃ´les spÃ©ciaux":u==="hall-of-fame"&&(p="Tous les camps"),g({campPerformanceState:{selectedCampPerformanceCamp:p,selectedCampPerformanceMinGames:a}})}if(s.category==="voting"&&s.redirectTo.subTab==="votingStats"){const u=s.title.toLowerCase();let p="overview",a="behavior";u.includes("agressivitÃ©")?(p="overview",a="behavior"):u.includes("taux de vote")?(p="behavior",a="voteRate"):u.includes("prÃ©cision")&&(p="overview",a="accuracy"),g({votingStatsState:{selectedCategory:p,selectedView:a}})}C(s.redirectTo.tab,s.redirectTo.subTab)},n=(s,T)=>{const S=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const u of S){const p=s.match(u);if(p&&p[1]){const a=p[1].trim();if(a!==T)return a}}return null},o=s=>{if(!s.redirectTo)return"Aucune navigation disponible";switch(s.category){case"general":if(s.redirectTo.subTab==="playersGeneral"){const u=s.description.match(/min\.\s*(\d+)/),p=u?parseInt(u[1],10):10,a=s.title.toLowerCase(),f=j==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return a.includes("taux de victoire")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${p} parties)${f}`:a.includes("participation")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir les participations${f}`:`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${f}`}break;case"map":if(s.redirectTo.subTab==="playersGeneral"){const u=s.redirectTo.mapFilter,p=u==="village"?"Village":u==="chateau"?"ChÃ¢teau":"map",a=j==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${p}${a}`}break;case"history":if(s.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(s.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${n(s.description,c.highlightedPlayer||"")||"ce joueur"}`;if(s.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(s.redirectTo.subTab==="deathStats"){const u=s.description.match(/(Villageois|Loups|Autres)/i),p=s.description.match(/min\.\s*(\d+)/),a=p?parseInt(p[1],10):10,f=u?.[1]||"Tous les camps",N=s.redirectTo.chartSection;let w="kills et morts";return N==="killers-total"?w="total des kills":N==="killers-average"?w=`moyenne des kills (min. ${a} parties)`:N==="deaths-total"?w="total des morts":N==="survivors-average"&&(w=`taux de survie (min. ${a} parties)`),`Cliquez pour voir les statistiques de ${w} ${f!=="Tous les camps"?`en ${f}`:""}`}break;case"series":if(s.redirectTo.subTab==="series"){const u=s.title.toLowerCase(),p=s.description.toLowerCase();return u.includes("dÃ©faite")||p.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":u.includes("loup")||p.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":u.includes("villageois")||p.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":u.includes("victoire")||p.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(s.redirectTo.subTab==="campPerformance"){const u=s.redirectTo.chartSection,p=j==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return u==="camp-loup"?`Cliquez pour voir les performances camp Loup${p}`:u==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${p}`:u==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${p}`:u==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${p}`:u==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${p}`:u==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${p}`:`Cliquez pour voir les performances par camp${p}`}break;case"voting":if(s.redirectTo.subTab==="votingStats"){const u=s.description.match(/min\.\s*(\d+)/),p=u?parseInt(u[1],10):25,a=j==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",f=s.title.toLowerCase();return f.includes("agressivitÃ©")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${p} meetings)${a}`:f.includes("taux de vote")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${p} meetings)${a}`:f.includes("prÃ©cision")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${a}`:`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${a}`}break}return`Cliquez pour voir ${s.redirectTo.subTab}`+(j==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},d=s=>r[s]||ce(s),b=s=>{const T=[/avec ([^:]+?):/,/contre ([^:]+?):/];let S=s;return T.forEach(u=>{const p=s.match(u);if(p&&p[1]){const a=p[1].trim(),N=`<span class="player-name-highlight" style="color: ${d(a)};">${a}</span>`;S=S.replace(a,N)}}),S};if(l.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:x}),e.jsx("p",{children:v||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const h=s=>s===1?"ðŸ¥‡":s===2?"ðŸ¥ˆ":s===3?"ðŸ¥‰":"",k=s=>s===1?"rank-1":s===2?"rank-2":s===3?"rank-3":s&&s<=10?"rank-top-10":"",D=l.filter(s=>s.category!=="comparison"&&(s.type==="good"||s.type==="neutral")).sort((s,T)=>(s.rank??999)-(T.rank??999)),$=l.filter(s=>s.category!=="comparison"&&s.type==="bad").sort((s,T)=>(s.rank??999)-(T.rank??999)),R=l.filter(s=>s.category==="comparison"),W=D.filter(s=>s.rank&&s.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:x}),W>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:D.filter(s=>s.rank&&s.rank<=3).map((s,T)=>e.jsxs("div",{className:`top3-card ${k(s.rank)} animate-slide-in`,style:{animationDelay:`${T*.15}s`},onClick:S=>m(s,S),title:o(s),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:h(s.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",s.rank,s.totalRanked?`/${s.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:s.title}),e.jsx("p",{className:"top3-achievement-description",children:s.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},s.id))})]}),D.length>0&&e.jsxs("div",{className:"achievements-section good-achievements",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:D.filter(s=>!s.rank||s.rank>3).map((s,T)=>e.jsxs("div",{className:`achievement-card good ${k(s.rank)}`,onClick:S=>m(s,S),title:o(s),style:{animationDelay:`${T*.05}s`},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:s.title}),e.jsxs("span",{className:"achievement-rank",children:["#",s.rank,s.totalRanked?`/${s.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:s.description})]},s.id))})]}),$.length>0&&e.jsxs("div",{className:"achievements-section bad-achievements",children:[e.jsx("h5",{children:"ðŸ’€ Classements (InversÃ©s)"}),e.jsx("div",{className:"achievements-grid",children:$.map(s=>e.jsxs("div",{className:`achievement-card bad rank-${s.rank}`,onClick:T=>m(s,T),title:o(s),children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:s.title}),e.jsxs("span",{className:"achievement-rank",children:["#",s.rank,s.totalRanked?`/${s.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:s.description})]},s.id))})]}),R.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:R.map(s=>e.jsxs("div",{className:"achievement-card comparison",onClick:T=>m(s,T),title:o(s),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:s.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:b(s.description)}})]},s.id))})]})]})}function ye({selectedPlayerName:l,groupingMethod:x,campFilter:v="all"}){const{navigateToGameDetails:j}=B(),{data:C,isLoading:g,error:y}=O(l),c=F.useMemo(()=>{switch(x){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[x]),t=F.useMemo(()=>{if(!C?.games)return new Map;const n=new Map;return C.games.forEach(o=>{if(!n.has(o.date)){const d=o.date.split("/");d.length===3?n.set(o.date,new Date(parseInt(d[2]),parseInt(d[1])-1,parseInt(d[0])).getTime()):n.set(o.date,new Date(o.date).getTime())}}),n},[C?.games]),i=F.useMemo(()=>{if(!C?.games)return[];const n={};return C.games.forEach(o=>{if(v!=="all"){if(v==="solo"){if(o.camp==="Villageois"||o.camp==="Loup")return}else if(o.camp!==v)return}let d;const b=o.date.split("/");if(x==="month")if(b.length===3)d=`${b[1].padStart(2,"0")}/${b[2]}`;else{const h=new Date(o.date);d=`${String(h.getMonth()+1).padStart(2,"0")}/${h.getFullYear()}`}else if(x==="quarter")if(b.length===3){const h=parseInt(b[1],10);d=`T${Math.floor((h-1)/3)+1}/${b[2]}`}else{const h=new Date(o.date);d=`T${Math.floor(h.getMonth()/3)+1}/${h.getFullYear()}`}else x==="year"?b.length===3?d=`${b[2]}`:d=`${new Date(o.date).getFullYear()}`:d=o.date;n[d]||(n[d]={games:[],wins:0,total:0}),n[d].games.push(o),n[d].total++,o.won&&n[d].wins++}),Object.entries(n).map(([o,d])=>({period:o,totalGames:d.total,victories:d.wins,defeats:d.total-d.wins,winRate:d.total>0?(d.wins/d.total*100).toFixed(1):"0.0",winRateNum:d.total>0?d.wins/d.total*100:0})).sort((o,d)=>{if(x==="month"){const[b,h]=o.period.split("/"),[k,D]=d.period.split("/"),$=new Date(parseInt(h),parseInt(b)-1,1),R=new Date(parseInt(D),parseInt(k)-1,1);return $.getTime()-R.getTime()}else if(x==="quarter"){const[b,h]=o.period.split("/"),[k,D]=d.period.split("/"),$=parseInt(b.replace(/\D/g,""),10)||1,R=parseInt(k.replace(/\D/g,""),10)||1,W=new Date(parseInt(h,10),($-1)*3,1),s=new Date(parseInt(D,10),(R-1)*3,1);return W.getTime()-s.getTime()}else if(x==="year"){const b=parseInt(o.period,10),h=parseInt(d.period,10);return b-h}else{const b=t.get(o.period)||0,h=t.get(d.period)||0;return b-h}})},[C,x,t,v]),m=(n=>n<=15?{fontSize:12,angle:-45,height:80,interval:0}:n<=30?{fontSize:12,angle:-45,height:85,interval:1}:n<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(n/12)})(i.length);return g?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):y?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",y]}):C?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",c]}),e.jsx(I,{title:`Ã‰volution des Performances ${c}`,children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(ue,{data:i,margin:{top:20,right:30,left:20,bottom:20},onClick:n=>{if(n&&n.activeLabel){const o=i.find(d=>d.period===n.activeLabel);o&&j({selectedPlayer:l,selectedDate:o.period,fromComponent:`Ã‰volution des Performances ${c}`})}},style:{cursor:"pointer"},children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"period",angle:m.angle,textAnchor:"end",height:m.height,interval:m.interval,fontSize:m.fontSize}),e.jsx(M,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(q,{content:({active:n,payload:o})=>{if(n&&o&&o.length>0){const d=o[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:d.period})}),e.jsxs("div",{children:["Parties: ",d.totalGames]}),e.jsxs("div",{children:["Victoires: ",d.victories]}),e.jsxs("div",{children:["Taux: ",d.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(me,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",c]}),e.jsx(I,{title:`RÃ©partition Victoires/DÃ©faites ${c}`,children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(K,{data:i,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"period",angle:m.angle,textAnchor:"end",height:m.height,interval:m.interval,fontSize:m.fontSize}),e.jsx(M,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(q,{content:({active:n,payload:o})=>{if(n&&o&&o.length>0){const d=o[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:d.period})}),e.jsxs("div",{children:["Total: ",d.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",d.victories]}),e.jsxs("div",{children:["DÃ©faites: ",d.defeats]}),e.jsxs("div",{children:["Taux: ",d.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(E,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:i.map((n,o)=>e.jsx(L,{fill:"var(--accent-tertiary)",onClick:()=>{j({selectedPlayer:l,selectedDate:n.period,fromComponent:`Historique Joueur - Victoires ${c}`})},style:{cursor:"pointer"}},`cell-victories-${o}`))}),e.jsx(E,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:i.map((n,o)=>e.jsx(L,{fill:"var(--chart-color-4)",onClick:()=>{j({selectedPlayer:l,selectedDate:n.period,fromComponent:`Historique Joueur - DÃ©faites ${c}`})},style:{cursor:"pointer"}},`cell-defeats-${o}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function be({selectedPlayerName:l}){const{navigateToGameDetails:x}=B(),{data:v,isLoading:j,error:C}=O(l),g=X(),y=F.useMemo(()=>v?.campStats?Object.entries(v.campStats).map(([t,i])=>({name:t,value:i.appearances,winRate:i.winRate,winRateDisplay:Math.max(parseFloat(i.winRate),1),wins:i.wins,percentage:(i.appearances/v.totalGames*100).toFixed(1)})):[],[v]),c=F.useMemo(()=>{if(!y.length)return[];const t=5;let i=0;const r=[],m=[];if(y.forEach(n=>{parseFloat(n.percentage)<t?(i+=Number(n.value),r.push(n)):m.push(n)}),i>0){const n=y.reduce((o,d)=>o+Number(d.value),0);m.push({name:"Autres",value:i,winRate:"0.0",winRateDisplay:1,wins:r.reduce((o,d)=>o+d.wins,0),percentage:(i/n*100).toFixed(1),_details:r})}return m},[y]);return j?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):C?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",C]}):v?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(pe,{children:[e.jsx(he,{data:c,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:t=>{const i=t.percent!==void 0?t.percent:0;return t.name==="Autres"?`Autres : ${t.value} (${(i*100).toFixed(1)}%)`:`${t.name}: ${t.value} (${(i*100).toFixed(1)}%)`},children:c.map((t,i)=>e.jsx(L,{fill:t.name==="Autres"?Q:g[t.name]||`var(--chart-color-${i%6+1})`,onClick:()=>{if(t.name==="Autres"){const r=t._details?.map(m=>m.name)||[];x({selectedPlayer:l,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:r},fromComponent:"Distribution par Camps"})}else t.name==="TraÃ®tre"||t.name==="Louveteau"?x({selectedPlayer:l,campFilter:{selectedCamp:t.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):t.name==="Loup"?x({selectedPlayer:l,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):x({selectedPlayer:l,campFilter:{selectedCamp:t.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${i}`))}),e.jsx(q,{content:({active:t,payload:i})=>{if(t&&i&&i.length>0){const r=i[0].payload;if(r.name==="Autres"&&r._details){const m=[...r._details].sort((n,o)=>o.value-n.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",r.value," parties (",r.percentage,"%)"]})}),e.jsx("div",{children:m.map((n,o)=>e.jsxs("div",{children:[n.name,": ",n.value," parties (",n.percentage,"%)"]},o))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[r.name," - ",r.value," parties (",r.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(I,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(K,{data:y,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(M,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(q,{content:({active:t,payload:i})=>{if(t&&i&&i.length>0){const r=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.name})}),e.jsxs("div",{children:["Victoires: ",r.wins," / ",r.value]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(E,{dataKey:"winRateDisplay",children:y.map((t,i)=>e.jsx(L,{fill:parseFloat(t.winRate)===0?`${g[t.name]||`var(--chart-color-${i%6+1})`}50`:g[t.name]||`var(--chart-color-${i%6+1})`,onClick:()=>{t.name==="TraÃ®tre"||t.name==="Louveteau"?x({selectedPlayer:l,campFilter:{selectedCamp:t.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):t.name==="Loup"?x({selectedPlayer:l,campFilter:{selectedCamp:t.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):x({selectedPlayer:l,campFilter:{selectedCamp:t.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${i}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function Ce({selectedPlayerName:l}){const{navigateToGameDetails:x}=B(),{data:v,isLoading:j,error:C}=O(l),g=F.useMemo(()=>{if(!v?.mapStats)return[];const y=ve(v.mapStats);return Object.entries(y).map(([c,t])=>({name:c,value:t.appearances,winRate:t.winRate,winRateDisplay:Math.max(parseFloat(t.winRate),.1),wins:t.wins,percentage:(t.appearances/v.totalGames*100).toFixed(1)}))},[v]);return j?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):C?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",C]}):v?g.length===0?e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de carte disponible"}),e.jsx("p",{children:"Aucune statistique de carte n'est disponible pour ce joueur."})]}):e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Carte"}),e.jsx(I,{title:"Performance par Carte",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(K,{data:g,margin:{top:20,right:140,left:20,bottom:20},children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(M,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(Y,{y:50,stroke:"var(--text-secondary)",strokeDasharray:"5 5",strokeOpacity:.5}),(()=>{if(g.length>0){const y=g.reduce((i,r)=>i+r.value,0),c=g.reduce((i,r)=>i+r.wins,0),t=y>0?c/y*100:0;if(t!==50)return e.jsx(Y,{y:t,stroke:"var(--accent-primary)",strokeDasharray:"3 3",strokeOpacity:.7,label:{value:`Moyenne: ${t.toFixed(1)}%`,position:"right",offset:5,style:{fill:"var(--accent-primary)"}}})}return null})(),e.jsx(q,{content:({active:y,payload:c})=>{if(y&&c&&c.length>0){const t=c[0].payload,i=[];return g.forEach(r=>{if(r.name!==t.name&&r.value>=5){const m=parseFloat(t.winRate)-parseFloat(r.winRate);Math.abs(m)>=2&&i.push({map:r.name,diff:m,better:m>0})}}),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:"250px"},children:[e.jsx("div",{children:e.jsx("strong",{children:t.name})}),e.jsxs("div",{children:["Parties: ",t.value]}),e.jsxs("div",{children:["Victoires: ",t.wins]}),e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("strong",{children:["Taux: ",t.winRate,"%"]})}),i.length>0&&e.jsxs("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"0.8rem",fontWeight:"bold",marginBottom:"0.25rem"},children:"Comparaisons:"}),i.map((r,m)=>e.jsxs("div",{style:{fontSize:"0.75rem",color:r.better?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[r.better?"â†—":"â†˜"," ",Math.abs(r.diff).toFixed(1),"% vs ",r.map]},m))]}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(E,{dataKey:"winRateDisplay",label:y=>{const{x:c,y:t,width:i,payload:r}=y;if(c===void 0||t===void 0||i===void 0||!r)return null;const m=r.winRate||"0";return e.jsxs("text",{x:c+i/2,y:t-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[m,"%"]})},onClick:y=>{y&&y.name&&x({selectedPlayer:l,selectedMapName:y.name,fromComponent:"Performance par Carte"})},children:g.map((y,c)=>{let t;y.name==="Village"?t="var(--accent-secondary)":y.name==="ChÃ¢teau"?t="var(--accent-tertiary)":y.name==="Autres"?t=Q:t=`var(--chart-color-${c%6+1})`;const i=Math.max(...g.map(m=>parseFloat(m.winRate))),r=parseFloat(y.winRate)===i&&i>0;return e.jsx(L,{fill:parseFloat(y.winRate)===0?`${t}30`:t,stroke:"transparent",strokeWidth:r?3:1,style:{cursor:"pointer"}},`cell-map-${c}`)})})]})})})})]})}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function Ne({selectedPlayerName:l}){const{gameData:x}=ae(),{joueursData:v}=H(),j=J(v),C=X(),g=F.useMemo(()=>{if(!x||!l)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const c={},t={},i={},r=new Set;x.forEach(b=>{const h=b.PlayerStats.find(k=>k.Username.toLowerCase()===l.toLowerCase());if(h&&(b.PlayerStats.forEach(k=>{k.KillerName?.toLowerCase()===l.toLowerCase()&&(c[k.Username]=(c[k.Username]||0)+1)}),h.KillerName&&(t[h.KillerName]=(t[h.KillerName]||0)+1),h.DeathType)){const k=h.DeathType,D=ge(k);i[D]||(i[D]={count:0,byDeathType:{}}),i[D].count+=1,i[D].byDeathType[k]=(i[D].byDeathType[k]||0)+1,r.add(k)}});const m=Object.entries(c).map(([b,h])=>({player:b,kills:h})).sort((b,h)=>h.kills-b.kills).slice(0,10),n=Object.entries(t).map(([b,h])=>({player:b,kills:h})).sort((b,h)=>h.kills-b.kills).slice(0,10),o=Object.entries(i).map(([b,h])=>{const k={deathType:b,count:h.count};return k[b]=h.count,k}).sort((b,h)=>h.count-b.count).slice(0,10),d=Object.keys(i);return{playersKilled:m,killedBy:n,deathTypes:o,availableDeathTypes:d}},[x,l]),y=F.useMemo(()=>{const c={};g.availableDeathTypes.forEach(r=>{r==="TuÃ© par Loup"?c[r]=C.Loup:r==="Mort aux votes"?c[r]="var(--chart-color-1)":r.includes("Chasseur")?c[r]=C.Chasseur:r==="TuÃ© par Zombie"?c[r]=C.Vaudou:r==="TuÃ© par potion assassin"?c[r]=C.Alchimiste:r==="TuÃ© par Vengeur"?c[r]="var(--chart-color-2)":r==="Amoureux mort"?c[r]=C.Amoureux:r==="TuÃ© par La BÃªte"?c[r]="var(--chart-color-3)":r==="TuÃ© par ShÃ©rif"&&(c[r]="var(--chart-color-4)")});const t=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let i=0;return g.availableDeathTypes.forEach(r=>{c[r]||(c[r]=t[i%t.length],i++)}),c},[g.availableDeathTypes,C]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[g.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(I,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(K,{data:g.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(M,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(q,{content:({active:c,payload:t})=>{if(c&&t&&t.length>0){const i=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:i.player})}),e.jsxs("div",{children:["TuÃ© ",i.kills," fois par ",l]})]})}return null}}),e.jsx(E,{dataKey:"kills",children:g.playersKilled.map((c,t)=>e.jsx(L,{fill:j[c.player]||"var(--chart-color-3)"},`cell-killed-${t}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[l," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),g.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(I,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(K,{data:g.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(M,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(q,{content:({active:c,payload:t})=>{if(c&&t&&t.length>0){const i=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:i.player})}),e.jsxs("div",{children:["A tuÃ© ",l," ",i.kills," fois"]})]})}return null}}),e.jsx(E,{dataKey:"kills",children:g.killedBy.map((c,t)=>e.jsx(L,{fill:j[c.player]||"var(--chart-color-4)"},`cell-killer-${t}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[l," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),g.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(I,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(K,{data:g.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(M,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(q,{content:({active:c,payload:t})=>{if(c&&t&&t.length>0){const i=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:i.deathType})}),e.jsxs("div",{children:[l," est mort ",i.count," fois ainsi"]})]})}return null}}),g.availableDeathTypes.map(c=>e.jsx(E,{dataKey:c,name:c,stackId:"deaths",fill:y[c]||"var(--chart-color-5)"},c))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",l,"."]})]})]})}function Ee(){const{settings:l,updateSettings:x}=_(),{navigateToGameDetails:v}=B(),{data:j,isLoading:C,error:g}=te(),{joueursData:y,isLoading:c}=H(),{data:t,isLoading:i,error:r}=fe(l.highlightedPlayer),m=J(y),[n,o]=F.useState(""),[d,b]=F.useState(()=>l.useIndependentFilters&&l.independentFilters?.gameTypeEnabled?l.independentFilters.gameFilter==="modded"?"modded":"all":l.gameFilter==="modded"?"modded":"all"),[h,k]=F.useState("achievements"),[D,$]=F.useState("session"),[R,W]=F.useState("all");F.useEffect(()=>{if(l.useIndependentFilters&&l.independentFilters?.gameTypeEnabled){const a=l.independentFilters.gameFilter==="modded"?"modded":"all";b(a)}else if(!l.useIndependentFilters){const a=l.gameFilter==="modded"?"modded":"all";b(a)}},[l.gameFilter,l.useIndependentFilters,l.independentFilters?.gameTypeEnabled,l.independentFilters?.gameFilter]);const{data:s}=O(l.highlightedPlayer||""),T=F.useMemo(()=>{if(!j||!j.GameStats)return[];const a=new Map;return j.GameStats.forEach(f=>{const N=new Date(f.StartDate);f.PlayerStats.forEach(w=>{const P=U(w),Z=y?.Players?.find(ee=>ee.SteamID===P)?.Joueur||w.Username;a.has(P)||a.set(P,{games:0,wins:0,firstDate:N,lastDate:N,displayName:Z});const V=a.get(P);V.games++,w.Victorious&&V.wins++,N<V.firstDate&&(V.firstDate=N),N>V.lastDate&&(V.lastDate=N)})}),Array.from(a.entries()).map(([f,N])=>{let w=y?.Players?.find(P=>P.SteamID===f);return w||(w=y?.Players?.find(P=>P.Joueur===N.displayName)),{id:f,name:N.displayName,totalGames:N.games,totalWins:N.wins,winRate:N.games>0?N.wins/N.games*100:0,firstGameDate:N.firstDate.toLocaleDateString("fr-FR"),lastGameDate:N.lastDate.toLocaleDateString("fr-FR"),isHighlighted:N.displayName===l.highlightedPlayer,image:w?.Image||null,twitch:w?.Twitch||null,youtube:w?.Youtube||null}})},[j,l.highlightedPlayer,y]),S=F.useMemo(()=>{if(!n.trim())return T;const a=n.toLowerCase();return T.filter(f=>f.name.toLowerCase().includes(a))},[T,n]),u=F.useMemo(()=>[...S].sort((a,f)=>f.totalGames-a.totalGames),[S]),p=a=>{x({highlightedPlayer:a}),o("")};return C||c?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):g?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",g]})]}):!j||T.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!l.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:n,onChange:a=>o(a.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[S.length," joueur",S.length!==1?"s":"",n&&` (filtrÃ©${S.length!==1?"s":""} de ${T.length})`]})]})]}),e.jsx("div",{className:"player-display",children:n?S.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{className:"clear-search-btn",onClick:()=>o(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:u.map(a=>e.jsxs("button",{className:`suggestion-btn ${a.isHighlighted?"highlighted":""}`,onClick:()=>p(a.name),children:[a.image?e.jsx("img",{src:a.image,alt:a.name,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":m[a.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[a.name,a.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[a.totalGames," parties â€¢ ",a.winRate.toFixed(1),"% victoires"]})]})]},a.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',n,'"']}),e.jsx("button",{className:"clear-search-btn",onClick:()=>o(""),children:"Effacer la recherche"})]}):l.highlightedPlayer?(()=>{const a=T.find(f=>f.name===l.highlightedPlayer);return a?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:a.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[a.image?e.jsx("img",{src:a.image,alt:a.name,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":m[a.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[a.totalGames," parties â€¢ ",a.totalWins," victoires â€¢ ",a.winRate.toFixed(1),"% taux de victoire"]}),(a.twitch||a.youtube)&&e.jsxs("div",{className:"social-links",children:[a.twitch&&e.jsx("a",{href:a.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),a.youtube&&e.jsx("a",{href:a.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{className:`lycans-categorie-btn ${h==="achievements"?"active":""}`,onClick:()=>k("achievements"),children:"Classement"}),e.jsx("button",{className:`lycans-categorie-btn ${h==="evolution"?"active":""}`,onClick:()=>k("evolution"),children:"Ã‰volution"}),e.jsx("button",{className:`lycans-categorie-btn ${h==="camps"?"active":""}`,onClick:()=>k("camps"),children:"Camps"}),e.jsx("button",{className:`lycans-categorie-btn ${h==="maps"?"active":""}`,onClick:()=>k("maps"),children:"Maps"}),e.jsx("button",{className:`lycans-categorie-btn ${h==="kills"?"active":""}`,onClick:()=>k("kills"),children:"Kills"})]}),h==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[i?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):r?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",r]})}):t?e.jsx(je,{achievements:d==="all"?t.allGamesAchievements:t.moddedOnlyAchievements,title:d==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:d}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[e.jsx("button",{className:`filter-btn ${d==="all"?"active":""}`,onClick:f=>{f.stopPropagation(),b("all")},children:"Toutes les parties"}),e.jsx("button",{className:`filter-btn ${d==="modded"?"active":""}`,onClick:f=>{f.stopPropagation(),b("modded")},children:"Parties moddÃ©es"})]})]}),h==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[s&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{v({selectedPlayer:a.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${a.name}`,style:{fontSize:"1.3rem"},children:s.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem"},children:de(s.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{v({selectedPlayer:a.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${a.name}`,style:{fontSize:"1.3rem"},children:s.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem"},children:[s.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:D,onChange:f=>$(f.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:R,onChange:f=>W(f.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(ye,{selectedPlayerName:a.name,groupingMethod:D,campFilter:R})]}),h==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(be,{selectedPlayerName:a.name})}),h==="maps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Ce,{selectedPlayerName:a.name})}),h==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Ne,{selectedPlayerName:a.name})}),e.jsx("button",{className:"highlight-btn active",onClick:f=>{f.stopPropagation(),x({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[a.firstGameDate," - ",a.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',l.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{className:"clear-selection-btn",onClick:()=>x({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:u.map(a=>e.jsxs("div",{className:`character-card ${a.isHighlighted?"highlighted":""}`,onClick:()=>p(a.name),title:`${a.name} - ${a.totalGames} parties, ${a.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:a.image?e.jsx("img",{src:a.image,alt:a.name,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":m[a.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:a.name}),(a.twitch||a.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[a.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),a.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},a.id))})})})]})}export{Ee as PlayerSelectionPage};
