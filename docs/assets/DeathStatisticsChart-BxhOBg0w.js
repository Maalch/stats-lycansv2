import{g as he,e as ge,a as te,b as ae,r as L,j as e,p as ne,i as ve,m as xe}from"./index-C3cx5WFR.js";import{g as oe,u as fe,a as je,b as Se,c as Pe}from"./useDeathStatisticsFromRaw-B9WNgL00.js";import{u as me}from"./baseStatsHook-DHtWDvgR.js";import{g as ee,a as ie,D as F}from"./datasyncExport-BirWLS1z.js";import{M as ue,C as ye,u as re,m as le,b as pe,a as be}from"./api-mW7TMECJ.js";import{D as V,g as de}from"./deathTypes-gHH1w6_X.js";import{F as G,C as q,X as $,Y as U,a as X}from"./FullscreenChart-BnCLcW1M.js";import{u as se}from"./useJoueursData-Bxzv3twc.js";import{R as O,T as _}from"./CategoricalChart-DID_l0H8.js";import{B as J,a as Y}from"./BarChart-BPpOi2Ch.js";function ce(r){if(!r||r.trim()==="")return null;const s=r.trim().slice(1),u=parseInt(s,10);return isNaN(u)||u<1?null:u}function De(r,h){if(r.length===0)return null;const s={},u={};r.forEach(p=>{let o=1;if(p.EndTiming){const m=ce(p.EndTiming);m&&(o=m)}p.PlayerStats.forEach(m=>{if(h&&h!=="Tous les camps"&&ee(m.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})!==h)return;const c=m.Username;s[c]||(s[c]={playerName:c,totalGames:0,survivalsByDay:{},survivalRatesByDay:{},gamesPlayedByDay:{}});const K=s[c];K.totalGames++;let N=null;m.DeathTiming&&(N=ce(m.DeathTiming));for(let f=1;f<=o;f++)K.gamesPlayedByDay[f]||(K.gamesPlayedByDay[f]=0,K.survivalsByDay[f]=0),u[f]||(u[f]={gamesReachingDay:0,playersOnDay:0,survivorsOnDay:0}),K.gamesPlayedByDay[f]++,u[f].playersOnDay++,(!N||N>f)&&(K.survivalsByDay[f]++,u[f].survivorsOnDay++)});for(let m=1;m<=o;m++)u[m]||(u[m]={gamesReachingDay:0,playersOnDay:0,survivorsOnDay:0}),u[m].gamesReachingDay++}),Object.values(s).forEach(p=>{Object.keys(p.gamesPlayedByDay).forEach(o=>{const m=parseInt(o),c=p.gamesPlayedByDay[m],K=p.survivalsByDay[m];c>0?p.survivalRatesByDay[m]=K/c*100:p.survivalRatesByDay[m]=0})});const d=Object.values(s).filter(p=>p.totalGames>0).sort((p,o)=>o.totalGames-p.totalGames),A=Object.entries(u).map(([p,o])=>({dayNumber:parseInt(p),totalGamesReachingDay:o.gamesReachingDay,totalPlayersOnDay:o.playersOnDay,averageSurvivalRate:o.playersOnDay>0?o.survivorsOnDay/o.playersOnDay*100:0})).sort((p,o)=>p.dayNumber-o.dayNumber);return{totalGames:r.length,totalPlayersAnalyzed:d.length,playerSurvivalStats:d,dayStats:A}}function Te(r,h,s=ue.MEDIUM){return r.playerSurvivalStats.filter(u=>u.totalGames>=s&&(u.gamesPlayedByDay[h]||0)>0).map(u=>({playerName:u.playerName,survivalRate:u.survivalRatesByDay[h]||0,gamesPlayed:u.totalGames,timesReachedDay:u.gamesPlayedByDay[h]||0,timesSurvivedDay:u.survivalsByDay[h]||0})).sort((u,d)=>d.survivalRate-u.survivalRate).slice(0,ye.TOP_15)}function Ae(r,h,s=ue.MEDIUM){return r.playerSurvivalStats.filter(u=>u.totalGames>=s&&(u.gamesPlayedByDay[h]||0)>0).map(u=>({playerName:u.playerName,survivalRate:u.survivalRatesByDay[h]||0,gamesPlayed:u.totalGames,timesReachedDay:u.gamesPlayedByDay[h]||0,timesSurvivedDay:u.survivalsByDay[h]||0})).sort((u,d)=>u.survivalRate-d.survivalRate).slice(0,ye.TOP_15)}function Ne(r){return me(h=>De(h,r))}function Be(r,h){if(h==="Tous les camps"){const s=r.filter(u=>u!==V.BULLET_HUMAN&&u!==V.BULLET_WOLF);return(r.includes(V.BULLET_HUMAN)||r.includes(V.BULLET_WOLF))&&!s.includes(V.BULLET)&&s.push(V.BULLET),s}return r}function Q(r,h){if(h==="Tous les camps"){const s=r.killsByDeathType[V.BULLET_HUMAN]||0,u=r.killsByDeathType[V.BULLET_WOLF]||0,d=r.killsByDeathType[V.BULLET]||0,A={...r.killsByDeathType};return A[V.BULLET]=s+u+d,delete A[V.BULLET_HUMAN],delete A[V.BULLET_WOLF],{...r,killsByDeathType:A}}return r}function ke(r,h="Tous les camps",s="Tous les camps"){const u=new Map;return r.forEach(d=>{d.PlayerStats.forEach(A=>{const p=he(A),o=ge(A),m=ie(A.MainRoleInitial,A.MainRoleChanges||[]),c=ee(m,{regroupVillagers:!0,regroupWolfSubRoles:!0},A.Power);if(h!=="Tous les camps"&&c!==h)return;let K=0;if(d.PlayerStats.forEach(N=>{if(N.KillerName===A.Username&&N.DeathTiming){const f=ie(N.MainRoleInitial,N.MainRoleChanges||[]),M=ee(f,{regroupVillagers:!0,regroupWolfSubRoles:!0},N.Power);s==="Tous les camps"?K++:s==="Roles solo"?M!=="Villageois"&&M!=="Loups"&&K++:M===s&&K++}}),K>0){const N=u.get(p);N?K>N.maxKills?(N.maxKills=K,N.timesAchieved=1,N.gameIds=[d.DisplayedId]):K===N.maxKills&&(N.timesAchieved++,N.gameIds.includes(d.DisplayedId)||N.gameIds.push(d.DisplayedId)):u.set(p,{playerName:o,maxKills:K,timesAchieved:1,gameIds:[d.DisplayedId]})}})}),Array.from(u.values()).sort((d,A)=>A.maxKills!==d.maxKills?A.maxKills-d.maxKills:A.timesAchieved-d.timesAchieved)}function Ke(r,h="Tous les camps",s="Tous les camps"){const u=new Map;return r.forEach(d=>{const A=new Map;d.PlayerStats.forEach(p=>{if(p.KillerName&&p.DeathTiming&&p.DeathTiming.match(/^[A-Z]\d+$/)){const o=p.KillerName,m=p.DeathTiming,c=d.PlayerStats.find(x=>x.Username===o);if(!c)return;const K=ie(c.MainRoleInitial,c.MainRoleChanges||[]),N=ee(K,{regroupVillagers:!0,regroupWolfSubRoles:!0},c.Power);if(h!=="Tous les camps"&&N!==h)return;const f=ie(p.MainRoleInitial,p.MainRoleChanges||[]),M=ee(f,{regroupVillagers:!0,regroupWolfSubRoles:!0},p.Power);let I=!1;if(s==="Tous les camps"?I=!0:s==="Roles solo"?I=M!=="Villageois"&&M!=="Loups":I=M===s,!I)return;A.has(o)||A.set(o,new Map);const b=A.get(o);b.set(m,(b.get(m)||0)+1)}}),A.forEach((p,o)=>{const m=Math.max(...Array.from(p.values())),c=d.PlayerStats.find(M=>M.Username===o);if(!c)return;const K=he(c),N=ge(c),f=u.get(K);f?m>f.maxKills?(f.maxKills=m,f.timesAchieved=1,f.gameIds=[d.DisplayedId]):m===f.maxKills&&(f.timesAchieved++,f.gameIds.includes(d.DisplayedId)||f.gameIds.push(d.DisplayedId)):u.set(K,{playerName:N,maxKills:m,timesAchieved:1,gameIds:[d.DisplayedId]})})}),Array.from(u.values()).sort((d,A)=>A.maxKills!==d.maxKills?A.maxKills-d.maxKills:A.timesAchieved-d.timesAchieved)}function Me(r,h="Tous les camps",s="Tous les camps"){return r.length===0?null:{maxKillsPerGame:ke(r,h,s),maxKillsPerPhase:Ke(r,h,s)}}function Re(r="Tous les camps",h="Tous les camps"){return me(s=>Me(s,r,h))}function He({deathStats:r,selectedCamp:h,victimCampFilter:s,minGamesForAverage:u,onMinGamesChange:d,availableDeathTypes:A,deathTypeColors:p,totalEligibleForAverage:o}){const{navigateToGameDetails:m}=te(),{settings:c}=ae(),{joueursData:K}=se(),N=re(K),{data:f}=Re(h,s),M=L.useMemo(()=>Be(A,s),[A,s]),I=L.useMemo(()=>{const t={...p};if(s==="Tous les camps"&&!t[V.BULLET]){const i=p[V.BULLET_HUMAN]||p[V.BULLET_WOLF];i&&(t[V.BULLET]=i)}return t},[p,s]),b=t=>{let i="Top Tueurs";return h!=="Tous les camps"&&(i+=` en ${h}`),s!=="Tous les camps"&&(s==="Roles solo"?i+=" (victimes: Roles solo)":i+=` (victimes: ${s})`),t==="total"?i+=" (Total)":i+=" (Moyenne par Partie)",i},x=t=>{let i=t==="game"?"Record de Kills en une Partie":"Record de Kills en une Phase";return h!=="Tous les camps"&&(i+=` (${h})`),s!=="Tous les camps"&&(s==="Roles solo"?i+=h!=="Tous les camps"?" - victimes: Roles solo":" (victimes: Roles solo)":i+=h!=="Tous les camps"?` - victimes: ${s}`:` (victimes: ${s})`),i},{totalKillsData:R,averageKillsData:g,highlightedPlayerAddedToTotal:y,highlightedPlayerAddedToAverage:B}=L.useMemo(()=>{if(!r)return{totalKillsData:[],averageKillsData:[],highlightedPlayerAddedToTotal:!1,highlightedPlayerAddedToAverage:!1};const t=r.killerStats.sort((E,P)=>P.kills-E.kills).slice(0,15),i=c.highlightedPlayer&&t.some(E=>E.killerName===c.highlightedPlayer),a=t.map(E=>{const P=Q(E,s),z={name:P.killerName,value:P.kills,victims:P.victims.length,percentage:P.percentage,gamesPlayed:P.gamesPlayed,averageKillsPerGame:P.averageKillsPerGame,isHighlightedAddition:!1};return M.forEach(C=>{z[C]=P.killsByDeathType[C]||0}),z});let v=!1;if(c.highlightedPlayer&&!i){const E=r.killerStats.find(P=>P.killerName===c.highlightedPlayer);if(E){const P=Q(E,s),z={name:P.killerName,value:P.kills,victims:P.victims.length,percentage:P.percentage,gamesPlayed:P.gamesPlayed,averageKillsPerGame:P.averageKillsPerGame,isHighlightedAddition:!0};M.forEach(C=>{z[C]=P.killsByDeathType[C]||0}),a.push(z),v=!0}}const H=r.killerStats.filter(E=>E.gamesPlayed>=u).sort((E,P)=>P.averageKillsPerGame-E.averageKillsPerGame).slice(0,15),W=c.highlightedPlayer&&H.some(E=>E.killerName===c.highlightedPlayer),T=H.map(E=>{const P=Q(E,s),z={name:P.killerName,value:P.averageKillsPerGame,victims:P.victims.length,percentage:P.percentage,gamesPlayed:P.gamesPlayed,averageKillsPerGame:P.averageKillsPerGame,isHighlightedAddition:!1};return M.forEach(C=>{const Z=P.killsByDeathType[C]||0;z[C]=P.gamesPlayed>0?Z/P.gamesPlayed:0}),z});let w=!1;if(c.highlightedPlayer&&!W){const E=r.killerStats.find(P=>P.killerName===c.highlightedPlayer);if(E){const P=Q(E,s),z={name:P.killerName,value:P.averageKillsPerGame,victims:P.victims.length,percentage:P.percentage,gamesPlayed:P.gamesPlayed,averageKillsPerGame:P.averageKillsPerGame,isHighlightedAddition:!0};M.forEach(C=>{const Z=P.killsByDeathType[C]||0;z[C]=P.gamesPlayed>0?Z/P.gamesPlayed:0}),T.push(z),w=!0}}return{totalKillsData:a,averageKillsData:T,highlightedPlayerAddedToTotal:v,highlightedPlayerAddedToAverage:w}},[r,c.highlightedPlayer,u,M,s]),j=({active:t,payload:i,label:a})=>{if(t&&i&&i.length){const v=i[0].payload,n=v.isHighlightedAddition,H=c.highlightedPlayer===v.name,W=M.reduce((T,w)=>T+(v[w]||0),0);return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:H?"var(--accent-primary)":"var(--text-primary)"},children:[a,n&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Victimes totales:"})," ",W]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouÃ©es:"})," ",v.gamesPlayed]}),e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"RÃ©partition par type de kill:"}),M.map(T=>({deathType:T,count:v[T]||0})).filter(T=>T.count>0).sort((T,w)=>w.count-T.count).map(({deathType:T,count:w})=>e.jsxs("p",{style:{color:I[T],margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[oe(T),":"]})," ",w]},T))]}),n&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"}),H&&!n&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},l=({active:t,payload:i,label:a})=>{if(t&&i&&i.length){const v=i[0].payload,n=v.isHighlightedAddition,H=c.highlightedPlayer===v.name,W=v.gamesPlayed>=u,T=r?.killerStats.find(z=>z.killerName===v.name),w=T?Q(T,s):null,E=M.reduce((z,C)=>z+(v[C]||0),0),P=w?w.kills:Math.round(E*v.gamesPlayed);return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:H?"var(--accent-primary)":"var(--text-primary)"},children:[a,n&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Moyenne par partie:"})," ",E.toFixed(2)," (",P," kills /",v.gamesPlayed," games)"]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouÃ©es:"})," ",v.gamesPlayed]}),e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"RÃ©partition par type de kill (moyenne):"}),M.map(z=>({deathType:z,avgCount:v[z]||0,totalKillsForDeathType:w?w.killsByDeathType[z]||0:Math.round((v[z]||0)*v.gamesPlayed)})).filter(z=>z.avgCount>0).sort((z,C)=>C.avgCount-z.avgCount).map(({deathType:z,avgCount:C,totalKillsForDeathType:Z})=>e.jsxs("p",{style:{color:I[z],margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[oe(z),":"]})," ",C.toFixed(2)," (",Z," kills /",v.gamesPlayed," games)"]},z))]}),n&&!W&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",u," parties)"]}),n&&W&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"}),H&&!n&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},S=L.useMemo(()=>{if(!f)return[];const t=f.maxKillsPerGame.slice(0,15),i=c.highlightedPlayer&&t.some(a=>a.playerName===c.highlightedPlayer);if(c.highlightedPlayer&&!i){const a=f.maxKillsPerGame.find(v=>v.playerName===c.highlightedPlayer);a&&t.push({...a})}return t.map((a,v)=>({name:a.playerName,value:a.maxKills,timesAchieved:a.timesAchieved,gameIds:a.gameIds,isHighlightedAddition:v>=15}))},[f,c.highlightedPlayer]),k=L.useMemo(()=>{if(!f)return[];const t=f.maxKillsPerPhase.slice(0,15),i=c.highlightedPlayer&&t.some(a=>a.playerName===c.highlightedPlayer);if(c.highlightedPlayer&&!i){const a=f.maxKillsPerPhase.find(v=>v.playerName===c.highlightedPlayer);a&&t.push({...a})}return t.map((a,v)=>({name:a.playerName,value:a.maxKills,timesAchieved:a.timesAchieved,gameIds:a.gameIds,isHighlightedAddition:v>=15}))},[f,c.highlightedPlayer]),D=({active:t,payload:i,label:a,chartType:v})=>{if(t&&i&&i.length){const n=i[0].payload,H=c.highlightedPlayer===n.name,W=n.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:H?"var(--accent-primary)":"var(--text-primary)"},children:[a,W&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsxs("strong",{children:[v==="game"?"Max kills en une partie":"Max kills en une phase",":"]})," ",n.value]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Nombre de fois:"})," ",n.timesAchieved]}),e.jsxs("p",{style:{color:"var(--text-secondary)",margin:"4px 0",fontSize:"0.8rem"},children:[n.gameIds.length," partie",n.gameIds.length>1?"s":""," concernÃ©e",n.gameIds.length>1?"s":""]}),W&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"}),H&&!W&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null};return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:b("total")}),y&&c.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',c.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(G,{title:b("total"),children:e.jsx("div",{style:{height:440},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(J,{data:R,margin:{top:60,right:30,left:20,bottom:10},children:[e.jsx(q,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:i,payload:a})=>e.jsx("text",{x:t,y:i,dy:10,fill:c.highlightedPlayer===a.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:c.highlightedPlayer===a.value?14:12,fontWeight:c.highlightedPlayer===a.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${t} ${i})`,children:a.value})}),e.jsx(U,{label:{value:"Nombre total de victimes",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(_,{content:e.jsx(j,{})}),M.map(t=>e.jsx(Y,{dataKey:t,name:t,stackId:"kills",fill:I[t],onClick:i=>{const a={selectedPlayer:i?.name,fromComponent:"Statistiques de Mort"};h!=="Tous les camps"&&(a.campFilter={selectedCamp:h,campFilterMode:"all-assignments"}),m(a)}},t))]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,R.filter(t=>!t.isHighlightedAddition).length)," des tueurs les plus actifs (total)"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:b("average")}),B&&c.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',c.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"min-games-average-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-average-select",value:u,onChange:t=>d(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:le.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx(G,{title:b("average"),children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(J,{data:g,margin:{top:20,right:30,left:20,bottom:10},children:[e.jsx(q,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:i,payload:a})=>e.jsx("text",{x:t,y:i,dy:10,fill:c.highlightedPlayer===a.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:c.highlightedPlayer===a.value?14:12,fontWeight:c.highlightedPlayer===a.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${t} ${i})`,children:a.value})}),e.jsx(U,{label:{value:"Moyenne de victimes par partie",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(_,{content:e.jsx(l,{})}),M.map(t=>e.jsx(Y,{dataKey:t,name:t,stackId:"averageKills",fill:I[t],onClick:i=>{const a={selectedPlayer:i?.name,fromComponent:"Statistiques de Mort"};h!=="Tous les camps"&&(a.campFilter={selectedCamp:h,campFilterMode:"all-assignments"}),m(a)}},t))]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,g.filter(t=>!t.isHighlightedAddition).length)," des tueurs les plus efficaces (sur ",o," ayant au moins ",u," partie",u>1?"s":"",")"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:x("game")}),S.some(t=>t.isHighlightedAddition)&&c.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',c.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(G,{title:x("game"),children:e.jsx("div",{style:{height:440},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(J,{data:S,margin:{top:60,right:30,left:20,bottom:10},children:[e.jsx(q,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:i,payload:a})=>e.jsx("text",{x:t,y:i,dy:10,fill:c.highlightedPlayer===a.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:c.highlightedPlayer===a.value?14:12,fontWeight:c.highlightedPlayer===a.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${t} ${i})`,children:a.value})}),e.jsx(U,{label:{value:"Nombre max de kills en une partie",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(_,{content:t=>e.jsx(D,{...t,chartType:"game"})}),e.jsx(Y,{dataKey:"value",children:S.map((t,i)=>{const a=c.highlightedPlayer===t.name,v=t.isHighlightedAddition;return e.jsx(X,{fill:N[t.name]||(a?"var(--accent-primary)":v?"var(--accent-secondary)":"var(--chart-primary)"),stroke:a?"var(--accent-primary)":"none",strokeWidth:a?3:0,strokeDasharray:v?"5,5":"none",opacity:v?.8:1,onClick:()=>{if(t?.gameIds&&t.gameIds.length>0){const n={fromComponent:"Statistiques de Mort - Max Kills par Partie"};t.gameIds.length===1?n.selectedGame=t.gameIds[0]:n.selectedGameIds=t.gameIds,h!=="Tous les camps"&&(n.campFilter={selectedCamp:h,campFilterMode:"all-assignments"}),m(n)}},style:{cursor:"pointer"}},`cell-${i}`)})})]})})})}),e.jsx("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:h!=="Tous les camps"||s!=="Tous les camps"?"Nombre maximum de kills rÃ©alisÃ©s en une seule partie (avec filtres appliquÃ©s)":"Nombre maximum de kills rÃ©alisÃ©s en une seule partie"})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:x("phase")}),k.some(t=>t.isHighlightedAddition)&&c.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',c.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(G,{title:x("phase"),children:e.jsx("div",{style:{height:440},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(J,{data:k,margin:{top:60,right:30,left:20,bottom:10},children:[e.jsx(q,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:i,payload:a})=>e.jsx("text",{x:t,y:i,dy:10,fill:c.highlightedPlayer===a.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:c.highlightedPlayer===a.value?14:12,fontWeight:c.highlightedPlayer===a.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${t} ${i})`,children:a.value})}),e.jsx(U,{label:{value:"Nombre max de kills en une phase",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(_,{content:t=>e.jsx(D,{...t,chartType:"phase"})}),e.jsx(Y,{dataKey:"value",children:k.map((t,i)=>{const a=c.highlightedPlayer===t.name,v=t.isHighlightedAddition;return e.jsx(X,{fill:N[t.name]||(a?"var(--accent-primary)":v?"var(--accent-secondary)":"var(--chart-secondary)"),stroke:a?"var(--accent-primary)":"none",strokeWidth:a?3:0,strokeDasharray:v?"5,5":"none",opacity:v?.8:1,onClick:()=>{if(t?.gameIds&&t.gameIds.length>0){const n={fromComponent:"Statistiques de Mort - Max Kills par Phase"};t.gameIds.length===1?n.selectedGame=t.gameIds[0]:n.selectedGameIds=t.gameIds,h!=="Tous les camps"&&(n.campFilter={selectedCamp:h,campFilterMode:"all-assignments"}),m(n)}},style:{cursor:"pointer"}},`cell-${i}`)})})]})})})}),e.jsx("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:h!=="Tous les camps"||s!=="Tous les camps"?"Nombre maximum de kills rÃ©alisÃ©s en une seule phase avec filtres appliquÃ©s":"Nombre maximum de kills rÃ©alisÃ©s en une seule phase"}),e.jsx("p",{style:{fontSize:"0.75rem",color:"var(--text-tertiary)",textAlign:"center",marginTop:"0.25rem",fontStyle:"italic"},children:"Une phase est une sÃ©quence de jeu : Jour (J1), Nuit (N1), Meeting (M1), etc."})]})]})}function ze({deathStats:r,selectedCamp:h,minGamesForAverage:s,onMinGamesChange:u,availableDeathTypes:d,deathTypeColors:A}){const{navigateToGameDetails:p}=te(),{settings:o}=ae(),{joueursData:m}=se(),c=re(m),[K,N]=L.useState(null),{totalDeathsData:f,survivalRateData:M,highlightedPlayerAddedToDeaths:I,highlightedPlayerAddedToSurvival:b}=L.useMemo(()=>{if(!r)return{totalDeathsData:[],survivalRateData:[],highlightedPlayerAddedToDeaths:!1,highlightedPlayerAddedToSurvival:!1};const g=r.playerDeathStats.sort((i,a)=>a.totalDeaths-i.totalDeaths).slice(0,15),y=o.highlightedPlayer&&g.some(i=>i.playerName===o.highlightedPlayer),B=g.map(i=>{const a=i.gamesPlayed,v=a>0?(a-i.totalDeaths)/a*100:0,n={name:i.playerName,value:i.totalDeaths,totalDeaths:i.totalDeaths,gamesPlayed:a,deathRate:i.deathRate,survivalRate:v,isHighlightedAddition:!1};return d.forEach(H=>{n[H]=i.deathsByType[H]||0}),n});let j=!1;if(o.highlightedPlayer&&!y){const i=r.playerDeathStats.find(a=>a.playerName===o.highlightedPlayer);if(i){const a=i.gamesPlayed,v=a>0?(a-i.totalDeaths)/a*100:0,n={name:i.playerName,value:i.totalDeaths,totalDeaths:i.totalDeaths,gamesPlayed:a,deathRate:i.deathRate,survivalRate:v,isHighlightedAddition:!0};d.forEach(H=>{n[H]=i.deathsByType[H]||0}),B.push(n),j=!0}}const S=r.playerDeathStats.filter(i=>i.gamesPlayed>=s).map(i=>({...i,survivalRate:i.gamesPlayed>0?(i.gamesPlayed-i.totalDeaths)/i.gamesPlayed*100:0})).sort((i,a)=>a.survivalRate-i.survivalRate).slice(0,15),k=o.highlightedPlayer&&S.some(i=>i.playerName===o.highlightedPlayer),D=S.map(i=>{const a={name:i.playerName,value:i.survivalRate,totalDeaths:i.totalDeaths,gamesPlayed:i.gamesPlayed,deathRate:i.deathRate,survivalRate:i.survivalRate,isHighlightedAddition:!1};return d.forEach(v=>{a[v]=i.deathsByType[v]||0}),a});let t=!1;if(o.highlightedPlayer&&!k){const i=r.playerDeathStats.find(a=>a.playerName===o.highlightedPlayer);if(i){const a=i.gamesPlayed>0?(i.gamesPlayed-i.totalDeaths)/i.gamesPlayed*100:0,v={name:i.playerName,value:a,totalDeaths:i.totalDeaths,gamesPlayed:i.gamesPlayed,deathRate:i.deathRate,survivalRate:a,isHighlightedAddition:!0};d.forEach(n=>{v[n]=i.deathsByType[n]||0}),D.push(v),t=!0}}return{totalDeathsData:B,survivalRateData:D,highlightedPlayerAddedToDeaths:j,highlightedPlayerAddedToSurvival:t}},[r,o.highlightedPlayer,s,d]),x=({active:g,payload:y,label:B})=>{if(g&&y&&y.length){const j=y[0].payload,l=j.isHighlightedAddition,S=o.highlightedPlayer===j.name,k=d.reduce((D,t)=>D+(j[t]||0),0);return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:S?"var(--accent-primary)":"var(--text-primary)"},children:[B,l&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Morts totales:"})," ",k]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouÃ©es:"})," ",j.gamesPlayed]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Taux de survie:"})," ",j.survivalRate.toFixed(1),"%"]}),e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"RÃ©partition par type de mort:"}),d.map(D=>{const t=j[D]||0;return t===0?null:e.jsxs("p",{style:{color:A[D],margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[de(D),":"]})," ",t]},D)})]}),l&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"}),S&&!l&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},R=({active:g,payload:y,label:B})=>{if(g&&y&&y.length){const j=y[0].payload,l=j.isHighlightedAddition,S=o.highlightedPlayer===j.name,k=j.gamesPlayed>=s;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:S?"var(--accent-primary)":"var(--text-primary)"},children:[B,l&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Taux de survie:"})," ",j.survivalRate.toFixed(1),"% (",j.gamesPlayed-j.totalDeaths," survies / ",j.gamesPlayed," parties)"]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Morts totales:"})," ",j.totalDeaths]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouÃ©es:"})," ",j.gamesPlayed]}),e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"RÃ©partition par type de mort:"}),d.map(D=>{const t=j[D]||0;return t===0?null:e.jsxs("p",{style:{color:A[D],margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[de(D),":"]})," ",t]},D)})]}),l&&!k&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",s," parties)"]}),l&&k&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"}),S&&!l&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null};return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:h==="Tous les camps"?"Morts (Total)":`Morts en ${h} (Total)`}),I&&o.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',o.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(G,{title:h==="Tous les camps"?"Morts (Total)":`Morts en ${h} (Total)`,children:e.jsx("div",{style:{height:440},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(J,{data:f,margin:{top:60,right:30,left:20,bottom:10},children:[e.jsx(q,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:g,y,payload:B})=>e.jsx("text",{x:g,y,dy:10,fill:o.highlightedPlayer===B.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:o.highlightedPlayer===B.value?14:12,fontWeight:o.highlightedPlayer===B.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${g} ${y})`,children:B.value})}),e.jsx(U,{label:{value:"Nombre total de morts",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(_,{content:e.jsx(x,{})}),d.map(g=>e.jsx(Y,{dataKey:g,name:g,stackId:"deaths",fill:A[g],onClick:y=>{const B={selectedPlayer:y?.name,fromComponent:"Statistiques de Mort"};h!=="Tous les camps"&&(B.campFilter={selectedCamp:h,campFilterMode:"all-assignments"}),p(B)}},g))]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,f.filter(g=>!g.isHighlightedAddition).length)," des joueurs les plus souvent morts"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsxs("h3",{children:["Meilleurs Survivants ",h==="Tous les camps"?"(Total)":` en ${h}`]}),b&&o.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',o.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"min-games-survival-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-survival-select",value:s,onChange:g=>u(Number(g.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:le.map(g=>e.jsx("option",{value:g,children:g},g))})]}),e.jsx(G,{title:"Meilleurs Survivants",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(J,{data:M,margin:{top:20,right:30,left:20,bottom:10},children:[e.jsx(q,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:g,y,payload:B})=>e.jsx("text",{x:g,y,dy:10,fill:o.highlightedPlayer===B.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:o.highlightedPlayer===B.value?14:12,fontWeight:o.highlightedPlayer===B.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${g} ${y})`,children:B.value})}),e.jsx(U,{label:{value:"Taux de survie (%)",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(_,{content:e.jsx(R,{})}),e.jsx(Y,{dataKey:"value",onClick:g=>{const y={selectedPlayer:g?.name,fromComponent:"Statistiques de Mort"};h!=="Tous les camps"&&(y.campFilter={selectedCamp:h,campFilterMode:"all-assignments"}),p(y)},onMouseEnter:g=>N(g?.name||null),onMouseLeave:()=>N(null),style:{cursor:"pointer"},children:M.map((g,y)=>{const B=o.highlightedPlayer===g.name,j=g.isHighlightedAddition;return e.jsx(X,{fill:c[g.name]||"var(--chart-primary)",stroke:B?"var(--accent-primary)":K===g.name?"var(--text-primary)":"none",strokeWidth:B?3:K===g.name?2:0,strokeDasharray:j?"5,5":"none",opacity:j?.8:1},`cell-${y}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,M.filter(g=>!g.isHighlightedAddition).length)," des joueurs avec le plus haut taux de survie (ayant au moins ",s," partie",s>1?"s":"",")"]})]})]})}function Le({hunterStats:r,isLoading:h,error:s}){const{navigateToGameDetails:u}=te(),{settings:d}=ae(),A=pe(),{joueursData:p}=se(),o=re(p),[m,c]=L.useState(null);if(h)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques chasseurs..."});if(s)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",s]});if(!r||r.hunterStats.length===0)return e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e Chasseur"}),e.jsx("p",{children:"Aucune statistique de chasseur disponible avec les filtres actuels."})]});const{finalBestHuntersData:K,highlightedPlayerAddedToBest:N,finalBadHuntersData:f,highlightedPlayerAddedToBad:M}=(()=>{const R=r.hunterStats.filter(t=>t.gamesPlayedAsHunter>=5).sort((t,i)=>i.averageNonVillageoisKillsPerGame-t.averageNonVillageoisKillsPerGame).slice(0,15),g=d.highlightedPlayer&&R.some(t=>t.hunterName===d.highlightedPlayer);let y=[...R],B=!1;if(d.highlightedPlayer&&!g){const t=r.hunterStats.find(i=>i.hunterName===d.highlightedPlayer);t&&(y.push({...t,isHighlightedAddition:!0}),B=!0)}const j=r.hunterStats.filter(t=>t.gamesPlayedAsHunter>=5).map(t=>({name:t.hunterName,averageVillageoisKills:Number((t.villageoisKills/t.gamesPlayedAsHunter).toFixed(2)),totalVillageoisKills:t.villageoisKills,totalNonVillageoisKills:t.nonVillageoisKills,totalKills:t.totalKills,gamesPlayed:t.gamesPlayedAsHunter,victimsByCamp:t.victimsByCamp,goodVictimsByCamp:t.goodVictimsByCamp,badVictimsByCamp:t.badVictimsByCamp,hunterName:t.hunterName})),l=j.sort((t,i)=>i.averageVillageoisKills-t.averageVillageoisKills).slice(0,15),S=d.highlightedPlayer&&l.some(t=>t.hunterName===d.highlightedPlayer);let k=[...l],D=!1;if(d.highlightedPlayer&&!S){const t=j.find(i=>i.hunterName===d.highlightedPlayer);t&&(k.push({...t,isHighlightedAddition:!0}),D=!0)}return{finalBestHuntersData:y,highlightedPlayerAddedToBest:B,finalBadHuntersData:k,highlightedPlayerAddedToBad:D}})(),I=({active:x,payload:R,label:g})=>{if(x&&R&&R.length){const y=R[0].payload,B=y.isHighlightedAddition,j=d.highlightedPlayer===y.hunterName;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:j?"var(--accent-primary)":"var(--text-primary)"},children:[g,B&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Kills non-Villageois/partie:"})," ",y.averageNonVillageoisKillsPerGame.toFixed(2)]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Total non-Villageois tuÃ©s:"})," ",y.nonVillageoisKills]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties en Chasseur:"})," ",y.gamesPlayedAsHunter]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Total kills:"})," ",y.totalKills]}),y.goodVictimsByCamp&&Object.keys(y.goodVictimsByCamp).length>0&&e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"Bonnes victimes:"}),Object.entries(y.goodVictimsByCamp).map(([l,S])=>e.jsxs("p",{style:{color:A[l]||"var(--text-secondary)",margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[l,":"]})," ",S]},l))]}),B&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"}),j&&!B&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},b=({active:x,payload:R,label:g})=>{if(x&&R&&R.length){const y=R[0].payload,B=y.isHighlightedAddition,j=d.highlightedPlayer===y.hunterName;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:j?"var(--accent-primary)":"var(--text-primary)"},children:[g,B&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Villageois tuÃ©s/partie:"})," ",y.averageVillageoisKills]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Total Villageois tuÃ©s:"})," ",y.totalVillageoisKills]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Total non-Villageois tuÃ©s:"})," ",y.totalNonVillageoisKills]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties en Chasseur:"})," ",y.gamesPlayed]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Total kills:"})," ",y.totalKills]}),y.badVictimsByCamp&&Object.keys(y.badVictimsByCamp).length>0&&e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"Mauvaises victimes:"}),Object.entries(y.badVictimsByCamp).map(([l,S])=>e.jsxs("p",{style:{color:A[l]||"var(--text-secondary)",margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[l,":"]})," ",S]},l))]}),B&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"}),j&&!B&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null};return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Bons Chasseurs"}),N&&d.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',d.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(G,{title:"Bons Chasseurs",children:e.jsx("div",{style:{height:440},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(J,{data:K,margin:{top:60,right:30,left:20,bottom:10},children:[e.jsx(q,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"hunterName",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x,y:R,payload:g})=>e.jsx("text",{x,y:R,dy:10,fill:d.highlightedPlayer===g.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:d.highlightedPlayer===g.value?14:12,fontWeight:d.highlightedPlayer===g.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${x} ${R})`,children:g.value})}),e.jsx(U,{label:{value:"Moyenne kills non-Villageois/partie",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(_,{content:e.jsx(I,{})}),e.jsx(Y,{dataKey:"averageNonVillageoisKillsPerGame",fill:"var(--chart-primary)",onClick:x=>{x?.hunterName&&u({selectedPlayer:x.hunterName,campFilter:{selectedCamp:"Chasseur",campFilterMode:"all-assignments"},fromComponent:"Statistiques de Mort - Bons Chasseurs"})},onMouseEnter:x=>c(x?.hunterName||null),onMouseLeave:()=>c(null),style:{cursor:"pointer"},children:K.map((x,R)=>{const g=d.highlightedPlayer===x.hunterName,y=x.isHighlightedAddition;return e.jsx(X,{fill:o[x.hunterName]||A.Chasseur||"#8884d8",stroke:g?"var(--accent-primary)":m===x.hunterName?"var(--text-primary)":"none",strokeWidth:g?3:m===x.hunterName?2:0,strokeDasharray:y?"5,5":"none",opacity:y?.8:1},`cell-${R}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,K.filter(x=>!x.isHighlightedAddition).length)," des chasseurs les plus efficaces contre les non-Villageois (minimum 5 parties en Chasseur)"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Mauvais Chasseurs"}),M&&d.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',d.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(G,{title:"Mauvais Chasseurs",children:e.jsx("div",{style:{height:440},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(J,{data:f,margin:{top:60,right:30,left:20,bottom:10},children:[e.jsx(q,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"hunterName",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x,y:R,payload:g})=>e.jsx("text",{x,y:R,dy:10,fill:d.highlightedPlayer===g.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:d.highlightedPlayer===g.value?14:12,fontWeight:d.highlightedPlayer===g.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${x} ${R})`,children:g.value})}),e.jsx(U,{label:{value:"Moyenne Villageois tuÃ©s/partie",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(_,{content:e.jsx(b,{})}),e.jsx(Y,{dataKey:"averageVillageoisKills",fill:"var(--chart-primary)",onClick:x=>{x?.hunterName&&u({selectedPlayer:x.hunterName,campFilter:{selectedCamp:"Chasseur",campFilterMode:"all-assignments"},fromComponent:"Statistiques de Mort - Mauvais Chasseurs"})},onMouseEnter:x=>c(x?.hunterName||null),onMouseLeave:()=>c(null),style:{cursor:"pointer"},children:f.map((x,R)=>{const g=d.highlightedPlayer===x.hunterName,y=x.isHighlightedAddition;return e.jsx(X,{fill:o[x.hunterName]||A.Chasseur||"#8884d8",stroke:g?"var(--accent-primary)":m===x.hunterName?"var(--text-primary)":"none",strokeWidth:g?3:m===x.hunterName?2:0,strokeDasharray:y?"5,5":"none",opacity:y?.8:1},`cell-${R}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,f.filter(x=>!x.isHighlightedAddition).length)," des chasseurs ayant le plus tuÃ© de Villageois (minimum 5 parties en Chasseur)"]})]})]})}function Ee({survivalStats:r,selectedCamp:h,minGamesForAverage:s,onMinGamesChange:u,isLoading:d,error:A}){const{navigateToGameDetails:p}=te(),{settings:o}=ae(),{joueursData:m}=se(),c=re(m),[K,N]=L.useState(be.DEFAULT_SELECTED_DAY),[f,M]=L.useState(null),I=L.useMemo(()=>r?r.dayStats.filter(S=>S.totalGamesReachingDay>0).map(S=>S.dayNumber).sort((S,k)=>S-k):[],[r]),b=L.useMemo(()=>I.includes(K)?K:I.length>0?I[0]:1,[K,I]),{highestSurvivalData:x,highlightedPlayerAddedToHighest:R}=L.useMemo(()=>{if(!r)return{highestSurvivalData:[],highlightedPlayerAddedToHighest:!1};const l=Te(r,b,s),S=o.highlightedPlayer&&l.some(t=>t.playerName===o.highlightedPlayer),k=l.map(t=>({name:t.playerName,value:t.survivalRate,gamesPlayed:t.gamesPlayed,timesReachedDay:t.timesReachedDay,timesSurvivedDay:t.timesSurvivedDay,isHighlightedAddition:!1}));let D=!1;if(o.highlightedPlayer&&!S){const t=r.playerSurvivalStats.find(i=>i.playerName===o.highlightedPlayer);if(t&&t.totalGames>=s&&(t.gamesPlayedByDay[b]||0)>0){const i=t.survivalRatesByDay[b]||0;k.push({name:o.highlightedPlayer,value:i,gamesPlayed:t.totalGames,timesReachedDay:t.gamesPlayedByDay[b]||0,timesSurvivedDay:t.survivalsByDay[b]||0,isHighlightedAddition:!0}),D=!0}}return{highestSurvivalData:k,highlightedPlayerAddedToHighest:D}},[r,b,s,o.highlightedPlayer]),{lowestSurvivalData:g,highlightedPlayerAddedToLowest:y}=L.useMemo(()=>{if(!r)return{lowestSurvivalData:[],highlightedPlayerAddedToLowest:!1};const l=Ae(r,b,s),S=o.highlightedPlayer&&l.some(t=>t.playerName===o.highlightedPlayer),k=l.map(t=>({name:t.playerName,value:t.survivalRate,gamesPlayed:t.gamesPlayed,timesReachedDay:t.timesReachedDay,timesSurvivedDay:t.timesSurvivedDay,isHighlightedAddition:!1}));let D=!1;if(o.highlightedPlayer&&!S){const t=r.playerSurvivalStats.find(i=>i.playerName===o.highlightedPlayer);if(t&&t.totalGames>=s&&(t.gamesPlayedByDay[b]||0)>0){const i=t.survivalRatesByDay[b]||0;k.push({name:o.highlightedPlayer,value:i,gamesPlayed:t.totalGames,timesReachedDay:t.gamesPlayedByDay[b]||0,timesSurvivedDay:t.survivalsByDay[b]||0,isHighlightedAddition:!0}),D=!0}}return{lowestSurvivalData:k,highlightedPlayerAddedToLowest:D}},[r,b,s,o.highlightedPlayer]),B=l=>{p({selectedPlayer:l,fromComponent:"Statistiques de Survie"})},j=({active:l,payload:S,label:k})=>{if(l&&S&&S.length>0){const D=S[0].payload,t=D.isHighlightedAddition,i=o.highlightedPlayer===D.name,a=D.gamesPlayed>=s,v=D.timesReachedDay-D.timesSurvivedDay;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:k})}),e.jsx("div",{children:e.jsxs("span",{style:{color:"var(--accent-primary)"},children:["Taux de survie Jour ",b,": ",D.value.toFixed(1),"%"]})}),e.jsxs("div",{children:["Parties atteignant le Jour ",b,": ",D.timesReachedDay]}),e.jsxs("div",{children:["A survÃ©cu au Jour ",b,": ",D.timesSurvivedDay]}),e.jsxs("div",{children:["N'a pas survÃ©cu au Jour ",b,": ",v]}),e.jsxs("div",{children:["Total de parties: ",D.gamesPlayed]}),t&&!a&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",s," parties au total)"]}),t&&a&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"}),i&&!t&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null};return d?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de survie..."}):A?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",A]}):r?e.jsxs("div",{className:"lycans-survival-stats",children:[e.jsxs("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:[e.jsx("p",{children:`Un "Jour" reprÃ©sente un cycle complet composÃ© d'une phase de jour, d'une phase de nuit, et d'une rÃ©union. Par exemple, le Jour 2 signifie que le joueur a survÃ©cu au deuxiÃ¨me cycle jour/nuit/rÃ©union.`}),e.jsxs("p",{children:["Les statistiques de survie montrent le pourcentage de fois qu'un joueur survit au Jour ",b," parmi toutes les parties qu'il a jouÃ©es et qui ont atteint ce jour. ",R||y?"Les joueurs mis en Ã©vidence apparaissent mÃªme s'ils ne sont pas dans le top 15.":""]})]}),e.jsx("div",{className:"lycans-graphique-controles",style:{marginBottom:"1.5rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"day-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Jour :"}),e.jsx("select",{id:"day-select",value:b,onChange:l=>N(parseInt(l.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"80px"},children:I.map(l=>e.jsx("option",{value:l,children:l},l))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"min-games-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Min. parties :"}),e.jsx("select",{id:"min-games-select",value:s,onChange:l=>u(parseInt(l.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"80px"},children:le.map(l=>e.jsx("option",{value:l,children:l},l))})]})]})}),b&&r.dayStats.find(l=>l.dayNumber===b)&&e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:b===1?"Total des parties enregistrÃ©es":`Parties atteignant le Jour ${b}`}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary-text)"},children:r.dayStats.find(l=>l.dayNumber===b)?.totalGamesReachingDay||0})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsxs("h3",{children:["Taux de survie moyen Jour ",b]}),e.jsxs("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)"},children:[(r.dayStats.find(l=>l.dayNumber===b)?.averageSurvivalRate||0).toFixed(1),"%"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsxs("h3",{children:["Joueurs Ã©ligibles (min. ",s," parties)"]}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-1)"},children:r.playerSurvivalStats.filter(l=>l.totalGames>=s&&(l.gamesPlayedByDay[b]||0)>0).length})]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsxs("h3",{children:["ðŸ›¡ï¸ Meilleurs Taux de Survie - Jour ",b]}),R&&o.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',o.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(G,{title:`ðŸ›¡ï¸ Meilleurs Taux de Survie - Jour ${b}`,children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(J,{data:x,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(q,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx($,{dataKey:"name",angle:-45,textAnchor:"end",height:80,tick:({x:l,y:S,payload:k})=>e.jsx("text",{x:l,y:S,dy:16,textAnchor:"end",transform:`rotate(-45, ${l}, ${S})`,fill:o.highlightedPlayer===k.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:o.highlightedPlayer===k.value?14:12,fontWeight:o.highlightedPlayer===k.value?"bold":"normal",children:k.value})}),e.jsx(U,{tickFormatter:l=>`${l.toFixed(0)}%`,tick:{fill:"var(--text-secondary)"},label:{value:"Taux de survie (%)",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(_,{content:e.jsx(j,{})}),e.jsx(Y,{dataKey:"value",name:"Taux de survie",cursor:"pointer",children:x.map((l,S)=>{const k=o.highlightedPlayer===l.name,D=f===l.name,t=l.isHighlightedAddition;return e.jsx(X,{fill:c[l.name]||"var(--chart-primary)",stroke:k?"var(--accent-primary)":D?"var(--text-primary)":"none",strokeWidth:k?3:D?2:0,strokeDasharray:t?"5,5":"none",opacity:t?.8:1,onClick:()=>B(l.name),onMouseEnter:()=>M(l.name),onMouseLeave:()=>M(null),style:{cursor:"pointer"}},`cell-highest-${S}`)})})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsxs("h3",{children:["âš°ï¸ Plus Faibles Taux de Survie - Jour ",b]}),y&&o.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',o.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(G,{title:`âš°ï¸ Plus Faibles Taux de Survie - Jour ${b}`,children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(J,{data:g,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(q,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx($,{dataKey:"name",angle:-45,textAnchor:"end",height:80,tick:({x:l,y:S,payload:k})=>e.jsx("text",{x:l,y:S,dy:16,textAnchor:"end",transform:`rotate(-45, ${l}, ${S})`,fill:o.highlightedPlayer===k.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:o.highlightedPlayer===k.value?14:12,fontWeight:o.highlightedPlayer===k.value?"bold":"normal",children:k.value})}),e.jsx(U,{tickFormatter:l=>`${l.toFixed(0)}%`,tick:{fill:"var(--text-secondary)"},label:{value:"Taux de survie (%)",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(_,{content:e.jsx(j,{})}),e.jsx(Y,{dataKey:"value",name:"Taux de survie",cursor:"pointer",children:g.map((l,S)=>{const k=o.highlightedPlayer===l.name,D=f===l.name,t=l.isHighlightedAddition;return e.jsx(X,{fill:c[l.name]||"var(--chart-color-4)",stroke:k?"var(--accent-primary)":D?"var(--text-primary)":"none",strokeWidth:k?3:D?2:0,strokeDasharray:t?"5,5":"none",opacity:t?.8:1,onClick:()=>B(l.name),onMouseEnter:()=>M(l.name),onMouseLeave:()=>M(null),style:{cursor:"pointer"}},`cell-lowest-${S}`)})})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de survie disponible"})}function Oe(){const{navigationState:r,updateNavigationState:h}=te(),[s,u]=L.useState(r.deathStatisticsState?.selectedCamp||r.deathStatsSelectedCamp||"Tous les camps"),[d,A]=L.useState(r.deathStatisticsState?.victimCampFilter||"Tous les camps"),[p,o]=L.useState(r.deathStatisticsState?.minGamesForAverage||25),[m,c]=L.useState(()=>{const n=ne();if(n.deathStatsView&&["killers","deaths","hunter","survival"].includes(n.deathStatsView))return n.deathStatsView;const H=r.deathStatisticsState?.selectedView;return H&&H!=="location"?H:"killers"}),{data:K}=fe(),{data:N,isLoading:f,error:M}=je(s,d),{data:I,isLoading:b,error:x}=Se(),{data:R,isLoading:g,error:y}=Ne(s),{data:B}=ve(),j=pe();L.useEffect(()=>{(!r.deathStatisticsState||r.deathStatisticsState.selectedCamp!==s||r.deathStatisticsState.victimCampFilter!==d||r.deathStatisticsState.minGamesForAverage!==p||r.deathStatisticsState.selectedView!==m)&&h({deathStatisticsState:{selectedCamp:s,victimCampFilter:d,minGamesForAverage:p,selectedView:m,focusChart:r.deathStatisticsState?.focusChart}})},[s,d,p,m,r.deathStatisticsState,h]),L.useEffect(()=>{const n=()=>{const H=ne();if(H.deathStatsView&&["killers","deaths","hunter","survival"].includes(H.deathStatsView)){const W=H.deathStatsView;W!==m&&c(W)}};return window.addEventListener("popstate",n),window.addEventListener("urlchange",n),()=>{window.removeEventListener("popstate",n),window.removeEventListener("urlchange",n)}},[m]);const l=L.useMemo(()=>B?Pe(B):[],[B]),S=L.useMemo(()=>{const n={};l.forEach(T=>{T===F.BY_WOLF?n[T]=j.Loup:T===F.VOTED?n[T]="var(--chart-color-1)":T===F.BULLET||T===F.BULLET_HUMAN||T===F.BULLET_WOLF?n[T]=j.Chasseur:T===F.BY_ZOMBIE?n[T]=j.Vaudou:T===F.ASSASSIN?n[T]=j.Alchimiste:T===F.AVENGER?n[T]="var(--chart-color-2)":T===F.LOVER_DEATH?n[T]=j.Amoureux:T===F.BY_BEAST?n[T]="var(--chart-color-3)":T===F.SHERIF_SUCCESS?n[T]="var(--chart-color-4)":T===F.SMUGGLER_HUNT_KILL&&(n[T]=j.Contrebandier)});const H=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let W=0;return l.forEach(T=>{n[T]||(n[T]=H[W%H.length],W++)}),n},[l,j]),k=n=>{u(n),h({deathStatsSelectedCamp:n,deathStatisticsState:{selectedCamp:n,victimCampFilter:d,minGamesForAverage:p,selectedView:m,focusChart:r.deathStatisticsState?.focusChart}})},D=n=>{A(n),h({deathStatisticsState:{selectedCamp:s,victimCampFilter:n,minGamesForAverage:p,selectedView:m,focusChart:r.deathStatisticsState?.focusChart}})},t=n=>{o(n),h({deathStatisticsState:{selectedCamp:s,victimCampFilter:d,minGamesForAverage:n,selectedView:m,focusChart:r.deathStatisticsState?.focusChart}})},i=n=>{c(n),h({deathStatisticsState:{selectedCamp:s,victimCampFilter:d,minGamesForAverage:p,selectedView:n,focusChart:r.deathStatisticsState?.focusChart}}),xe({deathStatsView:n},"replace")},{gamesWithKillers:a,totalEligibleForAverage:v}=L.useMemo(()=>{if(!N)return{gamesWithKillers:0,totalEligibleForAverage:0};const n=N.killerStats.filter(H=>H.gamesPlayed>=p);return{gamesWithKillers:N.totalGames,totalEligibleForAverage:n.length}},[N,p]);return f?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de mort..."}):M?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",M]}):N?e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"ðŸ’€ Statistiques de Morts & Kills"}),e.jsxs("div",{className:"lycans-categories-selection",children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${m==="killers"?"active":""}`,onClick:()=>i("killers"),children:"Tueurs"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${m==="deaths"?"active":""}`,onClick:()=>i("deaths"),children:"Morts"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${m==="survival"?"active":""}`,onClick:()=>i("survival"),children:"Survie par Jour"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${m==="hunter"?"active":""}`,onClick:()=>i("hunter"),children:"Chasseur"})]}),(m==="killers"||m==="deaths"||m==="survival")&&e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select",value:s,onChange:n=>k(n.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),K?.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),m==="killers"&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"victim-camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp de la victime :"}),e.jsxs("select",{id:"victim-camp-select",value:d,onChange:n=>D(n.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loup"}),e.jsx("option",{value:"Roles solo",children:"Roles solo"})]})]})]}),(m==="killers"||m==="deaths")&&e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total des morts"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)"},children:N.totalDeaths})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Tueurs identifiÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-1)"},children:N.killerStats.length})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Nombre de parties enregistrÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary-text)"},children:a})]})]}),m==="killers"&&e.jsx(He,{deathStats:N,selectedCamp:s,victimCampFilter:d,minGamesForAverage:p,onMinGamesChange:t,availableDeathTypes:l,deathTypeColors:S,totalEligibleForAverage:v}),m==="deaths"&&e.jsx(ze,{deathStats:N,selectedCamp:s,minGamesForAverage:p,onMinGamesChange:t,availableDeathTypes:l,deathTypeColors:S}),m==="hunter"&&e.jsx(Le,{hunterStats:I,isLoading:b,error:x}),m==="survival"&&e.jsx(Ee,{survivalStats:R,selectedCamp:s,minGamesForAverage:p,onMinGamesChange:t,isLoading:g,error:y})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de mort disponible"})}export{Oe as DeathStatisticsChart};
