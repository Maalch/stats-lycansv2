import{a as L,p as J,r as S,k as ee,D as te,j as e}from"./index-BoVqtvFo.js";import{F as b,B as T,C as H,X as N,Y as k,a as D,b as A}from"./FullscreenChart-BuxzHQQC.js";import{u as ae,g as ie}from"./api-BaMZBOFq.js";import{u as re}from"./useJoueursData-BvFZ39XX.js";import{R as F,T as w}from"./CategoricalChart-qwmOh_n1.js";import{P as se,a as ne}from"./PieChart-CpPlcN85.js";import{L as le}from"./Legend-DXKpbIiQ.js";import"./PolarChart-B3fz7APQ.js";function K(){const{settings:d}=L(),[m,p]=S.useState(null),[u,f]=S.useState(null),[v,a]=S.useState(!0),[y,o]=S.useState(null);return S.useEffect(()=>{(async()=>{try{a(!0),o(null);const j=d.dataSource,R=await ee(j,te.RAW_BR_DATA);R?(p(R.BRParties?.data||[]),f(R.BRRefParties?.data||[])):(p([]),f([]))}catch(j){console.error("Error fetching raw BR data:",j),o(j instanceof Error?j.message:"Unknown error")}finally{a(!1)}})()},[d.dataSource]),{brPartiesData:m,brRefPartiesData:u,isLoading:v,error:y}}function oe(){const{settings:d}=L(),{brPartiesData:m,brRefPartiesData:p,isLoading:u,error:f}=K();return{data:m?.filter(a=>{if(!a.Game||!a.Participants)return!1;const y=p?.find(o=>o.Game===a.Game);if(!y)return q(a,d);if(d.independentFilters){const o=d.independentFilters;if(o.gameTypeEnabled&&o.gameFilter!=="all"){if(o.gameFilter==="modded"){if(!y["Game Moddée"])return!1}else if(o.gameFilter==="non-modded"&&y["Game Moddée"])return!1}if(o.dateRangeEnabled&&(o.dateRange.start||o.dateRange.end)){const x=J(y.Date);if(!x)return!1;if(o.dateRange.start){const j=new Date(o.dateRange.start);if(x<j)return!1}if(o.dateRange.end){const j=new Date(o.dateRange.end);if(x>j)return!1}}}return q(a,d)})||null,isLoading:u,error:f}}function ce(){const{settings:d}=L(),{brRefPartiesData:m,isLoading:p,error:u}=K();return{data:m?.filter(v=>{if(!v.Game||!v.Date)return!1;if(d.independentFilters){const a=d.independentFilters;if(a.gameTypeEnabled&&a.gameFilter!=="all"){if(a.gameFilter==="modded"){if(!v["Game Moddée"])return!1}else if(a.gameFilter==="non-modded"&&v["Game Moddée"])return!1}if(a.dateRangeEnabled&&(a.dateRange.start||a.dateRange.end)){const y=J(v.Date);if(!y)return!1;if(a.dateRange.start){const o=new Date(a.dateRange.start);if(y<o)return!1}if(a.dateRange.end){const o=new Date(a.dateRange.end);if(y>o)return!1}}}return!0})||null,isLoading:p,error:u}}function q(d,m){if(m.playerFilter.mode!=="none"&&m.playerFilter.players.length>0){const p=d.Participants.toLowerCase();if(m.playerFilter.mode==="include"){if(!m.playerFilter.players.some(f=>f.toLowerCase()===p))return!1}else if(m.playerFilter.mode==="exclude"&&m.playerFilter.players.some(f=>f.toLowerCase()===p))return!1}return!0}function Se(){const{data:d,isLoading:m,error:p}=oe(),{data:u,isLoading:f,error:v}=ce(),{settings:a}=L(),{joueursData:y}=re(),[o,x]=S.useState(null),j=ae(y),R=["var(--chart-color-1)","var(--chart-color-2)","var(--chart-color-3)","var(--chart-color-4)","var(--chart-color-5)","var(--chart-color-6)"],B=i=>j[i]||ie(i),h=S.useMemo(()=>{if(!d||!u)return null;const i=u.length,s=d.length,r=d.filter(t=>t.Gagnant).length,n=d.reduce((t,l)=>{const g=l.Participants;return t[g]||(t[g]={name:g,participations:0,wins:0,totalScore:0,averageScore:0,winRate:0}),t[g].participations++,t[g].totalScore+=l.Score,l.Gagnant&&t[g].wins++,t},{});Object.values(n).forEach(t=>{t.averageScore=t.totalScore/t.participations,t.winRate=t.wins/t.participations*100});const c=Object.values(n).sort((t,l)=>l.participations-t.participations),P=c.slice(0,15),V=a.highlightedPlayer&&P.some(t=>t.name===a.highlightedPlayer);let E=!1,G=[...P];if(a.highlightedPlayer&&!V){const t=c.find(l=>l.name===a.highlightedPlayer);t&&(G.push({...t,isHighlightedAddition:!0}),E=!0)}const z=Object.values(n).filter(t=>t.participations>=3).sort((t,l)=>l.winRate-t.winRate).slice(0,15),_=a.highlightedPlayer&&z.some(t=>t.name===a.highlightedPlayer);let C=!1,M=[...z];if(a.highlightedPlayer&&!_){const t=c.find(l=>l.name===a.highlightedPlayer);t&&(M.push({...t,isHighlightedAddition:!0}),C=!0)}const I=Object.values(n).filter(t=>t.participations>=3).sort((t,l)=>l.averageScore-t.averageScore).slice(0,15),X=a.highlightedPlayer&&I.some(t=>t.name===a.highlightedPlayer);let O=!1,$=[...I];if(a.highlightedPlayer&&!X){const t=c.find(l=>l.name===a.highlightedPlayer);t&&($.push({...t,isHighlightedAddition:!0}),O=!0)}const Y=d.reduce((t,l)=>{const g=l.Score,W=g===0?"0":g===1?"1":g===2?"2":g===3?"3":g===4?"4":g<=6?"5-6":"7+";return t[W]||(t[W]=0),t[W]++,t},{}),U=Object.entries(Y).map(([t,l])=>({range:t,count:l,percentage:(l/s*100).toFixed(1)})),Q=u.reduce((t,l)=>{const g=l["Nombre de participants"];return t[g]||(t[g]=0),t[g]++,t},{}),Z=Object.entries(Q).map(([t,l])=>({participants:parseInt(t),games:l,percentage:(l/i*100).toFixed(1)})).sort((t,l)=>t.participants-l.participants);return{totalGames:i,totalParticipations:s,totalWins:r,winRate:(r/s*100).toFixed(1),averageParticipantsPerGame:(s/i).toFixed(1),topPlayersByParticipations:G,topPlayersByWins:M,topPlayersByAverageScore:$,scoreData:U,participantData:Z,highlightedPlayerInParticipations:E,highlightedPlayerInWinRate:C,highlightedPlayerInAverageScore:O}},[d,u]);return m||f?e.jsx("div",{className:"statistiques-chargement",children:"Chargement des données Battle Royale..."}):p||v?e.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",p||v]}):h?e.jsxs("div",{className:"lycans-chart-container",children:[e.jsx("div",{className:"lycans-chart-header",children:e.jsx("h2",{children:"Statistiques Battle Royale"})}),e.jsxs("div",{className:"lycans-stats-grid",children:[e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Parties totales"}),e.jsx("div",{className:"lycans-stat-value",children:h.totalGames})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Participations"}),e.jsx("div",{className:"lycans-stat-value",children:h.totalParticipations})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Moy. participants/partie"}),e.jsx("div",{className:"lycans-stat-value",children:h.averageParticipantsPerGame})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Participations"}),h.highlightedPlayerInParticipations&&a.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--accent-primary)",margin:"0.5rem 0"},children:["🎯 ",a.highlightedPlayer," affiché en plus du top 15"]}),e.jsx(b,{title:"Top Joueurs par Participations - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(F,{width:"100%",height:400,children:e.jsxs(T,{data:h.topPlayersByParticipations,onMouseEnter:i=>x(i?.activeLabel||null),onMouseLeave:()=>x(null),children:[e.jsx(H,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12,interval:0,tick:({x:i,y:s,payload:r})=>e.jsx("text",{x:i,y:s,dy:16,textAnchor:"end",fill:a.highlightedPlayer===r.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:a.highlightedPlayer===r.value?14:12,fontWeight:a.highlightedPlayer===r.value?"bold":"normal",transform:`rotate(-45 ${i} ${s})`,children:r.value})}),e.jsx(k,{}),e.jsx(w,{content:({active:i,payload:s})=>{if(i&&s&&s.length>0){const r=s[0].payload,n=r.isHighlightedAddition,c=a.highlightedPlayer===r.name;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:r.name})}),e.jsxs("div",{children:["Participations : ",r.participations]}),e.jsxs("div",{children:["Victoires : ",r.wins]}),n&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection (hors top 15)"}),c&&!n&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"})]})}return null}}),e.jsx(D,{dataKey:"participations",name:"Participations",children:h.topPlayersByParticipations.map((i,s)=>{const r=a.highlightedPlayer===i.name,n=o===i.name,c=i.isHighlightedAddition;return e.jsx(A,{fill:B(i.name),stroke:r?"var(--accent-primary)":n?"var(--text-primary)":"none",strokeWidth:r?3:n?2:0,strokeDasharray:c?"5,5":"none",opacity:c?.8:1},`cell-${s}`)})}),e.jsx(D,{dataKey:"wins",fill:"var(--chart-color-2)",name:"Victoires",children:h.topPlayersByParticipations.map((i,s)=>{const r=a.highlightedPlayer===i.name,n=o===i.name,c=i.isHighlightedAddition;return e.jsx(A,{fill:B(i.name),stroke:r?"var(--accent-secondary)":n?"var(--text-primary)":"none",strokeWidth:r?3:n?2:0,strokeDasharray:c?"5,5":"none",opacity:c?.8:1},`cell-wins-${s}`)})})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Taux de Victoire (min. 3 parties)"}),h.highlightedPlayerInWinRate&&a.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--accent-primary)",margin:"0.5rem 0"},children:["🎯 ",a.highlightedPlayer," affiché en plus du top 15"]}),e.jsx(b,{title:"Top Joueurs par Taux de Victoire - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(F,{width:"100%",height:400,children:e.jsxs(T,{data:h.topPlayersByWins,onMouseEnter:i=>x(i?.activeLabel||null),onMouseLeave:()=>x(null),children:[e.jsx(H,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12,interval:0,tick:({x:i,y:s,payload:r})=>e.jsx("text",{x:i,y:s,dy:16,textAnchor:"end",fill:a.highlightedPlayer===r.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:a.highlightedPlayer===r.value?14:12,fontWeight:a.highlightedPlayer===r.value?"bold":"normal",transform:`rotate(-45 ${i} ${s})`,children:r.value})}),e.jsx(k,{}),e.jsx(w,{content:({active:i,payload:s})=>{if(i&&s&&s.length>0){const r=s[0].payload,n=r.isHighlightedAddition,c=a.highlightedPlayer===r.name,P=r.participations>=3;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:r.name})}),e.jsxs("div",{children:["Taux de victoire : ",r.winRate.toFixed(2),"%"]}),e.jsxs("div",{children:["Victoires : ",r.wins," / ",r.participations]}),n&&!P&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection (< 3 parties)"}),n&&P&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection (hors top 15)"}),c&&!n&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"})]})}return null}}),e.jsx(D,{dataKey:"winRate",name:"Taux de victoire (%)",children:h.topPlayersByWins.map((i,s)=>{const r=a.highlightedPlayer===i.name,n=o===i.name,c=i.isHighlightedAddition;return e.jsx(A,{fill:B(i.name),stroke:r?"var(--accent-primary)":n?"var(--text-primary)":"none",strokeWidth:r?3:n?2:0,strokeDasharray:c?"5,5":"none",opacity:c?.8:1},`cell-${s}`)})})]})})})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Score Moyen par Partie (min. 3 parties)"}),h.highlightedPlayerInAverageScore&&a.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--accent-primary)",margin:"0.5rem 0"},children:["🎯 ",a.highlightedPlayer," affiché en plus du top 15"]}),e.jsx(b,{title:"Top Joueurs par Score Moyen - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(F,{width:"100%",height:400,children:e.jsxs(T,{data:h.topPlayersByAverageScore,onMouseEnter:i=>x(i?.activeLabel||null),onMouseLeave:()=>x(null),children:[e.jsx(H,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12,interval:0,tick:({x:i,y:s,payload:r})=>e.jsx("text",{x:i,y:s,dy:16,textAnchor:"end",fill:a.highlightedPlayer===r.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:a.highlightedPlayer===r.value?14:12,fontWeight:a.highlightedPlayer===r.value?"bold":"normal",transform:`rotate(-45 ${i} ${s})`,children:r.value})}),e.jsx(k,{}),e.jsx(w,{content:({active:i,payload:s})=>{if(i&&s&&s.length>0){const r=s[0].payload,n=r.isHighlightedAddition,c=a.highlightedPlayer===r.name,P=r.participations>=3;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:r.name})}),e.jsxs("div",{children:["Score moyen : ",r.averageScore.toFixed(2)]}),e.jsxs("div",{children:["Score total : ",r.totalScore," / ",r.participations," parties"]}),n&&!P&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection (< 3 parties)"}),n&&P&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection (hors top 15)"}),c&&!n&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"})]})}return null}}),e.jsx(D,{dataKey:"averageScore",name:"Score moyen par partie",children:h.topPlayersByAverageScore.map((i,s)=>{const r=a.highlightedPlayer===i.name,n=o===i.name,c=i.isHighlightedAddition;return e.jsx(A,{fill:B(i.name),stroke:r?"var(--accent-primary)":n?"var(--text-primary)":"none",strokeWidth:r?3:n?2:0,strokeDasharray:c?"5,5":"none",opacity:c?.8:1},`cell-${s}`)})})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Scores"}),e.jsx(b,{title:"Distribution des Scores - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(F,{width:"100%",height:400,children:e.jsxs(se,{children:[e.jsx(ne,{data:h.scoreData,cx:"50%",cy:"50%",labelLine:!1,label:({range:i,percentage:s})=>`${i}: ${s}%`,outerRadius:140,fill:"#8884d8",dataKey:"count",children:h.scoreData.map((i,s)=>e.jsx(A,{fill:R[s%R.length]},`cell-${s}`))}),e.jsx(w,{formatter:i=>[i,"Participations"]})]})})})]})]}),e.jsxs("div",{className:"lycans-chart-section",children:[e.jsx("h3",{children:"Répartition par Nombre de Participants"}),e.jsx(b,{title:"Répartition par Nombre de Participants - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(F,{width:"100%",height:400,children:e.jsxs(T,{data:h.participantData,children:[e.jsx(H,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"participants"}),e.jsx(k,{}),e.jsx(w,{formatter:(i,s)=>[i,s==="games"?"Parties":s]}),e.jsx(le,{}),e.jsx(D,{dataKey:"games",fill:"var(--chart-color-4)",name:"Nombre de parties"})]})})})]})]}):e.jsx("div",{className:"statistiques-vide",children:"Aucune donnée Battle Royale disponible"})}export{Se as BRGeneralStatsChart};
