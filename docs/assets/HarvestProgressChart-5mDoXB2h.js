import{r as j,j as e}from"./index-BLk8EHOF.js";import{q as f,R as u,p as b,T as x,B as p,C as D,X as H,Y as N,o as R}from"./useRawGameData-BobySaES.js";import{F as W}from"./FullscreenChart-BzSIIquk.js";import{P,a as B}from"./PieChart-9K1B8ekb.js";import{L as g}from"./Legend-BQbnY_jh.js";function C(){const{data:s,isLoading:v,error:c}=f();return{harvestStats:j.useMemo(()=>{if(!s||s.length===0)return null;const t={averageHarvest:0,averageHarvestPercent:"0",gamesWithHarvest:0,harvestDistribution:{"0-25%":0,"26-50%":0,"51-75%":0,"76-99%":0,"100%":0},harvestByWinner:{}};let a=0,r=0;return s.forEach(l=>{const n=l["Camp victorieux"],d=l.Récolte,h=l["Total récolte"],i=l["Pourcentage de récolte"];d!=null&&!isNaN(d)&&(a+=d),h!=null&&!isNaN(h)&&(r+=h),i!=null&&!isNaN(i)&&(t.gamesWithHarvest++,i<=.25?t.harvestDistribution["0-25%"]++:i<=.5?t.harvestDistribution["26-50%"]++:i<=.75?t.harvestDistribution["51-75%"]++:i<=.99?t.harvestDistribution["76-99%"]++:t.harvestDistribution["100%"]++,n&&n.trim()!==""&&(t.harvestByWinner[n]||(t.harvestByWinner[n]={totalPercent:0,count:0,average:"0"}),t.harvestByWinner[n].totalPercent+=i,t.harvestByWinner[n].count++))}),t.gamesWithHarvest>0&&(r>0&&(t.averageHarvestPercent=(a/r*100).toFixed(2)),t.averageHarvest=parseFloat((a/t.gamesWithHarvest).toFixed(2)),Object.keys(t.harvestByWinner).forEach(l=>{const n=t.harvestByWinner[l];n.count>0&&(n.average=(n.totalPercent/n.count*100).toFixed(2))})),{averageHarvest:t.averageHarvest,averageHarvestPercent:t.averageHarvestPercent,gamesWithHarvest:t.gamesWithHarvest,harvestDistribution:t.harvestDistribution,harvestByWinner:t.harvestByWinner}},[s]),isLoading:v,errorInfo:c}}const y=["#d32f2f","#f57c00","#fbc02d","#388e3c","#1976d2"];function q(){const{harvestStats:s,isLoading:v,errorInfo:c}=C();if(v)return e.jsx("div",{className:"donnees-chargement",children:"Récupération des données de récolte..."});if(c)return e.jsxs("div",{className:"donnees-erreur",children:["Problème: ",c]});if(!s)return e.jsx("div",{className:"donnees-absentes",children:"Données de récolte non disponibles"});const m=s?[{nom:"0-25%",valeur:s.harvestDistribution["0-25%"]},{nom:"26-50%",valeur:s.harvestDistribution["26-50%"]},{nom:"51-75%",valeur:s.harvestDistribution["51-75%"]},{nom:"76-99%",valeur:s.harvestDistribution["76-99%"]},{nom:"100%",valeur:s.harvestDistribution["100%"]}]:[],t=s?Object.entries(s.harvestByWinner).map(([a,r])=>({camp:a,moyenne:parseFloat(r.average)})).sort((a,r)=>r.moyenne-a.moyenne):[];return e.jsxs("div",{className:"lycans-recolte-stats",children:[e.jsx("h2",{children:"Statistiques de Récolte"}),e.jsxs("div",{className:"lycans-recolte-sommaire",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Moyenne de Récolte"}),e.jsxs("p",{className:"lycans-nombre-grand",children:[s.averageHarvestPercent,"%"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Nombre total de parties"}),e.jsx("p",{className:"lycans-nombre-grand",children:s.gamesWithHarvest})]})]}),e.jsxs("div",{className:"lycans-graphiques-conteneur",children:[e.jsxs("div",{className:"lycans-graphique-moitie",children:[e.jsx("h3",{children:"Distribution des Récoltes"}),e.jsx("div",{style:{height:300},children:e.jsx(u,{width:"100%",height:"100%",children:e.jsxs(P,{children:[e.jsx(B,{data:m,cx:"50%",cy:"50%",labelLine:!0,label:({nom:a,percent:r})=>`${a}: ${((r??0)*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"valeur",nameKey:"nom",children:m.map((a,r)=>e.jsx(b,{fill:y[r%y.length]},`cellule-${r}`))}),e.jsx(x,{content:({active:a,payload:r})=>{if(a&&r&&r.length>0){const o=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:o.nom})}),e.jsxs("div",{children:["Nombre de parties : ",o.valeur]})]})}return null}}),e.jsx(g,{})]})})})]}),e.jsxs("div",{className:"lycans-graphique-moitie",children:[e.jsx("h3",{children:"Moyenne de Récolte au Moment de la Victoire"}),e.jsx(W,{title:"Moyenne de Récolte au Moment de la Victoire",children:e.jsx("div",{style:{height:300},children:e.jsx(u,{width:"100%",height:"100%",children:e.jsxs(p,{data:t,margin:{top:20,right:30,left:20,bottom:70},children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(N,{label:{value:"Moyenne de Récolte (%)",angle:-90,position:"insideLeft"}}),e.jsx(x,{content:({active:a,payload:r})=>{if(a&&r&&r.length>0){const o=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:o.camp}),e.jsxs("div",{children:["Moyenne de Récolte : ",o.moyenne,"%"]})]})}return null}}),e.jsx(g,{}),e.jsx(R,{dataKey:"moyenne",name:"Moyenne de Récolte",fill:"#388e3c"})]})})})})]})]})]})}export{q as HarvestProgressChart};
