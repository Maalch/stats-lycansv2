import{a as P,r as c}from"./index-C_3nOrvJ.js";function F(a){if(!a)return null;const[e,t,r]=a.split("/");return!e||!t||!r?null:new Date(Number(r),Number(t)-1,Number(e))}function g(a){return a?a.split(",").map(e=>e.trim()).filter(Boolean):[]}function C(a,e){return e&&e.trim()!==""?g(e).some(r=>r.toLowerCase()===a.toLowerCase()):!1}function L(a,e,t){return a[e]&&a[e][t]||"Villageois"}function R(a){if(a instanceof Date){const e=a.getDate().toString().padStart(2,"0"),t=(a.getMonth()+1).toString().padStart(2,"0"),r=a.getFullYear();return`${e}/${t}/${r}`}if(typeof a=="string"){if(a.match(/^\d{2}\/\d{2}\/\d{4}$/))return a;const e=new Date(a);if(!isNaN(e.getTime()))return R(e)}return a?.toString()||""}function S(a){const e={};return a.forEach(t=>{const r=t.Game?.toString();if(!r)return;e[r]||(e[r]={});const l=(i,s)=>{if(i&&i.toString().trim()!==""){const u=i.toString().trim();e[r][u]||(e[r][u]=s)}},n=(i,s)=>{i&&g(i.toString()).forEach(f=>{e[r][f]||(e[r][f]=s)})};n(t.Loups,"Loups"),l(t.Traître,"Traître"),l(t["Idiot du village"],"Idiot du Village"),l(t.Cannibale,"Cannibale"),l(t.Espion,"Espion"),l(t["La Bête"],"La Bête"),l(t["Chasseur de primes"],"Chasseur de primes"),l(t.Vaudou,"Vaudou"),n(t.Agent,"Agent"),n(t.Scientifique,"Scientifique"),n(t.Amoureux,"Amoureux")}),e}function A(a,e){return a===e||a==="Traître"&&e==="Loups"}function b(){const[a,e]=c.useState(null),[t,r]=c.useState(!0),[l,n]=c.useState(null);return c.useEffect(()=>{(async()=>{try{r(!0),n(null);const[s,u,f,d]=await Promise.all([fetch("/stats-lycansv2/data/rawGameData.json"),fetch("/stats-lycansv2/data/rawRoleData.json"),fetch("/stats-lycansv2/data/rawPonceData.json"),fetch("/stats-lycansv2/data/rawBRData.json")]);if(!s.ok)throw new Error("Failed to fetch game data");if(!u.ok)throw new Error("Failed to fetch role data");if(!f.ok)throw new Error("Failed to fetch ponce data");if(!d.ok)throw new Error("Failed to fetch BR data");const[o,m,D,p]=await Promise.all([s.json(),u.json(),f.json(),d.json()]);e({gameData:o.data||[],roleData:m.data||[],ponceData:D.data||[],brPartiesData:p.BRParties?.data||[],brRefPartiesData:p.BRRefParties?.data||[]})}catch(s){console.error("Error fetching combined raw data:",s),n(s instanceof Error?s.message:"Unknown error")}finally{r(!1)}})()},[]),{data:a,isLoading:t,error:l}}function y(a,e,t){return a.filter(r=>{let l=r;if(t&&r.Game){const n=t.find(i=>i.Game===r.Game);if(!n)return!1;l=n}if(e.filterMode==="gameType"&&e.gameFilter!=="all"){if(e.gameFilter==="modded"){if(!l["Game Moddée"])return!1}else if(e.gameFilter==="non-modded"&&l["Game Moddée"])return!1}else if(e.filterMode==="dateRange"&&(e.dateRange.start||e.dateRange.end)){const n=F(l.Date);if(!n)return!1;if(e.dateRange.start){const i=new Date(e.dateRange.start);if(n<i)return!1}if(e.dateRange.end){const i=new Date(e.dateRange.end);if(n>i)return!1}}return!0})}function w(a,e){return e.playerFilter.mode==="none"||e.playerFilter.players.length===0?a:a.filter(t=>{const r=t["Liste des joueurs"].toLowerCase();return e.playerFilter.mode==="include"?e.playerFilter.players.every(n=>r.includes(n.toLowerCase())):e.playerFilter.mode==="exclude"?!e.playerFilter.players.some(n=>r.includes(n.toLowerCase())):!0})}function h(a,e){return e.playerFilter.mode==="none"||e.playerFilter.players.length===0?a:a.filter(t=>{const r=t.Participants.toLowerCase();return e.playerFilter.mode==="include"?e.playerFilter.players.some(l=>r.includes(l.toLowerCase())):e.playerFilter.mode==="exclude"?!e.playerFilter.players.some(l=>r.includes(l.toLowerCase())):!0})}function E(){const{settings:a}=P(),{data:e,isLoading:t,error:r}=b();return{...c.useMemo(()=>{if(!e)return{gameData:null,roleData:null,ponceData:null,brPartiesData:null,brRefPartiesData:null};let n=y(e.gameData,a);n=w(n,a);const i=new Set(n.map(o=>o.Game)),s=e.roleData.filter(o=>i.has(o.Game)),u=e.ponceData.filter(o=>i.has(o.Game));let f=e.brPartiesData.filter(o=>{if(!o.Game||!o.Participants)return!1;const m=e.brRefPartiesData.find(p=>p.Game===o.Game);return m?y([o],a,[m]).length===0?!1:h([o],a).length>0:h([o],a).length>0});const d=y(e.brRefPartiesData,a);return{gameData:n,roleData:s,ponceData:u,brPartiesData:f,brRefPartiesData:d}},[e,a]),isLoading:t,error:r}}export{C as a,S as b,A as d,R as f,L as g,g as s,E as u};
