import{a as oe,r as F,g as ee,f as $e,u as X,j as e,n as be,c as we,d as We}from"./index-DLq0pZdG.js";import{u as te}from"./useJoueursData-DwV2CO66.js";import{u as ue}from"./baseStatsHook-BVcFbp1R.js";import{g as Ie}from"./gameUtils-DYpUb-C5.js";import{a as ae,g as Q,c as Ce,b as Le}from"./datasyncExport-CjB7UYqV.js";import{u as ce,g as ze,a as ne,l as Se,d as Ee}from"./api-BbVeoD2E.js";import{d as Ne,f as ie}from"./durationFormatters-C9UyWcKX.js";import{c as Re}from"./votingStatsUtils-ChkELBcv.js";import{F as B,C as O,X as K,Y as H,a as _}from"./FullscreenChart-CYmNgvSP.js";import{R as G,T as V}from"./CategoricalChart-D-La3bTH.js";import{L as qe,a as Ge}from"./LineChart-ClJ903YY.js";import{B as J,a as U}from"./BarChart-DDAmhe1y.js";import{P as ke,a as Pe}from"./PieChart-DFFD_iGf.js";import{u as Ve}from"./useDeathStatisticsFromRaw-Bk7Fe4Py.js";import{R as he}from"./ReferenceLine-BjgADdRC.js";import{g as le}from"./deathTypes-gHH1w6_X.js";import{i as ge,g as xe,V as Be,a as Oe}from"./roleUtils-CLjkiQQc.js";import{e as fe,a as Ke,b as He,d as Ue,R as _e}from"./deathLocationUtils-b2qSkrHc.js";import{S as Ye,a as Je}from"./ScatterChart-DcOSytep.js";import{L as Xe}from"./Legend-DRpeQu9x.js";import{a as Ze,u as Qe}from"./useClips-CBtmfRln.js";import{C as es,f as ve,a as ss}from"./ClipViewer-B8pczBqz.js";import"./ActivePoints-Dr2fpjIl.js";import"./PolarChart-BPA7AdR_.js";function pe(s){const{settings:c}=oe(),{joueursData:o}=te(),[h,f]=F.useState(null),[p,S]=F.useState(!1),[v,u]=F.useState(null);F.useEffect(()=>{let r=!0;return(async()=>{try{S(!0),u(null);const i=c.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",m=await fetch(i);if(!m.ok)throw new Error(`Failed to load achievements: ${m.status} ${m.statusText}`);const n=await m.json();r&&f(n)}catch(i){r&&u(i instanceof Error?i.message:"Failed to load achievements")}finally{r&&S(!1)}})(),()=>{r=!1}},[c.dataSource]);const g=(()=>{if(!s||!h)return null;const t=o?.Players?.find(i=>i.Joueur===s)?.SteamID;return t&&h.achievements[t]||null})();return F.useEffect(()=>{s&&h&&o&&o.Players?.find(i=>i.Joueur===s)?.SteamID},[s,h,o,c.dataSource]),{data:g,isLoading:p,error:v,metadata:{generatedAt:h?.generatedAt||null,totalPlayers:h?.totalPlayers||0,totalGames:h?.totalGames||0,totalModdedGames:h?.totalModdedGames||0}}}function Te(s,c,o){if(!s||s.trim()===""||c.length===0)return null;const h=[];let f=s;c.forEach(t=>{const i=t.PlayerStats.find(m=>ee(m)===s||m.Username.toLowerCase()===s.toLowerCase());if(i){f=i.Username;const m=i.MainRoleInitial==="Louveteau"?i.MainRoleInitial:ae(i.MainRoleInitial,i.MainRoleChanges||[]),n=Q(m);if(o&&o!=="Tous les camps"&&n!==o)return;const j=Ie(t),l=i.Victorious,d=$e(new Date(t.StartDate)),b=Ce(t.StartDate,t.EndDate)||0;h.push({gameId:t.Id,date:d,camp:n,won:l,winnerCamp:j,playersInGame:t.PlayerStats.length,mapName:t.MapName,duration:b})}}),h.sort((t,i)=>{const m=n=>{const j=n.split("/");return j.length===3?new Date(parseInt(j[2]),parseInt(j[1])-1,parseInt(j[0])):new Date(n)};return m(i.date).getTime()-m(t.date).getTime()});const p=h.length,S=h.filter(t=>t.won).length,v=p>0?(S/p*100).toFixed(2):"0.00",u={};h.forEach(t=>{u[t.camp]||(u[t.camp]={appearances:0,wins:0,winRate:"0.00"}),u[t.camp].appearances++,t.won&&u[t.camp].wins++}),Object.keys(u).forEach(t=>{const i=u[t];i.winRate=i.appearances>0?(i.wins/i.appearances*100).toFixed(2):"0.00"});const g={};h.forEach(t=>{g[t.mapName]||(g[t.mapName]={appearances:0,wins:0,winRate:"0.00"}),g[t.mapName].appearances++,t.won&&g[t.mapName].wins++}),Object.keys(g).forEach(t=>{const i=g[t];i.winRate=i.appearances>0?(i.wins/i.appearances*100).toFixed(2):"0.00"});const r=h.reduce((t,i)=>t+i.duration,0);return{playerName:f,totalGames:p,totalWins:S,winRate:v,totalPlayTime:r,games:h,campStats:u,mapStats:g}}function as(s){const c={};let o=0,h=0;return Object.entries(s).forEach(([f,p])=>{f==="Village"||f==="Ch√¢teau"?c[f]={...p}:(o+=p.appearances,h+=p.wins)}),o>=10&&(c.Autres={appearances:o,wins:h,winRate:o>0?(h/o*100).toFixed(2):"0.00"}),c}function de(s,c){const{data:o,isLoading:h,error:f}=ue(p=>s?Te(s,p,c):null);return{data:o,isLoading:h,error:f}}function Ae({achievements:s,title:c,emptyMessage:o,achievementType:h="all"}){const{navigateToTab:f,updateNavigationState:p,clearNavigation:S}=X(),{settings:v,updateSettings:u}=oe(),{joueursData:g}=te(),r=ce(g),t=(a,k)=>{if(k.stopPropagation(),!a.redirectTo)return;S();const M=v.highlightedPlayer;if(u(h==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:M,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:M,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),a.category==="comparison"&&a.redirectTo.subTab==="comparison"){const x=v.highlightedPlayer||"",y=i(a.description,x);y&&p({playerComparisonState:{selectedPlayer1:x,selectedPlayer2:y,showDetailedStats:!0}})}if(a.category==="comparison"&&a.redirectTo.subTab==="pairing"){const x=a.description.toLowerCase().includes("loup");p({selectedPairingTab:x?"wolves":"lovers"})}if(a.category==="kills"&&a.redirectTo.subTab==="deathStats"){const x=a.description.match(/(Villageois|Loups|Autres)/i);x&&p({deathStatsSelectedCamp:x[1]});let y=10;const P=a.description.match(/min\.\s*(\d+)/);P&&(y=parseInt(P[1],10));let T="totalKills",R="killers";const $=a.redirectTo.chartSection;$&&($==="killers-total"?(T="totalKills",R="killers"):$==="killers-average"?(T="averageKills",R="killers"):$==="deaths-total"?(T="totalDeaths",R="deaths"):$==="survivors-average"?(T="survivalRate",R="deaths"):($==="hunters-good"||$==="hunters-bad")&&(R="hunter",T="averageKills")),p({deathStatisticsState:{selectedCamp:x?.[1]||"Tous les camps",minGamesForAverage:y,selectedView:R,focusChart:T}})}if(a.category==="map"&&a.redirectTo.subTab==="playersGeneral"){const x=a.redirectTo.mapFilter||"all";let y=10;const P=a.description.match(/min\.\s*(\d+)/);P&&(y=parseInt(P[1])),u(h==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:x,playerFilter:{mode:"none",players:[]},highlightedPlayer:M,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:x,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:x,playerFilter:{mode:"none",players:[]},highlightedPlayer:M,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:x,playerFilter:{mode:"none",players:[]}}}),p({playersGeneralState:{minGamesForWinRate:y,winRateOrder:"best",focusChart:"winRate"}}),f("players","playersGeneral");return}if(a.category==="history"&&a.redirectTo.subTab==="history"&&p({selectedPlayerName:v.highlightedPlayer||"",groupingMethod:"session"}),a.category==="series"&&a.redirectTo.subTab==="series"){let x="wins";const y=a.title.toLowerCase(),P=a.description.toLowerCase();y.includes("d√©faite")||P.includes("d√©faite")?x="losses":y.includes("loup")||P.includes("loup")?x="loup":y.includes("villageois")||P.includes("villageois")?x="villageois":(y.includes("victoire")||P.includes("victoire"))&&(x="wins"),p({selectedSeriesType:x})}if(a.category==="general"&&a.redirectTo.subTab==="playersGeneral"){let x=10;const y=a.description.match(/min\.\s*(\d+)/);y&&(x=parseInt(y[1],10));let P="winRate",T="best";const R=a.title.toLowerCase(),$=a.description.toLowerCase();R.includes("participation")||$.includes("participation")?P="participation":(R.includes("taux de victoire")||$.includes("taux de victoire"))&&(P="winRate",(R.includes("moins bon")||R.includes("mauvais")||$.includes("moins bon")||$.includes("mauvais"))&&(T="worst")),p({playersGeneralState:{minGamesForWinRate:x,winRateOrder:T,focusChart:P}})}if(a.category==="performance"&&a.redirectTo.subTab==="campStats"){const x=a.redirectTo.chartSection;let y="Villageois",P=1;x&&(x==="camp-loup"?y="Loup":x==="camp-villageois"?y="Villageois":x==="camp-idiot"?y="Idiot du Village":x==="camp-amoureux"?y="Amoureux":(x==="solo-roles"||x==="hall-of-fame")&&(y="Villageois"));const T=a.description.match(/min\.\s*(\d+)/);T&&(P=parseInt(T[1],10)),x==="solo-roles"?y="R√¥les sp√©ciaux":x==="hall-of-fame"&&(y="Tous les camps"),p({campPerformanceState:{selectedCampPerformanceCamp:y,selectedCampPerformanceMinGames:P,viewMode:"performance"}})}if(a.category==="voting"&&a.redirectTo.subTab==="votingStats"){const x=a.title.toLowerCase();let y="overview",P="behavior";x.includes("agressivit√©")?(y="overview",P="behavior"):x.includes("taux de vote")?(y="behavior",P="voteRate"):x.includes("pr√©cision")&&(y="overview",P="accuracy"),p({votingStatsState:{selectedCategory:y,selectedView:P}})}if(a.category==="loot"&&a.redirectTo.subTab==="lootStats"){const x=a.redirectTo,y=x.minGames||5,P=x.view||"normalized";p({lootStatsState:{minGames:y,campFilter:"all",view:P}})}f(a.redirectTo.tab,a.redirectTo.subTab)},i=(a,k)=>{const M=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const x of M){const y=a.match(x);if(y&&y[1]){const P=y[1].trim();if(P!==k)return P}}return null},m=a=>{if(!a.redirectTo)return"Aucune navigation disponible";switch(a.category){case"general":if(a.redirectTo.subTab==="playersGeneral"){const x=a.description.match(/min\.\s*(\d+)/),y=x?parseInt(x[1],10):10,P=a.title.toLowerCase(),T=h==="modded"?" (Filtre parties modd√©es activ√©)":" (Filtres r√©initialis√©s)";return P.includes("taux de victoire")?`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${y} parties)${T}`:P.includes("participation")?`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir les participations${T}`:`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir le classement g√©n√©ral des joueurs${T}`}break;case"map":if(a.redirectTo.subTab==="playersGeneral"){const x=a.redirectTo.mapFilter,y=x==="village"?"Village":x==="chateau"?"Ch√¢teau":"map",P=h==="modded"?" (Filtres parties modd√©es + map activ√©s)":" (Filtre map activ√©)";return`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques g√©n√©rales filtr√©es sur ${y}${P}`}break;case"history":if(a.redirectTo.subTab==="history")return"Cliquez pour voir l'historique d√©taill√© du joueur par map";break;case"comparison":if(a.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${i(a.description,v.highlightedPlayer||"")||"ce joueur"}`;if(a.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(a.redirectTo.subTab==="deathStats"){const x=a.description.match(/(Villageois|Loups|Autres)/i),y=a.description.match(/min\.\s*(\d+)/),P=y?parseInt(y[1],10):10,T=x?.[1]||"Tous les camps",R=a.redirectTo.chartSection;let $="kills et morts";return R==="killers-total"?$="total des kills":R==="killers-average"?$=`moyenne des kills (min. ${P} parties)`:R==="deaths-total"?$="total des morts":R==="survivors-average"&&($=`taux de survie (min. ${P} parties)`),`Cliquez pour voir les statistiques de ${$} ${T!=="Tous les camps"?`en ${T}`:""}`}break;case"series":if(a.redirectTo.subTab==="series"){const x=a.title.toLowerCase(),y=a.description.toLowerCase();return x.includes("d√©faite")||y.includes("d√©faite")?"Cliquez pour voir les s√©ries de d√©faites":x.includes("loup")||y.includes("loup")?"Cliquez pour voir les s√©ries Loups":x.includes("villageois")||y.includes("villageois")?"Cliquez pour voir les s√©ries Villageois":x.includes("victoire")||y.includes("victoire")?"Cliquez pour voir les s√©ries de victoires":"Cliquez pour voir les s√©ries cons√©cutives"}break;case"performance":if(a.redirectTo.subTab==="campStats"){const x=a.redirectTo.chartSection,y=h==="modded"?" (Filtre parties modd√©es activ√©)":" (Filtres r√©initialis√©s)";return x==="camp-loup"?`Cliquez pour voir les performances camp Loup${y}`:x==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${y}`:x==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${y}`:x==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${y}`:x==="solo-roles"?`Cliquez pour voir le classement (r√¥les sp√©ciaux)${y}`:x==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${y}`:`Cliquez pour voir les performances par camp${y}`}break;case"voting":if(a.redirectTo.subTab==="votingStats"){const x=a.description.match(/min\.\s*(\d+)/),y=x?parseInt(x[1],10):25,P=h==="modded"?" (Filtre parties modd√©es activ√©)":" (Filtres r√©initialis√©s)",T=a.title.toLowerCase();return T.includes("agressivit√©")?`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivit√© (min. ${y} meetings)${P}`:T.includes("taux de vote")?`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${y} meetings)${P}`:T.includes("pr√©cision")?`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir la pr√©cision des votes${P}`:`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${P}`}break;case"loot":if(a.redirectTo.subTab==="lootStats"){const x=a.description.match(/min\.\s*(\d+)/),y=x?parseInt(x[1],10):25,P=h==="modded"?" (Filtre parties modd√©es activ√©)":" (Filtres r√©initialis√©s)";return`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir le taux de r√©colte (min. ${y} parties)${P}`}break}return`Cliquez pour voir ${a.redirectTo.subTab}`+(h==="modded"?" (Filtre parties modd√©es activ√©)":" (Filtres r√©initialis√©s)")},n=a=>r[a]||ze(a),j=a=>{const k=[/avec ([^:]+?):/,/contre ([^:]+?):/];let M=a;return k.forEach(x=>{const y=a.match(x);if(y&&y[1]){const P=y[1].trim(),R=`<span class="player-name-highlight" style="color: ${n(P)};">${P}</span>`;M=M.replace(P,R)}}),M};if(s.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:c}),e.jsx("p",{children:o||"Aucun succ√®s dans cette cat√©gorie"})]});const l=a=>a===1?"ü•á":a===2?"ü•à":a===3?"ü•â":"",d=a=>a===1?"rank-1":a===2?"rank-2":a===3?"rank-3":a&&a<=10?"rank-top-10":"",b=(a,k)=>{if(!a||a<=3||!k)return;const M=a-3,x=k-3;return x<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(M-1)/(x-1))}, 70%, 50%)`},A=a=>{if(!a)return;const k=a.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(k){const[,M,x]=k;return`hsl(${M}, ${x}%, 40%)`}return a},D=s.filter(a=>a.category!=="comparison"&&(a.type==="good"||a.type==="neutral")).sort((a,k)=>(a.rank??999)-(k.rank??999)),W=s.filter(a=>a.category!=="comparison"&&a.type==="bad").sort((a,k)=>(a.rank??999)-(k.rank??999)),w=s.filter(a=>a.category==="comparison"),N=D.filter(a=>a.rank&&a.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:c}),N>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"‚ú® Podium d'Excellence ‚ú®"}),e.jsx("div",{className:"top3-grid",children:D.filter(a=>a.rank&&a.rank<=3).map((a,k)=>e.jsxs("div",{className:`top3-card ${d(a.rank)} animate-slide-in`,style:{animationDelay:`${k*.15}s`},onClick:M=>t(a,M),title:m(a),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:l(a.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",a.rank,a.totalRanked?`/${a.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:a.title}),e.jsx("p",{className:"top3-achievement-description",children:a.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"‚ú®"}),e.jsx("span",{className:"sparkle sparkle-2",children:"‚≠ê"}),e.jsx("span",{className:"sparkle sparkle-3",children:"‚ú®"})]})]},a.id))})]}),D.length>0&&e.jsxs("div",{className:"achievements-section good-achievements",children:[e.jsx("h5",{children:"üèÜ Classements"}),e.jsx("div",{className:"achievements-grid",children:D.filter(a=>!a.rank||a.rank>3).map((a,k)=>{const M=b(a.rank,a.totalRanked),x=A(M);return e.jsxs("div",{className:`achievement-card good ${d(a.rank)}`,onClick:y=>t(a,y),title:m(a),style:{animationDelay:`${k*.05}s`,borderLeftColor:x,...M&&{borderLeftWidth:"4px"}},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:a.title}),e.jsxs("span",{className:"achievement-rank",style:M?{backgroundColor:M}:{},children:["#",a.rank,a.totalRanked?`/${a.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:a.description})]},a.id)})})]}),W.length>0&&e.jsxs("div",{className:"achievements-section bad-achievements",children:[e.jsx("h5",{children:"üíÄ Classements (Invers√©s)"}),e.jsx("div",{className:"achievements-grid",children:W.map(a=>{const k=b(a.rank,a.totalRanked),M=A(k);return e.jsxs("div",{className:`achievement-card bad rank-${a.rank}`,onClick:x=>t(a,x),title:m(a),style:{borderLeftColor:M,...k&&{borderLeftWidth:"4px"}},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:a.title}),e.jsxs("span",{className:"achievement-rank",style:k?{backgroundColor:k}:{},children:["#",a.rank,a.totalRanked?`/${a.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:a.description})]},a.id)})})]}),w.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"üìä Statistiques Face-√†-Face"}),e.jsx("div",{className:"achievements-grid",children:w.map(a=>e.jsxs("div",{className:"achievement-card comparison",onClick:k=>t(a,k),title:m(a),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:a.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:j(a.description)}})]},a.id))})]})]})}function ts(s,c,o){const h=[];let f=null;if(c.forEach(n=>{const j=n.PlayerStats.find(l=>l.Username===s);j&&(h.push({game:n,playerStat:j}),!f&&j.ID&&(f=j.ID))}),h.length===0)return null;const p=h.length,S=h.filter(n=>n.playerStat.Victorious).length,v=p>0?S/p*100:0,u=h.reduce((n,j)=>n+(j.playerStat.SecondsTalkedOutsideMeeting||0)+(j.playerStat.SecondsTalkedDuringMeeting||0),0),g=h.map(n=>new Date(n.game.StartDate)).sort((n,j)=>n.getTime()-j.getTime()),r=g[0]?.toLocaleDateString("fr-FR")||"",t=g[g.length-1]?.toLocaleDateString("fr-FR")||"",i={};h.forEach(n=>{const j=n.playerStat.Color;j&&(i[j]=(i[j]||0)+1)});const m=Object.entries(i).sort((n,j)=>j[1]-n[1])[0]?.[0]||null;return{name:s,steamId:f,avatar:o?.Image||null,socialLinks:{twitch:o?.Twitch||null,youtube:o?.Youtube||null},firstGameDate:r,lastGameDate:t,totalPlayTime:u,totalGames:p,totalWins:S,winRate:v,color:m}}function rs(s,c){const o=c.filter(x=>x.PlayerStats.some(y=>y.Username===s));if(o.length===0)return{votingStyle:"unknown",votingRate:0,voteAccuracy:0,aggressivenessScore:0,communicationLevel:"unknown",talkingTimePerGame:0,talkingRatioMeetingVsOutside:0,averageSurvivalTiming:"unknown",survivalRate:0,survivalRateWhenTargeted:0,favoriteCamp:"Inconnu",bestCamp:{camp:"Inconnu",winRate:0},worstCamp:{camp:"Inconnu",winRate:0}};const h=Re(o),f=h.playerBehaviorStats.find(x=>x.playerName===s),p=h.playerAccuracyStats.find(x=>x.playerName===s),S=h.playerTargetStats.find(x=>x.playerName===s);let v="unknown";const u=f?.aggressivenessScore||0;u>60?v="aggressive":u>30?v="strategic":u>=0&&(v="cautious");let g=0,r=0;o.forEach(x=>{const y=x.PlayerStats.find(P=>P.Username===s);if(y){const P=y.SecondsTalkedDuringMeeting||0,T=y.SecondsTalkedOutsideMeeting||0;r+=P,g+=P+T}});const t=o.length>0?g/o.length:0;let i="unknown";t>120?i="talkative":t>60?i="moderate":t>=0&&(i="quiet");const m=g>0?r/g:0;let n=0,j=0,l=0,d=0;o.forEach(x=>{const y=x.PlayerStats.find(P=>P.Username===s);if(y)if(!y.DeathTiming)n++;else{const T=y.DeathTiming.toUpperCase().match(/[NJM](\d+)/),R=T?parseInt(T[1]):0;R<=2?j++:R<=4?l++:d++}});let b="unknown";const A=Math.max(n,j,l,d);A===n?b="survivor":A===j?b="early-death":A===l?b="mid-game":A===d&&(b="late-game");const D=o.length>0?n/o.length*100:0,W={};o.forEach(x=>{const y=x.PlayerStats.find(P=>P.Username===s);if(y){const P=ae(y.MainRoleInitial,y.MainRoleChanges||[]),T=Q(P,{regroupWolfSubRoles:!0});W[T]||(W[T]={games:0,wins:0}),W[T].games++,y.Victorious&&W[T].wins++}});const w=Object.entries(W),N=w.sort((x,y)=>y[1].games-x[1].games)[0]?.[0]||"Inconnu",a=w.filter(([x,y])=>y.games>=3).map(([x,y])=>({camp:x,winRate:y.wins/y.games*100})).sort((x,y)=>y.winRate-x.winRate),k=a[0]||{camp:"Inconnu",winRate:0},M=a[a.length-1]||{camp:"Inconnu",winRate:0};return{votingStyle:v,votingRate:f?.votingRate||0,voteAccuracy:p?.accuracyRate||0,aggressivenessScore:u,communicationLevel:i,talkingTimePerGame:t,talkingRatioMeetingVsOutside:m,averageSurvivalTiming:b,survivalRate:D,survivalRateWhenTargeted:S?.survivalRate||0,favoriteCamp:N,bestCamp:k,worstCamp:M}}function is(s,c,o){const h=[],f=[],p=Te(s,c);if(!p)return{strengths:h,weaknesses:f};const S=parseFloat(p.winRate),v={};c.forEach(r=>{r.PlayerStats.forEach(t=>{const i=t.Username;v[i]||(v[i]={games:0,wins:0}),v[i].games++,t.Victorious&&v[i].wins++})});const u=Object.values(v).filter(r=>r.games>=10).map(r=>r.wins/r.games*100),g=u.length>0?u.reduce((r,t)=>r+t,0)/u.length:50;if(o.bestCamp.winRate>g+10){const r=o.bestCamp.winRate-g;h.push({type:"strength",category:"camp",description:`Excelle en tant que ${o.bestCamp.camp} (+${r.toFixed(1)}% par rapport √† la moyenne)`,value:o.bestCamp.winRate,comparisonValue:g})}if(o.worstCamp.winRate<g-10&&o.worstCamp.camp!=="Inconnu"){const r=g-o.worstCamp.winRate;f.push({type:"weakness",category:"camp",description:`Performances plus faibles en tant que ${o.worstCamp.camp} (-${r.toFixed(1)}% par rapport √† la moyenne)`,value:o.worstCamp.winRate,comparisonValue:g})}return o.survivalRateWhenTargeted>60?h.push({type:"strength",category:"survival",description:`Fort taux de survie quand cibl√© lors des votes (${o.survivalRateWhenTargeted.toFixed(0)}%)`,value:o.survivalRateWhenTargeted}):o.survivalRateWhenTargeted<30&&o.survivalRateWhenTargeted>0&&f.push({type:"weakness",category:"survival",description:`Faible taux de survie quand cibl√© lors des votes (${o.survivalRateWhenTargeted.toFixed(0)}%)`,value:o.survivalRateWhenTargeted}),o.voteAccuracy>70?h.push({type:"strength",category:"voting",description:`Excellente pr√©cision de vote contre le camp adverse (${o.voteAccuracy.toFixed(0)}%)`,value:o.voteAccuracy}):o.voteAccuracy<40&&o.voteAccuracy>0&&f.push({type:"weakness",category:"voting",description:`Pr√©cision de vote √† am√©liorer (${o.voteAccuracy.toFixed(0)}% contre le camp adverse)`,value:o.voteAccuracy}),Object.entries(p.mapStats).forEach(([r,t])=>{if(t.appearances>=5){const i=parseFloat(t.winRate);i>S+15?h.push({type:"strength",category:"map",description:`Tr√®s performant sur ${r} (${i.toFixed(0)}% de victoires)`,value:i,comparisonValue:S}):i<S-15&&f.push({type:"weakness",category:"map",description:`Moins √† l'aise sur ${r} (${i.toFixed(0)}% de victoires)`,value:i,comparisonValue:S})}}),o.communicationLevel==="talkative"&&o.talkingTimePerGame>150&&h.push({type:"strength",category:"general",description:`Joueur tr√®s communicatif (${Math.round(o.talkingTimePerGame)}s de parole par partie en moyenne)`,value:o.talkingTimePerGame}),{strengths:h.slice(0,5),weaknesses:f.slice(0,5)}}function ns(s,c,o,h){const f=[],p={};c.forEach(l=>{l.PlayerStats.forEach(d=>{const b=d.Username;p[b]||(p[b]={games:0,wins:0,talkTime:0}),p[b].games++,d.Victorious&&p[b].wins++,p[b].talkTime+=(d.SecondsTalkedDuringMeeting||0)+(d.SecondsTalkedOutsideMeeting||0)})});const S=Object.entries(p).filter(([l,d])=>d.games>=10),v=S.map(([l,d])=>d.wins/d.games*100),u=v.length>0?v.reduce((l,d)=>l+d,0)/v.length:50;f.push({metric:"Taux de victoire",playerValue:o.winRate,globalAverage:u,difference:o.winRate-u,unit:"%"});const g=Re(c),r=g.playerAccuracyStats.filter(l=>l.totalVotes>=20).map(l=>l.accuracyRate),t=r.length>0?r.reduce((l,d)=>l+d,0)/r.length:50;f.push({metric:"Pr√©cision des votes",playerValue:h.voteAccuracy,globalAverage:t,difference:h.voteAccuracy-t,unit:"%"});const i=S.map(([l,d])=>d.talkTime/d.games),m=i.length>0?i.reduce((l,d)=>l+d,0)/i.length:60;f.push({metric:"Temps de parole moyen",playerValue:h.talkingTimePerGame,globalAverage:m,difference:h.talkingTimePerGame-m,unit:"s/partie"});const n=g.playerTargetStats.filter(l=>l.totalTimesTargeted>=5).map(l=>l.survivalRate),j=n.length>0?n.reduce((l,d)=>l+d,0)/n.length:50;return f.push({metric:"Survie quand cibl√©",playerValue:h.survivalRateWhenTargeted,globalAverage:j,difference:h.survivalRateWhenTargeted-j,unit:"%"}),f}function ls(s,c){const o=[],h=c.filter(d=>d.PlayerStats.some(b=>b.Username===s));if(h.length===0)return o;const f={};h.forEach(d=>{const b=d.PlayerStats.find(A=>A.Username===s);b?.Color&&(f[b.Color]||(f[b.Color]={games:0,wins:0}),f[b.Color].games++,b.Victorious&&f[b.Color].wins++)});const p=Object.entries(f).sort((d,b)=>b[1].games-d[1].games)[0];if(p&&p[1].games>=5){const d=(p[1].wins/p[1].games*100).toFixed(0);o.push({emoji:"üé®",title:"Couleur pr√©f√©r√©e",description:`${p[0]} (${p[1].games} parties, ${d}% victoires)`})}const S={};h.forEach(d=>{const b=d.PlayerStats.find(A=>A.Username===s);b?.KillerName&&b.KillerName!==s&&(S[b.KillerName]=(S[b.KillerName]||0)+1)});const v=Object.entries(S).sort((d,b)=>b[1]-d[1])[0];v&&v[1]>=3&&o.push({emoji:"üíÄ",title:"N√©m√©sis",description:`Tu√© ${v[1]} fois par ${v[0]}`});const u={};h.forEach(d=>{const b=d.PlayerStats.find(D=>D.Username===s);if(!b)return;const A=Q(ae(b.MainRoleInitial,b.MainRoleChanges||[]),{regroupWolfSubRoles:!0});d.PlayerStats.forEach(D=>{if(D.Username===s)return;const W=Q(ae(D.MainRoleInitial,D.MainRoleChanges||[]),{regroupWolfSubRoles:!0});A===W&&(u[D.Username]||(u[D.Username]={together:0,wins:0}),u[D.Username].together++,b.Victorious&&u[D.Username].wins++)})});const g=Object.entries(u).filter(([d,b])=>b.together>=5).map(([d,b])=>({name:d,winRate:b.wins/b.together*100,together:b.together})).sort((d,b)=>b.winRate-d.winRate)[0];g&&g.winRate>60&&o.push({emoji:"ü§ù",title:"Meilleur co√©quipier",description:`${g.winRate.toFixed(0)}% de victoires avec ${g.name} (${g.together} parties)`});let r=0,t=0;[...h].sort((d,b)=>new Date(d.StartDate).getTime()-new Date(b.StartDate).getTime()).forEach(d=>{d.PlayerStats.find(A=>A.Username===s)?.Victorious?(t++,r=Math.max(r,t)):t=0}),r>=5&&o.push({emoji:"üî•",title:"Meilleure s√©rie de victoires",description:`${r} victoires cons√©cutives`});const m={},n=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"];h.forEach(d=>{const b=d.PlayerStats.find(W=>W.Username===s);if(!b)return;const A=new Date(d.StartDate).getDay(),D=n[A];m[D]||(m[D]={games:0,wins:0}),m[D].games++,b.Victorious&&m[D].wins++});const j=Object.entries(m).filter(([d,b])=>b.games>=5).map(([d,b])=>({day:d,winRate:b.wins/b.games*100,games:b.games})).sort((d,b)=>b.winRate-d.winRate)[0];j&&j.winRate>60&&o.push({emoji:"üìÖ",title:"Meilleur jour",description:`${j.winRate.toFixed(0)}% de victoires le ${j.day}`});let l=0;return h.forEach(d=>{d.PlayerStats.forEach(b=>{if(b.KillerName===s){const A=d.PlayerStats.find(D=>D.Username===s);A&&Q(ae(A.MainRoleInitial,A.MainRoleChanges||[]),{regroupWolfSubRoles:!0})==="Loup"&&l++}})}),l>=10&&o.push({emoji:"üê∫",title:"Victimes en tant que Loup",description:`${l} joueurs √©limin√©s en tant que Loup`}),o.slice(0,6)}function os(s){const{data:c,isLoading:o,error:h}=be(),{joueursData:f,isLoading:p,error:S}=te(),{data:v,isLoading:u}=pe(s);return{data:F.useMemo(()=>{if(!s||!c?.GameStats)return null;const r=c.GameStats,t=f?.Players?.find(A=>A.Joueur===s)||null,i=ts(s,r,t);if(!i)return null;const m=rs(s,r),{strengths:n,weaknesses:j}=is(s,r,m),l=ns(s,r,i,m),d=ls(s,r),b=v?.allGamesAchievements?.slice(0,3)||[];return{identity:i,playstyle:m,strengths:n,weaknesses:j,comparisons:l,funFacts:d,topAchievements:b}},[s,c,f,v]),isLoading:o||p||u,error:h||S}}function cs({identity:s,playerColor:c}){const{navigateToGameDetails:o}=X();return e.jsxs("div",{className:"identity-card",children:[e.jsx("div",{className:"identity-accent-bar",style:{background:c?`linear-gradient(90deg, ${c}, var(--accent-primary), ${c})`:"linear-gradient(90deg, var(--accent-primary), var(--accent-secondary), var(--accent-primary))"}}),e.jsxs("div",{className:"identity-content",children:[e.jsxs("div",{className:"identity-avatar-section",children:[s.avatar?e.jsx("img",{src:s.avatar,alt:`Photo de ${s.name}`,className:"identity-avatar"}):e.jsx("div",{className:"identity-avatar-default",style:{"--player-color":c||"var(--accent-primary)"}}),(s.socialLinks.twitch||s.socialLinks.youtube)&&e.jsxs("div",{className:"identity-social-links",children:[s.socialLinks.twitch&&e.jsx("a",{href:s.socialLinks.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",title:"Twitch",children:"üì∫"}),s.socialLinks.youtube&&e.jsx("a",{href:s.socialLinks.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",title:"YouTube",children:"üé¨"})]})]}),e.jsxs("div",{className:"identity-info",children:[e.jsx("h1",{className:"identity-name",children:s.name}),e.jsxs("div",{className:"identity-quick-stats",children:[e.jsxs("div",{className:"quick-stat clickable",onClick:()=>o({selectedPlayer:s.name,fromComponent:"Profile - Total Parties"}),title:"Voir toutes les parties",children:[e.jsx("span",{className:"stat-value",children:s.totalGames}),e.jsx("span",{className:"stat-label",children:"Parties"})]}),e.jsxs("div",{className:"quick-stat clickable",onClick:()=>o({selectedPlayer:s.name,selectedPlayerWinMode:"wins-only",fromComponent:"Profile - Victoires"}),title:"Voir les victoires",children:[e.jsx("span",{className:"stat-value",children:s.totalWins}),e.jsx("span",{className:"stat-label",children:"Victoires"})]}),e.jsxs("div",{className:"quick-stat highlight",children:[e.jsxs("span",{className:"stat-value",children:[s.winRate.toFixed(1),"%"]}),e.jsx("span",{className:"stat-label",children:"Taux de victoire"})]}),e.jsxs("div",{className:"quick-stat",children:[e.jsx("span",{className:"stat-value",children:Ne(s.totalPlayTime)}),e.jsx("span",{className:"stat-label",children:"Temps de parole"})]})]}),e.jsxs("div",{className:"identity-period",children:[e.jsx("span",{className:"period-icon",children:"üìÖ"}),e.jsxs("span",{className:"period-text",children:["Actif du ",s.firstGameDate," au ",s.lastGameDate]})]}),s.color&&e.jsxs("div",{className:"identity-color",children:[e.jsx("span",{className:"color-icon",children:"üé®"}),e.jsxs("span",{className:"color-text",children:["Couleur pr√©f√©r√©e: ",s.color]})]})]})]})]})}function ds(s){switch(s){case"aggressive":return{label:"Agressif",emoji:"‚öîÔ∏è",description:"Vote souvent et sans h√©sitation"};case"cautious":return{label:"Prudent",emoji:"üõ°Ô∏è",description:"Pr√©f√®re observer avant de voter"};case"strategic":return{label:"Strat√©gique",emoji:"üéØ",description:"Vote de mani√®re r√©fl√©chie"};default:return{label:"Inconnu",emoji:"‚ùì",description:"Pas assez de donn√©es"}}}function ms(s){switch(s){case"talkative":return{label:"Bavard",emoji:"üó£Ô∏è"};case"moderate":return{label:"Mod√©r√©",emoji:"üí¨"};case"quiet":return{label:"Discret",emoji:"ü§´"};default:return{label:"Inconnu",emoji:"‚ùì"}}}function us(s){switch(s){case"survivor":return{label:"Survivant",emoji:"üëë"};case"late-game":return{label:"Fin de partie",emoji:"üåô"};case"mid-game":return{label:"Mi-partie",emoji:"‚òÄÔ∏è"};case"early-death":return{label:"D√©but de partie",emoji:"üíÄ"};default:return{label:"Inconnu",emoji:"‚ùì"}}}function ps({playstyle:s}){const c=ds(s.votingStyle),o=ms(s.communicationLevel),h=us(s.averageSurvivalTiming);return e.jsxs("div",{className:"player-page-section playstyle-section",children:[e.jsx("h2",{className:"section-title",children:"üéÆ Style de jeu"}),e.jsxs("div",{className:"playstyle-traits",children:[e.jsxs("div",{className:"trait-card",children:[e.jsxs("div",{className:"trait-header",children:[e.jsx("span",{className:"trait-emoji",children:c.emoji}),e.jsx("span",{className:"trait-category",children:"Votes"})]}),e.jsx("div",{className:"trait-value",children:c.label}),e.jsx("div",{className:"trait-description",children:c.description}),e.jsxs("div",{className:"trait-stats",children:[e.jsxs("div",{className:"mini-stat",children:[e.jsxs("span",{className:"mini-value",children:[s.votingRate.toFixed(0),"%"]}),e.jsx("span",{className:"mini-label",children:"Taux de vote"})]}),e.jsxs("div",{className:"mini-stat",children:[e.jsxs("span",{className:"mini-value",children:[s.voteAccuracy.toFixed(0),"%"]}),e.jsx("span",{className:"mini-label",children:"Pr√©cision"})]})]})]}),e.jsxs("div",{className:"trait-card",children:[e.jsxs("div",{className:"trait-header",children:[e.jsx("span",{className:"trait-emoji",children:o.emoji}),e.jsx("span",{className:"trait-category",children:"Communication"})]}),e.jsx("div",{className:"trait-value",children:o.label}),e.jsxs("div",{className:"trait-description",children:["~",Math.round(s.talkingTimePerGame),"s par partie"]}),e.jsx("div",{className:"trait-stats",children:e.jsxs("div",{className:"mini-stat",children:[e.jsxs("span",{className:"mini-value",children:[(s.talkingRatioMeetingVsOutside*100).toFixed(0),"%"]}),e.jsx("span",{className:"mini-label",children:"En r√©union"})]})})]}),e.jsxs("div",{className:"trait-card",children:[e.jsxs("div",{className:"trait-header",children:[e.jsx("span",{className:"trait-emoji",children:h.emoji}),e.jsx("span",{className:"trait-category",children:"Survie"})]}),e.jsx("div",{className:"trait-value",children:h.label}),e.jsx("div",{className:"trait-description",children:"Tendance de moment de mort"}),e.jsxs("div",{className:"trait-stats",children:[e.jsxs("div",{className:"mini-stat",children:[e.jsxs("span",{className:"mini-value",children:[s.survivalRate.toFixed(0),"%"]}),e.jsx("span",{className:"mini-label",children:"Survie globale"})]}),e.jsxs("div",{className:"mini-stat",children:[e.jsxs("span",{className:"mini-value",children:[s.survivalRateWhenTargeted.toFixed(0),"%"]}),e.jsx("span",{className:"mini-label",children:"Survie si cibl√©"})]})]})]})]}),e.jsxs("div",{className:"camp-performance",children:[e.jsx("h3",{className:"subsection-title",children:"Performance par camp"}),e.jsxs("div",{className:"camp-cards",children:[e.jsxs("div",{className:"camp-card favorite",children:[e.jsx("span",{className:"camp-emoji",children:"‚≠ê"}),e.jsxs("div",{className:"camp-info",children:[e.jsx("span",{className:"camp-label",children:"Camp pr√©f√©r√©"}),e.jsx("span",{className:"camp-value",children:s.favoriteCamp})]})]}),e.jsxs("div",{className:"camp-card best",children:[e.jsx("span",{className:"camp-emoji",children:"üèÜ"}),e.jsxs("div",{className:"camp-info",children:[e.jsx("span",{className:"camp-label",children:"Meilleur camp"}),e.jsxs("span",{className:"camp-value",children:[s.bestCamp.camp,e.jsxs("span",{className:"camp-rate",children:["(",s.bestCamp.winRate.toFixed(0),"%)"]})]})]})]}),s.worstCamp.camp!==s.bestCamp.camp&&s.worstCamp.camp!=="Inconnu"&&e.jsxs("div",{className:"camp-card worst",children:[e.jsx("span",{className:"camp-emoji",children:"üìâ"}),e.jsxs("div",{className:"camp-info",children:[e.jsx("span",{className:"camp-label",children:"Camp difficile"}),e.jsxs("span",{className:"camp-value",children:[s.worstCamp.camp,e.jsxs("span",{className:"camp-rate",children:["(",s.worstCamp.winRate.toFixed(0),"%)"]})]})]})]})]})]})]})}function je(s){switch(s){case"camp":return"üèïÔ∏è";case"map":return"üó∫Ô∏è";case"role":return"üé≠";case"voting":return"üó≥Ô∏è";case"survival":return"üí™";case"general":return"üìä";default:return"‚ú®"}}function hs({strengths:s,weaknesses:c}){const o=s.length>0,h=c.length>0;return!o&&!h?e.jsxs("div",{className:"player-page-section strengths-weaknesses-section",children:[e.jsx("h2",{className:"section-title",children:"üí° Points forts & Points faibles"}),e.jsx("p",{className:"no-data",children:"Pas assez de donn√©es pour analyser les forces et faiblesses."})]}):e.jsxs("div",{className:"player-page-section strengths-weaknesses-section",children:[e.jsx("h2",{className:"section-title",children:"üí° Points forts & Points faibles"}),e.jsxs("div",{className:"sw-container",children:[o&&e.jsxs("div",{className:"sw-column strengths-column",children:[e.jsxs("h3",{className:"sw-column-title",children:[e.jsx("span",{className:"sw-icon",children:"‚úÖ"}),"Points forts"]}),e.jsx("ul",{className:"sw-list",children:s.map((f,p)=>e.jsxs("li",{className:"sw-item strength-item",children:[e.jsx("span",{className:"sw-category-icon",children:je(f.category)}),e.jsx("span",{className:"sw-description",children:f.description})]},p))})]}),h&&e.jsxs("div",{className:"sw-column weaknesses-column",children:[e.jsxs("h3",{className:"sw-column-title",children:[e.jsx("span",{className:"sw-icon",children:"‚ö†Ô∏è"}),"Axes d'am√©lioration"]}),e.jsx("ul",{className:"sw-list",children:c.map((f,p)=>e.jsxs("li",{className:"sw-item weakness-item",children:[e.jsx("span",{className:"sw-category-icon",children:je(f.category)}),e.jsx("span",{className:"sw-description",children:f.description})]},p))})]})]})]})}function gs({comparisons:s}){return s.length===0?e.jsxs("div",{className:"player-page-section comparisons-section",children:[e.jsx("h2",{className:"section-title",children:"üìä Comparaison aux moyennes"}),e.jsx("p",{className:"no-data",children:"Pas assez de donn√©es pour comparer."})]}):e.jsxs("div",{className:"player-page-section comparisons-section",children:[e.jsx("h2",{className:"section-title",children:"üìä Comparaison aux moyennes"}),e.jsx("div",{className:"comparisons-list",children:s.map((c,o)=>{const h=c.difference>0,p=Math.abs(c.difference)>5;return e.jsxs("div",{className:"comparison-row",children:[e.jsx("div",{className:"comparison-label",children:c.metric}),e.jsxs("div",{className:"comparison-values",children:[e.jsxs("div",{className:`comparison-player-value ${h?"positive":"negative"}`,children:[c.playerValue.toFixed(1),c.unit]}),e.jsx("div",{className:"comparison-bar-container",children:e.jsxs("div",{className:"comparison-bar-bg",children:[e.jsx("div",{className:`comparison-bar-fill ${h?"positive":"negative"}`,style:{width:`${Math.min(Math.abs(c.difference)*2,50)}%`,[h?"left":"right"]:"50%"}}),e.jsx("div",{className:"comparison-bar-center"})]})}),e.jsxs("div",{className:`comparison-diff ${h?"positive":"negative"} ${p?"significant":""}`,children:[h?"+":"",c.difference.toFixed(1)]})]}),e.jsxs("div",{className:"comparison-average",children:[e.jsx("span",{className:"average-label",children:"Moyenne:"}),e.jsxs("span",{className:"average-value",children:[c.globalAverage.toFixed(1),c.unit]})]})]},o)})}),e.jsxs("div",{className:"comparisons-legend",children:[e.jsx("span",{className:"legend-item positive",children:"‚óè Au-dessus de la moyenne"}),e.jsx("span",{className:"legend-item negative",children:"‚óè En-dessous de la moyenne"})]})]})}function xs({funFacts:s}){return s.length===0?e.jsxs("div",{className:"player-page-section funfacts-section",children:[e.jsx("h2",{className:"section-title",children:"üéØ Faits int√©ressants"}),e.jsx("p",{className:"no-data",children:"Pas assez de donn√©es pour g√©n√©rer des faits int√©ressants."})]}):e.jsxs("div",{className:"player-page-section funfacts-section",children:[e.jsx("h2",{className:"section-title",children:"üéØ Faits int√©ressants"}),e.jsx("div",{className:"funfacts-grid",children:s.map((c,o)=>e.jsxs("div",{className:"funfact-card",children:[e.jsx("div",{className:"funfact-emoji",children:c.emoji}),e.jsxs("div",{className:"funfact-content",children:[e.jsx("h4",{className:"funfact-title",children:c.title}),e.jsx("p",{className:"funfact-description",children:c.description})]})]},o))})]})}function fs(){const{settings:s}=oe(),{navigateBack:c}=X(),o=s.highlightedPlayer,{joueursData:h}=te(),f=ce(h),{data:p,isLoading:S,error:v}=os(o),{data:u,isLoading:g,error:r}=pe(o);return o?S?e.jsx("div",{className:"player-page-container",children:e.jsxs("div",{className:"player-page-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsxs("p",{children:["Chargement du profil de ",o,"..."]})]})}):v?e.jsx("div",{className:"player-page-container",children:e.jsxs("div",{className:"player-page-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsx("p",{children:v}),e.jsx("button",{className:"back-button",onClick:()=>c(),type:"button",children:"‚Üê Retour"})]})}):p?e.jsxs("div",{className:"player-page-container",children:[e.jsx(cs,{identity:p.identity,playerColor:f[o]}),e.jsxs("div",{className:"player-page-grid",children:[e.jsxs("div",{className:"player-page-column",children:[e.jsx(ps,{playstyle:p.playstyle}),e.jsx(hs,{strengths:p.strengths,weaknesses:p.weaknesses})]}),e.jsxs("div",{className:"player-page-column",children:[e.jsx(gs,{comparisons:p.comparisons}),e.jsx(xs,{funFacts:p.funFacts})]})]}),e.jsxs("div",{className:"player-page-section player-page-achievements",children:[e.jsx("h2",{className:"section-title",children:"üèÜ Classements"}),g?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner small"}),e.jsx("p",{children:"Chargement des classements..."})]}):r?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["‚ùå Erreur: ",r]})}):u?e.jsx(Ae,{achievements:u.allGamesAchievements,title:"",emptyMessage:"Aucun classement disponible",achievementType:"all"}):e.jsx("p",{className:"no-achievements",children:"Aucun classement disponible pour ce joueur."})]})]}):e.jsx("div",{className:"player-page-container",children:e.jsxs("div",{className:"player-page-empty",children:[e.jsx("h2",{children:"Joueur non trouv√©"}),e.jsxs("p",{children:["Aucune donn√©e trouv√©e pour ",o,"."]}),e.jsx("button",{className:"back-button",onClick:()=>c(),type:"button",children:"‚Üê Retour"})]})}):e.jsx("div",{className:"player-page-container",children:e.jsxs("div",{className:"player-page-empty",children:[e.jsx("h2",{children:"Aucun joueur s√©lectionn√©"}),e.jsx("p",{children:'S√©lectionnez un joueur depuis la page "Joueur" pour voir son profil d√©taill√©.'}),e.jsx("button",{className:"back-button",onClick:()=>c(),type:"button",children:"‚Üê Retour √† la s√©lection"})]})})}function vs({selectedPlayerName:s,groupingMethod:c,campFilter:o="all"}){const{navigateToGameDetails:h}=X(),{data:f,isLoading:p,error:S}=de(s),v=F.useMemo(()=>{switch(c){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par Ann√©e";default:return"par Session"}},[c]),u=F.useMemo(()=>{if(!f?.games)return new Map;const i=new Map;return f.games.forEach(m=>{if(!i.has(m.date)){const n=m.date.split("/");n.length===3?i.set(m.date,new Date(parseInt(n[2]),parseInt(n[1])-1,parseInt(n[0])).getTime()):i.set(m.date,new Date(m.date).getTime())}}),i},[f?.games]),g=F.useMemo(()=>{if(!f?.games)return[];const i={};return f.games.forEach(m=>{if(o!=="all"){if(o==="solo"){if(m.camp==="Villageois"||m.camp==="Loup")return}else if(m.camp!==o)return}let n;const j=m.date.split("/");if(c==="month")if(j.length===3)n=`${j[1].padStart(2,"0")}/${j[2]}`;else{const l=new Date(m.date);n=`${String(l.getMonth()+1).padStart(2,"0")}/${l.getFullYear()}`}else if(c==="quarter")if(j.length===3){const l=parseInt(j[1],10);n=`T${Math.floor((l-1)/3)+1}/${j[2]}`}else{const l=new Date(m.date);n=`T${Math.floor(l.getMonth()/3)+1}/${l.getFullYear()}`}else c==="year"?j.length===3?n=`${j[2]}`:n=`${new Date(m.date).getFullYear()}`:n=m.date;i[n]||(i[n]={games:[],wins:0,total:0}),i[n].games.push(m),i[n].total++,m.won&&i[n].wins++}),Object.entries(i).map(([m,n])=>({period:m,totalGames:n.total,victories:n.wins,defeats:n.total-n.wins,winRate:n.total>0?(n.wins/n.total*100).toFixed(1):"0.0",winRateNum:n.total>0?n.wins/n.total*100:0})).sort((m,n)=>{if(c==="month"){const[j,l]=m.period.split("/"),[d,b]=n.period.split("/"),A=new Date(parseInt(l),parseInt(j)-1,1),D=new Date(parseInt(b),parseInt(d)-1,1);return A.getTime()-D.getTime()}else if(c==="quarter"){const[j,l]=m.period.split("/"),[d,b]=n.period.split("/"),A=parseInt(j.replace(/\D/g,""),10)||1,D=parseInt(d.replace(/\D/g,""),10)||1,W=new Date(parseInt(l,10),(A-1)*3,1),w=new Date(parseInt(b,10),(D-1)*3,1);return W.getTime()-w.getTime()}else if(c==="year"){const j=parseInt(m.period,10),l=parseInt(n.period,10);return j-l}else{const j=u.get(m.period)||0,l=u.get(n.period)||0;return j-l}})},[f,c,u,o]),t=(i=>i<=15?{fontSize:12,angle:-45,height:80,interval:0}:i<=30?{fontSize:12,angle:-45,height:85,interval:1}:i<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(i/12)})(g.length);return p?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):S?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",S]}):f?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["√âvolution des Performances ",v]}),e.jsx(B,{title:`√âvolution des Performances ${v}`,children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(qe,{data:g,margin:{top:20,right:30,left:20,bottom:20},onClick:i=>{if(i&&i.activeLabel){const m=g.find(n=>n.period===i.activeLabel);m&&h({selectedPlayer:s,selectedDate:m.period,fromComponent:`√âvolution des Performances ${v}`})}},style:{cursor:"pointer"},children:[e.jsx(O,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"period",angle:t.angle,textAnchor:"end",height:t.height,interval:t.interval,fontSize:t.fontSize}),e.jsx(H,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(V,{content:({active:i,payload:m})=>{if(i&&m&&m.length>0){const n=m[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.period})}),e.jsxs("div",{children:["Parties: ",n.totalGames]}),e.jsxs("div",{children:["Victoires: ",n.victories]}),e.jsxs("div",{children:["Taux: ",n.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(Ge,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["R√©partition Victoires/D√©faites ",v]}),e.jsx(B,{title:`R√©partition Victoires/D√©faites ${v}`,children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:g,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(O,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"period",angle:t.angle,textAnchor:"end",height:t.height,interval:t.interval,fontSize:t.fontSize}),e.jsx(H,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(V,{content:({active:i,payload:m})=>{if(i&&m&&m.length>0){const n=m[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.period})}),e.jsxs("div",{children:["Total: ",n.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",n.victories]}),e.jsxs("div",{children:["D√©faites: ",n.defeats]}),e.jsxs("div",{children:["Taux: ",n.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(U,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:g.map((i,m)=>e.jsx(_,{fill:"var(--accent-tertiary)",onClick:()=>{h({selectedPlayer:s,selectedDate:i.period,fromComponent:`Historique Joueur - Victoires ${v}`})},style:{cursor:"pointer"}},`cell-victories-${m}`))}),e.jsx(U,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"D√©faites",children:g.map((i,m)=>e.jsx(_,{fill:"var(--chart-color-4)",onClick:()=>{h({selectedPlayer:s,selectedDate:i.period,fromComponent:`Historique Joueur - D√©faites ${v}`})},style:{cursor:"pointer"}},`cell-defeats-${m}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e d'historique disponible"})}function js({selectedPlayerName:s}){const{navigateToGameDetails:c}=X(),{data:o,isLoading:h,error:f}=de(s),p=ne(),S=F.useMemo(()=>o?.campStats?Object.entries(o.campStats).map(([u,g])=>({name:u,value:g.appearances,winRate:g.winRate,winRateDisplay:Math.max(parseFloat(g.winRate),1),wins:g.wins,percentage:(g.appearances/o.totalGames*100).toFixed(1)})):[],[o]),v=F.useMemo(()=>{if(!S.length)return[];const u=5;let g=0;const r=[],t=[];if(S.forEach(i=>{parseFloat(i.percentage)<u?(g+=Number(i.value),r.push(i)):t.push(i)}),g>0){const i=S.reduce((m,n)=>m+Number(n.value),0);t.push({name:"Autres",value:g,winRate:"0.0",winRateDisplay:1,wins:r.reduce((m,n)=>m+n.wins,0),percentage:(g/i*100).toFixed(1),_details:r})}return t},[S]);return h?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):f?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",f]}):o?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(ke,{children:[e.jsx(Pe,{data:v,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:u=>{const g=u.percent!==void 0?u.percent:0;return u.name==="Autres"?`Autres : ${u.value} (${(g*100).toFixed(1)}%)`:`${u.name}: ${u.value} (${(g*100).toFixed(1)}%)`},children:v.map((u,g)=>e.jsx(_,{fill:u.name==="Autres"?Se:p[u.name]||`var(--chart-color-${g%6+1})`,onClick:()=>{if(u.name==="Autres"){const r=u._details?.map(t=>t.name)||[];c({selectedPlayer:s,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:r},fromComponent:"Distribution par Camps"})}else u.name==="Tra√Ætre"||u.name==="Louveteau"?c({selectedPlayer:s,campFilter:{selectedCamp:u.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):u.name==="Loup"?c({selectedPlayer:s,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):c({selectedPlayer:s,campFilter:{selectedCamp:u.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${g}`))}),e.jsx(V,{content:({active:u,payload:g})=>{if(u&&g&&g.length>0){const r=g[0].payload;if(r.name==="Autres"&&r._details){const t=[...r._details].sort((i,m)=>m.value-i.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",r.value," parties (",r.percentage,"%)"]})}),e.jsx("div",{children:t.map((i,m)=>e.jsxs("div",{children:[i.name,": ",i.value," parties (",i.percentage,"%)"]},m))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[r.name," - ",r.value," parties (",r.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(B,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:S,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(O,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(V,{content:({active:u,payload:g})=>{if(u&&g&&g.length>0){const r=g[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.name})}),e.jsxs("div",{children:["Victoires: ",r.wins," / ",r.value]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(U,{dataKey:"winRateDisplay",children:S.map((u,g)=>e.jsx(_,{fill:parseFloat(u.winRate)===0?`${p[u.name]||`var(--chart-color-${g%6+1})`}50`:p[u.name]||`var(--chart-color-${g%6+1})`,onClick:()=>{u.name==="Tra√Ætre"||u.name==="Louveteau"?c({selectedPlayer:s,campFilter:{selectedCamp:u.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):u.name==="Loup"?c({selectedPlayer:s,campFilter:{selectedCamp:u.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):c({selectedPlayer:s,campFilter:{selectedCamp:u.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${g}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e d'historique disponible"})}function ys({selectedPlayerName:s}){const{navigateToGameDetails:c,navigationState:o,updateNavigationState:h}=X(),[f,p]=F.useState(o.playerHistoryMapState?.selectedCamp||"Tous les camps"),{data:S}=Ve(),{data:v,isLoading:u,error:g}=de(s,f);F.useEffect(()=>{(!o.playerHistoryMapState||o.playerHistoryMapState.selectedCamp!==f)&&h({playerHistoryMapState:{selectedCamp:f}})},[f,o.playerHistoryMapState,h]);const r=i=>{p(i),h({playerHistoryMapState:{selectedCamp:i}})},t=F.useMemo(()=>{if(!v?.mapStats)return[];const i=as(v.mapStats);return Object.entries(i).map(([m,n])=>({name:m,value:n.appearances,winRate:n.winRate,winRateDisplay:Math.max(parseFloat(n.winRate),.1),wins:n.wins,percentage:(n.appearances/v.totalGames*100).toFixed(1)}))},[v]);return u?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):g?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]}):v?e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Performance par Carte",f!=="Tous les camps"?` (${f})`:""]}),e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select-map",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select-map",value:f,onChange:i=>r(i.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),S?.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),t.length===0?e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donn√©e de carte disponible"}),e.jsx("p",{children:"Aucune statistique de carte n'est disponible pour ce joueur avec le camp s√©lectionn√©."})]}):e.jsx(B,{title:"Performance par Carte",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:t,margin:{top:20,right:140,left:20,bottom:20},children:[e.jsx(O,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(he,{y:50,stroke:"var(--text-secondary)",strokeDasharray:"5 5",strokeOpacity:.5}),(()=>{if(t.length>0){const i=t.reduce((j,l)=>j+l.value,0),m=t.reduce((j,l)=>j+l.wins,0),n=i>0?m/i*100:0;if(n!==50)return e.jsx(he,{y:n,stroke:"var(--accent-primary)",strokeDasharray:"3 3",strokeOpacity:.7,label:{value:`Moyenne: ${n.toFixed(1)}%`,position:"right",offset:5,style:{fill:"var(--accent-primary)"}}})}return null})(),e.jsx(V,{content:({active:i,payload:m})=>{if(i&&m&&m.length>0){const n=m[0].payload,j=[];return t.forEach(l=>{if(l.name!==n.name&&l.value>=5){const d=parseFloat(n.winRate)-parseFloat(l.winRate);Math.abs(d)>=2&&j.push({map:l.name,diff:d,better:d>0})}}),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:"250px"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.name})}),e.jsxs("div",{children:["Parties: ",n.value]}),e.jsxs("div",{children:["Victoires: ",n.wins]}),e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("strong",{children:["Taux: ",n.winRate,"%"]})}),j.length>0&&e.jsxs("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"0.8rem",fontWeight:"bold",marginBottom:"0.25rem"},children:"Comparaisons:"}),j.map((l,d)=>e.jsxs("div",{style:{fontSize:"0.75rem",color:l.better?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[l.better?"‚Üó":"‚Üò"," ",Math.abs(l.diff).toFixed(1),"% vs ",l.map]},d))]}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(U,{dataKey:"winRateDisplay",label:i=>{const{x:m,y:n,width:j,payload:l}=i;if(m===void 0||n===void 0||j===void 0||!l)return null;const d=l.winRate||"0";return e.jsxs("text",{x:m+j/2,y:n-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[d,"%"]})},onClick:i=>{if(i&&i.name){const m={selectedPlayer:s,selectedMapName:i.name,fromComponent:"Performance par Carte"};f!=="Tous les camps"&&(m.campFilter={selectedCamp:f,campFilterMode:"all-assignments"}),c(m)}},children:t.map((i,m)=>{let n;i.name==="Village"?n="var(--accent-secondary)":i.name==="Ch√¢teau"?n="var(--accent-tertiary)":i.name==="Autres"?n=Se:n=`var(--chart-color-${m%6+1})`;const j=Math.max(...t.map(d=>parseFloat(d.winRate))),l=parseFloat(i.winRate)===j&&j>0;return e.jsx(_,{fill:parseFloat(i.winRate)===0?`${n}30`:n,stroke:"transparent",strokeWidth:l?3:1,style:{cursor:"pointer"}},`cell-map-${m}`)})})]})})})})]})}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e d'historique disponible"})}function bs({selectedPlayerName:s}){const{gameData:c}=we(),{joueursData:o}=te(),h=ce(o),f=ne(),p=F.useMemo(()=>{if(!c||!s)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const v={},u={},g={},r=new Set;c.forEach(j=>{const l=j.PlayerStats.find(d=>d.Username.toLowerCase()===s.toLowerCase());if(l&&(j.PlayerStats.forEach(d=>{d.KillerName?.toLowerCase()===s.toLowerCase()&&(v[d.Username]=(v[d.Username]||0)+1)}),l.KillerName&&(u[l.KillerName]=(u[l.KillerName]||0)+1),l.DeathType)){const d=l.DeathType,b=le(d);g[b]||(g[b]={count:0,byDeathType:{}}),g[b].count+=1,g[b].byDeathType[d]=(g[b].byDeathType[d]||0)+1,r.add(d)}});const t=Object.entries(v).map(([j,l])=>({player:j,kills:l})).sort((j,l)=>l.kills-j.kills).slice(0,10),i=Object.entries(u).map(([j,l])=>({player:j,kills:l})).sort((j,l)=>l.kills-j.kills).slice(0,10),m=Object.entries(g).map(([j,l])=>{const d={deathType:j,count:l.count};return d[j]=l.count,d}).sort((j,l)=>l.count-j.count).slice(0,10),n=Object.keys(g);return{playersKilled:t,killedBy:i,deathTypes:m,availableDeathTypes:n}},[c,s]),S=F.useMemo(()=>{const v={};p.availableDeathTypes.forEach(r=>{r==="Tu√© par Loup"?v[r]=f.Loup:r==="Mort aux votes"?v[r]="var(--chart-color-1)":r.includes("Chasseur")?v[r]=f.Chasseur:r==="Tu√© par Zombie"?v[r]=f.Vaudou:r==="Tu√© par potion assassin"?v[r]=f.Alchimiste:r==="Tu√© par Vengeur"?v[r]="var(--chart-color-2)":r==="Amoureux mort"?v[r]=f.Amoureux:r==="Tu√© par La B√™te"?v[r]="var(--chart-color-3)":r==="Tu√© par Sh√©rif"&&(v[r]="var(--chart-color-4)")});const u=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let g=0;return p.availableDeathTypes.forEach(r=>{v[r]||(v[r]=u[g%u.length],g++)}),v},[p.availableDeathTypes,f]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[p.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(B,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:p.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(O,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(V,{content:({active:v,payload:u})=>{if(v&&u&&u.length>0){const g=u[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:g.player})}),e.jsxs("div",{children:["Tu√© ",g.kills," fois par ",s]})]})}return null}}),e.jsx(U,{dataKey:"kills",children:p.playersKilled.map((v,u)=>e.jsx(_,{fill:h[v.player]||"var(--chart-color-3)"},`cell-killed-${u}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistr√©"}),e.jsxs("p",{children:[s," n'a tu√© aucun joueur dans les parties enregistr√©es."]})]}),p.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(B,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:p.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(O,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(V,{content:({active:v,payload:u})=>{if(v&&u&&u.length>0){const g=u[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:g.player})}),e.jsxs("div",{children:["A tu√© ",s," ",g.kills," fois"]})]})}return null}}),e.jsx(U,{dataKey:"kills",children:p.killedBy.map((v,u)=>e.jsx(_,{fill:h[v.player]||"var(--chart-color-4)"},`cell-killer-${u}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[s," n'a jamais √©t√© tu√© par un autre joueur dans les parties enregistr√©es."]})]}),p.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus Fr√©quents"}),e.jsx(B,{title:"Types de Mort les Plus Fr√©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:p.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(O,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(H,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(V,{content:({active:v,payload:u})=>{if(v&&u&&u.length>0){const g=u[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:g.deathType})}),e.jsxs("div",{children:[s," est mort ",g.count," fois ainsi"]})]})}return null}}),p.availableDeathTypes.map(v=>e.jsx(U,{dataKey:v,name:v,stackId:"deaths",fill:S[v]||"var(--chart-color-5)"},v))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donn√©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",s,"."]})]})]})}function ws(s,c){if(!s||s.trim()===""||c.length===0)return null;const o=new Map,h=new Map,f=new Map;c.forEach(g=>{if(!g.Modded)return;const r=g.PlayerStats.find(t=>ee(t)===s||t.Username.toLowerCase()===s.toLowerCase());if(r){if(r.MainRoleInitial==="Inconnu")return;const t=r.Victorious,m=ae(r.MainRoleInitial,r.MainRoleChanges||[])!==r.MainRoleInitial,n=Q(r.MainRoleInitial),j=n==="Loup"||n==="Tra√Ætre"||n==="Louveteau";if(n==="Villageois"&&ge(r)){const l=xe(r);if(l&&Be.includes(l)){const d=o.get(l)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};o.set(l,{appearances:d.appearances+1,wins:d.wins+(t?1:0),winsWithoutRoleChange:d.winsWithoutRoleChange+(!m&&t?1:0),gamesWithoutRoleChange:d.gamesWithoutRoleChange+(m?0:1)})}}else if(r.Power&&r.Power.trim()!==""&&r.Power!=="Inconnu"){if(n==="Villageois"){const l=o.get(r.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};o.set(r.Power,{appearances:l.appearances+1,wins:l.wins+(t?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!m&&t?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(m?0:1)})}else if(j){const l=h.get(r.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},d=l.roleBreakdown;d.set(r.MainRoleInitial,(d.get(r.MainRoleInitial)||0)+1),h.set(r.Power,{appearances:l.appearances+1,wins:l.wins+(t?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!m&&t?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(m?0:1),roleBreakdown:d})}}else if((n==="Villageois"||j)&&r.Power!=="Inconnu")if(n==="Villageois"){const l=o.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};o.set("Aucun pouvoir",{appearances:l.appearances+1,wins:l.wins+(t?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!m&&t?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(m?0:1)})}else{const l=h.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},d=l.roleBreakdown;d.set(r.MainRoleInitial,(d.get(r.MainRoleInitial)||0)+1),h.set("Aucun pouvoir",{appearances:l.appearances+1,wins:l.wins+(t?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!m&&t?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(m?0:1),roleBreakdown:d})}if(r.SecondaryRole&&r.SecondaryRole.trim()!==""&&r.SecondaryRole!=="Inconnu"){const l=f.get(r.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};f.set(r.SecondaryRole,{appearances:l.appearances+1,wins:l.wins+(t?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!m&&t?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(m?0:1)})}}});const p=new Map;c.forEach(g=>{const r=g.PlayerStats.find(t=>ee(t)===s||t.Username.toLowerCase()===s.toLowerCase());if(r&&ge(r)){const t=xe(r);t&&p.set(t,(p.get(t)||0)+1)}});const S=g=>Array.from(g.entries()).map(([r,t])=>({name:r,appearances:t.appearances,wins:t.wins,winsWithoutRoleChange:t.winsWithoutRoleChange,gamesWithoutRoleChange:t.gamesWithoutRoleChange,winRate:t.gamesWithoutRoleChange>0?(t.winsWithoutRoleChange/t.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...p.has(r)&&{totalGamesAllModes:p.get(r)}})).sort((r,t)=>t.appearances-r.appearances),v=g=>Array.from(g.entries()).map(([r,t])=>({name:r,appearances:t.appearances,wins:t.wins,winsWithoutRoleChange:t.winsWithoutRoleChange,gamesWithoutRoleChange:t.gamesWithoutRoleChange,winRate:t.gamesWithoutRoleChange>0?(t.winsWithoutRoleChange/t.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(t.roleBreakdown.entries()).map(([i,m])=>({role:i,count:m})).sort((i,m)=>m.count-i.count)})).sort((r,t)=>t.appearances-r.appearances),u=g=>Array.from(g.entries()).map(([r,t])=>({name:r,appearances:t.appearances,wins:t.wins,winsWithoutRoleChange:t.winsWithoutRoleChange,gamesWithoutRoleChange:t.gamesWithoutRoleChange,winRate:t.gamesWithoutRoleChange>0?(t.winsWithoutRoleChange/t.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((r,t)=>t.appearances-r.appearances);return{villageoisPowers:S(o),loupPowers:v(h),secondaryRoles:u(f)}}function Cs({selectedPlayerName:s}){const{navigateToGameDetails:c,navigationState:o,updateNavigationState:h}=X(),f=ne(),[p,S]=F.useState(o.playerHistoryRolesState?.chartMode||"appearances"),{data:v,isLoading:u,error:g}=ue(d=>ws(s,d));F.useEffect(()=>{(!o.playerHistoryRolesState||o.playerHistoryRolesState.chartMode!==p)&&h({playerHistoryRolesState:{chartMode:p}})},[p,o.playerHistoryRolesState,h]);const r=d=>{S(d),h({playerHistoryRolesState:{chartMode:d}})},t=F.useMemo(()=>{if(!v)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const d=1,b=1,A=15,D=p==="winRate"?(w,N)=>parseFloat(N.winRate)-parseFloat(w.winRate):(w,N)=>N.appearances-w.appearances,W=w=>({...w,winRateDisplay:Math.max(parseFloat(w.winRate),1)});return{villageoisPowers:v.villageoisPowers.filter(w=>w.appearances>=d).map(W).sort(D).slice(0,A),loupPowers:v.loupPowers.filter(w=>w.appearances>=d).map(W).sort(D).slice(0,A),secondaryRoles:v.secondaryRoles.filter(w=>w.appearances>=b).map(W).sort(D).slice(0,A)}},[v,p]);if(u)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des r√¥les..."});if(g)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]});if(!v)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de r√¥le disponible"});const i=t.villageoisPowers.length>0,m=t.loupPowers.length>0,n=t.secondaryRoles.length>0;if(!i&&!m&&!n)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou r√¥le secondaire trouv√©"});const j=({active:d,payload:b})=>{if(d&&b&&b.length>0){const A=b[0].payload,D=A.gamesWithoutRoleChange<A.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:A.name})}),e.jsxs("div",{children:["Apparitions: ",A.appearances]}),D&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",A.appearances-A.gamesWithoutRoleChange," avec changement de r√¥le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",A.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",A.winRate,"%"]})}),A.totalGamesAllModes&&A.totalGamesAllModes!==A.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non modd√©es: ",A.totalGamesAllModes,")"]}),A.roleBreakdown&&A.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"R√©partition par r√¥le:"}),A.roleBreakdown.map((W,w)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["‚Ä¢ ",W.role,": ",W.count]},w))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null},l=(d,b,A,D,W)=>{const w=p==="appearances"?"appearances":"winRateDisplay",N=p==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",a=p==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:b}),e.jsx(B,{title:b,children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:d,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(O,{strokeDasharray:"3 3"}),e.jsx(K,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:N,angle:270,position:"left",style:{textAnchor:"middle"}},domain:a}),e.jsx(V,{content:e.jsx(j,{})}),e.jsx(U,{dataKey:w,label:p==="winRate"?k=>{const{x:M,y:x,width:y,payload:P}=k;if(M===void 0||x===void 0||y===void 0||!P)return null;const T=P.winRate||"0";return e.jsxs("text",{x:M+y/2,y:x-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[T,"%"]})}:void 0,children:d.map((k,M)=>e.jsx(_,{fill:W?W(k.name,M):A,onClick:()=>D(k.name),style:{cursor:"pointer"}},`cell-${M}`))})]})})})})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:p,onChange:d=>r(d.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[i&&l(t.villageoisPowers,"Camp Villageois","var(--chart-color-1)",d=>{c({selectedPlayer:s,campFilter:{selectedCamp:"Villageois",campFilterMode:p==="winRate"?"wins-only":"all-assignments"},selectedPower:d,fromComponent:`Historique des R√¥les - Pouvoir: ${d}`})},d=>d==="Chasseur"&&f.Chasseur?f.Chasseur:d==="Alchimiste"&&f.Alchimiste?f.Alchimiste:d==="Protecteur"&&f.Protecteur?f.Protecteur:d==="Disciple"&&f.Disciple?f.Disciple:"var(--chart-color-1)"),m&&l(t.loupPowers,"Camp Loups","var(--chart-color-2)",d=>{c({selectedPlayer:s,campFilter:{selectedCamp:"Loup",campFilterMode:p==="winRate"?"wins-only":"all-assignments"},selectedPower:d,fromComponent:`Historique des R√¥les - Pouvoir: ${d}`})},()=>f.Loup||"var(--chart-color-2)"),n&&l(t.secondaryRoles,"R√¥les Secondaires","var(--chart-color-3)",d=>{c({selectedPlayer:s,selectedSecondaryRole:d,fromComponent:`Historique des R√¥les - R√¥le Secondaire: ${d}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"‚ÑπÔ∏è Les victoires et le taux de victoire excluent les parties o√π le r√¥le principal a chang√© en cours de partie (ex: Garde en Chasseur, r√©ssucit√© en Zombie par un Vaudou, etc...)."})]})]})}function ye(s){return s==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":s}function Ss({selectedPlayerName:s}){const{navigateToGameDetails:c}=X(),{gameData:o,isLoading:h,error:f}=we(),p=ne(),[S,v]=F.useState("deaths"),[u,g]=F.useState(""),[r,t]=F.useState(0),i=F.useMemo(()=>{if(!o)return[];const w=new Set;return o.forEach(N=>{const a=N.PlayerStats.find(k=>k.Username.toLowerCase()===s.toLowerCase());a&&(a.DeathPosition!==null&&N.MapName&&w.add(N.MapName),N.PlayerStats.forEach(k=>{k.KillerName?.toLowerCase()===s.toLowerCase()&&k.DeathPosition!==null&&N.MapName&&w.add(N.MapName)}))}),Array.from(w).filter(N=>N==="Village"||N==="Ch√¢teau").sort((N,a)=>N==="Village"?-1:a==="Village"?1:N.localeCompare(a))},[o,s]),m=i.length>0?i[0]:"";u===""&&m!==""&&g(m);const n=F.useMemo(()=>{if(!o||!s)return[];const w=[];return o.forEach(N=>{if(u&&N.MapName!==u)return;const a=N.PlayerStats.find(k=>k.Username.toLowerCase()===s.toLowerCase());if(a)if(S==="deaths"){if(a.DeathPosition){const k=Q(a.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),M=fe(a.DeathPosition.x,a.DeathPosition.z,N.MapName);w.push({x:M.x,z:M.z,victimName:a.Username,killerName:a.KillerName||null,deathType:ye(a.DeathType),mapName:N.MapName,camp:k,gameId:N.DisplayedId,displayedGameId:N.DisplayedId})}}else N.PlayerStats.forEach(k=>{if(k.KillerName?.toLowerCase()===s.toLowerCase()&&k.DeathPosition){const M=Q(k.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),x=fe(k.DeathPosition.x,k.DeathPosition.z,N.MapName);w.push({x:x.x,z:x.z,victimName:k.Username,killerName:s,deathType:ye(k.DeathType),mapName:N.MapName,camp:M,gameId:N.DisplayedId,displayedGameId:N.DisplayedId})}})}),w},[o,s,S,u]),j=F.useMemo(()=>Ke(n,r).map((N,a)=>{const k=N.items[0],M=He(N.items);return{x:N.centroidX,z:N.centroidZ,count:N.items.length,allLocations:N.items,victimName:N.items.length===1?k.victimName:null,killerName:N.items.length===1?k.killerName:null,deathType:M,mapName:k.mapName,camp:k.camp,gameId:N.items.length===1?k.gameId:null,displayedGameId:N.items.length===1?k.displayedGameId:null,clusterIndex:a}}),[n,r]),l=F.useMemo(()=>Ue(u),[u]),{xDomain:d,zDomain:b}=F.useMemo(()=>{if(l)return{xDomain:[l.xMin,l.xMax],zDomain:[l.zMin,l.zMax]};if(j.length===0)return{xDomain:[0,100],zDomain:[0,100]};const w=j.map(T=>T.x),N=j.map(T=>T.z),a=Math.min(...w),k=Math.max(...w),M=Math.min(...N),x=Math.max(...N),y=(k-a)*.1||10,P=(x-M)*.1||10;return{xDomain:[a-y,k+y],zDomain:[M-P,x+P]}},[j,l]),A=w=>w?w==="BY_WOLF"||w==="SURVIVALIST_NOT_SAVED"?p.Loup:w==="VOTED"?"var(--chart-color-1)":w==="BULLET"||w==="BULLET_HUMAN"||w==="BULLET_WOLF"?p.Chasseur:w==="BY_ZOMBIE"?p.Vaudou:w==="ASSASSIN"?p.Alchimiste:w==="AVENGER"?"var(--chart-color-2)":w==="LOVER_DEATH"?p.Amoureux:w==="BY_BEAST"?"var(--chart-color-3)":w==="SHERIF_SUCCESS"?"var(--chart-color-4)":w==="SMUGGLER_HUNT_KILL"?p.Contrebandier:"var(--accent-primary-text)":"var(--text-secondary)",D=({active:w,payload:N})=>{if(!w||!N||N.length===0)return null;const a=N[0].payload,k=a.allLocations||[a];if(k.length>1){const y=new Map,P=new Map,T=new Set;k.forEach(I=>{y.set(I.victimName,(y.get(I.victimName)||0)+1);const z=I.deathType?le(I.deathType):"Inconnu";P.set(z,(P.get(z)||0)+1),T.add(I.gameId)});const R=Array.from(y.entries()).sort((I,z)=>z[1]-I[1]).slice(0,3),$=Array.from(P.entries()).sort((I,z)=>z[1]-I[1]).slice(0,3);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[S==="deaths"?"üíÄ":"‚öîÔ∏è"," ",k.length," ",S==="deaths"?"morts":"kills"," √† cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:S==="deaths"?"Par:":"Victimes:"}),R.map(([I,z])=>e.jsxs("div",{style:{paddingLeft:"0.5rem"},children:["‚Ä¢ ",I," (",z,"x)"]},I)),y.size>3&&e.jsxs("div",{style:{paddingLeft:"0.5rem",color:"var(--text-secondary)"},children:["+",y.size-3," autres..."]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Types de mort:"}),$.map(([I,z])=>e.jsxs("div",{style:{paddingLeft:"0.5rem"},children:["‚Ä¢ ",I," (",z,"x)"]},I))]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["üìç ",T.size," partie",T.size>1?"s":""," diff√©rente",T.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concern√©es"})]})}const x=k[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[S==="deaths"?"üíÄ":"‚öîÔ∏è"," ",S==="deaths"?"Mort de":"Kill de"," ",s]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[S==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["üéØ ",e.jsx("strong",{children:"Tu√© par:"})," ",x.killerName||"Inconnu"]}),e.jsxs("div",{children:["‚ö∞Ô∏è ",e.jsx("strong",{children:"Cause:"})," ",x.deathType?le(x.deathType):"Inconnue"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["üéØ ",e.jsx("strong",{children:"Victime:"})," ",x.victimName]}),e.jsxs("div",{children:["‚ö∞Ô∏è ",e.jsx("strong",{children:"Cause:"})," ",x.deathType?le(x.deathType):"Inconnue"]}),e.jsxs("div",{children:["üë• ",e.jsx("strong",{children:"Camp victime:"})," ",x.camp]})]}),e.jsxs("div",{children:["üó∫Ô∏è ",e.jsx("strong",{children:"Carte:"})," ",x.mapName]}),e.jsxs("div",{children:["üéÆ ",e.jsx("strong",{children:"Partie:"})," #",x.gameId]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les d√©tails de la partie"})]})},W=w=>{if(!w)return;const N=w.allLocations||[w];if(N.length===1)c({selectedGame:N[0].gameId,fromComponent:"Player Death Map"});else{const a=N.map(k=>k.gameId).filter(k=>k);c({selectedGameIds:a,fromComponent:"Player Death Map"})}};return h?e.jsx("div",{className:"donnees-attente",children:"Chargement des donn√©es..."}):f?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",f]}):o?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>v("deaths"),style:{background:S==="deaths"?"var(--accent-primary)":"transparent",color:S==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:S==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"üíÄ Morts"}),e.jsx("button",{type:"button",onClick:()=>v("kills"),style:{background:S==="kills"?"var(--accent-primary)":"transparent",color:S==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:S==="kills"?"bold":"normal",transition:"all 0.2s"},children:"‚öîÔ∏è Kills"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:u,onChange:w=>g(w.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:i.map(w=>e.jsx("option",{value:w,children:w},w))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:r,onChange:w=>t(parseInt(w.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:r===0?"Aucun":`${r} unit√©${r>1?"s":""}`})]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{flex:"1 1 100%",marginBottom:"1.5rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:S==="deaths"?"Morts localis√©es":"Kills localis√©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:S==="deaths"?"var(--accent-secondary)":"var(--accent-primary-text)"},children:n.length}),r>0&&j.length<n.length&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"4px"},children:["‚Üí ",j.length," points group√©s"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Carte"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-2)",fontSize:"1.2rem"},children:u||"Aucune"})]})]}),e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:n.length>0?e.jsx(B,{title:S==="deaths"?`Carte des Morts de ${s}`:`Carte des Kills de ${s}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(Ye,{margin:{top:20,right:30,left:60,bottom:60},children:[l&&e.jsx(_e,{x1:l.zMin,x2:l.zMax,y1:l.xMin,y2:l.xMax,fill:"transparent",stroke:"none",shape:w=>{const{x:N,y:a,width:k,height:M}=w;return e.jsx("image",{x:N,y:a,width:k,height:M,href:l.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),e.jsx(O,{strokeDasharray:"3 3",stroke:l?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(K,{dataKey:"z",type:"number",name:"Position Z",domain:b,hide:!0}),e.jsx(H,{dataKey:"x",type:"number",name:"Position X",domain:d,hide:!0}),e.jsx(V,{content:e.jsx(D,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Je,{data:j,onClick:w=>W(w),style:{cursor:"pointer"},isAnimationActive:!1,children:j.map((w,N)=>{const a=Math.min(Math.log2(w.count+1)*3+5,18),k=Math.round(a);return e.jsx(_,{fill:A(w.deathType),stroke:w.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:w.count>1?2:1,opacity:.85,r:k},`cell-${N}`)})})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:S==="deaths"?`Aucune mort localis√©e pour ${s} sur cette carte.`:`Aucun kill localis√© pour ${s} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donn√©es de position ne sont disponibles que pour les parties r√©centes."})]})}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"√Ä propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",S==="deaths"?`les emplacements o√π ${s} est mort`:`les emplacements o√π ${s} a √©limin√© d'autres joueurs`," au cours des parties. Les couleurs indiquent le type de mort. Cliquez sur un point pour voir les d√©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroup√©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"üíÄ Morts:"})," O√π le joueur a √©t√© √©limin√©",e.jsx("br",{}),e.jsx("strong",{children:"‚öîÔ∏è Kills:"})," O√π le joueur a √©limin√© d'autres joueurs"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e disponible"})}function Me(s){return s.PlayerStats.some(c=>c.SecondsTalkedOutsideMeeting>0||c.SecondsTalkedDuringMeeting>0)}function me(s,c){const o=c.DeathDateIrl||s.EndDate,h=Ce(s.StartDate,o);return h&&h>0?h:0}function Ns(s){const c=s.filter(Me),o=new Map;return c.forEach(h=>{h.PlayerStats.forEach(f=>{const p=ee(f),S=We(f),v=me(h,f);if(v<=0)return;o.has(p)||o.set(p,{displayName:S,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const u=o.get(p);u.gamesPlayed++,u.totalSecondsAll+=(f.SecondsTalkedOutsideMeeting||0)+(f.SecondsTalkedDuringMeeting||0),u.totalGameDuration+=v})}),{playerStats:o,gamesWithTalkingData:c.length}}function Rs(s,c){if(!c||c.length===0||!s)return null;const o=Ns(c),h=c.filter(Me);if(h.length===0||o.playerStats.size===0)return null;let f=null;for(const[T,R]of o.playerStats)if(R.displayName===s){f=T;break}if(!f)return null;let p=0,S=0,v=0,u=0;const g={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},r=new Map;let t=0,i=0,m=0,n=0;if(h.forEach(T=>{const R=T.PlayerStats.find(E=>ee(E)===f);if(!R)return;const $=me(T,R);if($<=0)return;p++;const I=R.SecondsTalkedOutsideMeeting||0,z=R.SecondsTalkedDuringMeeting||0,re=I+z;S+=I,v+=z,u+=$;const C=Le(R.MainRoleInitial,R.Power);g[C].gamesPlayed++,g[C].secondsOutside+=I,g[C].secondsDuring+=z,g[C].gameDuration+=$;const L=Oe(R);r.has(L)||r.set(L,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const q=r.get(L);q.gamesPlayed++,q.totalSecondsAll+=re,q.totalGameDuration+=$}),p===0||u<=0)return null;const j=3600/u,l=S*j,d=v*j,b=(S+v)*j,A=S+v>0?v/(S+v)*100:0,D=[];for(const[T,R]of Object.entries(g)){if(R.gamesPlayed===0)continue;const $=R.gameDuration>0?3600/R.gameDuration:0,I=R.secondsOutside+R.secondsDuring;D.push({camp:T,gamesPlayed:R.gamesPlayed,totalSecondsOutside:R.secondsOutside,totalSecondsDuring:R.secondsDuring,totalSecondsAll:I,totalGameDurationSeconds:R.gameDuration,secondsOutsidePer60Min:R.secondsOutside*$,secondsDuringPer60Min:R.secondsDuring*$,secondsAllPer60Min:I*$,meetingRatio:I>0?R.secondsDuring/I*100:0})}D.sort((T,R)=>R.gamesPlayed-T.gamesPlayed);const W=Array.from(r.entries()).filter(([T,R])=>R.gamesPlayed>=1).map(([T,R])=>({role:T,gamesPlayed:R.gamesPlayed,secondsAllPer60Min:R.totalGameDuration>0?R.totalSecondsAll/R.totalGameDuration*3600:0,totalSecondsAll:R.totalSecondsAll})).sort((T,R)=>R.secondsAllPer60Min-T.secondsAllPer60Min),w=[];for(const[T,R]of o.playerStats)R.totalGameDuration>0&&w.push({id:T,name:R.displayName,per60:R.totalSecondsAll/R.totalGameDuration*3600});w.sort((T,R)=>R.per60-T.per60);const N=w.reduce((T,R)=>T+R.per60,0),a=w.length>0?N/w.length:0,k=w.findIndex(T=>T.id===f)+1,M=w.length,x=M>0?Math.round((1-(k-1)/M)*100):0,y=b;h.forEach(T=>{const R=T.PlayerStats.find(re=>ee(re)===f);if(!R)return;const $=me(T,R);if($<=0)return;((R.SecondsTalkedOutsideMeeting||0)+(R.SecondsTalkedDuringMeeting||0))/$*3600>=y?(t++,R.Victorious&&i++):(m++,R.Victorious&&n++)});const P={gamesAboveAverage:t,winsAboveAverage:i,winRateAboveAverage:t>0?i/t*100:0,gamesBelowAverage:m,winsBelowAverage:n,winRateBelowAverage:m>0?n/m*100:0};return{playerName:s,gamesPlayed:p,gamesWithTalkingData:o.gamesWithTalkingData,totalSecondsOutside:S,totalSecondsDuring:v,totalSecondsAll:S+v,totalGameDurationSeconds:u,secondsOutsidePer60Min:l,secondsDuringPer60Min:d,secondsAllPer60Min:b,meetingRatio:A,campBreakdown:D,globalAverageSecondsAllPer60Min:a,playerRank:k,totalPlayersWithData:M,percentile:x,roleBreakdown:W,winCorrelation:P}}function ks(s,c){return s?s.roleBreakdown.slice(0,c):[]}function Ps(s){const{data:c,isLoading:o,error:h}=ue(f=>s?Rs(s,f):null);return{data:c,isLoading:o,error:h}}function Ts({selectedPlayerName:s}){const{data:c,isLoading:o,error:h}=Ps(s),f=ne(),p=F.useMemo(()=>c?.campBreakdown?c.campBreakdown.map(t=>({camp:t.camp,"Hors r√©union":Math.round(t.secondsOutsidePer60Min),"En r√©union":Math.round(t.secondsDuringPer60Min),total:Math.round(t.secondsAllPer60Min),gamesPlayed:t.gamesPlayed,meetingRatio:t.meetingRatio.toFixed(1)})):[],[c]),S=F.useMemo(()=>c?[{name:"En r√©union",value:c.totalSecondsDuring,color:"#2196F3"},{name:"Hors r√©union",value:c.totalSecondsOutside,color:"#FF9800"}]:[],[c]);if(o)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(h)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",h]});if(!c)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donn√©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donn√©es de temps de parole ne sont disponibles que pour les parties r√©centes."})]});const v=c.secondsAllPer60Min-c.globalAverageSecondsAllPer60Min,u=c.globalAverageSecondsAllPer60Min>0?(v/c.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",g=v>0,r=c.winCorrelation.winRateAboveAverage-c.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üé§ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:ie(c.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:g?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[g?"+":"",u,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üìä Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",c.playerRank," / ",c.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-c.percentile+1,"% ",c.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üìà Parties analys√©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:c.gamesPlayed}),e.jsxs("p",{children:["sur ",c.gamesWithTalkingData," avec donn√©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üó£Ô∏è Ratio en r√©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[c.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),p.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx(B,{title:"Temps de parole par camp (par 60min de jeu)",children:e.jsx("div",{style:{height:350},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:p,layout:"vertical",children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(K,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:t=>`${Math.floor(t/60)}m`}),e.jsx(H,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(V,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(t,i)=>[ie(t),i],labelFormatter:t=>{const i=p.find(m=>m.camp===t);return`${t} (${i?.gamesPlayed||0} parties)`}}),e.jsx(Xe,{}),e.jsx(U,{dataKey:"Hors r√©union",stackId:"talk",fill:"#FF9800"}),e.jsx(U,{dataKey:"En r√©union",stackId:"talk",fill:"#2196F3"})]})})})}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:p.length>=2&&(()=>{const t=[...p].sort((j,l)=>l.total-j.total),i=t[0],m=t[t.length-1],n=i.total-m.total;return e.jsxs("p",{children:["üí° ",e.jsx("strong",{children:s})," parle"," ",e.jsxs("strong",{style:{color:Ee(i.camp)},children:[ie(n)," de plus"]})," ","en tant que ",e.jsx("strong",{children:i.camp})," qu'en tant que"," ",e.jsx("strong",{children:m.camp})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(B,{title:"R√©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(ke,{children:[e.jsx(Pe,{data:S,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:t=>`${t.name}: ${((t.percent||0)*100).toFixed(1)}%`,children:S.map((t,i)=>e.jsx(_,{fill:t.color},`cell-${i}`))}),e.jsx(V,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:t=>ie(t)})]})})})})}),c&&c.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(B,{title:t=>t?"Top 15 r√¥les les plus bavards (par 60min)":"Top 5 r√¥les les plus bavards (par 60min)",children:t=>{const m=ks(c,t?15:5).map(n=>({role:n.role,secondsPer60Min:Math.round(n.secondsAllPer60Min),gamesPlayed:n.gamesPlayed}));return e.jsx("div",{style:{height:t?400:300},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:m,children:[e.jsx(O,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(K,{dataKey:"role",tick:{fill:"var(--text-primary)",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(H,{tick:{fill:"var(--text-secondary)"},tickFormatter:n=>`${Math.floor(n/60)}m`}),e.jsx(V,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:n=>[ie(n),"Temps de parole"],labelFormatter:n=>{const j=m.find(l=>l.role===n);return`${n} (${j?.gamesPlayed||0} parties)`}}),e.jsx(U,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",children:m.map((n,j)=>e.jsx(_,{fill:f[n.role]||f.Villageois},`cell-${j}`))})]})})})}})}),(c.winCorrelation.gamesAboveAverage>0||c.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"üéØ Corr√©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[c.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",c.winCorrelation.winsAboveAverage,"/",c.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[c.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",c.winCorrelation.winsBelowAverage,"/",c.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(r)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["üí° ",e.jsx("strong",{children:s})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:r>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[r>0?"sup√©rieur":"inf√©rieur"," de ",Math.abs(r).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function sa(){const{settings:s,updateSettings:c}=oe(),{navigateToGameDetails:o,navigationState:h,updateNavigationState:f}=X(),{data:p,isLoading:S,error:v}=be(),{joueursData:u,isLoading:g}=te(),{data:r,isLoading:t,error:i}=pe(s.highlightedPlayer),m=ce(u),[n,j]=F.useState(""),[l,d]=F.useState(null),{clips:b}=Ze(s.highlightedPlayer),{clips:A}=Qe(),[D,W]=F.useState(()=>s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled?s.independentFilters.gameFilter==="modded"?"modded":"all":s.gameFilter==="modded"?"modded":"all"),w=F.useMemo(()=>s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled?s.independentFilters.gameFilter==="modded":s.gameFilter==="modded",[s.useIndependentFilters,s.independentFilters?.gameTypeEnabled,s.independentFilters?.gameFilter,s.gameFilter]),[N,a]=F.useState(h.selectedPlayerSelectionView||"achievements"),[k,M]=F.useState("session"),[x,y]=F.useState("all");F.useEffect(()=>{if(s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled){const C=s.independentFilters.gameFilter==="modded"?"modded":"all";W(C)}else if(!s.useIndependentFilters){const C=s.gameFilter==="modded"?"modded":"all";W(C)}},[s.gameFilter,s.useIndependentFilters,s.independentFilters?.gameTypeEnabled,s.independentFilters?.gameFilter]),F.useEffect(()=>{w&&D!=="modded"&&W("modded")},[w,D]),F.useEffect(()=>{h.selectedPlayerSelectionView&&a(h.selectedPlayerSelectionView)},[h.selectedPlayerSelectionView]);const{data:P}=de(s.highlightedPlayer||""),T=F.useMemo(()=>{if(!p||!p.GameStats)return[];const C=w?p.GameStats.filter(q=>q.Modded===!0):p.GameStats,L=new Map;return C.forEach(q=>{const E=new Date(q.StartDate);q.PlayerStats.forEach(Y=>{const Z=ee(Y),De=u?.Players?.find(Fe=>Fe.SteamID===Z)?.Joueur||Y.Username;L.has(Z)||L.set(Z,{games:0,wins:0,firstDate:E,lastDate:E,displayName:De});const se=L.get(Z);se.games++,Y.Victorious&&se.wins++,E<se.firstDate&&(se.firstDate=E),E>se.lastDate&&(se.lastDate=E)})}),Array.from(L.entries()).map(([q,E])=>{let Y=u?.Players?.find(Z=>Z.SteamID===q);return Y||(Y=u?.Players?.find(Z=>Z.Joueur===E.displayName)),{id:q,name:E.displayName,totalGames:E.games,totalWins:E.wins,winRate:E.games>0?E.wins/E.games*100:0,firstGameDate:E.firstDate.toLocaleDateString("fr-FR"),lastGameDate:E.lastDate.toLocaleDateString("fr-FR"),isHighlighted:E.displayName===s.highlightedPlayer,image:Y?.Image||null,twitch:Y?.Twitch||null,youtube:Y?.Youtube||null}})},[p,s.highlightedPlayer,u,w]),R=F.useMemo(()=>{if(!n.trim())return T;const C=n.toLowerCase();return T.filter(L=>L.name.toLowerCase().includes(C))},[T,n]),$=F.useMemo(()=>[...R].sort((C,L)=>L.totalGames-C.totalGames),[R]),I=C=>{c({highlightedPlayer:C}),j("")},z=C=>{a(C),f({selectedPlayerSelectionView:C})},re=()=>{if(b.length===0)return;const C=Math.floor(Math.random()*b.length);d(b[C])};return S||g?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):v?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donn√©es des joueurs: ",v]})]}):!p||T.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donn√©e disponible"}),e.jsx("p",{children:"Aucun joueur trouv√© dans les donn√©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!s.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"S√©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en √©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:n,onChange:C=>j(C.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"üîç"})]}),e.jsxs("div",{className:"player-count",children:[R.length," joueur",R.length!==1?"s":"",n&&` (filtr√©${R.length!==1?"s":""} de ${T.length})`]})]})]}),e.jsx("div",{className:"player-display",children:n?R.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"R√©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>j(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:$.map(C=>e.jsxs("button",{type:"button",className:`suggestion-btn ${C.isHighlighted?"highlighted":""}`,onClick:()=>I(C.name),children:[C.image?e.jsx("img",{src:C.image,alt:`Photo de profil de ${C.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":m[C.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[C.name,C.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" ‚òÖ"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[C.totalGames," parties ‚Ä¢ ",C.winRate.toFixed(1),"% victoires"]})]})]},C.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouv√© pour "',n,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>j(""),children:"Effacer la recherche"})]}):s.highlightedPlayer?(()=>{const C=T.find(L=>L.name===s.highlightedPlayer);return C?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:C.name}),e.jsx("span",{className:"highlight-badge",children:"‚òÖ Mis en √©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[C.image?e.jsx("img",{src:C.image,alt:`Photo de profil de ${C.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":m[C.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[C.totalGames," parties ‚Ä¢ ",C.totalWins," victoires ‚Ä¢ ",C.winRate.toFixed(1),"% taux de victoire"]}),(C.twitch||C.youtube||b.length>0)&&e.jsxs("div",{className:"social-links",children:[C.twitch&&e.jsx("a",{href:C.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"üì∫ Twitch"}),C.youtube&&e.jsx("a",{href:C.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"üé¨ YouTube"}),b.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:L=>{L.stopPropagation(),re()},title:`${b.length} clip${b.length>1?"s":""} disponible${b.length>1?"s":""}`,children:["üé¨ Clip al√©atoire (",b.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn profile-btn ${N==="profile"?"active":""}`,onClick:()=>z("profile"),children:"üìä Profil"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="achievements"?"active":""}`,onClick:()=>z("achievements"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="evolution"?"active":""}`,onClick:()=>z("evolution"),children:"√âvolution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="camps"?"active":""}`,onClick:()=>z("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="roles"?"active":""}`,onClick:()=>z("roles"),children:"R√¥les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="maps"?"active":""}`,onClick:()=>z("maps"),children:"Maps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="kills"?"active":""}`,onClick:()=>z("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="deathmap"?"active":""}`,onClick:()=>z("deathmap"),children:"Carte"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="talkingtime"?"active":""}`,onClick:()=>z("talkingtime"),children:"Parole"})]}),N==="profile"&&e.jsx("div",{className:"player-profile-section",children:e.jsx(fs,{})}),N==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[t?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):i?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["‚ùå Erreur lors du chargement des classements: ",i]})}):r?e.jsx(Ae,{achievements:D==="all"?r.allGamesAchievements:r.moddedOnlyAchievements,title:D==="all"?"Classements - Toutes les parties":"Classements - Parties modd√©es",emptyMessage:"Aucun classement dans cette cat√©gorie",achievementType:D}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[!w&&e.jsx("button",{type:"button",className:`filter-btn ${D==="all"?"active":""}`,onClick:L=>{L.stopPropagation(),W("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${D==="modded"?"active":""}`,onClick:L=>{L.stopPropagation(),W("modded")},disabled:w,children:"Parties modd√©es"})]})]}),N==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[P&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{o({selectedPlayer:C.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${C.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:P.totalGames}),e.jsx("p",{children:"parties jou√©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumul√©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:Ne(P.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{o({selectedPlayer:C.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${C.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:P.totalWins}),e.jsx("p",{children:"parties gagn√©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[P.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:k,onChange:L=>M(L.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par ann√©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:x,onChange:L=>y(L.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"R√¥les solo"})]})]})]}),e.jsx(vs,{selectedPlayerName:C.name,groupingMethod:k,campFilter:x})]}),N==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(js,{selectedPlayerName:C.name})}),N==="maps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ys,{selectedPlayerName:C.name})}),N==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Cs,{selectedPlayerName:C.name})}),N==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(bs,{selectedPlayerName:C.name})}),N==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Ss,{selectedPlayerName:C.name})}),N==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Ts,{selectedPlayerName:C.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:L=>{L.stopPropagation(),c({highlightedPlayer:null})},children:"‚òÖ Retirer la mise en √©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"P√©riode d'activit√©:"}),e.jsxs("span",{className:"period-range",children:[C.firstGameDate," - ",C.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',s.highlightedPlayer,`" n'a pas √©t√© trouv√© dans les donn√©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>c({highlightedPlayer:null}),children:"Effacer la s√©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:$.map(C=>e.jsxs("div",{className:`character-card ${C.isHighlighted?"highlighted":""}`,onClick:()=>I(C.name),title:`${C.name} - ${C.totalGames} parties, ${C.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:C.image?e.jsx("img",{src:C.image,alt:`Photo de profil de ${C.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":m[C.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:C.name}),(C.twitch||C.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[C.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),C.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},C.id))})})}),l&&e.jsx(es,{clip:l,onClose:()=>d(null),relatedClips:ss(l,A),nextClip:ve(l,A),onNextClip:()=>{const C=ve(l,A);C&&d(C)},onRelatedClip:C=>{const L=A.find(q=>q.ClipId===C);L&&d(L)}})]})}export{sa as PlayerSelectionPage};
