import{a as he,r as N,g as te,f as Te,u as ie,j as e,d as Ce,e as Ne,o as Ae}from"./index-CAU02BWu.js";import{u as ue}from"./useJoueursData-DD7vKt92.js";import{u as ge}from"./baseStatsHook-DUd6wfJX.js";import{g as Me}from"./gameUtils-DYpUb-C5.js";import{a as we,g as oe,c as Se,b as Fe}from"./datasyncExport-CjB7UYqV.js";import{u as xe,g as ze,a as ce,l as $e,d as fe}from"./api-DC2IH0Bm.js";import{f as ae,d as Ie}from"./durationFormatters-C9UyWcKX.js";import{F as H,C as _,X as U,Y,a as Q}from"./FullscreenChart-BlOmwJml.js";import{R as K,T as O}from"./CategoricalChart-Dz-hwpHG.js";import{L as We,a as Le}from"./LineChart-eNCmfqod.js";import{B as ee,a as J}from"./BarChart-BPWjUVnx.js";import{P as Re,a as ke}from"./PieChart-BmByJfZM.js";import{g as le}from"./deathTypes-gHH1w6_X.js";import{i as ye,g as ve,V as qe,a as Ge}from"./roleUtils-CLjkiQQc.js";import{S as Ee,R as se,e as Ve,f as Be,h as de,a as Ke,b as Oe,d as He}from"./deathLocationUtils-CltAxkOc.js";import{L as _e}from"./Legend-DgxlRr87.js";import{a as Ue,u as Ye}from"./useClips-T_OPitzc.js";import{C as Je,f as je,a as Qe}from"./ClipViewer-BvXtR2q-.js";import"./ActivePoints-B0DmxueM.js";import"./PolarChart-J4bRZiSb.js";function Ze(r){const{settings:l}=he(),{joueursData:j}=ue(),[w,k]=N.useState(null),[p,S]=N.useState(!1),[v,i]=N.useState(null);N.useEffect(()=>{let n=!0;return(async()=>{try{S(!0),i(null);const c=l.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",a=await fetch(c);if(!a.ok)throw new Error(`Failed to load achievements: ${a.status} ${a.statusText}`);const o=await a.json();n&&k(o)}catch(c){n&&i(c instanceof Error?c.message:"Failed to load achievements")}finally{n&&S(!1)}})(),()=>{n=!1}},[l.dataSource]);const g=(()=>{if(!r||!w)return null;const s=j?.Players?.find(c=>c.Joueur===r)?.SteamID;return s&&w.achievements[s]||null})();return N.useEffect(()=>{r&&w&&j&&j.Players?.find(c=>c.Joueur===r)?.SteamID},[r,w,j,l.dataSource]),{data:g,isLoading:p,error:v,metadata:{generatedAt:w?.generatedAt||null,totalPlayers:w?.totalPlayers||0,totalGames:w?.totalGames||0,totalModdedGames:w?.totalModdedGames||0}}}function Xe(r,l,j){if(!r||r.trim()===""||l.length===0)return null;const w=[];let k=r;l.forEach(s=>{const c=s.PlayerStats.find(a=>te(a)===r||a.Username.toLowerCase()===r.toLowerCase());if(c){k=c.Username;const a=c.MainRoleInitial==="Louveteau"?c.MainRoleInitial:we(c.MainRoleInitial,c.MainRoleChanges||[]),o=oe(a);if(j&&j!=="Tous les camps"&&o!==j)return;const b=Me(s),m=c.Victorious,x=Te(new Date(s.StartDate)),D=Se(s.StartDate,s.EndDate)||0;w.push({gameId:s.Id,date:x,camp:o,won:m,winnerCamp:b,playersInGame:s.PlayerStats.length,mapName:s.MapName,duration:D})}}),w.sort((s,c)=>{const a=o=>{const b=o.split("/");return b.length===3?new Date(parseInt(b[2]),parseInt(b[1])-1,parseInt(b[0])):new Date(o)};return a(c.date).getTime()-a(s.date).getTime()});const p=w.length,S=w.filter(s=>s.won).length,v=p>0?(S/p*100).toFixed(2):"0.00",i={};w.forEach(s=>{i[s.camp]||(i[s.camp]={appearances:0,wins:0,winRate:"0.00"}),i[s.camp].appearances++,s.won&&i[s.camp].wins++}),Object.keys(i).forEach(s=>{const c=i[s];c.winRate=c.appearances>0?(c.wins/c.appearances*100).toFixed(2):"0.00"});const g={};w.forEach(s=>{g[s.mapName]||(g[s.mapName]={appearances:0,wins:0,winRate:"0.00"}),g[s.mapName].appearances++,s.won&&g[s.mapName].wins++}),Object.keys(g).forEach(s=>{const c=g[s];c.winRate=c.appearances>0?(c.wins/c.appearances*100).toFixed(2):"0.00"});const n=w.reduce((s,c)=>s+c.duration,0);return{playerName:k,totalGames:p,totalWins:S,winRate:v,totalPlayTime:n,games:w,campStats:i,mapStats:g}}function pe(r,l){const{data:j,isLoading:w,error:k}=ge(p=>r?Xe(r,p,l):null);return{data:j,isLoading:w,error:k}}function et({achievements:r,title:l,emptyMessage:j,achievementType:w="all"}){const{navigateToTab:k,updateNavigationState:p,clearNavigation:S}=ie(),{settings:v,updateSettings:i}=he(),{joueursData:g}=ue(),n=xe(g),s=(t,P)=>{if(P.stopPropagation(),!t.redirectTo)return;S();const $=v.highlightedPlayer;if(i(w==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:$,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:$,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const y=v.highlightedPlayer||"",h=c(t.description,y);h&&p({playerComparisonState:{selectedPlayer1:y,selectedPlayer2:h,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const y=t.description.toLowerCase().includes("loup");p({selectedPairingTab:y?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const y=t.description.match(/(Villageois|Loups|Autres)/i);y&&p({deathStatsSelectedCamp:y[1]});let h=10;const d=t.description.match(/min\.\s*(\d+)/);d&&(h=parseInt(d[1],10));let C="totalKills",f="killers";const R=t.redirectTo.chartSection;R&&(R==="killers-total"?(C="totalKills",f="killers"):R==="killers-average"?(C="averageKills",f="killers"):R==="deaths-total"?(C="totalDeaths",f="deaths"):R==="survivors-average"?(C="survivalRate",f="deaths"):(R==="hunters-good"||R==="hunters-bad")&&(f="hunter",C="averageKills")),p({deathStatisticsState:{selectedCamp:y?.[1]||"Tous les camps",minGamesForAverage:h,selectedView:f,focusChart:C}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const y=t.redirectTo.mapFilter||"all";let h=10;const d=t.description.match(/min\.\s*(\d+)/);d&&(h=parseInt(d[1])),i(w==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:y,playerFilter:{mode:"none",players:[]},highlightedPlayer:$,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:y,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:y,playerFilter:{mode:"none",players:[]},highlightedPlayer:$,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:y,playerFilter:{mode:"none",players:[]}}}),p({playersGeneralState:{minGamesForWinRate:h,winRateOrder:"best",focusChart:"winRate"}}),k("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&p({selectedPlayerName:v.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let y="wins";const h=t.title.toLowerCase(),d=t.description.toLowerCase();h.includes("dÃ©faite")||d.includes("dÃ©faite")?y="losses":h.includes("loup")||d.includes("loup")?y="loup":h.includes("villageois")||d.includes("villageois")?y="villageois":(h.includes("victoire")||d.includes("victoire"))&&(y="wins"),p({selectedSeriesType:y})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let y=10;const h=t.description.match(/min\.\s*(\d+)/);h&&(y=parseInt(h[1],10));let d="winRate",C="best";const f=t.title.toLowerCase(),R=t.description.toLowerCase();f.includes("participation")||R.includes("participation")?d="participation":(f.includes("taux de victoire")||R.includes("taux de victoire"))&&(d="winRate",(f.includes("moins bon")||f.includes("mauvais")||R.includes("moins bon")||R.includes("mauvais"))&&(C="worst")),p({playersGeneralState:{minGamesForWinRate:y,winRateOrder:C,focusChart:d}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const y=t.redirectTo.chartSection;let h="Villageois",d=1;y&&(y==="camp-loup"?h="Loup":y==="camp-villageois"?h="Villageois":y==="camp-idiot"?h="Idiot du Village":y==="camp-amoureux"?h="Amoureux":(y==="solo-roles"||y==="hall-of-fame")&&(h="Villageois"));const C=t.description.match(/min\.\s*(\d+)/);C&&(d=parseInt(C[1],10)),y==="solo-roles"?h="RÃ´les spÃ©ciaux":y==="hall-of-fame"&&(h="Tous les camps"),p({campPerformanceState:{selectedCampPerformanceCamp:h,selectedCampPerformanceMinGames:d,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const y=t.title.toLowerCase();let h="overview",d="behavior";y.includes("agressivitÃ©")?(h="overview",d="behavior"):y.includes("taux de vote")?(h="behavior",d="voteRate"):y.includes("prÃ©cision")&&(h="overview",d="accuracy"),p({votingStatsState:{selectedCategory:h,selectedView:d}})}if(t.category==="loot"&&t.redirectTo.subTab==="lootStats"){const y=t.redirectTo,h=y.minGames||5,d=y.view||"normalized";p({lootStatsState:{minGames:h,campFilter:"all",view:d}})}k(t.redirectTo.tab,t.redirectTo.subTab)},c=(t,P)=>{const $=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const y of $){const h=t.match(y);if(h&&h[1]){const d=h[1].trim();if(d!==P)return d}}return null},a=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const y=t.description.match(/min\.\s*(\d+)/),h=y?parseInt(y[1],10):10,d=t.title.toLowerCase(),C=w==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return d.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${h} parties)${C}`:d.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${C}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${C}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const y=t.redirectTo.mapFilter,h=y==="village"?"Village":y==="chateau"?"ChÃ¢teau":"map",d=w==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${h}${d}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${c(t.description,v.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const y=t.description.match(/(Villageois|Loups|Autres)/i),h=t.description.match(/min\.\s*(\d+)/),d=h?parseInt(h[1],10):10,C=y?.[1]||"Tous les camps",f=t.redirectTo.chartSection;let R="kills et morts";return f==="killers-total"?R="total des kills":f==="killers-average"?R=`moyenne des kills (min. ${d} parties)`:f==="deaths-total"?R="total des morts":f==="survivors-average"&&(R=`taux de survie (min. ${d} parties)`),`Cliquez pour voir les statistiques de ${R} ${C!=="Tous les camps"?`en ${C}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const y=t.title.toLowerCase(),h=t.description.toLowerCase();return y.includes("dÃ©faite")||h.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":y.includes("loup")||h.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":y.includes("villageois")||h.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":y.includes("victoire")||h.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const y=t.redirectTo.chartSection,h=w==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return y==="camp-loup"?`Cliquez pour voir les performances camp Loup${h}`:y==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${h}`:y==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${h}`:y==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${h}`:y==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${h}`:y==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${h}`:`Cliquez pour voir les performances par camp${h}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const y=t.description.match(/min\.\s*(\d+)/),h=y?parseInt(y[1],10):25,d=w==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",C=t.title.toLowerCase();return C.includes("agressivitÃ©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${h} meetings)${d}`:C.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${h} meetings)${d}`:C.includes("prÃ©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${d}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${d}`}break;case"loot":if(t.redirectTo.subTab==="lootStats"){const y=t.description.match(/min\.\s*(\d+)/),h=y?parseInt(y[1],10):25,d=w==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de rÃ©colte (min. ${h} parties)${d}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(w==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},o=t=>n[t]||ze(t),b=t=>{const P=[/avec ([^:]+?):/,/contre ([^:]+?):/];let $=t;return P.forEach(y=>{const h=t.match(y);if(h&&h[1]){const d=h[1].trim(),f=`<span class="player-name-highlight" style="color: ${o(d)};">${d}</span>`;$=$.replace(d,f)}}),$};if(r.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:l}),e.jsx("p",{children:j||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const m=t=>t===1?"ðŸ¥‡":t===2?"ðŸ¥ˆ":t===3?"ðŸ¥‰":"",x=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",D=(t,P)=>{if(!t||t<=3||!P)return;const $=t-3,y=P-3;return y<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-($-1)/(y-1))}, 70%, 50%)`},M=(t,P)=>{if(!t||!P)return;if(P<=1)return"hsl(0, 70%, 50%)";const $=(t-1)/(P-1),y=$*15,h=50-$*15;return`hsl(${y}, 70%, ${h}%)`},I=t=>{if(!t)return;const P=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(P){const[,$,y]=P;return`hsl(${$}, ${y}%, 40%)`}return t},z=r.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,P)=>(t.rank??999)-(P.rank??999)),F=r.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,P)=>(t.rank??999)-(P.rank??999)),W=r.filter(t=>t.category==="comparison"),V=[...z,...F].sort((t,P)=>(t.rank??999)-(P.rank??999)),B=z.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:l}),B>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:z.filter(t=>t.rank&&t.rank<=3).map((t,P)=>e.jsxs("div",{className:`top3-card ${x(t.rank)} animate-slide-in`,style:{animationDelay:`${P*.15}s`},onClick:$=>s(t,$),title:a(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:m(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:t.title}),e.jsx("p",{className:"top3-achievement-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},t.id))})]}),V.length>0&&e.jsxs("div",{className:"achievements-section unified-rankings",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:V.filter(t=>t.type==="bad"?!0:!t.rank||t.rank>3).map((t,P)=>{const $=t.type==="bad",y=$?M(t.rank,t.totalRanked):D(t.rank,t.totalRanked),h=I(y),d=$?"":x(t.rank);return e.jsxs("div",{className:`achievement-card ${$?"bad":"good"} ${d}`,onClick:C=>s(t,C),title:a(t),style:{animationDelay:`${P*.05}s`,borderLeftColor:h,borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsxs("span",{className:"achievement-title",children:[$&&"ðŸ’€ ",t.title]}),e.jsxs("span",{className:"achievement-rank",style:y?{backgroundColor:y}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:t.description})]},t.id)})})]}),W.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques CoÃ©quipiers et Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:W.map(t=>e.jsxs("div",{className:"achievement-card comparison",onClick:P=>s(t,P),title:a(t),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:t.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:b(t.description)}})]},t.id))})]})]})}function tt({selectedPlayerName:r,groupingMethod:l,campFilter:j="all"}){const{navigateToGameDetails:w}=ie(),{data:k,isLoading:p,error:S}=pe(r),v=N.useMemo(()=>{switch(l){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[l]),i=N.useMemo(()=>{if(!k?.games)return new Map;const c=new Map;return k.games.forEach(a=>{if(!c.has(a.date)){const o=a.date.split("/");o.length===3?c.set(a.date,new Date(parseInt(o[2]),parseInt(o[1])-1,parseInt(o[0])).getTime()):c.set(a.date,new Date(a.date).getTime())}}),c},[k?.games]),g=N.useMemo(()=>{if(!k?.games)return[];const c={};return k.games.forEach(a=>{if(j!=="all"){if(j==="solo"){if(a.camp==="Villageois"||a.camp==="Loup")return}else if(a.camp!==j)return}let o;const b=a.date.split("/");if(l==="month")if(b.length===3)o=`${b[1].padStart(2,"0")}/${b[2]}`;else{const m=new Date(a.date);o=`${String(m.getMonth()+1).padStart(2,"0")}/${m.getFullYear()}`}else if(l==="quarter")if(b.length===3){const m=parseInt(b[1],10);o=`T${Math.floor((m-1)/3)+1}/${b[2]}`}else{const m=new Date(a.date);o=`T${Math.floor(m.getMonth()/3)+1}/${m.getFullYear()}`}else l==="year"?b.length===3?o=`${b[2]}`:o=`${new Date(a.date).getFullYear()}`:o=a.date;c[o]||(c[o]={games:[],wins:0,total:0}),c[o].games.push(a),c[o].total++,a.won&&c[o].wins++}),Object.entries(c).map(([a,o])=>({period:a,totalGames:o.total,victories:o.wins,defeats:o.total-o.wins,winRate:o.total>0?(o.wins/o.total*100).toFixed(1):"0.0",winRateNum:o.total>0?o.wins/o.total*100:0})).sort((a,o)=>{if(l==="month"){const[b,m]=a.period.split("/"),[x,D]=o.period.split("/"),M=new Date(parseInt(m),parseInt(b)-1,1),I=new Date(parseInt(D),parseInt(x)-1,1);return M.getTime()-I.getTime()}else if(l==="quarter"){const[b,m]=a.period.split("/"),[x,D]=o.period.split("/"),M=parseInt(b.replace(/\D/g,""),10)||1,I=parseInt(x.replace(/\D/g,""),10)||1,z=new Date(parseInt(m,10),(M-1)*3,1),F=new Date(parseInt(D,10),(I-1)*3,1);return z.getTime()-F.getTime()}else if(l==="year"){const b=parseInt(a.period,10),m=parseInt(o.period,10);return b-m}else{const b=i.get(a.period)||0,m=i.get(o.period)||0;return b-m}})},[k,l,i,j]),s=(c=>c<=15?{fontSize:12,angle:-45,height:80,interval:0}:c<=30?{fontSize:12,angle:-45,height:85,interval:1}:c<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(c/12)})(g.length);return p?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):S?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",S]}):k?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",v]}),e.jsx(H,{title:`Ã‰volution des Performances ${v}`,children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(We,{data:g,margin:{top:20,right:30,left:20,bottom:20},onClick:c=>{if(c&&c.activeLabel){const a=g.find(o=>o.period===c.activeLabel);a&&w({selectedPlayer:r,selectedDate:a.period,fromComponent:`Ã‰volution des Performances ${v}`})}},style:{cursor:"pointer"},children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"period",angle:s.angle,textAnchor:"end",height:s.height,interval:s.interval,fontSize:s.fontSize}),e.jsx(Y,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(O,{content:({active:c,payload:a})=>{if(c&&a&&a.length>0){const o=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:o.period})}),e.jsxs("div",{children:["Parties: ",o.totalGames]}),e.jsxs("div",{children:["Victoires: ",o.victories]}),e.jsxs("div",{children:["Taux: ",o.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Le,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",v]}),e.jsx(H,{title:`RÃ©partition Victoires/DÃ©faites ${v}`,children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:g,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"period",angle:s.angle,textAnchor:"end",height:s.height,interval:s.interval,fontSize:s.fontSize}),e.jsx(Y,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(O,{content:({active:c,payload:a})=>{if(c&&a&&a.length>0){const o=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:o.period})}),e.jsxs("div",{children:["Total: ",o.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",o.victories]}),e.jsxs("div",{children:["DÃ©faites: ",o.defeats]}),e.jsxs("div",{children:["Taux: ",o.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(J,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:g.map((c,a)=>e.jsx(Q,{fill:"var(--accent-tertiary)",onClick:()=>{w({selectedPlayer:r,selectedDate:c.period,fromComponent:`Historique Joueur - Victoires ${v}`})},style:{cursor:"pointer"}},`cell-victories-${a}`))}),e.jsx(J,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:g.map((c,a)=>e.jsx(Q,{fill:"var(--chart-color-4)",onClick:()=>{w({selectedPlayer:r,selectedDate:c.period,fromComponent:`Historique Joueur - DÃ©faites ${v}`})},style:{cursor:"pointer"}},`cell-defeats-${a}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function rt({selectedPlayerName:r}){const{navigateToGameDetails:l}=ie(),{data:j,isLoading:w,error:k}=pe(r),p=ce(),S=N.useMemo(()=>j?.campStats?Object.entries(j.campStats).map(([i,g])=>({name:i,value:g.appearances,winRate:g.winRate,winRateDisplay:Math.max(parseFloat(g.winRate),1),wins:g.wins,percentage:(g.appearances/j.totalGames*100).toFixed(1)})):[],[j]),v=N.useMemo(()=>{if(!S.length)return[];const i=5;let g=0;const n=[],s=[];if(S.forEach(c=>{parseFloat(c.percentage)<i?(g+=Number(c.value),n.push(c)):s.push(c)}),g>0){const c=S.reduce((a,o)=>a+Number(o.value),0);s.push({name:"Autres",value:g,winRate:"0.0",winRateDisplay:1,wins:n.reduce((a,o)=>a+o.wins,0),percentage:(g/c*100).toFixed(1),_details:n})}return s},[S]);return w?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):k?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",k]}):j?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Re,{children:[e.jsx(ke,{data:v,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:i=>{const g=i.percent!==void 0?i.percent:0;return i.name==="Autres"?`Autres : ${i.value} (${(g*100).toFixed(1)}%)`:`${i.name}: ${i.value} (${(g*100).toFixed(1)}%)`},children:v.map((i,g)=>e.jsx(Q,{fill:i.name==="Autres"?$e:p[i.name]||`var(--chart-color-${g%6+1})`,onClick:()=>{if(i.name==="Autres"){const n=i._details?.map(s=>s.name)||[];l({selectedPlayer:r,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:n},fromComponent:"Distribution par Camps"})}else i.name==="TraÃ®tre"||i.name==="Louveteau"?l({selectedPlayer:r,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):i.name==="Loup"?l({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):l({selectedPlayer:r,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${g}`))}),e.jsx(O,{content:({active:i,payload:g})=>{if(i&&g&&g.length>0){const n=g[0].payload;if(n.name==="Autres"&&n._details){const s=[...n._details].sort((c,a)=>a.value-c.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",n.value," parties (",n.percentage,"%)"]})}),e.jsx("div",{children:s.map((c,a)=>e.jsxs("div",{children:[c.name,": ",c.value," parties (",c.percentage,"%)"]},a))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[n.name," - ",n.value," parties (",n.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(H,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:S,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Y,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(O,{content:({active:i,payload:g})=>{if(i&&g&&g.length>0){const n=g[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.name})}),e.jsxs("div",{children:["Victoires: ",n.wins," / ",n.value]}),e.jsxs("div",{children:["Taux: ",n.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(J,{dataKey:"winRateDisplay",children:S.map((i,g)=>e.jsx(Q,{fill:parseFloat(i.winRate)===0?`${p[i.name]||`var(--chart-color-${g%6+1})`}50`:p[i.name]||`var(--chart-color-${g%6+1})`,onClick:()=>{i.name==="TraÃ®tre"||i.name==="Louveteau"?l({selectedPlayer:r,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):i.name==="Loup"?l({selectedPlayer:r,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):l({selectedPlayer:r,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${g}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function at({selectedPlayerName:r}){const{gameData:l}=Ce(),{joueursData:j}=ue(),w=xe(j),k=ce(),p=N.useMemo(()=>{if(!l||!r)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const v={},i={},g={},n=new Set;l.forEach(b=>{const m=b.PlayerStats.find(x=>x.Username.toLowerCase()===r.toLowerCase());if(m&&(b.PlayerStats.forEach(x=>{x.KillerName?.toLowerCase()===r.toLowerCase()&&(v[x.Username]=(v[x.Username]||0)+1)}),m.KillerName&&(i[m.KillerName]=(i[m.KillerName]||0)+1),m.DeathType)){const x=m.DeathType,D=le(x);g[D]||(g[D]={count:0,byDeathType:{}}),g[D].count+=1,g[D].byDeathType[x]=(g[D].byDeathType[x]||0)+1,n.add(x)}});const s=Object.entries(v).map(([b,m])=>({player:b,kills:m})).sort((b,m)=>m.kills-b.kills).slice(0,10),c=Object.entries(i).map(([b,m])=>({player:b,kills:m})).sort((b,m)=>m.kills-b.kills).slice(0,10),a=Object.entries(g).map(([b,m])=>{const x={deathType:b,count:m.count};return x[b]=m.count,x}).sort((b,m)=>m.count-b.count).slice(0,10),o=Object.keys(g);return{playersKilled:s,killedBy:c,deathTypes:a,availableDeathTypes:o}},[l,r]),S=N.useMemo(()=>{const v={};p.availableDeathTypes.forEach(n=>{n==="TuÃ© par Loup"?v[n]=k.Loup:n==="Mort aux votes"?v[n]="var(--chart-color-1)":n.includes("Chasseur")?v[n]=k.Chasseur:n==="TuÃ© par Zombie"?v[n]=k.Vaudou:n==="TuÃ© par potion assassin"?v[n]=k.Alchimiste:n==="TuÃ© par Vengeur"?v[n]="var(--chart-color-2)":n==="Amoureux mort"?v[n]=k.Amoureux:n==="TuÃ© par La BÃªte"?v[n]="var(--chart-color-3)":n==="TuÃ© par ShÃ©rif"&&(v[n]="var(--chart-color-4)")});const i=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let g=0;return p.availableDeathTypes.forEach(n=>{v[n]||(v[n]=i[g%i.length],g++)}),v},[p.availableDeathTypes,k]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[p.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(H,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:p.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Y,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(O,{content:({active:v,payload:i})=>{if(v&&i&&i.length>0){const g=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:g.player})}),e.jsxs("div",{children:["TuÃ© ",g.kills," fois par ",r]})]})}return null}}),e.jsx(J,{dataKey:"kills",children:p.playersKilled.map((v,i)=>e.jsx(Q,{fill:w[v.player]||"var(--chart-color-3)"},`cell-killed-${i}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[r," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),p.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(H,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:p.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Y,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(O,{content:({active:v,payload:i})=>{if(v&&i&&i.length>0){const g=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:g.player})}),e.jsxs("div",{children:["A tuÃ© ",r," ",g.kills," fois"]})]})}return null}}),e.jsx(J,{dataKey:"kills",children:p.killedBy.map((v,i)=>e.jsx(Q,{fill:w[v.player]||"var(--chart-color-4)"},`cell-killer-${i}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[r," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),p.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(H,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:p.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(Y,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(O,{content:({active:v,payload:i})=>{if(v&&i&&i.length>0){const g=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:g.deathType})}),e.jsxs("div",{children:[r," est mort ",g.count," fois ainsi"]})]})}return null}}),p.availableDeathTypes.map(v=>e.jsx(J,{dataKey:v,name:v,stackId:"deaths",fill:S[v]||"var(--chart-color-5)"},v))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",r,"."]})]})]})}function st(r,l){if(!r||r.trim()===""||l.length===0)return null;const j=new Map,w=new Map,k=new Map;l.forEach(g=>{if(!g.Modded)return;const n=g.PlayerStats.find(s=>te(s)===r||s.Username.toLowerCase()===r.toLowerCase());if(n){if(n.MainRoleInitial==="Inconnu")return;const s=n.Victorious,a=we(n.MainRoleInitial,n.MainRoleChanges||[])!==n.MainRoleInitial,o=oe(n.MainRoleInitial),b=o==="Loup"||o==="TraÃ®tre"||o==="Louveteau";if(o==="Villageois"&&ye(n)){const m=ve(n);if(m&&qe.includes(m)){const x=j.get(m)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};j.set(m,{appearances:x.appearances+1,wins:x.wins+(s?1:0),winsWithoutRoleChange:x.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:x.gamesWithoutRoleChange+(a?0:1)})}}else if(n.Power&&n.Power.trim()!==""&&n.Power!=="Inconnu"){if(o==="Villageois"){const m=j.get(n.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};j.set(n.Power,{appearances:m.appearances+1,wins:m.wins+(s?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(a?0:1)})}else if(b){const m=w.get(n.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},x=m.roleBreakdown;x.set(n.MainRoleInitial,(x.get(n.MainRoleInitial)||0)+1),w.set(n.Power,{appearances:m.appearances+1,wins:m.wins+(s?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(a?0:1),roleBreakdown:x})}}else if((o==="Villageois"||b)&&n.Power!=="Inconnu")if(o==="Villageois"){const m=j.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};j.set("Aucun pouvoir",{appearances:m.appearances+1,wins:m.wins+(s?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(a?0:1)})}else{const m=w.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},x=m.roleBreakdown;x.set(n.MainRoleInitial,(x.get(n.MainRoleInitial)||0)+1),w.set("Aucun pouvoir",{appearances:m.appearances+1,wins:m.wins+(s?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(a?0:1),roleBreakdown:x})}if(n.SecondaryRole&&n.SecondaryRole.trim()!==""&&n.SecondaryRole!=="Inconnu"){const m=k.get(n.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};k.set(n.SecondaryRole,{appearances:m.appearances+1,wins:m.wins+(s?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(a?0:1)})}}});const p=new Map;l.forEach(g=>{const n=g.PlayerStats.find(s=>te(s)===r||s.Username.toLowerCase()===r.toLowerCase());if(n&&ye(n)){const s=ve(n);s&&p.set(s,(p.get(s)||0)+1)}});const S=g=>Array.from(g.entries()).map(([n,s])=>({name:n,appearances:s.appearances,wins:s.wins,winsWithoutRoleChange:s.winsWithoutRoleChange,gamesWithoutRoleChange:s.gamesWithoutRoleChange,winRate:s.gamesWithoutRoleChange>0?(s.winsWithoutRoleChange/s.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...p.has(n)&&{totalGamesAllModes:p.get(n)}})).sort((n,s)=>s.appearances-n.appearances),v=g=>Array.from(g.entries()).map(([n,s])=>({name:n,appearances:s.appearances,wins:s.wins,winsWithoutRoleChange:s.winsWithoutRoleChange,gamesWithoutRoleChange:s.gamesWithoutRoleChange,winRate:s.gamesWithoutRoleChange>0?(s.winsWithoutRoleChange/s.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(s.roleBreakdown.entries()).map(([c,a])=>({role:c,count:a})).sort((c,a)=>a.count-c.count)})).sort((n,s)=>s.appearances-n.appearances),i=g=>Array.from(g.entries()).map(([n,s])=>({name:n,appearances:s.appearances,wins:s.wins,winsWithoutRoleChange:s.winsWithoutRoleChange,gamesWithoutRoleChange:s.gamesWithoutRoleChange,winRate:s.gamesWithoutRoleChange>0?(s.winsWithoutRoleChange/s.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((n,s)=>s.appearances-n.appearances);return{villageoisPowers:S(j),loupPowers:v(w),secondaryRoles:i(k)}}function it({selectedPlayerName:r}){const{navigateToGameDetails:l,navigationState:j,updateNavigationState:w}=ie(),k=ce(),[p,S]=N.useState(j.playerHistoryRolesState?.chartMode||"appearances"),{data:v,isLoading:i,error:g}=ge(x=>st(r,x));N.useEffect(()=>{(!j.playerHistoryRolesState||j.playerHistoryRolesState.chartMode!==p)&&w({playerHistoryRolesState:{chartMode:p}})},[p,j.playerHistoryRolesState,w]);const n=x=>{S(x),w({playerHistoryRolesState:{chartMode:x}})},s=N.useMemo(()=>{if(!v)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const x=1,D=1,M=15,I=p==="winRate"?(F,W)=>parseFloat(W.winRate)-parseFloat(F.winRate):(F,W)=>W.appearances-F.appearances,z=F=>({...F,winRateDisplay:Math.max(parseFloat(F.winRate),1)});return{villageoisPowers:v.villageoisPowers.filter(F=>F.appearances>=x).map(z).sort(I).slice(0,M),loupPowers:v.loupPowers.filter(F=>F.appearances>=x).map(z).sort(I).slice(0,M),secondaryRoles:v.secondaryRoles.filter(F=>F.appearances>=D).map(z).sort(I).slice(0,M)}},[v,p]);if(i)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(g)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]});if(!v)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const c=s.villageoisPowers.length>0,a=s.loupPowers.length>0,o=s.secondaryRoles.length>0;if(!c&&!a&&!o)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const b=({active:x,payload:D})=>{if(x&&D&&D.length>0){const M=D[0].payload,I=M.gamesWithoutRoleChange<M.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:M.name})}),e.jsxs("div",{children:["Apparitions: ",M.appearances]}),I&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",M.appearances-M.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",M.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",M.winRate,"%"]})}),M.totalGamesAllModes&&M.totalGamesAllModes!==M.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",M.totalGamesAllModes,")"]}),M.roleBreakdown&&M.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),M.roleBreakdown.map((z,F)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",z.role,": ",z.count]},F))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},m=(x,D,M,I,z)=>{const F=p==="appearances"?"appearances":"winRateDisplay",W=p==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",V=p==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:D}),e.jsx(H,{title:D,children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:x,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Y,{label:{value:W,angle:270,position:"left",style:{textAnchor:"middle"}},domain:V}),e.jsx(O,{content:e.jsx(b,{})}),e.jsx(J,{dataKey:F,label:p==="winRate"?B=>{const{x:t,y:P,width:$,payload:y}=B;if(t===void 0||P===void 0||$===void 0||!y)return null;const h=y.winRate||"0";return e.jsxs("text",{x:t+$/2,y:P-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[h,"%"]})}:void 0,children:x.map((B,t)=>e.jsx(Q,{fill:z?z(B.name,t):M,onClick:()=>I(B.name),style:{cursor:"pointer"}},`cell-${t}`))})]})})})})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:p,onChange:x=>n(x.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[c&&m(s.villageoisPowers,"Camp Villageois","var(--chart-color-1)",x=>{l({selectedPlayer:r,campFilter:{selectedCamp:"Villageois",campFilterMode:p==="winRate"?"wins-only":"all-assignments"},selectedPower:x,fromComponent:`Historique des RÃ´les - Pouvoir: ${x}`})},x=>x==="Chasseur"&&k.Chasseur?k.Chasseur:x==="Alchimiste"&&k.Alchimiste?k.Alchimiste:x==="Protecteur"&&k.Protecteur?k.Protecteur:x==="Disciple"&&k.Disciple?k.Disciple:"var(--chart-color-1)"),a&&m(s.loupPowers,"Camp Loups","var(--chart-color-2)",x=>{l({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:p==="winRate"?"wins-only":"all-assignments"},selectedPower:x,fromComponent:`Historique des RÃ´les - Pouvoir: ${x}`})},()=>k.Loup||"var(--chart-color-2)"),o&&m(s.secondaryRoles,"RÃ´les Secondaires","var(--chart-color-3)",x=>{l({selectedPlayer:r,selectedSecondaryRole:x,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${x}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}function nt({viewMode:r,setViewMode:l,selectedMap:j,setSelectedMap:w,availableMaps:k,clusterRadius:p,setClusterRadius:S,availableDeathTypes:v,selectedDeathTypes:i,setSelectedDeathTypes:g,deathTypeColors:n,isDeathTypesExpanded:s,setIsDeathTypesExpanded:c}){return e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>l("deaths"),style:{background:r==="deaths"?"var(--accent-primary)":"transparent",color:r==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"ðŸ’€ Morts"}),e.jsx("button",{type:"button",onClick:()=>l("kills"),style:{background:r==="kills"?"var(--accent-primary)":"transparent",color:r==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="kills"?"bold":"normal",transition:"all 0.2s"},children:"âš”ï¸ Kills"}),e.jsx("button",{type:"button",onClick:()=>l("transformations"),style:{background:r==="transformations"?"var(--accent-primary)":"transparent",color:r==="transformations"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="transformations"?"bold":"normal",transition:"all 0.2s"},children:"ðŸº Transfos"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:j,onChange:a=>w(a.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:k.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:p,onChange:a=>S(parseInt(a.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:p===0?"Aucun":`${p} unitÃ©${p>1?"s":""}`})]}),r!=="transformations"&&e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>c(!s),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:s?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:s?"rotate(90deg)":"rotate(0deg)"},children:"â–¶"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[i.length," / ",v.length," sÃ©lectionnÃ©",i.length>1?"s":""]})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:a=>{a.stopPropagation(),g(v)},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:a=>{a.stopPropagation(),g([])},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:v.map(a=>{const o=i.includes(a),b=n[a]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",background:o?"var(--bg-tertiary)":"transparent",borderRadius:"4px",border:`1px solid ${o?b:"var(--border-color)"}`,cursor:"pointer",transition:"all 0.2s",fontSize:"0.9rem"},onClick:m=>{m.stopPropagation(),g(o?x=>x.filter(D=>D!==a):x=>[...x,a])},children:[e.jsx("input",{type:"checkbox",checked:o,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:b,flexShrink:0}}),e.jsx("span",{children:le(a)})]},a)})})]})]})]})}function ot({zoneAnalysis:r,selectedMap:l,viewMode:j,selectedPlayerName:w,hoveredZone:k,setHoveredZone:p}){return!r||l!=="Village"||j!=="deaths"?null:e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"0rem",padding:"1.5rem",background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",borderRadius:"12px",border:"2px solid var(--accent-primary)",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",color:"var(--accent-primary)",fontSize:"1.3rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"ðŸ“Š Analyse par zone (Village)"}),e.jsx("p",{style:{fontSize:"0.95rem",marginBottom:"1rem",color:"var(--text-secondary)",lineHeight:"1.5"},children:"Distribution des morts (selon les types sÃ©lectionnÃ©s) comparÃ©e Ã  la moyenne de tous les joueurs:"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:r.zoneStats.map(S=>{const v=S.zone===r.dominantZone&&r.maxDeviation>10;return e.jsxs("div",{onMouseEnter:()=>p(S.zone),onMouseLeave:()=>p(null),style:{padding:"1rem",background:"var(--bg-primary)",borderRadius:"8px",border:k===S.zone?"1px solid var(--accent-primary)":"1px solid var(--border-color)",color:"var(--text-primary)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.95rem"},children:S.zone}),e.jsxs("div",{style:{fontSize:"0.85rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[w,": ",e.jsxs("strong",{children:[S.playerPercent.toFixed(1),"%"]})," (",S.playerCount,")"]}),e.jsxs("div",{style:{opacity:.85},children:["Moyenne: ",S.avgPercent.toFixed(1),"%"]}),e.jsxs("div",{style:{marginTop:"0.25rem",color:v?"var(--accent-secondary)":S.deviation>0?"var(--accent-primary)":"var(--text-secondary)",fontWeight:Math.abs(S.deviation)>5?"bold":"normal"},children:[S.deviation>0?"+":"",S.deviation.toFixed(1),"% vs moyenne"]})]})]},S.zone)})}),r.dominantZone&&r.maxDeviation>10&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",fontSize:"0.95rem",color:"var(--accent-primary)",fontWeight:"bold",background:"var(--bg-primary)",borderRadius:"8px",border:"2px solid var(--accent-primary)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"âš ï¸"}),e.jsxs("span",{children:[w," meurt significativement plus souvent en zone ",r.dominantZone,"(","+"+r.maxDeviation.toFixed(1),"% par rapport Ã  la moyenne)"]})]})]})}function lt({locationData:r,clusteredData:l,viewMode:j,selectedPlayerName:w,selectedMap:k,mapConfig:p,xDomain:S,zDomain:v,hoveredZone:i,getDeathColor:g,handleLocationClick:n}){const s=({active:c,payload:a})=>{if(!c||!a||a.length===0)return null;const o=a[0].payload,b=o.allLocations||[o],m=b.length>1,x=j==="transformations";if(m){const M=new Map,I=new Map,z=new Set,F=new Map;b.forEach(t=>{if(M.set(t.victimName,(M.get(t.victimName)||0)+1),x)F.set(t.camp,(F.get(t.camp)||0)+1);else{const P=t.deathType?le(t.deathType):"Inconnu";I.set(P,(I.get(P)||0)+1)}z.add(t.gameId)});const W=Array.from(M.entries()).sort((t,P)=>P[1]-t[1]).slice(0,3),V=Array.from(I.entries()).sort((t,P)=>P[1]-t[1]).slice(0,3),B=Array.from(F.entries()).sort((t,P)=>P[1]-t[1]);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[x?"ðŸº":j==="deaths"?"ðŸ’€":"âš”ï¸"," ",b.length," ",x?"transformations":j==="deaths"?"morts":"kills"," Ã  cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[x?e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Camps loup:"}),B.map(([t,P])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",P,"Ã—)"]},t))]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:j==="deaths"?"Victimes:":"Kills sur:"}),W.map(([t,P])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",P,"Ã—)"]},t))]}),e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Types de mort:"}),V.map(([t,P])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",P,"Ã—)"]},t))]})]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["ðŸ“ ",z.size," partie",z.size>1?"s":""," diffÃ©rente",z.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const D=b[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[x?"ðŸº":j==="deaths"?"ðŸ’€":"âš”ï¸"," ",x?"Transformation de":j==="deaths"?"Mort de":"Kill de"," ",w]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[x?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ‘¤ ",e.jsx("strong",{children:"Joueur:"})," ",D.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp loup:"})," ",D.camp]}),e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",D.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",D.gameId]})]}):j==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Victime:"})," ",D.victimName]}),e.jsxs("div",{children:["âš”ï¸ ",e.jsx("strong",{children:"Tueur:"})," ",D.killerName||"Inconnu"]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",D.deathType?le(D.deathType):"Inconnu"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Victime:"})," ",D.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp victime:"})," ",D.camp]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",D.deathType?le(D.deathType):"Inconnu"]})]}),!x&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",D.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",D.gameId]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})};return e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:r.length>0?e.jsx(H,{title:j==="deaths"?`Carte des Morts de ${w}`:`Carte des Kills de ${w}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Ee,{margin:{top:20,right:30,left:60,bottom:20},children:[p&&e.jsx(se,{x1:p.zMin,x2:p.zMax,y1:p.xMin,y2:p.xMax,fill:"transparent",stroke:"none",shape:c=>{const{x:a,y:o,width:b,height:m}=c;return e.jsx("image",{x:a,y:o,width:b,height:m,href:p.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),k==="Village"&&i&&e.jsxs(e.Fragment,{children:[i==="Ruines"&&e.jsx(se,{x1:-220,x2:200,y1:100,y2:450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Village Principal"&&e.jsx(se,{x1:-250,x2:100,y1:-120,y2:-450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Ferme"&&e.jsx(se,{x1:-550,x2:-250,y1:150,y2:-150,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Village PÃªcheur"&&e.jsx(se,{x1:150,x2:500,y1:80,y2:-320,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Reste de la Carte"&&e.jsx(se,{x1:p?.zMin??-600,x2:p?.zMax??600,y1:p?.xMin??-500,y2:p?.xMax??500,fill:"var(--accent-primary)",fillOpacity:.15,stroke:"var(--accent-primary)",strokeWidth:2,strokeDasharray:"5 5"})]}),e.jsx(_,{strokeDasharray:"3 3",stroke:p?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(U,{dataKey:"z",type:"number",name:"Position Z",domain:v,hide:!0}),e.jsx(Y,{dataKey:"x",type:"number",name:"Position X",domain:S,hide:!0}),e.jsx(O,{content:e.jsx(s,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Ve,{data:l,onClick:c=>n(c),style:{cursor:"pointer"},isAnimationActive:!1,children:l.map((c,a)=>{const o=Math.min(Math.log2(c.count+1)*3+5,18),b=Math.round(o);return e.jsx(Q,{fill:g(c.deathType,c.camp),stroke:c.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:c.count>1?2:1,opacity:.85,r:b},`cell-${a}`)})})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:j==="deaths"?`Aucune mort localisÃ©e pour ${w} sur cette carte.`:j==="kills"?`Aucun kill localisÃ© pour ${w} sur cette carte.`:`Aucune transformation en loup localisÃ©e pour ${w} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes."})]})})}function be(r,l){return l>=-250&&l<=100&&r>=-450&&r<=-120?"Village Principal":l>=-550&&l<=-250&&r>=-150&&r<=150?"Ferme":l>=150&&l<=500&&r>=-320&&r<=80?"Village PÃªcheur":l>=-220&&l<=200&&r>=100&&r<=450?"Ruines":"Reste de la Carte"}function ne(r){return r==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":r}function ct({selectedPlayerName:r}){const{navigateToGameDetails:l}=ie(),{gameData:j,isLoading:w,error:k}=Ce(),p=ce(),[S,v]=N.useState("deaths"),[i,g]=N.useState(""),[n,s]=N.useState(0),[c,a]=N.useState(null),[o,b]=N.useState([]),[m,x]=N.useState(!1),{data:D}=pe(r,"Tous les camps"),M=N.useMemo(()=>{if(!j)return[];const C=new Set;return j.forEach(f=>{const R=f.PlayerStats.find(T=>T.Username.toLowerCase()===r.toLowerCase());R&&(R.DeathPosition!==null&&f.MapName&&C.add(f.MapName),f.PlayerStats.forEach(T=>{T.KillerName?.toLowerCase()===r.toLowerCase()&&T.DeathPosition!==null&&f.MapName&&C.add(f.MapName)}),R.Actions&&Array.isArray(R.Actions)&&R.Actions.some(T=>T.ActionType==="Transform")&&f.MapName&&C.add(f.MapName))}),Array.from(C).filter(f=>f==="Village"||f==="ChÃ¢teau").sort((f,R)=>f==="Village"?-1:R==="Village"?1:f.localeCompare(R))},[j,r]),I=M.length>0?M[0]:"";i===""&&I!==""&&g(I);const{availableDeathTypes:z,deathTypeColors:F}=N.useMemo(()=>{if(!j||!r)return{availableDeathTypes:[],deathTypeColors:{}};const C=new Set,f={};return j.forEach(R=>{const T=R.PlayerStats.find(u=>u.Username.toLowerCase()===r.toLowerCase());if(T){if(T.DeathPosition&&T.DeathType){const u=ne(T.DeathType);u&&C.add(u)}R.PlayerStats.forEach(u=>{if(u.KillerName?.toLowerCase()===r.toLowerCase()&&u.DeathPosition&&u.DeathType){const A=ne(u.DeathType);A&&C.add(A)}})}}),C.forEach(R=>{f[R]=Be(R,p)}),{availableDeathTypes:Array.from(C).sort(),deathTypeColors:f}},[j,r,p]),W=(C,f)=>S==="transformations"&&f?p[f]||"var(--text-secondary)":C&&F[C]||"var(--text-secondary)";N.useEffect(()=>{if(o.length===0&&z.length>0){const C=z.filter(f=>f!=="VOTED");b(C)}},[z.length]);const V=N.useMemo(()=>{if(!j||!r)return[];const C=[];return j.forEach(f=>{if(i&&f.MapName!==i)return;const R=f.PlayerStats.find(T=>T.Username.toLowerCase()===r.toLowerCase());if(R)if(S==="deaths"){if(R.DeathPosition){const T=oe(R.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),u=de(R.DeathPosition.x,R.DeathPosition.z,f.MapName);C.push({x:u.x,z:u.z,victimName:R.Username,killerName:R.KillerName||null,deathType:ne(R.DeathType),mapName:f.MapName,camp:T,gameId:f.DisplayedId,displayedGameId:f.DisplayedId})}}else S==="kills"?f.PlayerStats.forEach(T=>{if(T.KillerName?.toLowerCase()===r.toLowerCase()&&T.DeathPosition){const u=oe(T.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),A=de(T.DeathPosition.x,T.DeathPosition.z,f.MapName);C.push({x:A.x,z:A.z,victimName:T.Username,killerName:r,deathType:ne(T.DeathType),mapName:f.MapName,camp:u,gameId:f.DisplayedId,displayedGameId:f.DisplayedId})}}):S==="transformations"&&R.Actions&&Array.isArray(R.Actions)&&R.Actions.forEach(T=>{if(T.ActionType==="Transform"&&T.Position){const u=oe(R.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),A=de(T.Position.x,T.Position.z,f.MapName);C.push({x:A.x,z:A.z,victimName:R.Username,killerName:null,deathType:null,mapName:f.MapName,camp:u,gameId:f.DisplayedId,displayedGameId:f.DisplayedId})}})}),S!=="transformations"&&o.length>0&&o.length<z.length?C.filter(f=>f.deathType&&o.includes(f.deathType)):C},[j,r,S,i,o,z]),B=N.useMemo(()=>{if(i!=="Village"||S!=="deaths"||V.length===0)return null;const C={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};if(V.forEach(L=>{const G=be(L.x,L.z);C[G]=(C[G]||0)+1}),!j)return null;const f={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};j.forEach(L=>{L.MapName==="Village"&&L.PlayerStats.forEach(G=>{if(!G.DeathPosition)return;const re=ne(G.DeathType);if(o.length>0&&o.length<z.length&&(!re||!o.includes(re)))return;const X=de(G.DeathPosition.x,G.DeathPosition.z,"Village"),Z=be(X.x,X.z);f[Z]=(f[Z]||0)+1})});const R=Object.values(f).reduce((L,G)=>L+G,0),T=Object.values(C).reduce((L,G)=>L+G,0);if(R===0||T===0)return null;const u=["Village Principal","Village PÃªcheur","Ferme","Ruines","Reste de la Carte"];let A=0,E=null;const q=u.map(L=>{const G=C[L]/T*100,re=f[L]/R*100,X=G-re;return X>A&&C[L]>=2&&(A=X,E=L),{zone:L,playerCount:C[L],playerPercent:G,avgPercent:re,deviation:X}});return{totalPlayerDeaths:T,totalAllDeaths:R,zoneStats:q,dominantZone:E,maxDeviation:A}},[V,i,S,j,o,z]),t=N.useMemo(()=>Ke(V,n).map((f,R)=>{const T=f.items[0],u=Oe(f.items);return{x:f.centroidX,z:f.centroidZ,count:f.items.length,allLocations:f.items,victimName:f.items.length===1?T.victimName:null,killerName:f.items.length===1?T.killerName:null,deathType:u,mapName:T.mapName,camp:T.camp,gameId:f.items.length===1?T.gameId:null,displayedGameId:f.items.length===1?T.displayedGameId:null,clusterIndex:R}}),[V,n]),P=N.useMemo(()=>He(i),[i]),{xDomain:$,zDomain:y}=N.useMemo(()=>{if(P)return{xDomain:[P.xMin,P.xMax],zDomain:[P.zMin,P.zMax]};if(t.length===0)return{xDomain:[0,100],zDomain:[0,100]};const C=t.map(L=>L.x),f=t.map(L=>L.z),R=Math.min(...C),T=Math.max(...C),u=Math.min(...f),A=Math.max(...f),E=(T-R)*.1||10,q=(A-u)*.1||10;return{xDomain:[R-E,T+E],zDomain:[u-q,A+q]}},[t,P]),h=C=>{if(!C)return;const f=C.allLocations||[C];if(f.length===1)l({selectedGame:f[0].gameId,fromComponent:"Player Death Map"});else{const R=f.map(T=>T.gameId).filter(T=>T);l({selectedGameIds:R,fromComponent:"Player Death Map"})}},d=N.useMemo(()=>{if(!D?.mapStats||!i)return null;const C=D.mapStats[i];return C?{winRate:C.winRate,wins:C.wins,total:C.appearances}:null},[D,i]);return w?e.jsx("div",{className:"donnees-attente",children:"Chargement des donnÃ©es..."}):k?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",k]}):j?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsx(nt,{viewMode:S,setViewMode:v,selectedMap:i,setSelectedMap:g,availableMaps:M,clusterRadius:n,setClusterRadius:s,availableDeathTypes:z,selectedDeathTypes:o,setSelectedDeathTypes:b,deathTypeColors:F,isDeathTypesExpanded:m,setIsDeathTypesExpanded:x}),e.jsx(lt,{locationData:V,clusteredData:t,viewMode:S,selectedPlayerName:r,selectedMap:i,mapConfig:P,xDomain:$,zDomain:y,hoveredZone:c,getDeathColor:W,handleLocationClick:h}),e.jsx(ot,{zoneAnalysis:B,selectedMap:i,viewMode:S,selectedPlayerName:r,hoveredZone:c,setHoveredZone:a}),d&&e.jsxs("div",{style:{flex:"1 1 100%",textAlign:"center",padding:"0.75rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)",marginTop:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginRight:"1rem"},children:["Taux de victoire sur ",e.jsx("strong",{children:i})," :"]}),e.jsxs("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:parseFloat(d.winRate)>=50?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[d.winRate,"%"]}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["(",d.wins," / ",d.total," victoires)"]})]}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"Ã€ propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",S==="deaths"?`les emplacements oÃ¹ ${r} est mort`:S==="kills"?`les emplacements oÃ¹ ${r} a Ã©liminÃ© d'autres joueurs`:`les emplacements oÃ¹ ${r} s'est transformÃ© en loup`," au cours des parties.",S!=="transformations"&&"Les couleurs indiquent le type de mort."," Cliquez sur un point pour voir les dÃ©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroupÃ©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’€ Morts:"})," OÃ¹ le joueur a Ã©tÃ© Ã©liminÃ©",e.jsx("br",{}),e.jsx("strong",{children:"âš”ï¸ Kills:"})," OÃ¹ le joueur a Ã©liminÃ© d'autres joueurs",e.jsx("br",{}),e.jsx("strong",{children:"ðŸº Transformations:"})," OÃ¹ le joueur s'est transformÃ© en loup"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function Pe(r){return r.PlayerStats.some(l=>l.SecondsTalkedOutsideMeeting>0||l.SecondsTalkedDuringMeeting>0)}function me(r,l){const j=l.DeathDateIrl||r.EndDate,w=Se(r.StartDate,j);return w&&w>0?w:0}function dt(r){const l=r.filter(Pe),j=new Map;return l.forEach(w=>{w.PlayerStats.forEach(k=>{const p=te(k),S=Ne(k),v=me(w,k);if(v<=0)return;j.has(p)||j.set(p,{displayName:S,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const i=j.get(p);i.gamesPlayed++,i.totalSecondsAll+=(k.SecondsTalkedOutsideMeeting||0)+(k.SecondsTalkedDuringMeeting||0),i.totalGameDuration+=v})}),{playerStats:j,gamesWithTalkingData:l.length}}function ut(r,l){if(!l||l.length===0||!r)return null;const j=dt(l),w=l.filter(Pe);if(w.length===0||j.playerStats.size===0)return null;let k=null;for(const[h,d]of j.playerStats)if(d.displayName===r){k=h;break}if(!k)return null;let p=0,S=0,v=0,i=0;const g={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},n=new Map;let s=0,c=0,a=0,o=0;if(w.forEach(h=>{const d=h.PlayerStats.find(q=>te(q)===k);if(!d)return;const C=me(h,d);if(C<=0)return;p++;const f=d.SecondsTalkedOutsideMeeting||0,R=d.SecondsTalkedDuringMeeting||0,T=f+R;S+=f,v+=R,i+=C;const u=Fe(d.MainRoleInitial,d.Power);g[u].gamesPlayed++,g[u].secondsOutside+=f,g[u].secondsDuring+=R,g[u].gameDuration+=C;const A=Ge(d);n.has(A)||n.set(A,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const E=n.get(A);E.gamesPlayed++,E.totalSecondsAll+=T,E.totalGameDuration+=C}),p===0||i<=0)return null;const b=3600/i,m=S*b,x=v*b,D=(S+v)*b,M=S+v>0?v/(S+v)*100:0,I=[];for(const[h,d]of Object.entries(g)){if(d.gamesPlayed===0)continue;const C=d.gameDuration>0?3600/d.gameDuration:0,f=d.secondsOutside+d.secondsDuring;I.push({camp:h,gamesPlayed:d.gamesPlayed,totalSecondsOutside:d.secondsOutside,totalSecondsDuring:d.secondsDuring,totalSecondsAll:f,totalGameDurationSeconds:d.gameDuration,secondsOutsidePer60Min:d.secondsOutside*C,secondsDuringPer60Min:d.secondsDuring*C,secondsAllPer60Min:f*C,meetingRatio:f>0?d.secondsDuring/f*100:0})}I.sort((h,d)=>d.gamesPlayed-h.gamesPlayed);const z=Array.from(n.entries()).filter(([h,d])=>d.gamesPlayed>=1).map(([h,d])=>({role:h,gamesPlayed:d.gamesPlayed,secondsAllPer60Min:d.totalGameDuration>0?d.totalSecondsAll/d.totalGameDuration*3600:0,totalSecondsAll:d.totalSecondsAll})).sort((h,d)=>d.secondsAllPer60Min-h.secondsAllPer60Min),F=[];for(const[h,d]of j.playerStats)d.totalGameDuration>0&&F.push({id:h,name:d.displayName,per60:d.totalSecondsAll/d.totalGameDuration*3600});F.sort((h,d)=>d.per60-h.per60);const W=F.reduce((h,d)=>h+d.per60,0),V=F.length>0?W/F.length:0,B=F.findIndex(h=>h.id===k)+1,t=F.length,P=t>0?Math.round((1-(B-1)/t)*100):0,$=D;w.forEach(h=>{const d=h.PlayerStats.find(T=>te(T)===k);if(!d)return;const C=me(h,d);if(C<=0)return;((d.SecondsTalkedOutsideMeeting||0)+(d.SecondsTalkedDuringMeeting||0))/C*3600>=$?(s++,d.Victorious&&c++):(a++,d.Victorious&&o++)});const y={gamesAboveAverage:s,winsAboveAverage:c,winRateAboveAverage:s>0?c/s*100:0,gamesBelowAverage:a,winsBelowAverage:o,winRateBelowAverage:a>0?o/a*100:0};return{playerName:r,gamesPlayed:p,gamesWithTalkingData:j.gamesWithTalkingData,totalSecondsOutside:S,totalSecondsDuring:v,totalSecondsAll:S+v,totalGameDurationSeconds:i,secondsOutsidePer60Min:m,secondsDuringPer60Min:x,secondsAllPer60Min:D,meetingRatio:M,campBreakdown:I,globalAverageSecondsAllPer60Min:V,playerRank:B,totalPlayersWithData:t,percentile:P,roleBreakdown:z,winCorrelation:y}}function pt(r,l){return r?r.roleBreakdown.slice(0,l):[]}function mt(r){const{data:l,isLoading:j,error:w}=ge(k=>r?ut(r,k):null);return{data:l,isLoading:j,error:w}}function ht({selectedPlayerName:r}){const{data:l,isLoading:j,error:w}=mt(r),k=ce(),[p,S]=N.useState("both"),v=N.useMemo(()=>l?.campBreakdown?l.campBreakdown.map(a=>({camp:a.camp,"Hors rÃ©union":Math.round(a.secondsOutsidePer60Min),"En rÃ©union":Math.round(a.secondsDuringPer60Min),total:Math.round(a.secondsAllPer60Min),gamesPlayed:a.gamesPlayed,meetingRatio:a.meetingRatio.toFixed(1)})):[],[l]),i=N.useMemo(()=>l?[{name:"En rÃ©union",value:l.totalSecondsDuring,color:"#2196F3"},{name:"Hors rÃ©union",value:l.totalSecondsOutside,color:"#FF9800"}]:[],[l]);if(j)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(w)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",w]});if(!l)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de temps de parole ne sont disponibles que pour les parties rÃ©centes."})]});const g=l.secondsAllPer60Min-l.globalAverageSecondsAllPer60Min,n=l.globalAverageSecondsAllPer60Min>0?(g/l.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",s=g>0,c=l.winCorrelation.winRateAboveAverage-l.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¤ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:ae(l.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:s?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[s?"+":"",n,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",l.playerRank," / ",l.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-l.percentile+1,"% ",l.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“ˆ Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:l.gamesPlayed}),e.jsxs("p",{children:["sur ",l.gamesWithTalkingData," avec donnÃ©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ—£ï¸ Ratio en rÃ©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[l.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),v.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(H,{title:"Temps de parole par camp (par 60min de jeu)",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>S("meeting"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:p==="meeting"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:p==="meeting"?"var(--accent-primary)":"var(--bg-secondary)",color:p==="meeting"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:p==="meeting"?"bold":"normal"},children:"En rÃ©union"}),e.jsx("button",{onClick:()=>S("outside"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:p==="outside"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:p==="outside"?"var(--accent-primary)":"var(--bg-secondary)",color:p==="outside"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:p==="outside"?"bold":"normal"},children:"Hors rÃ©union"}),e.jsx("button",{onClick:()=>S("both"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:p==="both"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:p==="both"?"var(--accent-primary)":"var(--bg-secondary)",color:p==="both"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:p==="both"?"bold":"normal"},children:"Les deux"})]}),e.jsx("div",{style:{height:350},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:v,layout:"vertical",children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(U,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:a=>`${Math.floor(a/60)}m`}),e.jsx(Y,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(O,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(a,o)=>[ae(a),o],labelFormatter:a=>{const o=v.find(b=>b.camp===a);return`${a} (${o?.gamesPlayed||0} parties)`}}),e.jsx(_e,{}),(p==="both"||p==="outside")&&e.jsx(J,{dataKey:"Hors rÃ©union",stackId:"talk",fill:"#FF9800"}),(p==="both"||p==="meeting")&&e.jsx(J,{dataKey:"En rÃ©union",stackId:"talk",fill:"#2196F3"})]})})})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:(()=>{const a=v.find(x=>x.camp==="Villageois"),o=v.find(x=>x.camp==="Loup");if(!a||!o)return e.jsx("p",{children:"ðŸ’¡ Pas assez de donnÃ©es pour comparer les camps Villageois et Loups."});const b=a.total-o.total,m=o.total>0?(Math.abs(b)/o.total*100).toFixed(0):"0";return b>0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:fe("Villageois")},children:[ae(b)," de plus (+",m,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Villageois"})," qu'en tant que"," ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]}):b<0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:fe("Loup")},children:[ae(Math.abs(b))," de plus (+",m,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Loup"})," qu'en tant que"," ",e.jsx("strong",{children:"Villageois"})," (par heure de jeu)."]}):e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle exactement autant en tant que"," ",e.jsx("strong",{children:"Villageois"})," qu'en tant que ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(H,{title:"RÃ©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Re,{children:[e.jsx(ke,{data:i,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:a=>`${a.name}: ${((a.percent||0)*100).toFixed(1)}%`,children:i.map((a,o)=>e.jsx(Q,{fill:a.color},`cell-${o}`))}),e.jsx(O,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:a=>ae(a)})]})})})})}),l&&l.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(H,{title:a=>a?"Top 15 rÃ´les les plus bavards (par 60min)":"Top 5 rÃ´les les plus bavards (par 60min)",children:a=>{const b=pt(l,a?15:5).map(m=>({role:m.role,secondsPer60Min:Math.round(m.secondsAllPer60Min),gamesPlayed:m.gamesPlayed}));return e.jsx("div",{style:{height:a?400:300},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:b,children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(U,{dataKey:"role",tick:{fill:"var(--text-primary)",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(Y,{tick:{fill:"var(--text-secondary)"},tickFormatter:m=>`${Math.floor(m/60)}m`}),e.jsx(O,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:m=>[ae(m),"Temps de parole"],labelFormatter:m=>{const x=b.find(D=>D.role===m);return`${m} (${x?.gamesPlayed||0} parties)`}}),e.jsx(J,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",children:b.map((m,x)=>e.jsx(Q,{fill:k[m.role]||k.Villageois},`cell-${x}`))})]})})})}})}),(l.winCorrelation.gamesAboveAverage>0||l.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"ðŸŽ¯ CorrÃ©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[l.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",l.winCorrelation.winsAboveAverage,"/",l.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[l.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",l.winCorrelation.winsBelowAverage,"/",l.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(c)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:c>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[c>0?"supÃ©rieur":"infÃ©rieur"," de ",Math.abs(c).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function $t(){const{settings:r,updateSettings:l}=he(),{navigateToGameDetails:j,navigationState:w,updateNavigationState:k}=ie(),{data:p,isLoading:S,error:v}=Ae(),{joueursData:i,isLoading:g}=ue(),{data:n,isLoading:s,error:c}=Ze(r.highlightedPlayer),a=xe(i),[o,b]=N.useState(""),[m,x]=N.useState(null),{clips:D}=Ue(r.highlightedPlayer),{clips:M}=Ye(),[I,z]=N.useState(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded"?"modded":"all":r.gameFilter==="modded"?"modded":"all"),F=N.useMemo(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded":r.gameFilter==="modded",[r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter,r.gameFilter]),[W,V]=N.useState(r.selectedPlayerSelectionView||w.selectedPlayerSelectionView||"achievements"),[B,t]=N.useState("session"),[P,$]=N.useState("all");N.useEffect(()=>{if(r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled){const u=r.independentFilters.gameFilter==="modded"?"modded":"all";z(u)}else if(!r.useIndependentFilters){const u=r.gameFilter==="modded"?"modded":"all";z(u)}},[r.gameFilter,r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter]),N.useEffect(()=>{F&&I!=="modded"&&z("modded")},[F,I]),N.useEffect(()=>{const u=r.selectedPlayerSelectionView||w.selectedPlayerSelectionView;u&&u!==W&&V(u)},[r.selectedPlayerSelectionView,w.selectedPlayerSelectionView]);const{data:y}=pe(r.highlightedPlayer||""),h=N.useMemo(()=>{if(!p||!p.GameStats)return[];const u=F?p.GameStats.filter(E=>E.Modded===!0):p.GameStats,A=new Map;return u.forEach(E=>{const q=new Date(E.StartDate);E.PlayerStats.forEach(L=>{const G=te(L),X=i?.Players?.find(De=>De.SteamID===G)?.Joueur||L.Username;A.has(G)||A.set(G,{games:0,wins:0,firstDate:q,lastDate:q,displayName:X});const Z=A.get(G);Z.games++,L.Victorious&&Z.wins++,q<Z.firstDate&&(Z.firstDate=q),q>Z.lastDate&&(Z.lastDate=q)})}),Array.from(A.entries()).map(([E,q])=>{let L=i?.Players?.find(G=>G.SteamID===E);return L||(L=i?.Players?.find(G=>G.Joueur===q.displayName)),{id:E,name:q.displayName,totalGames:q.games,totalWins:q.wins,winRate:q.games>0?q.wins/q.games*100:0,firstGameDate:q.firstDate.toLocaleDateString("fr-FR"),lastGameDate:q.lastDate.toLocaleDateString("fr-FR"),isHighlighted:q.displayName===r.highlightedPlayer,image:L?.Image||null,twitch:L?.Twitch||null,youtube:L?.Youtube||null}})},[p,r.highlightedPlayer,i,F]),d=N.useMemo(()=>{if(!o.trim())return h;const u=o.toLowerCase();return h.filter(A=>A.name.toLowerCase().includes(u))},[h,o]),C=N.useMemo(()=>[...d].sort((u,A)=>A.totalGames-u.totalGames),[d]),f=u=>{l({highlightedPlayer:u}),b("")},R=u=>{V(u),k({selectedPlayerSelectionView:u}),l({selectedPlayerSelectionView:u,tab:"playerSelection"})},T=()=>{if(D.length===0)return;const u=Math.floor(Math.random()*D.length);x(D[u])};return S||g?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):v?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",v]})]}):!p||h.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!r.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:o,onChange:u=>b(u.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[d.length," joueur",d.length!==1?"s":"",o&&` (filtrÃ©${d.length!==1?"s":""} de ${h.length})`]})]})]}),e.jsx("div",{className:"player-display",children:o?d.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>b(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:C.map(u=>e.jsxs("button",{type:"button",className:`suggestion-btn ${u.isHighlighted?"highlighted":""}`,onClick:()=>f(u.name),children:[u.image?e.jsx("img",{src:u.image,alt:`Photo de profil de ${u.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":a[u.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[u.name,u.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[u.totalGames," parties â€¢ ",u.winRate.toFixed(1),"% victoires"]})]})]},u.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',o,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>b(""),children:"Effacer la recherche"})]}):r.highlightedPlayer?(()=>{const u=h.find(A=>A.name===r.highlightedPlayer);return u?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:u.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[u.image?e.jsx("img",{src:u.image,alt:`Photo de profil de ${u.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":a[u.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[u.totalGames," parties â€¢ ",u.totalWins," victoires â€¢ ",u.winRate.toFixed(1),"% taux de victoire"]}),(u.twitch||u.youtube||D.length>0)&&e.jsxs("div",{className:"social-links",children:[u.twitch&&e.jsx("a",{href:u.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),u.youtube&&e.jsx("a",{href:u.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"}),D.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:A=>{A.stopPropagation(),T()},title:`${D.length} clip${D.length>1?"s":""} disponible${D.length>1?"s":""}`,children:["ðŸŽ¬ Clip alÃ©atoire (",D.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${W==="achievements"?"active":""}`,onClick:()=>R("achievements"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${W==="evolution"?"active":""}`,onClick:()=>R("evolution"),children:"Ã‰volution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${W==="camps"?"active":""}`,onClick:()=>R("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${W==="roles"?"active":""}`,onClick:()=>R("roles"),children:"RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${W==="kills"?"active":""}`,onClick:()=>R("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${W==="deathmap"?"active":""}`,onClick:()=>R("deathmap"),children:"Cartes"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${W==="talkingtime"?"active":""}`,onClick:()=>R("talkingtime"),children:"Parole"})]}),W==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[s?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):c?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",c]})}):n?e.jsx(et,{achievements:I==="all"?n.allGamesAchievements:n.moddedOnlyAchievements,title:I==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:I}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[!F&&e.jsx("button",{type:"button",className:`filter-btn ${I==="all"?"active":""}`,onClick:A=>{A.stopPropagation(),z("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${I==="modded"?"active":""}`,onClick:A=>{A.stopPropagation(),z("modded")},disabled:F,children:"Parties moddÃ©es"})]})]}),W==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[y&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{j({selectedPlayer:u.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${u.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:y.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:Ie(y.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{j({selectedPlayer:u.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${u.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:y.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[y.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:B,onChange:A=>t(A.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:P,onChange:A=>$(A.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(tt,{selectedPlayerName:u.name,groupingMethod:B,campFilter:P})]}),W==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(rt,{selectedPlayerName:u.name})}),W==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(it,{selectedPlayerName:u.name})}),W==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(at,{selectedPlayerName:u.name})}),W==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ct,{selectedPlayerName:u.name})}),W==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ht,{selectedPlayerName:u.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:A=>{A.stopPropagation(),l({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[u.firstGameDate," - ",u.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',r.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>l({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:C.map(u=>e.jsxs("div",{className:`character-card ${u.isHighlighted?"highlighted":""}`,onClick:()=>f(u.name),title:`${u.name} - ${u.totalGames} parties, ${u.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:u.image?e.jsx("img",{src:u.image,alt:`Photo de profil de ${u.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":a[u.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:u.name}),(u.twitch||u.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[u.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),u.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},u.id))})})}),m&&e.jsx(Je,{clip:m,onClose:()=>x(null),relatedClips:Qe(m,M),nextClip:je(m,M),onNextClip:()=>{const u=je(m,M);u&&x(u)},onRelatedClip:u=>{const A=M.find(E=>E.ClipId===u);A&&x(A)}})]})}export{$t as PlayerSelectionPage};
