import{u as T,r as M,j as a}from"./index-w9Rh8Kuc.js";import{u as k}from"./baseStatsHook-DZdJ8mHb.js";import{F as B,B as L,C as q,X as N,Y as V,a as z,b as D}from"./FullscreenChart-x41h67tg.js";import{a as E,g as $}from"./datasyncExport-D6_8Fmuy.js";import{a as G}from"./api-Cz7HL1m3.js";import{R as X,T as K}from"./CategoricalChart-Bg2aBtM_.js";function Y(C){if(C.length===0)return null;const r=new Map,p=new Map,m=new Map;C.forEach(c=>{c.Modded&&(!c.LegacyData||c.LegacyData.deathInformationFilled!==!0||c.PlayerStats.forEach(o=>{if(o.MainRoleInitial==="Inconnu")return;const e=o.Victorious,t=E(o.MainRoleInitial,o.MainRoleChanges||[])!==o.MainRoleInitial,g=$(o.MainRoleInitial),x=g==="Loup"||g==="Tra√Ætre"||g==="Louveteau";if(g==="Villageois"&&(o.MainRoleInitial==="Chasseur"||o.MainRoleInitial==="Alchimiste")){const n=r.get(o.MainRoleInitial)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};r.set(o.MainRoleInitial,{appearances:n.appearances+1,wins:n.wins+(e?1:0),winsWithoutRoleChange:n.winsWithoutRoleChange+(!t&&e?1:0),gamesWithoutRoleChange:n.gamesWithoutRoleChange+(t?0:1)})}else if(o.Power&&o.Power.trim()!==""){if(g==="Villageois"){const n=r.get(o.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};r.set(o.Power,{appearances:n.appearances+1,wins:n.wins+(e?1:0),winsWithoutRoleChange:n.winsWithoutRoleChange+(!t&&e?1:0),gamesWithoutRoleChange:n.gamesWithoutRoleChange+(t?0:1)})}else if(x){const n=p.get(o.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},u=n.roleBreakdown;u.set(o.MainRoleInitial,(u.get(o.MainRoleInitial)||0)+1),p.set(o.Power,{appearances:n.appearances+1,wins:n.wins+(e?1:0),winsWithoutRoleChange:n.winsWithoutRoleChange+(!t&&e?1:0),gamesWithoutRoleChange:n.gamesWithoutRoleChange+(t?0:1),roleBreakdown:u})}}else if(g==="Villageois"||x)if(g==="Villageois"){const n=r.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};r.set("Aucun pouvoir",{appearances:n.appearances+1,wins:n.wins+(e?1:0),winsWithoutRoleChange:n.winsWithoutRoleChange+(!t&&e?1:0),gamesWithoutRoleChange:n.gamesWithoutRoleChange+(t?0:1)})}else{const n=p.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},u=n.roleBreakdown;u.set(o.MainRoleInitial,(u.get(o.MainRoleInitial)||0)+1),p.set("Aucun pouvoir",{appearances:n.appearances+1,wins:n.wins+(e?1:0),winsWithoutRoleChange:n.winsWithoutRoleChange+(!t&&e?1:0),gamesWithoutRoleChange:n.gamesWithoutRoleChange+(t?0:1),roleBreakdown:u})}if(o.SecondaryRole&&o.SecondaryRole.trim()!==""){if(o.SecondaryRole==="Inconnu")return;const n=m.get(o.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};m.set(o.SecondaryRole,{appearances:n.appearances+1,wins:n.wins+(e?1:0),winsWithoutRoleChange:n.winsWithoutRoleChange+(!t&&e?1:0),gamesWithoutRoleChange:n.gamesWithoutRoleChange+(t?0:1)})}}))});const l=c=>Array.from(c.entries()).map(([o,e])=>({name:o,appearances:e.appearances,wins:e.wins,winsWithoutRoleChange:e.winsWithoutRoleChange,gamesWithoutRoleChange:e.gamesWithoutRoleChange,winRate:e.gamesWithoutRoleChange>0?(e.winsWithoutRoleChange/e.gamesWithoutRoleChange*100).toFixed(1):"0.0",winRateDisplay:Math.max(e.gamesWithoutRoleChange>0?e.winsWithoutRoleChange/e.gamesWithoutRoleChange*100:0,1)})).sort((o,e)=>e.appearances-o.appearances),y=c=>Array.from(c.entries()).map(([o,e])=>({name:o,appearances:e.appearances,wins:e.wins,winsWithoutRoleChange:e.winsWithoutRoleChange,gamesWithoutRoleChange:e.gamesWithoutRoleChange,winRate:e.gamesWithoutRoleChange>0?(e.winsWithoutRoleChange/e.gamesWithoutRoleChange*100).toFixed(1):"0.0",winRateDisplay:Math.max(e.gamesWithoutRoleChange>0?e.winsWithoutRoleChange/e.gamesWithoutRoleChange*100:0,1),roleBreakdown:Array.from(e.roleBreakdown.entries()).map(([h,t])=>({role:h,count:t})).sort((h,t)=>t.count-h.count)})).sort((o,e)=>e.appearances-o.appearances),R=c=>Array.from(c.entries()).map(([o,e])=>({name:o,appearances:e.appearances,wins:e.wins,winsWithoutRoleChange:e.winsWithoutRoleChange,gamesWithoutRoleChange:e.gamesWithoutRoleChange,winRate:e.gamesWithoutRoleChange>0?(e.winsWithoutRoleChange/e.gamesWithoutRoleChange*100).toFixed(1):"0.0",winRateDisplay:Math.max(e.gamesWithoutRoleChange>0?e.winsWithoutRoleChange/e.gamesWithoutRoleChange*100:0,1)})).sort((o,e)=>e.appearances-o.appearances);return{villageoisPowers:l(r),loupPowers:y(p),secondaryRoles:R(m)}}function Z(){const{navigateToGameDetails:C,navigationState:r,updateNavigationState:p}=T(),m=G(),[l,y]=M.useState(r.rolesStatsState?.chartMode||"appearances"),{data:R,isLoading:c,error:o}=k(i=>Y(i));M.useEffect(()=>{(!r.rolesStatsState||r.rolesStatsState.chartMode!==l)&&p({rolesStatsState:{chartMode:l}})},[l,r.rolesStatsState,p]);const e=i=>{y(i),p({rolesStatsState:{chartMode:i}})},h=M.useMemo(()=>{if(!R)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const i=15,d=l==="winRate"?(s,w)=>parseFloat(w.winRate)-parseFloat(s.winRate):(s,w)=>w.appearances-s.appearances;return{villageoisPowers:[...R.villageoisPowers].sort(d).slice(0,i),loupPowers:[...R.loupPowers].sort(d).slice(0,i),secondaryRoles:[...R.secondaryRoles].sort(d).slice(0,i)}},[R,l]);if(c)return a.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques des r√¥les..."});if(o)return a.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",o]});if(!R)return a.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de r√¥le disponible"});const t=h.villageoisPowers.length>0,g=h.loupPowers.length>0,x=h.secondaryRoles.length>0;if(!t&&!g&&!x)return a.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou r√¥le secondaire trouv√©"});const n=({active:i,payload:d})=>{if(i&&d&&d.length>0){const s=d[0].payload,w=s.gamesWithoutRoleChange<s.appearances;return a.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[a.jsx("div",{children:a.jsx("strong",{children:s.name})}),a.jsxs("div",{children:["Apparitions: ",s.appearances]}),w&&a.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",s.appearances-s.gamesWithoutRoleChange," avec changement de r√¥le (exclu du calcul)"]}),a.jsxs("div",{children:["Victoires: ",s.winsWithoutRoleChange]}),a.jsx("div",{children:a.jsxs("strong",{children:["Taux de victoire: ",s.winRate,"%"]})}),s.roleBreakdown&&s.roleBreakdown.length>0&&a.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[a.jsx("div",{style:{fontStyle:"italic"},children:"R√©partition par r√¥le:"}),s.roleBreakdown.map((v,j)=>a.jsxs("div",{style:{marginLeft:"0.5rem"},children:["‚Ä¢ ",v.role,": ",v.count]},j))]}),a.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null},u=(i,d,s,w,v)=>{const j=l==="appearances"?"appearances":"winRateDisplay",b=l==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",F=l==="winRate"?[0,100]:void 0;return a.jsxs("div",{className:"lycans-graphique-section",children:[a.jsx("h3",{children:d}),a.jsx(B,{title:d,children:a.jsx("div",{style:{height:400},children:a.jsx(X,{width:"100%",height:"100%",children:a.jsxs(L,{data:i,margin:{top:20,right:30,left:20,bottom:80},children:[a.jsx(q,{strokeDasharray:"3 3"}),a.jsx(N,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:12}),a.jsx(V,{label:{value:b,angle:270,position:"left",style:{textAnchor:"middle"}},domain:F}),a.jsx(K,{content:a.jsx(n,{})}),a.jsx(z,{dataKey:j,label:l==="winRate"?f=>{const{x:W,y:P,width:A,payload:S}=f;if(W===void 0||P===void 0||A===void 0||!S)return null;const I=S.winRate||"0";return a.jsxs("text",{x:W+A/2,y:P-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[I,"%"]})}:void 0,children:i.map((f,W)=>a.jsx(D,{fill:v?v(f.name,W):s,onClick:()=>w(f.name),style:{cursor:"pointer"}},`cell-${W}`))})]})})})})]})};return a.jsxs("div",{className:"lycans-camps-container",children:[a.jsx("h2",{children:"Statistiques G√©n√©rales des R√¥les et Pouvoirs"}),a.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),a.jsxs("select",{id:"chart-mode-select",value:l,onChange:i=>e(i.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[a.jsx("option",{value:"appearances",children:"Apparitions"}),a.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),a.jsxs("div",{className:"lycans-graphiques-groupe",children:[t&&u(h.villageoisPowers,"Camp Villageois","var(--chart-color-1)",i=>{C({campFilter:{selectedCamp:"Villageois",campFilterMode:"all-assignments"},fromComponent:`Statistiques des R√¥les - Pouvoir: ${i}`})},i=>i==="Chasseur"&&m.Chasseur?m.Chasseur:i==="Alchimiste"&&m.Alchimiste?m.Alchimiste:"var(--chart-color-1)"),g&&u(h.loupPowers,"Camp Loups","var(--chart-color-2)",i=>{C({campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments"},fromComponent:`Statistiques des R√¥les - Pouvoir: ${i}`})},()=>m.Loup||"var(--chart-color-2)"),x&&u(h.secondaryRoles,"R√¥les Secondaires","var(--chart-color-3)",i=>{C({fromComponent:`Statistiques des R√¥les - R√¥le Secondaire: ${i}`})}),a.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"‚ÑπÔ∏è Les victoires et le taux de victoire excluent les parties o√π le r√¥le principal a chang√© en cours de partie."})]})]})}export{Z as RolesStatsChart};
