import{u as L}from"./baseStatsHook-BAbniwWm.js";import{g as N,a as C}from"./datasyncExport-CjB7UYqV.js";import{i as v,D as t}from"./deathTypes-gHH1w6_X.js";import{c as K}from"./api-BMCeQXdI.js";import{g as R}from"./index-CdAoHGu9.js";function k(n,u){if(!n||!u)return!1;const l=n.split(".").map(Number),c=u.split(".").map(Number);for(let a=0;a<Math.max(l.length,c.length);a++){const e=l[a]||0,i=c[a]||0;if(e>i)return!0;if(e<i)return!1}return!0}function P(n){return n?n===t.SURVIVALIST_NOT_SAVED?t.BY_WOLF:n:t.UNKNOWN}function M(n){const u=new Set;n.forEach(a=>{a.PlayerStats.forEach(e=>{const i=N(e.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});u.add(i)})});const l=Array.from(u);return[...K.filter(a=>l.includes(a)),...l.filter(a=>!K.includes(a)).sort()]}function Y(n){switch(n){case t.VOTED:return"Mort aux votes";case t.BY_WOLF:case t.SURVIVALIST_NOT_SAVED:return"Kill en Loup";case t.BY_ZOMBIE:return"Kill en Zombie";case t.BY_BEAST:return"Kill en Bête";case t.BY_AVATAR_CHAIN:return"Mort d'Avatar";case t.BULLET:return"Tir de Chasseur";case t.BULLET_HUMAN:return"Kill de Chasseur (sur humain)";case t.BULLET_WOLF:return"Kill de Chasseur (sur loup)";case t.SHERIF_SUCCESS:return"Kill de Shérif";case t.OTHER_AGENT:return"Kill d'Agent";case t.AVENGER:return"Kill de Vengeur";case t.SEER:return"Kill de Devin";case t.HANTED:return"Kill avec Potion hantée";case t.ASSASSIN:return"Kill avec Potion (Assassin)";case t.LOVER_DEATH:return"Kill d'amoureux";case t.BOMB:return"Explosion";case t.CRUSHED:return"Écrasement";case t.STARVATION:return"Famine";case t.STARVATION_AS_BEAST:return"Tuerie bestiale";case t.FALL:return"Chute mortelle";case t.UNKNOWN:return"Kill inconnu";case t.SMUGGLER_HUNT_KILL:return"Kill sur Contrebandier";default:return""}}function j(n){const u=new Set;n.forEach(a=>{a.PlayerStats.forEach(e=>{if(e.DeathType&&v(e.DeathType)){const i=P(e.DeathType);i&&u.add(i)}})});const l=Array.from(u),c=[t.BY_WOLF,t.VOTED,t.BULLET,t.BULLET_HUMAN,t.BULLET_WOLF,t.BY_ZOMBIE,t.ASSASSIN,t.AVENGER,t.LOVER_DEATH,t.SHERIF_SUCCESS];return[...c.filter(a=>l.includes(a)),...l.filter(a=>!c.includes(a)).sort()]}function U(n,u){return n.PlayerStats.filter(l=>l.DeathType&&v(l.DeathType)&&(l.DeathTiming||l.DeathType)).map(l=>{let c=null,a=null;if(l.KillerName){const e=n.PlayerStats.find(i=>i.Username===l.KillerName);if(e){a=R(e);const i=C(e.MainRoleInitial,e.MainRoleChanges||[]);c=N(i,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1}),i&&i!==e.MainRoleInitial&&(i==="Loup"?c="Loup":i==="Zombie"&&(c="Vaudou"))}}return{playerId:R(l),playerName:l.Username,deathType:P(l.DeathType),killerId:a,killerName:l.KillerName,killerCamp:c}}).filter(l=>{if(!u||u==="Tous les camps")return!0;const c=n.PlayerStats.find(e=>e.Username===l.playerName);return c?N(c.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===u:!1})}function _(n,u,l){const c=[];n.PlayerStats.forEach(e=>{if(e.KillerName&&e.DeathType){if(e.DeathType===t.VOTED||e.DeathType===t.STARVATION||e.DeathType===t.FALL||e.DeathType===t.BY_AVATAR_CHAIN)return;const i=n.PlayerStats.find(m=>m.Username===e.KillerName);if(!i)return;let E=N(i.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});const I=C(i.MainRoleInitial,i.MainRoleChanges||[]);I&&I!==i.MainRoleInitial&&(I==="Loup"?E="Loup":I==="Zombie"&&(E="Vaudou"));const p=N(e.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0});c.push({killerId:R(i),killerName:i.Username,victimId:R(e),victimName:e.Username,deathType:P(e.DeathType),killerCamp:E,victimCamp:p})}});let a=c;return u&&u!=="Tous les camps"&&(a=a.filter(e=>e.killerCamp===u)),l&&l!=="Tous les camps"&&(a=a.filter(e=>l==="Roles solo"?e.victimCamp!=="Villageois"&&e.victimCamp!=="Loup":e.victimCamp===l)),a}function O(n,u,l){if(n.length===0||n.length===0)return null;const c=[],a={},e={};n.forEach(r=>{U(r,u).forEach(s=>{c.push({...s,gameId:r.Id})}),r.PlayerStats.forEach(s=>{const g=R(s),D=s.Username;e[g]=D,(!u||u==="Tous les camps"||N(s.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===u)&&(a[g]=(a[g]||0)+1)})});const i=c.length,E=n.length,I=E>0?i/E:0,p={};c.forEach(r=>{p[r.deathType]=(p[r.deathType]||0)+1});const m=Object.entries(p).map(([r,o])=>({type:r,count:o||0,percentage:i>0?(o||0)/i*100:0})).sort((r,o)=>o.count-r.count),h={};n.forEach(r=>{_(r,u,l).forEach(s=>{e[s.killerId]=s.killerName,e[s.victimId]=s.victimName,h[s.killerId]||(h[s.killerId]={kills:0,victims:new Set,killsByDeathType:{}}),h[s.killerId].kills++,h[s.killerId].victims.add(s.victimId),h[s.killerId].killsByDeathType[s.deathType]=(h[s.killerId].killsByDeathType[s.deathType]||0)+1})});const d=Object.entries(h).map(([r,o])=>{const s=a[r]||0,g=s>0?o.kills/s:0;return{killerName:e[r]||r,kills:o.kills,victims:Array.from(o.victims).map(D=>e[D]||D),percentage:i>0?o.kills/i*100:0,gamesPlayed:s,averageKillsPerGame:g,killsByDeathType:o.killsByDeathType}}).sort((r,o)=>o.kills-r.kills),y={};c.forEach(r=>{y[r.playerId]||(y[r.playerId]={totalDeaths:0,deathsByType:{},killedById:{},deathDays:[]});const o=y[r.playerId];o.totalDeaths++,o.deathsByType[r.deathType]=(o.deathsByType[r.deathType]||0)+1,r.killerId&&(o.killedById[r.killerId]=(o.killedById[r.killerId]||0)+1)});const T=[];Object.entries(y).forEach(([r,o])=>{const s=e[r]||r,g={};Object.entries(o.killedById).forEach(([D,A])=>{const V=e[D]||D;g[V]=(g[V]||0)+A}),T.push({playerName:s,totalDeaths:o.totalDeaths,deathsByType:o.deathsByType,killedBy:g,deathRate:a[r]>0?o.totalDeaths/a[r]:0,gamesPlayed:a[r]||0})}),Object.entries(a).forEach(([r,o])=>{y[r]||T.push({playerName:e[r]||r,totalDeaths:0,deathsByType:{},killedBy:{},deathRate:0,gamesPlayed:o})});const f=T.sort((r,o)=>o.totalDeaths-r.totalDeaths),S=m.length>0?m[0].type:null,B=d.length>0?d[0].killerName:null;return{totalDeaths:i,totalGames:E,averageDeathsPerGame:I,deathsByType:m,killerStats:d,playerDeathStats:f,mostCommonDeathType:S,mostDeadlyKiller:B}}function b(n,u){const l={},c={},a=n.length,e=[t.BULLET,t.BULLET_HUMAN,t.BULLET_WOLF];n.forEach(p=>{const m=new Set;p.PlayerStats.forEach(h=>{const d=h.MainRoleInitial,y=C(h.MainRoleInitial,h.MainRoleChanges||[]);if(d==="Chasseur"||y==="Chasseur"||d==="Villageois Élite"&&h.Power==="Chasseur"){const f=R(h);c[f]=h.Username,m.add(f),l[f]||(l[f]={kills:[],gamesPlayed:0,victimsCamps:[],gameVersions:[],gameModded:[]}),l[f].gamesPlayed++}}),p.PlayerStats.forEach(h=>{const d=h.DeathType,y=h.KillerName,T=y?p.PlayerStats.find(S=>S.Username===y):null,f=T?R(T):null;if(f&&T&&(c[f]=T.Username),d&&e.includes(d)&&f&&m.has(f)){const S=N(h.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});l[f].kills.push(d),l[f].victimsCamps.push(S),l[f].gameVersions.push(p.Version),l[f].gameModded.push(p.Modded)}})});const i=Object.entries(l).map(([p,m])=>{const h=m.kills.length,d={};m.kills.forEach(s=>{d[s]=(d[s]||0)+1});const y={};m.victimsCamps.forEach(s=>{y[s]=(y[s]||0)+1});let T=0,f=0;const S={},B={};m.victimsCamps.forEach((s,g)=>{const D=m.gameVersions[g],A=m.gameModded[g];s==="Idiot du Village"?A&&k(D,"0.202")?(f++,B[s]=(B[s]||0)+1):(T++,S[s]=(S[s]||0)+1):s==="Villageois"?(f++,B[s]=(B[s]||0)+1):(T++,S[s]=(S[s]||0)+1)});const r=m.gamesPlayed>0?h/m.gamesPlayed:0,o=m.gamesPlayed>0?T/m.gamesPlayed:0;return{hunterName:c[p]||p,totalKills:h,nonVillageoisKills:T,villageoisKills:f,gamesPlayedAsHunter:m.gamesPlayed,averageKillsPerGame:r,averageNonVillageoisKillsPerGame:o,killsByDeathType:d,victimsByCamp:y,goodVictimsByCamp:S,badVictimsByCamp:B}}).sort((p,m)=>m.totalKills-p.totalKills),E=i.length>0?i[0].hunterName:null,I=i.length>0?i.sort((p,m)=>m.averageNonVillageoisKillsPerGame-p.averageNonVillageoisKillsPerGame)[0].hunterName:null;return{totalHunters:i.length,totalGames:a,hunterStats:i,bestHunter:E,bestAverageHunter:I}}function x(n,u){return L(l=>O(l,n,u))}function Z(){return L(n=>M(n))}function z(n){return L(u=>b(u))}export{x as a,z as b,j as c,Y as g,Z as u};
