import{b as P,s as b,h as y,a as F,u as z,r as W,j as s}from"./index-BQpqnglH.js";import{u as I}from"./baseStatsHook-C_er8vx8.js";import{p as T}from"./api-beq3FXpM.js";import{F as N,B as k,C as M,X as R,Y as $,a as B,b as q}from"./FullscreenChart-LjF5HAtz.js";import{R as J,T as K}from"./CategoricalChart-B0G_V9rI.js";function X(e){const o=new Set;return e.forEach(l=>{const n=l["Liste des joueurs"];n&&b(n.toString()).forEach(i=>{o.add(i.trim())})}),o}function Y(e){const o={};return e.forEach(l=>{o[l]={currentVillageoisSeries:0,currentLoupsSeries:0,longestVillageoisSeries:null,longestLoupsSeries:null,currentWinSeries:0,longestWinSeries:null,currentWinCamps:[],lastCamp:null,lastWon:!1,villageoisSeriesStart:null,loupsSeriesStart:null,winSeriesStart:null,currentVillageoisGameIds:[],currentLoupsGameIds:[],currentWinGameIds:[]}}),o}function U(e,o,l,n,i){l==="Villageois"||l==="Loups"?(l==="Villageois"&&(e.lastCamp==="Villageois"?(e.currentVillageoisSeries++,e.currentVillageoisGameIds.push(n)):(e.currentVillageoisSeries=1,e.villageoisSeriesStart={game:n,date:i},e.currentVillageoisGameIds=[n]),(!e.longestVillageoisSeries||e.currentVillageoisSeries>e.longestVillageoisSeries.seriesLength)&&(e.longestVillageoisSeries={player:o,camp:"Villageois",seriesLength:e.currentVillageoisSeries,startGame:e.villageoisSeriesStart?.game||n,endGame:n,startDate:e.villageoisSeriesStart?.date||i,endDate:i,isOngoing:!1,gameIds:[...e.currentVillageoisGameIds]}),e.currentLoupsSeries=0,e.loupsSeriesStart=null,e.currentLoupsGameIds=[]),l==="Loups"&&(e.lastCamp==="Loups"?(e.currentLoupsSeries++,e.currentLoupsGameIds.push(n)):(e.currentLoupsSeries=1,e.loupsSeriesStart={game:n,date:i},e.currentLoupsGameIds=[n]),(!e.longestLoupsSeries||e.currentLoupsSeries>e.longestLoupsSeries.seriesLength)&&(e.longestLoupsSeries={player:o,camp:"Loups",seriesLength:e.currentLoupsSeries,startGame:e.loupsSeriesStart?.game||n,endGame:n,startDate:e.loupsSeriesStart?.date||i,endDate:i,isOngoing:!1,gameIds:[...e.currentLoupsGameIds]}),e.currentVillageoisSeries=0,e.villageoisSeriesStart=null,e.currentVillageoisGameIds=[]),e.lastCamp=l):(e.currentVillageoisSeries=0,e.currentLoupsSeries=0,e.villageoisSeriesStart=null,e.loupsSeriesStart=null,e.currentVillageoisGameIds=[],e.currentLoupsGameIds=[],e.lastCamp="Autres")}function H(e,o,l,n,i,c){if(l){if(e.lastWon?(e.currentWinSeries++,e.currentWinCamps.push(n),e.currentWinGameIds.push(i)):(e.currentWinSeries=1,e.currentWinCamps=[n],e.winSeriesStart={game:i,date:c},e.currentWinGameIds=[i]),!e.longestWinSeries||e.currentWinSeries>e.longestWinSeries.seriesLength){const p={};e.currentWinCamps.forEach(m=>{p[m]=(p[m]||0)+1}),e.longestWinSeries={player:o,seriesLength:e.currentWinSeries,startGame:e.winSeriesStart?.game||i,endGame:i,startDate:e.winSeriesStart?.date||c,endDate:c,campCounts:p,isOngoing:!1,gameIds:[...e.currentWinGameIds]}}e.lastWon=!0}else e.currentWinSeries=0,e.currentWinCamps=[],e.winSeriesStart=null,e.currentWinGameIds=[],e.lastWon=!1}function Q(e){const o=[],l=[],n=[];return Object.values(e).forEach(i=>{i.longestVillageoisSeries&&o.push(i.longestVillageoisSeries),i.longestLoupsSeries&&l.push(i.longestLoupsSeries),i.longestWinSeries&&n.push(i.longestWinSeries)}),o.sort((i,c)=>c.seriesLength-i.seriesLength),l.sort((i,c)=>c.seriesLength-i.seriesLength),n.sort((i,c)=>c.seriesLength-i.seriesLength),{longestVillageoisSeries:o.slice(0,20),longestLoupsSeries:l.slice(0,20),longestWinSeries:n.slice(0,20)}}function Z(e,o){const l=[],n=[],i=[];Object.values(e).forEach(a=>{l.push(a.longestVillageoisSeries?.seriesLength||0),n.push(a.longestLoupsSeries?.seriesLength||0),i.push(a.longestWinSeries?.seriesLength||0)});const c=o>0?l.reduce((a,h)=>a+h,0)/o:0,p=o>0?n.reduce((a,h)=>a+h,0)/o:0,m=o>0?i.reduce((a,h)=>a+h,0)/o:0,g=l.filter(a=>a>=5).length,f=n.filter(a=>a>=3).length,j=i.filter(a=>a>=5).length;return{averageVillageoisSeries:Math.round(c*10)/10,averageLoupsSeries:Math.round(p*10)/10,averageWinSeries:Math.round(m*10)/10,eliteVillageoisCount:g,eliteLoupsCount:f,eliteWinCount:j}}function _(e,o){if(e.length===0||o.length===0)return null;const l=P(o),n=[...e].sort((r,v)=>(r.Game||0)-(v.Game||0)),i=X(n),c=Y(i);n.forEach(r=>{const v=r.Game?.toString(),x=r["Liste des joueurs"],G=r["Liste des gagnants"],L=r.Date?.toString()||"";if(!v||!x)return;const O=b(x.toString()),C=parseInt(v);O.forEach(D=>{const S=D.trim();if(!S)return;const V=c[S],A=y(l,v,S),w=F(S,G?.toString()),E=l[v]&&l[v][S]||"Villageois";U(V,S,A,C,L),H(V,S,w,E,C,L)})});const{longestVillageoisSeries:p,longestLoupsSeries:m,longestWinSeries:g}=Q(c);Object.values(c).forEach(r=>{r.longestVillageoisSeries&&r.currentVillageoisSeries===r.longestVillageoisSeries.seriesLength&&r.currentVillageoisSeries>0&&(r.longestVillageoisSeries.isOngoing=!0),r.longestLoupsSeries&&r.currentLoupsSeries===r.longestLoupsSeries.seriesLength&&r.currentLoupsSeries>0&&(r.longestLoupsSeries.isOngoing=!0),r.longestWinSeries&&r.currentWinSeries===r.longestWinSeries.seriesLength&&r.currentWinSeries>0&&(r.longestWinSeries.isOngoing=!0)});const f=Z(c,i.size);let j=0,a=0,h=0,u=0,d=0,t=0;return Object.values(c).forEach(r=>{r.currentVillageoisSeries>0&&j++,r.currentLoupsSeries>0&&a++,r.currentWinSeries>0&&h++,r.longestVillageoisSeries?.isOngoing&&u++,r.longestLoupsSeries?.isOngoing&&d++,r.longestWinSeries?.isOngoing&&t++}),{longestVillageoisSeries:p,longestLoupsSeries:m,longestWinSeries:g,totalGamesAnalyzed:n.length,totalPlayersCount:i.size,activeVillageoisCount:j,activeLoupsCount:a,activeWinCount:h,ongoingVillageoisCount:u,ongoingLoupsCount:d,ongoingWinCount:t,...f}}function ee(){const{data:e,isLoading:o,error:l}=I((n,i)=>_(n,i));return{data:e,isLoading:o,error:l}}function le(){const{data:e,isLoading:o,error:l}=ee(),{navigateToGameDetails:n}=z(),[i,c]=W.useState("villageois"),p=W.useRef(null);if(o)return s.jsx("div",{className:"donnees-attente",children:"Récupération des séries de joueurs..."});if(l)return s.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",l]});if(!e)return s.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de série disponible"});const g=(()=>{switch(i){case"villageois":return e.longestVillageoisSeries.slice(0,20);case"loups":return e.longestLoupsSeries.slice(0,20);case"wins":return e.longestWinSeries.slice(0,20);default:return[]}})(),f=u=>Object.entries(u).map(([d,t])=>`${d} (${t})`).join(", "),j=()=>{switch(i){case"villageois":return"Plus Longues Séries Villageois Consécutives";case"loups":return"Plus Longues Séries Loups Consécutives";case"wins":return"Plus Longues Séries de Victoires";default:return""}},a=({active:u,payload:d})=>{if(!u||!d||d.length===0)return null;const t=d[0].payload;return i==="wins"?s.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[s.jsxs("div",{children:[s.jsx("strong",{children:t.player}),t.isOngoing&&s.jsx("span",{style:{marginLeft:"8px",fontSize:"1.2em"},children:"🔥"})]}),s.jsxs("div",{children:["Série de victoires : ",t.seriesLength," parties ",t.isOngoing?"(En cours)":""]}),s.jsxs("div",{children:["Du jeu #",t.startGame," au jeu #",t.endGame]}),s.jsxs("div",{children:["Du ",t.startDate," au ",t.endDate]}),s.jsxs("div",{children:["Camps joués : ",f(t.campCounts)]}),t.isOngoing&&s.jsx("div",{style:{fontSize:"0.8rem",color:"#FF8C00",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center"},children:"🔥 Série en cours - Aucun jeu depuis !"}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]}):s.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[s.jsxs("div",{children:[s.jsx("strong",{children:t.player}),t.isOngoing&&s.jsx("span",{style:{marginLeft:"8px",fontSize:"1.2em"},children:"🔥"})]}),s.jsxs("div",{children:["Série ",t.camp," : ",t.seriesLength," parties consécutives ",t.isOngoing?"(En cours)":""]}),s.jsxs("div",{children:["Du jeu #",t.startGame," au jeu #",t.endGame]}),s.jsxs("div",{children:["Du ",t.startDate," au ",t.endDate]}),t.isOngoing&&s.jsx("div",{style:{fontSize:"0.8rem",color:"#FF8C00",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center"},children:"🔥 Série en cours - Aucun jeu depuis !"}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})},h=u=>{if(i==="wins")n({selectedPlayer:u.player,selectedGameIds:u.gameIds,fromComponent:"Séries de Victoires"});else{const d=i==="villageois"?"Villageois":"Loups";n({selectedPlayer:u.player,selectedGameIds:u.gameIds,campFilter:{selectedCamp:d,campFilterMode:"wins-only"},fromComponent:`Séries ${d}`})}};return s.jsxs("div",{className:"lycans-players-series",children:[s.jsx("h2",{children:"Séries des Joueurs"}),s.jsxs("p",{className:"lycans-stats-info",children:["Basé sur ",e.totalGamesAnalyzed," parties analysées"]}),s.jsx("div",{className:"lycans-section-description",children:s.jsxs("p",{children:[s.jsx("strong",{children:"Séries de camps :"})," Parties consécutives dans le même camp principal (Villageois ou Loups). Jouer dans n'importe quel autre camp brise la série.",s.jsx("br",{}),s.jsx("strong",{children:"Séries de victoires :"})," Victoires consécutives dans n'importe quel camp. Une défaite brise la série.",s.jsx("br",{}),s.jsx("strong",{children:"🔥 Séries en cours :"})," Les séries avec l'effet de flamme sont encore actives"]})}),s.jsxs("div",{className:"lycans-categories-selection",children:[s.jsx("button",{className:`lycans-categorie-btn ${i==="villageois"?"active":""}`,onClick:()=>c("villageois"),children:"Séries Villageois"}),s.jsx("button",{className:`lycans-categorie-btn ${i==="loups"?"active":""}`,onClick:()=>c("loups"),children:"Séries Loups"}),s.jsx("button",{className:`lycans-categorie-btn ${i==="wins"?"active":""}`,onClick:()=>c("wins"),children:"Séries de Victoires"})]}),s.jsxs("div",{className:"lycans-graphique-section",children:[s.jsx(N,{title:j(),children:s.jsx("div",{ref:p,style:{height:500},children:s.jsx(J,{width:"100%",height:"100%",children:s.jsxs(k,{data:g,margin:{top:20,right:30,left:20,bottom:10},children:[s.jsx(M,{strokeDasharray:"3 3"}),s.jsx(R,{dataKey:"player",angle:-45,textAnchor:"end",height:120,interval:0}),s.jsx($,{label:{value:i==="wins"?"Victoires consécutives":"Parties consécutives",angle:-90,position:"insideLeft"}}),s.jsx(K,{content:a}),s.jsx(B,{dataKey:"seriesLength",name:i==="wins"?"Victoires consécutives":"Parties consécutives",fill:i==="villageois"?"#82ca9d":i==="loups"?"#FF8042":"#8884d8",children:g.map((u,d)=>s.jsx(q,{fill:T[u.player]||(i==="villageois"?"#82ca9d":i==="loups"?"#FF8042":"#8884d8"),onClick:()=>h(u),style:{cursor:"pointer"},className:u.isOngoing?"lycans-ongoing-series":""},`cell-${i}-${d}`))})]})})})}),g.length>0&&s.jsxs("div",{className:"lycans-stats-grid",style:{marginTop:"0rem",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))"},children:[s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"🏆 Record Absolu"}),s.jsxs("div",{className:"lycans-stat-value",children:[g[0].seriesLength,g[0].isOngoing&&s.jsx("span",{style:{fontSize:"0.6em",marginLeft:"5px"},children:"🔥"})]}),s.jsxs("p",{children:["par ",s.jsx("strong",{children:g[0].player}),g[0].isOngoing&&s.jsx("span",{style:{color:"#FF8C00",fontWeight:"bold"},children:" (En cours)"})]}),i==="wins"?s.jsxs("p",{className:"lycans-h2h-description",children:["Camps : ",f(g[0].campCounts||{})]}):s.jsxs("p",{className:"lycans-h2h-description",children:["Camp : ",g[0].camp]})]}),s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"📊 Moyenne (tous les joueurs)"}),s.jsx("div",{className:"lycans-stat-value",children:i==="villageois"?e.averageVillageoisSeries:i==="loups"?e.averageLoupsSeries:e.averageWinSeries}),s.jsx("p",{children:"parties en moyenne"}),s.jsxs("p",{className:"lycans-h2h-description",children:["Basé sur ",e.totalPlayersCount," joueurs"]})]}),s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"🔥 Séries En Cours"}),s.jsx("div",{className:"lycans-stat-value",children:i==="villageois"?e.activeVillageoisCount:i==="loups"?e.activeLoupsCount:e.activeWinCount}),s.jsx("p",{children:"séries encore actives"}),s.jsx("p",{className:"lycans-h2h-description",children:(i==="villageois"?e.activeVillageoisCount:i==="loups"?e.activeLoupsCount:e.activeWinCount)>0?"Joueurs actuellement dans une série de ce type":"Aucune série active de ce type"})]})]}),g.length===0&&s.jsxs("div",{className:"lycans-empty-section",children:[s.jsx("h3",{children:"Aucune série trouvée"}),s.jsx("p",{children:"Aucune série n'a été trouvée pour ce type avec les filtres actuels."})]})]})]})}export{le as PlayerSeriesChart};
