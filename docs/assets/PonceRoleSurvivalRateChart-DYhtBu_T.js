import{r as u,j as e}from"./index-BFcVbxiC.js";import{l as E,g as A}from"./api-BWHeASPZ.js";import{R as j,T as S,C as b}from"./CategoricalChart-jlol99yu.js";import{B as w,C as R,X as k,Y as C,a as q}from"./BarChart-laXCa6Im.js";import{L as D}from"./Legend-CH8tJW-h.js";import{S as T,Z as L,a as M}from"./ScatterChart-EKABNMrT.js";function V(){const[i,x]=u.useState(null),[p,a]=u.useState(!0),[c,h]=u.useState(null);return u.useEffect(()=>{(async()=>{try{a(!0),h(null);const n=await fetch("https://script.google.com/macros/s/AKfycbxrhG1mb7N6q7Mg88ogw0mirXgSihPpNPurZwiEOy9miG24Cc3AlGZCn2uoGnygNhck/exec?action=roleSurvivalStats");if(!n.ok)throw new Error(`Erreur de requête: ${n.status}`);const l=await n.json();if(l.error)throw new Error(l.error);x(l)}catch(t){console.error("Problème lors de la récupération des stats de survie des rôles:",t),h(t instanceof Error?t.message:"Erreur lors du chargement")}finally{a(!1)}})()},[]),{roleSurvivalStats:i,dataLoading:p,fetchError:c}}function P(){const{roleSurvivalStats:i,dataLoading:x,fetchError:p}=V(),[a,c]=u.useState("camps"),h=u.useMemo(()=>{if(!i)return{};let r=[],s="";switch(a){case"camps":r=i.campStats||[],s="camp";break;case"roles":r=i.roleStats||[],s="role";break;case"secondaryRoles":r=i.secondaryRoleStats||[],s="secondaryRole";break;case"thirdRoles":r=i.thirdRoleStats||[],s="thirdRole";break}const o=a==="camps"?1:3,N=r.filter(f=>f.appearances>=o),g={};return N.forEach(f=>{const m=f[s];a==="roles"||a==="camps"?g[m]=E[m]||"var(--chart-color-2)":g[m]=A(m)}),g},[i,a]);if(x)return e.jsx("div",{className:"donnees-attente",children:"Récupération des statistiques de survie par rôles..."});if(p)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",p]});if(!i)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de survie disponible"});let d=[],t="",n="",l=1;switch(a){case"roles":d=i.roleStats||[],t="role",n="Rôle",l=3;break;case"camps":d=i.campStats||[],t="camp",n="Camp",l=1;break;case"secondaryRoles":d=i.secondaryRoleStats||[],t="secondaryRole",n="Rôle Secondaire",l=3;break;case"thirdRoles":d=i.thirdRoleStats||[],t="thirdRole",n="Rôle Spécifique",l=3;break}const v=d.filter(r=>r.appearances>=l);if(v.length===0)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée disponible pour cette catégorie"});const y=v.map(r=>({nom:r[t],tauxSurvie:parseFloat(r.survivalRate),dureeVie:parseFloat(r.avgLifespan),apparitions:r.appearances}));return e.jsxs("div",{className:"lycans-roles-survie",children:[e.jsx("h2",{children:"Statistiques de Survie par Rôles"}),e.jsxs("div",{className:"lycans-categories-selection",children:[e.jsx("button",{className:`lycans-categorie-btn ${a==="camps"?"active":""}`,onClick:()=>c("camps"),children:"Camps"}),e.jsx("button",{className:`lycans-categorie-btn ${a==="roles"?"active":""}`,onClick:()=>c("roles"),children:"Rôles villageois"}),e.jsx("button",{className:`lycans-categorie-btn ${a==="thirdRoles"?"active":""}`,onClick:()=>c("thirdRoles"),children:"Rôles spécifiques"}),e.jsx("button",{className:`lycans-categorie-btn ${a==="secondaryRoles"?"active":""}`,onClick:()=>c("secondaryRoles"),children:"Rôles secondaires"})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Taux de Survie par ",n," (classés par fréquences)"]}),e.jsx("div",{style:{height:400},children:e.jsx(j,{width:"100%",height:"120%",children:e.jsxs(w,{data:v,margin:{top:20,right:30,left:20,bottom:70},layout:"vertical",children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(k,{type:"number",domain:[0,100]}),e.jsx(C,{dataKey:t,type:"category",width:a==="thirdRoles"?0:150,tick:a!=="thirdRoles"}),e.jsx(S,{content:({active:r,payload:s})=>{if(r&&s&&s.length>0){const o=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:4},children:[n,": ",o[t]]}),e.jsxs("div",{children:["Taux de Survie : ",o.survivalRate,"%"]}),e.jsxs("div",{children:["Apparitions : ",o.appearances]}),e.jsxs("div",{children:["Durée de Vie Moyenne : ",o.avgLifespan," jours"]})]})}return null}}),e.jsx(D,{formatter:r=>r==="survivalRate"?"Taux de Survie":r}),e.jsx(q,{dataKey:"survivalRate",name:"survivalRate",fill:"var(--chart-color-2)",background:{fill:"var(--bg-tertiary)"},children:v.map((r,s)=>e.jsx(b,{fill:h[r[t]]},r[t]||s))})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Durée de Vie Moyenne vs Taux de Survie"}),e.jsx("div",{style:{height:400},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(T,{margin:{top:20,right:30,left:20,bottom:10},children:[e.jsx(R,{}),e.jsx(k,{type:"number",dataKey:"dureeVie",name:"Durée de Vie Moyenne (jours)",label:{value:"Durée de Vie Moyenne (jours)",position:"insideBottom",offset:-10}}),e.jsx(C,{type:"number",dataKey:"tauxSurvie",name:"Taux de Survie (%)",label:{value:"Taux de Survie (%)",angle:-90,position:"insideLeft"}}),e.jsx(L,{type:"number",dataKey:"apparitions",range:[50,400],name:"Nombre d'Apparitions"}),e.jsx(S,{cursor:{strokeDasharray:"3 3"},content:({active:r,payload:s})=>{if(r&&s&&s.length>0){const o=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:4},children:[n,": ",o.nom]}),e.jsxs("div",{children:["Durée de Vie Moyenne : ",o.dureeVie," jours"]}),e.jsxs("div",{children:["Taux de Survie : ",o.tauxSurvie,"%"]}),e.jsxs("div",{children:["Apparitions : ",o.apparitions]})]})}return null}}),e.jsx(M,{name:n,data:y,fill:"var(--chart-color-5)",children:y.map((r,s)=>e.jsx(b,{fill:h[r.nom]},r.nom||s))})]})})})]})]})]})}export{P as RoleSurvivalRateChart};
