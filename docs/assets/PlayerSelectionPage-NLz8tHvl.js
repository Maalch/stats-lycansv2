import{b as pe,r as k,g as te,f as ze,a as ne,j as e,u as he,h as $e,e as Le,v as We}from"./index-i2D8CKXz.js";import{u as ue}from"./useJoueursData-CHcDc0kV.js";import{u as ve}from"./baseStatsHook-Yue8JXBk.js";import{g as Ie}from"./gameUtils-rkfcKAVy.js";import{a as Te,g as ce,c as Pe,b as qe}from"./datasyncExport-BirWLS1z.js";import{u as ge,g as Ge,b as oe,l as Ee,C as ie,f as je}from"./api-CGjKkj89.js";import{f as re,d as Ve}from"./durationFormatters-C9UyWcKX.js";import{F as Y,C as J,X as Q,Y as X}from"./FullscreenChart-DkD7fDqR.js";import{R as K,T as H,a as ee}from"./CategoricalChart-lJQ-xVrZ.js";import{L as Be,a as Oe}from"./LineChart-B3vHKje5.js";import{B as Z,a as O}from"./BarChart-u1lo5U5Z.js";import{P as De,a as Re}from"./PieChart-DZrAE2uw.js";import{g as de}from"./deathTypes-gHH1w6_X.js";import{i as be,g as Ce,V as Ke,a as He}from"./roleUtils-g252S1-m.js";import{i as _e,c as Ue}from"./wolfTransformUtils-DiCKErCz.js";import{L as Ae}from"./Legend-CD3-5LZy.js";import{S as Ye,R as ae,e as Je,f as Qe,h as me,a as Xe,b as Ze,d as et}from"./deathLocationUtils-BGDiuiTT.js";import{a as tt,u as st}from"./useClips-B_67WPaL.js";import{C as rt,f as we,a as at}from"./ClipViewer-DYZELLCr.js";import"./ActivePoints-5COj_4NI.js";import"./PolarChart-D11YOEvL.js";import"./CartesianScaleHelper-B5QcuZLv.js";function it(s){const{settings:d}=pe(),{joueursData:x}=ue(),[j,w]=k.useState(null),[i,h]=k.useState(!1),[u,p]=k.useState(null);k.useEffect(()=>{let n=!0;return(async()=>{try{h(!0),p(null);const o=d.dataSource==="discord"?"/data/discord/playerRankings.json":"/data/playerRankings.json",r=await fetch(o);if(!r.ok)throw new Error(`Failed to load Rankings: ${r.status} ${r.statusText}`);const l=await r.json();n&&w(l)}catch(o){n&&p(o instanceof Error?o.message:"Failed to load Rankings")}finally{n&&h(!1)}})(),()=>{n=!1}},[d.dataSource]);const m=(()=>{if(!s||!j)return null;const a=x?.Players?.find(o=>o.Joueur===s)?.SteamID;return a&&j.Rankings[a]||null})();return k.useEffect(()=>{s&&j&&x&&x.Players?.find(o=>o.Joueur===s)?.SteamID},[s,j,x,d.dataSource]),{data:m,isLoading:i,error:u,metadata:{generatedAt:j?.generatedAt||null,totalPlayers:j?.totalPlayers||0,totalGames:j?.totalGames||0,totalModdedGames:j?.totalModdedGames||0}}}function nt(s,d,x){if(!s||s.trim()===""||d.length===0)return null;const j=[];let w=s;d.forEach(a=>{const o=a.PlayerStats.find(r=>te(r)===s||r.Username.toLowerCase()===s.toLowerCase());if(o){w=o.Username;const r=o.MainRoleInitial==="Louveteau"?o.MainRoleInitial:Te(o.MainRoleInitial,o.MainRoleChanges||[]),l=ce(r);if(x&&x!=="Tous les camps"&&l!==x)return;const y=Ie(a),c=o.Victorious,b=ze(new Date(a.StartDate)),T=Pe(a.StartDate,a.EndDate)||0;j.push({gameId:a.Id,date:b,camp:l,won:c,winnerCamp:y,playersInGame:a.PlayerStats.length,mapName:a.MapName,duration:T})}}),j.sort((a,o)=>{const r=l=>{const y=l.split("/");return y.length===3?new Date(parseInt(y[2]),parseInt(y[1])-1,parseInt(y[0])):new Date(l)};return r(o.date).getTime()-r(a.date).getTime()});const i=j.length,h=j.filter(a=>a.won).length,u=i>0?(h/i*100).toFixed(2):"0.00",p={};j.forEach(a=>{p[a.camp]||(p[a.camp]={appearances:0,wins:0,winRate:"0.00"}),p[a.camp].appearances++,a.won&&p[a.camp].wins++}),Object.keys(p).forEach(a=>{const o=p[a];o.winRate=o.appearances>0?(o.wins/o.appearances*100).toFixed(2):"0.00"});const m={};j.forEach(a=>{m[a.mapName]||(m[a.mapName]={appearances:0,wins:0,winRate:"0.00"}),m[a.mapName].appearances++,a.won&&m[a.mapName].wins++}),Object.keys(m).forEach(a=>{const o=m[a];o.winRate=o.appearances>0?(o.wins/o.appearances*100).toFixed(2):"0.00"});const n=j.reduce((a,o)=>a+o.duration,0);return{playerName:w,totalGames:i,totalWins:h,winRate:u,totalPlayTime:n,games:j,campStats:p,mapStats:m}}function xe(s,d){const{data:x,isLoading:j,error:w}=ve(i=>s?nt(s,i,d):null);return{data:x,isLoading:j,error:w}}function ot(s){const{settings:d}=pe(),[x,j]=k.useState(null),[w,i]=k.useState(null),[h,u]=k.useState(!0),[p,m]=k.useState(null);return k.useEffect(()=>{(async()=>{u(!0),m(null);try{const a=d.dataSource==="discord"?"/data/discord/playerTitles.json":"/data/playerTitles.json",o=await fetch(a);if(!o.ok){if(o.status===404)j(null),i(null),m("Les titres n'ont pas encore √©t√© g√©n√©r√©s. Ils seront disponibles apr√®s la prochaine synchronisation hebdomadaire.");else throw new Error(`HTTP error! status: ${o.status}`);return}const r=await o.json();if(j(r),s&&r.players){const l=Object.entries(r.players).find(([y,c])=>c.playerName===s);i(l?l[1]:null)}else i(null)}catch(a){console.error("Error loading player titles:",a),m(a instanceof Error?a.message:"Erreur inconnue"),j(null),i(null)}finally{u(!1)}})()},[d.dataSource,s]),{data:x,playerData:w,isLoading:h,error:p}}function lt({rankings:s,title:d,emptyMessage:x,rankingType:j="all"}){const{navigateToTab:w,updateNavigationState:i,clearNavigation:h}=ne(),{settings:u,updateSettings:p}=pe(),{joueursData:m}=ue(),n=ge(m),a=(t,R)=>{if(R.stopPropagation(),!t.redirectTo)return;h();const I=u.highlightedPlayer;if(p(j==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:I,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:I,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const S=u.highlightedPlayer||"",f=o(t.description,S);f&&i({playerComparisonState:{selectedPlayer1:S,selectedPlayer2:f,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const S=t.description.toLowerCase().includes("loup");i({selectedPairingTab:S?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const S=t.description.match(/(Villageois|Loups|Autres)/i);S&&i({deathStatsSelectedCamp:S[1]});let f=10;const g=t.description.match(/min\.\s*(\d+)/);g&&(f=parseInt(g[1],10));let N="totalKills",v="killers";const P=t.redirectTo.chartSection;P&&(P==="killers-total"?(N="totalKills",v="killers"):P==="killers-average"?(N="averageKills",v="killers"):P==="deaths-total"?(N="totalDeaths",v="deaths"):P==="survivors-average"?(N="survivalRate",v="deaths"):(P==="hunters-good"||P==="hunters-bad")&&(v="hunter",N="averageKills")),i({deathStatisticsState:{selectedCamp:S?.[1]||"Tous les camps",minGamesForAverage:f,selectedView:v,focusChart:N}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const S=t.redirectTo.mapFilter||"all";let f=10;const g=t.description.match(/min\.\s*(\d+)/);g&&(f=parseInt(g[1])),p(j==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:S,playerFilter:{mode:"none",players:[]},highlightedPlayer:I,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:S,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:S,playerFilter:{mode:"none",players:[]},highlightedPlayer:I,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:S,playerFilter:{mode:"none",players:[]}}}),i({playersGeneralState:{minGamesForWinRate:f,winRateOrder:"best",focusChart:"winRate"}}),w("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&i({selectedPlayerName:u.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let S="wins";const f=t.title.toLowerCase(),g=t.description.toLowerCase();f.includes("d√©faite")||g.includes("d√©faite")?S="losses":f.includes("loup")||g.includes("loup")?S="loup":f.includes("villageois")||g.includes("villageois")?S="villageois":(f.includes("victoire")||g.includes("victoire"))&&(S="wins"),i({selectedSeriesType:S})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let S=10;const f=t.description.match(/min\.\s*(\d+)/);f&&(S=parseInt(f[1],10));let g="winRate",N="best";const v=t.title.toLowerCase(),P=t.description.toLowerCase();v.includes("participation")||P.includes("participation")?g="participation":(v.includes("taux de victoire")||P.includes("taux de victoire"))&&(g="winRate",(v.includes("moins bon")||v.includes("mauvais")||P.includes("moins bon")||P.includes("mauvais"))&&(N="worst")),i({playersGeneralState:{minGamesForWinRate:S,winRateOrder:N,focusChart:g}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const S=t.redirectTo.chartSection;let f="Villageois",g=1;S&&(S==="camp-loup"?f="Loup":S==="camp-villageois"?f="Villageois":S==="camp-idiot"?f="Idiot du Village":S==="camp-amoureux"?f="Amoureux":(S==="solo-roles"||S==="hall-of-fame")&&(f="Villageois"));const N=t.description.match(/min\.\s*(\d+)/);N&&(g=parseInt(N[1],10)),S==="solo-roles"?f="R√¥les sp√©ciaux":S==="hall-of-fame"&&(f="Tous les camps"),i({campPerformanceState:{selectedCampPerformanceCamp:f,selectedCampPerformanceMinGames:g,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const S=t.title.toLowerCase();let f="overview",g="behavior";S.includes("agressivit√©")?(f="overview",g="behavior"):S.includes("taux de vote")?(f="behavior",g="voteRate"):S.includes("pr√©cision")&&(f="overview",g="accuracy"),i({votingStatsState:{selectedCategory:f,selectedView:g}})}if(t.category==="loot"&&t.redirectTo.subTab==="lootStats"){const S=t.redirectTo,f=S.minGames||5,g=S.view||"normalized";i({lootStatsState:{minGames:f,campFilter:"all",view:g}})}w(t.redirectTo.tab,t.redirectTo.subTab)},o=(t,R)=>{const I=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const S of I){const f=t.match(S);if(f&&f[1]){const g=f[1].trim();if(g!==R)return g}}return null},r=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const S=t.description.match(/min\.\s*(\d+)/),f=S?parseInt(S[1],10):10,g=t.title.toLowerCase(),N=j==="modded"?" (Filtre parties modd√©es activ√©)":" (Filtres r√©initialis√©s)";return g.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${f} parties)${N}`:g.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${N}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement g√©n√©ral des joueurs${N}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const S=t.redirectTo.mapFilter,f=S==="village"?"Village":S==="chateau"?"Ch√¢teau":"map",g=j==="modded"?" (Filtres parties modd√©es + map activ√©s)":" (Filtre map activ√©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques g√©n√©rales filtr√©es sur ${f}${g}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique d√©taill√© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${o(t.description,u.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const S=t.description.match(/(Villageois|Loups|Autres)/i),f=t.description.match(/min\.\s*(\d+)/),g=f?parseInt(f[1],10):10,N=S?.[1]||"Tous les camps",v=t.redirectTo.chartSection;let P="kills et morts";return v==="killers-total"?P="total des kills":v==="killers-average"?P=`moyenne des kills (min. ${g} parties)`:v==="deaths-total"?P="total des morts":v==="survivors-average"&&(P=`taux de survie (min. ${g} parties)`),`Cliquez pour voir les statistiques de ${P} ${N!=="Tous les camps"?`en ${N}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const S=t.title.toLowerCase(),f=t.description.toLowerCase();return S.includes("d√©faite")||f.includes("d√©faite")?"Cliquez pour voir les s√©ries de d√©faites":S.includes("loup")||f.includes("loup")?"Cliquez pour voir les s√©ries Loups":S.includes("villageois")||f.includes("villageois")?"Cliquez pour voir les s√©ries Villageois":S.includes("victoire")||f.includes("victoire")?"Cliquez pour voir les s√©ries de victoires":"Cliquez pour voir les s√©ries cons√©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const S=t.redirectTo.chartSection,f=j==="modded"?" (Filtre parties modd√©es activ√©)":" (Filtres r√©initialis√©s)";return S==="camp-loup"?`Cliquez pour voir les performances camp Loup${f}`:S==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${f}`:S==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${f}`:S==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${f}`:S==="solo-roles"?`Cliquez pour voir le classement (r√¥les sp√©ciaux)${f}`:S==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${f}`:`Cliquez pour voir les performances par camp${f}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const S=t.description.match(/min\.\s*(\d+)/),f=S?parseInt(S[1],10):25,g=j==="modded"?" (Filtre parties modd√©es activ√©)":" (Filtres r√©initialis√©s)",N=t.title.toLowerCase();return N.includes("agressivit√©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivit√© (min. ${f} meetings)${g}`:N.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${f} meetings)${g}`:N.includes("pr√©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la pr√©cision des votes${g}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${g}`}break;case"loot":if(t.redirectTo.subTab==="lootStats"){const S=t.description.match(/min\.\s*(\d+)/),f=S?parseInt(S[1],10):25,g=j==="modded"?" (Filtre parties modd√©es activ√©)":" (Filtres r√©initialis√©s)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de r√©colte (min. ${f} parties)${g}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(j==="modded"?" (Filtre parties modd√©es activ√©)":" (Filtres r√©initialis√©s)")},l=t=>n[t]||Ge(t),y=t=>{const R=[/avec ([^:]+?):/,/contre ([^:]+?):/];let I=t;return R.forEach(S=>{const f=t.match(S);if(f&&f[1]){const g=f[1].trim(),v=`<span class="player-name-highlight" style="color: ${l(g)};">${g}</span>`;I=I.replace(g,v)}}),I};if(s.length===0)return e.jsxs("div",{className:"rankings-empty",children:[e.jsx("h4",{children:d}),e.jsx("p",{children:x||"Aucun succ√®s dans cette cat√©gorie"})]});const c=t=>t===1?"ü•á":t===2?"ü•à":t===3?"ü•â":"",b=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",T=(t,R)=>{if(!t||t<=3||!R)return;const I=t-3,S=R-3;return S<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(I-1)/(S-1))}, 70%, 50%)`},W=(t,R)=>{if(!t||!R)return;if(R<=1)return"hsl(0, 70%, 50%)";const I=(t-1)/(R-1),S=I*15,f=50-I*15;return`hsl(${S}, 70%, ${f}%)`},D=t=>{if(!t)return;const R=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(R){const[,I,S]=R;return`hsl(${I}, ${S}%, 40%)`}return t},M=s.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,R)=>(t.rank??999)-(R.rank??999)),F=s.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,R)=>(t.rank??999)-(R.rank??999)),E=s.filter(t=>t.category==="comparison"),z=[...M,...F].sort((t,R)=>(t.rank??999)-(R.rank??999)),L=M.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"rankings-container",children:[e.jsx("h4",{children:d}),L>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"‚ú® Podium d'Excellence ‚ú®"}),e.jsx("div",{className:"top3-grid",children:M.filter(t=>t.rank&&t.rank<=3).map((t,R)=>e.jsxs("div",{className:`top3-card ${b(t.rank)} animate-slide-in`,style:{animationDelay:`${R*.15}s`},onClick:I=>a(t,I),title:r(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:c(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-ranking-title",children:t.title}),e.jsx("p",{className:"top3-ranking-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"‚ú®"}),e.jsx("span",{className:"sparkle sparkle-2",children:"‚≠ê"}),e.jsx("span",{className:"sparkle sparkle-3",children:"‚ú®"})]})]},t.id))})]}),z.length>0&&e.jsxs("div",{className:"rankings-section unified-rankings",children:[e.jsx("h5",{children:"üèÜ Classements"}),e.jsx("div",{className:"rankings-grid",children:z.filter(t=>t.type==="bad"?!0:!t.rank||t.rank>3).map((t,R)=>{const I=t.type==="bad",S=I?W(t.rank,t.totalRanked):T(t.rank,t.totalRanked),f=D(S),g=I?"":b(t.rank);return e.jsxs("div",{className:`ranking-card ${I?"bad":"good"} ${g}`,onClick:N=>a(t,N),title:r(t),style:{animationDelay:`${R*.05}s`,borderLeftColor:f,borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"ranking-header",children:[e.jsxs("span",{className:"ranking-title",children:[I&&"üíÄ ",t.title]}),e.jsxs("span",{className:"ranking-rank",style:S?{backgroundColor:S}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"ranking-description",children:t.description})]},t.id)})})]}),E.length>0&&e.jsxs("div",{className:"rankings-section comparison-rankings",children:[e.jsx("h5",{children:"üìä Statistiques Co√©quipiers et Face-√†-Face"}),e.jsx("div",{className:"rankings-grid",children:E.map(t=>e.jsxs("div",{className:"ranking-card comparison",onClick:R=>a(t,R),title:r(t),children:[e.jsx("div",{className:"ranking-header",children:e.jsx("span",{className:"ranking-title",children:t.title})}),e.jsx("p",{className:"ranking-description",dangerouslySetInnerHTML:{__html:y(t.description)}})]},t.id))})]})]})}function ct({selectedPlayerName:s,groupingMethod:d,campFilter:x="all"}){const{navigateToGameDetails:j}=ne(),{data:w,isLoading:i,error:h}=xe(s),u=k.useMemo(()=>{switch(d){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par Ann√©e";default:return"par Session"}},[d]),p=k.useMemo(()=>{if(!w?.games)return new Map;const o=new Map;return w.games.forEach(r=>{if(!o.has(r.date)){const l=r.date.split("/");l.length===3?o.set(r.date,new Date(parseInt(l[2]),parseInt(l[1])-1,parseInt(l[0])).getTime()):o.set(r.date,new Date(r.date).getTime())}}),o},[w?.games]),m=k.useMemo(()=>{if(!w?.games)return[];const o={};return w.games.forEach(r=>{if(x!=="all"){if(x==="solo"){if(r.camp==="Villageois"||r.camp==="Loup")return}else if(r.camp!==x)return}let l;const y=r.date.split("/");if(d==="month")if(y.length===3)l=`${y[1].padStart(2,"0")}/${y[2]}`;else{const c=new Date(r.date);l=`${String(c.getMonth()+1).padStart(2,"0")}/${c.getFullYear()}`}else if(d==="quarter")if(y.length===3){const c=parseInt(y[1],10);l=`T${Math.floor((c-1)/3)+1}/${y[2]}`}else{const c=new Date(r.date);l=`T${Math.floor(c.getMonth()/3)+1}/${c.getFullYear()}`}else d==="year"?y.length===3?l=`${y[2]}`:l=`${new Date(r.date).getFullYear()}`:l=r.date;o[l]||(o[l]={games:[],wins:0,total:0}),o[l].games.push(r),o[l].total++,r.won&&o[l].wins++}),Object.entries(o).map(([r,l])=>({period:r,totalGames:l.total,victories:l.wins,defeats:l.total-l.wins,winRate:l.total>0?(l.wins/l.total*100).toFixed(1):"0.0",winRateNum:l.total>0?l.wins/l.total*100:0})).sort((r,l)=>{if(d==="month"){const[y,c]=r.period.split("/"),[b,T]=l.period.split("/"),W=new Date(parseInt(c),parseInt(y)-1,1),D=new Date(parseInt(T),parseInt(b)-1,1);return W.getTime()-D.getTime()}else if(d==="quarter"){const[y,c]=r.period.split("/"),[b,T]=l.period.split("/"),W=parseInt(y.replace(/\D/g,""),10)||1,D=parseInt(b.replace(/\D/g,""),10)||1,M=new Date(parseInt(c,10),(W-1)*3,1),F=new Date(parseInt(T,10),(D-1)*3,1);return M.getTime()-F.getTime()}else if(d==="year"){const y=parseInt(r.period,10),c=parseInt(l.period,10);return y-c}else{const y=p.get(r.period)||0,c=p.get(l.period)||0;return y-c}})},[w,d,p,x]),a=(o=>o<=15?{fontSize:12,angle:-45,height:80,interval:0}:o<=30?{fontSize:12,angle:-45,height:85,interval:1}:o<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(o/12)})(m.length);return i?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):h?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",h]}):w?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["√âvolution des Performances ",u]}),e.jsx(Y,{title:`√âvolution des Performances ${u}`,children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Be,{data:m,margin:{top:20,right:30,left:20,bottom:20},onClick:o=>{if(o&&o.activeLabel){const r=m.find(l=>l.period===o.activeLabel);r&&j({selectedPlayer:s,selectedDate:r.period,fromComponent:`√âvolution des Performances ${u}`})}},style:{cursor:"pointer"},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"period",angle:a.angle,textAnchor:"end",height:a.height,interval:a.interval,fontSize:a.fontSize}),e.jsx(X,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(H,{content:({active:o,payload:r})=>{if(o&&r&&r.length>0){const l=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:l.period})}),e.jsxs("div",{children:["Parties: ",l.totalGames]}),e.jsxs("div",{children:["Victoires: ",l.victories]}),e.jsxs("div",{children:["Taux: ",l.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(Oe,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["R√©partition Victoires/D√©faites ",u]}),e.jsx(Y,{title:`R√©partition Victoires/D√©faites ${u}`,children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:m,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"period",angle:a.angle,textAnchor:"end",height:a.height,interval:a.interval,fontSize:a.fontSize}),e.jsx(X,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:o,payload:r})=>{if(o&&r&&r.length>0){const l=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:l.period})}),e.jsxs("div",{children:["Total: ",l.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",l.victories]}),e.jsxs("div",{children:["D√©faites: ",l.defeats]}),e.jsxs("div",{children:["Taux: ",l.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(O,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",shape:o=>{const{x:r,y:l,width:y,height:c,payload:b}=o,T=b;return e.jsx(ee,{x:r,y:l,width:y,height:c,fill:"var(--accent-tertiary)",onClick:()=>{j({selectedPlayer:s,selectedDate:T.period,fromComponent:`Historique Joueur - Victoires ${u}`})},style:{cursor:"pointer"}})}}),e.jsx(O,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"D√©faites",shape:o=>{const{x:r,y:l,width:y,height:c,payload:b}=o,T=b;return e.jsx(ee,{x:r,y:l,width:y,height:c,fill:"var(--chart-color-4)",onClick:()=>{j({selectedPlayer:s,selectedDate:T.period,fromComponent:`Historique Joueur - D√©faites ${u}`})},style:{cursor:"pointer"}})}})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e d'historique disponible"})}function dt({selectedPlayerName:s}){const{navigateToGameDetails:d}=ne(),{data:x,isLoading:j,error:w}=xe(s),i=oe(),h=n=>{if(n.name==="Autres"){const a=n._details?.map(o=>o.name)||[];d({selectedPlayer:s,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:a},fromComponent:"Distribution par Camps"})}else n.name==="Tra√Ætre"||n.name==="Louveteau"?d({selectedPlayer:s,campFilter:{selectedCamp:n.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):n.name==="Loup"?d({selectedPlayer:s,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):d({selectedPlayer:s,campFilter:{selectedCamp:n.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},u=k.useMemo(()=>x?.campStats?Object.entries(x.campStats).map(([n,a])=>({name:n,value:a.appearances,winRate:a.winRate,winRateDisplay:Math.max(parseFloat(a.winRate),1),wins:a.wins,percentage:(a.appearances/x.totalGames*100).toFixed(1)})):[],[x]),p=k.useMemo(()=>{if(!u.length)return[];const n=5;let a=0;const o=[],r=[];if(u.forEach(l=>{parseFloat(l.percentage)<n?(a+=Number(l.value),o.push(l)):r.push(l)}),a>0){const l=u.reduce((y,c)=>y+Number(c.value),0);r.push({name:"Autres",value:a,winRate:"0.0",winRateDisplay:1,wins:o.reduce((y,c)=>y+c.wins,0),percentage:(a/l*100).toFixed(1),_details:o})}return r},[u]),m=k.useMemo(()=>p.map((n,a)=>({...n,fill:n.name==="Autres"?Ee:i[n.name]||`var(--chart-color-${a%6+1})`})),[p,i]);return j?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):w?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",w]}):x?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(De,{children:[e.jsx(Re,{data:m,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:n=>{const a=n.percent!==void 0?n.percent:0;return n.name==="Autres"?`Autres : ${n.value} (${(a*100).toFixed(1)}%)`:`${n.name}: ${n.value} (${(a*100).toFixed(1)}%)`},onClick:n=>h(n)}),e.jsx(H,{content:({active:n,payload:a})=>{if(n&&a&&a.length>0){const o=a[0].payload;if(o.name==="Autres"&&o._details){const r=[...o._details].sort((l,y)=>y.value-l.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",o.value," parties (",o.percentage,"%)"]})}),e.jsx("div",{children:r.map((l,y)=>e.jsxs("div",{children:[l.name,": ",l.value," parties (",l.percentage,"%)"]},y))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[o.name," - ",o.value," parties (",o.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(Y,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:u,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(H,{content:({active:n,payload:a})=>{if(n&&a&&a.length>0){const o=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:o.name})}),e.jsxs("div",{children:["Victoires: ",o.wins," / ",o.value]}),e.jsxs("div",{children:["Taux: ",o.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(O,{dataKey:"winRateDisplay",shape:n=>{const{x:a,y:o,width:r,height:l,payload:y,index:c}=n,b=y,T=i[b.name]||`var(--chart-color-${(c??0)%6+1})`,W=parseFloat(b.winRate)===0?`${T}50`:T;return e.jsx(ee,{x:a,y:o,width:r,height:l,fill:W,onClick:()=>{b.name==="Tra√Ætre"||b.name==="Louveteau"?d({selectedPlayer:s,campFilter:{selectedCamp:b.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):b.name==="Loup"?d({selectedPlayer:s,campFilter:{selectedCamp:b.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):d({selectedPlayer:s,campFilter:{selectedCamp:b.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}})}})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e d'historique disponible"})}function ut({selectedPlayerName:s}){const{gameData:d}=he(),{joueursData:x}=ue(),j=ge(x),w=oe(),i=k.useMemo(()=>{if(!d||!s)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const u={},p={},m={},n=new Set;d.forEach(y=>{const c=y.PlayerStats.find(b=>b.Username.toLowerCase()===s.toLowerCase());if(c&&(y.PlayerStats.forEach(b=>{b.KillerName?.toLowerCase()===s.toLowerCase()&&(u[b.Username]=(u[b.Username]||0)+1)}),c.KillerName&&(p[c.KillerName]=(p[c.KillerName]||0)+1),c.DeathType)){const b=c.DeathType,T=de(b);m[T]||(m[T]={count:0,byDeathType:{}}),m[T].count+=1,m[T].byDeathType[b]=(m[T].byDeathType[b]||0)+1,n.add(b)}});const a=Object.entries(u).map(([y,c])=>({player:y,kills:c})).sort((y,c)=>c.kills-y.kills).slice(0,ie.TOP_10),o=Object.entries(p).map(([y,c])=>({player:y,kills:c})).sort((y,c)=>c.kills-y.kills).slice(0,ie.TOP_10),r=Object.entries(m).map(([y,c])=>{const b={deathType:y,count:c.count};return b[y]=c.count,b}).sort((y,c)=>c.count-y.count).slice(0,ie.TOP_10),l=Object.keys(m);return{playersKilled:a,killedBy:o,deathTypes:r,availableDeathTypes:l}},[d,s]),h=k.useMemo(()=>{const u={};i.availableDeathTypes.forEach(n=>{n==="Tu√© par Loup"?u[n]=w.Loup:n==="Mort aux votes"?u[n]="var(--chart-color-1)":n.includes("Chasseur")?u[n]=w.Chasseur:n==="Tu√© par Zombie"?u[n]=w.Vaudou:n==="Tu√© par potion assassin"?u[n]=w.Alchimiste:n==="Tu√© par Vengeur"?u[n]="var(--chart-color-2)":n==="Amoureux mort"?u[n]=w.Amoureux:n==="Tu√© par La B√™te"?u[n]="var(--chart-color-3)":n==="Tu√© par Sh√©rif"&&(u[n]="var(--chart-color-4)")});const p=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let m=0;return i.availableDeathTypes.forEach(n=>{u[n]||(u[n]=p[m%p.length],m++)}),u},[i.availableDeathTypes,w]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[i.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(Y,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:i.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:u,payload:p})=>{if(u&&p&&p.length>0){const m=p[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.player})}),e.jsxs("div",{children:["Tu√© ",m.kills," fois par ",s]})]})}return null}}),e.jsx(O,{dataKey:"kills",shape:u=>{const{x:p,y:m,width:n,height:a,payload:o}=u,l=j[o.player]||"var(--chart-color-3)";return e.jsx(ee,{x:p,y:m,width:n,height:a,fill:l})}})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistr√©"}),e.jsxs("p",{children:[s," n'a tu√© aucun joueur dans les parties enregistr√©es."]})]}),i.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(Y,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:i.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:u,payload:p})=>{if(u&&p&&p.length>0){const m=p[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.player})}),e.jsxs("div",{children:["A tu√© ",s," ",m.kills," fois"]})]})}return null}}),e.jsx(O,{dataKey:"kills",shape:u=>{const{x:p,y:m,width:n,height:a,payload:o}=u,l=j[o.player]||"var(--chart-color-4)";return e.jsx(ee,{x:p,y:m,width:n,height:a,fill:l})}})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[s," n'a jamais √©t√© tu√© par un autre joueur dans les parties enregistr√©es."]})]}),i.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus Fr√©quents"}),e.jsx(Y,{title:"Types de Mort les Plus Fr√©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:i.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:u,payload:p})=>{if(u&&p&&p.length>0){const m=p[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.deathType})}),e.jsxs("div",{children:[s," est mort ",m.count," fois ainsi"]})]})}return null}}),i.availableDeathTypes.map(u=>e.jsx(O,{dataKey:u,name:u,stackId:"deaths",fill:h[u]||"var(--chart-color-5)"},u))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donn√©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",s,"."]})]})]})}function mt(s,d){if(!s||s.trim()===""||d.length===0)return null;const x=new Map,j=new Map,w=new Map;d.forEach(m=>{if(!m.Modded)return;const n=m.PlayerStats.find(a=>te(a)===s||a.Username.toLowerCase()===s.toLowerCase());if(n){if(n.MainRoleInitial==="Inconnu")return;const a=n.Victorious,r=Te(n.MainRoleInitial,n.MainRoleChanges||[])!==n.MainRoleInitial,l=ce(n.MainRoleInitial),y=l==="Loup"||l==="Tra√Ætre"||l==="Louveteau";if(l==="Villageois"&&be(n)){const c=Ce(n);if(c&&Ke.includes(c)){const b=x.get(c)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};x.set(c,{appearances:b.appearances+1,wins:b.wins+(a?1:0),winsWithoutRoleChange:b.winsWithoutRoleChange+(!r&&a?1:0),gamesWithoutRoleChange:b.gamesWithoutRoleChange+(r?0:1)})}}else if(n.Power&&n.Power.trim()!==""&&n.Power!=="Inconnu"){if(l==="Villageois"){const c=x.get(n.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};x.set(n.Power,{appearances:c.appearances+1,wins:c.wins+(a?1:0),winsWithoutRoleChange:c.winsWithoutRoleChange+(!r&&a?1:0),gamesWithoutRoleChange:c.gamesWithoutRoleChange+(r?0:1)})}else if(y){const c=j.get(n.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},b=c.roleBreakdown;b.set(n.MainRoleInitial,(b.get(n.MainRoleInitial)||0)+1),j.set(n.Power,{appearances:c.appearances+1,wins:c.wins+(a?1:0),winsWithoutRoleChange:c.winsWithoutRoleChange+(!r&&a?1:0),gamesWithoutRoleChange:c.gamesWithoutRoleChange+(r?0:1),roleBreakdown:b})}}else if((l==="Villageois"||y)&&n.Power!=="Inconnu")if(l==="Villageois"){const c=x.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};x.set("Aucun pouvoir",{appearances:c.appearances+1,wins:c.wins+(a?1:0),winsWithoutRoleChange:c.winsWithoutRoleChange+(!r&&a?1:0),gamesWithoutRoleChange:c.gamesWithoutRoleChange+(r?0:1)})}else{const c=j.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},b=c.roleBreakdown;b.set(n.MainRoleInitial,(b.get(n.MainRoleInitial)||0)+1),j.set("Aucun pouvoir",{appearances:c.appearances+1,wins:c.wins+(a?1:0),winsWithoutRoleChange:c.winsWithoutRoleChange+(!r&&a?1:0),gamesWithoutRoleChange:c.gamesWithoutRoleChange+(r?0:1),roleBreakdown:b})}if(n.SecondaryRole&&n.SecondaryRole.trim()!==""&&n.SecondaryRole!=="Inconnu"){const c=w.get(n.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};w.set(n.SecondaryRole,{appearances:c.appearances+1,wins:c.wins+(a?1:0),winsWithoutRoleChange:c.winsWithoutRoleChange+(!r&&a?1:0),gamesWithoutRoleChange:c.gamesWithoutRoleChange+(r?0:1)})}}});const i=new Map;d.forEach(m=>{const n=m.PlayerStats.find(a=>te(a)===s||a.Username.toLowerCase()===s.toLowerCase());if(n&&be(n)){const a=Ce(n);a&&i.set(a,(i.get(a)||0)+1)}});const h=m=>Array.from(m.entries()).map(([n,a])=>({name:n,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...i.has(n)&&{totalGamesAllModes:i.get(n)}})).sort((n,a)=>a.appearances-n.appearances),u=m=>Array.from(m.entries()).map(([n,a])=>({name:n,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(a.roleBreakdown.entries()).map(([o,r])=>({role:o,count:r})).sort((o,r)=>r.count-o.count)})).sort((n,a)=>a.appearances-n.appearances),p=m=>Array.from(m.entries()).map(([n,a])=>({name:n,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((n,a)=>a.appearances-n.appearances);return{villageoisPowers:h(x),loupPowers:u(j),secondaryRoles:p(w)}}function pt({selectedPlayerName:s}){const{navigateToGameDetails:d,navigationState:x,updateNavigationState:j}=ne(),w=oe(),[i,h]=k.useState(x.playerHistoryRolesState?.chartMode||"appearances"),{data:u,isLoading:p,error:m}=ve(T=>mt(s,T));k.useEffect(()=>{(!x.playerHistoryRolesState||x.playerHistoryRolesState.chartMode!==i)&&j({playerHistoryRolesState:{chartMode:i}})},[i,x.playerHistoryRolesState,j]);const n=T=>{h(T),j({playerHistoryRolesState:{chartMode:T}})},a=k.useCallback(T=>{if(!u)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const W=1,D=1,M=i==="winRate"?(z,L)=>parseFloat(L.winRate)-parseFloat(z.winRate):(z,L)=>L.appearances-z.appearances,F=z=>({...z,winRateDisplay:Math.max(parseFloat(z.winRate),1)}),E=z=>T===null?z:z.slice(0,T);return{villageoisPowers:E(u.villageoisPowers.filter(z=>z.appearances>=W).map(F).sort(M)),loupPowers:E(u.loupPowers.filter(z=>z.appearances>=W).map(F).sort(M)),secondaryRoles:E(u.secondaryRoles.filter(z=>z.appearances>=D).map(F).sort(M))}},[u,i]),o=k.useMemo(()=>a(15),[a]);if(p)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des r√¥les..."});if(m)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",m]});if(!u)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de r√¥le disponible"});const r=o.villageoisPowers.length>0,l=o.loupPowers.length>0,y=o.secondaryRoles.length>0;if(!r&&!l&&!y)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou r√¥le secondaire trouv√©"});const c=({active:T,payload:W})=>{if(T&&W&&W.length>0){const D=W[0].payload,M=D.gamesWithoutRoleChange<D.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:D.name})}),e.jsxs("div",{children:["Apparitions: ",D.appearances]}),M&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",D.appearances-D.gamesWithoutRoleChange," avec changement de r√¥le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",D.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",D.winRate,"%"]})}),D.totalGamesAllModes&&D.totalGamesAllModes!==D.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non modd√©es: ",D.totalGamesAllModes,")"]}),D.roleBreakdown&&D.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"R√©partition par r√¥le:"}),D.roleBreakdown.map((F,E)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["‚Ä¢ ",F.role,": ",F.count]},E))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null},b=(T,W,D,M,F)=>{const E=i==="appearances"?"appearances":"winRateDisplay",z=i==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",L=i==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:W}),e.jsx(Y,{title:W,children:t=>{const I=a(t?null:15)[T];return e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:I,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:z,angle:270,position:"left",style:{textAnchor:"middle"}},domain:L}),e.jsx(H,{content:e.jsx(c,{})}),e.jsx(O,{dataKey:E,label:i==="winRate"?S=>{const{x:f,y:g,width:N,payload:v}=S;if(f===void 0||g===void 0||N===void 0||!v)return null;const P=v.winRate||"0";return e.jsxs("text",{x:f+N/2,y:g-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[P,"%"]})}:void 0,shape:S=>{const{x:f,y:g,width:N,height:v,payload:P,index:A}=S,$=P,B=F?F($.name,A??0):D;return e.jsx(ee,{x:f,y:g,width:N,height:v,fill:B,onClick:()=>M($.name),style:{cursor:"pointer"}})}})]})})})}})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:i,onChange:T=>n(T.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[r&&b("villageoisPowers","Camp Villageois","var(--chart-color-1)",T=>{d({selectedPlayer:s,campFilter:{selectedCamp:"Villageois",campFilterMode:i==="winRate"?"wins-only":"all-assignments"},selectedPower:T,fromComponent:`Historique des R√¥les - Pouvoir: ${T}`})},T=>T==="Chasseur"&&w.Chasseur?w.Chasseur:T==="Alchimiste"&&w.Alchimiste?w.Alchimiste:T==="Protecteur"&&w.Protecteur?w.Protecteur:T==="Disciple"&&w.Disciple?w.Disciple:T==="Inquisiteur"&&w.Inquisiteur?w.Inquisiteur:"var(--chart-color-1)"),l&&b("loupPowers","Camp Loups","var(--chart-color-2)",T=>{d({selectedPlayer:s,campFilter:{selectedCamp:"Loup",campFilterMode:i==="winRate"?"wins-only":"all-assignments"},selectedPower:T,fromComponent:`Historique des R√¥les - Pouvoir: ${T}`})},()=>w.Loup||"var(--chart-color-2)"),y&&b("secondaryRoles","R√¥les Secondaires","var(--chart-color-3)",T=>{d({selectedPlayer:s,selectedSecondaryRole:T,fromComponent:`Historique des R√¥les - R√¥le Secondaire: ${T}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"‚ÑπÔ∏è Les victoires et le taux de victoire excluent les parties o√π le r√¥le principal a chang√© en cours de partie (ex: Garde en Chasseur, r√©ssucit√© en Zombie par un Vaudou, etc...)."})]})]})}const Se=["UseGadget","DrinkPotion"],ht={UseGadget:"Utilisation Gadget",DrinkPotion:"Potion bue"},gt={UseGadget:"var(--chart-color-1, #8884d8)",DrinkPotion:"var(--chart-color-3, #ffc658)"};function xt({selectedPlayerName:s}){const{gameData:d}=he(),x=k.useMemo(()=>{if(!d||!s)return{actionTypeCounts:[],gadgetDetails:[],potionDetails:[],totalGamesWithActions:0,totalGamesPlayed:0};const w={UseGadget:0,DrinkPotion:0},i={},h={};let u=0,p=0;d.forEach(o=>{const r=o.PlayerStats.find(c=>c.Username.toLowerCase()===s.toLowerCase());if(!r)return;p++;let l=!1;(r.Actions||[]).forEach(c=>{const b=c.ActionType;Se.includes(b)&&(w[b]++,l=!0,b==="UseGadget"&&c.ActionName&&c.ActionName!=="Balle"&&(i[c.ActionName]=(i[c.ActionName]||0)+1),b==="DrinkPotion"&&c.ActionName&&(h[c.ActionName]=(h[c.ActionName]||0)+1))}),l&&u++});const m=Se.filter(o=>w[o]>0).map(o=>({actionType:o,label:ht[o],count:w[o],color:gt[o]})).sort((o,r)=>r.count-o.count),n=Object.entries(i).map(([o,r])=>({gadgetName:o,count:r})).sort((o,r)=>r.count-o.count).slice(0,ie.TOP_10),a=Object.entries(h).map(([o,r])=>({potionName:o,count:r})).sort((o,r)=>r.count-o.count).slice(0,ie.TOP_10);return{actionTypeCounts:m,gadgetDetails:n,potionDetails:a,totalGamesWithActions:u,totalGamesPlayed:p}},[d,s]);return x.actionTypeCounts.length>0?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",style:{width:"100%",flexBasis:"100%"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üéÆ Parties avec actions"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:x.totalGamesWithActions}),e.jsxs("p",{children:["sur ",x.totalGamesPlayed," parties analys√©es"]})]}),x.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üîß Gadgets utilis√©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:x.gadgetDetails.reduce((w,i)=>w+i.count,0)}),e.jsxs("p",{children:[x.gadgetDetails.length," types diff√©rents"]})]}),x.potionDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üß™ Potions bues"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:x.potionDetails.reduce((w,i)=>w+i.count,0)}),e.jsxs("p",{children:[x.potionDetails.length," types diff√©rents"]})]})]}),x.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Gadgets Utilis√©s"}),e.jsx(Y,{title:"Gadgets Utilis√©s",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:x.gadgetDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"gadgetName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Utilisations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:w,payload:i})=>{if(w&&i&&i.length>0){const h=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:h.gadgetName})}),e.jsxs("div",{children:["Utilis√© ",h.count," fois"]})]})}return null}}),e.jsx(O,{dataKey:"count",fill:"var(--chart-color-1)",shape:w=>{const{x:i,y:h,width:u,height:p,index:m}=w,n=`hsl(${200+(m??0)*20}, 70%, 50%)`;return e.jsx(ee,{x:i,y:h,width:u,height:p,fill:n})}})]})})})})]}),x.potionDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Potions Bues"}),e.jsx(Y,{title:"Potions Bues",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:x.potionDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"potionName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Consommations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:w,payload:i})=>{if(w&&i&&i.length>0){const h=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:h.potionName})}),e.jsxs("div",{children:["Bue ",h.count," fois"]})]})}return null}}),e.jsx(O,{dataKey:"count",fill:"var(--chart-color-3)",shape:w=>{const{x:i,y:h,width:u,height:p,index:m}=w,n=`hsl(${40+(m??0)*15}, 80%, 55%)`;return e.jsx(ee,{x:i,y:h,width:u,height:p,fill:n})}})]})})})})]})]}):e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune donn√©e d'actions disponible pour ",s,"."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donn√©es d'actions (gadgets, potions) ne sont disponibles que pour les parties r√©centes."})]})}function yt({selectedPlayerName:s}){const{gameData:d}=he(),{joueursData:x}=ue(),j=oe(),w=ge(x),i=k.useMemo(()=>{if(!d||!s)return{hunterTargets:[],hunterMissedShots:0,hunterTotalShots:0,transformCount:0,untransformCount:0,transformationsPerGame:0,totalGamesWithActions:0,totalGamesPlayed:0,totalNightsAsWolf:0,transformsPerNight:0};const u={};let p=0,m=0,n=0,a=0,o=0,r=0;d.forEach(D=>{const M=D.PlayerStats.find(t=>t.Username.toLowerCase()===s.toLowerCase());if(!M)return;o++;let F=!1;const E=D.Modded&&$e(D.Version||"0","0.243");let z=!1;if(E)z=!0;else{const R=(M.Actions||[]).some(S=>S.ActionType==="Transform"||S.ActionType==="Untransform"),I=M.LegacyActionsIncomplete===!0;z=R&&!I}if(_e(M.MainRoleInitial)&&z){const t=Ue(M.DeathTiming,D.EndTiming);r+=t}(M.Actions||[]).forEach(t=>{t.ActionType==="HunterShoot"?(n++,F=!0,t.ActionTarget&&(u[t.ActionTarget]=(u[t.ActionTarget]||0)+1)):t.ActionType==="Transform"?(p++,F=!0):t.ActionType==="Untransform"&&(m++,F=!0)}),F&&a++});const l=Object.entries(u).map(([D,M])=>({target:D,count:M})).sort((D,M)=>M.count-D.count).slice(0,ie.TOP_10),y=Object.values(u).reduce((D,M)=>D+M,0),c=n-y,b=p>0?Math.max(1,d.filter(D=>{const M=D.PlayerStats.find(E=>E.Username.toLowerCase()===s.toLowerCase());return M?(M.Actions||[]).some(E=>E.ActionType==="Transform"):!1}).length):0,T=b>0?p/b:0,W=r>0?p/r:0;return{hunterTargets:l,hunterMissedShots:c,hunterTotalShots:n,transformCount:p,untransformCount:m,transformationsPerGame:T,totalGamesWithActions:a,totalGamesPlayed:o,totalNightsAsWolf:r,transformsPerNight:W}},[d,s]);return i.hunterTotalShots>0||i.transformCount>0||i.untransformCount>0?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[i.hunterTotalShots>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Statistiques du Chasseur"}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"‚úÖ Tirs r√©ussis"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:j.Chasseur||"var(--chart-color-2)"},children:i.hunterTotalShots-i.hunterMissedShots}),e.jsx("p",{children:"cibles touch√©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"‚ùå Tirs manqu√©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--text-secondary)"},children:i.hunterMissedShots}),e.jsx("p",{children:"tirs sans cible"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üìä Pr√©cision"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:j.Chasseur||"var(--chart-color-2)"},children:[i.hunterTotalShots>0?((i.hunterTotalShots-i.hunterMissedShots)/i.hunterTotalShots*100).toFixed(1):"0","%"]}),e.jsx("p",{children:"taux de r√©ussite"})]})]}),i.hunterTargets.length>0&&e.jsx(Y,{title:"Cibles √âlimin√©es par le Chasseur",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:i.hunterTargets,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"target",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Nombre de tirs",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:u,payload:p})=>{if(u&&p&&p.length>0){const m=p[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.target})}),e.jsxs("div",{children:["Tu√© par le chasseur ",m.count," fois"]})]})}return null}}),e.jsx(O,{dataKey:"count",fill:j.Chasseur||"var(--chart-color-2)",shape:u=>{const{x:p,y:m,width:n,height:a,payload:o,index:r}=u,y=w[o.target]||j.Chasseur||`hsl(${120+(r??0)*15}, 60%, 45%)`;return e.jsx(ee,{x:p,y:m,width:n,height:a,fill:y})}})]})})})})]}),(i.transformCount>0||i.untransformCount>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Habitudes de Transformation (Loup)"}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üìä Ratio"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:(()=>{const u=i.transformCount,p=i.untransformCount;return u===0?"0%":`${(p/u*100).toFixed(0)}%`})()}),e.jsx("p",{children:"d√©transformations / transformations"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üåô Nuits totales"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:i.totalNightsAsWolf}),e.jsx("p",{children:"nuits v√©cues en loup (opportunit√©s)"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üéØ Ratio / nuit"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:j.Loup||"var(--wolf-color)"},children:i.transformsPerNight.toFixed(2)}),e.jsx("p",{children:"transformations par nuit v√©cue"})]})]}),e.jsx(Y,{title:"Statistiques de Transformation",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:[{name:"Statistiques Loup","Nuits v√©cues":i.totalNightsAsWolf,Transformations:i.transformCount,D√©transformations:i.untransformCount}],margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",fontSize:14}),e.jsx(X,{label:{value:"Compte",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:u,payload:p})=>!u||!p||p.length===0?null:e.jsx("div",{className:"custom-tooltip",style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border-primary)",borderRadius:"4px",padding:"10px"},children:p.map((m,n)=>e.jsxs("div",{style:{color:m.color,marginBottom:"4px"},children:[e.jsxs("strong",{children:[m.name,":"]})," ",m.value]},n))})}),e.jsx(Ae,{}),e.jsx(O,{dataKey:"Nuits v√©cues",fill:"var(--chart-color-4, #a4de6c)"}),e.jsx(O,{dataKey:"Transformations",fill:j.Loup||"var(--wolf-color)"}),e.jsx(O,{dataKey:"D√©transformations",fill:"var(--accent-secondary)"})]})})})})]})]}):e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune donn√©e d'actions de r√¥le disponible pour ",s,"."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donn√©es d'actions de r√¥le (Chasseur, Loup) ne sont disponibles que pour les parties r√©centes."})]})}function ft({viewMode:s,setViewMode:d,selectedMap:x,setSelectedMap:j,availableMaps:w,clusterRadius:i,setClusterRadius:h,availableDeathTypes:u,selectedDeathTypes:p,setSelectedDeathTypes:m,deathTypeColors:n,isDeathTypesExpanded:a,setIsDeathTypesExpanded:o}){return e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>d("deaths"),style:{background:s==="deaths"?"var(--accent-primary)":"transparent",color:s==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:s==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"üíÄ Morts"}),e.jsx("button",{type:"button",onClick:()=>d("kills"),style:{background:s==="kills"?"var(--accent-primary)":"transparent",color:s==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:s==="kills"?"bold":"normal",transition:"all 0.2s"},children:"‚öîÔ∏è Kills"}),e.jsx("button",{type:"button",onClick:()=>d("transformations"),style:{background:s==="transformations"?"var(--accent-primary)":"transparent",color:s==="transformations"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:s==="transformations"?"bold":"normal",transition:"all 0.2s"},children:"üê∫ Transfos"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:x,onChange:r=>j(r.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:w.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:i,onChange:r=>h(parseInt(r.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:i===0?"Aucun":`${i} unit√©${i>1?"s":""}`})]}),s!=="transformations"&&e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>o(!a),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:a?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:a?"rotate(90deg)":"rotate(0deg)"},children:"‚ñ∂"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[p.length," / ",u.length," s√©lectionn√©",p.length>1?"s":""]})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),m(u)},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),m([])},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:u.map(r=>{const l=p.includes(r),y=n[r]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",background:l?"var(--bg-tertiary)":"transparent",borderRadius:"4px",border:`1px solid ${l?y:"var(--border-color)"}`,cursor:"pointer",transition:"all 0.2s",fontSize:"0.9rem"},onClick:c=>{c.stopPropagation(),m(l?b=>b.filter(T=>T!==r):b=>[...b,r])},children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:y,flexShrink:0}}),e.jsx("span",{children:de(r)})]},r)})})]})]})]})}function vt({zoneAnalysis:s,selectedMap:d,viewMode:x,selectedPlayerName:j,hoveredZone:w,setHoveredZone:i}){return!s||d!=="Village"||x!=="deaths"?null:e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"0rem",padding:"1.5rem",background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",borderRadius:"12px",border:"2px solid var(--accent-primary)",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",color:"var(--accent-primary)",fontSize:"1.3rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"üìä Analyse par zone (Village)"}),e.jsx("p",{style:{fontSize:"0.95rem",marginBottom:"1rem",color:"var(--text-secondary)",lineHeight:"1.5"},children:"Distribution des morts (selon les types s√©lectionn√©s) compar√©e √† la moyenne de tous les joueurs:"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:s.zoneStats.map(h=>{const u=h.zone===s.dominantZone&&s.maxDeviation>10;return e.jsxs("div",{onMouseEnter:()=>i(h.zone),onMouseLeave:()=>i(null),style:{padding:"1rem",background:"var(--bg-primary)",borderRadius:"8px",border:w===h.zone?"1px solid var(--accent-primary)":"1px solid var(--border-color)",color:"var(--text-primary)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.95rem"},children:h.zone}),e.jsxs("div",{style:{fontSize:"0.85rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[j,": ",e.jsxs("strong",{children:[h.playerPercent.toFixed(1),"%"]})," (",h.playerCount,")"]}),e.jsxs("div",{style:{opacity:.85},children:["Moyenne: ",h.avgPercent.toFixed(1),"%"]}),e.jsxs("div",{style:{marginTop:"0.25rem",color:u?"var(--accent-secondary)":h.deviation>0?"var(--accent-primary)":"var(--text-secondary)",fontWeight:Math.abs(h.deviation)>5?"bold":"normal"},children:[h.deviation>0?"+":"",h.deviation.toFixed(1),"% vs moyenne"]})]})]},h.zone)})}),s.dominantZone&&s.maxDeviation>10&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",fontSize:"0.95rem",color:"var(--accent-primary)",fontWeight:"bold",background:"var(--bg-primary)",borderRadius:"8px",border:"2px solid var(--accent-primary)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"‚ö†Ô∏è"}),e.jsxs("span",{children:[j," meurt significativement plus souvent en zone ",s.dominantZone,"(","+"+s.maxDeviation.toFixed(1),"% par rapport √† la moyenne)"]})]})]})}function jt({locationData:s,clusteredData:d,viewMode:x,selectedPlayerName:j,selectedMap:w,mapConfig:i,xDomain:h,zDomain:u,hoveredZone:p,getDeathColor:m,handleLocationClick:n}){const a=({active:o,payload:r})=>{if(!o||!r||r.length===0)return null;const l=r[0].payload,y=l.allLocations||[l],c=y.length>1,b=x==="transformations";if(c){const W=new Map,D=new Map,M=new Set,F=new Map;y.forEach(t=>{if(W.set(t.victimName,(W.get(t.victimName)||0)+1),b)F.set(t.camp,(F.get(t.camp)||0)+1);else{const R=t.deathType?de(t.deathType):"Inconnu";D.set(R,(D.get(R)||0)+1)}M.add(t.gameId)});const E=Array.from(W.entries()).sort((t,R)=>R[1]-t[1]).slice(0,3),z=Array.from(D.entries()).sort((t,R)=>R[1]-t[1]).slice(0,3),L=Array.from(F.entries()).sort((t,R)=>R[1]-t[1]);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[b?"üê∫":x==="deaths"?"üíÄ":"‚öîÔ∏è"," ",y.length," ",b?"transformations":x==="deaths"?"morts":"kills"," √† cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[b?e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Camps loup:"}),L.map(([t,R])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["‚Ä¢ ",t," (",R,"√ó)"]},t))]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:x==="deaths"?"Victimes:":"Kills sur:"}),E.map(([t,R])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["‚Ä¢ ",t," (",R,"√ó)"]},t))]}),e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Types de mort:"}),z.map(([t,R])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["‚Ä¢ ",t," (",R,"√ó)"]},t))]})]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["üìç ",M.size," partie",M.size>1?"s":""," diff√©rente",M.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concern√©es"})]})}const T=y[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[b?"üê∫":x==="deaths"?"üíÄ":"‚öîÔ∏è"," ",b?"Transformation de":x==="deaths"?"Mort de":"Kill de"," ",j]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["üë§ ",e.jsx("strong",{children:"Joueur:"})," ",T.victimName]}),e.jsxs("div",{children:["üèïÔ∏è ",e.jsx("strong",{children:"Camp loup:"})," ",T.camp]}),e.jsxs("div",{children:["üó∫Ô∏è ",e.jsx("strong",{children:"Carte:"})," ",T.mapName]}),e.jsxs("div",{children:["üéÆ ",e.jsx("strong",{children:"Partie:"})," #",T.gameId]})]}):x==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["‚ö∞Ô∏è ",e.jsx("strong",{children:"Victime:"})," ",T.victimName]}),e.jsxs("div",{children:["‚öîÔ∏è ",e.jsx("strong",{children:"Tueur:"})," ",T.killerName||"Inconnu"]}),e.jsxs("div",{children:["üíÄ ",e.jsx("strong",{children:"Type:"})," ",T.deathType?de(T.deathType):"Inconnu"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["üéØ ",e.jsx("strong",{children:"Victime:"})," ",T.victimName]}),e.jsxs("div",{children:["üèïÔ∏è ",e.jsx("strong",{children:"Camp victime:"})," ",T.camp]}),e.jsxs("div",{children:["üíÄ ",e.jsx("strong",{children:"Type:"})," ",T.deathType?de(T.deathType):"Inconnu"]})]}),!b&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["üó∫Ô∏è ",e.jsx("strong",{children:"Carte:"})," ",T.mapName]}),e.jsxs("div",{children:["üéÆ ",e.jsx("strong",{children:"Partie:"})," #",T.gameId]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les d√©tails de la partie"})]})};return e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:s.length>0?e.jsx(Y,{title:x==="deaths"?`Carte des Morts de ${j}`:`Carte des Kills de ${j}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Ye,{margin:{top:20,right:30,left:60,bottom:20},children:[i&&e.jsx(ae,{x1:i.zMin,x2:i.zMax,y1:i.xMin,y2:i.xMax,fill:"transparent",stroke:"none",shape:o=>{const{x:r,y:l,width:y,height:c}=o;return e.jsx("image",{x:r,y:l,width:y,height:c,href:i.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),w==="Village"&&p&&e.jsxs(e.Fragment,{children:[p==="Ruines"&&e.jsx(ae,{x1:-220,x2:200,y1:100,y2:450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),p==="Village Principal"&&e.jsx(ae,{x1:-250,x2:100,y1:-120,y2:-450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),p==="Ferme"&&e.jsx(ae,{x1:-550,x2:-250,y1:150,y2:-150,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),p==="Village P√™cheur"&&e.jsx(ae,{x1:150,x2:500,y1:80,y2:-320,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),p==="Reste de la Carte"&&e.jsx(ae,{x1:i?.zMin??-600,x2:i?.zMax??600,y1:i?.xMin??-500,y2:i?.xMax??500,fill:"var(--accent-primary)",fillOpacity:.15,stroke:"var(--accent-primary)",strokeWidth:2,strokeDasharray:"5 5"})]}),e.jsx(J,{strokeDasharray:"3 3",stroke:i?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(Q,{dataKey:"z",type:"number",name:"Position Z",domain:u,hide:!0}),e.jsx(X,{dataKey:"x",type:"number",name:"Position X",domain:h,hide:!0}),e.jsx(H,{content:e.jsx(a,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Je,{data:d,style:{cursor:"pointer"},isAnimationActive:!1,shape:o=>{const{cx:r,cy:l,payload:y}=o,c=y,b=Math.min(Math.log2(c.count+1)*3+5,18),T=Math.round(b);return e.jsx("circle",{cx:r,cy:l,r:T,fill:m(c.deathType,c.camp),stroke:c.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:c.count>1?2:1,opacity:.85,onClick:()=>n(c)})}})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:x==="deaths"?`Aucune mort localis√©e pour ${j} sur cette carte.`:x==="kills"?`Aucun kill localis√© pour ${j} sur cette carte.`:`Aucune transformation en loup localis√©e pour ${j} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donn√©es de position ne sont disponibles que pour les parties r√©centes."})]})})}function Ne(s,d){return d>=-250&&d<=100&&s>=-450&&s<=-120?"Village Principal":d>=-550&&d<=-250&&s>=-150&&s<=150?"Ferme":d>=150&&d<=500&&s>=-320&&s<=80?"Village P√™cheur":d>=-220&&d<=200&&s>=100&&s<=450?"Ruines":"Reste de la Carte"}function le(s){return s==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":s}function bt({selectedPlayerName:s}){const{navigateToGameDetails:d}=ne(),{gameData:x,isLoading:j,error:w}=he(),i=oe(),[h,u]=k.useState("deaths"),[p,m]=k.useState(""),[n,a]=k.useState(0),[o,r]=k.useState(null),[l,y]=k.useState([]),[c,b]=k.useState(!1),{data:T}=xe(s,"Tous les camps"),W=k.useMemo(()=>{if(!x)return[];const N=new Set;return x.forEach(v=>{const P=v.PlayerStats.find(A=>A.Username.toLowerCase()===s.toLowerCase());P&&(P.DeathPosition!==null&&v.MapName&&N.add(v.MapName),v.PlayerStats.forEach(A=>{A.KillerName?.toLowerCase()===s.toLowerCase()&&A.DeathPosition!==null&&v.MapName&&N.add(v.MapName)}),P.Actions&&Array.isArray(P.Actions)&&P.Actions.some(A=>A.ActionType==="Transform")&&v.MapName&&N.add(v.MapName))}),Array.from(N).filter(v=>v==="Village"||v==="Ch√¢teau").sort((v,P)=>v==="Village"?-1:P==="Village"?1:v.localeCompare(P))},[x,s]),D=W.length>0?W[0]:"";p===""&&D!==""&&m(D);const{availableDeathTypes:M,deathTypeColors:F}=k.useMemo(()=>{if(!x||!s)return{availableDeathTypes:[],deathTypeColors:{}};const N=new Set,v={};return x.forEach(P=>{const A=P.PlayerStats.find($=>$.Username.toLowerCase()===s.toLowerCase());if(A){if(A.DeathPosition&&A.DeathType){const $=le(A.DeathType);$&&N.add($)}P.PlayerStats.forEach($=>{if($.KillerName?.toLowerCase()===s.toLowerCase()&&$.DeathPosition&&$.DeathType){const B=le($.DeathType);B&&N.add(B)}})}}),N.forEach(P=>{v[P]=Qe(P,i)}),{availableDeathTypes:Array.from(N).sort(),deathTypeColors:v}},[x,s,i]),E=(N,v)=>h==="transformations"&&v?i[v]||"var(--text-secondary)":N&&F[N]||"var(--text-secondary)";k.useEffect(()=>{if(l.length===0&&M.length>0){const N=M.filter(v=>v!=="VOTED");y(N)}},[M.length]);const z=k.useMemo(()=>{if(!x||!s)return[];const N=[];return x.forEach(v=>{if(p&&v.MapName!==p)return;const P=v.PlayerStats.find(A=>A.Username.toLowerCase()===s.toLowerCase());if(P)if(h==="deaths"){if(P.DeathPosition){const A=ce(P.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),$=me(P.DeathPosition.x,P.DeathPosition.z,v.MapName);N.push({x:$.x,z:$.z,victimName:P.Username,killerName:P.KillerName||null,deathType:le(P.DeathType),mapName:v.MapName,camp:A,gameId:v.DisplayedId,displayedGameId:v.DisplayedId})}}else h==="kills"?v.PlayerStats.forEach(A=>{if(A.KillerName?.toLowerCase()===s.toLowerCase()&&A.DeathPosition){const $=ce(A.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),B=me(A.DeathPosition.x,A.DeathPosition.z,v.MapName);N.push({x:B.x,z:B.z,victimName:A.Username,killerName:s,deathType:le(A.DeathType),mapName:v.MapName,camp:$,gameId:v.DisplayedId,displayedGameId:v.DisplayedId})}}):h==="transformations"&&P.Actions&&Array.isArray(P.Actions)&&P.Actions.forEach(A=>{if(A.ActionType==="Transform"&&A.Position){const $=ce(P.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),B=me(A.Position.x,A.Position.z,v.MapName);N.push({x:B.x,z:B.z,victimName:P.Username,killerName:null,deathType:null,mapName:v.MapName,camp:$,gameId:v.DisplayedId,displayedGameId:v.DisplayedId})}})}),h!=="transformations"&&l.length>0&&l.length<M.length?N.filter(v=>v.deathType&&l.includes(v.deathType)):N},[x,s,h,p,l,M]),L=k.useMemo(()=>{if(p!=="Village"||h!=="deaths"||z.length===0)return null;const N={"Village Principal":0,Ferme:0,"Village P√™cheur":0,Ruines:0,"Reste de la Carte":0};if(z.forEach(V=>{const G=Ne(V.x,V.z);N[G]=(N[G]||0)+1}),!x)return null;const v={"Village Principal":0,Ferme:0,"Village P√™cheur":0,Ruines:0,"Reste de la Carte":0};x.forEach(V=>{V.MapName==="Village"&&V.PlayerStats.forEach(G=>{if(!G.DeathPosition)return;const _=le(G.DeathType);if(l.length>0&&l.length<M.length&&(!_||!l.includes(_)))return;const U=me(G.DeathPosition.x,G.DeathPosition.z,"Village"),ye=Ne(U.x,U.z);v[ye]=(v[ye]||0)+1})});const P=Object.values(v).reduce((V,G)=>V+G,0),A=Object.values(N).reduce((V,G)=>V+G,0);if(P===0||A===0)return null;const $=["Village Principal","Village P√™cheur","Ferme","Ruines","Reste de la Carte"];let B=0,C=null;const q=$.map(V=>{const G=N[V]/A*100,_=v[V]/P*100,U=G-_;return U>B&&N[V]>=2&&(B=U,C=V),{zone:V,playerCount:N[V],playerPercent:G,avgPercent:_,deviation:U}});return{totalPlayerDeaths:A,totalAllDeaths:P,zoneStats:q,dominantZone:C,maxDeviation:B}},[z,p,h,x,l,M]),t=k.useMemo(()=>Xe(z,n).map((v,P)=>{const A=v.items[0],$=Ze(v.items);return{x:v.centroidX,z:v.centroidZ,count:v.items.length,allLocations:v.items,victimName:v.items.length===1?A.victimName:null,killerName:v.items.length===1?A.killerName:null,deathType:$,mapName:A.mapName,camp:A.camp,gameId:v.items.length===1?A.gameId:null,displayedGameId:v.items.length===1?A.displayedGameId:null,clusterIndex:P}}),[z,n]),R=k.useMemo(()=>et(p),[p]),{xDomain:I,zDomain:S}=k.useMemo(()=>{if(R)return{xDomain:[R.xMin,R.xMax],zDomain:[R.zMin,R.zMax]};if(t.length===0)return{xDomain:[0,100],zDomain:[0,100]};const N=t.map(V=>V.x),v=t.map(V=>V.z),P=Math.min(...N),A=Math.max(...N),$=Math.min(...v),B=Math.max(...v),C=(A-P)*.1||10,q=(B-$)*.1||10;return{xDomain:[P-C,A+C],zDomain:[$-q,B+q]}},[t,R]),f=N=>{if(!N)return;const v=N.allLocations||[N];if(v.length===1)d({selectedGame:v[0].gameId,fromComponent:"Player Death Map"});else{const P=v.map(A=>A.gameId).filter(A=>A);d({selectedGameIds:P,fromComponent:"Player Death Map"})}},g=k.useMemo(()=>{if(!T?.mapStats||!p)return null;const N=T.mapStats[p];return N?{winRate:N.winRate,wins:N.wins,total:N.appearances}:null},[T,p]);return j?e.jsx("div",{className:"donnees-attente",children:"Chargement des donn√©es..."}):w?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",w]}):x?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsx(ft,{viewMode:h,setViewMode:u,selectedMap:p,setSelectedMap:m,availableMaps:W,clusterRadius:n,setClusterRadius:a,availableDeathTypes:M,selectedDeathTypes:l,setSelectedDeathTypes:y,deathTypeColors:F,isDeathTypesExpanded:c,setIsDeathTypesExpanded:b}),e.jsx(jt,{locationData:z,clusteredData:t,viewMode:h,selectedPlayerName:s,selectedMap:p,mapConfig:R,xDomain:I,zDomain:S,hoveredZone:o,getDeathColor:E,handleLocationClick:f}),e.jsx(vt,{zoneAnalysis:L,selectedMap:p,viewMode:h,selectedPlayerName:s,hoveredZone:o,setHoveredZone:r}),g&&e.jsxs("div",{style:{flex:"1 1 100%",textAlign:"center",padding:"0.75rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)",marginTop:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginRight:"1rem"},children:["Taux de victoire sur ",e.jsx("strong",{children:p})," :"]}),e.jsxs("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:parseFloat(g.winRate)>=50?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[g.winRate,"%"]}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["(",g.wins," / ",g.total," victoires)"]})]}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"√Ä propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",h==="deaths"?`les emplacements o√π ${s} est mort`:h==="kills"?`les emplacements o√π ${s} a √©limin√© d'autres joueurs`:`les emplacements o√π ${s} s'est transform√© en loup`," au cours des parties.",h!=="transformations"&&"Les couleurs indiquent le type de mort."," Cliquez sur un point pour voir les d√©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroup√©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"üíÄ Morts:"})," O√π le joueur a √©t√© √©limin√©",e.jsx("br",{}),e.jsx("strong",{children:"‚öîÔ∏è Kills:"})," O√π le joueur a √©limin√© d'autres joueurs",e.jsx("br",{}),e.jsx("strong",{children:"üê∫ Transformations:"})," O√π le joueur s'est transform√© en loup"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e disponible"})}function ke(s){return s.PlayerStats.some(d=>d.SecondsTalkedOutsideMeeting>0||d.SecondsTalkedDuringMeeting>0)}function fe(s,d){const x=d.DeathDateIrl||s.EndDate,j=Pe(s.StartDate,x);return j&&j>0?j:0}function Ct(s){const d=s.filter(ke),x=new Map;return d.forEach(j=>{j.PlayerStats.forEach(w=>{const i=te(w),h=Le(w),u=fe(j,w);if(u<=0)return;x.has(i)||x.set(i,{displayName:h,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const p=x.get(i);p.gamesPlayed++,p.totalSecondsAll+=(w.SecondsTalkedOutsideMeeting||0)+(w.SecondsTalkedDuringMeeting||0),p.totalGameDuration+=u})}),{playerStats:x,gamesWithTalkingData:d.length}}function wt(s,d){if(!d||d.length===0||!s)return null;const x=Ct(d),j=d.filter(ke);if(j.length===0||x.playerStats.size===0)return null;let w=null;for(const[f,g]of x.playerStats)if(g.displayName===s){w=f;break}if(!w)return null;let i=0,h=0,u=0,p=0;const m={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},n=new Map;let a=0,o=0,r=0,l=0;if(j.forEach(f=>{const g=f.PlayerStats.find(q=>te(q)===w);if(!g)return;const N=fe(f,g);if(N<=0)return;i++;const v=g.SecondsTalkedOutsideMeeting||0,P=g.SecondsTalkedDuringMeeting||0,A=v+P;h+=v,u+=P,p+=N;const $=qe(g.MainRoleInitial,g.Power);m[$].gamesPlayed++,m[$].secondsOutside+=v,m[$].secondsDuring+=P,m[$].gameDuration+=N;const B=He(g);n.has(B)||n.set(B,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const C=n.get(B);C.gamesPlayed++,C.totalSecondsAll+=A,C.totalGameDuration+=N}),i===0||p<=0)return null;const y=3600/p,c=h*y,b=u*y,T=(h+u)*y,W=h+u>0?u/(h+u)*100:0,D=[];for(const[f,g]of Object.entries(m)){if(g.gamesPlayed===0)continue;const N=g.gameDuration>0?3600/g.gameDuration:0,v=g.secondsOutside+g.secondsDuring;D.push({camp:f,gamesPlayed:g.gamesPlayed,totalSecondsOutside:g.secondsOutside,totalSecondsDuring:g.secondsDuring,totalSecondsAll:v,totalGameDurationSeconds:g.gameDuration,secondsOutsidePer60Min:g.secondsOutside*N,secondsDuringPer60Min:g.secondsDuring*N,secondsAllPer60Min:v*N,meetingRatio:v>0?g.secondsDuring/v*100:0})}D.sort((f,g)=>g.gamesPlayed-f.gamesPlayed);const M=Array.from(n.entries()).filter(([f,g])=>g.gamesPlayed>=1).map(([f,g])=>({role:f,gamesPlayed:g.gamesPlayed,secondsAllPer60Min:g.totalGameDuration>0?g.totalSecondsAll/g.totalGameDuration*3600:0,totalSecondsAll:g.totalSecondsAll})).sort((f,g)=>g.secondsAllPer60Min-f.secondsAllPer60Min),F=[];for(const[f,g]of x.playerStats)g.totalGameDuration>0&&F.push({id:f,name:g.displayName,per60:g.totalSecondsAll/g.totalGameDuration*3600});F.sort((f,g)=>g.per60-f.per60);const E=F.reduce((f,g)=>f+g.per60,0),z=F.length>0?E/F.length:0,L=F.findIndex(f=>f.id===w)+1,t=F.length,R=t>0?Math.round((1-(L-1)/t)*100):0,I=T;j.forEach(f=>{const g=f.PlayerStats.find(A=>te(A)===w);if(!g)return;const N=fe(f,g);if(N<=0)return;((g.SecondsTalkedOutsideMeeting||0)+(g.SecondsTalkedDuringMeeting||0))/N*3600>=I?(a++,g.Victorious&&o++):(r++,g.Victorious&&l++)});const S={gamesAboveAverage:a,winsAboveAverage:o,winRateAboveAverage:a>0?o/a*100:0,gamesBelowAverage:r,winsBelowAverage:l,winRateBelowAverage:r>0?l/r*100:0};return{playerName:s,gamesPlayed:i,gamesWithTalkingData:x.gamesWithTalkingData,totalSecondsOutside:h,totalSecondsDuring:u,totalSecondsAll:h+u,totalGameDurationSeconds:p,secondsOutsidePer60Min:c,secondsDuringPer60Min:b,secondsAllPer60Min:T,meetingRatio:W,campBreakdown:D,globalAverageSecondsAllPer60Min:z,playerRank:L,totalPlayersWithData:t,percentile:R,roleBreakdown:M,winCorrelation:S}}function St(s,d){return s?s.roleBreakdown.slice(0,d):[]}function Nt(s){const{data:d,isLoading:x,error:j}=ve(w=>s?wt(s,w):null);return{data:d,isLoading:x,error:j}}function Tt({selectedPlayerName:s}){const{data:d,isLoading:x,error:j}=Nt(s),w=oe(),[i,h]=k.useState("both"),u=k.useMemo(()=>d?.campBreakdown?d.campBreakdown.map(r=>({camp:r.camp,"Hors r√©union":Math.round(r.secondsOutsidePer60Min),"En r√©union":Math.round(r.secondsDuringPer60Min),total:Math.round(r.secondsAllPer60Min),gamesPlayed:r.gamesPlayed,meetingRatio:r.meetingRatio.toFixed(1)})):[],[d]),p=k.useMemo(()=>d?[{name:"En r√©union",value:d.totalSecondsDuring,fill:"#2196F3"},{name:"Hors r√©union",value:d.totalSecondsOutside,fill:"#FF9800"}]:[],[d]);if(x)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(j)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",j]});if(!d)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donn√©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donn√©es de temps de parole ne sont disponibles que pour les parties r√©centes."})]});const m=d.secondsAllPer60Min-d.globalAverageSecondsAllPer60Min,n=d.globalAverageSecondsAllPer60Min>0?(m/d.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",a=m>0,o=d.winCorrelation.winRateAboveAverage-d.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üé§ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:re(d.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:a?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[a?"+":"",n,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üìä Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",d.playerRank," / ",d.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-d.percentile+1,"% ",d.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üìà Parties analys√©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:d.gamesPlayed}),e.jsxs("p",{children:["sur ",d.gamesWithTalkingData," avec donn√©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üó£Ô∏è Ratio en r√©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[d.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),u.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(Y,{title:"Temps de parole par camp (par 60min de jeu)",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>h("meeting"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:i==="meeting"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:i==="meeting"?"var(--accent-primary)":"var(--bg-secondary)",color:i==="meeting"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:i==="meeting"?"bold":"normal"},children:"En r√©union"}),e.jsx("button",{onClick:()=>h("outside"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:i==="outside"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:i==="outside"?"var(--accent-primary)":"var(--bg-secondary)",color:i==="outside"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:i==="outside"?"bold":"normal"},children:"Hors r√©union"}),e.jsx("button",{onClick:()=>h("both"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:i==="both"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:i==="both"?"var(--accent-primary)":"var(--bg-secondary)",color:i==="both"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:i==="both"?"bold":"normal"},children:"Les deux"})]}),e.jsx("div",{style:{height:350},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:u,layout:"vertical",children:[e.jsx(J,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(Q,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:r=>`${Math.floor(r/60)}m`}),e.jsx(X,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(H,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(r,l)=>{const y=typeof r=="number"?r:Number(r);return[Number.isNaN(y)?`${r}`:re(y),l]},labelFormatter:r=>{const l=u.find(y=>y.camp===r);return`${r} (${l?.gamesPlayed||0} parties)`}}),e.jsx(Ae,{}),(i==="both"||i==="outside")&&e.jsx(O,{dataKey:"Hors r√©union",stackId:"talk",fill:"#FF9800"}),(i==="both"||i==="meeting")&&e.jsx(O,{dataKey:"En r√©union",stackId:"talk",fill:"#2196F3"})]})})})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:(()=>{const r=u.find(b=>b.camp==="Villageois"),l=u.find(b=>b.camp==="Loup");if(!r||!l)return e.jsx("p",{children:"üí° Pas assez de donn√©es pour comparer les camps Villageois et Loups."});const y=r.total-l.total,c=l.total>0?(Math.abs(y)/l.total*100).toFixed(0):"0";return y>0?e.jsxs("p",{children:["üí° ",e.jsx("strong",{children:s})," parle"," ",e.jsxs("strong",{style:{color:je("Villageois")},children:[re(y)," de plus (+",c,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Villageois"})," qu'en tant que"," ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]}):y<0?e.jsxs("p",{children:["üí° ",e.jsx("strong",{children:s})," parle"," ",e.jsxs("strong",{style:{color:je("Loup")},children:[re(Math.abs(y))," de plus (+",c,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Loup"})," qu'en tant que"," ",e.jsx("strong",{children:"Villageois"})," (par heure de jeu)."]}):e.jsxs("p",{children:["üí° ",e.jsx("strong",{children:s})," parle exactement autant en tant que"," ",e.jsx("strong",{children:"Villageois"})," qu'en tant que ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(Y,{title:"R√©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(De,{children:[e.jsx(Re,{data:p,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:r=>`${r.name}: ${((r.percent||0)*100).toFixed(1)}%`}),e.jsx(H,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:r=>{const l=typeof r=="number"?r:Number(r);return Number.isNaN(l)?`${r}`:re(l)}})]})})})})}),d&&d.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(Y,{title:r=>r?"Top 15 r√¥les les plus bavards (par 60min)":"Top 5 r√¥les les plus bavards (par 60min)",children:r=>{const y=St(d,r?15:5).map(c=>({role:c.role,secondsPer60Min:Math.round(c.secondsAllPer60Min),gamesPlayed:c.gamesPlayed}));return e.jsx("div",{style:{height:r?400:300},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:y,children:[e.jsx(J,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(Q,{dataKey:"role",tick:{fill:"var(--text-primary)",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(X,{tick:{fill:"var(--text-secondary)"},tickFormatter:c=>`${Math.floor(c/60)}m`}),e.jsx(H,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:c=>{const b=typeof c=="number"?c:Number(c);return[Number.isNaN(b)?`${c}`:re(b),"Temps de parole"]},labelFormatter:c=>{const b=y.find(T=>T.role===c);return`${c} (${b?.gamesPlayed||0} parties)`}}),e.jsx(O,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",shape:c=>{const{x:b,y:T,width:W,height:D,payload:M}=c,E=w[M.role]||w.Villageois;return e.jsx(ee,{x:b,y:T,width:W,height:D,fill:E})}})]})})})}})}),(d.winCorrelation.gamesAboveAverage>0||d.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"üéØ Corr√©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[d.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",d.winCorrelation.winsAboveAverage,"/",d.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[d.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",d.winCorrelation.winsBelowAverage,"/",d.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(o)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["üí° ",e.jsx("strong",{children:s})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:o>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[o>0?"sup√©rieur":"inf√©rieur"," de ",Math.abs(o).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function Pt({playerTitles:s,titlesLoading:d}){if(d)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des titres..."})]})});if(!s||s.titles.length===0)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-empty",children:[e.jsx("p",{children:"üìú Aucun titre disponible"}),e.jsx("p",{className:"empty-subtitle",children:s?.gamesPlayed?`${s.gamesPlayed} parties jou√©es - minimum 25 parties requises pour obtenir des titres`:"Les titres sont g√©n√©r√©s chaque dimanche pour les joueurs avec 25+ parties en mode modd√©"})]})});const x=[...s.titles].sort((h,u)=>{const p=s.titles.indexOf(h),n=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(h.category||"")?100-(h.percentile||50):h.percentile||50,a=(h.priority||0)*1e3+n*10-p,o=s.titles.indexOf(u),l=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(u.category||"")?100-(u.percentile||50):u.percentile||50;return(u.priority||0)*1e3+l*10-o-a}),j=x.filter(h=>!h.primaryOwner),w=x.filter(h=>h.primaryOwner),i=(h,u)=>{const p=s.primaryTitle?.id===h.id;return e.jsxs("div",{className:`title-card ${h.type} ${p?"primary":""} ${h.primaryOwner?"awarded-elsewhere":""}`,title:`${h.description}${h.percentile!==void 0?`
Meilleur¬∑e que ${h.percentile.toFixed(1)}% des joueurs`:""}`,children:[e.jsx("div",{className:"title-rank",children:u+1}),p&&e.jsx("div",{className:"title-crown",children:"üëë"}),e.jsx("div",{className:"title-emoji",children:h.emoji}),e.jsxs("div",{className:"title-info",children:[e.jsx("div",{className:"title-name",children:h.title}),e.jsx("div",{className:"title-description",children:h.description}),h.percentile!==void 0&&h.type!=="combination"&&e.jsxs("div",{className:"title-percentile",children:["Top ",(100-h.percentile).toFixed(0),"%"]}),e.jsx("div",{className:"title-type-badge",children:h.type==="combination"?"Combo":h.type==="role"?"R√¥le":"Stat"}),!p&&h.primaryOwner&&e.jsxs("div",{className:"title-primary-owner",children:["üë§ Titre principal de: ",e.jsx("strong",{children:h.primaryOwner})]}),h.type==="combination"&&h.conditions&&h.conditions.length>0&&e.jsxs("div",{className:"title-conditions-breakdown",children:[e.jsx("div",{className:"breakdown-header",children:"Conditions:"}),h.conditions.map((m,n)=>e.jsxs("div",{className:"condition-item",children:[e.jsxs("span",{className:"condition-stat",children:[m.stat==="winRate"?"Victoires":m.stat==="loot"?"R√©colte":m.stat==="lootVillageois"?"R√©colte (Villageois)":m.stat==="lootLoup"?"R√©colte (Loup)":m.stat==="survival"?"Survie":m.stat==="killRate"?"Kills":m.stat==="talking"?"Parole":m.stat==="talkingOutsideMeeting"?"Parole (hors d√©bats)":m.stat==="talkingDuringMeeting"?"Parole (meeting)":m.stat==="votingAggressive"?"Vote agressif":m.stat==="votingAccuracy"?"Pr√©cision vote":m.stat==="votingFirst"?"Vote rapide":m.stat==="survivalDay1"?"Survie J1":m.stat==="winRateVillageois"?"Victoires Villageois":m.stat==="winRateLoup"?"Victoires Loup":m.stat==="winRateSolo"?"Victoires Solo":m.stat==="hunterAccuracy"?"Pr√©cision cible chasseur":m.stat==="hunterShotAccuracy"?"Pr√©cision tir chasseur":m.stat==="zoneVillagePrincipal"?"Village Principal":m.stat==="zoneFerme"?"Ferme":m.stat==="zoneVillagePecheur"?"Village P√™cheur":m.stat==="zoneRuines"?"Ruines":m.stat==="zoneResteCarte"?"Reste de la carte":m.stat==="zoneDominantPercentage"?"Dominance zone":m.stat,":"]}),e.jsx("span",{className:`condition-category ${m.category?.toLowerCase()}`,children:m.category}),m.actualPercentile!==void 0&&e.jsxs("span",{className:"condition-percentile",children:["(Top ",(100-m.actualPercentile).toFixed(0),"%)"]})]},n))]})]})]},h.id)};return e.jsxs("div",{className:"titles-section",children:[e.jsxs("div",{className:"titles-header",children:[e.jsx("h3",{children:"üè∑Ô∏è Titres actuels"}),e.jsxs("p",{className:"titles-info",children:[s.titles.length," titre",s.titles.length>1?"s":""," ‚Ä¢ ",s.gamesPlayed," parties jou√©es"]})]}),j.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"titles-subsection-header",children:[e.jsxs("h4",{children:["‚ú® Vos Titres (",j.length,")"]}),e.jsx("p",{children:"Titres que vous poss√©dez ou partagez"})]}),e.jsx("div",{className:"titles-grid",children:j.map((h,u)=>i(h,u))})]}),w.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"titles-subsection-header secondary",children:[e.jsxs("h4",{children:["üèñÔ∏è Titres Qualifi√©s (",w.length,")"]}),e.jsx("p",{children:"Vous remplissez les conditions, mais un autre joueur a une meilleure revendication"})]}),e.jsx("div",{className:"titles-grid awarded-elsewhere-grid",children:w.map((h,u)=>i(h,j.length+u))})]})]})}function Jt(){const{settings:s,updateSettings:d}=pe(),{navigateToGameDetails:x,navigationState:j,updateNavigationState:w}=ne(),{data:i,isLoading:h,error:u}=We(),{joueursData:p,isLoading:m}=ue(),{data:n,isLoading:a,error:o}=it(s.highlightedPlayer),{playerData:r,isLoading:l}=ot(s.highlightedPlayer),y=ge(p),[c,b]=k.useState(""),[T,W]=k.useState(null),{clips:D}=tt(s.highlightedPlayer),{clips:M}=st(),[F,E]=k.useState(()=>s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled?s.independentFilters.gameFilter==="modded"?"modded":"all":s.gameFilter==="modded"?"modded":"all"),z=k.useMemo(()=>s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled?s.independentFilters.gameFilter==="modded":s.gameFilter==="modded",[s.useIndependentFilters,s.independentFilters?.gameTypeEnabled,s.independentFilters?.gameFilter,s.gameFilter]),[L,t]=k.useState(s.selectedPlayerSelectionView||j.selectedPlayerSelectionView||"rankings"),[R,I]=k.useState("session"),[S,f]=k.useState("all");k.useEffect(()=>{if(s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled){const C=s.independentFilters.gameFilter==="modded"?"modded":"all";E(C)}else if(!s.useIndependentFilters){const C=s.gameFilter==="modded"?"modded":"all";E(C)}},[s.gameFilter,s.useIndependentFilters,s.independentFilters?.gameTypeEnabled,s.independentFilters?.gameFilter]),k.useEffect(()=>{z&&F!=="modded"&&E("modded")},[z,F]),k.useEffect(()=>{const C=s.selectedPlayerSelectionView||j.selectedPlayerSelectionView;C&&C!==L&&t(C)},[s.selectedPlayerSelectionView,j.selectedPlayerSelectionView]);const{data:g}=xe(s.highlightedPlayer||""),N=k.useMemo(()=>{if(!i||!i.GameStats)return[];const C=z?i.GameStats.filter(V=>V.Modded===!0):i.GameStats,q=new Map;return C.forEach(V=>{const G=new Date(V.StartDate);V.PlayerStats.forEach(_=>{const U=te(_),Me=p?.Players?.find(Fe=>Fe.SteamID===U)?.Joueur||_.Username;q.has(U)||q.set(U,{games:0,wins:0,firstDate:G,lastDate:G,displayName:Me});const se=q.get(U);se.games++,_.Victorious&&se.wins++,G<se.firstDate&&(se.firstDate=G),G>se.lastDate&&(se.lastDate=G)})}),Array.from(q.entries()).map(([V,G])=>{let _=p?.Players?.find(U=>U.SteamID===V);return _||(_=p?.Players?.find(U=>U.Joueur===G.displayName)),{id:V,name:G.displayName,totalGames:G.games,totalWins:G.wins,winRate:G.games>0?G.wins/G.games*100:0,firstGameDate:G.firstDate.toLocaleDateString("fr-FR"),lastGameDate:G.lastDate.toLocaleDateString("fr-FR"),isHighlighted:G.displayName===s.highlightedPlayer,image:_?.Image||null,twitch:_?.Twitch||null,youtube:_?.Youtube||null}})},[i,s.highlightedPlayer,p,z]),v=k.useMemo(()=>{if(!c.trim())return N;const C=c.toLowerCase();return N.filter(q=>q.name.toLowerCase().includes(C))},[N,c]),P=k.useMemo(()=>[...v].sort((C,q)=>q.totalGames-C.totalGames),[v]),A=C=>{d({highlightedPlayer:C}),b("")},$=C=>{t(C),w({selectedPlayerSelectionView:C}),d({selectedPlayerSelectionView:C,tab:"playerSelection"})},B=()=>{if(D.length===0)return;const C=Math.floor(Math.random()*D.length);W(D[C])};return h||m?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):u?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donn√©es des joueurs: ",u]})]}):!i||N.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donn√©e disponible"}),e.jsx("p",{children:"Aucun joueur trouv√© dans les donn√©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!s.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"S√©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en √©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:c,onChange:C=>b(C.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"üîç"})]}),e.jsxs("div",{className:"player-count",children:[v.length," joueur",v.length!==1?"s":"",c&&` (filtr√©${v.length!==1?"s":""} de ${N.length})`]})]})]}),e.jsx("div",{className:"player-display",children:c?v.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"R√©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>b(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:P.map(C=>e.jsxs("button",{type:"button",className:`suggestion-btn ${C.isHighlighted?"highlighted":""}`,onClick:()=>A(C.name),children:[C.image?e.jsx("img",{src:C.image,alt:`Photo de profil de ${C.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":y[C.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[C.name,C.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" ‚òÖ"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[C.totalGames," parties ‚Ä¢ ",C.winRate.toFixed(1),"% victoires"]})]})]},C.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouv√© pour "',c,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>b(""),children:"Effacer la recherche"})]}):s.highlightedPlayer?(()=>{const C=N.find(q=>q.name===s.highlightedPlayer);return C?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:C.name}),e.jsx("span",{className:"highlight-badge",children:"‚òÖ Mis en √©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[C.image?e.jsx("img",{src:C.image,alt:`Photo de profil de ${C.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":y[C.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[C.totalGames," parties ‚Ä¢ ",C.totalWins," victoires ‚Ä¢ ",C.winRate.toFixed(1),"% taux de victoire"]}),r?.primaryTitle?e.jsxs("div",{className:"player-primary-title",title:r.primaryTitle.description,style:{marginTop:"0.5rem",display:"inline-flex",alignItems:"center",gap:"0.3rem",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("span",{className:"title-emoji",children:r.primaryTitle.emoji}),e.jsx("span",{className:"title-text",children:r.primaryTitle.title})]}):e.jsx("div",{className:"player-no-title",style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic"},children:"üìú 25 parties modd√©es minimum pour obtenir un titre"}),(C.twitch||C.youtube||D.length>0)&&e.jsxs("div",{className:"social-links",children:[C.twitch&&e.jsx("a",{href:C.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"üì∫ Twitch"}),C.youtube&&e.jsx("a",{href:C.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"üé¨ YouTube"}),D.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:q=>{q.stopPropagation(),B()},title:`${D.length} clip${D.length>1?"s":""} disponible${D.length>1?"s":""}`,children:["üé¨ Clip al√©atoire (",D.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="rankings"?"active":""}`,onClick:()=>$("rankings"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="titles"?"active":""}`,onClick:()=>$("titles"),children:"Titres"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="evolution"?"active":""}`,onClick:()=>$("evolution"),children:"√âvolution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="camps"?"active":""}`,onClick:()=>$("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="roles"?"active":""}`,onClick:()=>$("roles"),children:"R√¥les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="actions"?"active":""}`,onClick:()=>$("actions"),children:"Actions"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="roleactions"?"active":""}`,onClick:()=>$("roleactions"),children:"Actions des R√¥les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="kills"?"active":""}`,onClick:()=>$("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="deathmap"?"active":""}`,onClick:()=>$("deathmap"),children:"Cartes"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="talkingtime"?"active":""}`,onClick:()=>$("talkingtime"),children:"Parole"})]}),L==="rankings"&&e.jsxs("div",{className:"rankings-section",children:[a?e.jsxs("div",{className:"rankings-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):o?e.jsx("div",{className:"rankings-error",children:e.jsxs("p",{children:["‚ùå Erreur lors du chargement des classements: ",o]})}):n?e.jsx(lt,{rankings:F==="all"?n.allGamesRankings:n.moddedOnlyRankings,title:F==="all"?"Classements - Toutes les parties":"Classements - Parties modd√©es",emptyMessage:"Aucun classement dans cette cat√©gorie",rankingType:F}):e.jsx("div",{className:"rankings-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"rankings-filter",children:[!z&&e.jsx("button",{type:"button",className:`filter-btn ${F==="all"?"active":""}`,onClick:q=>{q.stopPropagation(),E("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${F==="modded"?"active":""}`,onClick:q=>{q.stopPropagation(),E("modded")},disabled:z,children:"Parties modd√©es"})]})]}),L==="titles"&&e.jsx(Pt,{playerTitles:r,titlesLoading:l}),L==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[g&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{x({selectedPlayer:C.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${C.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:g.totalGames}),e.jsx("p",{children:"parties jou√©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumul√©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:Ve(g.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{x({selectedPlayer:C.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${C.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:g.totalWins}),e.jsx("p",{children:"parties gagn√©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[g.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:R,onChange:q=>I(q.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par ann√©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:S,onChange:q=>f(q.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"R√¥les solo"})]})]})]}),e.jsx(ct,{selectedPlayerName:C.name,groupingMethod:R,campFilter:S})]}),L==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(dt,{selectedPlayerName:C.name})}),L==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(pt,{selectedPlayerName:C.name})}),L==="actions"&&e.jsx("div",{className:"player-history-section",children:e.jsx(xt,{selectedPlayerName:C.name})}),L==="roleactions"&&e.jsx("div",{className:"player-history-section",children:e.jsx(yt,{selectedPlayerName:C.name})}),L==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ut,{selectedPlayerName:C.name})}),L==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(bt,{selectedPlayerName:C.name})}),L==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Tt,{selectedPlayerName:C.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:q=>{q.stopPropagation(),d({highlightedPlayer:null})},children:"‚òÖ Retirer la mise en √©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"P√©riode d'activit√©:"}),e.jsxs("span",{className:"period-range",children:[C.firstGameDate," - ",C.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',s.highlightedPlayer,`" n'a pas √©t√© trouv√© dans les donn√©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>d({highlightedPlayer:null}),children:"Effacer la s√©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:P.map(C=>e.jsxs("div",{className:`character-card ${C.isHighlighted?"highlighted":""}`,onClick:()=>A(C.name),title:`${C.name} - ${C.totalGames} parties, ${C.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:C.image?e.jsx("img",{src:C.image,alt:`Photo de profil de ${C.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":y[C.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:C.name}),(C.twitch||C.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[C.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),C.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},C.id))})})}),T&&e.jsx(rt,{clip:T,onClose:()=>W(null),relatedClips:at(T,M),nextClip:we(T,M),onNextClip:()=>{const C=we(T,M);C&&W(C)},onRelatedClip:C=>{const q=M.find(V=>V.ClipId===C);q&&W(q)}})]})}export{Jt as PlayerSelectionPage};
