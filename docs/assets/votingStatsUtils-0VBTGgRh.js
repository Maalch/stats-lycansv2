import{g as B,a as b}from"./datasyncExport-CjB7UYqV.js";import{D as x}from"./deathTypes-gHH1w6_X.js";import{g as w}from"./index-ColEv0iT.js";function $(l,f){if(!l.DeathTiming)return!0;const m=l.DeathTiming.toUpperCase();if(m.startsWith("M")){const y=parseInt(m.substring(1));return f<=y}if(m.startsWith("N")||m.startsWith("J")){const y=parseInt(m.substring(1));return f<y}return!0}function W(l,f){return l.PlayerStats.filter(m=>$(m,f))}function N(l,f,m){const y=l.PlayerStats.find(V=>w(V)===m);return y?y.DeathType===x.VOTED&&y.DeathTiming===`M${f}`:!1}function G(l){const f=[],m=new Map,y=new Map,V=new Map;l.PlayerStats.forEach(r=>{const n=w(r),T=r.Username;m.set(n,{totalMeetings:0,totalVotes:0,totalSkips:0,totalAbstentions:0,displayName:T}),y.set(n,{totalVotes:0,votesForEnemyCamp:0,votesForOwnCamp:0}),V.set(n,{totalTimesTargeted:0,timesTargetedByEnemyCamp:0,timesTargetedByOwnCamp:0,timesTargetedAsVillager:0,timesTargetedAsWolf:0,timesTargetedAsSpecial:0,eliminationsByVote:0})});const S=Math.max(...l.PlayerStats.flatMap(r=>r.Votes.map(n=>n.Day||0)),0);for(let r=1;r<=S;r++){const n=W(l,r),T=l.PlayerStats.flatMap(o=>{const s=w(o);return o.Votes.filter(M=>M.Day===r).map(M=>({voterId:s,voterName:o.Username,vote:M,voterRole:o.MainRoleInitial}))});if(T.length===0&&l.EndTiming===`M${r}`)continue;const g=T.filter(o=>o.vote.Target!=="Passé").length,p=T.filter(o=>o.vote.Target==="Passé").length,e=n.length-T.length,t=new Map;T.filter(o=>o.vote.Target!=="Passé").forEach(o=>{const s=t.get(o.vote.Target)||0;t.set(o.vote.Target,s+1)});let a=null,i=0;for(const[o,s]of t.entries())s>i&&(a=o,i=s);let A=null;if(a&&i>0){const o=l.PlayerStats.find(s=>s.Username===a);if(o){const s=w(o);N(l,r,s)&&(A=o.Username)}}f.push({meetingNumber:r,totalParticipants:n.length,totalVotes:g,totalSkips:p,totalAbstentions:e,participationRate:n.length>0?(g+p)/n.length*100:0,mostTargetedPlayer:a,mostTargetedCount:i,eliminatedPlayer:A}),n.forEach(o=>{const s=w(o),M=m.get(s);M.totalMeetings++,M.displayName=o.Username;const E=T.find(h=>h.voterId===s);if(E)if(E.vote.Target==="Passé")M.totalSkips++;else{M.totalVotes++;const h=y.get(s);h.totalVotes++;const F=B(b(o.MainRoleInitial,o.MainRoleChanges||[]),{regroupWolfSubRoles:!0}),c=l.PlayerStats.find(v=>v.Username===E.vote.Target);if(c){const v=w(c),O=B(b(c.MainRoleInitial,c.MainRoleChanges||[]),{regroupWolfSubRoles:!0});F===O?h.votesForOwnCamp++:h.votesForEnemyCamp++;const u=V.get(v);u.totalTimesTargeted++,F===O?u.timesTargetedByOwnCamp++:u.timesTargetedByEnemyCamp++;const P=b(c.MainRoleInitial,c.MainRoleChanges||[]),k=B(P,{regroupWolfSubRoles:!0});k==="Villageois"?u.timesTargetedAsVillager++:k==="Loup"?u.timesTargetedAsWolf++:u.timesTargetedAsSpecial++,N(l,r,v)&&u.eliminationsByVote++}}else M.totalAbstentions++})}const d=[],C=[],R=[];return l.PlayerStats.forEach(r=>{const n=w(r),T=r.Username,g=m.get(n),p=g.totalMeetings>0?g.totalVotes/g.totalMeetings*100:0,e=g.totalMeetings>0?g.totalSkips/g.totalMeetings*100:0,t=g.totalMeetings>0?g.totalAbstentions/g.totalMeetings*100:0,a=p-e*.5-t*.7;d.push({playerName:T,totalMeetings:g.totalMeetings,totalVotes:g.totalVotes,totalSkips:g.totalSkips,totalAbstentions:g.totalAbstentions,votingRate:p,skippingRate:e,abstentionRate:t,aggressivenessScore:a});const i=y.get(n),A=i.totalVotes>0?i.votesForEnemyCamp/i.totalVotes*100:0,o=i.totalVotes>0?i.votesForOwnCamp/i.totalVotes*100:0;C.push({playerName:T,totalMeetings:g.totalMeetings,totalVotes:i.totalVotes,votesForEnemyCamp:i.votesForEnemyCamp,votesForOwnCamp:i.votesForOwnCamp,accuracyRate:A,friendlyFireRate:o});const s=V.get(n),M=s.totalTimesTargeted>0?(s.totalTimesTargeted-s.eliminationsByVote)/s.totalTimesTargeted*100:100;R.push({playerName:T,totalMeetings:g.totalMeetings,totalTimesTargeted:s.totalTimesTargeted,timesTargetedByEnemyCamp:s.timesTargetedByEnemyCamp,timesTargetedByOwnCamp:s.timesTargetedByOwnCamp,timesTargetedAsVillager:s.timesTargetedAsVillager,timesTargetedAsWolf:s.timesTargetedAsWolf,timesTargetedAsSpecial:s.timesTargetedAsSpecial,eliminationsByVote:s.eliminationsByVote,survivalRate:M})}),{gameId:l.Id,totalMeetings:S,meetingAnalytics:f,playerBehaviors:d,playerAccuracies:C,playerTargetStats:R}}function Y(l){const f=new Map,m=new Map;let y=0,V=0,S=0,d=0,C=0,R=0,r=0,n=0;l.forEach(p=>{const e=Math.max(...p.PlayerStats.flatMap(t=>t.Votes.map(a=>a.Day)),0);if(e!==0)for(let t=1;t<=e;t++){const a=W(p,t),i=p.PlayerStats.flatMap(c=>c.Votes.filter(v=>v.Day===t).map(v=>({voter:c.Username,vote:v,voterStats:c})));if(i.length===0&&p.EndTiming===`M${t}`)continue;const A=i.filter(c=>c.vote.Target!=="Passé").length,o=i.filter(c=>c.vote.Target==="Passé").length,s=a.length-i.length;y++,V+=A,S+=o,d+=s;const M=a.length>0?A/a.length*100:0,E=a.length>0?o/a.length*100:0,h=a.length>0?s/a.length*100:0;C+=M,R+=E,r+=h,n++;const F=f.get(t)||{meetings:0,totalVotingRates:0,totalSkipRates:0,totalAbstentionRates:0};F.meetings++,F.totalVotingRates+=M,F.totalSkipRates+=E,F.totalAbstentionRates+=h,f.set(t,F),i.filter(c=>c.vote.Target!=="Passé").forEach(({voterStats:c,vote:v})=>{const O=b(c.MainRoleInitial,c.MainRoleChanges||[]),u=B(O,{regroupWolfSubRoles:!0}),P=p.PlayerStats.find(U=>U.Username===v.Target);if(!P)return;const k=b(P.MainRoleInitial,P.MainRoleChanges||[]),D=B(k,{regroupWolfSubRoles:!0}),I=m.get(u)||{totalVotes:0,votesForOppositeCamp:0,votesForOwnCamp:0};I.totalVotes++,u===D?I.votesForOwnCamp++:I.votesForOppositeCamp++,m.set(u,I)})}});const T=Array.from(f.entries()).map(([p,e])=>({meetingDay:p,totalMeetings:e.meetings,averageVotingRate:e.meetings>0?e.totalVotingRates/e.meetings:0,averageSkipRate:e.meetings>0?e.totalSkipRates/e.meetings:0,averageAbstentionRate:e.meetings>0?e.totalAbstentionRates/e.meetings:0})).sort((p,e)=>p.meetingDay-e.meetingDay),g=Array.from(m.entries()).map(([p,e])=>({campName:p,totalVotes:e.totalVotes,votesForOppositeCamp:e.votesForOppositeCamp,votesForOwnCamp:e.votesForOwnCamp,accuracyRate:e.totalVotes>0?e.votesForOppositeCamp/e.totalVotes*100:0,friendlyFireRate:e.totalVotes>0?e.votesForOwnCamp/e.totalVotes*100:0})).sort((p,e)=>e.accuracyRate-p.accuracyRate);return{totalMeetings:y,totalVotes:V,totalSkips:S,totalAbstentions:d,averageVotingRate:n>0?C/n:0,averageSkipRate:n>0?R/n:0,averageAbstentionRate:n>0?r/n:0,meetingDayStats:T,campVotingStats:g}}function _(l){const f=l.map(G),m=new Map,y=new Map,V=new Map;let S=0,d=0,C=0,R=0,r=0,n=0;f.forEach(e=>{S+=e.totalMeetings,e.meetingAnalytics.forEach(t=>{d+=t.participationRate,C++,R+=t.totalVotes,r+=t.totalSkips,n+=t.totalAbstentions}),e.playerBehaviors.forEach(t=>{const a=m.get(t.playerName)||{totalMeetings:0,totalVotes:0,totalSkips:0,totalAbstentions:0};m.set(t.playerName,{totalMeetings:a.totalMeetings+t.totalMeetings,totalVotes:a.totalVotes+t.totalVotes,totalSkips:a.totalSkips+t.totalSkips,totalAbstentions:a.totalAbstentions+t.totalAbstentions})}),e.playerAccuracies.forEach(t=>{const a=y.get(t.playerName)||{totalMeetings:0,totalVotes:0,votesForEnemyCamp:0,votesForOwnCamp:0};y.set(t.playerName,{totalMeetings:a.totalMeetings+t.totalMeetings,totalVotes:a.totalVotes+t.totalVotes,votesForEnemyCamp:a.votesForEnemyCamp+t.votesForEnemyCamp,votesForOwnCamp:a.votesForOwnCamp+t.votesForOwnCamp})}),e.playerTargetStats.forEach(t=>{const a=V.get(t.playerName)||{totalMeetings:0,totalTimesTargeted:0,timesTargetedByEnemyCamp:0,timesTargetedByOwnCamp:0,timesTargetedAsVillager:0,timesTargetedAsWolf:0,timesTargetedAsSpecial:0,eliminationsByVote:0};V.set(t.playerName,{totalMeetings:a.totalMeetings+t.totalMeetings,totalTimesTargeted:a.totalTimesTargeted+t.totalTimesTargeted,timesTargetedByEnemyCamp:a.timesTargetedByEnemyCamp+t.timesTargetedByEnemyCamp,timesTargetedByOwnCamp:a.timesTargetedByOwnCamp+t.timesTargetedByOwnCamp,timesTargetedAsVillager:a.timesTargetedAsVillager+t.timesTargetedAsVillager,timesTargetedAsWolf:a.timesTargetedAsWolf+t.timesTargetedAsWolf,timesTargetedAsSpecial:a.timesTargetedAsSpecial+t.timesTargetedAsSpecial,eliminationsByVote:a.eliminationsByVote+t.eliminationsByVote})})});const T=Array.from(m.entries()).map(([e,t])=>{const a=t.totalMeetings>0?t.totalVotes/t.totalMeetings*100:0,i=t.totalMeetings>0?t.totalSkips/t.totalMeetings*100:0,A=t.totalMeetings>0?t.totalAbstentions/t.totalMeetings*100:0,o=a-i*.5-A*.7;return{playerName:e,totalMeetings:t.totalMeetings,totalVotes:t.totalVotes,totalSkips:t.totalSkips,totalAbstentions:t.totalAbstentions,votingRate:a,skippingRate:i,abstentionRate:A,aggressivenessScore:o}}),g=Array.from(y.entries()).map(([e,t])=>{const a=t.totalVotes>0?t.votesForEnemyCamp/t.totalVotes*100:0,i=t.totalVotes>0?t.votesForOwnCamp/t.totalVotes*100:0;return{playerName:e,totalMeetings:t.totalMeetings,totalVotes:t.totalVotes,votesForEnemyCamp:t.votesForEnemyCamp,votesForOwnCamp:t.votesForOwnCamp,accuracyRate:a,friendlyFireRate:i}}),p=Array.from(V.entries()).map(([e,t])=>{const a=t.totalTimesTargeted>0?(t.totalTimesTargeted-t.eliminationsByVote)/t.totalTimesTargeted*100:100;return{playerName:e,totalMeetings:t.totalMeetings,totalTimesTargeted:t.totalTimesTargeted,timesTargetedByEnemyCamp:t.timesTargetedByEnemyCamp,timesTargetedByOwnCamp:t.timesTargetedByOwnCamp,timesTargetedAsVillager:t.timesTargetedAsVillager,timesTargetedAsWolf:t.timesTargetedAsWolf,timesTargetedAsSpecial:t.timesTargetedAsSpecial,eliminationsByVote:t.eliminationsByVote,survivalRate:a}});return{playerBehaviorStats:T,playerAccuracyStats:g,playerTargetStats:p,overallMeetingStats:{totalMeetings:S,averageParticipationRate:C>0?d/C:0,totalVotes:R,totalSkips:r,totalAbstentions:n}}}export{Y as a,_ as c};
