import{r as o,j as e}from"./index-yh1T7mqv.js";import{R as m,C as g,T as u}from"./CategoricalChart-8kLdSpOg.js";import{P as j,a as y}from"./PieChart-BxYfNg7c.js";import{L as x}from"./Legend-Bk5rhxFg.js";import{B as p,C as b,X as f,Y as N,a as R}from"./BarChart-DnXnp5-h.js";function D(){const[t,l]=o.useState(null),[i,a]=o.useState(!0),[c,r]=o.useState(null);return o.useEffect(()=>{(async()=>{try{a(!0),r(null);const d=await fetch("https://script.google.com/macros/s/AKfycbxrhG1mb7N6q7Mg88ogw0mirXgSihPpNPurZwiEOy9miG24Cc3AlGZCn2uoGnygNhck/exec?action=harvestStats");if(!d.ok)throw new Error(`Problème serveur: ${d.statusText}`);const h=await d.json();if(h.error)throw new Error(h.error);l(h)}catch(n){console.error("Échec du chargement des données de récolte:",n),r(n instanceof Error?n.message:"Erreur pendant le chargement")}finally{a(!1)}})()},[]),{harvestStats:t,isLoading:i,errorMessage:c}}const v=["#d32f2f","#f57c00","#fbc02d","#388e3c","#1976d2"];function L(){const{harvestStats:t,isLoading:l,errorMessage:i}=D();if(l)return e.jsx("div",{className:"donnees-chargement",children:"Récupération des données de récolte..."});if(i)return e.jsxs("div",{className:"donnees-erreur",children:["Problème: ",i]});if(!t)return e.jsx("div",{className:"donnees-absentes",children:"Données de récolte non disponibles"});const a=[{nom:"0-25%",valeur:t.harvestDistribution["0-25%"]},{nom:"26-50%",valeur:t.harvestDistribution["26-50%"]},{nom:"51-75%",valeur:t.harvestDistribution["51-75%"]},{nom:"76-99%",valeur:t.harvestDistribution["76-99%"]},{nom:"100%",valeur:t.harvestDistribution["100%"]}],c=Object.entries(t.harvestByWinner).map(([r,s])=>({camp:r,moyenne:parseFloat(s.average)})).sort((r,s)=>s.moyenne-r.moyenne);return e.jsxs("div",{className:"lycans-recolte-stats",children:[e.jsx("h2",{children:"Statistiques de Récolte"}),e.jsxs("div",{className:"lycans-recolte-sommaire",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Moyenne de Récolte"}),e.jsxs("p",{className:"lycans-nombre-grand",children:[t.averageHarvestPercent,"%"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Nombre total de parties"}),e.jsx("p",{className:"lycans-nombre-grand",children:t.gamesWithHarvest})]})]}),e.jsxs("div",{className:"lycans-graphiques-conteneur",children:[e.jsxs("div",{className:"lycans-graphique-moitie",children:[e.jsx("h3",{children:"Distribution des Récoltes"}),e.jsx("div",{style:{height:300},children:e.jsx(m,{width:"100%",height:"100%",children:e.jsxs(j,{children:[e.jsx(y,{data:a,cx:"50%",cy:"50%",labelLine:!0,label:({nom:r,percent:s})=>`${r}: ${((s??0)*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"valeur",nameKey:"nom",children:a.map((r,s)=>e.jsx(g,{fill:v[s%v.length]},`cellule-${s}`))}),e.jsx(u,{content:({active:r,payload:s})=>{if(r&&s&&s.length>0){const n=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:n.nom})}),e.jsxs("div",{children:["Nombre de parties : ",n.valeur]})]})}return null}}),e.jsx(x,{})]})})})]}),e.jsxs("div",{className:"lycans-graphique-moitie",children:[e.jsx("h3",{children:"Moyenne de Récolte au Moment de la Victoire"}),e.jsx("div",{style:{height:300},children:e.jsx(m,{width:"100%",height:"100%",children:e.jsxs(p,{data:c,margin:{top:20,right:30,left:20,bottom:70},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(f,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(N,{label:{value:"Moyenne de Récolte (%)",angle:-90,position:"insideLeft"}}),e.jsx(u,{content:({active:r,payload:s})=>{if(r&&s&&s.length>0){const n=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:n.camp}),e.jsxs("div",{children:["Moyenne de Récolte : ",n.moyenne,"%"]})]})}return null}}),e.jsx(x,{}),e.jsx(R,{dataKey:"moyenne",name:"Moyenne de Récolte",fill:"#388e3c"})]})})})]})]})]})}export{L as HarvestProgressChart};
