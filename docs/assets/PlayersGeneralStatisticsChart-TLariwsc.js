import{r as h,u as _,a as ee,j as e}from"./index-D3y5RarH.js";import{u as ie}from"./usePlayerStatsFromRaw-CB1vVUfO.js";import{u as te,m as re}from"./api-CbkbkBNM.js";import{c as ae,r as ne,F as H,B as L,C as M,X as B,Y as V,a as q,b as G}from"./FullscreenChart-Cn07BDvX.js";import{u as le,a as se,r as oe,b as ce,c as de,d as F,s as he,e as ge,f as $,g as ue,h as ye,L as me,i as pe,j as fe,k as K,l as X,R as Y,T as J}from"./CategoricalChart-D5pBdCkx.js";import"./baseStatsHook-BI_CJweY.js";function Q(i,a){var n=Object.keys(i);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(i);a&&(o=o.filter(function(l){return Object.getOwnPropertyDescriptor(i,l).enumerable})),n.push.apply(n,o)}return n}function U(i){for(var a=1;a<arguments.length;a++){var n=arguments[a]!=null?arguments[a]:{};a%2?Q(Object(n),!0).forEach(function(o){k(i,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach(function(o){Object.defineProperty(i,o,Object.getOwnPropertyDescriptor(n,o))})}return i}function k(i,a,n){return(a=xe(a))in i?Object.defineProperty(i,a,{value:n,enumerable:!0,configurable:!0,writable:!0}):i[a]=n,i}function xe(i){var a=ve(i,"string");return typeof a=="symbol"?a:a+""}function ve(i,a){if(typeof i!="object"||!i)return i;var n=i[Symbol.toPrimitive];if(n!==void 0){var o=n.call(i,a);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(i)}function D(){return D=Object.assign?Object.assign.bind():function(i){for(var a=1;a<arguments.length;a++){var n=arguments[a];for(var o in n)({}).hasOwnProperty.call(n,o)&&(i[o]=n[o])}return i},D.apply(null,arguments)}var Pe=(i,a)=>{var n;return h.isValidElement(i)?n=h.cloneElement(i,a):typeof i=="function"?n=i(a):n=h.createElement("line",D({},a,{className:"recharts-reference-line-line"})),n},je=(i,a,n,o,l,g,O,f,u)=>{var{x,y,width:A,height:w}=l;if(n){var{y:v}=u,m=i.y.apply(v,{position:g});if(K(m)||u.ifOverflow==="discard"&&!i.y.isInRange(m))return null;var R=[{x:x+A,y:m},{x,y:m}];return f==="left"?R.reverse():R}if(a){var{x:T}=u,P=i.x.apply(T,{position:g});if(K(P)||u.ifOverflow==="discard"&&!i.x.isInRange(P))return null;var t=[{x:P,y:y+w},{x:P,y}];return O==="top"?t.reverse():t}if(o){var{segment:s}=u,r=s.map(c=>i.apply(c,{position:g}));return u.ifOverflow==="discard"&&r.some(c=>!i.isInRange(c))?null:r}return null};function be(i){var a=le();return h.useEffect(()=>(a(se(i)),()=>{a(oe(i))})),null}function Se(i){var{x:a,y:n,segment:o,xAxisId:l,yAxisId:g,shape:O,className:f,ifOverflow:u}=i,x=ce(),y=de(),A=F(p=>he(p,l)),w=F(p=>ge(p,g)),v=F(p=>$(p,"xAxis",l,x)),m=F(p=>$(p,"yAxis",g,x)),R=ue(),T=X(a),P=X(n);if(!y||!R||A==null||w==null||v==null||m==null)return null;var t=ae({x:v,y:m}),s=o&&o.length===2,r=je(t,T,P,s,R,i.position,A.orientation,w.orientation,i);if(!r)return null;var[{x:c,y:j},{x:b,y:W}]=r,I=u==="hidden"?"url(#".concat(y,")"):void 0,C=U(U({clipPath:I},ye(i,!0)),{},{x1:c,y1:j,x2:b,y2:W});return h.createElement(me,{className:pe("recharts-reference-line",f)},Pe(O,C),fe.renderCallByParent(i,ne({x1:c,y1:j,x2:b,y2:W})))}function Ae(i){return h.createElement(h.Fragment,null,h.createElement(be,{yAxisId:i.yAxisId,xAxisId:i.xAxisId,ifOverflow:i.ifOverflow,x:i.x,y:i.y}),h.createElement(Se,i))}class E extends h.Component{render(){return h.createElement(Ae,this.props)}}k(E,"displayName","ReferenceLine");k(E,"defaultProps",{ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function Ce(){const{data:i,isLoading:a,error:n}=ie(),{navigateToGameDetails:o}=_(),{settings:l}=ee(),[g,O]=h.useState(50),[f,u]=h.useState("best"),[x,y]=h.useState(null),A=te(),{participationData:w,winRateData:v,averageWinRate:m,totalEligiblePlayers:R,highlightedPlayerInParticipation:T,highlightedPlayerInWinRate:P}=h.useMemo(()=>{if(!i?.playerStats)return{participationData:[],winRateData:[],averageWinRate:"0",totalEligiblePlayers:0,highlightedPlayerInParticipation:!1,highlightedPlayerInWinRate:!1};const t=i.playerStats,s=[],r=[];let c=0;for(const d of t)c+=parseFloat(d.winPercent),d.gamesPlayed>=g&&s.push(d),d.gamesPlayed>2&&r.push(d);const j=t.length>0?(c/t.length).toFixed(1):"0",b=r.sort((d,S)=>S.gamesPlayed-d.gamesPlayed).slice(0,20),W=l.highlightedPlayer&&b.some(d=>d.player===l.highlightedPlayer);let I=[...b],C=!1;if(l.highlightedPlayer&&!W){const d=r.find(S=>S.player===l.highlightedPlayer);d&&(I.push({...d,isHighlightedAddition:!0}),C=!0)}const p=s.sort((d,S)=>f==="best"?parseFloat(S.winPercent)-parseFloat(d.winPercent):parseFloat(d.winPercent)-parseFloat(S.winPercent)).slice(0,20),Z=l.highlightedPlayer&&p.some(d=>d.player===l.highlightedPlayer);let N=[...p],z=!1;if(l.highlightedPlayer&&!Z){const d=t.find(S=>S.player===l.highlightedPlayer);d&&(N.push({...d,isHighlightedAddition:!0}),z=!0)}return{participationData:I,winRateData:N,averageWinRate:j,totalEligiblePlayers:s.length,highlightedPlayerInParticipation:C,highlightedPlayerInWinRate:z}},[i,g,f,l.highlightedPlayer]);return a?e.jsx("div",{className:"donnees-attente",children:"Récupération des statistiques des joueurs..."}):n?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",n]}):i?e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques des Joueurs"}),e.jsxs("p",{className:"lycans-stats-info",children:["Total de ",i.totalGames," parties analysées avec ",i.playerStats.length," joueurs"]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Top Participations"}),T&&l.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['🎯 "',l.highlightedPlayer,'" affiché en plus du top 20']})]}),e.jsx(H,{title:"Top Participations",children:e.jsx("div",{style:{height:400},children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(L,{data:w,margin:{top:20,right:30,left:20,bottom:10},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(B,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:s,payload:r})=>e.jsx("text",{x:t,y:s,dy:16,textAnchor:"end",fill:l.highlightedPlayer===r.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:l.highlightedPlayer===r.value?14:13,fontWeight:l.highlightedPlayer===r.value?"bold":"italic",transform:`rotate(-45 ${t} ${s})`,children:r.value})}),e.jsx(V,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(J,{content:({active:t,payload:s})=>{if(t&&s&&s.length>0){const r=s[0].payload,c=r.isHighlightedAddition,j=l.highlightedPlayer===r.player;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:r.player})}),e.jsxs("div",{children:["Parties jouées : ",r.gamesPlayed]}),e.jsxs("div",{children:["Pourcentage : ",r.gamesPlayedPercent,"%"]}),c&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection personnelle"}),j&&!c&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(q,{dataKey:"gamesPlayed",name:"Parties jouées",fill:"#00C49F",children:w.map(t=>{const s=l.highlightedPlayer===t.player,r=x===t.player,c=t.isHighlightedAddition;return e.jsx(G,{fill:A[t.player]||"#00C49F",stroke:s?"var(--accent-primary)":r?"var(--text-primary)":"none",strokeWidth:s?3:r?2:0,strokeDasharray:c?"5,5":"none",opacity:c?.8:1,onClick:()=>{o({selectedPlayer:t.player,fromComponent:"Statistiques Joueurs"})},onMouseEnter:()=>y(t.player),onMouseLeave:()=>y(null),style:{cursor:"pointer"}},`cell-participation-${t.player}`)})})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("h3",{children:f==="best"?"Meilleurs Taux de Victoire":"Moins Bon Taux de Victoire"}),P&&l.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0"},children:['🎯 "',l.highlightedPlayer,'" affiché en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"min-games-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select",value:g,onChange:t=>O(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:re.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsxs("select",{value:f,onChange:t=>u(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"best",children:"Meilleurs Taux de Victoire"}),e.jsx("option",{value:"worst",children:"Moins Bon Taux de Victoire"})]})]})]}),e.jsx(H,{title:f==="best"?"Meilleurs Taux de Victoire":"Moins Bon Taux de Victoire",children:e.jsx("div",{style:{height:400},children:e.jsx(Y,{width:"100%",height:"100%",children:e.jsxs(L,{data:v,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(B,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:s,payload:r})=>e.jsx("text",{x:t,y:s,dy:16,textAnchor:"end",fill:l.highlightedPlayer===r.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:l.highlightedPlayer===r.value?14:13,fontWeight:l.highlightedPlayer===r.value?"bold":"italic",transform:`rotate(-45 ${t} ${s})`,children:r.value})}),e.jsx(V,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(J,{content:({active:t,payload:s})=>{if(t&&s&&s.length>0){const r=s[0].payload,c=r.isHighlightedAddition,j=l.highlightedPlayer===r.player,b=r.gamesPlayed>=g;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:r.player})}),e.jsxs("div",{children:["Taux de victoire : ",r.winPercent,"%"]}),e.jsxs("div",{children:["Victoires : ",r.wins," / ",r.gamesPlayed]}),c&&!b&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["🎯 Affiché via sélection (< ",g," parties)"]}),c&&b&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection (hors top 20)"}),j&&!c&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(q,{dataKey:"winPercent",name:"Taux de Victoire",fill:"#8884d8",children:v.map(t=>{const s=l.highlightedPlayer===t.player,r=x===t.player,c=t.isHighlightedAddition;return e.jsx(G,{fill:A[t.player]||"#8884d8",stroke:s?"var(--accent-primary)":r?"var(--text-primary)":"none",strokeWidth:s?3:r?2:0,strokeDasharray:c?"5,5":"none",opacity:c?.8:1,onClick:()=>{o({selectedPlayer:t.player,selectedPlayerWinMode:"wins-only",fromComponent:"Taux de Victoire"})},onMouseEnter:()=>y(t.player),onMouseLeave:()=>y(null),style:{cursor:"pointer"}},`cell-winrate-${t.player}`)})}),e.jsx(E,{y:parseFloat(m),stroke:"red",strokeDasharray:"3 3",label:{value:`Moyenne: ${m}%`,position:"insideBottomRight",fill:"red",fontSize:12,fontWeight:"bold"}})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",v.length," des joueurs (sur ",R," ayant au moins ",g," partie",g>1?"s":"",")"]})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de joueur disponible"})}export{Ce as PlayersGeneralStatisticsChart};
