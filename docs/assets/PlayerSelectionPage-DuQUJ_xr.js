import{r as h,u as k,j as e,a as G,m as S,l as D}from"./index-DTuwbPpr.js";function w(t){const[l,N]=h.useState(null),[m,g]=h.useState(!1),[v,u]=h.useState(null);h.useEffect(()=>{let c=!0;return(async()=>{try{g(!0),u(null);const r=await fetch("/data/playerAchievements.json");if(!r.ok)throw new Error(`Failed to load achievements: ${r.status} ${r.statusText}`);const o=await r.json();c&&(N(o),console.log("âœ… Pre-calculated achievements loaded:",{totalPlayers:o.totalPlayers,totalGames:o.totalGames,generatedAt:o.generatedAt,playersWithAchievements:Object.keys(o.achievements).length}))}catch(r){c&&(u(r instanceof Error?r.message:"Failed to load achievements"),console.error("Error loading pre-calculated achievements:",r))}finally{c&&g(!1)}})(),()=>{c=!1}},[]);const a=t&&l?.achievements[t]||null;return h.useEffect(()=>{if(t&&l){const c=l.achievements[t];c?console.log(`ðŸ† Achievements for ${t}:`,{allGames:c.allGamesAchievements.length,moddedOnly:c.moddedOnlyAchievements.length,categories:[...new Set([...c.allGamesAchievements.map(d=>d.category),...c.moddedOnlyAchievements.map(d=>d.category)])]}):console.log(`âŒ No achievements found for ${t}`)}},[t,l]),{data:a,isLoading:m,error:v,metadata:{generatedAt:l?.generatedAt||null,totalPlayers:l?.totalPlayers||0,totalGames:l?.totalGames||0,totalModdedGames:l?.totalModdedGames||0}}}function E({achievements:t,title:l,emptyMessage:N}){const{navigateToTab:m}=k(),g=a=>{a.redirectTo&&m(a.redirectTo.tab,a.redirectTo.subTab)};if(t.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:l}),e.jsx("p",{children:N||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const v=t.filter(a=>a.type==="good"),u=t.filter(a=>a.type==="bad");return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:l}),v.length>0&&e.jsxs("div",{className:"achievements-section good-achievements",children:[e.jsx("h5",{children:"ðŸ† SuccÃ¨s"}),e.jsx("div",{className:"achievements-grid",children:v.map(a=>e.jsxs("div",{className:`achievement-card good rank-${a.rank}`,onClick:()=>g(a),title:"Cliquez pour voir le classement complet",children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:a.title}),e.jsxs("span",{className:"achievement-rank",children:["#",a.rank]})]}),e.jsx("p",{className:"achievement-description",children:a.description})]},a.id))})]}),u.length>0&&e.jsxs("div",{className:"achievements-section bad-achievements",children:[e.jsx("h5",{children:"ðŸ’€ Anti-succÃ¨s"}),e.jsx("div",{className:"achievements-grid",children:u.map(a=>e.jsxs("div",{className:`achievement-card bad rank-${a.rank}`,onClick:()=>g(a),title:"Cliquez pour voir le classement complet",children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:a.title}),e.jsxs("span",{className:"achievement-rank",children:["#",a.rank]})]}),e.jsx("p",{className:"achievement-description",children:a.description})]},a.id))})]})]})}function T(){const{settings:t,updateSettings:l}=G(),{navigateToTab:N}=k(),{data:m,isLoading:g,error:v}=S(),{data:u,isLoading:a,error:c}=w(t.highlightedPlayer),[d,r]=h.useState(""),[o,y]=h.useState("all"),p=h.useMemo(()=>{if(!m||!m.GameStats)return[];const s=new Map;return m.GameStats.forEach(i=>{const n=new Date(i.StartDate);i.PlayerStats.forEach(A=>{const f=D(A.Username);s.has(f)||s.set(f,{games:0,wins:0,firstDate:n,lastDate:n});const x=s.get(f);x.games++,A.Victorious&&x.wins++,n<x.firstDate&&(x.firstDate=n),n>x.lastDate&&(x.lastDate=n)})}),Array.from(s.entries()).map(([i,n])=>({name:i,totalGames:n.games,totalWins:n.wins,winRate:n.games>0?n.wins/n.games*100:0,firstGameDate:n.firstDate.toLocaleDateString("fr-FR"),lastGameDate:n.lastDate.toLocaleDateString("fr-FR"),isHighlighted:i===t.highlightedPlayer}))},[m,t.highlightedPlayer]),j=h.useMemo(()=>{if(!d.trim())return p;const s=d.toLowerCase();return p.filter(i=>i.name.toLowerCase().includes(s))},[p,d]),b=h.useMemo(()=>[...j].sort((s,i)=>i.totalGames-s.totalGames),[j]),P=s=>{l({highlightedPlayer:s}),r("")},C=s=>{l({highlightedPlayer:s}),N("players","history")};return g?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):v?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",v]})]}):!m||p.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[e.jsxs("div",{className:"player-selection-header",children:[e.jsx("h2",{children:"SÃ©lection de Joueur"}),e.jsx("p",{className:"header-description",children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:d,onChange:s=>r(s.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[j.length," joueur",j.length!==1?"s":"",d&&` (filtrÃ©${j.length!==1?"s":""} de ${p.length})`]})]})]}),e.jsx("div",{className:"player-display",children:d?j.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{className:"clear-search-btn",onClick:()=>r(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:b.map(s=>e.jsxs("button",{className:`suggestion-btn ${s.isHighlighted?"highlighted":""}`,onClick:()=>P(s.name),children:[s.name," (",s.totalGames," parties, ",s.winRate.toFixed(1),"% victoires)",s.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]},s.name))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',d,'"']}),e.jsx("button",{className:"clear-search-btn",onClick:()=>r(""),children:"Effacer la recherche"})]}):t.highlightedPlayer?(()=>{const s=p.find(i=>i.name===t.highlightedPlayer);return s?e.jsxs("div",{className:"single-player-card highlighted",onClick:()=>C(s.name),children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:s.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Parties"}),e.jsx("span",{className:"stat-value",children:s.totalGames})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Victoires"}),e.jsx("span",{className:"stat-value",children:s.totalWins})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Taux de victoire"}),e.jsxs("span",{className:"stat-value",children:[s.winRate.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[s.firstGameDate," - ",s.lastGameDate]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsx("button",{className:"highlight-btn active",onClick:i=>{i.stopPropagation(),l({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"}),e.jsxs("div",{className:"achievements-section",children:[e.jsxs("div",{className:"achievements-filter",children:[e.jsx("button",{className:`filter-btn ${o==="all"?"active":""}`,onClick:i=>{i.stopPropagation(),y("all")},children:"Toutes les parties"}),e.jsx("button",{className:`filter-btn ${o==="modded"?"active":""}`,onClick:i=>{i.stopPropagation(),y("modded")},children:"Parties moddÃ©es"})]}),a?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des succÃ¨s..."})]}):c?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des succÃ¨s: ",c]})}):u?e.jsx(E,{achievements:o==="all"?u.allGamesAchievements:u.moddedOnlyAchievements,title:o==="all"?"SuccÃ¨s - Toutes les parties":"SuccÃ¨s - Parties moddÃ©es",emptyMessage:"Aucun succÃ¨s dans cette catÃ©gorie"}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun succÃ¨s disponible pour ce joueur"})})]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',t.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{className:"clear-selection-btn",onClick:()=>l({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Utilisez la recherche ci-dessus pour trouver et sÃ©lectionner un joueur Ã  mettre en Ã©vidence."}),j.length>0&&e.jsxs("div",{className:"suggested-players",children:[e.jsx("h3",{children:"Joueurs suggÃ©rÃ©s:"}),e.jsx("div",{className:"suggestion-list",children:b.slice(0,5).map(s=>e.jsxs("button",{className:"suggestion-btn",onClick:()=>P(s.name),children:[s.name," (",s.totalGames," parties)"]},s.name))})]})]})})})]})}export{T as PlayerSelectionPage};
