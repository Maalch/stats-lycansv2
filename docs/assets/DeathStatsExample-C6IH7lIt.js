import{j as e}from"./index-CJPRgSeP.js";import{a as v}from"./baseStatsHook-DUccMnDl.js";function b(r){if(!r)return{phase:"unknown",dayNumber:0};const l=r.match(/^([NM])(\d+)$/);if(l){const s=l[1]==="N"?"night":"meeting",d=parseInt(l[2],10);return{phase:s,dayNumber:d}}return{phase:"unknown",dayNumber:0}}function f(r){if(!r)return 0;const{phase:l,dayNumber:s}=b(r);return l==="unknown"?0:s+(l==="meeting"?.5:0)}function R(r){if(r.length===0)return null;let l=0,s=0;const d={},t={},o={night:0,meeting:0,unknown:0},n=[];r.forEach(g=>{g.PlayerStats.forEach(h=>{if(h.DeathDateIrl){l++;const p=h.DeathType||"Inconnu";d[p]=(d[p]||0)+1;const i=h.DeathTiming||"Inconnu";t[i]=(t[i]||0)+1;const{phase:x}=b(i);o[x]++;const j=f(i);j>0&&n.push(j)}else s++})});const m=l+s,a=m>0?s/m*100:0,c=Object.entries(d).sort(([,g],[,h])=>h-g)[0]?.[0]||null,u=Object.entries(t).sort(([,g],[,h])=>h-g)[0]?.[0]||null,y=n.length>0?n.reduce((g,h)=>g+h,0)/n.length:0;return{totalDeaths:l,totalSurvivors:s,survivalRate:a,deathsByType:d,deathsByTiming:t,deathsByPhase:o,averageDeathTiming:y,mostCommonDeathType:c,mostCommonDeathTiming:u}}function C(r){if(r.length===0)return[];const l={};return r.forEach(s=>{const d=new Set;s.PlayerStats.forEach(t=>{if(t.KillerName&&t.DeathDateIrl){const o=t.KillerName.trim();d.add(o),l[o]||(l[o]={killer:o,totalKills:0,victimsByRole:{},victims:[],uniqueVictims:0,killsByDeathType:{},killsByTiming:{},averageKillTiming:0,gamesAsKiller:0,killsPerGame:0,mostTargetedRole:null,mostCommonKillType:null,preferredVictim:null});const n=l[o];n.totalKills++,n.victims.push(t.Username);const m=t.MainRoleInitial;n.victimsByRole[m]=(n.victimsByRole[m]||0)+1;const a=t.DeathType||"Inconnu";n.killsByDeathType[a]=(n.killsByDeathType[a]||0)+1;const c=t.DeathTiming||"Inconnu";n.killsByTiming[c]=(n.killsByTiming[c]||0)+1}}),d.forEach(t=>{l[t]&&l[t].gamesAsKiller++})}),Object.values(l).forEach(s=>{s.uniqueVictims=new Set(s.victims).size,s.killsPerGame=s.gamesAsKiller>0?s.totalKills/s.gamesAsKiller:0;const[d]=Object.entries(s.victimsByRole).sort(([,a],[,c])=>c-a)[0]||[null];s.mostTargetedRole=d;const[t]=Object.entries(s.killsByDeathType).sort(([,a],[,c])=>c-a)[0]||[null];s.mostCommonKillType=t;const o={};s.victims.forEach(a=>{o[a]=(o[a]||0)+1});const[n]=Object.entries(o).sort(([,a],[,c])=>c-a)[0]||[null];s.preferredVictim=n;const m=Object.entries(s.killsByTiming).flatMap(([a,c])=>Array(c).fill(f(a))).filter(a=>a>0);s.averageKillTiming=m.length>0?m.reduce((a,c)=>a+c,0)/m.length:0}),Object.values(l).sort((s,d)=>d.totalKills-s.totalKills)}function K(r){if(r.length===0)return[];const l={};let s=0;return r.forEach(d=>{s+=d.PlayerStats.length,d.PlayerStats.forEach(t=>{if(t.DeathDateIrl&&t.DeathTiming){const o=t.DeathTiming,{phase:n,dayNumber:m}=b(o);l[o]||(l[o]={timing:o,phase:n,dayNumber:m,totalDeaths:0,deathsByType:{},deathsByRole:{},killers:{},survivalRateBeforeThis:0,averageGameProgress:0});const a=l[o];a.totalDeaths++;const c=t.DeathType||"Inconnu";a.deathsByType[c]=(a.deathsByType[c]||0)+1;const u=t.MainRoleInitial;if(a.deathsByRole[u]=(a.deathsByRole[u]||0)+1,t.KillerName){const y=t.KillerName;a.killers[y]=(a.killers[y]||0)+1}}})}),Object.values(l).sort((d,t)=>d.dayNumber!==t.dayNumber?d.dayNumber-t.dayNumber:d.phase==="night"&&t.phase==="meeting"?-1:d.phase==="meeting"&&t.phase==="night"?1:0)}function w(r){if(r.length===0)return[];const l={};return r.forEach(s=>{s.PlayerStats.forEach(d=>{const t=d.Username.trim();if(!t)return;l[t]||(l[t]={player:t,gamesPlayed:0,timesKilled:0,timesSurvived:0,survivalRate:0,averageSurvivalTiming:0,deathsByType:{},deathsByTiming:{},killedBy:{},mostCommonDeathType:null,mostCommonDeathTiming:null,mostFrequentKiller:null,roleBasedSurvival:{},longestSurvival:null,shortestSurvival:null});const o=l[t];o.gamesPlayed++;const n=d.MainRoleInitial;if(o.roleBasedSurvival[n]||(o.roleBasedSurvival[n]={played:0,survived:0,survivalRate:0}),o.roleBasedSurvival[n].played++,d.DeathDateIrl){o.timesKilled++;const m=d.DeathType||"Inconnu";o.deathsByType[m]=(o.deathsByType[m]||0)+1;const a=d.DeathTiming||"Inconnu";if(o.deathsByTiming[a]=(o.deathsByTiming[a]||0)+1,d.KillerName){const c=d.KillerName;o.killedBy[c]=(o.killedBy[c]||0)+1}}else o.timesSurvived++,o.roleBasedSurvival[n].survived++})}),Object.values(l).forEach(s=>{s.survivalRate=s.gamesPlayed>0?s.timesSurvived/s.gamesPlayed*100:0;const[d]=Object.entries(s.deathsByType).sort(([,n],[,m])=>m-n)[0]||[null];s.mostCommonDeathType=d;const[t]=Object.entries(s.deathsByTiming).sort(([,n],[,m])=>m-n)[0]||[null];s.mostCommonDeathTiming=t;const[o]=Object.entries(s.killedBy).sort(([,n],[,m])=>m-n)[0]||[null];s.mostFrequentKiller=o,Object.values(s.roleBasedSurvival).forEach(n=>{n.survivalRate=n.played>0?n.survived/n.played*100:0})}),Object.values(l).sort((s,d)=>d.survivalRate-s.survivalRate)}function P(r){return r.map(l=>{const s=l.PlayerStats.length,d=l.PlayerStats.filter(h=>h.DeathDateIrl),t=d.length,o=s-t,n=l.PlayerStats.filter(h=>h.Victorious),m=n.length>0?n[0].MainRoleInitial:"Unknown",a=d.map(h=>({timing:h.DeathTiming||"Unknown",victim:h.Username,killer:h.KillerName,deathType:h.DeathType||"Unknown",phase:b(h.DeathTiming).phase})).sort((h,p)=>{const i=f(h.timing),x=f(p.timing);return i-x}),c={};d.forEach(h=>{const p=h.DeathTiming||"Unknown";c[p]=(c[p]||0)+1});const u={};d.forEach(h=>{if(h.KillerName){const p=h.KillerName;u[p]=(u[p]||0)+1}});const[y]=Object.entries(u).sort(([,h],[,p])=>p-h)[0]||[null],g=s>0?t/s*100:0;return{gameId:l.Id,gameDate:l.StartDate,totalPlayers:s,totalDeaths:t,totalSurvivors:o,winningCamp:m,deathProgression:a,deathsByPhase:c,killersInGame:u,deadliestPlayer:y,gameLength:l.EndTiming||"Unknown",mortalityRate:g}})}function k(){return v(r=>R(r))}function A(){return v(r=>C(r))}function N(){return v(r=>K(r))}function S(){return v(r=>w(r))}function I(){return v(r=>P(r))}function F(){const{data:r,isLoading:l,error:s}=k(),{data:d,isLoading:t,error:o}=A(),{data:n,isLoading:m,error:a}=N(),{data:c,isLoading:u,error:y}=S(),{data:g,isLoading:h,error:p}=I();return l||t||m||u||h?e.jsx("div",{children:"Loading death statistics..."}):s||o||a||y||p?e.jsx("div",{children:"Error loading death statistics"}):e.jsxs("div",{style:{padding:"20px",maxWidth:"1200px",margin:"0 auto"},children:[e.jsx("h1",{children:"Death & Survival Statistics Dashboard"}),r&&e.jsxs("section",{style:{marginBottom:"30px",padding:"15px",border:"1px solid #ddd",borderRadius:"8px"},children:[e.jsx("h2",{children:"Overall Death Statistics"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"15px"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Total Deaths:"})," ",r.totalDeaths]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Total Survivors:"})," ",r.totalSurvivors]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Survival Rate:"})," ",r.survivalRate.toFixed(1),"%"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Average Death Timing:"})," ",r.averageDeathTiming.toFixed(1)]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Most Common Death:"})," ",r.mostCommonDeathType]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Most Common Timing:"})," ",r.mostCommonDeathTiming]})]}),e.jsxs("div",{style:{marginTop:"15px"},children:[e.jsx("h3",{children:"Deaths by Phase"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"10px"},children:[e.jsxs("div",{children:["Night: ",r.deathsByPhase.night]}),e.jsxs("div",{children:["Meeting: ",r.deathsByPhase.meeting]}),e.jsxs("div",{children:["Unknown: ",r.deathsByPhase.unknown]})]})]}),e.jsxs("div",{style:{marginTop:"15px"},children:[e.jsx("h3",{children:"Deaths by Type"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"8px"},children:Object.entries(r.deathsByType).map(([i,x])=>e.jsxs("div",{style:{fontSize:"0.9em"},children:[e.jsxs("strong",{children:[i,":"]})," ",x]},i))})]})]}),d&&d.length>0&&e.jsxs("section",{style:{marginBottom:"30px",padding:"15px",border:"1px solid #ddd",borderRadius:"8px"},children:[e.jsx("h2",{children:"Top Killers (Top 10)"}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f5f5f5"},children:[e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Killer"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Total Kills"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Unique Victims"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Games as Killer"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Kills/Game"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Most Targeted Role"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Preferred Victim"})]})}),e.jsx("tbody",{children:d.slice(0,10).map((i,x)=>e.jsxs("tr",{style:{backgroundColor:x%2===0?"#f9f9f9":"white"},children:[e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:i.killer}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:i.totalKills}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:i.uniqueVictims}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:i.gamesAsKiller}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:i.killsPerGame.toFixed(1)}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:i.mostTargetedRole||"N/A"}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:i.preferredVictim||"N/A"})]},i.killer))})]})})]}),n&&n.length>0&&e.jsxs("section",{style:{marginBottom:"30px",padding:"15px",border:"1px solid #ddd",borderRadius:"8px"},children:[e.jsx("h2",{children:"Death Timing Analysis"}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f5f5f5"},children:[e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Timing"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Phase"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Day"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Total Deaths"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Most Common Type"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Most Common Role"})]})}),e.jsx("tbody",{children:n.slice(0,15).map((i,x)=>{const j=Object.entries(i.deathsByType).sort(([,T],[,D])=>D-T)[0]?.[0]||"N/A",B=Object.entries(i.deathsByRole).sort(([,T],[,D])=>D-T)[0]?.[0]||"N/A";return e.jsxs("tr",{style:{backgroundColor:x%2===0?"#f9f9f9":"white"},children:[e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:i.timing}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:i.phase}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:i.dayNumber}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:i.totalDeaths}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:j}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:B})]},i.timing)})})]})})]}),c&&c.length>0&&e.jsxs("section",{style:{marginBottom:"30px",padding:"15px",border:"1px solid #ddd",borderRadius:"8px"},children:[e.jsx("h2",{children:"Best Survivors (Top 10)"}),e.jsx("div",{style:{overflowX:"auto"},children:e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f5f5f5"},children:[e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Player"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Games Played"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Survived"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Survival Rate"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Most Common Death"}),e.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Most Frequent Killer"})]})}),e.jsx("tbody",{children:c.slice(0,10).map((i,x)=>e.jsxs("tr",{style:{backgroundColor:x%2===0?"#f9f9f9":"white"},children:[e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:i.player}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:i.gamesPlayed}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:i.timesSurvived}),e.jsxs("td",{style:{padding:"8px",border:"1px solid #ddd"},children:[i.survivalRate.toFixed(1),"%"]}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:i.mostCommonDeathType||"N/A"}),e.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:i.mostFrequentKiller||"N/A"})]},i.player))})]})})]}),g&&g.length>0&&e.jsxs("section",{style:{marginBottom:"30px",padding:"15px",border:"1px solid #ddd",borderRadius:"8px"},children:[e.jsx("h2",{children:"Recent Games Death Analysis (Last 3 Games)"}),g.slice(-3).map(i=>e.jsxs("div",{style:{marginBottom:"20px",padding:"10px",backgroundColor:"#f9f9f9",borderRadius:"5px"},children:[e.jsxs("h3",{children:["Game ",i.gameId]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"10px",marginBottom:"15px"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Total Players:"})," ",i.totalPlayers]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Deaths:"})," ",i.totalDeaths]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Survivors:"})," ",i.totalSurvivors]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Mortality Rate:"})," ",i.mortalityRate.toFixed(1),"%"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Game Length:"})," ",i.gameLength]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Winning Camp:"})," ",i.winningCamp]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Deadliest Player:"})," ",i.deadliestPlayer||"N/A"]})]}),i.deathProgression.length>0&&e.jsxs("div",{children:[e.jsx("h4",{children:"Death Progression:"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"8px"},children:i.deathProgression.map((x,j)=>e.jsxs("div",{style:{padding:"5px",backgroundColor:"white",borderRadius:"3px",fontSize:"0.9em"},children:[e.jsx("strong",{children:x.timing}),": ",x.victim,e.jsx("br",{}),"Killer: ",x.killer||"Unknown",e.jsx("br",{}),"Type: ",x.deathType]},j))})]})]},i.gameId))]}),e.jsxs("section",{style:{marginBottom:"30px",padding:"15px",border:"1px solid #ddd",borderRadius:"8px",backgroundColor:"#f0f8ff"},children:[e.jsx("h2",{children:"How to Use These Death Analysis Hooks"}),e.jsx("p",{children:"The death statistics system provides several hooks for different analysis needs:"}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"useDeathStatsFromRaw()"})," - Overall death and survival statistics"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"useKillerAnalysisFromRaw()"})," - Analysis of killer performance and behavior"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"useDeathTimingAnalysisFromRaw()"})," - Death patterns by game timing (N1, N2, M1, etc.)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"useSurvivalAnalysisFromRaw()"})," - Individual player survival patterns and death analysis"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"useGameDeathAnalysisFromRaw()"})," - Game-by-game death progression and analysis"]})]}),e.jsx("p",{children:"All hooks follow the base hook pattern and automatically respect filter settings from SettingsContext."}),e.jsx("h3",{children:"Key Insights Available:"}),e.jsxs("ul",{children:[e.jsx("li",{children:"Death timing patterns (when players typically die)"}),e.jsx("li",{children:"Death type distribution (how players die)"}),e.jsx("li",{children:"Killer effectiveness and targeting patterns"}),e.jsx("li",{children:"Player survival rates by role"}),e.jsx("li",{children:"Game mortality patterns"}),e.jsx("li",{children:"Death progression within games"})]})]})]})}export{F as default};
