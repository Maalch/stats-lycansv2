import{g as L,a as V}from"./datasyncExport-D6_8Fmuy.js";import{i as k,D as l}from"./deathTypes-CGUOTngO.js";import{c as v}from"./api-BYijIpLz.js";import{g as B}from"./index-DUHObHKt.js";function K(c,u){if(!c||!u)return!1;const o=c.split(".").map(Number),r=u.split(".").map(Number);for(let t=0;t<Math.max(o.length,r.length);t++){const e=o[t]||0,i=r[t]||0;if(e>i)return!0;if(e<i)return!1}return!0}function P(c){return c===l.SURVIVALIST_NOT_SAVED?l.BY_WOLF:c}function H(c){const u=new Set;c.filter(e=>!e.LegacyData||e.LegacyData.deathInformationFilled===!0).forEach(e=>{e.PlayerStats.forEach(i=>{const d=L(i.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});u.add(d)})});const r=Array.from(u);return[...v.filter(e=>r.includes(e)),...r.filter(e=>!v.includes(e)).sort()]}function W(c){switch(c){case l.VOTED:return"Mort aux votes";case l.BY_WOLF:case l.SURVIVALIST_NOT_SAVED:return"Kill en Loup";case l.BY_ZOMBIE:return"Kill en Zombie";case l.BY_BEAST:return"Kill en Bête";case l.BY_AVATAR_CHAIN:return"Mort d'Avatar";case l.BULLET:return"Tir de Chasseur";case l.BULLET_HUMAN:return"Kill de Chasseur (sur humain)";case l.BULLET_WOLF:return"Kill de Chasseur (sur loup)";case l.SHERIF_SUCCESS:return"Kill de Shérif";case l.OTHER_AGENT:return"Kill d'Agent";case l.AVENGER:return"Kill de Vengeur";case l.SEER:return"Kill de Devin";case l.HANTED:return"Kill avec Potion hantée";case l.ASSASSIN:return"Kill avec Potion (Assassin)";case l.LOVER_DEATH:return"Kill d'amoureux";case l.BOMB:return"Explosion";case l.CRUSHED:return"Écrasement";case l.STARVATION:return"Famine";case l.STARVATION_AS_BEAST:return"Tuerie bestiale";case l.FALL:return"Chute mortelle";case l.UNKNOWN:return"Kill inconnu";default:return""}}function Y(c){const u=new Set;c.forEach(t=>{t.PlayerStats.forEach(e=>{if(e.DeathType&&k(e.DeathType)){const i=P(e.DeathType);i&&u.add(i)}})});const o=Array.from(u),r=[l.BY_WOLF,l.VOTED,l.BULLET,l.BULLET_HUMAN,l.BULLET_WOLF,l.BY_ZOMBIE,l.ASSASSIN,l.AVENGER,l.LOVER_DEATH];return[...r.filter(t=>o.includes(t)),...o.filter(t=>!r.includes(t)).sort()]}function M(c,u){return c.PlayerStats.filter(o=>o.DeathType&&k(o.DeathType)&&(o.DeathTiming||o.DeathType)).map(o=>{let r=null,t=null;if(o.KillerName){const e=c.PlayerStats.find(i=>i.Username===o.KillerName);if(e){t=B(e);const i=V(e.MainRoleInitial,e.MainRoleChanges||[]);r=L(i,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1}),i&&i!==e.MainRoleInitial&&(i==="Loup"?r="Loup":i==="Zombie"&&(r="Vaudou"))}}return{playerId:B(o),playerName:o.Username,deathType:P(o.DeathType),killerId:t,killerName:o.KillerName,killerCamp:r}}).filter(o=>{if(!u||u==="Tous les camps")return!0;const r=c.PlayerStats.find(e=>e.Username===o.playerName);return r?L(r.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===u:!1})}function O(c,u,o){const r=[];c.PlayerStats.forEach(e=>{if(e.KillerName&&e.DeathType){if(e.DeathType===l.VOTED||e.DeathType===l.STARVATION||e.DeathType===l.FALL||e.DeathType===l.BY_AVATAR_CHAIN)return;const i=c.PlayerStats.find(h=>h.Username===e.KillerName);if(!i)return;let d=L(i.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});const E=V(i.MainRoleInitial,i.MainRoleChanges||[]);E&&E!==i.MainRoleInitial&&(E==="Loup"?d="Loup":E==="Zombie"&&(d="Vaudou"));const R=L(e.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0});r.push({killerId:B(i),killerName:i.Username,victimId:B(e),victimName:e.Username,deathType:P(e.DeathType),killerCamp:d,victimCamp:R})}});let t=r;return u&&u!=="Tous les camps"&&(t=t.filter(e=>e.killerCamp===u)),o&&o!=="Tous les camps"&&(t=t.filter(e=>o==="Roles solo"?e.victimCamp!=="Villageois"&&e.victimCamp!=="Loup":e.victimCamp===o)),t}function x(c,u,o){if(c.length===0)return null;const r=c.filter(s=>!s.LegacyData||s.LegacyData.deathInformationFilled===!0);if(r.length===0)return null;const t=[],e={},i={};r.forEach(s=>{M(s,u).forEach(a=>{t.push({...a,gameId:s.Id})}),s.PlayerStats.forEach(a=>{const T=B(a),I=a.Username;i[T]=I,(!u||u==="Tous les camps"||L(a.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===u)&&(e[T]=(e[T]||0)+1)})});const d=t.length,E=r.length,R=E>0?d/E:0,h={};t.forEach(s=>{h[s.deathType]=(h[s.deathType]||0)+1});const m=Object.entries(h).map(([s,n])=>({type:s,count:n||0,percentage:d>0?(n||0)/d*100:0})).sort((s,n)=>n.count-s.count),f={};r.forEach(s=>{O(s,u,o).forEach(a=>{i[a.killerId]=a.killerName,i[a.victimId]=a.victimName,f[a.killerId]||(f[a.killerId]={kills:0,victims:new Set,killsByDeathType:{}}),f[a.killerId].kills++,f[a.killerId].victims.add(a.victimId),f[a.killerId].killsByDeathType[a.deathType]=(f[a.killerId].killsByDeathType[a.deathType]||0)+1})});const D=Object.entries(f).map(([s,n])=>{const a=e[s]||0,T=a>0?n.kills/a:0;return{killerName:i[s]||s,kills:n.kills,victims:Array.from(n.victims).map(I=>i[I]||I),percentage:d>0?n.kills/d*100:0,gamesPlayed:a,averageKillsPerGame:T,killsByDeathType:n.killsByDeathType}}).sort((s,n)=>n.kills-s.kills),y={};t.forEach(s=>{y[s.playerId]||(y[s.playerId]={totalDeaths:0,deathsByType:{},killedById:{},deathDays:[]});const n=y[s.playerId];n.totalDeaths++,n.deathsByType[s.deathType]=(n.deathsByType[s.deathType]||0)+1,s.killerId&&(n.killedById[s.killerId]=(n.killedById[s.killerId]||0)+1)});const p=[];Object.entries(y).forEach(([s,n])=>{const a=i[s]||s,T={};Object.entries(n.killedById).forEach(([I,A])=>{const C=i[I]||I;T[C]=(T[C]||0)+A}),p.push({playerName:a,totalDeaths:n.totalDeaths,deathsByType:n.deathsByType,killedBy:T,deathRate:e[s]>0?n.totalDeaths/e[s]:0,gamesPlayed:e[s]||0})}),Object.entries(e).forEach(([s,n])=>{y[s]||p.push({playerName:i[s]||s,totalDeaths:0,deathsByType:{},killedBy:{},deathRate:0,gamesPlayed:n})});const g=p.sort((s,n)=>n.totalDeaths-s.totalDeaths),S=m.length>0?m[0].type:null,N=D.length>0?D[0].killerName:null;return{totalDeaths:d,totalGames:E,averageDeathsPerGame:R,deathsByType:m,killerStats:D,playerDeathStats:g,mostCommonDeathType:S,mostDeadlyKiller:N}}function j(c,u){const o=c.filter(h=>!h.LegacyData||h.LegacyData.deathInformationFilled===!0),r={},t={},e=o.length,i=[l.BULLET,l.BULLET_HUMAN,l.BULLET_WOLF];o.forEach(h=>{const m=new Set;h.PlayerStats.forEach(f=>{const D=f.MainRoleInitial,y=V(f.MainRoleInitial,f.MainRoleChanges||[]);if(D==="Chasseur"||y==="Chasseur"){const p=B(f);t[p]=f.Username,m.add(p),r[p]||(r[p]={kills:[],gamesPlayed:0,victimsCamps:[],gameVersions:[],gameModded:[]}),r[p].gamesPlayed++}}),h.PlayerStats.forEach(f=>{const D=f.DeathType,y=f.KillerName,p=y?h.PlayerStats.find(S=>S.Username===y):null,g=p?B(p):null;if(g&&p&&(t[g]=p.Username),D&&i.includes(D)&&g&&m.has(g)){const S=L(f.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});r[g].kills.push(D),r[g].victimsCamps.push(S),r[g].gameVersions.push(h.Version),r[g].gameModded.push(h.Modded)}})});const d=Object.entries(r).map(([h,m])=>{const f=m.kills.length,D={};m.kills.forEach(a=>{D[a]=(D[a]||0)+1});const y={};m.victimsCamps.forEach(a=>{y[a]=(y[a]||0)+1});let p=0,g=0;const S={},N={};m.victimsCamps.forEach((a,T)=>{const I=m.gameVersions[T],A=m.gameModded[T];a==="Idiot du Village"?A&&K(I,"0.202")?(g++,N[a]=(N[a]||0)+1):(p++,S[a]=(S[a]||0)+1):a==="Villageois"?(g++,N[a]=(N[a]||0)+1):(p++,S[a]=(S[a]||0)+1)});const s=m.gamesPlayed>0?f/m.gamesPlayed:0,n=m.gamesPlayed>0?p/m.gamesPlayed:0;return{hunterName:t[h]||h,totalKills:f,nonVillageoisKills:p,villageoisKills:g,gamesPlayedAsHunter:m.gamesPlayed,averageKillsPerGame:s,averageNonVillageoisKillsPerGame:n,killsByDeathType:D,victimsByCamp:y,goodVictimsByCamp:S,badVictimsByCamp:N}}).sort((h,m)=>m.totalKills-h.totalKills),E=d.length>0?d[0].hunterName:null,R=d.length>0?d.sort((h,m)=>m.averageNonVillageoisKillsPerGame-h.averageNonVillageoisKillsPerGame)[0].hunterName:null;return{totalHunters:d.length,totalGames:e,hunterStats:d,bestHunter:E,bestAverageHunter:R}}function w(c,u){const o=[];return c.forEach(r=>{r.PlayerStats.filter(t=>t.DeathPosition!==null).filter(t=>!u||u==="Tous les camps"?!0:L(t.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===u).forEach(t=>{if(t.DeathPosition){const e=L(t.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});o.push({x:t.DeathPosition.x,z:t.DeathPosition.z,playerName:t.Username,deathType:P(t.DeathType),mapName:r.MapName,killerName:t.KillerName||null,camp:e,gameId:r.DisplayedId,displayedGameId:r.DisplayedId})}})}),o}function F(c){const u=new Set;return c.forEach(o=>{o.PlayerStats.some(t=>t.DeathPosition!==null)&&o.MapName&&u.add(o.MapName)}),Array.from(u).sort()}export{Y as a,F as b,w as c,x as d,H as e,j as f,W as g};
