import{r as t,j as e}from"./index-BFcVbxiC.js";import{l as C,p as A}from"./api-BWHeASPZ.js";import{R as p,T as h,C as u}from"./CategoricalChart-jlol99yu.js";import{B as N,C as j,X as y,Y as b,a as w}from"./BarChart-laXCa6Im.js";import{P as k,a as M}from"./PieChart-CF3TfqGk.js";import{S as F,a as $}from"./ScatterChart-EKABNMrT.js";function q(){const[i,P]=t.useState(null),[l,x]=t.useState(!0),[o,f]=t.useState(null);return t.useEffect(()=>{(async()=>{try{x(!0),f(null);const d=await fetch("https://script.google.com/macros/s/AKfycbxrhG1mb7N6q7Mg88ogw0mirXgSihPpNPurZwiEOy9miG24Cc3AlGZCn2uoGnygNhck/exec?action=playerCampPerformance");if(!d.ok)throw new Error(`Erreur réseau: ${d.status}`);const m=await d.json();if(m.error)throw new Error(m.error);P(m)}catch(c){console.error("Erreur lors du chargement des statistiques de performance par camp:",c),f(c instanceof Error?c.message:"Erreur inconnue")}finally{x(!1)}})()},[]),{playerCampPerformance:i,isLoading:l,error:o}}function L(){const[i,P]=t.useState("camp-averages"),[l,x]=t.useState("Villageois"),[o,f]=t.useState(5),{playerCampPerformance:n,isLoading:c,error:d}=q(),m=t.useMemo(()=>n?.campAverages?n.campAverages.map(s=>s.camp).sort():[],[n]),v=t.useMemo(()=>n?.campAverages?n.campAverages.map(s=>({...s,winRateNum:parseFloat(s.winRate)})).sort((s,a)=>a.winRateNum-s.winRateNum):[],[n]),g=t.useMemo(()=>n?.playerPerformance?n.playerPerformance.map(a=>{const r=a.campPerformance.find(S=>S.camp===l);return!r||r.games<o?null:{player:a.player,...r,winRateNum:parseFloat(r.winRate),performanceNum:parseFloat(r.performance),campAvgWinRateNum:parseFloat(r.campAvgWinRate)}}).filter(Boolean).sort((a,r)=>r.performanceNum-a.performanceNum):[],[n,l,o]),R=t.useMemo(()=>n?.playerPerformance?n.playerPerformance.flatMap(a=>a.campPerformance.filter(r=>r.games>=o).map(r=>({player:a.player,camp:r.camp,games:r.games,wins:r.wins,winRate:r.winRate,performance:r.performance,winRateNum:parseFloat(r.winRate),performanceNum:parseFloat(r.performance),campAvgWinRateNum:parseFloat(r.campAvgWinRate)}))).sort((a,r)=>r.performanceNum-a.performanceNum).slice(0,20):[],[n,o]);return c?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de performance par camp..."}):d?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",d]}):n?e.jsxs("div",{className:"lycans-player-camp-performance",children:[e.jsx("h2",{children:"Performance des Joueurs par Camp"}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"view-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Vue:"}),e.jsxs("select",{id:"view-mode-select",value:i,onChange:s=>P(s.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"camp-averages",children:"Moyennes par Camp"}),e.jsx("option",{value:"player-performance",children:"Performance par Camp"}),e.jsx("option",{value:"top-performers",children:"Top Performers"})]})]}),i==="player-performance"&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsx("select",{id:"camp-select",value:l,onChange:s=>x(s.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:m.map(s=>e.jsx("option",{value:s,children:s},s))})]}),(i==="player-performance"||i==="top-performers")&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"min-games-input",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("input",{id:"min-games-input",type:"number",min:"1",max:"50",value:o,onChange:s=>f(parseInt(s.target.value)||3),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",width:"70px"}})]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camps Analysés"}),e.jsx("div",{className:"lycans-valeur-principale",children:n.campAverages.length}),e.jsx("p",{children:"camps différents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Joueurs Évalués"}),e.jsx("div",{className:"lycans-valeur-principale",children:n.playerPerformance.length}),e.jsx("p",{children:"joueurs analysés"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Seuil Minimum"}),e.jsx("div",{className:"lycans-valeur-principale",children:n.minGamesRequired}),e.jsx("p",{children:"parties requises"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[i==="camp-averages"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire Moyen par Camp"}),e.jsx("div",{style:{height:400},children:e.jsx(p,{width:"100%",height:"100%",children:e.jsxs(N,{data:v,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(j,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(b,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(h,{content:({active:s,payload:a})=>{if(s&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.camp})}),e.jsxs("div",{children:["Parties totales: ",r.totalGames]}),e.jsxs("div",{children:["Taux de victoire: ",r.winRate,"%"]})]})}return null}}),e.jsx(w,{dataKey:"winRateNum",children:v.map((s,a)=>e.jsx(u,{fill:C[s.camp]||`var(--chart-color-${a%6+1})`},`cell-${a}`))})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Parties par Camp"}),e.jsx("div",{style:{height:400},children:e.jsx(p,{width:"100%",height:"100%",children:e.jsxs(k,{children:[e.jsx(M,{data:v,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"totalGames",label:({camp:s,totalGames:a,percent:r})=>`${s}: ${a} (${((r!==void 0?r:0)*100).toFixed(1)}%)`,children:v.map((s,a)=>e.jsx(u,{fill:C[s.camp]||`var(--chart-color-${a%6+1})`},`cell-${a}`))}),e.jsx(h,{content:({active:s,payload:a})=>{if(s&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.camp})}),e.jsxs("div",{children:["Parties: ",r.totalGames]}),e.jsxs("div",{children:["Taux victoire: ",r.winRate,"%"]})]})}return null}})]})})})]})]}),i==="player-performance"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Performance des Joueurs - ",l]}),e.jsx("div",{style:{height:500},children:e.jsx(p,{width:"100%",height:"100%",children:e.jsxs(N,{data:g.slice(0,15),margin:{top:20,right:30,left:20,bottom:100},children:[e.jsx(j,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"player",angle:-45,textAnchor:"end",height:110,interval:0,fontSize:10}),e.jsx(b,{label:{value:"Performance vs moyenne (%)",angle:-90,position:"insideLeft"}}),e.jsx(h,{content:({active:s,payload:a})=>{if(s&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.player})}),e.jsxs("div",{children:["Parties: ",r.games]}),e.jsxs("div",{children:["Victoires: ",r.wins]}),e.jsxs("div",{children:["Taux personnel: ",r.winRate,"%"]}),e.jsxs("div",{children:["Moyenne camp: ",r.campAvgWinRate,"%"]}),e.jsxs("div",{children:["Performance: ",r.performance>0?"+":"",r.performance,"%"]})]})}return null}}),e.jsx(w,{dataKey:"performanceNum",children:g.slice(0,15).map((s,a)=>e.jsx(u,{fill:A[s.player]||(s.performanceNum>=0?"var(--accent-tertiary)":"var(--accent-danger)")},`cell-${a}`))})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Relation Parties Jouées vs Performance - ",l]}),e.jsx("div",{style:{height:400},children:e.jsx(p,{width:"100%",height:"100%",children:e.jsxs(F,{data:g,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(j,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"games",type:"number",label:{value:"Parties jouées",position:"insideBottom",offset:-10}}),e.jsx(b,{dataKey:"performanceNum",type:"number",label:{value:"Performance (%)",angle:-90,position:"insideLeft"}}),e.jsx(h,{content:({active:s,payload:a})=>{if(s&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.player})}),e.jsxs("div",{children:["Parties: ",r.games]}),e.jsxs("div",{children:["Performance: ",r.performance>0?"+":"",r.performance,"%"]})]})}return null}}),e.jsx($,{dataKey:"performanceNum",name:"Performance",children:g.map((s,a)=>e.jsx(u,{fill:A[s.player]||"var(--accent-primary)"},`cell-${a}`))})]})})})]})]}),i==="top-performers"&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top 20 Performances Toutes Camps Confondues"}),e.jsx("div",{style:{height:600},children:e.jsx(p,{width:"100%",height:"100%",children:e.jsxs(N,{data:R,margin:{top:20,right:30,left:20,bottom:100},children:[e.jsx(j,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"player",angle:-45,textAnchor:"end",height:110,interval:0,fontSize:10}),e.jsx(b,{label:{value:"Performance vs moyenne (%)",angle:-90,position:"insideLeft"}}),e.jsx(h,{content:({active:s,payload:a})=>{if(s&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.player})}),e.jsxs("div",{children:["Camp: ",r.camp]}),e.jsxs("div",{children:["Parties: ",r.games]}),e.jsxs("div",{children:["Taux personnel: ",r.winRate,"%"]}),e.jsxs("div",{children:["Performance: +",r.performance,"%"]})]})}return null}}),e.jsx(w,{dataKey:"performanceNum",children:R.map((s,a)=>e.jsx(u,{fill:C[s.camp]||`var(--chart-color-${a%6+1})`},`cell-${a}`))})]})})})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de performance par camp disponible"})}export{L as PlayerCampPerformanceChart};
