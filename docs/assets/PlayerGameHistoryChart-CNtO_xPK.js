import{u as E,r as S,j as e}from"./index-iPJCRIrI.js";import{b as W,s as $,g as V,f as B,d as K,u as H}from"./baseStatsHook--6aOJIne.js";import{u as _}from"./usePlayerStatsFromRaw-Br8V-w2W.js";import{l as J,a as G}from"./api-beq3FXpM.js";import{F as A,C as T,X as z,Y as M,B as I,a as k,b as D}from"./FullscreenChart-CuGzK3ME.js";import{R,T as N}from"./CategoricalChart-tykwOv4n.js";import{L as O,a as X}from"./LineChart-BkWu9EKK.js";import{P as Y,a as Q}from"./PieChart-Pryh3vXh.js";import"./ActivePoints-DuBLWtpN.js";import"./PolarChart-H3lE0Mdp.js";function U(l,u,x,c){return u==="Agent"&&x==="Agent"?c&&c.trim()!==""?$(c).some(g=>g.toLowerCase()===l.toLowerCase()):!1:K(u,x)}function Z(l,u,x){if(l.trim()===""||u.length===0||x.length===0)return null;const c=W(x),i=[];u.forEach(n=>{const m=n.Game?.toString(),y=n.Date,v=n["Liste des joueurs"],p=n["Camp victorieux"],f=n["Liste des gagnants"];if(m&&v&&y&&f){const C=$(v.toString());if(C.some(h=>h.toLowerCase()===l.toLowerCase())){const h=V(c,m,l),r=U(l,h,p,f?.toString()),s=B(y);i.push({gameId:m,date:s,camp:h,won:r,winnerCamp:p?.toString()||"",playersInGame:C.length})}}}),i.sort((n,m)=>{const y=v=>{const p=v.split("/");return p.length===3?new Date(parseInt(p[2]),parseInt(p[1])-1,parseInt(p[0])):new Date(v)};return y(m.date).getTime()-y(n.date).getTime()});const g=i.length,P=i.filter(n=>n.won).length,b=g>0?(P/g*100).toFixed(2):"0.00",a={};return i.forEach(n=>{a[n.camp]||(a[n.camp]={appearances:0,wins:0,winRate:"0.00"}),a[n.camp].appearances++,n.won&&a[n.camp].wins++}),Object.keys(a).forEach(n=>{const m=a[n];m.winRate=m.appearances>0?(m.wins/m.appearances*100).toFixed(2):"0.00"}),{playerName:l,totalGames:g,totalWins:P,winRate:b,games:i,campStats:a}}function ee(l){const{data:u,isLoading:x,error:c}=H((i,g)=>Z(l,i,g));return{data:u,isLoading:x,error:c}}function pe(){const{navigateToGameDetails:l,navigationState:u,updateNavigationState:x}=E(),c=u.selectedPlayerName||"Ponce",i=u.groupingMethod||"session",g=r=>{x({selectedPlayerName:r})},P=r=>{x({groupingMethod:r})},{data:b}=_(),{data:a,isLoading:n,error:m}=ee(c),y=S.useMemo(()=>b?.playerStats?b.playerStats.filter(r=>r.gamesPlayed>0).map(r=>r.player).sort():["Ponce"],[b]),v=S.useMemo(()=>{if(!a?.games)return new Map;const r=new Map;return a.games.forEach(s=>{if(!r.has(s.date)){const t=s.date.split("/");t.length===3?r.set(s.date,new Date(parseInt(t[2]),parseInt(t[1])-1,parseInt(t[0])).getTime()):r.set(s.date,new Date(s.date).getTime())}}),r},[a?.games]),p=S.useMemo(()=>{if(!a?.games)return[];const r={};return a.games.forEach(s=>{let t;if(i==="month"){const o=s.date.split("/");o.length===3?t=`${o[1]}/${o[2]}`:t=s.date}else t=s.date;r[t]||(r[t]={games:[],wins:0,total:0}),r[t].games.push(s),r[t].total++,s.won&&r[t].wins++}),Object.entries(r).map(([s,t])=>({period:s,totalGames:t.total,victories:t.wins,defeats:t.total-t.wins,winRate:t.total>0?(t.wins/t.total*100).toFixed(1):"0.0",winRateNum:t.total>0?t.wins/t.total*100:0})).sort((s,t)=>{if(i==="month"){const[o,d]=s.period.split("/"),[j,w]=t.period.split("/"),L=new Date(parseInt(d),parseInt(o)-1,1),F=new Date(parseInt(w),parseInt(j)-1,1);return L.getTime()-F.getTime()}else{const o=v.get(s.period)||0,d=v.get(t.period)||0;return o-d}})},[a,i,v]),f=S.useMemo(()=>a?.campStats?Object.entries(a.campStats).map(([r,s])=>({name:r,value:s.appearances,winRate:s.winRate,wins:s.wins,percentage:(s.appearances/a.totalGames*100).toFixed(1)})):[],[a]),C=S.useMemo(()=>{if(!f.length)return[];const r=5;let s=0;const t=[],o=[];if(f.forEach(d=>{parseFloat(d.percentage)<r?(s+=Number(d.value),t.push(d)):o.push(d)}),s>0){const d=f.reduce((j,w)=>j+Number(w.value),0);o.push({name:"Autres",value:s,winRate:"0.0",wins:t.reduce((j,w)=>j+w.wins,0),percentage:(s/d*100).toFixed(1),_details:t})}return o},[f]),h=(r=>r<=15?{fontSize:11,angle:-45,height:80,interval:0}:r<=30?{fontSize:10,angle:-45,height:85,interval:1}:r<=50?{fontSize:9,angle:-60,height:95,interval:2}:{fontSize:8,angle:-75,height:105,interval:Math.floor(r/12)})(p.length);return n?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):m?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",m]}):a?e.jsxs("div",{className:"lycans-player-history",children:[e.jsx("h2",{children:"Historique Détaillé d'un Joueur"}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Joueur:"}),e.jsx("select",{id:"player-select",value:c,onChange:r=>g(r.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:y.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:i,onChange:r=>P(r.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"})]})]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.totalGames}),e.jsx("p",{children:"parties jouées"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.totalWins}),e.jsx("p",{children:"parties gagnées"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",children:[a.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Évolution des Performances ",i==="month"?"par Mois":"par Session"]}),e.jsx(A,{title:`Évolution des Performances ${i==="month"?"par Mois":"par Session"}`,children:e.jsx("div",{style:{height:400},children:e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(O,{data:p,margin:{top:20,right:30,left:20,bottom:60},onClick:r=>{if(r&&r.activeLabel){const s=p.find(t=>t.period===r.activeLabel);s&&l({selectedPlayer:c,selectedDate:s.period,fromComponent:`Évolution des Performances ${i==="month"?"par Mois":"par Session"}`})}},style:{cursor:"pointer"},children:[e.jsx(T,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"period",angle:h.angle,textAnchor:"end",height:h.height,interval:h.interval,fontSize:h.fontSize}),e.jsx(M,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(N,{content:({active:r,payload:s})=>{if(r&&s&&s.length>0){const t=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:t.period})}),e.jsxs("div",{children:["Parties: ",t.totalGames]}),e.jsxs("div",{children:["Victoires: ",t.victories]}),e.jsxs("div",{children:["Taux: ",t.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(X,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Répartition Victoires/Défaites ",i==="month"?"par Mois":"par Session"]}),e.jsx(A,{title:`Répartition Victoires/Défaites ${i==="month"?"par Mois":"par Session"}`,children:e.jsx("div",{style:{height:400},children:e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(I,{data:p,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(T,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"period",angle:h.angle,textAnchor:"end",height:h.height,interval:h.interval,fontSize:h.fontSize}),e.jsx(M,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"},allowDecimals:!1}),e.jsx(N,{content:({active:r,payload:s})=>{if(r&&s&&s.length>0){const t=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:t.period})}),e.jsxs("div",{children:["Total: ",t.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",t.victories]}),e.jsxs("div",{children:["Défaites: ",t.defeats]}),e.jsxs("div",{children:["Taux: ",t.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(k,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:p.map((r,s)=>e.jsx(D,{fill:"var(--accent-tertiary)",onClick:()=>{l({selectedPlayer:c,selectedDate:r.period,fromComponent:`Historique Joueur - Victoires ${i==="month"?"par Mois":"par Session"}`})},style:{cursor:"pointer"}},`cell-victories-${s}`))}),e.jsx(k,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"Défaites",children:p.map((r,s)=>e.jsx(D,{fill:"var(--chart-color-4)",onClick:()=>{l({selectedPlayer:c,selectedDate:r.period,fromComponent:`Historique Joueur - Défaites ${i==="month"?"par Mois":"par Session"}`})},style:{cursor:"pointer"}},`cell-defeats-${s}`))})]})})})})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(Y,{children:[e.jsx(Q,{data:C,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:({name:r,value:s,percent:t})=>{const o=t!==void 0?t:0;return r==="Autres"?`Autres : ${s} (${(o*100).toFixed(1)}%)`:`${r}: ${s} (${(o*100).toFixed(1)}%)`},children:C.map((r,s)=>e.jsx(D,{fill:r.name==="Autres"?J:G[r.name]||`var(--chart-color-${s%6+1})`,onClick:()=>{if(r.name==="Autres"){const t=r._details?.map(o=>o.name)||[];l({selectedPlayer:c,selectedCamp:"Autres",_smallCamps:t,fromComponent:"Distribution par Camps"})}else l({selectedPlayer:c,selectedCamp:r.name,fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${s}`))}),e.jsx(N,{content:({active:r,payload:s})=>{if(r&&s&&s.length>0){const t=s[0].payload;if(t.name==="Autres"&&t._details){const o=[...t._details].sort((d,j)=>j.value-d.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",t.value," parties (",t.percentage,"%)"]})}),e.jsx("div",{children:o.map((d,j)=>e.jsxs("div",{children:[d.name,": ",d.value," parties (",d.percentage,"%)"]},j))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[t.name," (",t.percentage,"%)"]})}),e.jsxs("div",{children:["Apparitions: ",t.value]}),e.jsxs("div",{children:["Victoires: ",t.wins," (",t.winRate,"%)"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(A,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(R,{width:"100%",height:"100%",children:e.jsxs(I,{data:f,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(T,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(M,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(N,{content:({active:r,payload:s})=>{if(r&&s&&s.length>0){const t=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:t.name})}),e.jsxs("div",{children:["Victoires: ",t.wins," / ",t.value]}),e.jsxs("div",{children:["Taux: ",t.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(k,{dataKey:"winRate",children:f.map((r,s)=>e.jsx(D,{fill:G[r.name]||`var(--chart-color-${s%6+1})`,onClick:()=>{l({selectedPlayer:c,selectedCamp:r.name,fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${s}`))})]})})})})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée d'historique disponible"})}export{pe as PlayerGameHistoryChart};
