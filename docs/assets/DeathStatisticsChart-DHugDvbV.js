import{u as J,a as _,r as M,j as e,d as ae}from"./index-B5NYDbBs.js";import{g as Q,a as ee,u as re,b as se,c as le,d as ne}from"./useDeathStatisticsFromRaw-DmPJ6iZb.js";import{u as oe}from"./baseStatsHook-YNqYjJb1.js";import{g as ce,D as E}from"./datasyncExport-D6_8Fmuy.js";import{m as Y,u as X,a as ie}from"./api-DwkUJPJy.js";import{D as L}from"./deathTypes-CGUOTngO.js";import{F as W,B as F,C as V,X as q,Y as G,a as $,b as U}from"./FullscreenChart-9egLguvG.js";import{R as O,T as w}from"./CategoricalChart-DZWxHrW9.js";import{u as Z}from"./useJoueursData-DKR016zQ.js";function te(n){if(!n||n.trim()==="")return null;const y=n.trim().slice(1),p=parseInt(y,10);return isNaN(p)||p<1?null:p}function de(n,S){if(n.length===0)return null;const y=n.filter(s=>!s.LegacyData||s.LegacyData.deathInformationFilled===!0);if(y.length===0)return null;const p={},h={};y.forEach(s=>{let x=1;if(s.EndTiming){const v=te(s.EndTiming);v&&(x=v)}s.PlayerStats.forEach(v=>{if(S&&S!=="Tous les camps"&&ce(v.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})!==S)return;const R=v.Username;p[R]||(p[R]={playerName:R,totalGames:0,survivalsByDay:{},survivalRatesByDay:{},gamesPlayedByDay:{}});const A=p[R];A.totalGames++;let z=null;v.DeathTiming&&(z=te(v.DeathTiming));for(let T=1;T<=x;T++)A.gamesPlayedByDay[T]||(A.gamesPlayedByDay[T]=0,A.survivalsByDay[T]=0),h[T]||(h[T]={gamesReachingDay:0,playersOnDay:0,survivorsOnDay:0}),A.gamesPlayedByDay[T]++,h[T].playersOnDay++,(!z||z>T)&&(A.survivalsByDay[T]++,h[T].survivorsOnDay++)});for(let v=1;v<=x;v++)h[v]||(h[v]={gamesReachingDay:0,playersOnDay:0,survivorsOnDay:0}),h[v].gamesReachingDay++}),Object.values(p).forEach(s=>{Object.keys(s.gamesPlayedByDay).forEach(x=>{const v=parseInt(x),R=s.gamesPlayedByDay[v],A=s.survivalsByDay[v];R>0?s.survivalRatesByDay[v]=A/R*100:s.survivalRatesByDay[v]=0})});const K=Object.values(p).filter(s=>s.totalGames>0).sort((s,x)=>x.totalGames-s.totalGames),H=Object.entries(h).map(([s,x])=>({dayNumber:parseInt(s),totalGamesReachingDay:x.gamesReachingDay,totalPlayersOnDay:x.playersOnDay,averageSurvivalRate:x.playersOnDay>0?x.survivorsOnDay/x.playersOnDay*100:0})).sort((s,x)=>s.dayNumber-x.dayNumber);return{totalGames:y.length,totalPlayersAnalyzed:K.length,playerSurvivalStats:K,dayStats:H}}function he(n,S,y=10){return n.playerSurvivalStats.filter(p=>p.totalGames>=y&&(p.gamesPlayedByDay[S]||0)>0).map(p=>({playerName:p.playerName,survivalRate:p.survivalRatesByDay[S]||0,gamesPlayed:p.totalGames,timesReachedDay:p.gamesPlayedByDay[S]||0,timesSurvivedDay:p.survivalsByDay[S]||0})).sort((p,h)=>h.survivalRate-p.survivalRate).slice(0,15)}function ge(n,S,y=10){return n.playerSurvivalStats.filter(p=>p.totalGames>=y&&(p.gamesPlayedByDay[S]||0)>0).map(p=>({playerName:p.playerName,survivalRate:p.survivalRatesByDay[S]||0,gamesPlayed:p.totalGames,timesReachedDay:p.gamesPlayedByDay[S]||0,timesSurvivedDay:p.survivalsByDay[S]||0})).sort((p,h)=>p.survivalRate-h.survivalRate).slice(0,15)}function me(n){return oe(S=>de(S,n))}function ue({deathStats:n,selectedCamp:S,victimCampFilter:y,minGamesForAverage:p,onMinGamesChange:h,availableDeathTypes:K,deathTypeColors:H,totalEligibleForAverage:s}){const{navigateToGameDetails:x}=J(),{settings:v}=_(),R=a=>{if(y==="Tous les camps"){const t=a.filter(l=>l!==L.BULLET_HUMAN&&l!==L.BULLET_WOLF);return(a.includes(L.BULLET_HUMAN)||a.includes(L.BULLET_WOLF))&&!t.includes(L.BULLET)&&t.push(L.BULLET),t}return a},A=M.useMemo(()=>R(K),[K,y]),z=M.useMemo(()=>{const a={...H};if(y==="Tous les camps"&&!a[L.BULLET]){const t=H[L.BULLET_HUMAN]||H[L.BULLET_WOLF];t&&(a[L.BULLET]=t)}return a},[H,y]),T=a=>{if(y==="Tous les camps"){const t=a.killsByDeathType[L.BULLET_HUMAN]||0,l=a.killsByDeathType[L.BULLET_WOLF]||0,d=a.killsByDeathType[L.BULLET]||0,m={...a.killsByDeathType};return m[L.BULLET]=t+l+d,delete m[L.BULLET_HUMAN],delete m[L.BULLET_WOLF],{...a,killsByDeathType:m}}return a},C=a=>{let t="Top Tueurs";return S!=="Tous les camps"&&(t+=` en ${S}`),y!=="Tous les camps"&&(y==="Roles solo"?t+=" (victimes: Roles solo)":t+=` (victimes: ${y})`),a==="total"?t+=" (Total)":t+=" (Moyenne par Partie)",t},{totalKillsData:b,averageKillsData:j,highlightedPlayerAddedToTotal:N,highlightedPlayerAddedToAverage:c}=M.useMemo(()=>{if(!n)return{totalKillsData:[],averageKillsData:[],highlightedPlayerAddedToTotal:!1,highlightedPlayerAddedToAverage:!1};const a=n.killerStats.sort((o,u)=>u.kills-o.kills).slice(0,15),t=v.highlightedPlayer&&a.some(o=>o.killerName===v.highlightedPlayer),l=a.map(o=>{const u=T(o),B={name:u.killerName,value:u.kills,victims:u.victims.length,percentage:u.percentage,gamesPlayed:u.gamesPlayed,averageKillsPerGame:u.averageKillsPerGame,isHighlightedAddition:!1};return A.forEach(D=>{B[D]=u.killsByDeathType[D]||0}),B});let d=!1;if(v.highlightedPlayer&&!t){const o=n.killerStats.find(u=>u.killerName===v.highlightedPlayer);if(o){const u=T(o),B={name:u.killerName,value:u.kills,victims:u.victims.length,percentage:u.percentage,gamesPlayed:u.gamesPlayed,averageKillsPerGame:u.averageKillsPerGame,isHighlightedAddition:!0};A.forEach(D=>{B[D]=u.killsByDeathType[D]||0}),l.push(B),d=!0}}const i=n.killerStats.filter(o=>o.gamesPlayed>=p).sort((o,u)=>u.averageKillsPerGame-o.averageKillsPerGame).slice(0,15),r=v.highlightedPlayer&&i.some(o=>o.killerName===v.highlightedPlayer),f=i.map(o=>{const u=T(o),B={name:u.killerName,value:u.averageKillsPerGame,victims:u.victims.length,percentage:u.percentage,gamesPlayed:u.gamesPlayed,averageKillsPerGame:u.averageKillsPerGame,isHighlightedAddition:!1};return A.forEach(D=>{const I=u.killsByDeathType[D]||0;B[D]=u.gamesPlayed>0?I/u.gamesPlayed:0}),B});let k=!1;if(v.highlightedPlayer&&!r){const o=n.killerStats.find(u=>u.killerName===v.highlightedPlayer);if(o){const u=T(o),B={name:u.killerName,value:u.averageKillsPerGame,victims:u.victims.length,percentage:u.percentage,gamesPlayed:u.gamesPlayed,averageKillsPerGame:u.averageKillsPerGame,isHighlightedAddition:!0};A.forEach(D=>{const I=u.killsByDeathType[D]||0;B[D]=u.gamesPlayed>0?I/u.gamesPlayed:0}),f.push(B),k=!0}}return{totalKillsData:l,averageKillsData:f,highlightedPlayerAddedToTotal:d,highlightedPlayerAddedToAverage:k}},[n,v.highlightedPlayer,p,A,y]),g=({active:a,payload:t,label:l})=>{if(a&&t&&t.length){const d=t[0].payload,m=d.isHighlightedAddition,i=v.highlightedPlayer===d.name,r=A.reduce((f,k)=>f+(d[k]||0),0);return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:i?"var(--accent-primary)":"var(--text-primary)"},children:[l,m&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Victimes totales:"})," ",r]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouÃ©es:"})," ",d.gamesPlayed]}),e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"RÃ©partition par type de kill:"}),A.map(f=>({deathType:f,count:d[f]||0})).filter(f=>f.count>0).sort((f,k)=>k.count-f.count).map(({deathType:f,count:k})=>e.jsxs("p",{style:{color:z[f],margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[Q(f),":"]})," ",k]},f))]}),m&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"}),i&&!m&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},P=({active:a,payload:t,label:l})=>{if(a&&t&&t.length){const d=t[0].payload,m=d.isHighlightedAddition,i=v.highlightedPlayer===d.name,r=d.gamesPlayed>=p,f=n?.killerStats.find(B=>B.killerName===d.name),k=f?T(f):null,o=A.reduce((B,D)=>B+(d[D]||0),0),u=k?k.kills:Math.round(o*d.gamesPlayed);return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:i?"var(--accent-primary)":"var(--text-primary)"},children:[l,m&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Moyenne par partie:"})," ",o.toFixed(2)," (",u," kills /",d.gamesPlayed," games)"]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouÃ©es:"})," ",d.gamesPlayed]}),e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"RÃ©partition par type de kill (moyenne):"}),A.map(B=>({deathType:B,avgCount:d[B]||0,totalKillsForDeathType:k?k.killsByDeathType[B]||0:Math.round((d[B]||0)*d.gamesPlayed)})).filter(B=>B.avgCount>0).sort((B,D)=>D.avgCount-B.avgCount).map(({deathType:B,avgCount:D,totalKillsForDeathType:I})=>e.jsxs("p",{style:{color:z[B],margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[Q(B),":"]})," ",D.toFixed(2)," (",I," kills /",d.gamesPlayed," games)"]},B))]}),m&&!r&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",p," parties)"]}),m&&r&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"}),i&&!m&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null};return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:C("total")}),N&&v.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',v.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(W,{title:C("total"),children:e.jsx("div",{style:{height:440},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(F,{data:b,margin:{top:60,right:30,left:20,bottom:10},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:a,y:t,payload:l})=>e.jsx("text",{x:a,y:t,dy:10,fill:v.highlightedPlayer===l.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:v.highlightedPlayer===l.value?14:12,fontWeight:v.highlightedPlayer===l.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${a} ${t})`,children:l.value})}),e.jsx(G,{label:{value:"Nombre total de victimes",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(g,{})}),A.map(a=>e.jsx($,{dataKey:a,name:a,stackId:"kills",fill:z[a],onClick:t=>{const l={selectedPlayer:t?.name,fromComponent:"Statistiques de Mort"};S!=="Tous les camps"&&(l.campFilter={selectedCamp:S,campFilterMode:"all-assignments"}),x(l)}},a))]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,b.filter(a=>!a.isHighlightedAddition).length)," des tueurs les plus actifs (total)"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:C("average")}),c&&v.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',v.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"min-games-average-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-average-select",value:p,onChange:a=>h(Number(a.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:Y.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsx(W,{title:C("average"),children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(F,{data:j,margin:{top:20,right:30,left:20,bottom:10},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:a,y:t,payload:l})=>e.jsx("text",{x:a,y:t,dy:10,fill:v.highlightedPlayer===l.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:v.highlightedPlayer===l.value?14:12,fontWeight:v.highlightedPlayer===l.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${a} ${t})`,children:l.value})}),e.jsx(G,{label:{value:"Moyenne de victimes par partie",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(P,{})}),A.map(a=>e.jsx($,{dataKey:a,name:a,stackId:"averageKills",fill:z[a],onClick:t=>{const l={selectedPlayer:t?.name,fromComponent:"Statistiques de Mort"};S!=="Tous les camps"&&(l.campFilter={selectedCamp:S,campFilterMode:"all-assignments"}),x(l)}},a))]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,j.filter(a=>!a.isHighlightedAddition).length)," des tueurs les plus efficaces (sur ",s," ayant au moins ",p," partie",p>1?"s":"",")"]})]})]})}function ye({deathStats:n,selectedCamp:S,minGamesForAverage:y,onMinGamesChange:p,availableDeathTypes:h,deathTypeColors:K}){const{navigateToGameDetails:H}=J(),{settings:s}=_(),{joueursData:x}=Z(),v=X(x),[R,A]=M.useState(null),{totalDeathsData:z,survivalRateData:T,highlightedPlayerAddedToDeaths:C,highlightedPlayerAddedToSurvival:b}=M.useMemo(()=>{if(!n)return{totalDeathsData:[],survivalRateData:[],highlightedPlayerAddedToDeaths:!1,highlightedPlayerAddedToSurvival:!1};const c=n.playerDeathStats.sort((r,f)=>f.totalDeaths-r.totalDeaths).slice(0,15),g=s.highlightedPlayer&&c.some(r=>r.playerName===s.highlightedPlayer),P=c.map(r=>{const f=r.gamesPlayed,k=f>0?(f-r.totalDeaths)/f*100:0,o={name:r.playerName,value:r.totalDeaths,totalDeaths:r.totalDeaths,gamesPlayed:f,deathRate:r.deathRate,survivalRate:k,isHighlightedAddition:!1};return h.forEach(u=>{o[u]=r.deathsByType[u]||0}),o});let a=!1;if(s.highlightedPlayer&&!g){const r=n.playerDeathStats.find(f=>f.playerName===s.highlightedPlayer);if(r){const f=r.gamesPlayed,k=f>0?(f-r.totalDeaths)/f*100:0,o={name:r.playerName,value:r.totalDeaths,totalDeaths:r.totalDeaths,gamesPlayed:f,deathRate:r.deathRate,survivalRate:k,isHighlightedAddition:!0};h.forEach(u=>{o[u]=r.deathsByType[u]||0}),P.push(o),a=!0}}const l=n.playerDeathStats.filter(r=>r.gamesPlayed>=y).map(r=>({...r,survivalRate:r.gamesPlayed>0?(r.gamesPlayed-r.totalDeaths)/r.gamesPlayed*100:0})).sort((r,f)=>f.survivalRate-r.survivalRate).slice(0,15),d=s.highlightedPlayer&&l.some(r=>r.playerName===s.highlightedPlayer),m=l.map(r=>{const f={name:r.playerName,value:r.survivalRate,totalDeaths:r.totalDeaths,gamesPlayed:r.gamesPlayed,deathRate:r.deathRate,survivalRate:r.survivalRate,isHighlightedAddition:!1};return h.forEach(k=>{f[k]=r.deathsByType[k]||0}),f});let i=!1;if(s.highlightedPlayer&&!d){const r=n.playerDeathStats.find(f=>f.playerName===s.highlightedPlayer);if(r){const f=r.gamesPlayed>0?(r.gamesPlayed-r.totalDeaths)/r.gamesPlayed*100:0,k={name:r.playerName,value:f,totalDeaths:r.totalDeaths,gamesPlayed:r.gamesPlayed,deathRate:r.deathRate,survivalRate:f,isHighlightedAddition:!0};h.forEach(o=>{k[o]=r.deathsByType[o]||0}),m.push(k),i=!0}}return{totalDeathsData:P,survivalRateData:m,highlightedPlayerAddedToDeaths:a,highlightedPlayerAddedToSurvival:i}},[n,s.highlightedPlayer,y,h]),j=({active:c,payload:g,label:P})=>{if(c&&g&&g.length){const a=g[0].payload,t=a.isHighlightedAddition,l=s.highlightedPlayer===a.name,d=h.reduce((m,i)=>m+(a[i]||0),0);return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:l?"var(--accent-primary)":"var(--text-primary)"},children:[P,t&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Morts totales:"})," ",d]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouÃ©es:"})," ",a.gamesPlayed]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Taux de survie:"})," ",a.survivalRate.toFixed(1),"%"]}),e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"RÃ©partition par type de mort:"}),h.map(m=>{const i=a[m]||0;return i===0?null:e.jsxs("p",{style:{color:K[m],margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[ee(m),":"]})," ",i]},m)})]}),t&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"}),l&&!t&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},N=({active:c,payload:g,label:P})=>{if(c&&g&&g.length){const a=g[0].payload,t=a.isHighlightedAddition,l=s.highlightedPlayer===a.name,d=a.gamesPlayed>=y;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:l?"var(--accent-primary)":"var(--text-primary)"},children:[P,t&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Taux de survie:"})," ",a.survivalRate.toFixed(1),"% (",a.gamesPlayed-a.totalDeaths," survies / ",a.gamesPlayed," parties)"]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Morts totales:"})," ",a.totalDeaths]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouÃ©es:"})," ",a.gamesPlayed]}),e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"RÃ©partition par type de mort:"}),h.map(m=>{const i=a[m]||0;return i===0?null:e.jsxs("p",{style:{color:K[m],margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[ee(m),":"]})," ",i]},m)})]}),t&&!d&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",y," parties)"]}),t&&d&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"}),l&&!t&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null};return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:S==="Tous les camps"?"Morts (Total)":`Morts en ${S} (Total)`}),C&&s.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',s.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(W,{title:S==="Tous les camps"?"Morts (Total)":`Morts en ${S} (Total)`,children:e.jsx("div",{style:{height:440},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(F,{data:z,margin:{top:60,right:30,left:20,bottom:10},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:c,y:g,payload:P})=>e.jsx("text",{x:c,y:g,dy:10,fill:s.highlightedPlayer===P.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:s.highlightedPlayer===P.value?14:12,fontWeight:s.highlightedPlayer===P.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${c} ${g})`,children:P.value})}),e.jsx(G,{label:{value:"Nombre total de morts",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(j,{})}),h.map(c=>e.jsx($,{dataKey:c,name:c,stackId:"deaths",fill:K[c],onClick:g=>{const P={selectedPlayer:g?.name,fromComponent:"Statistiques de Mort"};S!=="Tous les camps"&&(P.campFilter={selectedCamp:S,campFilterMode:"all-assignments"}),H(P)}},c))]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,z.filter(c=>!c.isHighlightedAddition).length)," des joueurs les plus souvent morts"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsxs("h3",{children:["Meilleurs Survivants ",S==="Tous les camps"?"(Total)":` en ${S}`]}),b&&s.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',s.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"min-games-survival-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-survival-select",value:y,onChange:c=>p(Number(c.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:Y.map(c=>e.jsx("option",{value:c,children:c},c))})]}),e.jsx(W,{title:"Meilleurs Survivants",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(F,{data:T,margin:{top:20,right:30,left:20,bottom:10},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:c,y:g,payload:P})=>e.jsx("text",{x:c,y:g,dy:10,fill:s.highlightedPlayer===P.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:s.highlightedPlayer===P.value?14:12,fontWeight:s.highlightedPlayer===P.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${c} ${g})`,children:P.value})}),e.jsx(G,{label:{value:"Taux de survie (%)",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(N,{})}),e.jsx($,{dataKey:"value",onClick:c=>{const g={selectedPlayer:c?.name,fromComponent:"Statistiques de Mort"};S!=="Tous les camps"&&(g.campFilter={selectedCamp:S,campFilterMode:"all-assignments"}),H(g)},onMouseEnter:c=>A(c?.name||null),onMouseLeave:()=>A(null),style:{cursor:"pointer"},children:T.map((c,g)=>{const P=s.highlightedPlayer===c.name,a=c.isHighlightedAddition;return e.jsx(U,{fill:v[c.name]||"var(--chart-primary)",stroke:P?"var(--accent-primary)":R===c.name?"var(--text-primary)":"none",strokeWidth:P?3:R===c.name?2:0,strokeDasharray:a?"5,5":"none",opacity:a?.8:1},`cell-${g}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,T.filter(c=>!c.isHighlightedAddition).length)," des joueurs avec le plus haut taux de survie (ayant au moins ",y," partie",y>1?"s":"",")"]})]})]})}function ve({hunterStats:n,isLoading:S,error:y}){const{navigateToGameDetails:p}=J(),{settings:h}=_(),K=ie(),{joueursData:H}=Z(),s=X(H),[x,v]=M.useState(null);if(S)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques chasseurs..."});if(y)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",y]});if(!n||n.hunterStats.length===0)return e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e Chasseur"}),e.jsx("p",{children:"Aucune statistique de chasseur disponible avec les filtres actuels."})]});const{finalBestHuntersData:R,highlightedPlayerAddedToBest:A,finalBadHuntersData:z,highlightedPlayerAddedToBad:T}=(()=>{const N=n.hunterStats.filter(i=>i.gamesPlayedAsHunter>=5).sort((i,r)=>r.averageNonVillageoisKillsPerGame-i.averageNonVillageoisKillsPerGame).slice(0,15),c=h.highlightedPlayer&&N.some(i=>i.hunterName===h.highlightedPlayer);let g=[...N],P=!1;if(h.highlightedPlayer&&!c){const i=n.hunterStats.find(r=>r.hunterName===h.highlightedPlayer);i&&(g.push({...i,isHighlightedAddition:!0}),P=!0)}const a=n.hunterStats.filter(i=>i.gamesPlayedAsHunter>=5).map(i=>({name:i.hunterName,averageVillageoisKills:Number((i.villageoisKills/i.gamesPlayedAsHunter).toFixed(2)),totalVillageoisKills:i.villageoisKills,totalNonVillageoisKills:i.nonVillageoisKills,totalKills:i.totalKills,gamesPlayed:i.gamesPlayedAsHunter,victimsByCamp:i.victimsByCamp,goodVictimsByCamp:i.goodVictimsByCamp,badVictimsByCamp:i.badVictimsByCamp,hunterName:i.hunterName})),t=a.sort((i,r)=>r.averageVillageoisKills-i.averageVillageoisKills).slice(0,15),l=h.highlightedPlayer&&t.some(i=>i.hunterName===h.highlightedPlayer);let d=[...t],m=!1;if(h.highlightedPlayer&&!l){const i=a.find(r=>r.hunterName===h.highlightedPlayer);i&&(d.push({...i,isHighlightedAddition:!0}),m=!0)}return{finalBestHuntersData:g,highlightedPlayerAddedToBest:P,finalBadHuntersData:d,highlightedPlayerAddedToBad:m}})(),C=({active:j,payload:N,label:c})=>{if(j&&N&&N.length){const g=N[0].payload,P=g.isHighlightedAddition,a=h.highlightedPlayer===g.hunterName;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:a?"var(--accent-primary)":"var(--text-primary)"},children:[c,P&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Kills non-Villageois/partie:"})," ",g.averageNonVillageoisKillsPerGame.toFixed(2)]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Total non-Villageois tuÃ©s:"})," ",g.nonVillageoisKills]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties en Chasseur:"})," ",g.gamesPlayedAsHunter]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Total kills:"})," ",g.totalKills]}),g.goodVictimsByCamp&&Object.keys(g.goodVictimsByCamp).length>0&&e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"Bonnes victimes:"}),Object.entries(g.goodVictimsByCamp).map(([t,l])=>e.jsxs("p",{style:{color:K[t]||"var(--text-secondary)",margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[t,":"]})," ",l]},t))]}),P&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"}),a&&!P&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},b=({active:j,payload:N,label:c})=>{if(j&&N&&N.length){const g=N[0].payload,P=g.isHighlightedAddition,a=h.highlightedPlayer===g.hunterName;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:a?"var(--accent-primary)":"var(--text-primary)"},children:[c,P&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (ðŸŽ¯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Villageois tuÃ©s/partie:"})," ",g.averageVillageoisKills]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Total Villageois tuÃ©s:"})," ",g.totalVillageoisKills]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Total non-Villageois tuÃ©s:"})," ",g.totalNonVillageoisKills]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties en Chasseur:"})," ",g.gamesPlayed]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Total kills:"})," ",g.totalKills]}),g.badVictimsByCamp&&Object.keys(g.badVictimsByCamp).length>0&&e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"Mauvaises victimes:"}),Object.entries(g.badVictimsByCamp).map(([t,l])=>e.jsxs("p",{style:{color:K[t]||"var(--text-secondary)",margin:"2px 0",fontSize:"0.8rem"},children:[e.jsxs("strong",{children:[t,":"]})," ",l]},t))]}),P&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"}),a&&!P&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null};return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Bons Chasseurs"}),A&&h.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',h.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(W,{title:"Bons Chasseurs",children:e.jsx("div",{style:{height:440},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(F,{data:R,margin:{top:60,right:30,left:20,bottom:10},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"hunterName",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:j,y:N,payload:c})=>e.jsx("text",{x:j,y:N,dy:10,fill:h.highlightedPlayer===c.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:h.highlightedPlayer===c.value?14:12,fontWeight:h.highlightedPlayer===c.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${j} ${N})`,children:c.value})}),e.jsx(G,{label:{value:"Moyenne kills non-Villageois/partie",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(C,{})}),e.jsx($,{dataKey:"averageNonVillageoisKillsPerGame",fill:"var(--chart-primary)",onClick:j=>{j?.hunterName&&p({selectedPlayer:j.hunterName,campFilter:{selectedCamp:"Chasseur",campFilterMode:"all-assignments"},fromComponent:"Statistiques de Mort - Bons Chasseurs"})},onMouseEnter:j=>v(j?.hunterName||null),onMouseLeave:()=>v(null),style:{cursor:"pointer"},children:R.map((j,N)=>{const c=h.highlightedPlayer===j.hunterName,g=j.isHighlightedAddition;return e.jsx(U,{fill:s[j.hunterName]||K.Chasseur||"#8884d8",stroke:c?"var(--accent-primary)":x===j.hunterName?"var(--text-primary)":"none",strokeWidth:c?3:x===j.hunterName?2:0,strokeDasharray:g?"5,5":"none",opacity:g?.8:1},`cell-${N}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,R.filter(j=>!j.isHighlightedAddition).length)," des chasseurs les plus efficaces contre les non-Villageois (minimum 5 parties en Chasseur)"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Mauvais Chasseurs"}),T&&h.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',h.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(W,{title:"Mauvais Chasseurs",children:e.jsx("div",{style:{height:440},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(F,{data:z,margin:{top:60,right:30,left:20,bottom:10},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"hunterName",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:j,y:N,payload:c})=>e.jsx("text",{x:j,y:N,dy:10,fill:h.highlightedPlayer===c.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:h.highlightedPlayer===c.value?14:12,fontWeight:h.highlightedPlayer===c.value?"bold":"normal",textAnchor:"end",transform:`rotate(-45 ${j} ${N})`,children:c.value})}),e.jsx(G,{label:{value:"Moyenne Villageois tuÃ©s/partie",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(b,{})}),e.jsx($,{dataKey:"averageVillageoisKills",fill:"var(--chart-primary)",onClick:j=>{j?.hunterName&&p({selectedPlayer:j.hunterName,campFilter:{selectedCamp:"Chasseur",campFilterMode:"all-assignments"},fromComponent:"Statistiques de Mort - Mauvais Chasseurs"})},onMouseEnter:j=>v(j?.hunterName||null),onMouseLeave:()=>v(null),style:{cursor:"pointer"},children:z.map((j,N)=>{const c=h.highlightedPlayer===j.hunterName,g=j.isHighlightedAddition;return e.jsx(U,{fill:s[j.hunterName]||K.Chasseur||"#8884d8",stroke:c?"var(--accent-primary)":x===j.hunterName?"var(--text-primary)":"none",strokeWidth:c?3:x===j.hunterName?2:0,strokeDasharray:g?"5,5":"none",opacity:g?.8:1},`cell-${N}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,z.filter(j=>!j.isHighlightedAddition).length)," des chasseurs ayant le plus tuÃ© de Villageois (minimum 5 parties en Chasseur)"]})]})]})}function pe({survivalStats:n,selectedCamp:S,minGamesForAverage:y,onMinGamesChange:p,isLoading:h,error:K}){const{navigateToGameDetails:H}=J(),{settings:s}=_(),{joueursData:x}=Z(),v=X(x),[R,A]=M.useState(1),[z,T]=M.useState(null),C=M.useMemo(()=>n?n.dayStats.filter(l=>l.totalGamesReachingDay>0).map(l=>l.dayNumber).sort((l,d)=>l-d):[],[n]),b=M.useMemo(()=>C.includes(R)?R:C.length>0?C[0]:1,[R,C]),{highestSurvivalData:j,highlightedPlayerAddedToHighest:N}=M.useMemo(()=>{if(!n)return{highestSurvivalData:[],highlightedPlayerAddedToHighest:!1};const t=he(n,b,y),l=s.highlightedPlayer&&t.some(i=>i.playerName===s.highlightedPlayer),d=t.map(i=>({name:i.playerName,value:i.survivalRate,gamesPlayed:i.gamesPlayed,timesReachedDay:i.timesReachedDay,timesSurvivedDay:i.timesSurvivedDay,isHighlightedAddition:!1}));let m=!1;if(s.highlightedPlayer&&!l){const i=n.playerSurvivalStats.find(r=>r.playerName===s.highlightedPlayer);if(i&&i.totalGames>=y&&(i.gamesPlayedByDay[b]||0)>0){const r=i.survivalRatesByDay[b]||0;d.push({name:s.highlightedPlayer,value:r,gamesPlayed:i.totalGames,timesReachedDay:i.gamesPlayedByDay[b]||0,timesSurvivedDay:i.survivalsByDay[b]||0,isHighlightedAddition:!0}),m=!0}}return{highestSurvivalData:d,highlightedPlayerAddedToHighest:m}},[n,b,y,s.highlightedPlayer]),{lowestSurvivalData:c,highlightedPlayerAddedToLowest:g}=M.useMemo(()=>{if(!n)return{lowestSurvivalData:[],highlightedPlayerAddedToLowest:!1};const t=ge(n,b,y),l=s.highlightedPlayer&&t.some(i=>i.playerName===s.highlightedPlayer),d=t.map(i=>({name:i.playerName,value:i.survivalRate,gamesPlayed:i.gamesPlayed,timesReachedDay:i.timesReachedDay,timesSurvivedDay:i.timesSurvivedDay,isHighlightedAddition:!1}));let m=!1;if(s.highlightedPlayer&&!l){const i=n.playerSurvivalStats.find(r=>r.playerName===s.highlightedPlayer);if(i&&i.totalGames>=y&&(i.gamesPlayedByDay[b]||0)>0){const r=i.survivalRatesByDay[b]||0;d.push({name:s.highlightedPlayer,value:r,gamesPlayed:i.totalGames,timesReachedDay:i.gamesPlayedByDay[b]||0,timesSurvivedDay:i.survivalsByDay[b]||0,isHighlightedAddition:!0}),m=!0}}return{lowestSurvivalData:d,highlightedPlayerAddedToLowest:m}},[n,b,y,s.highlightedPlayer]),P=t=>{H({selectedPlayer:t,fromComponent:"Statistiques de Survie"})},a=({active:t,payload:l,label:d})=>{if(t&&l&&l.length>0){const m=l[0].payload,i=m.isHighlightedAddition,r=s.highlightedPlayer===m.name,f=m.gamesPlayed>=y,k=m.timesReachedDay-m.timesSurvivedDay;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:d})}),e.jsx("div",{children:e.jsxs("span",{style:{color:"var(--accent-primary)"},children:["Taux de survie Jour ",b,": ",m.value.toFixed(1),"%"]})}),e.jsxs("div",{children:["Parties atteignant le Jour ",b,": ",m.timesReachedDay]}),e.jsxs("div",{children:["A survÃ©cu au Jour ",b,": ",m.timesSurvivedDay]}),e.jsxs("div",{children:["N'a pas survÃ©cu au Jour ",b,": ",k]}),e.jsxs("div",{children:["Total de parties: ",m.gamesPlayed]}),i&&!f&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",y," parties au total)"]}),i&&f&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"}),r&&!i&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null};return h?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de survie..."}):K?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",K]}):n?e.jsxs("div",{className:"lycans-survival-stats",children:[e.jsx("div",{className:"lycans-graphique-controles",style:{marginBottom:"1.5rem"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"day-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Jour :"}),e.jsx("select",{id:"day-select",value:b,onChange:t=>A(parseInt(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"80px"},children:C.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"min-games-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Min. parties :"}),e.jsx("select",{id:"min-games-select",value:y,onChange:t=>p(parseInt(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"80px"},children:Y.map(t=>e.jsx("option",{value:t,children:t},t))})]})]})}),b&&n.dayStats.find(t=>t.dayNumber===b)&&e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:b===1?"Total des parties enregistrÃ©es":`Parties atteignant le Jour ${b}`}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary)"},children:n.dayStats.find(t=>t.dayNumber===b)?.totalGamesReachingDay||0})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsxs("h3",{children:["Taux de survie moyen Jour ",b]}),e.jsxs("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)"},children:[(n.dayStats.find(t=>t.dayNumber===b)?.averageSurvivalRate||0).toFixed(1),"%"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsxs("h3",{children:["Joueurs Ã©ligibles (min. ",y," parties)"]}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-1)"},children:n.playerSurvivalStats.filter(t=>t.totalGames>=y&&(t.gamesPlayedByDay[b]||0)>0).length})]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsxs("h3",{children:["ðŸ›¡ï¸ Meilleurs Taux de Survie - Jour ",b]}),N&&s.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',s.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(W,{title:`ðŸ›¡ï¸ Meilleurs Taux de Survie - Jour ${b}`,children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(F,{data:j,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(V,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(q,{dataKey:"name",angle:-45,textAnchor:"end",height:80,tick:({x:t,y:l,payload:d})=>e.jsx("text",{x:t,y:l,dy:16,textAnchor:"end",transform:`rotate(-45, ${t}, ${l})`,fill:s.highlightedPlayer===d.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:s.highlightedPlayer===d.value?14:12,fontWeight:s.highlightedPlayer===d.value?"bold":"normal",children:d.value})}),e.jsx(G,{tickFormatter:t=>`${t.toFixed(0)}%`,tick:{fill:"var(--text-secondary)"},label:{value:"Taux de survie (%)",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(a,{})}),e.jsx($,{dataKey:"value",name:"Taux de survie",cursor:"pointer",children:j.map((t,l)=>{const d=s.highlightedPlayer===t.name,m=z===t.name,i=t.isHighlightedAddition;return e.jsx(U,{fill:v[t.name]||"var(--chart-primary)",stroke:d?"var(--accent-primary)":m?"var(--text-primary)":"none",strokeWidth:d?3:m?2:0,strokeDasharray:i?"5,5":"none",opacity:i?.8:1,onClick:()=>P(t.name),onMouseEnter:()=>T(t.name),onMouseLeave:()=>T(null),style:{cursor:"pointer"}},`cell-highest-${l}`)})})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsxs("h3",{children:["âš°ï¸ Plus Faibles Taux de Survie - Jour ",b]}),g&&s.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',s.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(W,{title:`âš°ï¸ Plus Faibles Taux de Survie - Jour ${b}`,children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(F,{data:c,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(V,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(q,{dataKey:"name",angle:-45,textAnchor:"end",height:80,tick:({x:t,y:l,payload:d})=>e.jsx("text",{x:t,y:l,dy:16,textAnchor:"end",transform:`rotate(-45, ${t}, ${l})`,fill:s.highlightedPlayer===d.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:s.highlightedPlayer===d.value?14:12,fontWeight:s.highlightedPlayer===d.value?"bold":"normal",children:d.value})}),e.jsx(G,{tickFormatter:t=>`${t.toFixed(0)}%`,tick:{fill:"var(--text-secondary)"},label:{value:"Taux de survie (%)",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(a,{})}),e.jsx($,{dataKey:"value",name:"Taux de survie",cursor:"pointer",children:c.map((t,l)=>{const d=s.highlightedPlayer===t.name,m=z===t.name,i=t.isHighlightedAddition;return e.jsx(U,{fill:v[t.name]||"var(--chart-color-4)",stroke:d?"var(--accent-primary)":m?"var(--text-primary)":"none",strokeWidth:d?3:m?2:0,strokeDasharray:i?"5,5":"none",opacity:i?.8:1,onClick:()=>P(t.name),onMouseEnter:()=>T(t.name),onMouseLeave:()=>T(null),style:{cursor:"pointer"}},`cell-lowest-${l}`)})})]})})})})]}),e.jsxs("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:[e.jsx("p",{children:`Un "Jour" reprÃ©sente un cycle complet composÃ© d'une phase de jour, d'une phase de nuit, et d'une rÃ©union. Par exemple, le Jour 2 signifie que le joueur a survÃ©cu au deuxiÃ¨me cycle jour/nuit/rÃ©union.`}),e.jsxs("p",{children:["Les statistiques de survie montrent le pourcentage de fois qu'un joueur survit au Jour ",b," parmi toutes les parties qu'il a jouÃ©es et qui ont atteint ce jour. ",N||g?"Les joueurs mis en Ã©vidence apparaissent mÃªme s'ils ne sont pas dans le top 15.":""]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de survie disponible"})}function Be(){const{navigationState:n,updateNavigationState:S}=J(),[y,p]=M.useState(n.deathStatisticsState?.selectedCamp||n.deathStatsSelectedCamp||"Tous les camps"),[h,K]=M.useState(n.deathStatisticsState?.victimCampFilter||"Tous les camps"),[H,s]=M.useState(n.deathStatisticsState?.minGamesForAverage||25),[x,v]=M.useState(n.deathStatisticsState?.selectedView||"killers"),{data:R}=re(),{data:A,isLoading:z,error:T}=se(y,h),{data:C,isLoading:b,error:j}=le(),{data:N,isLoading:c,error:g}=me(y),{data:P}=ae(),a=ie();M.useEffect(()=>{(!n.deathStatisticsState||n.deathStatisticsState.selectedCamp!==y||n.deathStatisticsState.victimCampFilter!==h||n.deathStatisticsState.minGamesForAverage!==H||n.deathStatisticsState.selectedView!==x)&&S({deathStatisticsState:{selectedCamp:y,victimCampFilter:h,minGamesForAverage:H,selectedView:x,focusChart:n.deathStatisticsState?.focusChart}})},[y,h,H,x,n.deathStatisticsState,S]);const t=M.useMemo(()=>P?ne(P):[],[P]),l=M.useMemo(()=>{const o={};t.forEach(D=>{D===E.BY_WOLF?o[D]=a.Loup:D===E.VOTED?o[D]="var(--chart-color-1)":D===E.BULLET||D===E.BULLET_HUMAN||D===E.BULLET_WOLF?o[D]=a.Chasseur:D===E.BY_ZOMBIE?o[D]=a.Vaudou:D===E.ASSASSIN?o[D]=a.Alchimiste:D===E.AVENGER?o[D]="var(--chart-color-2)":D===E.LOVER_DEATH?o[D]=a.Amoureux:D===E.BY_BEAST?o[D]="var(--chart-color-3)":D===E.SHERIF_SUCCESS&&(o[D]="var(--chart-color-4)")});const u=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let B=0;return t.forEach(D=>{o[D]||(o[D]=u[B%u.length],B++)}),o},[t,a]),d=o=>{p(o),S({deathStatsSelectedCamp:o,deathStatisticsState:{selectedCamp:o,victimCampFilter:h,minGamesForAverage:H,selectedView:x,focusChart:n.deathStatisticsState?.focusChart}})},m=o=>{K(o),S({deathStatisticsState:{selectedCamp:y,victimCampFilter:o,minGamesForAverage:H,selectedView:x,focusChart:n.deathStatisticsState?.focusChart}})},i=o=>{s(o),S({deathStatisticsState:{selectedCamp:y,victimCampFilter:h,minGamesForAverage:o,selectedView:x,focusChart:n.deathStatisticsState?.focusChart}})},r=o=>{v(o),S({deathStatisticsState:{selectedCamp:y,victimCampFilter:h,minGamesForAverage:H,selectedView:o,focusChart:n.deathStatisticsState?.focusChart}})},{gamesWithKillers:f,totalEligibleForAverage:k}=M.useMemo(()=>{if(!A)return{gamesWithKillers:0,totalEligibleForAverage:0};const o=A.killerStats.filter(u=>u.gamesPlayed>=H);return{gamesWithKillers:A.totalGames,totalEligibleForAverage:o.length}},[A,H]);return z?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de mort..."}):T?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",T]}):A?e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"ðŸ’€ Statistiques de Morts & Kills"}),e.jsxs("div",{className:"lycans-categories-selection",children:[e.jsx("button",{className:`lycans-categorie-btn ${x==="killers"?"active":""}`,onClick:()=>r("killers"),children:"Tueurs"}),e.jsx("button",{className:`lycans-categorie-btn ${x==="deaths"?"active":""}`,onClick:()=>r("deaths"),children:"Morts"}),e.jsx("button",{className:`lycans-categorie-btn ${x==="survival"?"active":""}`,onClick:()=>r("survival"),children:"Survie par Jour"}),e.jsx("button",{className:`lycans-categorie-btn ${x==="hunter"?"active":""}`,onClick:()=>r("hunter"),children:"Chasseur"})]}),(x==="killers"||x==="deaths"||x==="survival")&&e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select",value:y,onChange:o=>d(o.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),R?.map(o=>e.jsx("option",{value:o,children:o},o))]})]}),x==="killers"&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"victim-camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp de la victime :"}),e.jsxs("select",{id:"victim-camp-select",value:h,onChange:o=>m(o.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loup"}),e.jsx("option",{value:"Roles solo",children:"Roles solo"})]})]})]}),(x==="killers"||x==="deaths")&&e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total des morts"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)"},children:A.totalDeaths})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Tueurs identifiÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-1)"},children:A.killerStats.length})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Nombre de parties enregistrÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary)"},children:f})]})]}),x==="killers"&&e.jsx(ue,{deathStats:A,selectedCamp:y,victimCampFilter:h,minGamesForAverage:H,onMinGamesChange:i,availableDeathTypes:t,deathTypeColors:l,totalEligibleForAverage:k}),x==="deaths"&&e.jsx(ye,{deathStats:A,selectedCamp:y,minGamesForAverage:H,onMinGamesChange:i,availableDeathTypes:t,deathTypeColors:l}),x==="hunter"&&e.jsx(ve,{hunterStats:C,isLoading:b,error:j}),x==="survival"&&e.jsx(pe,{survivalStats:N,selectedCamp:y,minGamesForAverage:H,onMinGamesChange:i,isLoading:c,error:g}),e.jsx("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note : "}),"DonnÃ©es en cours de rÃ©cupÃ©ration (donnÃ©es partielles)."]})})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de mort disponible"})}export{Be as DeathStatisticsChart};
