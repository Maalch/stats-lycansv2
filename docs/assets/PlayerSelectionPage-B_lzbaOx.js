import{r as h,u as k,j as e,a as S,m as D,l as G}from"./index-GSF5Ceuy.js";import{u as E,g as w}from"./api-BTRT2aLv.js";function L(t){const[n,y]=h.useState(null),[m,j]=h.useState(!1),[g,p]=h.useState(null);h.useEffect(()=>{let l=!0;return(async()=>{try{j(!0),p(null);const r=await fetch("/data/playerAchievements.json");if(!r.ok)throw new Error(`Failed to load achievements: ${r.status} ${r.statusText}`);const s=await r.json();l&&(y(s),console.log("✅ Pre-calculated achievements loaded:",{totalPlayers:s.totalPlayers,totalGames:s.totalGames,generatedAt:s.generatedAt,playersWithAchievements:Object.keys(s.achievements).length}))}catch(r){l&&(p(r instanceof Error?r.message:"Failed to load achievements"),console.error("Error loading pre-calculated achievements:",r))}finally{l&&j(!1)}})(),()=>{l=!1}},[]);const P=t&&n?.achievements[t]||null;return h.useEffect(()=>{if(t&&n){const l=n.achievements[t];l?console.log(`🏆 Achievements for ${t}:`,{allGames:l.allGamesAchievements.length,moddedOnly:l.moddedOnlyAchievements.length,categories:[...new Set([...l.allGamesAchievements.map(c=>c.category),...l.moddedOnlyAchievements.map(c=>c.category)])]}):console.log(`❌ No achievements found for ${t}`)}},[t,n]),{data:P,isLoading:m,error:g,metadata:{generatedAt:n?.generatedAt||null,totalPlayers:n?.totalPlayers||0,totalGames:n?.totalGames||0,totalModdedGames:n?.totalModdedGames||0}}}function T({achievements:t,title:n,emptyMessage:y}){const{navigateToTab:m}=k(),j=E(),g=s=>{s.redirectTo&&m(s.redirectTo.tab,s.redirectTo.subTab)},p=s=>j[s]||w(s),P=s=>{const v=[/avec ([^:]+?):/,/contre ([^:]+?):/];let d=s;return v.forEach(u=>{const x=s.match(u);if(x&&x[1]){const N=x[1].trim(),a=`<span class="player-name-highlight" style="color: ${p(N)};">${N}</span>`;d=d.replace(N,a)}}),d};if(t.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:n}),e.jsx("p",{children:y||"Aucun succès dans cette catégorie"})]});const l=t.filter(s=>s.category!=="comparison"&&s.type==="good").sort((s,v)=>(s.rank??999)-(v.rank??999)),c=t.filter(s=>s.category!=="comparison"&&s.type==="bad").sort((s,v)=>(s.rank??999)-(v.rank??999)),r=t.filter(s=>s.category==="comparison");return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:n}),l.length>0&&e.jsxs("div",{className:"achievements-section good-achievements",children:[e.jsx("h5",{children:"🏆 Succès"}),e.jsx("div",{className:"achievements-grid",children:l.map(s=>e.jsxs("div",{className:`achievement-card good rank-${s.rank}`,onClick:()=>g(s),title:"Cliquez pour voir le classement complet",children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:s.title}),e.jsxs("span",{className:"achievement-rank",children:["#",s.rank]})]}),e.jsx("p",{className:"achievement-description",children:s.description})]},s.id))})]}),c.length>0&&e.jsxs("div",{className:"achievements-section bad-achievements",children:[e.jsx("h5",{children:"💀 Anti-succès"}),e.jsx("div",{className:"achievements-grid",children:c.map(s=>e.jsxs("div",{className:`achievement-card bad rank-${s.rank}`,onClick:()=>g(s),title:"Cliquez pour voir le classement complet",children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:s.title}),e.jsxs("span",{className:"achievement-rank",children:["#",s.rank]})]}),e.jsx("p",{className:"achievement-description",children:s.description})]},s.id))})]}),r.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"📊 Statistiques Face-à-Face"}),e.jsx("div",{className:"achievements-grid",children:r.map(s=>e.jsxs("div",{className:"achievement-card comparison",onClick:()=>g(s),title:"Cliquez pour voir les comparaisons détaillées",children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:s.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:P(s.description)}})]},s.id))})]})]})}function F(){const{settings:t,updateSettings:n}=S(),{navigateToTab:y}=k(),{data:m,isLoading:j,error:g}=D(),{data:p,isLoading:P,error:l}=L(t.highlightedPlayer),[c,r]=h.useState(""),[s,v]=h.useState("all"),d=h.useMemo(()=>{if(!m||!m.GameStats)return[];const a=new Map;return m.GameStats.forEach(i=>{const o=new Date(i.StartDate);i.PlayerStats.forEach(C=>{const A=G(C.Username);a.has(A)||a.set(A,{games:0,wins:0,firstDate:o,lastDate:o});const f=a.get(A);f.games++,C.Victorious&&f.wins++,o<f.firstDate&&(f.firstDate=o),o>f.lastDate&&(f.lastDate=o)})}),Array.from(a.entries()).map(([i,o])=>({name:i,totalGames:o.games,totalWins:o.wins,winRate:o.games>0?o.wins/o.games*100:0,firstGameDate:o.firstDate.toLocaleDateString("fr-FR"),lastGameDate:o.lastDate.toLocaleDateString("fr-FR"),isHighlighted:i===t.highlightedPlayer}))},[m,t.highlightedPlayer]),u=h.useMemo(()=>{if(!c.trim())return d;const a=c.toLowerCase();return d.filter(i=>i.name.toLowerCase().includes(a))},[d,c]),x=h.useMemo(()=>[...u].sort((a,i)=>i.totalGames-a.totalGames),[u]),N=a=>{n({highlightedPlayer:a}),r("")},b=a=>{n({highlightedPlayer:a}),y("players","history")};return j?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):g?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les données des joueurs: ",g]})]}):!m||d.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnée disponible"}),e.jsx("p",{children:"Aucun joueur trouvé dans les données."})]}):e.jsxs("div",{className:"player-selection-container",children:[e.jsxs("div",{className:"player-selection-header",children:[e.jsx("h2",{children:"Sélection de Joueur"}),e.jsx("p",{className:"header-description",children:"Choisissez un joueur pour le mettre en évidence dans tous les graphiques."}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:c,onChange:a=>r(a.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"🔍"})]}),e.jsxs("div",{className:"player-count",children:[u.length," joueur",u.length!==1?"s":"",c&&` (filtré${u.length!==1?"s":""} de ${d.length})`]})]})]}),e.jsx("div",{className:"player-display",children:c?u.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"Résultats de recherche:"}),e.jsx("button",{className:"clear-search-btn",onClick:()=>r(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:x.map(a=>e.jsxs("button",{className:`suggestion-btn ${a.isHighlighted?"highlighted":""}`,onClick:()=>N(a.name),children:[a.name," (",a.totalGames," parties, ",a.winRate.toFixed(1),"% victoires)",a.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" ★"})]},a.name))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvé pour "',c,'"']}),e.jsx("button",{className:"clear-search-btn",onClick:()=>r(""),children:"Effacer la recherche"})]}):t.highlightedPlayer?(()=>{const a=d.find(i=>i.name===t.highlightedPlayer);return a?e.jsxs("div",{className:"single-player-card highlighted",onClick:()=>b(a.name),children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:a.name}),e.jsx("span",{className:"highlight-badge",children:"★ Mis en évidence"})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"achievements-section",children:[P?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des succès..."})]}):l?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["❌ Erreur lors du chargement des succès: ",l]})}):p?e.jsx(T,{achievements:s==="all"?p.allGamesAchievements:p.moddedOnlyAchievements,title:s==="all"?"Succès - Toutes les parties":"Succès - Parties moddées",emptyMessage:"Aucun succès dans cette catégorie"}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun succès disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[e.jsx("button",{className:`filter-btn ${s==="all"?"active":""}`,onClick:i=>{i.stopPropagation(),v("all")},children:"Toutes les parties"}),e.jsx("button",{className:`filter-btn ${s==="modded"?"active":""}`,onClick:i=>{i.stopPropagation(),v("modded")},children:"Parties moddées"})]}),e.jsx("button",{className:"highlight-btn active",onClick:i=>{i.stopPropagation(),n({highlightedPlayer:null})},children:"★ Retirer la mise en évidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"Période d'activité:"}),e.jsxs("span",{className:"period-range",children:[a.firstGameDate," - ",a.lastGameDate]})]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',t.highlightedPlayer,`" n'a pas été trouvé dans les données.`]}),e.jsx("button",{className:"clear-selection-btn",onClick:()=>n({highlightedPlayer:null}),children:"Effacer la sélection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"Sélectionnez un joueur"}),e.jsx("p",{children:"Utilisez la recherche ci-dessus pour trouver et sélectionner un joueur à mettre en évidence."}),u.length>0&&e.jsxs("div",{className:"suggested-players",children:[e.jsx("h3",{children:"Joueurs suggérés:"}),e.jsx("div",{className:"suggestion-list",children:x.slice(0,5).map(a=>e.jsxs("button",{className:"suggestion-btn",onClick:()=>N(a.name),children:[a.name," (",a.totalGames," parties)"]},a.name))})]})]})})})]})}export{F as PlayerSelectionPage};
