import{r as c,j as e}from"./index-BFKR9s5X.js";import{p as y,g as D}from"./api-4z_uY0SA.js";import{R as x,B as f,C as v,X as P,Y as b,T as m,a as C,b as g}from"./BarChart-DDwYEYEi.js";import{P as S,a as w}from"./PieChart-BkQEBE-T.js";import{L as E}from"./Legend-TsdIqW9E.js";function F(){const[t,p]=c.useState(null),[d,i]=c.useState(!0),[u,o]=c.useState(null);return c.useEffect(()=>{(async()=>{try{i(!0),o(null);const l=await fetch("https://script.google.com/macros/s/AKfycbxrhG1mb7N6q7Mg88ogw0mirXgSihPpNPurZwiEOy9miG24Cc3AlGZCn2uoGnygNhck/exec?action=playerStats");if(!l.ok)throw new Error(`Erreur API: ${l.status}`);const a=await l.json();p(a)}catch(n){console.error("Erreur lors de la récupération des statistiques des joueurs:",n),o(n instanceof Error?n.message:"Erreur inconnue")}finally{i(!1)}})()},[]),{playerStatsData:t,dataLoading:d,fetchError:u}}function q(){const{playerStatsData:t,dataLoading:p,fetchError:d}=F(),[i]=c.useState(null);if(p)return e.jsx("div",{className:"donnees-attente",children:"Récupération des statistiques des joueurs..."});if(d)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",d]});if(!t)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de joueur disponible"});const u=t.playerStats.filter(a=>a.gamesPlayed>2).sort((a,s)=>s.gamesPlayed-a.gamesPlayed).slice(0,20),o=t.playerStats.filter(a=>a.gamesPlayed>=5).sort((a,s)=>parseFloat(s.winPercent)-parseFloat(a.winPercent)).slice(0,20),j=a=>{const s=t.playerStats.find(r=>r.player===a);return s?Object.entries(s.camps).filter(([r,h])=>h>0).map(([r,h])=>({name:r,value:h,percentage:(h/s.gamesPlayed*100).toFixed(1)})):[]},n={Villageois:"#4CAF50",Loups:"#F44336",Traître:"#9C27B0","Idiot du Village":"#FF9800",Cannibale:"#795548",Agent:"#2196F3",Espion:"#607D8B",Scientifique:"#00BCD4",Amoureux:"#E91E63","La Bête":"#673AB7","Chasseur de primes":"#FFC107",Vaudou:"#3F51B5"},l=i?j(i):[];return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques des Joueurs"}),e.jsxs("p",{className:"lycans-stats-info",children:["Total de ",t.totalGames," parties analysées avec ",t.playerStats.length," joueurs"]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Participations"}),e.jsx("div",{style:{height:400},children:e.jsx(x,{width:"100%",height:"100%",children:e.jsxs(f,{data:u,margin:{top:20,right:30,left:20,bottom:70},children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(b,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(m,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const r=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:r.player})}),e.jsxs("div",{children:["Parties jouées : ",r.gamesPlayed]}),e.jsxs("div",{children:["Pourcentage : ",r.gamesPlayedPercent,"%"]})]})}return null}}),e.jsx(C,{dataKey:"gamesPlayed",name:"Parties jouées",fill:"#00C49F",children:u.map(a=>e.jsx(g,{fill:y[a.player]||"#00C49F"},`cell-participation-${a.player}`))})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Meilleurs Taux de Victoire (min. 5 parties)"}),e.jsx("div",{style:{height:400},children:e.jsx(x,{width:"100%",height:"100%",children:e.jsxs(f,{data:o,margin:{top:20,right:30,left:20,bottom:70},children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(b,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(m,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const r=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:r.player})}),e.jsxs("div",{children:["Taux de victoire : ",r.winPercent,"%"]}),e.jsxs("div",{children:["Victoires : ",r.wins," / ",r.gamesPlayed]})]})}return null}}),e.jsx(C,{dataKey:"winPercent",name:"Taux de Victoire",fill:"#8884d8",children:o.map(a=>e.jsx(g,{fill:y[a.player]||"#8884d8"},`cell-winrate-${a.player}`))})]})})})]})]}),i&&e.jsxs("div",{className:"lycans-graphique-section lycans-joueur-details",children:[e.jsxs("h3",{children:["Distribution des Camps - ",i]}),e.jsx("div",{style:{height:300},children:e.jsx(x,{width:"100%",height:"100%",children:e.jsxs(S,{children:[e.jsx(w,{data:l,cx:"50%",cy:"50%",labelLine:!0,outerRadius:80,fill:"#8884d8",dataKey:"value",nameKey:"name",label:({name:a,percentage:s})=>`${a}: ${s}%`,children:l.map((a,s)=>e.jsx(g,{fill:n[a.name]||D(a.name)},`cell-${s}`))}),e.jsx(m,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const r=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:r.name})}),e.jsxs("div",{children:[r.value," parties (",r.percentage,"%)"]})]})}return null}}),e.jsx(E,{})]})})})]})]})}export{q as PlayersGeneralStatisticsChart};
