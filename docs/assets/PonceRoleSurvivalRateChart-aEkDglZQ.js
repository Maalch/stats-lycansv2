import{r as s,j as n}from"./index-DcpGSnKg.js";import{l as ie,g as se}from"./api-BWHeASPZ.js";import{ao as E,ag as ne,ap as oe,aq as le,a9 as F,ar as ce,d as J,j as de,g as Y,h as U,as as ue,k as pe,S as ve,o as H,r as me,a0 as ye,t as he,u as Q,n as fe,G as xe,C as N,D as ge,c as be,i as I,L as _,w as K,x as q,y as Ae,A as Se,z as D,f as z,s as je,a3 as Ee,a4 as Ie,a5 as Pe,a6 as Ce,a7 as Re,a8 as Te,at as _e,B as Oe,E as we,R as W,T as $}from"./CategoricalChart-BR7153jM.js";import{b as De,u as Ke,G as ke,c as Ne,L as ze,d as Le,B as Me,C as Z,X as G,Y as V,a as Be}from"./BarChart-jIC5Fa0n.js";import{L as Fe}from"./Legend-BmxYhB8P.js";function ee(e,t,r){return(t=qe(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function qe(e){var t=We(e,"string");return typeof t=="symbol"?t:t+""}function We(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var a=r.call(e,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function $e(e){var t=ne();return s.useEffect(()=>(t(oe(e)),()=>{t(le(e))}),[e,t]),null}class k extends s.Component{render(){return s.createElement($e,{domain:this.props.domain,id:this.props.zAxisId,dataKey:this.props.dataKey,name:this.props.name,unit:this.props.unit,range:this.props.range,scale:this.props.scale,type:this.props.type,allowDuplicatedCategory:E.allowDuplicatedCategory,allowDataOverflow:E.allowDataOverflow,reversed:E.reversed,includeHidden:E.includeHidden})}}ee(k,"displayName","ZAxis");ee(k,"defaultProps",{zAxisId:0,range:E.range,scale:E.scale,type:E.type});var Ze=["option","isActive"];function T(){return T=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)({}).hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},T.apply(null,arguments)}function Ge(e,t){if(e==null)return{};var r,a,i=Ve(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function Ve(e,t){if(e==null)return{};var r={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(t.indexOf(a)!==-1)continue;r[a]=e[a]}return r}function Xe(e){var{option:t,isActive:r}=e,a=Ge(e,Ze);return typeof t=="string"?s.createElement(F,T({option:s.createElement(ce,T({type:t},a)),isActive:r,shapeType:"symbols"},a)):s.createElement(F,T({option:t,isActive:r,shapeType:"symbols"},a))}var Je=(e,t,r,a,i,o,l)=>Y(e,"xAxis",t,l),Ye=(e,t,r,a,i,o,l)=>U(e,"xAxis",t,l),Ue=(e,t,r,a,i,o,l)=>Y(e,"yAxis",r,l),He=(e,t,r,a,i,o,l)=>U(e,"yAxis",r,l),Qe=(e,t,r,a)=>ue(e,"zAxis",a,!1),ea=(e,t,r,a,i)=>i,aa=(e,t,r,a,i,o)=>o,ta=(e,t,r,a,i,o,l)=>de(e,t,r,l),ra=J([pe,ea],(e,t)=>{if(e.some(r=>r.type==="scatter"&&t.dataKey===r.dataKey&&t.data===r.data))return t}),ia=J([ta,Je,Ye,Ue,He,Qe,ra,aa],(e,t,r,a,i,o,l,v)=>{var{chartData:u,dataStartIndex:p,dataEndIndex:x}=e;if(l!=null){var y;if(l?.data!=null&&l.data.length>0?y=l.data:y=u?.slice(p,x+1),!(y==null||t==null||a==null||r==null||i==null||r?.length===0||i?.length===0))return ya({displayedData:y,xAxis:t,yAxis:a,zAxis:o,scatterSettings:l,xAxisTicks:r,yAxisTicks:i,cells:v})}}),sa=["onMouseEnter","onClick","onMouseLeave"],na=["animationBegin","animationDuration","animationEasing","hide","isAnimationActive","legendType","lineJointType","lineType","shape","xAxisId","yAxisId","zAxisId"];function ae(e,t){if(e==null)return{};var r,a,i=oa(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)===-1&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function oa(e,t){if(e==null)return{};var r={};for(var a in e)if({}.hasOwnProperty.call(e,a)){if(t.indexOf(a)!==-1)continue;r[a]=e[a]}return r}function P(){return P=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var a in r)({}).hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e},P.apply(null,arguments)}function X(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),r.push.apply(r,a)}return r}function A(e){for(var t=1;t<arguments.length;t++){var r=arguments[t]!=null?arguments[t]:{};t%2?X(Object(r),!0).forEach(function(a){L(e,a,r[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):X(Object(r)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(r,a))})}return e}function L(e,t,r){return(t=la(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function la(e){var t=ca(e,"string");return typeof t=="symbol"?t:t+""}function ca(e,t){if(typeof e!="object"||!e)return e;var r=e[Symbol.toPrimitive];if(r!==void 0){var a=r.call(e,t);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}var da=e=>{var{dataKey:t,name:r,fill:a,legendType:i,hide:o}=e;return[{inactive:o,dataKey:t,type:i,color:a,value:H(r,t),payload:e}]};function ua(e){var{points:t,props:r}=e,{line:a,lineType:i,lineJointType:o}=r;if(!a)return null;var l=z(r,!1),v=z(a,!1),u,p;if(i==="joint")u=t.map(c=>({x:c.cx,y:c.cy}));else if(i==="fitting"){var{xmin:x,xmax:y,a:d,b:m}=_e(t),f=c=>d*c+m;u=[{x,y:f(x)},{x:y,y:f(y)}]}var g=A(A(A({},l),{},{fill:"none",stroke:l&&l.fill},v),{},{points:u});return s.isValidElement(a)?p=s.cloneElement(a,g):typeof a=="function"?p=a(g):p=s.createElement(Oe,P({},g,{type:o})),s.createElement(_,{className:"recharts-scatter-line",key:"recharts-scatter-line"},p)}function te(e){var{points:t,showLabels:r,allOtherScatterProps:a}=e,{shape:i,activeShape:o,dataKey:l}=a,v=z(a,!1),u=Q(je),{onMouseEnter:p,onClick:x,onMouseLeave:y}=a,d=ae(a,sa),m=Ee(p,a.dataKey),f=Ie(y),g=Pe(x,a.dataKey);return t==null?null:s.createElement(s.Fragment,null,s.createElement(ua,{points:t,props:a}),t.map((c,h)=>{var b=o&&u===String(h),S=b?o:i,j=A(A(A({key:"symbol-".concat(h)},v),c),{},{[Re]:h,[Ce]:String(l)});return s.createElement(_,P({className:"recharts-scatter-symbol"},Te(d,c,h),{onMouseEnter:m(c,h),onMouseLeave:f(c,h),onClick:g(c,h),key:"symbol-".concat(c?.cx,"-").concat(c?.cy,"-").concat(c?.size,"-").concat(h)}),s.createElement(Xe,P({option:S,isActive:b},j)))}),r&&ze.renderCallByParent(a,t))}function pa(e){var{previousPointsRef:t,props:r}=e,{points:a,isAnimationActive:i,animationBegin:o,animationDuration:l,animationEasing:v}=r,u=t.current,p=Ae(r,"recharts-scatter-"),[x,y]=s.useState(!1),d=s.useCallback(()=>{y(!1)},[]),m=s.useCallback(()=>{y(!0)},[]);return s.createElement(Se,{begin:o,duration:l,isActive:i,easing:v,from:{t:0},to:{t:1},onAnimationEnd:d,onAnimationStart:m,key:p},f=>{var{t:g}=f,c=g===1?a:a.map((h,b)=>{var S=u&&u[b];if(S){var j=D(S.cx,h.cx),O=D(S.cy,h.cy),C=D(S.size,h.size);return A(A({},h),{},{cx:j(g),cy:O(g),size:C(g)})}var R=D(0,h.size);return A(A({},h),{},{size:R(g)})});return g>0&&(t.current=c),s.createElement(_,null,s.createElement(te,{points:c,allOtherScatterProps:r,showLabels:!x}))})}function va(e){var{points:t,isAnimationActive:r}=e,a=s.useRef(null),i=a.current;return r&&t&&t.length&&(!i||i!==t)?s.createElement(pa,{props:e,previousPointsRef:a}):s.createElement(te,{points:t,allOtherScatterProps:e,showLabels:!0})}function ma(e){var{dataKey:t,points:r,stroke:a,strokeWidth:i,fill:o,name:l,hide:v,tooltipType:u}=e;return{dataDefinedOnItem:r?.map(p=>p.tooltipPayload),positions:r?.map(p=>p.tooltipPosition),settings:{stroke:a,strokeWidth:i,fill:o,nameKey:void 0,dataKey:t,name:H(l,t),hide:v,type:u,color:o,unit:""}}}function ya(e){var{displayedData:t,xAxis:r,yAxis:a,zAxis:i,scatterSettings:o,xAxisTicks:l,yAxisTicks:v,cells:u}=e,p=I(r.dataKey)?o.dataKey:r.dataKey,x=I(a.dataKey)?o.dataKey:a.dataKey,y=i&&i.dataKey,d=i?i.range:k.defaultProps.range,m=d&&d[0],f=r.scale.bandwidth?r.scale.bandwidth():0,g=a.scale.bandwidth?a.scale.bandwidth():0;return t.map((c,h)=>{var b=K(c,p),S=K(c,x),j=!I(y)&&K(c,y)||"-",O=[{name:I(r.dataKey)?o.name:r.name||r.dataKey,unit:r.unit||"",value:b,payload:c,dataKey:p,type:o.tooltipType},{name:I(a.dataKey)?o.name:a.name||a.dataKey,unit:a.unit||"",value:S,payload:c,dataKey:x,type:o.tooltipType}];j!=="-"&&O.push({name:i.name||i.dataKey,unit:i.unit||"",value:j,payload:c,dataKey:y,type:o.tooltipType});var C=q({axis:r,ticks:l,bandSize:f,entry:c,index:h,dataKey:p}),R=q({axis:a,ticks:v,bandSize:g,entry:c,index:h,dataKey:x}),B=j!=="-"?i.scale(j):m,w=Math.sqrt(Math.max(B,0)/Math.PI);return A(A({},c),{},{cx:C,cy:R,x:C-w,y:R-w,width:2*w,height:2*w,size:B,node:{x:b,y:S,z:j},tooltipPayload:O,tooltipPosition:{x:C,y:R},payload:c},u&&u[h]&&u[h].props)})}var ha=(e,t,r)=>({x:e.cx,y:e.cy,value:r==="x"?+e.node.x:+e.node.y,errorVal:K(e,t)});function fa(e){var t=s.useRef(ge("recharts-scatter-")),{hide:r,points:a,className:i,needClip:o,xAxisId:l,yAxisId:v,id:u,children:p}=e;if(r)return null;var x=be("recharts-scatter",i),y=I(u)?t.current:u;return s.createElement(_,{className:x,clipPath:o?"url(#clipPath-".concat(y,")"):null},o&&s.createElement("defs",null,s.createElement(ke,{clipPathId:y,xAxisId:l,yAxisId:v})),s.createElement(Ne,{xAxisId:l,yAxisId:v,data:a,dataPointFormatter:ha,errorBarOffset:0},p),s.createElement(_,{key:"recharts-scatter-symbols"},s.createElement(va,e)))}var re={xAxisId:0,yAxisId:0,zAxisId:0,legendType:"circle",lineType:"joint",lineJointType:"linear",data:[],shape:"circle",hide:!1,isAnimationActive:!xe.isSsr,animationBegin:0,animationDuration:400,animationEasing:"linear"};function xa(e){var t=me(e,re),{animationBegin:r,animationDuration:a,animationEasing:i,hide:o,isAnimationActive:l,legendType:v,lineJointType:u,lineType:p,shape:x,xAxisId:y,yAxisId:d,zAxisId:m}=t,f=ae(t,na),{needClip:g}=Ke(y,d),c=s.useMemo(()=>ye(e.children,N),[e.children]),h=s.useMemo(()=>({name:e.name,tooltipType:e.tooltipType,data:e.data,dataKey:e.dataKey}),[e.data,e.dataKey,e.name,e.tooltipType]),b=he(),S=Q(j=>ia(j,y,d,m,h,c,b));return g==null?null:s.createElement(s.Fragment,null,s.createElement(fe,{fn:ma,args:A(A({},e),{},{points:S})}),s.createElement(fa,P({},f,{xAxisId:y,yAxisId:d,zAxisId:m,lineType:p,lineJointType:u,legendType:v,shape:x,hide:o,isAnimationActive:l,animationBegin:r,animationDuration:a,animationEasing:i,points:S,needClip:g})))}class M extends s.Component{render(){return s.createElement(De,{type:"scatter",data:this.props.data,xAxisId:this.props.xAxisId,yAxisId:this.props.yAxisId,zAxisId:this.props.zAxisId,dataKey:this.props.dataKey,stackId:void 0,hide:this.props.hide,barSize:void 0},s.createElement(ve,{legendPayload:da(this.props)}),s.createElement(xa,this.props))}}L(M,"displayName","Scatter");L(M,"defaultProps",re);var ga=["item"],ba=s.forwardRef((e,t)=>s.createElement(Le,{chartName:"ScatterChart",defaultTooltipEventType:"item",validateTooltipEventTypes:ga,tooltipPayloadSearcher:we,categoricalChartProps:e,ref:t}));function Aa(){const[e,t]=s.useState(null),[r,a]=s.useState(!0),[i,o]=s.useState(null);return s.useEffect(()=>{(async()=>{try{a(!0),o(null);const u=await fetch("https://script.google.com/macros/s/AKfycbxrhG1mb7N6q7Mg88ogw0mirXgSihPpNPurZwiEOy9miG24Cc3AlGZCn2uoGnygNhck/exec?action=roleSurvivalStats");if(!u.ok)throw new Error(`Erreur de requête: ${u.status}`);const p=await u.json();if(p.error)throw new Error(p.error);t(p)}catch(v){console.error("Problème lors de la récupération des stats de survie des rôles:",v),o(v instanceof Error?v.message:"Erreur lors du chargement")}finally{a(!1)}})()},[]),{roleSurvivalStats:e,dataLoading:r,fetchError:i}}function Ca(){const{roleSurvivalStats:e,dataLoading:t,fetchError:r}=Aa(),[a,i]=s.useState("camps"),o=s.useMemo(()=>{if(!e)return{};let d=[],m="";switch(a){case"camps":d=e.campStats||[],m="camp";break;case"roles":d=e.roleStats||[],m="role";break;case"secondaryRoles":d=e.secondaryRoleStats||[],m="secondaryRole";break;case"thirdRoles":d=e.thirdRoleStats||[],m="thirdRole";break}const f=a==="camps"?1:3,g=d.filter(h=>h.appearances>=f),c={};return g.forEach(h=>{const b=h[m];a==="roles"||a==="camps"?c[b]=ie[b]||"var(--chart-color-2)":c[b]=se(b)}),c},[e,a]);if(t)return n.jsx("div",{className:"donnees-attente",children:"Récupération des statistiques de survie par rôles..."});if(r)return n.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",r]});if(!e)return n.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de survie disponible"});let l=[],v="",u="",p=1;switch(a){case"roles":l=e.roleStats||[],v="role",u="Rôle",p=3;break;case"camps":l=e.campStats||[],v="camp",u="Camp",p=1;break;case"secondaryRoles":l=e.secondaryRoleStats||[],v="secondaryRole",u="Rôle Secondaire",p=3;break;case"thirdRoles":l=e.thirdRoleStats||[],v="thirdRole",u="Rôle Spécifique",p=3;break}const x=l.filter(d=>d.appearances>=p);if(x.length===0)return n.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée disponible pour cette catégorie"});const y=x.map(d=>({nom:d[v],tauxSurvie:parseFloat(d.survivalRate),dureeVie:parseFloat(d.avgLifespan),apparitions:d.appearances}));return n.jsxs("div",{className:"lycans-roles-survie",children:[n.jsx("h2",{children:"Statistiques de Survie par Rôles"}),n.jsxs("div",{className:"lycans-categories-selection",children:[n.jsx("button",{className:`lycans-categorie-btn ${a==="camps"?"active":""}`,onClick:()=>i("camps"),children:"Camps"}),n.jsx("button",{className:`lycans-categorie-btn ${a==="roles"?"active":""}`,onClick:()=>i("roles"),children:"Rôles villageois"}),n.jsx("button",{className:`lycans-categorie-btn ${a==="thirdRoles"?"active":""}`,onClick:()=>i("thirdRoles"),children:"Rôles spécifiques"}),n.jsx("button",{className:`lycans-categorie-btn ${a==="secondaryRoles"?"active":""}`,onClick:()=>i("secondaryRoles"),children:"Rôles secondaires"})]}),n.jsxs("div",{className:"lycans-graphiques-groupe",children:[n.jsxs("div",{className:"lycans-graphique-section",children:[n.jsxs("h3",{children:["Taux de Survie par ",u," (classés par fréquences)"]}),n.jsx("div",{style:{height:400},children:n.jsx(W,{width:"100%",height:"120%",children:n.jsxs(Me,{data:x,margin:{top:20,right:30,left:20,bottom:70},layout:"vertical",children:[n.jsx(Z,{strokeDasharray:"3 3"}),n.jsx(G,{type:"number",domain:[0,100]}),n.jsx(V,{dataKey:v,type:"category",width:a==="thirdRoles"?0:150,tick:a!=="thirdRoles"}),n.jsx($,{content:({active:d,payload:m})=>{if(d&&m&&m.length>0){const f=m[0].payload;return n.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[n.jsxs("div",{style:{fontWeight:"bold",marginBottom:4},children:[u,": ",f[v]]}),n.jsxs("div",{children:["Taux de Survie : ",f.survivalRate,"%"]}),n.jsxs("div",{children:["Apparitions : ",f.appearances]}),n.jsxs("div",{children:["Durée de Vie Moyenne : ",f.avgLifespan," jours"]})]})}return null}}),n.jsx(Fe,{formatter:d=>d==="survivalRate"?"Taux de Survie":d}),n.jsx(Be,{dataKey:"survivalRate",name:"survivalRate",fill:"var(--chart-color-2)",background:{fill:"var(--bg-tertiary)"},children:x.map((d,m)=>n.jsx(N,{fill:o[d[v]]},d[v]||m))})]})})})]}),n.jsxs("div",{className:"lycans-graphique-section",children:[n.jsx("h3",{children:"Durée de Vie Moyenne vs Taux de Survie"}),n.jsx("div",{style:{height:400},children:n.jsx(W,{width:"100%",height:"100%",children:n.jsxs(ba,{margin:{top:20,right:30,left:20,bottom:10},children:[n.jsx(Z,{}),n.jsx(G,{type:"number",dataKey:"dureeVie",name:"Durée de Vie Moyenne (jours)",label:{value:"Durée de Vie Moyenne (jours)",position:"insideBottom",offset:-10}}),n.jsx(V,{type:"number",dataKey:"tauxSurvie",name:"Taux de Survie (%)",label:{value:"Taux de Survie (%)",angle:-90,position:"insideLeft"}}),n.jsx(k,{type:"number",dataKey:"apparitions",range:[50,400],name:"Nombre d'Apparitions"}),n.jsx($,{cursor:{strokeDasharray:"3 3"},content:({active:d,payload:m})=>{if(d&&m&&m.length>0){const f=m[0].payload;return n.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[n.jsxs("div",{style:{fontWeight:"bold",marginBottom:4},children:[u,": ",f.nom]}),n.jsxs("div",{children:["Durée de Vie Moyenne : ",f.dureeVie," jours"]}),n.jsxs("div",{children:["Taux de Survie : ",f.tauxSurvie,"%"]}),n.jsxs("div",{children:["Apparitions : ",f.apparitions]})]})}return null}}),n.jsx(M,{name:u,data:y,fill:"var(--chart-color-5)",children:y.map((d,m)=>n.jsx(N,{fill:o[d.nom]},d.nom||m))})]})})})]})]})]})}export{Ca as RoleSurvivalRateChart};
