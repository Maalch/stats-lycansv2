import{a as V,r as I,j as a}from"./index-i2D8CKXz.js";import{u as q}from"./baseStatsHook-Yue8JXBk.js";import{F as z,C as D,X as $,Y as G}from"./FullscreenChart-DkD7fDqR.js";import{a as N,g as X}from"./datasyncExport-BirWLS1z.js";import{b as _}from"./api-CGjKkj89.js";import{i as K,g as O,V as Y}from"./roleUtils-g252S1-m.js";import{R as Z,T as H,a as J}from"./CategoricalChart-lJQ-xVrZ.js";import{B as Q,a as U}from"./BarChart-u1lo5U5Z.js";function ee(C){if(C.length===0)return null;const h=new Map,m=new Map,l=new Map;C.forEach(g=>{g.Modded&&g.PlayerStats.forEach(o=>{if(o.MainRoleInitial==="Inconnu")return;const e=o.Victorious,t=N(o.MainRoleInitial,o.MainRoleChanges||[])!==o.MainRoleInitial,p=X(o.MainRoleInitial),f=p==="Loup"||p==="Tra√Ætre"||p==="Louveteau";if(p==="Villageois"&&K(o)){const n=O(o);if(n&&Y.includes(n)){const r=h.get(n)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};h.set(n,{appearances:r.appearances+1,wins:r.wins+(e?1:0),winsWithoutRoleChange:r.winsWithoutRoleChange+(!t&&e?1:0),gamesWithoutRoleChange:r.gamesWithoutRoleChange+(t?0:1)})}}else if(o.Power&&o.Power.trim()!==""&&o.Power!=="Inconnu"){if(p==="Villageois"){const n=h.get(o.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};h.set(o.Power,{appearances:n.appearances+1,wins:n.wins+(e?1:0),winsWithoutRoleChange:n.winsWithoutRoleChange+(!t&&e?1:0),gamesWithoutRoleChange:n.gamesWithoutRoleChange+(t?0:1)})}else if(f){const n=m.get(o.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},r=n.roleBreakdown;r.set(o.MainRoleInitial,(r.get(o.MainRoleInitial)||0)+1),m.set(o.Power,{appearances:n.appearances+1,wins:n.wins+(e?1:0),winsWithoutRoleChange:n.winsWithoutRoleChange+(!t&&e?1:0),gamesWithoutRoleChange:n.gamesWithoutRoleChange+(t?0:1),roleBreakdown:r})}}else if((p==="Villageois"||f)&&o.Power!=="Inconnu")if(p==="Villageois"){const n=h.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};h.set("Aucun pouvoir",{appearances:n.appearances+1,wins:n.wins+(e?1:0),winsWithoutRoleChange:n.winsWithoutRoleChange+(!t&&e?1:0),gamesWithoutRoleChange:n.gamesWithoutRoleChange+(t?0:1)})}else{const n=m.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},r=n.roleBreakdown;r.set(o.MainRoleInitial,(r.get(o.MainRoleInitial)||0)+1),m.set("Aucun pouvoir",{appearances:n.appearances+1,wins:n.wins+(e?1:0),winsWithoutRoleChange:n.winsWithoutRoleChange+(!t&&e?1:0),gamesWithoutRoleChange:n.gamesWithoutRoleChange+(t?0:1),roleBreakdown:r})}if(o.SecondaryRole&&o.SecondaryRole.trim()!==""&&o.SecondaryRole!=="Inconnu"){const n=l.get(o.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};l.set(o.SecondaryRole,{appearances:n.appearances+1,wins:n.wins+(e?1:0),winsWithoutRoleChange:n.winsWithoutRoleChange+(!t&&e?1:0),gamesWithoutRoleChange:n.gamesWithoutRoleChange+(t?0:1)})}})});const c=g=>Array.from(g.entries()).map(([o,e])=>({name:o,appearances:e.appearances,wins:e.wins,winsWithoutRoleChange:e.winsWithoutRoleChange,gamesWithoutRoleChange:e.gamesWithoutRoleChange,winRate:e.gamesWithoutRoleChange>0?(e.winsWithoutRoleChange/e.gamesWithoutRoleChange*100).toFixed(1):"0.0",winRateDisplay:Math.max(e.gamesWithoutRoleChange>0?e.winsWithoutRoleChange/e.gamesWithoutRoleChange*100:0,1)})).sort((o,e)=>e.appearances-o.appearances),P=g=>Array.from(g.entries()).map(([o,e])=>({name:o,appearances:e.appearances,wins:e.wins,winsWithoutRoleChange:e.winsWithoutRoleChange,gamesWithoutRoleChange:e.gamesWithoutRoleChange,winRate:e.gamesWithoutRoleChange>0?(e.winsWithoutRoleChange/e.gamesWithoutRoleChange*100).toFixed(1):"0.0",winRateDisplay:Math.max(e.gamesWithoutRoleChange>0?e.winsWithoutRoleChange/e.gamesWithoutRoleChange*100:0,1),roleBreakdown:Array.from(e.roleBreakdown.entries()).map(([u,t])=>({role:u,count:t})).sort((u,t)=>t.count-u.count)})).sort((o,e)=>e.appearances-o.appearances),R=g=>Array.from(g.entries()).map(([o,e])=>({name:o,appearances:e.appearances,wins:e.wins,winsWithoutRoleChange:e.winsWithoutRoleChange,gamesWithoutRoleChange:e.gamesWithoutRoleChange,winRate:e.gamesWithoutRoleChange>0?(e.winsWithoutRoleChange/e.gamesWithoutRoleChange*100).toFixed(1):"0.0",winRateDisplay:Math.max(e.gamesWithoutRoleChange>0?e.winsWithoutRoleChange/e.gamesWithoutRoleChange*100:0,1)})).sort((o,e)=>e.appearances-o.appearances);return{villageoisPowers:c(h),loupPowers:P(m),secondaryRoles:R(l)}}function he(){const{navigateToGameDetails:C,navigationState:h,updateNavigationState:m}=V(),l=_(),[c,P]=I.useState(h.rolesStatsState?.chartMode||"appearances"),{data:R,isLoading:g,error:o}=q(i=>ee(i));I.useEffect(()=>{(!h.rolesStatsState||h.rolesStatsState.chartMode!==c)&&m({rolesStatsState:{chartMode:c}})},[c,h.rolesStatsState,m]);const e=i=>{P(i),m({rolesStatsState:{chartMode:i}})},u=I.useMemo(()=>{if(!R)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const i=c==="winRate"?(d,s)=>parseFloat(s.winRate)-parseFloat(d.winRate):(d,s)=>s.appearances-d.appearances;return{villageoisPowers:[...R.villageoisPowers].sort(i),loupPowers:[...R.loupPowers].sort(i),secondaryRoles:[...R.secondaryRoles].sort(i)}},[R,c]);if(g)return a.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques des r√¥les..."});if(o)return a.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",o]});if(!R)return a.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de r√¥le disponible"});const t=u.villageoisPowers.length>0,p=u.loupPowers.length>0,f=u.secondaryRoles.length>0;if(!t&&!p&&!f)return a.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou r√¥le secondaire trouv√©"});const n=({active:i,payload:d})=>{if(i&&d&&d.length>0){const s=d[0].payload,S=s.gamesWithoutRoleChange<s.appearances;return a.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[a.jsx("div",{children:a.jsx("strong",{children:s.name})}),a.jsxs("div",{children:["Apparitions: ",s.appearances]}),S&&a.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",s.appearances-s.gamesWithoutRoleChange," avec changement de r√¥le (exclu du calcul)"]}),a.jsxs("div",{children:["Victoires: ",s.winsWithoutRoleChange]}),a.jsx("div",{children:a.jsxs("strong",{children:["Taux de victoire: ",s.winRate,"%"]})}),s.roleBreakdown&&s.roleBreakdown.length>0&&a.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[a.jsx("div",{style:{fontStyle:"italic"},children:"R√©partition par r√¥le:"}),s.roleBreakdown.map((W,A)=>a.jsxs("div",{style:{marginLeft:"0.5rem"},children:["‚Ä¢ ",W.role,": ",W.count]},A))]}),a.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null},r=(i,d,s,S,W)=>{const A=c==="appearances"?"appearances":"winRateDisplay",k=c==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",E=c==="winRate"?[0,100]:void 0;return a.jsxs("div",{className:"lycans-graphique-section",children:[a.jsx("h3",{children:d}),a.jsx(z,{title:M=>M?`${d} (Tous)`:`${d} (Top 15)`,children:M=>{const F=M?i:i.slice(0,15);return a.jsx("div",{style:{height:400},children:a.jsx(Z,{width:"100%",height:"100%",children:a.jsxs(Q,{data:F,margin:{top:20,right:30,left:20,bottom:80},children:[a.jsx(D,{strokeDasharray:"3 3"}),a.jsx($,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:12,tick:({x,y:w,payload:v})=>a.jsx("text",{x,y:w,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,transform:`rotate(-45 ${x} ${w})`,children:v.value})}),a.jsx(G,{label:{value:k,angle:270,position:"left",style:{textAnchor:"middle"}},domain:E}),a.jsx(H,{content:a.jsx(n,{})}),a.jsx(U,{dataKey:A,label:c==="winRate"?x=>{const{x:w,y:v,width:y,payload:j}=x;if(w===void 0||v===void 0||y===void 0||!j)return null;const b=j.winRate||"0";return a.jsxs("text",{x:w+y/2,y:v-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[b,"%"]})}:void 0,shape:x=>{const{x:w,y:v,width:y,height:j,payload:b,index:B}=x,T=b,L=W?W(T.name,B??0):s;return a.jsx(J,{x:w,y:v,width:y,height:j,fill:L,onClick:()=>S(T.name),style:{cursor:"pointer"}})}})]})})})}})]})};return a.jsxs("div",{className:"lycans-camps-container",children:[a.jsx("h2",{children:"Statistiques G√©n√©rales des R√¥les et Pouvoirs"}),a.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[a.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),a.jsxs("select",{id:"chart-mode-select",value:c,onChange:i=>e(i.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[a.jsx("option",{value:"appearances",children:"Apparitions"}),a.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),a.jsxs("div",{className:"lycans-graphiques-groupe",children:[t&&r(u.villageoisPowers,"Camp Villageois","var(--chart-color-1)",i=>{C({campFilter:{selectedCamp:"Villageois",campFilterMode:c==="winRate"?"wins-only":"all-assignments"},selectedPower:i,fromComponent:`Statistiques des R√¥les - Pouvoir: ${i}`})},i=>i==="Chasseur"&&l.Chasseur?l.Chasseur:i==="Alchimiste"&&l.Alchimiste?l.Alchimiste:i==="Protecteur"&&l.Protecteur?l.Protecteur:i==="Disciple"&&l.Disciple?l.Disciple:i==="Inquisiteur"&&l.Inquisiteur?l.Inquisiteur:"var(--chart-color-1)"),p&&r(u.loupPowers,"Camp Loups","var(--chart-color-2)",i=>{C({campFilter:{selectedCamp:"Loup",campFilterMode:c==="winRate"?"wins-only":"all-assignments"},selectedPower:i,fromComponent:`Statistiques des R√¥les - Pouvoir: ${i}`})},()=>l.Loup||"var(--chart-color-2)"),f&&r(u.secondaryRoles,"R√¥les Secondaires","var(--chart-color-3)",i=>{C({selectedSecondaryRole:i,fromComponent:`Statistiques des R√¥les - R√¥le Secondaire: ${i}`})}),a.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"‚ÑπÔ∏è Les victoires et le taux de victoire excluent les parties o√π le r√¥le principal a chang√© en cours de partie (ex: Garde en Chasseur, r√©ssucit√© en Zombie par un Vaudou, etc...)."})]})]})}export{he as RolesStatsChart};
