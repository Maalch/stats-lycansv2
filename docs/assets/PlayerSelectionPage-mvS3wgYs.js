import{a as O,r as R,g as U,k as se,u as B,j as e,c as ae,l as te}from"./index-9j0yNmlE.js";import{g as re,a as ie,u as le}from"./datasyncExport-bcUAUkAp.js";import{g as ne}from"./gameUtils-Dpj2rM4X.js";import{u as _}from"./useJoueursData-BQIGwbQ6.js";import{u as Y,g as oe,a as X,l as Q}from"./api-CwpVE0LH.js";import{F as G,C as M,X as z,Y as I,B as K,a as L,b as E}from"./FullscreenChart-D7ItcJF9.js";import{R as A,T as q}from"./CategoricalChart-Rs9Jf3nF.js";import{L as ce,a as de}from"./LineChart-ClLC0OuR.js";import{P as ue,a as me}from"./PieChart-zRpaq274.js";import{R as J}from"./ReferenceLine-B-QzOoOX.js";import{g as pe}from"./deathTypes-CGUOTngO.js";import"./ActivePoints-BJoh2c5R.js";import"./PolarChart-BJ5bh7mY.js";function he(m){const{settings:x}=O(),[f,C]=R.useState(null),[y,p]=R.useState(!1),[j,l]=R.useState(null);R.useEffect(()=>{let a=!0;return(async()=>{try{p(!0),l(null);const h=x.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",d=await fetch(h);if(!d.ok)throw new Error(`Failed to load achievements: ${d.status} ${d.statusText}`);const n=await d.json();a&&C(n)}catch(h){a&&l(h instanceof Error?h.message:"Failed to load achievements")}finally{a&&p(!1)}})(),()=>{a=!1}},[x.dataSource]);const r=m&&f?.achievements[m]||null;return R.useEffect(()=>{if(m&&f){const a=f.achievements[m];a?console.log(`ðŸ† Achievements for ${m} (${x.dataSource}):`,{allGames:a.allGamesAchievements.length,moddedOnly:a.moddedOnlyAchievements.length,categories:[...new Set([...a.allGamesAchievements.map(i=>i.category),...a.moddedOnlyAchievements.map(i=>i.category)])]}):console.log(`âŒ No achievements found for ${m} in ${x.dataSource} data source`)}},[m,f,x.dataSource]),{data:r,isLoading:y,error:j,metadata:{generatedAt:f?.generatedAt||null,totalPlayers:f?.totalPlayers||0,totalGames:f?.totalGames||0,totalModdedGames:f?.totalModdedGames||0}}}function ge(m,x){if(!m||m.trim()===""||x.length===0)return null;const f=[];let C=m;x.forEach(a=>{const i=a.PlayerStats.find(h=>U(h)===m||h.Username.toLowerCase()===m.toLowerCase());if(i){C=i.Username;const h=re(ie(i.MainRoleInitial,i.MainRoleChanges||[])),d=ne(a),n=i.Victorious,u=se(new Date(a.StartDate));f.push({gameId:a.Id,date:u,camp:h,won:n,winnerCamp:d,playersInGame:a.PlayerStats.length,mapName:a.MapName})}}),f.sort((a,i)=>{const h=d=>{const n=d.split("/");return n.length===3?new Date(parseInt(n[2]),parseInt(n[1])-1,parseInt(n[0])):new Date(d)};return h(i.date).getTime()-h(a.date).getTime()});const y=f.length,p=f.filter(a=>a.won).length,j=y>0?(p/y*100).toFixed(2):"0.00",l={};f.forEach(a=>{l[a.camp]||(l[a.camp]={appearances:0,wins:0,winRate:"0.00"}),l[a.camp].appearances++,a.won&&l[a.camp].wins++}),Object.keys(l).forEach(a=>{const i=l[a];i.winRate=i.appearances>0?(i.wins/i.appearances*100).toFixed(2):"0.00"});const r={};return f.forEach(a=>{r[a.mapName]||(r[a.mapName]={appearances:0,wins:0,winRate:"0.00"}),r[a.mapName].appearances++,a.won&&r[a.mapName].wins++}),Object.keys(r).forEach(a=>{const i=r[a];i.winRate=i.appearances>0?(i.wins/i.appearances*100).toFixed(2):"0.00"}),{playerName:C,totalGames:y,totalWins:p,winRate:j,games:f,campStats:l,mapStats:r}}function fe(m){const x={};let f=0,C=0;return Object.entries(m).forEach(([y,p])=>{y==="Village"||y==="ChÃ¢teau"?x[y]={...p}:(f+=p.appearances,C+=p.wins)}),f>=10&&(x.Autres={appearances:f,wins:C,winRate:f>0?(C/f*100).toFixed(2):"0.00"}),x}function H(m){const{data:x,isLoading:f,error:C}=le(y=>m?ge(m,y):null);return{data:x,isLoading:f,error:C}}function xe({achievements:m,title:x,emptyMessage:f,achievementType:C="all"}){const{navigateToTab:y,updateNavigationState:p,clearNavigation:j}=B(),{settings:l,updateSettings:r}=O(),{joueursData:a}=_(),i=Y(a),h=(s,w)=>{if(w.stopPropagation(),!s.redirectTo)return;j();const T=l.highlightedPlayer;if(r(C==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:T,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:T,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),s.category==="comparison"&&s.redirectTo.subTab==="comparison"){const o=l.highlightedPlayer||"",c=d(s.description,o);c&&p({playerComparisonState:{selectedPlayer1:o,selectedPlayer2:c,showDetailedStats:!0}})}if(s.category==="comparison"&&s.redirectTo.subTab==="pairing"){const o=s.description.toLowerCase().includes("loup");p({selectedPairingTab:o?"wolves":"lovers"})}if(s.category==="kills"&&s.redirectTo.subTab==="deathStats"){const o=s.description.match(/(Villageois|Loups|Autres)/i);o&&p({deathStatsSelectedCamp:o[1]});let c=10;const t=s.description.match(/min\.\s*(\d+)/);t&&(c=parseInt(t[1],10));let v="totalKills";const N=s.redirectTo.chartSection;N&&(N==="killers-total"?v="totalKills":N==="killers-average"?v="averageKills":N==="deaths-total"?v="totalDeaths":N==="survivors-average"&&(v="survivalRate")),p({deathStatisticsState:{selectedCamp:o?.[1]||"Tous les camps",minGamesForAverage:c,focusChart:v}})}if(s.category==="map"&&s.redirectTo.subTab==="playersGeneral"){const o=s.redirectTo.mapFilter||"all";let c=10;const t=s.description.match(/min\.\s*(\d+)/);t&&(c=parseInt(t[1])),r(C==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:o,playerFilter:{mode:"none",players:[]},highlightedPlayer:T,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:o,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:o,playerFilter:{mode:"none",players:[]},highlightedPlayer:T,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:o,playerFilter:{mode:"none",players:[]}}}),p({playersGeneralState:{minGamesForWinRate:c,winRateOrder:"best",focusChart:"winRate"}}),y("players","playersGeneral");return}if(s.category==="history"&&s.redirectTo.subTab==="history"&&p({selectedPlayerName:l.highlightedPlayer||"",groupingMethod:"session"}),s.category==="series"&&s.redirectTo.subTab==="series"){let o="wins";const c=s.title.toLowerCase(),t=s.description.toLowerCase();c.includes("dÃ©faite")||t.includes("dÃ©faite")?o="losses":c.includes("loup")||t.includes("loup")?o="loup":c.includes("villageois")||t.includes("villageois")?o="villageois":(c.includes("victoire")||t.includes("victoire"))&&(o="wins"),p({selectedSeriesType:o})}if(s.category==="general"&&s.redirectTo.subTab==="playersGeneral"){let o=10;const c=s.description.match(/min\.\s*(\d+)/);c&&(o=parseInt(c[1],10));let t="winRate",v="best";const N=s.title.toLowerCase(),S=s.description.toLowerCase();N.includes("participation")||S.includes("participation")?t="participation":(N.includes("taux de victoire")||S.includes("taux de victoire"))&&(t="winRate",(N.includes("moins bon")||N.includes("mauvais")||S.includes("moins bon")||S.includes("mauvais"))&&(v="worst")),p({playersGeneralState:{minGamesForWinRate:o,winRateOrder:v,focusChart:t}})}if(s.category==="performance"&&s.redirectTo.subTab==="campPerformance"){const o=s.redirectTo.chartSection;let c="Villageois",t=1;o&&(o==="camp-loup"?c="Loup":o==="camp-villageois"?c="Villageois":o==="camp-idiot"?c="Idiot du Village":o==="camp-amoureux"?c="Amoureux":(o==="solo-roles"||o==="hall-of-fame")&&(c="Villageois"));const v=s.description.match(/min\.\s*(\d+)/);v&&(t=parseInt(v[1],10)),o==="solo-roles"?c="RÃ´les spÃ©ciaux":o==="hall-of-fame"&&(c="Tous les camps"),p({campPerformanceState:{selectedCampPerformanceCamp:c,selectedCampPerformanceMinGames:t}})}if(s.category==="voting"&&s.redirectTo.subTab==="votingStats"){const o=s.title.toLowerCase();let c="overview",t="behavior";o.includes("agressivitÃ©")?(c="overview",t="behavior"):o.includes("taux de vote")?(c="behavior",t="voteRate"):o.includes("prÃ©cision")&&(c="overview",t="accuracy"),p({votingStatsState:{selectedCategory:c,selectedView:t}})}y(s.redirectTo.tab,s.redirectTo.subTab)},d=(s,w)=>{const T=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const o of T){const c=s.match(o);if(c&&c[1]){const t=c[1].trim();if(t!==w)return t}}return null},n=s=>{if(!s.redirectTo)return"Aucune navigation disponible";switch(s.category){case"general":if(s.redirectTo.subTab==="playersGeneral"){const o=s.description.match(/min\.\s*(\d+)/),c=o?parseInt(o[1],10):10,t=s.title.toLowerCase(),v=C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return t.includes("taux de victoire")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${c} parties)${v}`:t.includes("participation")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir les participations${v}`:`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${v}`}break;case"map":if(s.redirectTo.subTab==="playersGeneral"){const o=s.redirectTo.mapFilter,c=o==="village"?"Village":o==="chateau"?"ChÃ¢teau":"map",t=C==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${c}${t}`}break;case"history":if(s.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(s.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${d(s.description,l.highlightedPlayer||"")||"ce joueur"}`;if(s.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(s.redirectTo.subTab==="deathStats"){const o=s.description.match(/(Villageois|Loups|Autres)/i),c=s.description.match(/min\.\s*(\d+)/),t=c?parseInt(c[1],10):10,v=o?.[1]||"Tous les camps",N=s.redirectTo.chartSection;let S="kills et morts";return N==="killers-total"?S="total des kills":N==="killers-average"?S=`moyenne des kills (min. ${t} parties)`:N==="deaths-total"?S="total des morts":N==="survivors-average"&&(S=`taux de survie (min. ${t} parties)`),`Cliquez pour voir les statistiques de ${S} ${v!=="Tous les camps"?`en ${v}`:""}`}break;case"series":if(s.redirectTo.subTab==="series"){const o=s.title.toLowerCase(),c=s.description.toLowerCase();return o.includes("dÃ©faite")||c.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":o.includes("loup")||c.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":o.includes("villageois")||c.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":o.includes("victoire")||c.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(s.redirectTo.subTab==="campPerformance"){const o=s.redirectTo.chartSection,c=C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return o==="camp-loup"?`Cliquez pour voir les performances camp Loup${c}`:o==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${c}`:o==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${c}`:o==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${c}`:o==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${c}`:o==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${c}`:`Cliquez pour voir les performances par camp${c}`}break;case"voting":if(s.redirectTo.subTab==="votingStats"){const o=s.description.match(/min\.\s*(\d+)/),c=o?parseInt(o[1],10):25,t=C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",v=s.title.toLowerCase();return v.includes("agressivitÃ©")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${c} meetings)${t}`:v.includes("taux de vote")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${c} meetings)${t}`:v.includes("prÃ©cision")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${t}`:`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${t}`}break}return`Cliquez pour voir ${s.redirectTo.subTab}`+(C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},u=s=>i[s]||oe(s),b=s=>{const w=[/avec ([^:]+?):/,/contre ([^:]+?):/];let T=s;return w.forEach(o=>{const c=s.match(o);if(c&&c[1]){const t=c[1].trim(),N=`<span class="player-name-highlight" style="color: ${u(t)};">${t}</span>`;T=T.replace(t,N)}}),T};if(m.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:x}),e.jsx("p",{children:f||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const g=s=>s===1?"ðŸ¥‡":s===2?"ðŸ¥ˆ":s===3?"ðŸ¥‰":"",k=s=>s===1?"rank-1":s===2?"rank-2":s===3?"rank-3":s&&s<=10?"rank-top-10":"",$=m.filter(s=>s.category!=="comparison"&&(s.type==="good"||s.type==="neutral")).sort((s,w)=>(s.rank??999)-(w.rank??999)),F=m.filter(s=>s.category!=="comparison"&&s.type==="bad").sort((s,w)=>(s.rank??999)-(w.rank??999)),D=m.filter(s=>s.category==="comparison"),W=$.filter(s=>s.rank&&s.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:x}),W>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:$.filter(s=>s.rank&&s.rank<=3).map((s,w)=>e.jsxs("div",{className:`top3-card ${k(s.rank)} animate-slide-in`,style:{animationDelay:`${w*.15}s`},onClick:T=>h(s,T),title:n(s),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:g(s.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",s.rank,s.totalRanked?`/${s.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:s.title}),e.jsx("p",{className:"top3-achievement-description",children:s.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},s.id))})]}),$.length>0&&e.jsxs("div",{className:"achievements-section good-achievements",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:$.filter(s=>!s.rank||s.rank>3).map((s,w)=>e.jsxs("div",{className:`achievement-card good ${k(s.rank)}`,onClick:T=>h(s,T),title:n(s),style:{animationDelay:`${w*.05}s`},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:s.title}),e.jsxs("span",{className:"achievement-rank",children:["#",s.rank,s.totalRanked?`/${s.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:s.description})]},s.id))})]}),F.length>0&&e.jsxs("div",{className:"achievements-section bad-achievements",children:[e.jsx("h5",{children:"ðŸ’€ Classements (InversÃ©s)"}),e.jsx("div",{className:"achievements-grid",children:F.map(s=>e.jsxs("div",{className:`achievement-card bad rank-${s.rank}`,onClick:w=>h(s,w),title:n(s),children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:s.title}),e.jsxs("span",{className:"achievement-rank",children:["#",s.rank,s.totalRanked?`/${s.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:s.description})]},s.id))})]}),D.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:D.map(s=>e.jsxs("div",{className:"achievement-card comparison",onClick:w=>h(s,w),title:n(s),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:s.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:b(s.description)}})]},s.id))})]})]})}function ve({selectedPlayerName:m,groupingMethod:x,campFilter:f="all"}){const{navigateToGameDetails:C}=B(),{data:y,isLoading:p,error:j}=H(m),l=R.useMemo(()=>{switch(x){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[x]),r=R.useMemo(()=>{if(!y?.games)return new Map;const d=new Map;return y.games.forEach(n=>{if(!d.has(n.date)){const u=n.date.split("/");u.length===3?d.set(n.date,new Date(parseInt(u[2]),parseInt(u[1])-1,parseInt(u[0])).getTime()):d.set(n.date,new Date(n.date).getTime())}}),d},[y?.games]),a=R.useMemo(()=>{if(!y?.games)return[];const d={};return y.games.forEach(n=>{if(f!=="all"){if(f==="solo"){if(n.camp==="Villageois"||n.camp==="Loup")return}else if(n.camp!==f)return}let u;const b=n.date.split("/");if(x==="month")if(b.length===3)u=`${b[1].padStart(2,"0")}/${b[2]}`;else{const g=new Date(n.date);u=`${String(g.getMonth()+1).padStart(2,"0")}/${g.getFullYear()}`}else if(x==="quarter")if(b.length===3){const g=parseInt(b[1],10);u=`T${Math.floor((g-1)/3)+1}/${b[2]}`}else{const g=new Date(n.date);u=`T${Math.floor(g.getMonth()/3)+1}/${g.getFullYear()}`}else x==="year"?b.length===3?u=`${b[2]}`:u=`${new Date(n.date).getFullYear()}`:u=n.date;d[u]||(d[u]={games:[],wins:0,total:0}),d[u].games.push(n),d[u].total++,n.won&&d[u].wins++}),Object.entries(d).map(([n,u])=>({period:n,totalGames:u.total,victories:u.wins,defeats:u.total-u.wins,winRate:u.total>0?(u.wins/u.total*100).toFixed(1):"0.0",winRateNum:u.total>0?u.wins/u.total*100:0})).sort((n,u)=>{if(x==="month"){const[b,g]=n.period.split("/"),[k,$]=u.period.split("/"),F=new Date(parseInt(g),parseInt(b)-1,1),D=new Date(parseInt($),parseInt(k)-1,1);return F.getTime()-D.getTime()}else if(x==="quarter"){const[b,g]=n.period.split("/"),[k,$]=u.period.split("/"),F=parseInt(b.replace(/\D/g,""),10)||1,D=parseInt(k.replace(/\D/g,""),10)||1,W=new Date(parseInt(g,10),(F-1)*3,1),s=new Date(parseInt($,10),(D-1)*3,1);return W.getTime()-s.getTime()}else if(x==="year"){const b=parseInt(n.period,10),g=parseInt(u.period,10);return b-g}else{const b=r.get(n.period)||0,g=r.get(u.period)||0;return b-g}})},[y,x,r,f]),h=(d=>d<=15?{fontSize:12,angle:-45,height:80,interval:0}:d<=30?{fontSize:12,angle:-45,height:85,interval:1}:d<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(d/12)})(a.length);return p?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):j?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",j]}):y?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",l]}),e.jsx(G,{title:`Ã‰volution des Performances ${l}`,children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(ce,{data:a,margin:{top:20,right:30,left:20,bottom:20},onClick:d=>{if(d&&d.activeLabel){const n=a.find(u=>u.period===d.activeLabel);n&&C({selectedPlayer:m,selectedDate:n.period,fromComponent:`Ã‰volution des Performances ${l}`})}},style:{cursor:"pointer"},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"period",angle:h.angle,textAnchor:"end",height:h.height,interval:h.interval,fontSize:h.fontSize}),e.jsx(I,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(q,{content:({active:d,payload:n})=>{if(d&&n&&n.length>0){const u=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:u.period})}),e.jsxs("div",{children:["Parties: ",u.totalGames]}),e.jsxs("div",{children:["Victoires: ",u.victories]}),e.jsxs("div",{children:["Taux: ",u.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(de,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",l]}),e.jsx(G,{title:`RÃ©partition Victoires/DÃ©faites ${l}`,children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(K,{data:a,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"period",angle:h.angle,textAnchor:"end",height:h.height,interval:h.interval,fontSize:h.fontSize}),e.jsx(I,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(q,{content:({active:d,payload:n})=>{if(d&&n&&n.length>0){const u=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:u.period})}),e.jsxs("div",{children:["Total: ",u.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",u.victories]}),e.jsxs("div",{children:["DÃ©faites: ",u.defeats]}),e.jsxs("div",{children:["Taux: ",u.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(L,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:a.map((d,n)=>e.jsx(E,{fill:"var(--accent-tertiary)",onClick:()=>{C({selectedPlayer:m,selectedDate:d.period,fromComponent:`Historique Joueur - Victoires ${l}`})},style:{cursor:"pointer"}},`cell-victories-${n}`))}),e.jsx(L,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:a.map((d,n)=>e.jsx(E,{fill:"var(--chart-color-4)",onClick:()=>{C({selectedPlayer:m,selectedDate:d.period,fromComponent:`Historique Joueur - DÃ©faites ${l}`})},style:{cursor:"pointer"}},`cell-defeats-${n}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function je({selectedPlayerName:m}){const{navigateToGameDetails:x}=B(),{data:f,isLoading:C,error:y}=H(m),p=X(),j=R.useMemo(()=>f?.campStats?Object.entries(f.campStats).map(([r,a])=>({name:r,value:a.appearances,winRate:a.winRate,winRateDisplay:Math.max(parseFloat(a.winRate),1),wins:a.wins,percentage:(a.appearances/f.totalGames*100).toFixed(1)})):[],[f]),l=R.useMemo(()=>{if(!j.length)return[];const r=5;let a=0;const i=[],h=[];if(j.forEach(d=>{parseFloat(d.percentage)<r?(a+=Number(d.value),i.push(d)):h.push(d)}),a>0){const d=j.reduce((n,u)=>n+Number(u.value),0);h.push({name:"Autres",value:a,winRate:"0.0",winRateDisplay:1,wins:i.reduce((n,u)=>n+u.wins,0),percentage:(a/d*100).toFixed(1),_details:i})}return h},[j]);return C?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):y?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",y]}):f?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(ue,{children:[e.jsx(me,{data:l,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:r=>{const a=r.percent!==void 0?r.percent:0;return r.name==="Autres"?`Autres : ${r.value} (${(a*100).toFixed(1)}%)`:`${r.name}: ${r.value} (${(a*100).toFixed(1)}%)`},children:l.map((r,a)=>e.jsx(E,{fill:r.name==="Autres"?Q:p[r.name]||`var(--chart-color-${a%6+1})`,onClick:()=>{if(r.name==="Autres"){const i=r._details?.map(h=>h.name)||[];x({selectedPlayer:m,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:i},fromComponent:"Distribution par Camps"})}else r.name==="TraÃ®tre"||r.name==="Louveteau"?x({selectedPlayer:m,campFilter:{selectedCamp:r.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):r.name==="Loup"?x({selectedPlayer:m,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):x({selectedPlayer:m,campFilter:{selectedCamp:r.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${a}`))}),e.jsx(q,{content:({active:r,payload:a})=>{if(r&&a&&a.length>0){const i=a[0].payload;if(i.name==="Autres"&&i._details){const h=[...i._details].sort((d,n)=>n.value-d.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",i.value," parties (",i.percentage,"%)"]})}),e.jsx("div",{children:h.map((d,n)=>e.jsxs("div",{children:[d.name,": ",d.value," parties (",d.percentage,"%)"]},n))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[i.name," - ",i.value," parties (",i.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(G,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(K,{data:j,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(I,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(q,{content:({active:r,payload:a})=>{if(r&&a&&a.length>0){const i=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:i.name})}),e.jsxs("div",{children:["Victoires: ",i.wins," / ",i.value]}),e.jsxs("div",{children:["Taux: ",i.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(L,{dataKey:"winRateDisplay",children:j.map((r,a)=>e.jsx(E,{fill:parseFloat(r.winRate)===0?`${p[r.name]||`var(--chart-color-${a%6+1})`}50`:p[r.name]||`var(--chart-color-${a%6+1})`,onClick:()=>{r.name==="TraÃ®tre"||r.name==="Louveteau"?x({selectedPlayer:m,campFilter:{selectedCamp:r.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):r.name==="Loup"?x({selectedPlayer:m,campFilter:{selectedCamp:r.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):x({selectedPlayer:m,campFilter:{selectedCamp:r.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${a}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function ye({selectedPlayerName:m}){const{navigateToGameDetails:x}=B(),{data:f,isLoading:C,error:y}=H(m),p=R.useMemo(()=>{if(!f?.mapStats)return[];const j=fe(f.mapStats);return Object.entries(j).map(([l,r])=>({name:l,value:r.appearances,winRate:r.winRate,winRateDisplay:Math.max(parseFloat(r.winRate),.1),wins:r.wins,percentage:(r.appearances/f.totalGames*100).toFixed(1)}))},[f]);return C?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):y?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",y]}):f?p.length===0?e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de carte disponible"}),e.jsx("p",{children:"Aucune statistique de carte n'est disponible pour ce joueur."})]}):e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Carte"}),e.jsx(G,{title:"Performance par Carte",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(K,{data:p,margin:{top:20,right:140,left:20,bottom:20},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(I,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(J,{y:50,stroke:"var(--text-secondary)",strokeDasharray:"5 5",strokeOpacity:.5}),(()=>{if(p.length>0){const j=p.reduce((a,i)=>a+i.value,0),l=p.reduce((a,i)=>a+i.wins,0),r=j>0?l/j*100:0;if(r!==50)return e.jsx(J,{y:r,stroke:"var(--accent-primary)",strokeDasharray:"3 3",strokeOpacity:.7,label:{value:`Moyenne: ${r.toFixed(1)}%`,position:"right",offset:5,style:{fill:"var(--accent-primary)"}}})}return null})(),e.jsx(q,{content:({active:j,payload:l})=>{if(j&&l&&l.length>0){const r=l[0].payload,a=[];return p.forEach(i=>{if(i.name!==r.name&&i.value>=5){const h=parseFloat(r.winRate)-parseFloat(i.winRate);Math.abs(h)>=2&&a.push({map:i.name,diff:h,better:h>0})}}),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:"250px"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.name})}),e.jsxs("div",{children:["Parties: ",r.value]}),e.jsxs("div",{children:["Victoires: ",r.wins]}),e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("strong",{children:["Taux: ",r.winRate,"%"]})}),a.length>0&&e.jsxs("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"0.8rem",fontWeight:"bold",marginBottom:"0.25rem"},children:"Comparaisons:"}),a.map((i,h)=>e.jsxs("div",{style:{fontSize:"0.75rem",color:i.better?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[i.better?"â†—":"â†˜"," ",Math.abs(i.diff).toFixed(1),"% vs ",i.map]},h))]}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(L,{dataKey:"winRateDisplay",label:j=>{const{x:l,y:r,width:a,payload:i}=j;if(l===void 0||r===void 0||a===void 0||!i)return null;const h=i.winRate||"0";return e.jsxs("text",{x:l+a/2,y:r-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[h,"%"]})},onClick:j=>{j&&j.name&&x({selectedPlayer:m,selectedMapName:j.name,fromComponent:"Performance par Carte"})},children:p.map((j,l)=>{let r;j.name==="Village"?r="var(--accent-secondary)":j.name==="ChÃ¢teau"?r="var(--accent-tertiary)":j.name==="Autres"?r=Q:r=`var(--chart-color-${l%6+1})`;const a=Math.max(...p.map(h=>parseFloat(h.winRate))),i=parseFloat(j.winRate)===a&&a>0;return e.jsx(E,{fill:parseFloat(j.winRate)===0?`${r}30`:r,stroke:"transparent",strokeWidth:i?3:1,style:{cursor:"pointer"}},`cell-map-${l}`)})})]})})})})]})}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function be({selectedPlayerName:m}){const{gameData:x}=ae(),{joueursData:f}=_(),C=Y(f),y=X(),p=R.useMemo(()=>{if(!x||!m)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const l={},r={},a={},i=new Set;x.forEach(b=>{const g=b.PlayerStats.find(k=>k.Username.toLowerCase()===m.toLowerCase());if(g&&(b.PlayerStats.forEach(k=>{k.KillerName?.toLowerCase()===m.toLowerCase()&&(l[k.Username]=(l[k.Username]||0)+1)}),g.KillerName&&(r[g.KillerName]=(r[g.KillerName]||0)+1),g.DeathType)){const k=g.DeathType,$=pe(k);a[$]||(a[$]={count:0,byDeathType:{}}),a[$].count+=1,a[$].byDeathType[k]=(a[$].byDeathType[k]||0)+1,i.add(k)}});const h=Object.entries(l).map(([b,g])=>({player:b,kills:g})).sort((b,g)=>g.kills-b.kills).slice(0,10),d=Object.entries(r).map(([b,g])=>({player:b,kills:g})).sort((b,g)=>g.kills-b.kills).slice(0,10),n=Object.entries(a).map(([b,g])=>{const k={deathType:b,count:g.count};return k[b]=g.count,k}).sort((b,g)=>g.count-b.count).slice(0,10),u=Object.keys(a);return{playersKilled:h,killedBy:d,deathTypes:n,availableDeathTypes:u}},[x,m]),j=R.useMemo(()=>{const l={};p.availableDeathTypes.forEach(i=>{i==="TuÃ© par Loup"?l[i]=y.Loup:i==="Mort aux votes"?l[i]="var(--chart-color-1)":i.includes("Chasseur")?l[i]=y.Chasseur:i==="TuÃ© par Zombie"?l[i]=y.Vaudou:i==="TuÃ© par potion assassin"?l[i]=y.Alchimiste:i==="TuÃ© par Vengeur"?l[i]="var(--chart-color-2)":i==="Amoureux mort"?l[i]=y.Amoureux:i==="TuÃ© par La BÃªte"?l[i]="var(--chart-color-3)":i==="TuÃ© par ShÃ©rif"&&(l[i]="var(--chart-color-4)")});const r=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let a=0;return p.availableDeathTypes.forEach(i=>{l[i]||(l[i]=r[a%r.length],a++)}),l},[p.availableDeathTypes,y]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[p.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(G,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(K,{data:p.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(I,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(q,{content:({active:l,payload:r})=>{if(l&&r&&r.length>0){const a=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.player})}),e.jsxs("div",{children:["TuÃ© ",a.kills," fois par ",m]})]})}return null}}),e.jsx(L,{dataKey:"kills",children:p.playersKilled.map((l,r)=>e.jsx(E,{fill:C[l.player]||"var(--chart-color-3)"},`cell-killed-${r}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[m," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),p.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(G,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(K,{data:p.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(I,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(q,{content:({active:l,payload:r})=>{if(l&&r&&r.length>0){const a=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.player})}),e.jsxs("div",{children:["A tuÃ© ",m," ",a.kills," fois"]})]})}return null}}),e.jsx(L,{dataKey:"kills",children:p.killedBy.map((l,r)=>e.jsx(E,{fill:C[l.player]||"var(--chart-color-4)"},`cell-killer-${r}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[m," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),p.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(G,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(K,{data:p.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(I,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(q,{content:({active:l,payload:r})=>{if(l&&r&&r.length>0){const a=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.deathType})}),e.jsxs("div",{children:[m," est mort ",a.count," fois ainsi"]})]})}return null}}),p.availableDeathTypes.map(l=>e.jsx(L,{dataKey:l,name:l,stackId:"deaths",fill:j[l]||"var(--chart-color-5)"},l))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",m,"."]})]})]})}function Me(){const{settings:m,updateSettings:x}=O(),{navigateToGameDetails:f}=B(),{data:C,isLoading:y,error:p}=te(),{joueursData:j,isLoading:l}=_(),{data:r,isLoading:a,error:i}=he(m.highlightedPlayer),h=Y(j),[d,n]=R.useState(""),[u,b]=R.useState("all"),[g,k]=R.useState("achievements"),[$,F]=R.useState("session"),[D,W]=R.useState("all"),{data:s}=H(m.highlightedPlayer||""),w=R.useMemo(()=>{if(!C||!C.GameStats)return[];const t=new Map;return C.GameStats.forEach(v=>{const N=new Date(v.StartDate);v.PlayerStats.forEach(S=>{const P=U(S),Z=j?.Players?.find(ee=>ee.SteamID===P)?.Joueur||S.Username;t.has(P)||t.set(P,{games:0,wins:0,firstDate:N,lastDate:N,displayName:Z});const V=t.get(P);V.games++,S.Victorious&&V.wins++,N<V.firstDate&&(V.firstDate=N),N>V.lastDate&&(V.lastDate=N)})}),Array.from(t.entries()).map(([v,N])=>{let S=j?.Players?.find(P=>P.SteamID===v);return S||(S=j?.Players?.find(P=>P.Joueur===N.displayName)),{name:N.displayName,totalGames:N.games,totalWins:N.wins,winRate:N.games>0?N.wins/N.games*100:0,firstGameDate:N.firstDate.toLocaleDateString("fr-FR"),lastGameDate:N.lastDate.toLocaleDateString("fr-FR"),isHighlighted:N.displayName===m.highlightedPlayer,image:S?.Image||null,twitch:S?.Twitch||null,youtube:S?.Youtube||null}})},[C,m.highlightedPlayer,j]),T=R.useMemo(()=>{if(!d.trim())return w;const t=d.toLowerCase();return w.filter(v=>v.name.toLowerCase().includes(t))},[w,d]),o=R.useMemo(()=>[...T].sort((t,v)=>v.totalGames-t.totalGames),[T]),c=t=>{x({highlightedPlayer:t}),n("")};return y||l?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):p?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",p]})]}):!C||w.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!m.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:d,onChange:t=>n(t.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[T.length," joueur",T.length!==1?"s":"",d&&` (filtrÃ©${T.length!==1?"s":""} de ${w.length})`]})]})]}),e.jsx("div",{className:"player-display",children:d?T.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{className:"clear-search-btn",onClick:()=>n(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:o.map(t=>e.jsxs("button",{className:`suggestion-btn ${t.isHighlighted?"highlighted":""}`,onClick:()=>c(t.name),children:[t.image?e.jsx("img",{src:t.image,alt:t.name,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":h[t.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[t.name,t.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[t.totalGames," parties â€¢ ",t.winRate.toFixed(1),"% victoires"]})]})]},t.name))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',d,'"']}),e.jsx("button",{className:"clear-search-btn",onClick:()=>n(""),children:"Effacer la recherche"})]}):m.highlightedPlayer?(()=>{const t=w.find(v=>v.name===m.highlightedPlayer);return t?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:t.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[t.image?e.jsx("img",{src:t.image,alt:t.name,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":h[t.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[t.totalGames," parties â€¢ ",t.totalWins," victoires â€¢ ",t.winRate.toFixed(1),"% taux de victoire"]}),(t.twitch||t.youtube)&&e.jsxs("div",{className:"social-links",children:[t.twitch&&e.jsx("a",{href:t.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),t.youtube&&e.jsx("a",{href:t.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{className:`lycans-categorie-btn ${g==="achievements"?"active":""}`,onClick:()=>k("achievements"),children:"Classement"}),e.jsx("button",{className:`lycans-categorie-btn ${g==="evolution"?"active":""}`,onClick:()=>k("evolution"),children:"Ã‰volution"}),e.jsx("button",{className:`lycans-categorie-btn ${g==="camps"?"active":""}`,onClick:()=>k("camps"),children:"Camps"}),e.jsx("button",{className:`lycans-categorie-btn ${g==="maps"?"active":""}`,onClick:()=>k("maps"),children:"Maps"}),e.jsx("button",{className:`lycans-categorie-btn ${g==="kills"?"active":""}`,onClick:()=>k("kills"),children:"Kills"})]}),g==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[a?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):i?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",i]})}):r?e.jsx(xe,{achievements:u==="all"?r.allGamesAchievements:r.moddedOnlyAchievements,title:u==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:u}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[e.jsx("button",{className:`filter-btn ${u==="all"?"active":""}`,onClick:v=>{v.stopPropagation(),b("all")},children:"Toutes les parties"}),e.jsx("button",{className:`filter-btn ${u==="modded"?"active":""}`,onClick:v=>{v.stopPropagation(),b("modded")},children:"Parties moddÃ©es"})]})]}),g==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[s&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{f({selectedPlayer:t.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${t.name}`,children:s.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{f({selectedPlayer:t.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${t.name}`,children:s.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",children:[s.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:$,onChange:v=>F(v.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:D,onChange:v=>W(v.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(ve,{selectedPlayerName:t.name,groupingMethod:$,campFilter:D})]}),g==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(je,{selectedPlayerName:t.name})}),g==="maps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ye,{selectedPlayerName:t.name})}),g==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(be,{selectedPlayerName:t.name})}),e.jsx("button",{className:"highlight-btn active",onClick:v=>{v.stopPropagation(),x({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[t.firstGameDate," - ",t.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',m.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{className:"clear-selection-btn",onClick:()=>x({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:o.map(t=>e.jsxs("div",{className:`character-card ${t.isHighlighted?"highlighted":""}`,onClick:()=>c(t.name),title:`${t.name} - ${t.totalGames} parties, ${t.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:t.image?e.jsx("img",{src:t.image,alt:t.name,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":h[t.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:t.name}),(t.twitch||t.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[t.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),t.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},t.name))})})})]})}export{Me as PlayerSelectionPage};
