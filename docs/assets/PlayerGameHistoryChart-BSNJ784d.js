import{f as E,u as L,a as V,r as w,j as e}from"./index-CJPRgSeP.js";import{u as B}from"./baseStatsHook-DUccMnDl.js";import{g as H,a as K}from"./gameUtils-BuNbDi0M.js";import{u as J}from"./usePlayerStatsFromRaw-DM0FqWfJ.js";import{a as _,l as O}from"./api-4LJ_jFsa.js";import{F,C as A,X as M,Y as N,B as q,a as k,b as S}from"./FullscreenChart-Cv7ZtWwO.js";import{R as D,T as R}from"./CategoricalChart-BCfBsU0K.js";import{L as X,a as Y}from"./LineChart-D2Ts5NlD.js";import{P as U,a as Q}from"./PieChart-BmLzeo4L.js";import"./ActivePoints-BOSWoZjn.js";import"./PolarChart-CflbDeT8.js";function Z(s,u){if(!s||s.trim()===""||u.length===0)return null;const h=[];u.forEach(n=>{const i=n.PlayerStats.find(o=>o.Username.toLowerCase()===s.toLowerCase());if(i){const o=H(i.MainRoleInitial),j=K(n),v=i.Victorious,c=E(new Date(n.StartDate));h.push({gameId:n.Id,date:c,camp:o,won:v,winnerCamp:j,playersInGame:n.PlayerStats.length})}}),h.sort((n,i)=>{const o=j=>{const v=j.split("/");return v.length===3?new Date(parseInt(v[2]),parseInt(v[1])-1,parseInt(v[0])):new Date(j)};return o(i.date).getTime()-o(n.date).getTime()});const p=h.length,x=h.filter(n=>n.won).length,y=p>0?(x/p*100).toFixed(2):"0.00",m={};return h.forEach(n=>{m[n.camp]||(m[n.camp]={appearances:0,wins:0,winRate:"0.00"}),m[n.camp].appearances++,n.won&&m[n.camp].wins++}),Object.keys(m).forEach(n=>{const i=m[n];i.winRate=i.appearances>0?(i.wins/i.appearances*100).toFixed(2):"0.00"}),{playerName:s,totalGames:p,totalWins:x,winRate:y,games:h,campStats:m}}function ee(s){const{data:u,isLoading:h,error:p}=B(x=>s?Z(s,x):null);return{data:u,isLoading:h,error:p}}function he(){const{navigateToGameDetails:s,navigationState:u,updateNavigationState:h}=L(),{settings:p}=V(),x=_(),{data:y}=J(),m=w.useMemo(()=>{if(!y?.playerStats)return["Ponce"];const t=y.playerStats.filter(r=>r.gamesPlayed>0).map(r=>r.player).sort();return p.highlightedPlayer&&!t.includes(p.highlightedPlayer)&&y.playerStats.some(r=>r.player===p.highlightedPlayer&&r.gamesPlayed>0)&&(t.push(p.highlightedPlayer),t.sort()),t},[y,p.highlightedPlayer]),i=u.selectedPlayerName&&m.includes(u.selectedPlayerName)?u.selectedPlayerName:p.highlightedPlayer&&m.includes(p.highlightedPlayer)?p.highlightedPlayer:m[0]||"Ponce",o=u.groupingMethod||"session",j=t=>{h({selectedPlayerName:t})},v=t=>{h({groupingMethod:t})},{data:c,isLoading:I,error:z}=ee(i),T=w.useMemo(()=>{if(!c?.games)return new Map;const t=new Map;return c.games.forEach(r=>{if(!t.has(r.date)){const a=r.date.split("/");a.length===3?t.set(r.date,new Date(parseInt(a[2]),parseInt(a[1])-1,parseInt(a[0])).getTime()):t.set(r.date,new Date(r.date).getTime())}}),t},[c?.games]),C=w.useMemo(()=>{if(!c?.games)return[];const t={};return c.games.forEach(r=>{let a;if(o==="month"){const l=r.date.split("/");l.length===3?a=`${l[1]}/${l[2]}`:a=r.date}else a=r.date;t[a]||(t[a]={games:[],wins:0,total:0}),t[a].games.push(r),t[a].total++,r.won&&t[a].wins++}),Object.entries(t).map(([r,a])=>({period:r,totalGames:a.total,victories:a.wins,defeats:a.total-a.wins,winRate:a.total>0?(a.wins/a.total*100).toFixed(1):"0.0",winRateNum:a.total>0?a.wins/a.total*100:0})).sort((r,a)=>{if(o==="month"){const[l,d]=r.period.split("/"),[g,P]=a.period.split("/"),G=new Date(parseInt(d),parseInt(l)-1,1),W=new Date(parseInt(P),parseInt(g)-1,1);return G.getTime()-W.getTime()}else{const l=T.get(r.period)||0,d=T.get(a.period)||0;return l-d}})},[c,o,T]),b=w.useMemo(()=>c?.campStats?Object.entries(c.campStats).map(([t,r])=>({name:t,value:r.appearances,winRate:r.winRate,winRateDisplay:Math.max(parseFloat(r.winRate),1),wins:r.wins,percentage:(r.appearances/c.totalGames*100).toFixed(1)})):[],[c]),$=w.useMemo(()=>{if(!b.length)return[];const t=5;let r=0;const a=[],l=[];if(b.forEach(d=>{parseFloat(d.percentage)<t?(r+=Number(d.value),a.push(d)):l.push(d)}),r>0){const d=b.reduce((g,P)=>g+Number(P.value),0);l.push({name:"Autres",value:r,winRate:"0.0",wins:a.reduce((g,P)=>g+P.wins,0),percentage:(r/d*100).toFixed(1),_details:a})}return l},[b]),f=(t=>t<=15?{fontSize:12,angle:-45,height:80,interval:0}:t<=30?{fontSize:12,angle:-45,height:85,interval:1}:t<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(t/12)})(C.length);return I?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):z?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",z]}):c?e.jsxs("div",{className:"lycans-player-history",children:[e.jsx("h2",{children:"Historique D√©taill√© d'un Joueur"}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Joueur:"}),e.jsx("select",{id:"player-select",value:i,onChange:t=>j(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:m.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:o,onChange:t=>v(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"})]})]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{s({selectedPlayer:i,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${i}`,children:c.totalGames}),e.jsx("p",{children:"parties jou√©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{s({selectedPlayer:i,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${i}`,children:c.totalWins}),e.jsx("p",{children:"parties gagn√©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",children:[c.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["√âvolution des Performances ",o==="month"?"par Mois":"par Session"]}),e.jsx(F,{title:`√âvolution des Performances ${o==="month"?"par Mois":"par Session"}`,children:e.jsx("div",{style:{height:400},children:e.jsx(D,{width:"100%",height:"100%",children:e.jsxs(X,{data:C,margin:{top:20,right:30,left:20,bottom:20},onClick:t=>{if(t&&t.activeLabel){const r=C.find(a=>a.period===t.activeLabel);r&&s({selectedPlayer:i,selectedDate:r.period,fromComponent:`√âvolution des Performances ${o==="month"?"par Mois":"par Session"}`})}},style:{cursor:"pointer"},children:[e.jsx(A,{strokeDasharray:"3 3"}),e.jsx(M,{dataKey:"period",angle:f.angle,textAnchor:"end",height:f.height,interval:f.interval,fontSize:f.fontSize}),e.jsx(N,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(R,{content:({active:t,payload:r})=>{if(t&&r&&r.length>0){const a=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.period})}),e.jsxs("div",{children:["Parties: ",a.totalGames]}),e.jsxs("div",{children:["Victoires: ",a.victories]}),e.jsxs("div",{children:["Taux: ",a.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(Y,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["R√©partition Victoires/D√©faites ",o==="month"?"par Mois":"par Session"]}),e.jsx(F,{title:`R√©partition Victoires/D√©faites ${o==="month"?"par Mois":"par Session"}`,children:e.jsx("div",{style:{height:400},children:e.jsx(D,{width:"100%",height:"100%",children:e.jsxs(q,{data:C,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(A,{strokeDasharray:"3 3"}),e.jsx(M,{dataKey:"period",angle:f.angle,textAnchor:"end",height:f.height,interval:f.interval,fontSize:f.fontSize}),e.jsx(N,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(R,{content:({active:t,payload:r})=>{if(t&&r&&r.length>0){const a=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.period})}),e.jsxs("div",{children:["Total: ",a.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",a.victories]}),e.jsxs("div",{children:["D√©faites: ",a.defeats]}),e.jsxs("div",{children:["Taux: ",a.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(k,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:C.map((t,r)=>e.jsx(S,{fill:"var(--accent-tertiary)",onClick:()=>{s({selectedPlayer:i,selectedDate:t.period,fromComponent:`Historique Joueur - Victoires ${o==="month"?"par Mois":"par Session"}`})},style:{cursor:"pointer"}},`cell-victories-${r}`))}),e.jsx(k,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"D√©faites",children:C.map((t,r)=>e.jsx(S,{fill:"var(--chart-color-4)",onClick:()=>{s({selectedPlayer:i,selectedDate:t.period,fromComponent:`Historique Joueur - D√©faites ${o==="month"?"par Mois":"par Session"}`})},style:{cursor:"pointer"}},`cell-defeats-${r}`))})]})})})})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(D,{width:"100%",height:"100%",children:e.jsxs(U,{children:[e.jsx(Q,{data:$,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:({name:t,value:r,percent:a})=>{const l=a!==void 0?a:0;return t==="Autres"?`Autres : ${r} (${(l*100).toFixed(1)}%)`:`${t}: ${r} (${(l*100).toFixed(1)}%)`},children:$.map((t,r)=>e.jsx(S,{fill:t.name==="Autres"?O:x[t.name]||`var(--chart-color-${r%6+1})`,onClick:()=>{if(t.name==="Autres"){const a=t._details?.map(l=>l.name)||[];s({selectedPlayer:i,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:a},fromComponent:"Distribution par Camps"})}else t.name==="Tra√Ætre"?s({selectedPlayer:i,campFilter:{selectedCamp:"Tra√Ætre",campFilterMode:"all-assignments",excludeTraitor:!0},fromComponent:"Distribution par Camps"}):t.name==="Loup"?s({selectedPlayer:i,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeTraitor:!0},fromComponent:"Distribution par Camps"}):s({selectedPlayer:i,campFilter:{selectedCamp:t.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${r}`))}),e.jsx(R,{content:({active:t,payload:r})=>{if(t&&r&&r.length>0){const a=r[0].payload;if(a.name==="Autres"&&a._details){const l=[...a._details].sort((d,g)=>g.value-d.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",a.value," parties (",a.percentage,"%)"]})}),e.jsx("div",{children:l.map((d,g)=>e.jsxs("div",{children:[d.name,": ",d.value," parties (",d.percentage,"%)"]},g))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[a.name," (",a.percentage,"%)"]})}),e.jsxs("div",{children:["Apparitions: ",a.value]}),e.jsxs("div",{children:["Victoires: ",a.wins," (",a.winRate,"%)"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(F,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(D,{width:"100%",height:"100%",children:e.jsxs(q,{data:b,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(A,{strokeDasharray:"3 3"}),e.jsx(M,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(N,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(R,{content:({active:t,payload:r})=>{if(t&&r&&r.length>0){const a=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.name})}),e.jsxs("div",{children:["Victoires: ",a.wins," / ",a.value]}),e.jsxs("div",{children:["Taux: ",a.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(k,{dataKey:"winRateDisplay",children:b.map((t,r)=>e.jsx(S,{fill:parseFloat(t.winRate)===0?`${x[t.name]||`var(--chart-color-${r%6+1})`}50`:x[t.name]||`var(--chart-color-${r%6+1})`,onClick:()=>{t.name==="Tra√Ætre"?s({selectedPlayer:i,campFilter:{selectedCamp:t.name,campFilterMode:"all-assignments",excludeTraitor:!0},fromComponent:"Performance par Camp"}):t.name==="Loup"?s({selectedPlayer:i,campFilter:{selectedCamp:t.name,campFilterMode:"all-assignments",excludeTraitor:!0},fromComponent:"Performance par Camp"}):s({selectedPlayer:i,campFilter:{selectedCamp:t.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${r}`))})]})})})})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e d'historique disponible"})}export{he as PlayerGameHistoryChart};
