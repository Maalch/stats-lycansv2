import{a as xe,r as k,g as ie,f as Ve,u as de,j as e,d as fe,h as We,e as qe,v as Ee}from"./index-DGFV8OXQ.js";import{u as ue}from"./useJoueursData-B1Cilqb1.js";import{u as Ce}from"./baseStatsHook-D3rI5qPx.js";import{g as Ge}from"./gameUtils-rkfcKAVy.js";import{a as Ae,g as pe,c as Re,b as Oe}from"./datasyncExport-BirWLS1z.js";import{u as ve,g as Be,b as me,l as Ke,C as ce,f as Se}from"./api-zvTdSM8o.js";import{f as oe,d as He}from"./durationFormatters-C9UyWcKX.js";import{F as _,C as Y,X as J,Y as Q}from"./FullscreenChart-CzXmwdZ1.js";import{R as H,T as U,a as te}from"./CategoricalChart-XlP9iajG.js";import{L as Ue,a as _e}from"./LineChart-QQQ_SJvf.js";import{B as ee,a as K}from"./BarChart-BXpjcvj0.js";import{P as Me,a as ze}from"./PieChart-BCbx3pL6.js";import{g as ge}from"./deathTypes-gHH1w6_X.js";import{i as we,g as Ne,V as Ye,a as Je}from"./roleUtils-g252S1-m.js";import{i as Qe,c as Xe}from"./wolfTransformUtils-DiCKErCz.js";import{L as Fe}from"./Legend-aHAPoeRJ.js";import{S as Ze,R as le,e as et,f as tt,h as ye,a as st,b as rt,d as at}from"./deathLocationUtils-fnuyHRmu.js";import{a as it,u as nt}from"./useClips-BaBupSmi.js";import{C as ot,f as Pe,a as lt}from"./ClipViewer-CDu9ppPA.js";import"./ActivePoints-B6kgt4Dw.js";import"./PolarChart-7OZ55_ha.js";import"./CartesianScaleHelper-B5QcuZLv.js";function ct(r){const{settings:m}=xe(),{joueursData:f}=ue(),[b,g]=k.useState(null),[n,w]=k.useState(!1),[h,u]=k.useState(null);k.useEffect(()=>{let c=!0;return(async()=>{try{w(!0),u(null);const o=m.dataSource==="discord"?"/data/discord/playerRankings.json":"/data/playerRankings.json",t=await fetch(o);if(!t.ok)throw new Error(`Failed to load Rankings: ${t.status} ${t.statusText}`);const i=await t.json();c&&g(i)}catch(o){c&&u(o instanceof Error?o.message:"Failed to load Rankings")}finally{c&&w(!1)}})(),()=>{c=!1}},[m.dataSource]);const x=(()=>{if(!r||!b)return null;const a=f?.Players?.find(o=>o.Joueur===r)?.SteamID;return a&&b.Rankings[a]||null})();return k.useEffect(()=>{r&&b&&f&&f.Players?.find(o=>o.Joueur===r)?.SteamID},[r,b,f,m.dataSource]),{data:x,isLoading:n,error:h,metadata:{generatedAt:b?.generatedAt||null,totalPlayers:b?.totalPlayers||0,totalGames:b?.totalGames||0,totalModdedGames:b?.totalModdedGames||0}}}function dt(r,m,f){if(!r||r.trim()===""||m.length===0)return null;const b=[];let g=r;m.forEach(a=>{const o=a.PlayerStats.find(t=>ie(t)===r||t.Username.toLowerCase()===r.toLowerCase());if(o){g=o.Username;const t=o.MainRoleInitial==="Louveteau"?o.MainRoleInitial:Ae(o.MainRoleInitial,o.MainRoleChanges||[]),i=pe(t);if(f&&f!=="Tous les camps"&&i!==f)return;const p=Ge(a),d=o.Victorious,l=Ve(new Date(a.StartDate)),v=Re(a.StartDate,a.EndDate)||0;b.push({gameId:a.Id,date:l,camp:i,won:d,winnerCamp:p,playersInGame:a.PlayerStats.length,mapName:a.MapName,duration:v})}}),b.sort((a,o)=>{const t=i=>{const p=i.split("/");return p.length===3?new Date(parseInt(p[2]),parseInt(p[1])-1,parseInt(p[0])):new Date(i)};return t(o.date).getTime()-t(a.date).getTime()});const n=b.length,w=b.filter(a=>a.won).length,h=n>0?(w/n*100).toFixed(2):"0.00",u={};b.forEach(a=>{u[a.camp]||(u[a.camp]={appearances:0,wins:0,winRate:"0.00"}),u[a.camp].appearances++,a.won&&u[a.camp].wins++}),Object.keys(u).forEach(a=>{const o=u[a];o.winRate=o.appearances>0?(o.wins/o.appearances*100).toFixed(2):"0.00"});const x={};b.forEach(a=>{x[a.mapName]||(x[a.mapName]={appearances:0,wins:0,winRate:"0.00"}),x[a.mapName].appearances++,a.won&&x[a.mapName].wins++}),Object.keys(x).forEach(a=>{const o=x[a];o.winRate=o.appearances>0?(o.wins/o.appearances*100).toFixed(2):"0.00"});const c=b.reduce((a,o)=>a+o.duration,0);return{playerName:g,totalGames:n,totalWins:w,winRate:h,totalPlayTime:c,games:b,campStats:u,mapStats:x}}function je(r,m){const{data:f,isLoading:b,error:g}=Ce(n=>r?dt(r,n,m):null);return{data:f,isLoading:b,error:g}}function ut(r){const{settings:m}=xe(),[f,b]=k.useState(null),[g,n]=k.useState(null),[w,h]=k.useState(!0),[u,x]=k.useState(null);return k.useEffect(()=>{(async()=>{h(!0),x(null);try{const a=m.dataSource==="discord"?"/data/discord/playerTitles.json":"/data/playerTitles.json",o=await fetch(a);if(!o.ok){if(o.status===404)b(null),n(null),x("Les titres n'ont pas encore Ã©tÃ© gÃ©nÃ©rÃ©s. Ils seront disponibles aprÃ¨s la prochaine synchronisation hebdomadaire.");else throw new Error(`HTTP error! status: ${o.status}`);return}const t=await o.json();if(b(t),r&&t.players){const i=Object.entries(t.players).find(([p,d])=>d.playerName===r);n(i?i[1]:null)}else n(null)}catch(a){console.error("Error loading player titles:",a),x(a instanceof Error?a.message:"Erreur inconnue"),b(null),n(null)}finally{h(!1)}})()},[m.dataSource,r]),{data:f,playerData:g,isLoading:w,error:u}}function mt({rankings:r,title:m,emptyMessage:f,rankingType:b="all"}){const{navigateToTab:g,updateNavigationState:n,clearNavigation:w}=de(),{settings:h,updateSettings:u}=xe(),{joueursData:x}=ue(),c=ve(x),a=(s,R)=>{if(R.stopPropagation(),!s.redirectTo)return;w();const L=h.highlightedPlayer;if(u(b==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:L,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:L,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),s.category==="comparison"&&s.redirectTo.subTab==="comparison"){const y=h.highlightedPlayer||"",C=o(s.description,y);C&&n({playerComparisonState:{selectedPlayer1:y,selectedPlayer2:C,showDetailedStats:!0}})}if(s.category==="comparison"&&s.redirectTo.subTab==="pairing"){const y=s.description.toLowerCase().includes("loup");n({selectedPairingTab:y?"wolves":"lovers"})}if(s.category==="kills"&&s.redirectTo.subTab==="deathStats"){const y=s.description.match(/(Villageois|Loups|Autres)/i);y&&n({deathStatsSelectedCamp:y[1]});let C=10;const j=s.description.match(/min\.\s*(\d+)/);j&&(C=parseInt(j[1],10));let P="totalKills",S="killers";const D=s.redirectTo.chartSection;D&&(D==="killers-total"?(P="totalKills",S="killers"):D==="killers-average"?(P="averageKills",S="killers"):D==="deaths-total"?(P="totalDeaths",S="deaths"):D==="survivors-average"?(P="survivalRate",S="deaths"):(D==="hunters-good"||D==="hunters-bad")&&(S="hunter",P="averageKills")),n({deathStatisticsState:{selectedCamp:y?.[1]||"Tous les camps",minGamesForAverage:C,selectedView:S,focusChart:P}})}if(s.category==="map"&&s.redirectTo.subTab==="playersGeneral"){const y=s.redirectTo.mapFilter||"all";let C=10;const j=s.description.match(/min\.\s*(\d+)/);j&&(C=parseInt(j[1])),u(b==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:y,playerFilter:{mode:"none",players:[]},highlightedPlayer:L,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:y,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:y,playerFilter:{mode:"none",players:[]},highlightedPlayer:L,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:y,playerFilter:{mode:"none",players:[]}}}),n({playersGeneralState:{minGamesForWinRate:C,winRateOrder:"best",focusChart:"winRate"}}),g("players","playersGeneral");return}if(s.category==="history"&&s.redirectTo.subTab==="history"&&n({selectedPlayerName:h.highlightedPlayer||"",groupingMethod:"session"}),s.category==="series"&&s.redirectTo.subTab==="series"){let y="wins";const C=s.title.toLowerCase(),j=s.description.toLowerCase();C.includes("dÃ©faite")||j.includes("dÃ©faite")?y="losses":C.includes("loup")||j.includes("loup")?y="loup":C.includes("villageois")||j.includes("villageois")?y="villageois":(C.includes("victoire")||j.includes("victoire"))&&(y="wins"),n({selectedSeriesType:y})}if(s.category==="general"&&s.redirectTo.subTab==="playersGeneral"){let y=10;const C=s.description.match(/min\.\s*(\d+)/);C&&(y=parseInt(C[1],10));let j="winRate",P="best";const S=s.title.toLowerCase(),D=s.description.toLowerCase();S.includes("participation")||D.includes("participation")?j="participation":(S.includes("taux de victoire")||D.includes("taux de victoire"))&&(j="winRate",(S.includes("moins bon")||S.includes("mauvais")||D.includes("moins bon")||D.includes("mauvais"))&&(P="worst")),n({playersGeneralState:{minGamesForWinRate:y,winRateOrder:P,focusChart:j}})}if(s.category==="performance"&&s.redirectTo.subTab==="campStats"){const y=s.redirectTo.chartSection;let C="Villageois",j=1;y&&(y==="camp-loup"?C="Loup":y==="camp-villageois"?C="Villageois":y==="camp-idiot"?C="Idiot du Village":y==="camp-amoureux"?C="Amoureux":(y==="solo-roles"||y==="hall-of-fame")&&(C="Villageois"));const P=s.description.match(/min\.\s*(\d+)/);P&&(j=parseInt(P[1],10)),y==="solo-roles"?C="RÃ´les spÃ©ciaux":y==="hall-of-fame"&&(C="Tous les camps"),n({campPerformanceState:{selectedCampPerformanceCamp:C,selectedCampPerformanceMinGames:j,viewMode:"performance"}})}if(s.category==="voting"&&s.redirectTo.subTab==="votingStats"){const y=s.title.toLowerCase();let C="overview",j="behavior";y.includes("agressivitÃ©")?(C="overview",j="behavior"):y.includes("taux de vote")?(C="behavior",j="voteRate"):y.includes("prÃ©cision")&&(C="overview",j="accuracy"),n({votingStatsState:{selectedCategory:C,selectedView:j}})}if(s.category==="loot"&&s.redirectTo.subTab==="lootStats"){const y=s.redirectTo,C=y.minGames||5,j=y.view||"normalized";n({lootStatsState:{minGames:C,campFilter:"all",view:j}})}g(s.redirectTo.tab,s.redirectTo.subTab)},o=(s,R)=>{const L=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const y of L){const C=s.match(y);if(C&&C[1]){const j=C[1].trim();if(j!==R)return j}}return null},t=s=>{if(!s.redirectTo)return"Aucune navigation disponible";switch(s.category){case"general":if(s.redirectTo.subTab==="playersGeneral"){const y=s.description.match(/min\.\s*(\d+)/),C=y?parseInt(y[1],10):10,j=s.title.toLowerCase(),P=b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return j.includes("taux de victoire")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${C} parties)${P}`:j.includes("participation")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir les participations${P}`:`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${P}`}break;case"map":if(s.redirectTo.subTab==="playersGeneral"){const y=s.redirectTo.mapFilter,C=y==="village"?"Village":y==="chateau"?"ChÃ¢teau":"map",j=b==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${C}${j}`}break;case"history":if(s.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(s.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${o(s.description,h.highlightedPlayer||"")||"ce joueur"}`;if(s.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(s.redirectTo.subTab==="deathStats"){const y=s.description.match(/(Villageois|Loups|Autres)/i),C=s.description.match(/min\.\s*(\d+)/),j=C?parseInt(C[1],10):10,P=y?.[1]||"Tous les camps",S=s.redirectTo.chartSection;let D="kills et morts";return S==="killers-total"?D="total des kills":S==="killers-average"?D=`moyenne des kills (min. ${j} parties)`:S==="deaths-total"?D="total des morts":S==="survivors-average"&&(D=`taux de survie (min. ${j} parties)`),`Cliquez pour voir les statistiques de ${D} ${P!=="Tous les camps"?`en ${P}`:""}`}break;case"series":if(s.redirectTo.subTab==="series"){const y=s.title.toLowerCase(),C=s.description.toLowerCase();return y.includes("dÃ©faite")||C.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":y.includes("loup")||C.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":y.includes("villageois")||C.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":y.includes("victoire")||C.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(s.redirectTo.subTab==="campStats"){const y=s.redirectTo.chartSection,C=b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return y==="camp-loup"?`Cliquez pour voir les performances camp Loup${C}`:y==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${C}`:y==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${C}`:y==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${C}`:y==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${C}`:y==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${C}`:`Cliquez pour voir les performances par camp${C}`}break;case"voting":if(s.redirectTo.subTab==="votingStats"){const y=s.description.match(/min\.\s*(\d+)/),C=y?parseInt(y[1],10):25,j=b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",P=s.title.toLowerCase();return P.includes("agressivitÃ©")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${C} meetings)${j}`:P.includes("taux de vote")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${C} meetings)${j}`:P.includes("prÃ©cision")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${j}`:`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${j}`}break;case"loot":if(s.redirectTo.subTab==="lootStats"){const y=s.description.match(/min\.\s*(\d+)/),C=y?parseInt(y[1],10):25,j=b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir le taux de rÃ©colte (min. ${C} parties)${j}`}break}return`Cliquez pour voir ${s.redirectTo.subTab}`+(b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},i=s=>c[s]||Be(s),p=s=>{const R=[/avec ([^:]+?):/,/contre ([^:]+?):/];let L=s;return R.forEach(y=>{const C=s.match(y);if(C&&C[1]){const j=C[1].trim(),S=`<span class="player-name-highlight" style="color: ${i(j)};">${j}</span>`;L=L.replace(j,S)}}),L};if(r.length===0)return e.jsxs("div",{className:"rankings-empty",children:[e.jsx("h4",{children:m}),e.jsx("p",{children:f||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const d=s=>s===1?"ðŸ¥‡":s===2?"ðŸ¥ˆ":s===3?"ðŸ¥‰":"",l=s=>s===1?"rank-1":s===2?"rank-2":s===3?"rank-3":s&&s<=10?"rank-top-10":"",v=(s,R)=>{if(!s||s<=3||!R)return;const L=s-3,y=R-3;return y<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(L-1)/(y-1))}, 70%, 50%)`},F=(s,R)=>{if(!s||!R)return;if(R<=1)return"hsl(0, 70%, 50%)";const L=(s-1)/(R-1),y=L*15,C=50-L*15;return`hsl(${y}, 70%, ${C}%)`},T=s=>{if(!s)return;const R=s.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(R){const[,L,y]=R;return`hsl(${L}, ${y}%, 40%)`}return s},A=r.filter(s=>s.category!=="comparison"&&(s.type==="good"||s.type==="neutral")).sort((s,R)=>(s.rank??999)-(R.rank??999)),z=r.filter(s=>s.category!=="comparison"&&s.type==="bad").sort((s,R)=>(s.rank??999)-(R.rank??999)),V=r.filter(s=>s.category==="comparison"),$=[...A,...z].sort((s,R)=>(s.rank??999)-(R.rank??999)),G=A.filter(s=>s.rank&&s.rank<=3).length;return e.jsxs("div",{className:"rankings-container",children:[e.jsx("h4",{children:m}),G>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:A.filter(s=>s.rank&&s.rank<=3).map((s,R)=>e.jsxs("div",{className:`top3-card ${l(s.rank)} animate-slide-in`,style:{animationDelay:`${R*.15}s`},onClick:L=>a(s,L),title:t(s),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:d(s.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",s.rank,s.totalRanked?`/${s.totalRanked}`:""]}),e.jsx("h6",{className:"top3-ranking-title",children:s.title}),e.jsx("p",{className:"top3-ranking-description",children:s.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},s.id))})]}),$.length>0&&e.jsxs("div",{className:"rankings-section unified-rankings",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"rankings-grid",children:$.filter(s=>s.type==="bad"?!0:!s.rank||s.rank>3).map((s,R)=>{const L=s.type==="bad",y=L?F(s.rank,s.totalRanked):v(s.rank,s.totalRanked),C=T(y),j=L?"":l(s.rank);return e.jsxs("div",{className:`ranking-card ${L?"bad":"good"} ${j}`,onClick:P=>a(s,P),title:t(s),style:{animationDelay:`${R*.05}s`,borderLeftColor:C,borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"ranking-header",children:[e.jsxs("span",{className:"ranking-title",children:[L&&"ðŸ’€ ",s.title]}),e.jsxs("span",{className:"ranking-rank",style:y?{backgroundColor:y}:{},children:["#",s.rank,s.totalRanked?`/${s.totalRanked}`:""]})]}),e.jsx("p",{className:"ranking-description",children:s.description})]},s.id)})})]}),V.length>0&&e.jsxs("div",{className:"rankings-section comparison-rankings",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques CoÃ©quipiers et Face-Ã -Face"}),e.jsx("div",{className:"rankings-grid",children:V.map(s=>e.jsxs("div",{className:"ranking-card comparison",onClick:R=>a(s,R),title:t(s),children:[e.jsx("div",{className:"ranking-header",children:e.jsx("span",{className:"ranking-title",children:s.title})}),e.jsx("p",{className:"ranking-description",dangerouslySetInnerHTML:{__html:p(s.description)}})]},s.id))})]})]})}function ht({selectedPlayerName:r,groupingMethod:m,campFilter:f="all"}){const{navigateToGameDetails:b}=de(),{data:g,isLoading:n,error:w}=je(r),h=k.useMemo(()=>{switch(m){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[m]),u=k.useMemo(()=>{if(!g?.games)return new Map;const o=new Map;return g.games.forEach(t=>{if(!o.has(t.date)){const i=t.date.split("/");i.length===3?o.set(t.date,new Date(parseInt(i[2]),parseInt(i[1])-1,parseInt(i[0])).getTime()):o.set(t.date,new Date(t.date).getTime())}}),o},[g?.games]),x=k.useMemo(()=>{if(!g?.games)return[];const o={};return g.games.forEach(t=>{if(f!=="all"){if(f==="solo"){if(t.camp==="Villageois"||t.camp==="Loup")return}else if(t.camp!==f)return}let i;const p=t.date.split("/");if(m==="month")if(p.length===3)i=`${p[1].padStart(2,"0")}/${p[2]}`;else{const d=new Date(t.date);i=`${String(d.getMonth()+1).padStart(2,"0")}/${d.getFullYear()}`}else if(m==="quarter")if(p.length===3){const d=parseInt(p[1],10);i=`T${Math.floor((d-1)/3)+1}/${p[2]}`}else{const d=new Date(t.date);i=`T${Math.floor(d.getMonth()/3)+1}/${d.getFullYear()}`}else m==="year"?p.length===3?i=`${p[2]}`:i=`${new Date(t.date).getFullYear()}`:i=t.date;o[i]||(o[i]={games:[],wins:0,total:0}),o[i].games.push(t),o[i].total++,t.won&&o[i].wins++}),Object.entries(o).map(([t,i])=>({period:t,totalGames:i.total,victories:i.wins,defeats:i.total-i.wins,winRate:i.total>0?(i.wins/i.total*100).toFixed(1):"0.0",winRateNum:i.total>0?i.wins/i.total*100:0})).sort((t,i)=>{if(m==="month"){const[p,d]=t.period.split("/"),[l,v]=i.period.split("/"),F=new Date(parseInt(d),parseInt(p)-1,1),T=new Date(parseInt(v),parseInt(l)-1,1);return F.getTime()-T.getTime()}else if(m==="quarter"){const[p,d]=t.period.split("/"),[l,v]=i.period.split("/"),F=parseInt(p.replace(/\D/g,""),10)||1,T=parseInt(l.replace(/\D/g,""),10)||1,A=new Date(parseInt(d,10),(F-1)*3,1),z=new Date(parseInt(v,10),(T-1)*3,1);return A.getTime()-z.getTime()}else if(m==="year"){const p=parseInt(t.period,10),d=parseInt(i.period,10);return p-d}else{const p=u.get(t.period)||0,d=u.get(i.period)||0;return p-d}})},[g,m,u,f]),a=(o=>o<=15?{fontSize:12,angle:-45,height:80,interval:0}:o<=30?{fontSize:12,angle:-45,height:85,interval:1}:o<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(o/12)})(x.length);return n?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):w?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",w]}):g?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",h]}),e.jsx(_,{title:`Ã‰volution des Performances ${h}`,children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(Ue,{data:x,margin:{top:20,right:30,left:20,bottom:20},onClick:o=>{if(o&&o.activeLabel){const t=x.find(i=>i.period===o.activeLabel);t&&b({selectedPlayer:r,selectedDate:t.period,fromComponent:`Ã‰volution des Performances ${h}`})}},style:{cursor:"pointer"},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"period",angle:a.angle,textAnchor:"end",height:a.height,interval:a.interval,fontSize:a.fontSize,tick:({x:o,y:t,payload:i})=>e.jsx("text",{x:o,y:t,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:a.fontSize,fontStyle:"italic",transform:`rotate(${a.angle} ${o} ${t})`,children:i.value})}),e.jsx(Q,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(U,{content:({active:o,payload:t})=>{if(o&&t&&t.length>0){const i=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:i.period})}),e.jsxs("div",{children:["Parties: ",i.totalGames]}),e.jsxs("div",{children:["Victoires: ",i.victories]}),e.jsxs("div",{children:["Taux: ",i.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(_e,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",h]}),e.jsx(_,{title:`RÃ©partition Victoires/DÃ©faites ${h}`,children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:x,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"period",angle:a.angle,textAnchor:"end",height:a.height,interval:a.interval,fontSize:a.fontSize,tick:({x:o,y:t,payload:i})=>e.jsx("text",{x:o,y:t,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:a.fontSize,fontStyle:"italic",transform:`rotate(${a.angle} ${o} ${t})`,children:i.value})}),e.jsx(Q,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(U,{content:({active:o,payload:t})=>{if(o&&t&&t.length>0){const i=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:i.period})}),e.jsxs("div",{children:["Total: ",i.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",i.victories]}),e.jsxs("div",{children:["DÃ©faites: ",i.defeats]}),e.jsxs("div",{children:["Taux: ",i.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(K,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",shape:o=>{const{x:t,y:i,width:p,height:d,payload:l}=o,v=l;return e.jsx(te,{x:t,y:i,width:p,height:d,fill:"var(--accent-tertiary)",onClick:()=>{b({selectedPlayer:r,selectedDate:v.period,fromComponent:`Historique Joueur - Victoires ${h}`})},style:{cursor:"pointer"}})}}),e.jsx(K,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",shape:o=>{const{x:t,y:i,width:p,height:d,payload:l}=o,v=l;return e.jsx(te,{x:t,y:i,width:p,height:d,fill:"var(--chart-color-4)",onClick:()=>{b({selectedPlayer:r,selectedDate:v.period,fromComponent:`Historique Joueur - DÃ©faites ${h}`})},style:{cursor:"pointer"}})}})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function pt({selectedPlayerName:r}){const{navigateToGameDetails:m}=de(),{data:f,isLoading:b,error:g}=je(r),n=me(),w=c=>{if(c.name==="Autres"){const a=c._details?.map(o=>o.name)||[];m({selectedPlayer:r,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:a},fromComponent:"Distribution par Camps"})}else c.name==="TraÃ®tre"||c.name==="Louveteau"?m({selectedPlayer:r,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):c.name==="Loup"?m({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):m({selectedPlayer:r,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},h=k.useMemo(()=>f?.campStats?Object.entries(f.campStats).map(([c,a])=>({name:c,value:a.appearances,winRate:a.winRate,winRateDisplay:Math.max(parseFloat(a.winRate),1),wins:a.wins,percentage:(a.appearances/f.totalGames*100).toFixed(1)})):[],[f]),u=k.useMemo(()=>{if(!h.length)return[];const c=5;let a=0;const o=[],t=[];if(h.forEach(i=>{parseFloat(i.percentage)<c?(a+=Number(i.value),o.push(i)):t.push(i)}),a>0){const i=h.reduce((p,d)=>p+Number(d.value),0);t.push({name:"Autres",value:a,winRate:"0.0",winRateDisplay:1,wins:o.reduce((p,d)=>p+d.wins,0),percentage:(a/i*100).toFixed(1),_details:o})}return t},[h]),x=k.useMemo(()=>u.map((c,a)=>({...c,fill:c.name==="Autres"?Ke:n[c.name]||`var(--chart-color-${a%6+1})`})),[u,n]);return b?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):g?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]}):f?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(Me,{children:[e.jsx(ze,{data:x,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:c=>{const a=c.percent!==void 0?c.percent:0;return c.name==="Autres"?`Autres : ${c.value} (${(a*100).toFixed(1)}%)`:`${c.name}: ${c.value} (${(a*100).toFixed(1)}%)`},onClick:c=>w(c)}),e.jsx(U,{content:({active:c,payload:a})=>{if(c&&a&&a.length>0){const o=a[0].payload;if(o.name==="Autres"&&o._details){const t=[...o._details].sort((i,p)=>p.value-i.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",o.value," parties (",o.percentage,"%)"]})}),e.jsx("div",{children:t.map((i,p)=>e.jsxs("div",{children:[i.name,": ",i.value," parties (",i.percentage,"%)"]},p))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[o.name," - ",o.value," parties (",o.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(_,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:h,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14,tick:({x:c,y:a,payload:o})=>e.jsx("text",{x:c,y:a,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:14,fontStyle:"italic",transform:`rotate(-45 ${c} ${a})`,children:o.value})}),e.jsx(Q,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(U,{content:({active:c,payload:a})=>{if(c&&a&&a.length>0){const o=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:o.name})}),e.jsxs("div",{children:["Victoires: ",o.wins," / ",o.value]}),e.jsxs("div",{children:["Taux: ",o.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(K,{dataKey:"winRateDisplay",shape:c=>{const{x:a,y:o,width:t,height:i,payload:p,index:d}=c,l=p,v=n[l.name]||`var(--chart-color-${(d??0)%6+1})`,F=parseFloat(l.winRate)===0?`${v}50`:v;return e.jsx(te,{x:a,y:o,width:t,height:i,fill:F,onClick:()=>{l.name==="TraÃ®tre"||l.name==="Louveteau"?m({selectedPlayer:r,campFilter:{selectedCamp:l.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):l.name==="Loup"?m({selectedPlayer:r,campFilter:{selectedCamp:l.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):m({selectedPlayer:r,campFilter:{selectedCamp:l.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}})}})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function gt({selectedPlayerName:r}){const{gameData:m}=fe(),{joueursData:f}=ue(),b=ve(f),g=me(),n=k.useMemo(()=>{if(!m||!r)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const h={},u={},x={},c=new Set;m.forEach(p=>{const d=p.PlayerStats.find(l=>l.Username.toLowerCase()===r.toLowerCase());if(d&&(p.PlayerStats.forEach(l=>{l.KillerName?.toLowerCase()===r.toLowerCase()&&(h[l.Username]=(h[l.Username]||0)+1)}),d.KillerName&&(u[d.KillerName]=(u[d.KillerName]||0)+1),d.DeathType)){const l=d.DeathType,v=ge(l);x[v]||(x[v]={count:0,byDeathType:{}}),x[v].count+=1,x[v].byDeathType[l]=(x[v].byDeathType[l]||0)+1,c.add(l)}});const a=Object.entries(h).map(([p,d])=>({player:p,kills:d})).sort((p,d)=>d.kills-p.kills).slice(0,ce.TOP_10),o=Object.entries(u).map(([p,d])=>({player:p,kills:d})).sort((p,d)=>d.kills-p.kills).slice(0,ce.TOP_10),t=Object.entries(x).map(([p,d])=>{const l={deathType:p,count:d.count};return l[p]=d.count,l}).sort((p,d)=>d.count-p.count).slice(0,ce.TOP_10),i=Object.keys(x);return{playersKilled:a,killedBy:o,deathTypes:t,availableDeathTypes:i}},[m,r]),w=k.useMemo(()=>{const h={};n.availableDeathTypes.forEach(c=>{c==="TuÃ© par Loup"?h[c]=g.Loup:c==="Mort aux votes"?h[c]="var(--chart-color-1)":c.includes("Chasseur")?h[c]=g.Chasseur:c==="TuÃ© par Zombie"?h[c]=g.Vaudou:c==="TuÃ© par potion assassin"?h[c]=g.Alchimiste:c==="TuÃ© par Vengeur"?h[c]="var(--chart-color-2)":c==="Amoureux mort"?h[c]=g.Amoureux:c==="TuÃ© par La BÃªte"?h[c]="var(--chart-color-3)":c==="TuÃ© par ShÃ©rif"&&(h[c]="var(--chart-color-4)")});const u=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let x=0;return n.availableDeathTypes.forEach(c=>{h[c]||(h[c]=u[x%u.length],x++)}),h},[n.availableDeathTypes,g]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[n.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(_,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14,tick:({x:h,y:u,payload:x})=>e.jsx("text",{x:h,y:u,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:14,fontStyle:"italic",transform:`rotate(-45 ${h} ${u})`,children:x.value})}),e.jsx(Q,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(U,{content:({active:h,payload:u})=>{if(h&&u&&u.length>0){const x=u[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:x.player})}),e.jsxs("div",{children:["TuÃ© ",x.kills," fois par ",r]})]})}return null}}),e.jsx(K,{dataKey:"kills",shape:h=>{const{x:u,y:x,width:c,height:a,payload:o}=h,i=b[o.player]||"var(--chart-color-3)";return e.jsx(te,{x:u,y:x,width:c,height:a,fill:i})}})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[r," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),n.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(_,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14,tick:({x:h,y:u,payload:x})=>e.jsx("text",{x:h,y:u,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:14,fontStyle:"italic",transform:`rotate(-45 ${h} ${u})`,children:x.value})}),e.jsx(Q,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(U,{content:({active:h,payload:u})=>{if(h&&u&&u.length>0){const x=u[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:x.player})}),e.jsxs("div",{children:["A tuÃ© ",r," ",x.kills," fois"]})]})}return null}}),e.jsx(K,{dataKey:"kills",shape:h=>{const{x:u,y:x,width:c,height:a,payload:o}=h,i=b[o.player]||"var(--chart-color-4)";return e.jsx(te,{x:u,y:x,width:c,height:a,fill:i})}})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[r," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),n.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(_,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12,tick:({x:h,y:u,payload:x})=>e.jsx("text",{x:h,y:u,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,fontStyle:"italic",transform:`rotate(-45 ${h} ${u})`,children:x.value})}),e.jsx(Q,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(U,{content:({active:h,payload:u})=>{if(h&&u&&u.length>0){const x=u[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:x.deathType})}),e.jsxs("div",{children:[r," est mort ",x.count," fois ainsi"]})]})}return null}}),n.availableDeathTypes.map(h=>e.jsx(K,{dataKey:h,name:h,stackId:"deaths",fill:w[h]||"var(--chart-color-5)"},h))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",r,"."]})]})]})}function xt(r,m){if(!r||r.trim()===""||m.length===0)return null;const f=new Map,b=new Map,g=new Map;m.forEach(x=>{if(!x.Modded)return;const c=x.PlayerStats.find(a=>ie(a)===r||a.Username.toLowerCase()===r.toLowerCase());if(c){if(c.MainRoleInitial==="Inconnu")return;const a=c.Victorious,t=Ae(c.MainRoleInitial,c.MainRoleChanges||[])!==c.MainRoleInitial,i=pe(c.MainRoleInitial),p=i==="Loup"||i==="TraÃ®tre"||i==="Louveteau";if(i==="Villageois"&&we(c)){const d=Ne(c);if(d&&Ye.includes(d)){const l=f.get(d)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};f.set(d,{appearances:l.appearances+1,wins:l.wins+(a?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!t&&a?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(t?0:1)})}}else if(c.Power&&c.Power.trim()!==""&&c.Power!=="Inconnu"){if(i==="Villageois"){const d=f.get(c.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};f.set(c.Power,{appearances:d.appearances+1,wins:d.wins+(a?1:0),winsWithoutRoleChange:d.winsWithoutRoleChange+(!t&&a?1:0),gamesWithoutRoleChange:d.gamesWithoutRoleChange+(t?0:1)})}else if(p){const d=b.get(c.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},l=d.roleBreakdown;l.set(c.MainRoleInitial,(l.get(c.MainRoleInitial)||0)+1),b.set(c.Power,{appearances:d.appearances+1,wins:d.wins+(a?1:0),winsWithoutRoleChange:d.winsWithoutRoleChange+(!t&&a?1:0),gamesWithoutRoleChange:d.gamesWithoutRoleChange+(t?0:1),roleBreakdown:l})}}else if((i==="Villageois"||p)&&c.Power!=="Inconnu")if(i==="Villageois"){const d=f.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};f.set("Aucun pouvoir",{appearances:d.appearances+1,wins:d.wins+(a?1:0),winsWithoutRoleChange:d.winsWithoutRoleChange+(!t&&a?1:0),gamesWithoutRoleChange:d.gamesWithoutRoleChange+(t?0:1)})}else{const d=b.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},l=d.roleBreakdown;l.set(c.MainRoleInitial,(l.get(c.MainRoleInitial)||0)+1),b.set("Aucun pouvoir",{appearances:d.appearances+1,wins:d.wins+(a?1:0),winsWithoutRoleChange:d.winsWithoutRoleChange+(!t&&a?1:0),gamesWithoutRoleChange:d.gamesWithoutRoleChange+(t?0:1),roleBreakdown:l})}if(c.SecondaryRole&&c.SecondaryRole.trim()!==""&&c.SecondaryRole!=="Inconnu"){const d=g.get(c.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};g.set(c.SecondaryRole,{appearances:d.appearances+1,wins:d.wins+(a?1:0),winsWithoutRoleChange:d.winsWithoutRoleChange+(!t&&a?1:0),gamesWithoutRoleChange:d.gamesWithoutRoleChange+(t?0:1)})}}});const n=new Map;m.forEach(x=>{const c=x.PlayerStats.find(a=>ie(a)===r||a.Username.toLowerCase()===r.toLowerCase());if(c&&we(c)){const a=Ne(c);a&&n.set(a,(n.get(a)||0)+1)}});const w=x=>Array.from(x.entries()).map(([c,a])=>({name:c,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...n.has(c)&&{totalGamesAllModes:n.get(c)}})).sort((c,a)=>a.appearances-c.appearances),h=x=>Array.from(x.entries()).map(([c,a])=>({name:c,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(a.roleBreakdown.entries()).map(([o,t])=>({role:o,count:t})).sort((o,t)=>t.count-o.count)})).sort((c,a)=>a.appearances-c.appearances),u=x=>Array.from(x.entries()).map(([c,a])=>({name:c,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((c,a)=>a.appearances-c.appearances);return{villageoisPowers:w(f),loupPowers:h(b),secondaryRoles:u(g)}}function yt({selectedPlayerName:r}){const{navigateToGameDetails:m,navigationState:f,updateNavigationState:b}=de(),g=me(),[n,w]=k.useState(f.playerHistoryRolesState?.chartMode||"appearances"),{data:h,isLoading:u,error:x}=Ce(v=>xt(r,v));k.useEffect(()=>{(!f.playerHistoryRolesState||f.playerHistoryRolesState.chartMode!==n)&&b({playerHistoryRolesState:{chartMode:n}})},[n,f.playerHistoryRolesState,b]);const c=v=>{w(v),b({playerHistoryRolesState:{chartMode:v}})},a=k.useCallback(v=>{if(!h)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const F=1,T=1,A=n==="winRate"?($,G)=>parseFloat(G.winRate)-parseFloat($.winRate):($,G)=>G.appearances-$.appearances,z=$=>({...$,winRateDisplay:Math.max(parseFloat($.winRate),1)}),V=$=>v===null?$:$.slice(0,v);return{villageoisPowers:V(h.villageoisPowers.filter($=>$.appearances>=F).map(z).sort(A)),loupPowers:V(h.loupPowers.filter($=>$.appearances>=F).map(z).sort(A)),secondaryRoles:V(h.secondaryRoles.filter($=>$.appearances>=T).map(z).sort(A))}},[h,n]),o=k.useMemo(()=>a(15),[a]);if(u)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(x)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",x]});if(!h)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const t=o.villageoisPowers.length>0,i=o.loupPowers.length>0,p=o.secondaryRoles.length>0;if(!t&&!i&&!p)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const d=({active:v,payload:F})=>{if(v&&F&&F.length>0){const T=F[0].payload,A=T.gamesWithoutRoleChange<T.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:T.name})}),e.jsxs("div",{children:["Apparitions: ",T.appearances]}),A&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",T.appearances-T.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",T.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",T.winRate,"%"]})}),T.totalGamesAllModes&&T.totalGamesAllModes!==T.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",T.totalGamesAllModes,")"]}),T.roleBreakdown&&T.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),T.roleBreakdown.map((z,V)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",z.role,": ",z.count]},V))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},l=(v,F,T,A,z)=>{const V=n==="appearances"?"appearances":"winRateDisplay",$=n==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",G=n==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:F}),e.jsx(_,{title:F,children:s=>{const L=a(s?null:15)[v];return e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:L,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14,tick:({x:y,y:C,payload:j})=>e.jsx("text",{x:y,y:C,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:14,fontStyle:"italic",transform:`rotate(-45 ${y} ${C})`,children:j.value})}),e.jsx(Q,{label:{value:$,angle:270,position:"left",style:{textAnchor:"middle"}},domain:G}),e.jsx(U,{content:e.jsx(d,{})}),e.jsx(K,{dataKey:V,label:n==="winRate"?y=>{const{x:C,y:j,width:P,payload:S}=y;if(C===void 0||j===void 0||P===void 0||!S)return null;const D=S.winRate||"0";return e.jsxs("text",{x:C+P/2,y:j-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[D,"%"]})}:void 0,shape:y=>{const{x:C,y:j,width:P,height:S,payload:D,index:M}=y,I=D,E=z?z(I.name,M??0):T;return e.jsx(te,{x:C,y:j,width:P,height:S,fill:E,onClick:()=>A(I.name),style:{cursor:"pointer"}})}})]})})})}})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:n,onChange:v=>c(v.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[t&&l("villageoisPowers","Camp Villageois","var(--chart-color-1)",v=>{m({selectedPlayer:r,campFilter:{selectedCamp:"Villageois",campFilterMode:n==="winRate"?"wins-only":"all-assignments"},selectedPower:v,fromComponent:`Historique des RÃ´les - Pouvoir: ${v}`})},v=>v==="Chasseur"&&g.Chasseur?g.Chasseur:v==="Alchimiste"&&g.Alchimiste?g.Alchimiste:v==="Protecteur"&&g.Protecteur?g.Protecteur:v==="Disciple"&&g.Disciple?g.Disciple:v==="Inquisiteur"&&g.Inquisiteur?g.Inquisiteur:"var(--chart-color-1)"),i&&l("loupPowers","Camp Loups","var(--chart-color-2)",v=>{m({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:n==="winRate"?"wins-only":"all-assignments"},selectedPower:v,fromComponent:`Historique des RÃ´les - Pouvoir: ${v}`})},()=>g.Loup||"var(--chart-color-2)"),p&&l("secondaryRoles","RÃ´les Secondaires","var(--chart-color-3)",v=>{m({selectedPlayer:r,selectedSecondaryRole:v,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${v}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}const Te=["UseGadget","DrinkPotion"],ft={UseGadget:"Utilisation Gadget",DrinkPotion:"Potion bue"},vt={UseGadget:"var(--chart-color-1, #8884d8)",DrinkPotion:"var(--chart-color-3, #ffc658)"};function jt({selectedPlayerName:r}){const{gameData:m}=fe(),f=k.useMemo(()=>{if(!m||!r)return{actionTypeCounts:[],gadgetDetails:[],potionDetails:[],totalGamesWithActions:0,totalGamesPlayed:0};const g={UseGadget:0,DrinkPotion:0},n={},w={};let h=0,u=0;m.forEach(o=>{const t=o.PlayerStats.find(d=>d.Username.toLowerCase()===r.toLowerCase());if(!t)return;u++;let i=!1;(t.Actions||[]).forEach(d=>{const l=d.ActionType;Te.includes(l)&&(g[l]++,i=!0,l==="UseGadget"&&d.ActionName&&d.ActionName!=="Balle"&&(n[d.ActionName]=(n[d.ActionName]||0)+1),l==="DrinkPotion"&&d.ActionName&&(w[d.ActionName]=(w[d.ActionName]||0)+1))}),i&&h++});const x=Te.filter(o=>g[o]>0).map(o=>({actionType:o,label:ft[o],count:g[o],color:vt[o]})).sort((o,t)=>t.count-o.count),c=Object.entries(n).map(([o,t])=>({gadgetName:o,count:t})).sort((o,t)=>t.count-o.count).slice(0,ce.TOP_10),a=Object.entries(w).map(([o,t])=>({potionName:o,count:t})).sort((o,t)=>t.count-o.count).slice(0,ce.TOP_10);return{actionTypeCounts:x,gadgetDetails:c,potionDetails:a,totalGamesWithActions:h,totalGamesPlayed:u}},[m,r]);return f.actionTypeCounts.length>0?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",style:{width:"100%",flexBasis:"100%"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ® Parties avec actions"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:f.totalGamesWithActions}),e.jsxs("p",{children:["sur ",f.totalGamesPlayed," parties analysÃ©es"]})]}),f.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ”§ Gadgets utilisÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:f.gadgetDetails.reduce((g,n)=>g+n.count,0)}),e.jsxs("p",{children:[f.gadgetDetails.length," types diffÃ©rents"]})]}),f.potionDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ§ª Potions bues"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:f.potionDetails.reduce((g,n)=>g+n.count,0)}),e.jsxs("p",{children:[f.potionDetails.length," types diffÃ©rents"]})]})]}),f.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Gadgets UtilisÃ©s"}),e.jsx(_,{title:"Gadgets UtilisÃ©s",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:f.gadgetDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"gadgetName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12,tick:({x:g,y:n,payload:w})=>e.jsx("text",{x:g,y:n,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,fontStyle:"italic",transform:`rotate(-45 ${g} ${n})`,children:w.value})}),e.jsx(Q,{label:{value:"Utilisations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(U,{content:({active:g,payload:n})=>{if(g&&n&&n.length>0){const w=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:w.gadgetName})}),e.jsxs("div",{children:["UtilisÃ© ",w.count," fois"]})]})}return null}}),e.jsx(K,{dataKey:"count",fill:"var(--chart-color-1)",shape:g=>{const{x:n,y:w,width:h,height:u,index:x}=g,c=`hsl(${200+(x??0)*20}, 70%, 50%)`;return e.jsx(te,{x:n,y:w,width:h,height:u,fill:c})}})]})})})})]}),f.potionDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Potions Bues"}),e.jsx(_,{title:"Potions Bues",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:f.potionDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"potionName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12,tick:({x:g,y:n,payload:w})=>e.jsx("text",{x:g,y:n,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,fontStyle:"italic",transform:`rotate(-45 ${g} ${n})`,children:w.value})}),e.jsx(Q,{label:{value:"Consommations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(U,{content:({active:g,payload:n})=>{if(g&&n&&n.length>0){const w=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:w.potionName})}),e.jsxs("div",{children:["Bue ",w.count," fois"]})]})}return null}}),e.jsx(K,{dataKey:"count",fill:"var(--chart-color-3)",shape:g=>{const{x:n,y:w,width:h,height:u,index:x}=g,c=`hsl(${40+(x??0)*15}, 80%, 55%)`;return e.jsx(te,{x:n,y:w,width:h,height:u,fill:c})}})]})})})})]})]}):e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune donnÃ©e d'actions disponible pour ",r,"."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es d'actions (gadgets, potions) ne sont disponibles que pour les parties rÃ©centes."})]})}function bt({selectedPlayerName:r}){const{gameData:m}=fe(),{joueursData:f}=ue(),b=me(),g=ve(f),n=k.useMemo(()=>{if(!m||!r)return{hunterTargets:[],hunterMissedShots:0,hunterTotalShots:0,transformCount:0,untransformCount:0,transformationsPerGame:0,totalGamesWithActions:0,totalGamesPlayed:0,totalNightsAsWolf:0,transformsPerNight:0};const h={};let u=0,x=0,c=0,a=0,o=0,t=0;m.forEach(T=>{const A=T.PlayerStats.find(s=>s.Username.toLowerCase()===r.toLowerCase());if(!A)return;o++;let z=!1;const V=T.Modded&&We(T.Version||"0","0.243");let $=!1;if(V)$=!0;else{const R=(A.Actions||[]).some(y=>y.ActionType==="Transform"||y.ActionType==="Untransform"),L=A.LegacyActionsIncomplete===!0;$=R&&!L}if(Qe(A.MainRoleInitial)&&$){const s=Xe(A.DeathTiming,T.EndTiming);t+=s}(A.Actions||[]).forEach(s=>{s.ActionType==="HunterShoot"?(c++,z=!0,s.ActionTarget&&(h[s.ActionTarget]=(h[s.ActionTarget]||0)+1)):s.ActionType==="Transform"?(u++,z=!0):s.ActionType==="Untransform"&&(x++,z=!0)}),z&&a++});const i=Object.entries(h).map(([T,A])=>({target:T,count:A})).sort((T,A)=>A.count-T.count).slice(0,ce.TOP_10),p=Object.values(h).reduce((T,A)=>T+A,0),d=c-p,l=u>0?Math.max(1,m.filter(T=>{const A=T.PlayerStats.find(V=>V.Username.toLowerCase()===r.toLowerCase());return A?(A.Actions||[]).some(V=>V.ActionType==="Transform"):!1}).length):0,v=l>0?u/l:0,F=t>0?u/t:0;return{hunterTargets:i,hunterMissedShots:d,hunterTotalShots:c,transformCount:u,untransformCount:x,transformationsPerGame:v,totalGamesWithActions:a,totalGamesPlayed:o,totalNightsAsWolf:t,transformsPerNight:F}},[m,r]);return n.hunterTotalShots>0||n.transformCount>0||n.untransformCount>0?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[n.hunterTotalShots>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Statistiques du Chasseur"}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"âœ… Tirs rÃ©ussis"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:b.Chasseur||"var(--chart-color-2)"},children:n.hunterTotalShots-n.hunterMissedShots}),e.jsx("p",{children:"cibles touchÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"âŒ Tirs manquÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--text-secondary)"},children:n.hunterMissedShots}),e.jsx("p",{children:"tirs sans cible"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š PrÃ©cision"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:b.Chasseur||"var(--chart-color-2)"},children:[n.hunterTotalShots>0?((n.hunterTotalShots-n.hunterMissedShots)/n.hunterTotalShots*100).toFixed(1):"0","%"]}),e.jsx("p",{children:"taux de rÃ©ussite"})]})]}),n.hunterTargets.length>0&&e.jsx(_,{title:"Cibles Ã‰liminÃ©es par le Chasseur",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n.hunterTargets,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"target",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12,tick:({x:h,y:u,payload:x})=>e.jsx("text",{x:h,y:u,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,fontStyle:"italic",transform:`rotate(-45 ${h} ${u})`,children:x.value})}),e.jsx(Q,{label:{value:"Nombre de tirs",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(U,{content:({active:h,payload:u})=>{if(h&&u&&u.length>0){const x=u[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:x.target})}),e.jsxs("div",{children:["TuÃ© par le chasseur ",x.count," fois"]})]})}return null}}),e.jsx(K,{dataKey:"count",fill:b.Chasseur||"var(--chart-color-2)",shape:h=>{const{x:u,y:x,width:c,height:a,payload:o,index:t}=h,p=g[o.target]||b.Chasseur||`hsl(${120+(t??0)*15}, 60%, 45%)`;return e.jsx(te,{x:u,y:x,width:c,height:a,fill:p})}})]})})})})]}),(n.transformCount>0||n.untransformCount>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Habitudes de Transformation (Loup)"}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Ratio"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:(()=>{const h=n.transformCount,u=n.untransformCount;return h===0?"0%":`${(u/h*100).toFixed(0)}%`})()}),e.jsx("p",{children:"dÃ©transformations / transformations"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŒ™ Nuits totales"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:n.totalNightsAsWolf}),e.jsx("p",{children:"nuits vÃ©cues en loup (opportunitÃ©s)"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¯ Ratio / nuit"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:b.Loup||"var(--wolf-color)"},children:n.transformsPerNight.toFixed(2)}),e.jsx("p",{children:"transformations par nuit vÃ©cue"})]})]}),e.jsx(_,{title:"Statistiques de Transformation",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:[{name:"Statistiques Loup","Nuits vÃ©cues":n.totalNightsAsWolf,Transformations:n.transformCount,DÃ©transformations:n.untransformCount}],margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"name",fontSize:14}),e.jsx(Q,{label:{value:"Compte",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(U,{content:({active:h,payload:u})=>!h||!u||u.length===0?null:e.jsx("div",{className:"custom-tooltip",style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border-primary)",borderRadius:"4px",padding:"10px"},children:u.map((x,c)=>e.jsxs("div",{style:{color:x.color,marginBottom:"4px"},children:[e.jsxs("strong",{children:[x.name,":"]})," ",x.value]},c))})}),e.jsx(Fe,{}),e.jsx(K,{dataKey:"Nuits vÃ©cues",fill:"var(--chart-color-4, #a4de6c)"}),e.jsx(K,{dataKey:"Transformations",fill:b.Loup||"var(--wolf-color)"}),e.jsx(K,{dataKey:"DÃ©transformations",fill:"var(--accent-secondary)"})]})})})})]})]}):e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune donnÃ©e d'actions de rÃ´le disponible pour ",r,"."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es d'actions de rÃ´le (Chasseur, Loup) ne sont disponibles que pour les parties rÃ©centes."})]})}function Ct({viewMode:r,setViewMode:m,selectedMap:f,setSelectedMap:b,availableMaps:g,clusterRadius:n,setClusterRadius:w,availableDeathTypes:h,selectedDeathTypes:u,setSelectedDeathTypes:x,deathTypeColors:c,isDeathTypesExpanded:a,setIsDeathTypesExpanded:o}){return e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>m("deaths"),style:{background:r==="deaths"?"var(--accent-primary)":"transparent",color:r==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"ðŸ’€ Morts"}),e.jsx("button",{type:"button",onClick:()=>m("kills"),style:{background:r==="kills"?"var(--accent-primary)":"transparent",color:r==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="kills"?"bold":"normal",transition:"all 0.2s"},children:"âš”ï¸ Kills"}),e.jsx("button",{type:"button",onClick:()=>m("transformations"),style:{background:r==="transformations"?"var(--accent-primary)":"transparent",color:r==="transformations"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="transformations"?"bold":"normal",transition:"all 0.2s"},children:"ðŸº Transfos"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:f,onChange:t=>b(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:g.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:n,onChange:t=>w(parseInt(t.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:n===0?"Aucun":`${n} unitÃ©${n>1?"s":""}`})]}),r!=="transformations"&&e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>o(!a),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:a?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:a?"rotate(90deg)":"rotate(0deg)"},children:"â–¶"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[u.length," / ",h.length," sÃ©lectionnÃ©",u.length>1?"s":""]})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),x(h)},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:t=>{t.stopPropagation(),x([])},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:h.map(t=>{const i=u.includes(t),p=c[t]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",background:i?"var(--bg-tertiary)":"transparent",borderRadius:"4px",border:`1px solid ${i?p:"var(--border-color)"}`,cursor:"pointer",transition:"all 0.2s",fontSize:"0.9rem"},onClick:d=>{d.stopPropagation(),x(i?l=>l.filter(v=>v!==t):l=>[...l,t])},children:[e.jsx("input",{type:"checkbox",checked:i,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:p,flexShrink:0}}),e.jsx("span",{children:ge(t)})]},t)})})]})]})]})}function St({zoneAnalysis:r,selectedMap:m,viewMode:f,selectedPlayerName:b,hoveredZone:g,setHoveredZone:n}){return!r||m!=="Village"||f!=="deaths"?null:e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"0rem",padding:"1.5rem",background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",borderRadius:"12px",border:"2px solid var(--accent-primary)",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",color:"var(--accent-primary)",fontSize:"1.3rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"ðŸ“Š Analyse par zone (Village)"}),e.jsx("p",{style:{fontSize:"0.95rem",marginBottom:"1rem",color:"var(--text-secondary)",lineHeight:"1.5"},children:"Distribution des morts (selon les types sÃ©lectionnÃ©s) comparÃ©e Ã  la moyenne de tous les joueurs:"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:r.zoneStats.map(w=>{const h=w.zone===r.dominantZone&&r.maxDeviation>10;return e.jsxs("div",{onMouseEnter:()=>n(w.zone),onMouseLeave:()=>n(null),style:{padding:"1rem",background:"var(--bg-primary)",borderRadius:"8px",border:g===w.zone?"1px solid var(--accent-primary)":"1px solid var(--border-color)",color:"var(--text-primary)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.95rem"},children:w.zone}),e.jsxs("div",{style:{fontSize:"0.85rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[b,": ",e.jsxs("strong",{children:[w.playerPercent.toFixed(1),"%"]})," (",w.playerCount,")"]}),e.jsxs("div",{style:{opacity:.85},children:["Moyenne: ",w.avgPercent.toFixed(1),"%"]}),e.jsxs("div",{style:{marginTop:"0.25rem",color:h?"var(--accent-secondary)":w.deviation>0?"var(--accent-primary)":"var(--text-secondary)",fontWeight:Math.abs(w.deviation)>5?"bold":"normal"},children:[w.deviation>0?"+":"",w.deviation.toFixed(1),"% vs moyenne"]})]})]},w.zone)})}),r.dominantZone&&r.maxDeviation>10&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",fontSize:"0.95rem",color:"var(--accent-primary)",fontWeight:"bold",background:"var(--bg-primary)",borderRadius:"8px",border:"2px solid var(--accent-primary)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"âš ï¸"}),e.jsxs("span",{children:[b," meurt significativement plus souvent en zone ",r.dominantZone,"(","+"+r.maxDeviation.toFixed(1),"% par rapport Ã  la moyenne)"]})]})]})}function wt({locationData:r,clusteredData:m,viewMode:f,selectedPlayerName:b,selectedMap:g,mapConfig:n,xDomain:w,zDomain:h,hoveredZone:u,getDeathColor:x,handleLocationClick:c}){const a=({active:o,payload:t})=>{if(!o||!t||t.length===0)return null;const i=t[0].payload,p=i.allLocations||[i],d=p.length>1,l=f==="transformations";if(d){const F=new Map,T=new Map,A=new Set,z=new Map;p.forEach(s=>{if(F.set(s.victimName,(F.get(s.victimName)||0)+1),l)z.set(s.camp,(z.get(s.camp)||0)+1);else{const R=s.deathType?ge(s.deathType):"Inconnu";T.set(R,(T.get(R)||0)+1)}A.add(s.gameId)});const V=Array.from(F.entries()).sort((s,R)=>R[1]-s[1]).slice(0,3),$=Array.from(T.entries()).sort((s,R)=>R[1]-s[1]).slice(0,3),G=Array.from(z.entries()).sort((s,R)=>R[1]-s[1]);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[l?"ðŸº":f==="deaths"?"ðŸ’€":"âš”ï¸"," ",p.length," ",l?"transformations":f==="deaths"?"morts":"kills"," Ã  cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[l?e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Camps loup:"}),G.map(([s,R])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",s," (",R,"Ã—)"]},s))]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:f==="deaths"?"Victimes:":"Kills sur:"}),V.map(([s,R])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",s," (",R,"Ã—)"]},s))]}),e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Types de mort:"}),$.map(([s,R])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",s," (",R,"Ã—)"]},s))]})]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["ðŸ“ ",A.size," partie",A.size>1?"s":""," diffÃ©rente",A.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const v=p[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[l?"ðŸº":f==="deaths"?"ðŸ’€":"âš”ï¸"," ",l?"Transformation de":f==="deaths"?"Mort de":"Kill de"," ",b]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[l?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ‘¤ ",e.jsx("strong",{children:"Joueur:"})," ",v.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp loup:"})," ",v.camp]}),e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",v.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",v.gameId]})]}):f==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Victime:"})," ",v.victimName]}),e.jsxs("div",{children:["âš”ï¸ ",e.jsx("strong",{children:"Tueur:"})," ",v.killerName||"Inconnu"]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",v.deathType?ge(v.deathType):"Inconnu"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Victime:"})," ",v.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp victime:"})," ",v.camp]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",v.deathType?ge(v.deathType):"Inconnu"]})]}),!l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",v.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",v.gameId]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})};return e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:r.length>0?e.jsx(_,{title:f==="deaths"?`Carte des Morts de ${b}`:`Carte des Kills de ${b}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(Ze,{margin:{top:20,right:30,left:60,bottom:20},children:[n&&e.jsx(le,{x1:n.zMin,x2:n.zMax,y1:n.xMin,y2:n.xMax,fill:"transparent",stroke:"none",shape:o=>{const{x:t,y:i,width:p,height:d}=o;return e.jsx("image",{x:t,y:i,width:p,height:d,href:n.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),g==="Village"&&u&&e.jsxs(e.Fragment,{children:[u==="Ruines"&&e.jsx(le,{x1:-220,x2:200,y1:100,y2:450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),u==="Village Principal"&&e.jsx(le,{x1:-250,x2:100,y1:-120,y2:-450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),u==="Ferme"&&e.jsx(le,{x1:-550,x2:-250,y1:150,y2:-150,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),u==="Village PÃªcheur"&&e.jsx(le,{x1:150,x2:500,y1:80,y2:-320,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),u==="Reste de la Carte"&&e.jsx(le,{x1:n?.zMin??-600,x2:n?.zMax??600,y1:n?.xMin??-500,y2:n?.xMax??500,fill:"var(--accent-primary)",fillOpacity:.15,stroke:"var(--accent-primary)",strokeWidth:2,strokeDasharray:"5 5"})]}),e.jsx(Y,{strokeDasharray:"3 3",stroke:n?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(J,{dataKey:"z",type:"number",name:"Position Z",domain:h,hide:!0}),e.jsx(Q,{dataKey:"x",type:"number",name:"Position X",domain:w,hide:!0}),e.jsx(U,{content:e.jsx(a,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(et,{data:m,style:{cursor:"pointer"},isAnimationActive:!1,shape:o=>{const{cx:t,cy:i,payload:p}=o,d=p,l=Math.min(Math.log2(d.count+1)*3+5,18),v=Math.round(l);return e.jsx("circle",{cx:t,cy:i,r:v,fill:x(d.deathType,d.camp),stroke:d.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:d.count>1?2:1,opacity:.85,onClick:()=>c(d)})}})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:f==="deaths"?`Aucune mort localisÃ©e pour ${b} sur cette carte.`:f==="kills"?`Aucun kill localisÃ© pour ${b} sur cette carte.`:`Aucune transformation en loup localisÃ©e pour ${b} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes."})]})})}function De(r,m){return m>=-250&&m<=100&&r>=-450&&r<=-120?"Village Principal":m>=-550&&m<=-250&&r>=-150&&r<=150?"Ferme":m>=150&&m<=500&&r>=-320&&r<=80?"Village PÃªcheur":m>=-220&&m<=200&&r>=100&&r<=450?"Ruines":"Reste de la Carte"}function he(r){return r==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":r}function Nt({selectedPlayerName:r}){const{navigateToGameDetails:m}=de(),{gameData:f,isLoading:b,error:g}=fe(),n=me(),[w,h]=k.useState("deaths"),[u,x]=k.useState(""),[c,a]=k.useState(0),[o,t]=k.useState(null),[i,p]=k.useState([]),[d,l]=k.useState(!1),{data:v}=je(r,"Tous les camps"),F=k.useMemo(()=>{if(!f)return[];const P=new Set;return f.forEach(S=>{const D=S.PlayerStats.find(M=>M.Username.toLowerCase()===r.toLowerCase());D&&(D.DeathPosition!==null&&S.MapName&&P.add(S.MapName),S.PlayerStats.forEach(M=>{M.KillerName?.toLowerCase()===r.toLowerCase()&&M.DeathPosition!==null&&S.MapName&&P.add(S.MapName)}),D.Actions&&Array.isArray(D.Actions)&&D.Actions.some(M=>M.ActionType==="Transform")&&S.MapName&&P.add(S.MapName))}),Array.from(P).filter(S=>S==="Village"||S==="ChÃ¢teau").sort((S,D)=>S==="Village"?-1:D==="Village"?1:S.localeCompare(D))},[f,r]),T=F.length>0?F[0]:"";u===""&&T!==""&&x(T);const{availableDeathTypes:A,deathTypeColors:z}=k.useMemo(()=>{if(!f||!r)return{availableDeathTypes:[],deathTypeColors:{}};const P=new Set,S={};return f.forEach(D=>{const M=D.PlayerStats.find(I=>I.Username.toLowerCase()===r.toLowerCase());if(M){if(M.DeathPosition&&M.DeathType){const I=he(M.DeathType);I&&P.add(I)}D.PlayerStats.forEach(I=>{if(I.KillerName?.toLowerCase()===r.toLowerCase()&&I.DeathPosition&&I.DeathType){const E=he(I.DeathType);E&&P.add(E)}})}}),P.forEach(D=>{S[D]=tt(D,n)}),{availableDeathTypes:Array.from(P).sort(),deathTypeColors:S}},[f,r,n]),V=(P,S)=>w==="transformations"&&S?n[S]||"var(--text-secondary)":P&&z[P]||"var(--text-secondary)";k.useEffect(()=>{if(i.length===0&&A.length>0){const P=A.filter(S=>S!=="VOTED");p(P)}},[A.length]);const $=k.useMemo(()=>{if(!f||!r)return[];const P=[];return f.forEach(S=>{if(u&&S.MapName!==u)return;const D=S.PlayerStats.find(M=>M.Username.toLowerCase()===r.toLowerCase());if(D)if(w==="deaths"){if(D.DeathPosition){const M=pe(D.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),I=ye(D.DeathPosition.x,D.DeathPosition.z,S.MapName);P.push({x:I.x,z:I.z,victimName:D.Username,killerName:D.KillerName||null,deathType:he(D.DeathType),mapName:S.MapName,camp:M,gameId:S.DisplayedId,displayedGameId:S.DisplayedId})}}else w==="kills"?S.PlayerStats.forEach(M=>{if(M.KillerName?.toLowerCase()===r.toLowerCase()&&M.DeathPosition){const I=pe(M.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),E=ye(M.DeathPosition.x,M.DeathPosition.z,S.MapName);P.push({x:E.x,z:E.z,victimName:M.Username,killerName:r,deathType:he(M.DeathType),mapName:S.MapName,camp:I,gameId:S.DisplayedId,displayedGameId:S.DisplayedId})}}):w==="transformations"&&D.Actions&&Array.isArray(D.Actions)&&D.Actions.forEach(M=>{if(M.ActionType==="Transform"&&M.Position){const I=pe(D.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),E=ye(M.Position.x,M.Position.z,S.MapName);P.push({x:E.x,z:E.z,victimName:D.Username,killerName:null,deathType:null,mapName:S.MapName,camp:I,gameId:S.DisplayedId,displayedGameId:S.DisplayedId})}})}),w!=="transformations"&&i.length>0&&i.length<A.length?P.filter(S=>S.deathType&&i.includes(S.deathType)):P},[f,r,w,u,i,A]),G=k.useMemo(()=>{if(u!=="Village"||w!=="deaths"||$.length===0)return null;const P={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};if($.forEach(q=>{const B=De(q.x,q.z);P[B]=(P[B]||0)+1}),!f)return null;const S={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};f.forEach(q=>{q.MapName==="Village"&&q.PlayerStats.forEach(B=>{if(!B.DeathPosition)return;const N=he(B.DeathType);if(i.length>0&&i.length<A.length&&(!N||!i.includes(N)))return;const W=ye(B.DeathPosition.x,B.DeathPosition.z,"Village"),Z=De(W.x,W.z);S[Z]=(S[Z]||0)+1})});const D=Object.values(S).reduce((q,B)=>q+B,0),M=Object.values(P).reduce((q,B)=>q+B,0);if(D===0||M===0)return null;const I=["Village Principal","Village PÃªcheur","Ferme","Ruines","Reste de la Carte"];let E=0,X=null;const se=I.map(q=>{const B=P[q]/M*100,N=S[q]/D*100,W=B-N;return W>E&&P[q]>=2&&(E=W,X=q),{zone:q,playerCount:P[q],playerPercent:B,avgPercent:N,deviation:W}});return{totalPlayerDeaths:M,totalAllDeaths:D,zoneStats:se,dominantZone:X,maxDeviation:E}},[$,u,w,f,i,A]),s=k.useMemo(()=>st($,c).map((S,D)=>{const M=S.items[0],I=rt(S.items);return{x:S.centroidX,z:S.centroidZ,count:S.items.length,allLocations:S.items,victimName:S.items.length===1?M.victimName:null,killerName:S.items.length===1?M.killerName:null,deathType:I,mapName:M.mapName,camp:M.camp,gameId:S.items.length===1?M.gameId:null,displayedGameId:S.items.length===1?M.displayedGameId:null,clusterIndex:D}}),[$,c]),R=k.useMemo(()=>at(u),[u]),{xDomain:L,zDomain:y}=k.useMemo(()=>{if(R)return{xDomain:[R.xMin,R.xMax],zDomain:[R.zMin,R.zMax]};if(s.length===0)return{xDomain:[0,100],zDomain:[0,100]};const P=s.map(q=>q.x),S=s.map(q=>q.z),D=Math.min(...P),M=Math.max(...P),I=Math.min(...S),E=Math.max(...S),X=(M-D)*.1||10,se=(E-I)*.1||10;return{xDomain:[D-X,M+X],zDomain:[I-se,E+se]}},[s,R]),C=P=>{if(!P)return;const S=P.allLocations||[P];if(S.length===1)m({selectedGame:S[0].gameId,fromComponent:"Player Death Map"});else{const D=S.map(M=>M.gameId).filter(M=>M);m({selectedGameIds:D,fromComponent:"Player Death Map"})}},j=k.useMemo(()=>{if(!v?.mapStats||!u)return null;const P=v.mapStats[u];return P?{winRate:P.winRate,wins:P.wins,total:P.appearances}:null},[v,u]);return b?e.jsx("div",{className:"donnees-attente",children:"Chargement des donnÃ©es..."}):g?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]}):f?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsx(Ct,{viewMode:w,setViewMode:h,selectedMap:u,setSelectedMap:x,availableMaps:F,clusterRadius:c,setClusterRadius:a,availableDeathTypes:A,selectedDeathTypes:i,setSelectedDeathTypes:p,deathTypeColors:z,isDeathTypesExpanded:d,setIsDeathTypesExpanded:l}),e.jsx(wt,{locationData:$,clusteredData:s,viewMode:w,selectedPlayerName:r,selectedMap:u,mapConfig:R,xDomain:L,zDomain:y,hoveredZone:o,getDeathColor:V,handleLocationClick:C}),e.jsx(St,{zoneAnalysis:G,selectedMap:u,viewMode:w,selectedPlayerName:r,hoveredZone:o,setHoveredZone:t}),j&&e.jsxs("div",{style:{flex:"1 1 100%",textAlign:"center",padding:"0.75rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)",marginTop:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginRight:"1rem"},children:["Taux de victoire sur ",e.jsx("strong",{children:u})," :"]}),e.jsxs("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:parseFloat(j.winRate)>=50?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[j.winRate,"%"]}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["(",j.wins," / ",j.total," victoires)"]})]}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"Ã€ propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",w==="deaths"?`les emplacements oÃ¹ ${r} est mort`:w==="kills"?`les emplacements oÃ¹ ${r} a Ã©liminÃ© d'autres joueurs`:`les emplacements oÃ¹ ${r} s'est transformÃ© en loup`," au cours des parties.",w!=="transformations"&&"Les couleurs indiquent le type de mort."," Cliquez sur un point pour voir les dÃ©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroupÃ©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’€ Morts:"})," OÃ¹ le joueur a Ã©tÃ© Ã©liminÃ©",e.jsx("br",{}),e.jsx("strong",{children:"âš”ï¸ Kills:"})," OÃ¹ le joueur a Ã©liminÃ© d'autres joueurs",e.jsx("br",{}),e.jsx("strong",{children:"ðŸº Transformations:"})," OÃ¹ le joueur s'est transformÃ© en loup"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function $e(r){return r.PlayerStats.some(m=>m.SecondsTalkedOutsideMeeting>0||m.SecondsTalkedDuringMeeting>0)}function be(r,m){const f=m.DeathDateIrl||r.EndDate,b=Re(r.StartDate,f);return b&&b>0?b:0}function Pt(r){const m=r.filter($e),f=new Map;return m.forEach(b=>{b.PlayerStats.forEach(g=>{const n=ie(g),w=qe(g),h=be(b,g);if(h<=0)return;f.has(n)||f.set(n,{displayName:w,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const u=f.get(n);u.gamesPlayed++,u.totalSecondsAll+=(g.SecondsTalkedOutsideMeeting||0)+(g.SecondsTalkedDuringMeeting||0),u.totalGameDuration+=h})}),{playerStats:f,gamesWithTalkingData:m.length}}function Tt(r,m){if(!m||m.length===0||!r)return null;const f=Pt(m),b=m.filter($e);if(b.length===0||f.playerStats.size===0)return null;let g=null;for(const[C,j]of f.playerStats)if(j.displayName===r){g=C;break}if(!g)return null;let n=0,w=0,h=0,u=0;const x={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},c=new Map;let a=0,o=0,t=0,i=0;if(b.forEach(C=>{const j=C.PlayerStats.find(se=>ie(se)===g);if(!j)return;const P=be(C,j);if(P<=0)return;n++;const S=j.SecondsTalkedOutsideMeeting||0,D=j.SecondsTalkedDuringMeeting||0,M=S+D;w+=S,h+=D,u+=P;const I=Oe(j.MainRoleInitial,j.Power);x[I].gamesPlayed++,x[I].secondsOutside+=S,x[I].secondsDuring+=D,x[I].gameDuration+=P;const E=Je(j);c.has(E)||c.set(E,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const X=c.get(E);X.gamesPlayed++,X.totalSecondsAll+=M,X.totalGameDuration+=P}),n===0||u<=0)return null;const p=3600/u,d=w*p,l=h*p,v=(w+h)*p,F=w+h>0?h/(w+h)*100:0,T=[];for(const[C,j]of Object.entries(x)){if(j.gamesPlayed===0)continue;const P=j.gameDuration>0?3600/j.gameDuration:0,S=j.secondsOutside+j.secondsDuring;T.push({camp:C,gamesPlayed:j.gamesPlayed,totalSecondsOutside:j.secondsOutside,totalSecondsDuring:j.secondsDuring,totalSecondsAll:S,totalGameDurationSeconds:j.gameDuration,secondsOutsidePer60Min:j.secondsOutside*P,secondsDuringPer60Min:j.secondsDuring*P,secondsAllPer60Min:S*P,meetingRatio:S>0?j.secondsDuring/S*100:0})}T.sort((C,j)=>j.gamesPlayed-C.gamesPlayed);const A=Array.from(c.entries()).filter(([C,j])=>j.gamesPlayed>=1).map(([C,j])=>({role:C,gamesPlayed:j.gamesPlayed,secondsAllPer60Min:j.totalGameDuration>0?j.totalSecondsAll/j.totalGameDuration*3600:0,totalSecondsAll:j.totalSecondsAll})).sort((C,j)=>j.secondsAllPer60Min-C.secondsAllPer60Min),z=[];for(const[C,j]of f.playerStats)j.totalGameDuration>0&&z.push({id:C,name:j.displayName,per60:j.totalSecondsAll/j.totalGameDuration*3600});z.sort((C,j)=>j.per60-C.per60);const V=z.reduce((C,j)=>C+j.per60,0),$=z.length>0?V/z.length:0,G=z.findIndex(C=>C.id===g)+1,s=z.length,R=s>0?Math.round((1-(G-1)/s)*100):0,L=v;b.forEach(C=>{const j=C.PlayerStats.find(M=>ie(M)===g);if(!j)return;const P=be(C,j);if(P<=0)return;((j.SecondsTalkedOutsideMeeting||0)+(j.SecondsTalkedDuringMeeting||0))/P*3600>=L?(a++,j.Victorious&&o++):(t++,j.Victorious&&i++)});const y={gamesAboveAverage:a,winsAboveAverage:o,winRateAboveAverage:a>0?o/a*100:0,gamesBelowAverage:t,winsBelowAverage:i,winRateBelowAverage:t>0?i/t*100:0};return{playerName:r,gamesPlayed:n,gamesWithTalkingData:f.gamesWithTalkingData,totalSecondsOutside:w,totalSecondsDuring:h,totalSecondsAll:w+h,totalGameDurationSeconds:u,secondsOutsidePer60Min:d,secondsDuringPer60Min:l,secondsAllPer60Min:v,meetingRatio:F,campBreakdown:T,globalAverageSecondsAllPer60Min:$,playerRank:G,totalPlayersWithData:s,percentile:R,roleBreakdown:A,winCorrelation:y}}function Dt(r,m){return r?r.roleBreakdown.slice(0,m):[]}function kt(r){const{data:m,isLoading:f,error:b}=Ce(g=>r?Tt(r,g):null);return{data:m,isLoading:f,error:b}}function At({selectedPlayerName:r}){const{data:m,isLoading:f,error:b}=kt(r),g=me(),[n,w]=k.useState("both"),h=k.useMemo(()=>m?.campBreakdown?m.campBreakdown.map(t=>({camp:t.camp,"Hors rÃ©union":Math.round(t.secondsOutsidePer60Min),"En rÃ©union":Math.round(t.secondsDuringPer60Min),total:Math.round(t.secondsAllPer60Min),gamesPlayed:t.gamesPlayed,meetingRatio:t.meetingRatio.toFixed(1)})):[],[m]),u=k.useMemo(()=>m?[{name:"En rÃ©union",value:m.totalSecondsDuring,fill:"#2196F3"},{name:"Hors rÃ©union",value:m.totalSecondsOutside,fill:"#FF9800"}]:[],[m]);if(f)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(b)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",b]});if(!m)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de temps de parole ne sont disponibles que pour les parties rÃ©centes."})]});const x=m.secondsAllPer60Min-m.globalAverageSecondsAllPer60Min,c=m.globalAverageSecondsAllPer60Min>0?(x/m.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",a=x>0,o=m.winCorrelation.winRateAboveAverage-m.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¤ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:oe(m.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:a?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[a?"+":"",c,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",m.playerRank," / ",m.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-m.percentile+1,"% ",m.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“ˆ Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:m.gamesPlayed}),e.jsxs("p",{children:["sur ",m.gamesWithTalkingData," avec donnÃ©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ—£ï¸ Ratio en rÃ©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[m.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),h.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(_,{title:"Temps de parole par camp (par 60min de jeu)",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>w("meeting"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:n==="meeting"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:n==="meeting"?"var(--accent-primary)":"var(--bg-secondary)",color:n==="meeting"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:n==="meeting"?"bold":"normal"},children:"En rÃ©union"}),e.jsx("button",{onClick:()=>w("outside"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:n==="outside"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:n==="outside"?"var(--accent-primary)":"var(--bg-secondary)",color:n==="outside"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:n==="outside"?"bold":"normal"},children:"Hors rÃ©union"}),e.jsx("button",{onClick:()=>w("both"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:n==="both"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:n==="both"?"var(--accent-primary)":"var(--bg-secondary)",color:n==="both"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:n==="both"?"bold":"normal"},children:"Les deux"})]}),e.jsx("div",{style:{height:350},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:h,layout:"vertical",children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(J,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:t=>`${Math.floor(t/60)}m`}),e.jsx(Q,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(U,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(t,i)=>{const p=typeof t=="number"?t:Number(t);return[Number.isNaN(p)?`${t}`:oe(p),i]},labelFormatter:t=>{const i=h.find(p=>p.camp===t);return`${t} (${i?.gamesPlayed||0} parties)`}}),e.jsx(Fe,{}),(n==="both"||n==="outside")&&e.jsx(K,{dataKey:"Hors rÃ©union",stackId:"talk",fill:"#FF9800"}),(n==="both"||n==="meeting")&&e.jsx(K,{dataKey:"En rÃ©union",stackId:"talk",fill:"#2196F3"})]})})})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:(()=>{const t=h.find(l=>l.camp==="Villageois"),i=h.find(l=>l.camp==="Loup");if(!t||!i)return e.jsx("p",{children:"ðŸ’¡ Pas assez de donnÃ©es pour comparer les camps Villageois et Loups."});const p=t.total-i.total,d=i.total>0?(Math.abs(p)/i.total*100).toFixed(0):"0";return p>0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:Se("Villageois")},children:[oe(p)," de plus (+",d,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Villageois"})," qu'en tant que"," ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]}):p<0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:Se("Loup")},children:[oe(Math.abs(p))," de plus (+",d,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Loup"})," qu'en tant que"," ",e.jsx("strong",{children:"Villageois"})," (par heure de jeu)."]}):e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle exactement autant en tant que"," ",e.jsx("strong",{children:"Villageois"})," qu'en tant que ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(_,{title:"RÃ©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(Me,{children:[e.jsx(ze,{data:u,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:t=>`${t.name}: ${((t.percent||0)*100).toFixed(1)}%`}),e.jsx(U,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:t=>{const i=typeof t=="number"?t:Number(t);return Number.isNaN(i)?`${t}`:oe(i)}})]})})})})}),m&&m.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(_,{title:t=>t?"Top 15 rÃ´les les plus bavards (par 60min)":"Top 5 rÃ´les les plus bavards (par 60min)",children:t=>{const p=Dt(m,t?15:5).map(d=>({role:d.role,secondsPer60Min:Math.round(d.secondsAllPer60Min),gamesPlayed:d.gamesPlayed}));return e.jsx("div",{style:{height:t?400:300},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:p,children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(J,{dataKey:"role",tick:({x:d,y:l,payload:v})=>e.jsx("text",{x:d,y:l,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,fontStyle:"italic",transform:`rotate(-20 ${d} ${l})`,children:v.value}),interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(Q,{tick:{fill:"var(--text-secondary)"},tickFormatter:d=>`${Math.floor(d/60)}m`}),e.jsx(U,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:d=>{const l=typeof d=="number"?d:Number(d);return[Number.isNaN(l)?`${d}`:oe(l),"Temps de parole"]},labelFormatter:d=>{const l=p.find(v=>v.role===d);return`${d} (${l?.gamesPlayed||0} parties)`}}),e.jsx(K,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",shape:d=>{const{x:l,y:v,width:F,height:T,payload:A}=d,V=g[A.role]||g.Villageois;return e.jsx(te,{x:l,y:v,width:F,height:T,fill:V})}})]})})})}})}),(m.winCorrelation.gamesAboveAverage>0||m.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"ðŸŽ¯ CorrÃ©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[m.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",m.winCorrelation.winsAboveAverage,"/",m.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[m.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",m.winCorrelation.winsBelowAverage,"/",m.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(o)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:o>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[o>0?"supÃ©rieur":"infÃ©rieur"," de ",Math.abs(o).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function ke(r){return{killRate:"Kills",killRateVillageois:"Kills (Villageois)",killRateLoup:"Kills (Loup)",killRateSolo:"Kills (Solo)",survival:"Survie",survivalVillageois:"Survie (Villageois)",survivalLoup:"Survie (Loup)",survivalSolo:"Survie (Solo)",survivalDay1:"Survie J1",survivalDay1Villageois:"Survie J1 (Villageois)",survivalDay1Loup:"Survie J1 (Loup)",survivalDay1Solo:"Survie J1 (Solo)",survivalAtMeetingVillageois:"Survie au meeting (Villageois)",survivalAtMeetingLoup:"Survie au meeting (Loup)",survivalAtMeetingSolo:"Survie au meeting (Solo)",talking:"Parole",talkingOutsideMeeting:"Parole (hors dÃ©bats)",talkingDuringMeeting:"Parole (meeting)",talkingVillageois:"Parole (Villageois)",talkingOutsideVillageois:"Parole hors meeting (Villageois)",talkingDuringVillageois:"Parole en meeting (Villageois)",talkingLoup:"Parole (Loup)",talkingOutsideLoup:"Parole hors meeting (Loup)",talkingDuringLoup:"Parole en meeting (Loup)",talkingSolo:"Parole (Solo)",talkingOutsideSolo:"Parole hors meeting (Solo)",talkingDuringSolo:"Parole en meeting (Solo)",loot:"RÃ©colte",lootVillageois:"RÃ©colte (Villageois)",lootLoup:"RÃ©colte (Loup)",lootObjectiveWinRateVillageois:"Objectif rÃ©colte (Villageois)",votingAggressive:"Vote agressif",votingAggressiveVillageois:"Vote agressif (Villageois)",votingAggressiveLoup:"Vote agressif (Loup)",votingAggressiveSolo:"Vote agressif (Solo)",votingFirst:"Vote rapide",votingFirstVillageois:"Premier voteur (Villageois)",votingFirstLoup:"Premier voteur (Loup)",votingFirstSolo:"Premier voteur (Solo)",votingAccuracy:"PrÃ©cision vote",votingAccuracyVillageois:"PrÃ©cision vote (Villageois)",votingAccuracyLoup:"PrÃ©cision vote (Loup)",votingAccuracySolo:"PrÃ©cision vote (Solo)",winRate:"Victoires",winRateVillageois:"Victoires (Villageois)",winRateLoup:"Victoires (Loup)",winRateSolo:"Victoires (Solo)",winSeries:"SÃ©rie de victoires",lossSeries:"SÃ©rie de dÃ©faites",hunterAccuracy:"PrÃ©cision cible chasseur",hunterShotAccuracy:"PrÃ©cision tir chasseur",zoneVillagePrincipal:"Village Principal",zoneFerme:"Ferme",zoneVillagePecheur:"Village PÃªcheur",zoneRuines:"Ruines",zoneResteCarte:"Reste de la carte",zoneDominantPercentage:"Dominance zone",campSolo:"Camp Solo",campBalance:"Ã‰quilibre des camps",gamesPlayed:"Parties jouÃ©es",wolfTransformRate:"Taux transformation loup",wolfUntransformRate:"Taux retour aprÃ¨s transformation",potionUsage:"Utilisation potions"}[r]||r}function Rt({playerTitles:r,titlesLoading:m}){const[f,b]=k.useState({owned:!0,reconquer:!1,nearMiss:!1}),[g,n]=k.useState(null),[w,h]=k.useState(null),u=l=>{h(v=>v===l?null:l)},x=l=>{g===l?n(null):(n(l),b(v=>({...v,[l]:!0})))};if(m)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des titres..."})]})});if(!r||r.titles.length===0)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-empty",children:[e.jsx("p",{children:"ðŸ“œ Aucun titre disponible"}),e.jsx("p",{className:"empty-subtitle",children:r?.gamesPlayed?`${r.gamesPlayed} parties jouÃ©es - minimum 25 parties requises pour obtenir des titres`:"Les titres sont gÃ©nÃ©rÃ©s chaque dimanche pour les joueurs avec 25+ parties en mode moddÃ©"})]})});const c=[...r.titles].sort((l,v)=>{const F=r.titles.indexOf(l),A=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(l.category||"")?100-(l.percentile||50):l.percentile||50,z=(l.priority||0)*1e3+A*10-F,V=r.titles.indexOf(v),G=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(v.category||"")?100-(v.percentile||50):v.percentile||50;return(v.priority||0)*1e3+G*10-V-z}),a=c.filter(l=>!l.primaryOwner),o=c.filter(l=>l.primaryOwner),t=r.nearMissTitles||[],i=(l,v)=>{const F=r.primaryTitle?.id===l.id,T=l.type==="combination"&&l.conditions&&l.conditions.length>0,A=w===l.id;return e.jsxs("div",{className:`title-card ${l.type} ${F?"primary":""} ${l.primaryOwner?"awarded-elsewhere":""}`,children:[e.jsx("div",{className:"title-rank",children:v+1}),F&&e.jsx("div",{className:"title-crown",children:"ðŸ‘‘"}),e.jsx("div",{className:"title-emoji",children:l.emoji}),e.jsxs("div",{className:"title-info",children:[e.jsx("div",{className:"title-name",children:l.title}),e.jsx("div",{className:"title-description",children:l.description}),l.percentile!==void 0&&l.type!=="combination"&&e.jsxs("div",{className:"title-percentile",children:["Top ",(100-l.percentile).toFixed(0),"%"]}),e.jsx("div",{className:"title-type-badge",children:l.type==="combination"?"Combo":l.type==="role"?"RÃ´le":"Stat"}),!F&&l.primaryOwner&&e.jsxs("div",{className:"title-primary-owner",children:["âš”ï¸ DÃ©tenu par ",e.jsx("strong",{children:l.primaryOwner})]}),T&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{type:"button",className:`title-conditions-toggle ${A?"expanded":""}`,onClick:z=>{z.stopPropagation(),u(l.id)},children:[e.jsx("span",{className:"toggle-arrow",children:"â–¶"}),"ðŸ“Š Conditions (",l.conditions.length,")"]}),A&&e.jsx("div",{className:"title-conditions-breakdown",children:l.conditions.map((z,V)=>e.jsxs("div",{className:"condition-item",children:[e.jsxs("span",{className:"condition-stat",children:[ke(z.stat),":"]}),e.jsx("span",{className:`condition-category ${z.category?.toLowerCase()}`,children:z.category}),z.actualPercentile!==void 0&&e.jsxs("span",{className:"condition-percentile",children:["(Top ",(100-z.actualPercentile).toFixed(0),"%)"]})]},V))})]})]})]},l.id)},p=(l,v)=>{const F=l.conditionsMet/l.conditionsTotal;return e.jsxs("div",{className:"title-card near-miss",children:[e.jsx("div",{className:"title-rank",children:v+1}),e.jsx("div",{className:"title-emoji",children:l.emoji}),e.jsxs("div",{className:"title-info",children:[e.jsx("div",{className:"title-name",children:l.title}),e.jsx("div",{className:"title-description",children:l.description}),e.jsxs("div",{className:"near-miss-progress-container",children:[e.jsx("div",{className:"near-miss-progress-bar",children:e.jsx("div",{className:"near-miss-progress-fill",style:{width:`${Math.max(F*100,5)}%`}})}),e.jsxs("span",{className:"near-miss-progress-text",children:[l.conditionsMet,"/",l.conditionsTotal," conditions"]})]}),e.jsx("div",{className:"near-miss-conditions",children:l.conditions.map((T,A)=>e.jsxs("div",{className:`condition-item ${T.met?"met":"unmet"}`,children:[e.jsx("span",{className:"condition-status",children:T.met?"âœ…":"âŒ"}),e.jsxs("span",{className:"condition-stat",children:[ke(T.stat),":"]}),e.jsx("span",{className:`condition-category ${T.category?.toLowerCase()}`,children:T.category}),!T.met&&T.gap!==void 0&&e.jsxs("span",{className:"condition-gap",children:["Encore ",Math.abs(T.gap).toFixed(0)," pts"]})]},A))})]})]},l.id)},d=(l,v,F,T,A,z,V)=>e.jsxs("div",{className:`titles-accordion ${z}`,children:[e.jsxs("div",{className:"titles-accordion-header",children:[e.jsxs("h4",{children:[v," ",F," (",T,")"]}),e.jsx("p",{className:"titles-accordion-subtitle",children:A})]}),f[l]&&e.jsx("div",{className:"titles-accordion-content",children:V})]});return e.jsxs("div",{className:"titles-section",children:[e.jsxs("div",{className:"titles-header",children:[e.jsx("h3",{children:"ðŸ·ï¸ Titres actuels"}),e.jsxs("p",{className:"titles-info",children:[r.titles.length," titre",r.titles.length>1?"s":""," â€¢ ",r.gamesPlayed," parties jouÃ©es"]})]}),e.jsxs("div",{className:"titles-summary",children:[r.primaryTitle&&e.jsxs("div",{className:"titles-summary-item primary-summary",children:[e.jsx("span",{className:"titles-summary-emoji",children:"ðŸ‘‘"}),e.jsxs("span",{className:"titles-summary-label",children:[r.primaryTitle.emoji," ",r.primaryTitle.title]})]}),e.jsxs("button",{type:"button",className:`titles-summary-item ${g==="owned"?"active-filter":""}`,onClick:()=>x("owned"),children:[e.jsx("span",{className:"titles-summary-value",children:a.length}),e.jsx("span",{className:"titles-summary-label",children:"âœ¨ DÃ©tenus"})]}),o.length>0&&e.jsxs("button",{type:"button",className:`titles-summary-item ${g==="reconquer"?"active-filter":""}`,onClick:()=>x("reconquer"),children:[e.jsx("span",{className:"titles-summary-value",children:o.length}),e.jsx("span",{className:"titles-summary-label",children:"ðŸ† Ã€ reconquÃ©rir"})]}),t.length>0&&e.jsxs("button",{type:"button",className:`titles-summary-item ${g==="nearMiss"?"active-filter":""}`,onClick:()=>x("nearMiss"),children:[e.jsx("span",{className:"titles-summary-value",children:t.length}),e.jsx("span",{className:"titles-summary-label",children:"ðŸŽ¯ Ã€ portÃ©e"})]})]}),a.length>0&&(!g||g==="owned")&&d("owned","âœ¨","Vos Titres",a.length,"Titres que vous possÃ©dez ou partagez","owned",e.jsx("div",{className:"titles-grid",children:a.map((l,v)=>i(l,v))})),o.length>0&&(!g||g==="reconquer")&&d("reconquer","ðŸ†","Titres Ã  reconquÃ©rir",o.length,"Ces titres auraient pu Ãªtre les vÃ´tres â€” battez-vous pour les rÃ©cupÃ©rer !","reconquer",e.jsx("div",{className:"titles-grid",children:o.map((l,v)=>i(l,a.length+v))})),t.length>0&&(!g||g==="nearMiss")&&d("nearMiss","ðŸŽ¯","Titres Ã  portÃ©e",t.length,"Vous Ãªtes proche de remplir les conditions pour ces titres","near-miss",e.jsx("div",{className:"titles-grid",children:t.map((l,v)=>p(l,v))}))]})}function Mt(r,m){return r.map((f,b)=>{const g=b<m,n=f.stars===4;return e.jsx("span",{className:`achievement-star ${g?"unlocked":""} ${n?"lycan":""}`,title:`${n?"ðŸº Lycan":"â­".repeat(f.stars)} â€” ${f.threshold}`,children:n?"ðŸº":"â­"},f.stars)})}function zt({achievementsWithProgress:r,playerAchievements:m,categories:f,isLoading:b}){const[g,n]=k.useState(null);if(b)return e.jsx("div",{className:"achievements-section",children:e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des succÃ¨s..."})]})});if(!r||r.length===0)return e.jsx("div",{className:"achievements-section",children:e.jsxs("div",{className:"achievements-empty",children:[e.jsx("p",{children:"ðŸ† Aucun succÃ¨s disponible"}),e.jsx("p",{className:"achievements-empty-subtitle",children:"Les succÃ¨s seront disponibles aprÃ¨s la prochaine synchronisation hebdomadaire"})]})});const w=r.reduce((t,i)=>t+i.levels.length,0),h=m?.totalUnlocked||0,u={1:0,2:0,3:0,4:0};if(m)for(const t of m.achievements)for(const i of t.unlockedLevels)u[i.stars]++;const x=k.useMemo(()=>{const t={};for(const i of r)t[i.category]||(t[i.category]={total:0,unlocked:0}),t[i.category].total++,i.playerProgress&&i.playerProgress.unlockedLevels.length>0&&t[i.category].unlocked++;return t},[r]),c=g?r.filter(t=>t.category===g):r,a=Object.entries(f).sort(([,t],[,i])=>t.order-i.order),o=k.useMemo(()=>{const t=[];for(const[i,p]of a){const d=c.filter(l=>l.category===i);d.length!==0&&(d.sort((l,v)=>{const F=l.playerProgress?l.playerProgress.unlockedLevels.length:0,T=v.playerProgress?v.playerProgress.unlockedLevels.length:0,A=F===l.levels.length?1:0,z=T===v.levels.length?1:0;if(A!==z)return z-A;if(F!==T)return T-F;const V=l.playerProgress?.progress||0;return(v.playerProgress?.progress||0)-V}),t.push({key:i,label:p.label,emoji:p.emoji,items:d}))}return t},[c,a]);return e.jsxs("div",{className:"achievements-section",children:[e.jsxs("div",{className:"achievements-summary",children:[e.jsxs("div",{className:"achievements-summary-item",children:[e.jsx("span",{className:"achievements-summary-value",children:h}),e.jsxs("span",{className:"achievements-summary-label",children:["/ ",w," niveaux"]})]}),u[1]>0&&e.jsxs("div",{className:"achievements-summary-item",children:[e.jsx("span",{children:"â­"}),e.jsx("span",{className:"achievements-summary-value",children:u[1]})]}),u[2]>0&&e.jsxs("div",{className:"achievements-summary-item",children:[e.jsx("span",{children:"â­â­"}),e.jsx("span",{className:"achievements-summary-value",children:u[2]})]}),u[3]>0&&e.jsxs("div",{className:"achievements-summary-item",children:[e.jsx("span",{children:"â­â­â­"}),e.jsx("span",{className:"achievements-summary-value",children:u[3]})]}),u[4]>0&&e.jsxs("div",{className:"achievements-summary-item",children:[e.jsx("span",{children:"ðŸº"}),e.jsx("span",{className:"achievements-summary-value",children:u[4]})]})]}),e.jsxs("div",{className:"achievements-categories",children:[e.jsxs("button",{type:"button",className:`achievements-category-btn ${g===null?"active":""}`,onClick:()=>n(null),children:["Tous",e.jsxs("span",{className:"achievements-category-count",children:["(",r.length,")"]})]}),a.map(([t,i])=>{const p=x[t];return p?e.jsxs("button",{type:"button",className:`achievements-category-btn ${g===t?"active":""}`,onClick:()=>n(t),children:[i.emoji," ",i.label,e.jsxs("span",{className:"achievements-category-count",children:["(",p.unlocked,"/",p.total,")"]})]},t):null})]}),o.map(t=>e.jsxs("div",{children:[!g&&e.jsxs("div",{className:"achievements-category-header",children:[e.jsx("span",{children:t.emoji}),e.jsx("h4",{children:t.label}),e.jsxs("span",{className:"cat-count",children:["(",x[t.key]?.unlocked||0,"/",x[t.key]?.total||0,")"]})]}),e.jsx("div",{className:"achievements-grid",children:t.items.map(i=>{const p=i.playerProgress,d=p?p.unlockedLevels.length:0,l=d===i.levels.length,v=p!==null&&p.currentValue>0,F=!v;return e.jsxs("div",{className:`achievement-card ${l?"fully-unlocked":v?"has-progress":"locked"}`,title:i.explanation,children:[e.jsx("div",{className:"achievement-emoji",children:i.emoji}),e.jsxs("div",{className:"achievement-content",children:[e.jsx("h5",{className:"achievement-name",children:i.name}),e.jsx("p",{className:"achievement-description",children:i.description}),!F&&e.jsx("p",{className:"achievement-explanation",children:i.explanation}),e.jsx("div",{className:"achievement-stars",children:Mt(i.levels,d)}),v&&!l&&p&&e.jsxs("div",{className:"achievement-progress-container",children:[e.jsx("div",{className:"achievement-progress-bar",children:e.jsx("div",{className:"achievement-progress-fill",style:{width:`${Math.max(p.progress*100,2)}%`}})}),e.jsxs("div",{className:"achievement-progress-text",children:[e.jsx("span",{className:"achievement-progress-value",children:p.currentValue}),p.nextLevel&&e.jsxs("span",{children:["prochain : ",p.nextLevel.threshold]})]})]}),l&&p&&e.jsxs("div",{className:"achievement-progress-container",children:[e.jsx("div",{className:"achievement-progress-bar",children:e.jsx("div",{className:"achievement-progress-fill complete",style:{width:"100%"}})}),e.jsxs("div",{className:"achievement-progress-text",children:[e.jsx("span",{className:"achievement-progress-value",children:p.currentValue}),e.jsx("span",{children:"âœ… ComplÃ©tÃ©"})]})]})]})]},i.id)})})]},t.key))]})}function Ft(r){const{settings:m}=xe(),{joueursData:f}=ue(),[b,g]=k.useState(null),[n,w]=k.useState(!0),[h,u]=k.useState(null);k.useEffect(()=>{(async()=>{w(!0),u(null);try{const o=m.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",t=await fetch(o);if(!t.ok){if(t.status===404)g(null),u("Les succÃ¨s n'ont pas encore Ã©tÃ© gÃ©nÃ©rÃ©s. Ils seront disponibles aprÃ¨s la prochaine synchronisation.");else throw new Error(`HTTP error! status: ${t.status}`);return}const i=await t.json();g(i)}catch(o){console.error("Error loading player achievements:",o),u(o instanceof Error?o.message:"Erreur inconnue"),g(null)}finally{w(!1)}})()},[m.dataSource]);const x=k.useMemo(()=>{if(!b||!r)return null;const a=Object.entries(b.players).find(([o,t])=>t.playerName===r);if(a)return a[1];if(f?.Players){const t=f.Players.find(i=>i.Joueur===r)?.SteamID;if(t&&b.players[t])return b.players[t]}return null},[b,r,f]),c=k.useMemo(()=>b?b.achievementDefinitions.map(a=>{const o=x?.achievements.find(t=>t.id===a.id)||null;return{...a,playerProgress:o}}):[],[b,x]);return{data:b,playerData:x,achievementsWithProgress:c,definitions:b?.achievementDefinitions||[],categories:b?.categories||{},isLoading:n,error:h}}function as(){const{settings:r,updateSettings:m}=xe(),{navigateToGameDetails:f,navigationState:b,updateNavigationState:g}=de(),{data:n,isLoading:w,error:h}=Ee(),{joueursData:u,isLoading:x}=ue(),{data:c,isLoading:a,error:o}=ct(r.highlightedPlayer),{playerData:t,isLoading:i}=ut(r.highlightedPlayer),{playerData:p,achievementsWithProgress:d,categories:l,isLoading:v}=Ft(r.highlightedPlayer),F=ve(u),[T,A]=k.useState(""),[z,V]=k.useState(null),{clips:$}=it(r.highlightedPlayer),{clips:G}=nt(),[s,R]=k.useState(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded"?"modded":"all":r.gameFilter==="modded"?"modded":"all"),L=k.useMemo(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded":r.gameFilter==="modded",[r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter,r.gameFilter]),[y,C]=k.useState(r.selectedPlayerSelectionView||b.selectedPlayerSelectionView||"rankings"),[j,P]=k.useState("session"),[S,D]=k.useState("all");k.useEffect(()=>{if(r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled){const N=r.independentFilters.gameFilter==="modded"?"modded":"all";R(N)}else if(!r.useIndependentFilters){const N=r.gameFilter==="modded"?"modded":"all";R(N)}},[r.gameFilter,r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter]),k.useEffect(()=>{L&&s!=="modded"&&R("modded")},[L,s]),k.useEffect(()=>{const N=r.selectedPlayerSelectionView||b.selectedPlayerSelectionView;N&&N!==y&&C(N)},[r.selectedPlayerSelectionView,b.selectedPlayerSelectionView]);const{data:M}=je(r.highlightedPlayer||""),I=k.useMemo(()=>{if(!n||!n.GameStats)return[];const N=L?n.GameStats.filter(Z=>Z.Modded===!0):n.GameStats,W=new Map;return N.forEach(Z=>{const O=new Date(Z.StartDate);Z.PlayerStats.forEach(re=>{const ae=ie(re),Le=u?.Players?.find(Ie=>Ie.SteamID===ae)?.Joueur||re.Username;W.has(ae)||W.set(ae,{games:0,wins:0,firstDate:O,lastDate:O,displayName:Le});const ne=W.get(ae);ne.games++,re.Victorious&&ne.wins++,O<ne.firstDate&&(ne.firstDate=O),O>ne.lastDate&&(ne.lastDate=O)})}),Array.from(W.entries()).map(([Z,O])=>{let re=u?.Players?.find(ae=>ae.SteamID===Z);return re||(re=u?.Players?.find(ae=>ae.Joueur===O.displayName)),{id:Z,name:O.displayName,totalGames:O.games,totalWins:O.wins,winRate:O.games>0?O.wins/O.games*100:0,firstGameDate:O.firstDate.toLocaleDateString("fr-FR"),lastGameDate:O.lastDate.toLocaleDateString("fr-FR"),isHighlighted:O.displayName===r.highlightedPlayer,image:re?.Image||null,twitch:re?.Twitch||null,youtube:re?.Youtube||null}})},[n,r.highlightedPlayer,u,L]),E=k.useMemo(()=>{if(!T.trim())return I;const N=T.toLowerCase();return I.filter(W=>W.name.toLowerCase().includes(N))},[I,T]),X=k.useMemo(()=>[...E].sort((N,W)=>W.totalGames-N.totalGames),[E]),se=N=>{m({highlightedPlayer:N}),A("")},q=N=>{C(N),g({selectedPlayerSelectionView:N}),m({selectedPlayerSelectionView:N,tab:"playerSelection"})},B=()=>{if($.length===0)return;const N=Math.floor(Math.random()*$.length);V($[N])};return w||x?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):h?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",h]})]}):!n||I.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!r.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:T,onChange:N=>A(N.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[E.length," joueur",E.length!==1?"s":"",T&&` (filtrÃ©${E.length!==1?"s":""} de ${I.length})`]})]})]}),e.jsx("div",{className:"player-display",children:T?E.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>A(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:X.map(N=>e.jsxs("button",{type:"button",className:`suggestion-btn ${N.isHighlighted?"highlighted":""}`,onClick:()=>se(N.name),children:[N.image?e.jsx("img",{src:N.image,alt:`Photo de profil de ${N.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":F[N.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[N.name,N.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[N.totalGames," parties â€¢ ",N.winRate.toFixed(1),"% victoires"]})]})]},N.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',T,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>A(""),children:"Effacer la recherche"})]}):r.highlightedPlayer?(()=>{const N=I.find(W=>W.name===r.highlightedPlayer);return N?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:N.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[N.image?e.jsx("img",{src:N.image,alt:`Photo de profil de ${N.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":F[N.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[N.totalGames," parties â€¢ ",N.totalWins," victoires â€¢ ",N.winRate.toFixed(1),"% taux de victoire"]}),t?.primaryTitle?e.jsxs("div",{className:"player-primary-title",title:t.primaryTitle.description,style:{marginTop:"0.5rem",display:"inline-flex",alignItems:"center",gap:"0.3rem",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("span",{className:"title-emoji",children:t.primaryTitle.emoji}),e.jsx("span",{className:"title-text",children:t.primaryTitle.title})]}):e.jsx("div",{className:"player-no-title",style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic"},children:"ðŸ“œ 25 parties moddÃ©es minimum pour obtenir un titre"}),(N.twitch||N.youtube||$.length>0)&&e.jsxs("div",{className:"social-links",children:[N.twitch&&e.jsx("a",{href:N.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),N.youtube&&e.jsx("a",{href:N.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"}),$.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:W=>{W.stopPropagation(),B()},title:`${$.length} clip${$.length>1?"s":""} disponible${$.length>1?"s":""}`,children:["ðŸŽ¬ Clip alÃ©atoire (",$.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="rankings"?"active":""}`,onClick:()=>q("rankings"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="titles"?"active":""}`,onClick:()=>q("titles"),children:"Titres"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="evolution"?"active":""}`,onClick:()=>q("evolution"),children:"Ã‰volution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="camps"?"active":""}`,onClick:()=>q("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="roles"?"active":""}`,onClick:()=>q("roles"),children:"RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="actions"?"active":""}`,onClick:()=>q("actions"),children:"Actions"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="roleactions"?"active":""}`,onClick:()=>q("roleactions"),children:"Actions des RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="kills"?"active":""}`,onClick:()=>q("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="deathmap"?"active":""}`,onClick:()=>q("deathmap"),children:"Cartes"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="talkingtime"?"active":""}`,onClick:()=>q("talkingtime"),children:"Parole"})]}),y==="rankings"&&e.jsxs("div",{className:"rankings-section",children:[a?e.jsxs("div",{className:"rankings-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):o?e.jsx("div",{className:"rankings-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",o]})}):c?e.jsx(mt,{rankings:s==="all"?c.allGamesRankings:c.moddedOnlyRankings,title:s==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",rankingType:s}):e.jsx("div",{className:"rankings-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"rankings-filter",children:[!L&&e.jsx("button",{type:"button",className:`filter-btn ${s==="all"?"active":""}`,onClick:W=>{W.stopPropagation(),R("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${s==="modded"?"active":""}`,onClick:W=>{W.stopPropagation(),R("modded")},disabled:L,children:"Parties moddÃ©es"})]})]}),y==="titles"&&e.jsx(Rt,{playerTitles:t,titlesLoading:i}),y==="achievements"&&e.jsx(zt,{achievementsWithProgress:d,playerAchievements:p,categories:l,isLoading:v}),y==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[M&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{f({selectedPlayer:N.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${N.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:M.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:He(M.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{f({selectedPlayer:N.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${N.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:M.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[M.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:j,onChange:W=>P(W.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:S,onChange:W=>D(W.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(ht,{selectedPlayerName:N.name,groupingMethod:j,campFilter:S})]}),y==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(pt,{selectedPlayerName:N.name})}),y==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(yt,{selectedPlayerName:N.name})}),y==="actions"&&e.jsx("div",{className:"player-history-section",children:e.jsx(jt,{selectedPlayerName:N.name})}),y==="roleactions"&&e.jsx("div",{className:"player-history-section",children:e.jsx(bt,{selectedPlayerName:N.name})}),y==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(gt,{selectedPlayerName:N.name})}),y==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Nt,{selectedPlayerName:N.name})}),y==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(At,{selectedPlayerName:N.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:W=>{W.stopPropagation(),m({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[N.firstGameDate," - ",N.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',r.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>m({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:X.map(N=>e.jsxs("div",{className:`character-card ${N.isHighlighted?"highlighted":""}`,onClick:()=>se(N.name),title:`${N.name} - ${N.totalGames} parties, ${N.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:N.image?e.jsx("img",{src:N.image,alt:`Photo de profil de ${N.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":F[N.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:N.name}),(N.twitch||N.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[N.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),N.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},N.id))})})}),z&&e.jsx(ot,{clip:z,onClose:()=>V(null),relatedClips:lt(z,G),nextClip:Pe(z,G),onNextClip:()=>{const N=Pe(z,G);N&&V(N)},onRelatedClip:N=>{const W=G.find(Z=>Z.ClipId===N);W&&V(W)}})]})}export{as as PlayerSelectionPage};
