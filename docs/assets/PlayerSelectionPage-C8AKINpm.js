import{r as y,u as A,a as G,j as s,m as L,l as E}from"./index-CugAI66c.js";import{u as D,g as q}from"./api-BcBSTyJh.js";function z(i){const[u,x]=y.useState(null),[v,N]=y.useState(!1),[h,w]=y.useState(null);y.useEffect(()=>{let m=!0;return(async()=>{try{N(!0),w(null);const d=await fetch("/data/playerAchievements.json");if(!d.ok)throw new Error(`Failed to load achievements: ${d.status} ${d.statusText}`);const T=await d.json();m&&x(T)}catch(d){m&&w(d instanceof Error?d.message:"Failed to load achievements")}finally{m&&N(!1)}})(),()=>{m=!1}},[]);const g=i&&u?.achievements[i]||null;return y.useEffect(()=>{if(i&&u){const m=u.achievements[i];m?console.log(`🏆 Achievements for ${i}:`,{allGames:m.allGamesAchievements.length,moddedOnly:m.moddedOnlyAchievements.length,categories:[...new Set([...m.allGamesAchievements.map(C=>C.category),...m.moddedOnlyAchievements.map(C=>C.category)])]}):console.log(`❌ No achievements found for ${i}`)}},[i,u]),{data:g,isLoading:v,error:h,metadata:{generatedAt:u?.generatedAt||null,totalPlayers:u?.totalPlayers||0,totalGames:u?.totalGames||0,totalModdedGames:u?.totalModdedGames||0}}}function I(){const[i,u]=y.useState(null),[x,v]=y.useState(!0),[N,h]=y.useState(null);return y.useEffect(()=>{(async()=>{try{v(!0),h(null);const g=await fetch("/data/joueurs.json");if(!g.ok)throw new Error("Failed to fetch joueurs data");const m=await g.json();u(m)}catch(g){console.error("Error fetching joueurs data:",g),h(g instanceof Error?g.message:"Unknown error")}finally{v(!1)}})()},[]),{joueursData:i,isLoading:x,error:N}}function M(i,u){return i.find(x=>x.Joueur.toLowerCase()===u.toLowerCase())}function V({achievements:i,title:u,emptyMessage:x,achievementType:v="all"}){const{navigateToTab:N,updateNavigationState:h,clearNavigation:w}=A(),{settings:g,updateSettings:m}=G(),C=D(),d=(e,n)=>{if(n.stopPropagation(),!e.redirectTo)return;w();const o=g.highlightedPlayer;if(m(v==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:o,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:o,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),e.category==="comparison"&&e.redirectTo.subTab==="comparison"){const a=g.highlightedPlayer||"",t=T(e.description,a);t&&h({playerComparisonState:{selectedPlayer1:a,selectedPlayer2:t,showDetailedStats:!0}})}if(e.category==="comparison"&&e.redirectTo.subTab==="pairing"){const a=e.description.toLowerCase().includes("loup");h({selectedPairingTab:a?"wolves":"lovers"})}if(e.category==="kills"&&e.redirectTo.subTab==="deathStats"){const a=e.description.match(/(Villageois|Loups|Autres)/i);a&&h({deathStatsSelectedCamp:a[1]});let t=10;const l=e.description.match(/min\.\s*(\d+)/);l&&(t=parseInt(l[1],10));let p="totalKills";const f=e.redirectTo.chartSection;f&&(f==="killers-total"?p="totalKills":f==="killers-average"?p="averageKills":f==="deaths-total"?p="totalDeaths":f==="survivors-average"&&(p="survivalRate")),h({deathStatisticsState:{selectedCamp:a?.[1]||"Tous les camps",minGamesForAverage:t,focusChart:p}})}if(e.category==="map"&&e.redirectTo.subTab==="playersGeneral"){const a=e.redirectTo.mapFilter||"all";let t=10;const l=e.description.match(/min\.\s*(\d+)/);l&&(t=parseInt(l[1])),m(v==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:a,playerFilter:{mode:"none",players:[]},highlightedPlayer:o,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:a,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:a,playerFilter:{mode:"none",players:[]},highlightedPlayer:o,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:a,playerFilter:{mode:"none",players:[]}}}),h({playersGeneralState:{minGamesForWinRate:t,winRateOrder:"best",focusChart:"winRate"}}),N("players","playersGeneral");return}if(e.category==="history"&&e.redirectTo.subTab==="history"&&h({selectedPlayerName:g.highlightedPlayer||"",groupingMethod:"session"}),e.category==="series"&&e.redirectTo.subTab==="series"){let a="wins";const t=e.title.toLowerCase(),l=e.description.toLowerCase();t.includes("défaite")||l.includes("défaite")?a="losses":t.includes("loup")||l.includes("loup")?a="loup":t.includes("villageois")||l.includes("villageois")?a="villageois":(t.includes("victoire")||l.includes("victoire"))&&(a="wins"),h({selectedSeriesType:a})}if(e.category==="general"&&e.redirectTo.subTab==="playersGeneral"){let a=10;const t=e.description.match(/min\.\s*(\d+)/);t&&(a=parseInt(t[1],10));let l="winRate",p="best";const f=e.title.toLowerCase(),k=e.description.toLowerCase();f.includes("participation")||k.includes("participation")?l="participation":(f.includes("taux de victoire")||k.includes("taux de victoire"))&&(l="winRate",(f.includes("moins bon")||f.includes("mauvais")||k.includes("moins bon")||k.includes("mauvais"))&&(p="worst")),h({playersGeneralState:{minGamesForWinRate:a,winRateOrder:p,focusChart:l}})}if(e.category==="performance"&&e.redirectTo.subTab==="campPerformance"){const a=e.redirectTo.chartSection;let t="Villageois",l=1;a&&(a==="camp-loup"?t="Loup":a==="camp-villageois"?t="Villageois":a==="camp-idiot"?t="Idiot du Village":a==="camp-amoureux"?t="Amoureux":(a==="solo-roles"||a==="hall-of-fame")&&(t="Villageois"));const p=e.description.match(/min\.\s*(\d+)/);p&&(l=parseInt(p[1],10)),a==="solo-roles"?t="Rôles spéciaux":a==="hall-of-fame"&&(t="Tous les camps"),h({campPerformanceState:{selectedCampPerformanceCamp:t,selectedCampPerformanceMinGames:l}})}N(e.redirectTo.tab,e.redirectTo.subTab)},T=(e,n)=>{const o=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const a of o){const t=e.match(a);if(t&&t[1]){const l=t[1].trim();if(l!==n)return l}}return null},b=e=>{if(!e.redirectTo)return"Aucune navigation disponible";switch(e.category){case"general":if(e.redirectTo.subTab==="playersGeneral"){const a=e.description.match(/min\.\s*(\d+)/),t=a?parseInt(a[1],10):10,l=e.title.toLowerCase(),p=v==="modded"?" (Filtre parties moddées activé)":" (Filtres réinitialisés)";return l.includes("taux de victoire")?`Classement: ${e.rank}${e.totalRanked?`/${e.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${t} parties)${p}`:l.includes("participation")?`Classement: ${e.rank}${e.totalRanked?`/${e.totalRanked} joueurs`:""} - Cliquez pour voir les participations${p}`:`Classement: ${e.rank}${e.totalRanked?`/${e.totalRanked} joueurs`:""} - Cliquez pour voir le classement général des joueurs${p}`}break;case"map":if(e.redirectTo.subTab==="playersGeneral"){const a=e.redirectTo.mapFilter,t=a==="village"?"Village":a==="chateau"?"Château":"map",l=v==="modded"?" (Filtres parties moddées + map activés)":" (Filtre map activé)";return`Classement: ${e.rank}${e.totalRanked?`/${e.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques générales filtrées sur ${t}${l}`}break;case"history":if(e.redirectTo.subTab==="history")return"Cliquez pour voir l'historique détaillé du joueur par map";break;case"comparison":if(e.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${T(e.description,g.highlightedPlayer||"")||"ce joueur"}`;if(e.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(e.redirectTo.subTab==="deathStats"){const a=e.description.match(/(Villageois|Loups|Autres)/i),t=e.description.match(/min\.\s*(\d+)/),l=t?parseInt(t[1],10):10,p=a?.[1]||"Tous les camps",f=e.redirectTo.chartSection;let k="kills et morts";return f==="killers-total"?k="total des kills":f==="killers-average"?k=`moyenne des kills (min. ${l} parties)`:f==="deaths-total"?k="total des morts":f==="survivors-average"&&(k=`taux de survie (min. ${l} parties)`),`Cliquez pour voir les statistiques de ${k} ${p!=="Tous les camps"?`en ${p}`:""}`}break;case"series":if(e.redirectTo.subTab==="series"){const a=e.title.toLowerCase(),t=e.description.toLowerCase();return a.includes("défaite")||t.includes("défaite")?"Cliquez pour voir les séries de défaites":a.includes("loup")||t.includes("loup")?"Cliquez pour voir les séries Loups":a.includes("villageois")||t.includes("villageois")?"Cliquez pour voir les séries Villageois":a.includes("victoire")||t.includes("victoire")?"Cliquez pour voir les séries de victoires":"Cliquez pour voir les séries consécutives"}break;case"performance":if(e.redirectTo.subTab==="campPerformance"){const a=e.redirectTo.chartSection,t=v==="modded"?" (Filtre parties moddées activé)":" (Filtres réinitialisés)";return a==="camp-loup"?`Cliquez pour voir les performances camp Loup${t}`:a==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${t}`:a==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${t}`:a==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${t}`:a==="solo-roles"?`Cliquez pour voir le classement (rôles spéciaux)${t}`:a==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${t}`:`Cliquez pour voir les performances par camp${t}`}break}return`Cliquez pour voir ${e.redirectTo.subTab}`+(v==="modded"?" (Filtre parties moddées activé)":" (Filtres réinitialisés)")},S=e=>C[e]||q(e),F=e=>{const n=[/avec ([^:]+?):/,/contre ([^:]+?):/];let o=e;return n.forEach(a=>{const t=e.match(a);if(t&&t[1]){const l=t[1].trim(),f=`<span class="player-name-highlight" style="color: ${S(l)};">${l}</span>`;o=o.replace(l,f)}}),o};if(i.length===0)return s.jsxs("div",{className:"achievements-empty",children:[s.jsx("h4",{children:u}),s.jsx("p",{children:x||"Aucun succès dans cette catégorie"})]});const P=e=>e===1?"🥇":e===2?"🥈":e===3?"🥉":"",R=e=>e===1?"rank-1":e===2?"rank-2":e===3?"rank-3":e&&e<=10?"rank-top-10":"",$=i.filter(e=>e.category!=="comparison"&&e.type==="good").sort((e,n)=>(e.rank??999)-(n.rank??999)),r=i.filter(e=>e.category!=="comparison"&&e.type==="bad").sort((e,n)=>(e.rank??999)-(n.rank??999)),c=i.filter(e=>e.category==="comparison"),j=$.filter(e=>e.rank&&e.rank<=3).length;return s.jsxs("div",{className:"achievements-container",children:[s.jsx("h4",{children:u}),j>0&&s.jsxs("div",{className:"top3-showcase",children:[s.jsx("h5",{className:"top3-title",children:"✨ Podium d'Excellence ✨"}),s.jsx("div",{className:"top3-grid",children:$.filter(e=>e.rank&&e.rank<=3).map((e,n)=>s.jsxs("div",{className:`top3-card ${R(e.rank)} animate-slide-in`,style:{animationDelay:`${n*.15}s`},onClick:o=>d(e,o),title:b(e),children:[s.jsx("div",{className:"top3-medal-container",children:s.jsx("span",{className:"top3-medal",children:P(e.rank)})}),s.jsxs("div",{className:"top3-content",children:[s.jsxs("div",{className:"top3-rank-badge",children:["#",e.rank,e.totalRanked?`/${e.totalRanked}`:""]}),s.jsx("h6",{className:"top3-achievement-title",children:e.title}),s.jsx("p",{className:"top3-achievement-description",children:e.description})]}),s.jsxs("div",{className:"top3-sparkles",children:[s.jsx("span",{className:"sparkle sparkle-1",children:"✨"}),s.jsx("span",{className:"sparkle sparkle-2",children:"⭐"}),s.jsx("span",{className:"sparkle sparkle-3",children:"✨"})]})]},e.id))})]}),$.length>0&&s.jsxs("div",{className:"achievements-section good-achievements",children:[s.jsx("h5",{children:"🏆 Classements"}),s.jsx("div",{className:"achievements-grid",children:$.filter(e=>!e.rank||e.rank>3).map((e,n)=>s.jsxs("div",{className:`achievement-card good ${R(e.rank)}`,onClick:o=>d(e,o),title:b(e),style:{animationDelay:`${n*.05}s`},children:[s.jsxs("div",{className:"achievement-header",children:[s.jsx("span",{className:"achievement-title",children:e.title}),s.jsxs("span",{className:"achievement-rank",children:["#",e.rank,e.totalRanked?`/${e.totalRanked}`:""]})]}),s.jsx("p",{className:"achievement-description",children:e.description})]},e.id))})]}),r.length>0&&s.jsxs("div",{className:"achievements-section bad-achievements",children:[s.jsx("h5",{children:"💀 Classements (Inversés)"}),s.jsx("div",{className:"achievements-grid",children:r.map(e=>s.jsxs("div",{className:`achievement-card bad rank-${e.rank}`,onClick:n=>d(e,n),title:b(e),children:[s.jsxs("div",{className:"achievement-header",children:[s.jsx("span",{className:"achievement-title",children:e.title}),s.jsxs("span",{className:"achievement-rank",children:["#",e.rank,e.totalRanked?`/${e.totalRanked}`:""]})]}),s.jsx("p",{className:"achievement-description",children:e.description})]},e.id))})]}),c.length>0&&s.jsxs("div",{className:"achievements-section comparison-achievements",children:[s.jsx("h5",{children:"📊 Statistiques Face-à-Face"}),s.jsx("div",{className:"achievements-grid",children:c.map(e=>s.jsxs("div",{className:"achievement-card comparison",onClick:n=>d(e,n),title:b(e),children:[s.jsx("div",{className:"achievement-header",children:s.jsx("span",{className:"achievement-title",children:e.title})}),s.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:F(e.description)}})]},e.id))})]})]})}function J(){const{settings:i,updateSettings:u}=G(),{data:x,isLoading:v,error:N}=L(),{joueursData:h,isLoading:w}=I(),{data:g,isLoading:m,error:C}=z(i.highlightedPlayer),[d,T]=y.useState(""),[b,S]=y.useState("all"),F=y.useMemo(()=>{if(!x||!x.GameStats)return[];const r=new Map;return x.GameStats.forEach(c=>{const j=new Date(c.StartDate);c.PlayerStats.forEach(e=>{const n=E(e.Username);r.has(n)||r.set(n,{games:0,wins:0,firstDate:j,lastDate:j});const o=r.get(n);o.games++,e.Victorious&&o.wins++,j<o.firstDate&&(o.firstDate=j),j>o.lastDate&&(o.lastDate=j)})}),Array.from(r.entries()).map(([c,j])=>{const e=h?.Players?M(h.Players,c):null;return{name:c,totalGames:j.games,totalWins:j.wins,winRate:j.games>0?j.wins/j.games*100:0,firstGameDate:j.firstDate.toLocaleDateString("fr-FR"),lastGameDate:j.lastDate.toLocaleDateString("fr-FR"),isHighlighted:c===i.highlightedPlayer,image:e?.Image||null,twitch:e?.Twitch||null,youtube:e?.Youtube||null}})},[x,i.highlightedPlayer,h]),P=y.useMemo(()=>{if(!d.trim())return F;const r=d.toLowerCase();return F.filter(c=>c.name.toLowerCase().includes(r))},[F,d]),R=y.useMemo(()=>[...P].sort((r,c)=>c.totalGames-r.totalGames),[P]),$=r=>{u({highlightedPlayer:r}),T("")};return v||w?s.jsxs("div",{className:"player-selection-loading",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Chargement des joueurs..."})]}):N?s.jsxs("div",{className:"player-selection-error",children:[s.jsx("h2",{children:"Erreur"}),s.jsxs("p",{children:["Impossible de charger les données des joueurs: ",N]})]}):!x||F.length===0?s.jsxs("div",{className:"player-selection-empty",children:[s.jsx("h2",{children:"Aucune donnée disponible"}),s.jsx("p",{children:"Aucun joueur trouvé dans les données."})]}):s.jsxs("div",{className:"player-selection-container",children:[s.jsxs("div",{className:"player-selection-header",children:[s.jsx("h2",{children:"Sélection de Joueur"}),s.jsx("p",{className:"header-description",children:"Choisissez un joueur pour le mettre en évidence dans tous les graphiques."}),s.jsxs("div",{className:"search-controls",children:[s.jsxs("div",{className:"search-box",children:[s.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:d,onChange:r=>T(r.target.value),className:"search-input"}),s.jsx("span",{className:"search-icon",children:"🔍"})]}),s.jsxs("div",{className:"player-count",children:[P.length," joueur",P.length!==1?"s":"",d&&` (filtré${P.length!==1?"s":""} de ${F.length})`]})]})]}),s.jsx("div",{className:"player-display",children:d?P.length>0?s.jsxs("div",{className:"search-results",children:[s.jsxs("div",{className:"search-results-header",children:[s.jsx("h3",{children:"Résultats de recherche:"}),s.jsx("button",{className:"clear-search-btn",onClick:()=>T(""),children:"Effacer la recherche"})]}),s.jsx("div",{className:"suggestion-list",children:R.map(r=>s.jsxs("button",{className:`suggestion-btn ${r.isHighlighted?"highlighted":""}`,onClick:()=>$(r.name),children:[r.image?s.jsx("img",{src:r.image,alt:r.name,className:"player-avatar"}):s.jsx("div",{className:"player-avatar-placeholder",children:r.name.charAt(0).toUpperCase()}),s.jsxs("div",{className:"suggestion-btn-content",children:[s.jsxs("div",{className:"suggestion-btn-name",children:[r.name,r.isHighlighted&&s.jsx("span",{className:"highlight-indicator",children:" ★"})]}),s.jsxs("div",{className:"suggestion-btn-stats",children:[r.totalGames," parties • ",r.winRate.toFixed(1),"% victoires"]})]})]},r.name))})]}):s.jsxs("div",{className:"no-results",children:[s.jsxs("p",{children:['Aucun joueur trouvé pour "',d,'"']}),s.jsx("button",{className:"clear-search-btn",onClick:()=>T(""),children:"Effacer la recherche"})]}):i.highlightedPlayer?(()=>{const r=F.find(c=>c.name===i.highlightedPlayer);return r?s.jsxs("div",{className:"single-player-card highlighted",children:[s.jsxs("div",{className:"player-card-header",children:[s.jsx("h3",{className:"player-name",children:r.name}),s.jsx("span",{className:"highlight-badge",children:"★ Mis en évidence"})]}),s.jsxs("div",{className:"player-info-row",children:[r.image?s.jsx("img",{src:r.image,alt:r.name,className:"player-avatar large"}):s.jsx("div",{className:"player-avatar-placeholder large",children:r.name.charAt(0).toUpperCase()}),s.jsxs("div",{className:"player-info-text",children:[s.jsxs("div",{className:"player-stats-summary",children:[r.totalGames," parties • ",r.totalWins," victoires • ",r.winRate.toFixed(1),"% taux de victoire"]}),(r.twitch||r.youtube)&&s.jsxs("div",{className:"social-links",children:[r.twitch&&s.jsx("a",{href:r.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"📺 Twitch"}),r.youtube&&s.jsx("a",{href:r.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"🎬 YouTube"})]})]})]}),s.jsxs("div",{className:"player-actions",children:[s.jsxs("div",{className:"achievements-section",children:[m?s.jsxs("div",{className:"achievements-loading",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Chargement des classements..."})]}):C?s.jsx("div",{className:"achievements-error",children:s.jsxs("p",{children:["❌ Erreur lors du chargement des classements: ",C]})}):g?s.jsx(V,{achievements:b==="all"?g.allGamesAchievements:g.moddedOnlyAchievements,title:b==="all"?"Classements - Toutes les parties":"Classements - Parties moddées",emptyMessage:"Aucun classement dans cette catégorie",achievementType:b}):s.jsx("div",{className:"achievements-empty",children:s.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),s.jsxs("div",{className:"achievements-filter",children:[s.jsx("button",{className:`filter-btn ${b==="all"?"active":""}`,onClick:c=>{c.stopPropagation(),S("all")},children:"Toutes les parties"}),s.jsx("button",{className:`filter-btn ${b==="modded"?"active":""}`,onClick:c=>{c.stopPropagation(),S("modded")},children:"Parties moddées"})]}),s.jsx("button",{className:"highlight-btn active",onClick:c=>{c.stopPropagation(),u({highlightedPlayer:null})},children:"★ Retirer la mise en évidence"})]}),s.jsxs("div",{className:"player-period",children:[s.jsx("span",{className:"period-label",children:"Période d'activité:"}),s.jsxs("span",{className:"period-range",children:[r.firstGameDate," - ",r.lastGameDate]})]})]})]}):s.jsxs("div",{className:"no-player-found",children:[s.jsxs("p",{children:['Le joueur "',i.highlightedPlayer,`" n'a pas été trouvé dans les données.`]}),s.jsx("button",{className:"clear-selection-btn",onClick:()=>u({highlightedPlayer:null}),children:"Effacer la sélection"})]})})():s.jsx("div",{className:"player-selection-prompt",children:s.jsxs("div",{className:"selection-prompt-content",children:[s.jsx("h2",{children:"Sélectionnez un joueur"}),s.jsx("p",{children:"Utilisez la recherche ci-dessus pour trouver et sélectionner un joueur à mettre en évidence."})]})})})]})}export{J as PlayerSelectionPage};
