import{u as f,j as e}from"./index-fQGPSwzF.js";import{a as D}from"./baseStatsHook-DH41hxrD.js";import{a as g,l as v}from"./api-beq3FXpM.js";import{F as d,B as x,C as u,X as y,Y as m,a as j,b}from"./FullscreenChart-CNf7WybZ.js";import{R as h,T as p,Q as N}from"./CategoricalChart-CyY_1z8_.js";import{L as C,a as B}from"./LineChart-Dnm9RvZc.js";import{L as R}from"./Legend-CHoZHd1F.js";import"./ActivePoints-DaBIR071.js";function A(){return{averageDays:"0",maxDays:0,minDays:99,dayDistribution:{},daysByWinnerCamp:{},daysByPlayerCount:{},daysByWolfRatio:{}}}function M(a,s){a>s.maxDays&&(s.maxDays=a),a<s.minDays&&(s.minDays=a)}function W(a,s){s[a]||(s[a]=0),s[a]++}function L(a,s,t){a&&a.trim()!==""&&(t[a]||(t[a]={totalDays:0,count:0,average:"0"}),t[a].totalDays+=s,t[a].count++)}function k(a,s,t){if(a&&!isNaN(a)&&a>0){const i=a.toString();t[i]||(t[i]={totalDays:0,count:0,average:"0"}),t[i].totalDays+=s,t[i].count++}}function F(a,s,t,i){if(a&&s&&!isNaN(a)&&!isNaN(s)&&a>0){const l=a-s;if(l>0){const c=Math.round(s/l*100),n=(Math.round(c/1)*1).toString();i[n]||(i[n]={totalDays:0,count:0,average:"0"}),i[n].totalDays+=t,i[n].count++}}}function q(a,s,t){const i=a["Nombre de journÃ©es"],l=a["Camp victorieux"],c=a["Nombre de joueurs"],r=a["Nombre de loups"];i&&!isNaN(i)&&i>0&&(t.gamesWithDays++,t.totalDays+=i,M(i,s),W(i,s.dayDistribution),L(l,i,s.daysByWinnerCamp),k(c,i,s.daysByPlayerCount),F(c,r,i,s.daysByWolfRatio))}function K(a,s){s.gamesWithDays>0&&(a.averageDays=(s.totalDays/s.gamesWithDays).toFixed(1),Object.keys(a.daysByWinnerCamp).forEach(t=>{const i=a.daysByWinnerCamp[t];i.count>0&&(i.average=(i.totalDays/i.count).toFixed(1))}),Object.keys(a.daysByPlayerCount).forEach(t=>{const i=a.daysByPlayerCount[t];i.count>0&&(i.average=(i.totalDays/i.count).toFixed(1))}),Object.keys(a.daysByWolfRatio).forEach(t=>{const i=a.daysByWolfRatio[t];i.count>0&&(i.average=(i.totalDays/i.count).toFixed(1))}))}function P(a){const s=Object.keys(a).map(t=>({days:parseInt(t),count:a[parseInt(t)]}));return s.sort((t,i)=>t.days-i.days),s}function E(a){if(a.length===0)return null;const s=A(),t={totalDays:0,gamesWithDays:0};a.forEach(l=>{q(l,s,t)}),K(s,t);const i=P(s.dayDistribution);return{averageDays:s.averageDays,maxDays:s.maxDays,minDays:s.minDays,dayDistribution:i,daysByWinnerCamp:s.daysByWinnerCamp,daysByPlayerCount:s.daysByPlayerCount,daysByWolfRatio:s.daysByWolfRatio}}function G(){const{data:a,isLoading:s,error:t}=D(E);return{durationAnalysis:a,fetchingData:s,apiError:t}}function X(){const{durationAnalysis:a,fetchingData:s,apiError:t}=G(),{navigateToGameDetails:i}=f();if(s)return e.jsx("div",{className:"statistiques-attente",children:"Analyse des durÃ©es de partie en cours..."});if(t)return e.jsxs("div",{className:"statistiques-echec",children:["ProblÃ¨me rencontrÃ©: ",t]});if(!a)return e.jsx("div",{className:"statistiques-indisponibles",children:"DonnÃ©es d'analyse non disponibles"});const l=a?Object.entries(a.daysByWolfRatio).map(([r,n])=>({ratio:parseFloat(r),moyenne:parseFloat(n.average),parties:n.count})).sort((r,n)=>r.ratio-n.ratio):[],c=a?Object.entries(a.daysByWinnerCamp).map(([r,n])=>({camp:r,moyenne:parseFloat(n.average),parties:n.count})).sort((r,n)=>n.moyenne-r.moyenne):[];return e.jsxs("div",{className:"lycans-duree-analyse",children:[e.jsx("h2",{children:"Analyse des DurÃ©es de Partie"}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"DurÃ©e Moyenne"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[a.averageDays," jours"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"DurÃ©e Minimum"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[a.minDays," jours"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"DurÃ©e Maximum"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[a.maxDays," jours"]})]})]}),e.jsxs("div",{className:"lycans-graphiques-section",children:[e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Distribution des DurÃ©es de Partie"}),e.jsx(d,{title:"Distribution des DurÃ©es de Partie",children:e.jsx("div",{style:{height:300},children:e.jsx(h,{width:"100%",height:"100%",children:e.jsxs(x,{data:a?.dayDistribution||[],margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(u,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"days",label:{value:"Nombre de Jours",position:"insideBottom",offset:-5}}),e.jsx(m,{label:{value:"Nombre de Parties",angle:-90,position:"insideLeft"}}),e.jsx(p,{content:({active:r,payload:n})=>{if(r&&n&&n.length>0){const o=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsxs("strong",{children:[o.days," jours"]})}),e.jsxs("div",{children:[o.count," parties"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(j,{dataKey:"count",name:"Nombre de Parties",fill:"var(--chart-color-2)",onClick:r=>{r&&r.days&&i({selectedGameDuration:r.days,fromComponent:"Distribution des DurÃ©es de Partie"})},style:{cursor:"pointer"}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"DurÃ©e Moyenne par Ratio Loups/Villageois"}),e.jsx(d,{title:"DurÃ©e Moyenne par Ratio Loups/Villageois",children:e.jsx("div",{style:{height:300},children:e.jsx(h,{width:"100%",height:"100%",children:e.jsxs(C,{data:l,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(u,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"ratio",type:"number",domain:["auto","auto"],allowDecimals:!1,tickFormatter:r=>`${r}%`,label:{value:"Ratio Loups/Joueurs (%)",position:"insideBottom",offset:-5}}),e.jsx(m,{label:{value:"DurÃ©e Moyenne (jours)",angle:-90,position:"insideLeft"}}),e.jsx(p,{content:({active:r,payload:n})=>{if(r&&n&&n.length>0){const o=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Pourcentage de loups : ",o.ratio]})}),e.jsxs("div",{children:["DurÃ©e moyenne : ",o.moyenne," jours"]}),e.jsxs("div",{children:["Nombre de parties : ",o.parties]})]})}return null}}),e.jsx(R,{}),e.jsx(B,{type:"monotone",dataKey:"moyenne",name:"DurÃ©e Moyenne",stroke:"var(--chart-color-5)",activeDot:{r:8}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"DurÃ©e Moyenne par Camp Victorieux"}),e.jsx(d,{title:"DurÃ©e Moyenne par Camp Victorieux",children:e.jsx("div",{style:{height:300},children:e.jsx(h,{width:"100%",height:"100%",children:e.jsxs(x,{data:c,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(u,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(m,{label:{value:"DurÃ©e Moyenne (jours)",angle:-90,position:"insideLeft"}}),e.jsx(p,{content:({active:r,payload:n})=>{if(r&&n&&n.length>0){const o=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:o.camp})}),e.jsxs("div",{children:["DurÃ©e moyenne : ",o.moyenne," jours"]}),e.jsxs("div",{children:["Nombre de parties : ",o.parties]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsxs(j,{dataKey:"moyenne",name:"moyenne",isAnimationActive:!1,onClick:r=>{r&&r.camp&&i({campFilter:{selectedCamp:r.camp,campFilterMode:"wins-only"},fromComponent:"DurÃ©e Moyenne par Camp Victorieux"})},style:{cursor:"pointer"},children:[c.map(r=>e.jsx(b,{fill:g[r.camp]||v},`cell-${r.camp}`)),e.jsx(N,{dataKey:"moyenne",position:"top",formatter:r=>{const n=typeof r=="number"?r:Number(r);return isNaN(n)?"":`${n.toFixed(1)}j`},fill:"var(--text-primary)",fontSize:12})]})]})})})})]})]})]})}export{X as GameDurationInsights};
