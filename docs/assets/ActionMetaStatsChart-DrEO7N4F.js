import{r as L,j as e}from"./index-CzlnCdE0.js";import{a as Q}from"./baseStatsHook-D0szqeat.js";import{a as Z,g as _}from"./datasyncExport-BirWLS1z.js";import{F}from"./FullscreenChart-CLGClBjG.js";import{b as ee}from"./api-DVRtv9JY.js";import{R as G,T as V,a as D}from"./CategoricalChart-BWWDkf3y.js";import{B as q,a as z}from"./BarChart-nLMBq0aS.js";import{C as I,X as K,Y as $}from"./CartesianChart-Dubm-Vi4.js";import{R as O}from"./ReferenceLine-Dtr94fBK.js";import"./CartesianScaleHelper-B5QcuZLv.js";function X(a){if(!a)return null;const p=a.match(/\d+/);return p?parseInt(p[0],10):null}function Y(a){const p=Z(a.MainRoleInitial,a.MainRoleChanges||[]);return _(p,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1},a.Power)}function se(a,p){return a.filter(x=>x.ActionType===p)}function te(a,p){const x=se(a,p);return x.length===0?null:x.sort((f,w)=>new Date(f.Date).getTime()-new Date(w.Date).getTime())[0]}function ie(a){const p=a.filter(i=>i.Modded),x=new Map,f=new Map,w=new Map,y=new Map;let M=0,P=0;p.forEach(i=>{let s=!1;i.PlayerStats.forEach(r=>{const c=Y(r),d=r.Victorious,m=r.Actions||[];if(m.length>0&&(s=!0,M+=m.length),m.filter(o=>o.ActionType==="UseGadget"&&o.ActionName&&o.ActionName!=="Balle").forEach(o=>{const h=o.ActionName;x.has(h)||x.set(h,{uses:0,wins:0,camp:new Map});const u=x.get(h);u.uses++,d&&u.wins++,u.camp.has(c)||u.camp.set(c,{uses:0,wins:0});const g=u.camp.get(c);g.uses++,d&&g.wins++}),m.filter(o=>o.ActionType==="DrinkPotion"&&o.ActionName).forEach(o=>{const h=o.ActionName;f.has(h)||f.set(h,{uses:0,wins:0,camp:new Map});const u=f.get(h);u.uses++,d&&u.wins++,u.camp.has(c)||u.camp.set(c,{uses:0,wins:0});const g=u.camp.get(c);g.uses++,d&&g.wins++}),r.MainRoleInitial==="Loup"||r.MainRoleInitial==="TraÃ®tre"||r.MainRoleInitial==="Louveteau"){const o=te(m,"Transform");if(o){const h=X(o.Timing);let u="N3+";h===1?u="N1":h===2&&(u="N2"),w.has(u)||w.set(u,{games:0,wins:0});const g=w.get(u);g.games++,d&&g.wins++}}m.filter(o=>o.ActionType==="UsePower"&&o.ActionName).forEach(o=>{const h=o.ActionName,u=X(o.Timing)||0,g=u<=2;y.has(h)||y.set(h,{uses:0,wins:0,timings:[],earlyUses:0,earlyWins:0,lateUses:0,lateWins:0});const v=y.get(h);v.uses++,d&&v.wins++,v.timings.push(u),g?(v.earlyUses++,d&&v.earlyWins++):(v.lateUses++,d&&v.lateWins++)})}),s&&P++});const j=new Map,b=new Map;let T=0,B=0;p.forEach(i=>{i.PlayerStats.forEach(s=>{const r=Y(s);T++,s.Victorious&&B++,b.has(r)||b.set(r,{wins:0,total:0});const c=b.get(r);c.total++,s.Victorious&&c.wins++})}),b.forEach((i,s)=>{j.set(s,i.total>0?i.wins/i.total*100:50)});const N=T>0?B/T*100:50,A=["Loup","TraÃ®tre","Louveteau"],S=["Villageois"],t=i=>{let s=0,r=0;return b.forEach((c,d)=>{i.includes(d)&&(s+=c.wins,r+=c.total)}),r>0?s/r*100:50},n=()=>{let i=0,s=0;return b.forEach((r,c)=>{!S.includes(c)&&!A.includes(c)&&(i+=r.wins,s+=r.total)}),s>0?i/s*100:50},l=t(S),U=t(A),C=n(),W=i=>{let s=0,r=0;i.forEach((g,v)=>{S.includes(v)&&(s+=g.uses,r+=g.wins)});const c=s>0?r/s*100:0;let d=0,m=0;i.forEach((g,v)=>{A.includes(v)&&(d+=g.uses,m+=g.wins)});const R=d>0?m/d*100:0;let o=0,h=0;i.forEach((g,v)=>{!S.includes(v)&&!A.includes(v)&&(o+=g.uses,h+=g.wins)});const u=o>0?h/o*100:0;return{villageois:{uses:s,wins:r,winRate:c,baselineWinRate:l,delta:c-l},loups:{uses:d,wins:m,winRate:R,baselineWinRate:U,delta:R-U},autres:{uses:o,wins:h,winRate:u,baselineWinRate:C,delta:u-C}}},E=Array.from(x.entries()).map(([i,s])=>{const r=s.uses>0?s.wins/s.uses*100:0,c=Array.from(s.camp.entries()).map(([d,m])=>{const R=m.uses>0?m.wins/m.uses*100:0,o=j.get(d)||50;return{camp:d,winRate:R,uses:m.uses,wins:m.wins,delta:R-o}});return{itemName:i,actionType:"UseGadget",totalUses:s.uses,winRate:r,wins:s.wins,losses:s.uses-s.wins,baselineWinRate:N,delta:r-N,campBreakdown:c,aggregatedCampStats:W(s.camp)}}).sort((i,s)=>s.totalUses-i.totalUses),k=Array.from(f.entries()).map(([i,s])=>{const r=s.uses>0?s.wins/s.uses*100:0,c=Array.from(s.camp.entries()).map(([d,m])=>{const R=m.uses>0?m.wins/m.uses*100:0,o=j.get(d)||50;return{camp:d,winRate:R,uses:m.uses,wins:m.wins,delta:R-o}});return{itemName:i,actionType:"DrinkPotion",totalUses:s.uses,winRate:r,wins:s.wins,losses:s.uses-s.wins,baselineWinRate:N,delta:r-N,campBreakdown:c,aggregatedCampStats:W(s.camp)}}).sort((i,s)=>s.totalUses-i.totalUses),H=["N1","N2","N3+"].map(i=>{const s=w.get(i)||{games:0,wins:0};return{timing:i,gamesCount:s.games,wins:s.wins,losses:s.games-s.wins,winRate:s.games>0?s.wins/s.games*100:0}}).filter(i=>i.gamesCount>0),J=Array.from(y.entries()).map(([i,s])=>{const r=s.timings.length>0?s.timings.reduce((c,d)=>c+d,0)/s.timings.length:0;return{powerName:i,totalUses:s.uses,averageTiming:r,winRate:s.uses>0?s.wins/s.uses*100:0,earlyUseWinRate:s.earlyUses>0?s.earlyWins/s.earlyUses*100:0,lateUseWinRate:s.lateUses>0?s.lateWins/s.lateUses*100:0}}).filter(i=>i.totalUses>=5).sort((i,s)=>s.totalUses-i.totalUses);return{gadgetStats:E,potionStats:k,wolfTransformTiming:H,powerUsageStats:J,overallStats:{totalGamesAnalyzed:p.length,totalActionsRecorded:M,averageActionsPerGame:p.length>0?M/p.length:0,gamesWithActions:P}}}function ne(){const{data:a,isLoading:p,error:x}=Q(ie);return{actionMetaStats:a,isLoading:p,error:x}}function he(){const{actionMetaStats:a,isLoading:p,error:x}=ne(),[f,w]=L.useState("gadgets"),[y,M]=L.useState("all"),P=ee(),j=10,b=L.useMemo(()=>a?a.gadgetStats.map(t=>{if(y==="all")return t.totalUses>=j?{name:t.itemName,delta:t.delta,winRate:t.winRate,uses:t.totalUses}:null;const n=t.aggregatedCampStats[y];return n.uses>=j?{name:t.itemName,delta:n.delta,winRate:n.winRate,uses:n.uses}:null}).filter(t=>t!==null).sort((t,n)=>n.uses-t.uses):[],[a,j,y]),T=L.useMemo(()=>a?a.potionStats.map(t=>{if(y==="all")return t.totalUses>=j?{name:t.itemName,delta:t.delta,winRate:t.winRate,uses:t.totalUses}:null;const n=t.aggregatedCampStats[y];return n.uses>=j?{name:t.itemName,delta:n.delta,winRate:n.winRate,uses:n.uses}:null}).filter(t=>t!==null).sort((t,n)=>n.uses-t.uses):[],[a,j,y]);if(p)return e.jsx("div",{className:"lycans-chargement",children:"Chargement des statistiques d'actions..."});if(x)return e.jsxs("div",{className:"lycans-erreur",children:["Erreur: ",x]});if(!a)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"});const B=()=>e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"ðŸŽ® Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.overallStats.totalGamesAnalyzed}),e.jsx("p",{children:"parties moddÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"âš¡ Actions totales"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.overallStats.totalActionsRecorded}),e.jsxs("p",{children:[a.overallStats.averageActionsPerGame.toFixed(1)," par partie"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"ï¿½ðŸ”§ Gadgets uniques"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.gadgetStats.length}),e.jsx("p",{children:"types diffÃ©rents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"ðŸ§ª Potions uniques"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.potionStats.length}),e.jsx("p",{children:"types diffÃ©rents"})]})]}),N=()=>b.length===0?e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucun gadget avec au moins ",j," utilisations."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"RÃ©duisez le filtre d'utilisations minimales pour voir plus de donnÃ©es."})]}):e.jsxs(F,{title:"Impact des Gadgets sur le Taux de Victoire",children:[e.jsx("div",{style:{height:Math.max(400,b.length*30)},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(q,{data:b,layout:"vertical",margin:{top:20,right:100,left:150,bottom:20},children:[e.jsx(I,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(K,{type:"number",label:{value:"DiffÃ©rence du taux de victoire (%)",position:"bottom",style:{textAnchor:"middle"}},domain:[-20,20],tickFormatter:t=>Math.round(t).toString()}),e.jsx($,{type:"category",dataKey:"name",width:140,tick:{fontSize:12}}),e.jsx(O,{x:0,stroke:"var(--text-secondary)",strokeWidth:2}),e.jsx(V,{content:({active:t,payload:n})=>{if(t&&n&&n.length>0){const l=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:l.name})}),e.jsxs("div",{children:["Taux de victoire: ",l.winRate.toFixed(1),"%"]}),e.jsxs("div",{children:["Impact: ",l.delta>0?"+":"",l.delta.toFixed(1),"%"]}),e.jsxs("div",{children:["Utilisations: ",l.uses]})]})}return null}}),e.jsx(z,{dataKey:"delta",shape:t=>{const{x:n,y:l,width:U,height:C,payload:W}=t,k=W.delta>0?"var(--success-color, #82ca9d)":"var(--danger-color, #ff6b6b)";return e.jsx(D,{x:n,y:l,width:U,height:C,fill:k})}})]})})}),e.jsxs("div",{style:{marginTop:20,fontSize:"0.85rem",color:"var(--text-secondary)"},children:[e.jsx("p",{children:"ðŸ’¡ Les valeurs positives indiquent que l'utilisation du gadget est corrÃ©lÃ©e Ã  un taux de victoire supÃ©rieur Ã  la moyenne."}),e.jsx("p",{children:"Les valeurs nÃ©gatives suggÃ¨rent une corrÃ©lation avec un taux de victoire infÃ©rieur."})]})]}),A=()=>T.length===0?e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune potion avec au moins ",j," utilisations."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"RÃ©duisez le filtre d'utilisations minimales pour voir plus de donnÃ©es."})]}):e.jsxs(F,{title:"Impact des Potions sur le Taux de Victoire",children:[e.jsx("div",{style:{height:Math.max(400,T.length*30)},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(q,{data:T,layout:"vertical",margin:{top:20,right:100,left:150,bottom:20},children:[e.jsx(I,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(K,{type:"number",label:{value:"DiffÃ©rence du taux de victoire (%)",position:"bottom",style:{textAnchor:"middle"}},domain:[-20,20],tickFormatter:t=>Math.round(t).toString()}),e.jsx($,{type:"category",dataKey:"name",width:140,tick:{fontSize:12}}),e.jsx(O,{x:0,stroke:"var(--text-secondary)",strokeWidth:2}),e.jsx(V,{content:({active:t,payload:n})=>{if(t&&n&&n.length>0){const l=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:l.name})}),e.jsxs("div",{children:["Taux de victoire: ",l.winRate.toFixed(1),"%"]}),e.jsxs("div",{children:["Impact: ",l.delta>0?"+":"",l.delta.toFixed(1),"%"]}),e.jsxs("div",{children:["Utilisations: ",l.uses]})]})}return null}}),e.jsx(z,{dataKey:"delta",shape:t=>{const{x:n,y:l,width:U,height:C,payload:W}=t,k=W.delta>0?"var(--success-color, #82ca9d)":"var(--danger-color, #ff6b6b)";return e.jsx(D,{x:n,y:l,width:U,height:C,fill:k})}})]})})}),e.jsxs("div",{style:{marginTop:20,fontSize:"0.85rem",color:"var(--text-secondary)"},children:[e.jsx("p",{children:"ðŸ’¡ Les valeurs positives indiquent que l'utilisation de la potion est corrÃ©lÃ©e Ã  un taux de victoire supÃ©rieur Ã  la moyenne."}),e.jsx("p",{children:"Les valeurs nÃ©gatives suggÃ¨rent une corrÃ©lation avec un taux de victoire infÃ©rieur."})]})]}),S=()=>a.wolfTransformTiming.length===0?e.jsx("div",{className:"donnees-manquantes",children:e.jsx("p",{children:"Aucune donnÃ©e de transformation de loup disponible."})}):e.jsxs(F,{title:"Impact du Timing de PremiÃ¨re Transformation (Loups)",children:[e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(q,{data:a.wolfTransformTiming,margin:{top:20,right:30,left:60,bottom:60},children:[e.jsx(I,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(K,{dataKey:"timing",label:{value:"Timing de premiÃ¨re transformation",position:"bottom",offset:0}}),e.jsx($,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(V,{content:({active:t,payload:n})=>{if(t&&n&&n.length>0){const l=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Transformation en ",l.timing]})}),e.jsxs("div",{children:["Taux de victoire: ",l.winRate.toFixed(1),"%"]}),e.jsxs("div",{children:["Parties: ",l.gamesCount]}),e.jsxs("div",{children:["Victoires: ",l.wins," / DÃ©faites: ",l.losses]})]})}return null}}),e.jsx(z,{dataKey:"winRate",fill:P.Loup||"var(--wolf-color)"})]})})}),e.jsxs("div",{style:{marginTop:20,fontSize:"0.85rem",color:"var(--text-secondary)"},children:[e.jsx("p",{children:"ðŸº Analyse du moment de la premiÃ¨re transformation en loup et son impact sur les chances de victoire."}),e.jsx("p",{children:"N1 = Nuit 1, N2 = Nuit 2, N3+ = Nuit 3 ou plus tard"})]})]});return e.jsxs("div",{children:[B(),e.jsxs("div",{className:"lycans-submenu",children:[e.jsx("button",{type:"button",className:`lycans-submenu-btn ${f==="gadgets"?"active":""}`,onClick:()=>w("gadgets"),children:"ðŸ”§ Gadgets"}),e.jsx("button",{type:"button",className:`lycans-submenu-btn ${f==="potions"?"active":""}`,onClick:()=>w("potions"),children:"ðŸ§ª Potions"}),e.jsx("button",{type:"button",className:`lycans-submenu-btn ${f==="wolfTiming"?"active":""}`,onClick:()=>w("wolfTiming"),children:"ðŸº Timing Loups"})]}),(f==="gadgets"||f==="potions")&&e.jsx("div",{className:"lycans-controles-groupe",style:{marginBottom:"1rem"},children:e.jsxs("div",{className:"lycans-filtre-groupe",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-action",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-action",value:y,onChange:t=>M(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"villageois",children:"Camp Villageois"}),e.jsx("option",{value:"loups",children:"Camp Loups"}),e.jsx("option",{value:"autres",children:"Autres (Solo)"})]})]})}),e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[f==="gadgets"&&N(),f==="potions"&&A(),f==="wolfTiming"&&S()]})})]})}export{he as ActionMetaStatsChart};
