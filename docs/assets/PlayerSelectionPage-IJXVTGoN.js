import{a as _,r as T,g as U,k as se,u as H,j as e,c as ae,l as te}from"./index-BIu0yfGQ.js";import{u as B}from"./useJoueursData-BY_JwZMz.js";import{u as re}from"./baseStatsHook-3RQ8nwlO.js";import{g as ie}from"./gameUtils-CCGRmivF.js";import{g as le,a as ne,c as oe}from"./datasyncExport-D6_8Fmuy.js";import{u as J,g as ce,a as X,l as Q}from"./api-B0QD2rKW.js";import{d as de}from"./durationFormatters-Br-IfF5C.js";import{F as I,C as M,X as z,Y as G,B as W,a as E,b as L}from"./FullscreenChart-B6K353J1.js";import{R as A,T as q}from"./CategoricalChart-DyFKFi7y.js";import{L as ue,a as me}from"./LineChart-uD47VM6t.js";import{P as pe,a as he}from"./PieChart-dKGm-ERE.js";import{u as ge}from"./useDeathStatisticsFromRaw-CDDSom0M.js";import{R as Y}from"./ReferenceLine-ALg6TNJI.js";import{g as fe}from"./deathTypes-CGUOTngO.js";import"./ActivePoints-DFbYxW5Y.js";import"./PolarChart-CA-YPFv9.js";function xe(o){const{settings:y}=_(),{joueursData:C}=B(),[f,j]=T.useState(null),[x,w]=T.useState(!1),[g,l]=T.useState(null);T.useEffect(()=>{let p=!0;return(async()=>{try{w(!0),l(null);const a=y.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",r=await fetch(a);if(!r.ok)throw new Error(`Failed to load achievements: ${r.status} ${r.statusText}`);const i=await r.json();p&&j(i)}catch(a){p&&l(a instanceof Error?a.message:"Failed to load achievements")}finally{p&&w(!1)}})(),()=>{p=!1}},[y.dataSource]);const c=(()=>{if(!o||!f)return null;const n=C?.Players?.find(a=>a.Joueur===o)?.SteamID;return n?f.achievements[n]||null:(console.warn(`âš ï¸ No Steam ID found for player: ${o}`),null)})();return T.useEffect(()=>{if(o&&f&&C){const n=C.Players?.find(r=>r.Joueur===o)?.SteamID;if(!n){console.log(`âŒ No Steam ID found for player: ${o}`);return}const a=f.achievements[n];a?console.log(`ðŸ† Achievements for ${o} [ID: ${n}] (${y.dataSource}):`,{allGames:a.allGamesAchievements.length,moddedOnly:a.moddedOnlyAchievements.length,categories:[...new Set([...a.allGamesAchievements.map(r=>r.category),...a.moddedOnlyAchievements.map(r=>r.category)])]}):console.log(`âŒ No achievements found for ${o} [ID: ${n}] in ${y.dataSource} data source`)}},[o,f,C,y.dataSource]),{data:c,isLoading:x,error:g,metadata:{generatedAt:f?.generatedAt||null,totalPlayers:f?.totalPlayers||0,totalGames:f?.totalGames||0,totalModdedGames:f?.totalModdedGames||0}}}function ve(o,y,C){if(!o||o.trim()===""||y.length===0)return null;const f=[];let j=o;y.forEach(n=>{const a=n.PlayerStats.find(r=>U(r)===o||r.Username.toLowerCase()===o.toLowerCase());if(a){j=a.Username;const r=le(ne(a.MainRoleInitial,a.MainRoleChanges||[]));if(C&&C!=="Tous les camps"&&r!==C)return;const i=ie(n),h=a.Victorious,d=se(new Date(n.StartDate)),b=oe(n.StartDate,n.EndDate)||0;f.push({gameId:n.Id,date:d,camp:r,won:h,winnerCamp:i,playersInGame:n.PlayerStats.length,mapName:n.MapName,duration:b})}}),f.sort((n,a)=>{const r=i=>{const h=i.split("/");return h.length===3?new Date(parseInt(h[2]),parseInt(h[1])-1,parseInt(h[0])):new Date(i)};return r(a.date).getTime()-r(n.date).getTime()});const x=f.length,w=f.filter(n=>n.won).length,g=x>0?(w/x*100).toFixed(2):"0.00",l={};f.forEach(n=>{l[n.camp]||(l[n.camp]={appearances:0,wins:0,winRate:"0.00"}),l[n.camp].appearances++,n.won&&l[n.camp].wins++}),Object.keys(l).forEach(n=>{const a=l[n];a.winRate=a.appearances>0?(a.wins/a.appearances*100).toFixed(2):"0.00"});const c={};f.forEach(n=>{c[n.mapName]||(c[n.mapName]={appearances:0,wins:0,winRate:"0.00"}),c[n.mapName].appearances++,n.won&&c[n.mapName].wins++}),Object.keys(c).forEach(n=>{const a=c[n];a.winRate=a.appearances>0?(a.wins/a.appearances*100).toFixed(2):"0.00"});const p=f.reduce((n,a)=>n+a.duration,0);return{playerName:j,totalGames:x,totalWins:w,winRate:g,totalPlayTime:p,games:f,campStats:l,mapStats:c}}function ye(o){const y={};let C=0,f=0;return Object.entries(o).forEach(([j,x])=>{j==="Village"||j==="ChÃ¢teau"?y[j]={...x}:(C+=x.appearances,f+=x.wins)}),C>=10&&(y.Autres={appearances:C,wins:f,winRate:C>0?(f/C*100).toFixed(2):"0.00"}),y}function O(o,y){const{data:C,isLoading:f,error:j}=re(x=>o?ve(o,x,y):null);return{data:C,isLoading:f,error:j}}function je({achievements:o,title:y,emptyMessage:C,achievementType:f="all"}){const{navigateToTab:j,updateNavigationState:x,clearNavigation:w}=H(),{settings:g,updateSettings:l}=_(),{joueursData:c}=B(),p=J(c),n=(s,S)=>{if(S.stopPropagation(),!s.redirectTo)return;w();const F=g.highlightedPlayer;if(l(f==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:F,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:F,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),s.category==="comparison"&&s.redirectTo.subTab==="comparison"){const u=g.highlightedPlayer||"",m=a(s.description,u);m&&x({playerComparisonState:{selectedPlayer1:u,selectedPlayer2:m,showDetailedStats:!0}})}if(s.category==="comparison"&&s.redirectTo.subTab==="pairing"){const u=s.description.toLowerCase().includes("loup");x({selectedPairingTab:u?"wolves":"lovers"})}if(s.category==="kills"&&s.redirectTo.subTab==="deathStats"){const u=s.description.match(/(Villageois|Loups|Autres)/i);u&&x({deathStatsSelectedCamp:u[1]});let m=10;const t=s.description.match(/min\.\s*(\d+)/);t&&(m=parseInt(t[1],10));let v="totalKills",N="killers";const k=s.redirectTo.chartSection;k&&(k==="killers-total"?(v="totalKills",N="killers"):k==="killers-average"?(v="averageKills",N="killers"):k==="deaths-total"?(v="totalDeaths",N="deaths"):k==="survivors-average"?(v="survivalRate",N="deaths"):(k==="hunters-good"||k==="hunters-bad")&&(N="hunter",v="averageKills")),x({deathStatisticsState:{selectedCamp:u?.[1]||"Tous les camps",minGamesForAverage:m,selectedView:N,focusChart:v}})}if(s.category==="map"&&s.redirectTo.subTab==="playersGeneral"){const u=s.redirectTo.mapFilter||"all";let m=10;const t=s.description.match(/min\.\s*(\d+)/);t&&(m=parseInt(t[1])),l(f==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:u,playerFilter:{mode:"none",players:[]},highlightedPlayer:F,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:u,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:u,playerFilter:{mode:"none",players:[]},highlightedPlayer:F,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:u,playerFilter:{mode:"none",players:[]}}}),x({playersGeneralState:{minGamesForWinRate:m,winRateOrder:"best",focusChart:"winRate"}}),j("players","playersGeneral");return}if(s.category==="history"&&s.redirectTo.subTab==="history"&&x({selectedPlayerName:g.highlightedPlayer||"",groupingMethod:"session"}),s.category==="series"&&s.redirectTo.subTab==="series"){let u="wins";const m=s.title.toLowerCase(),t=s.description.toLowerCase();m.includes("dÃ©faite")||t.includes("dÃ©faite")?u="losses":m.includes("loup")||t.includes("loup")?u="loup":m.includes("villageois")||t.includes("villageois")?u="villageois":(m.includes("victoire")||t.includes("victoire"))&&(u="wins"),x({selectedSeriesType:u})}if(s.category==="general"&&s.redirectTo.subTab==="playersGeneral"){let u=10;const m=s.description.match(/min\.\s*(\d+)/);m&&(u=parseInt(m[1],10));let t="winRate",v="best";const N=s.title.toLowerCase(),k=s.description.toLowerCase();N.includes("participation")||k.includes("participation")?t="participation":(N.includes("taux de victoire")||k.includes("taux de victoire"))&&(t="winRate",(N.includes("moins bon")||N.includes("mauvais")||k.includes("moins bon")||k.includes("mauvais"))&&(v="worst")),x({playersGeneralState:{minGamesForWinRate:u,winRateOrder:v,focusChart:t}})}if(s.category==="performance"&&s.redirectTo.subTab==="campPerformance"){const u=s.redirectTo.chartSection;let m="Villageois",t=1;u&&(u==="camp-loup"?m="Loup":u==="camp-villageois"?m="Villageois":u==="camp-idiot"?m="Idiot du Village":u==="camp-amoureux"?m="Amoureux":(u==="solo-roles"||u==="hall-of-fame")&&(m="Villageois"));const v=s.description.match(/min\.\s*(\d+)/);v&&(t=parseInt(v[1],10)),u==="solo-roles"?m="RÃ´les spÃ©ciaux":u==="hall-of-fame"&&(m="Tous les camps"),x({campPerformanceState:{selectedCampPerformanceCamp:m,selectedCampPerformanceMinGames:t}})}if(s.category==="voting"&&s.redirectTo.subTab==="votingStats"){const u=s.title.toLowerCase();let m="overview",t="behavior";u.includes("agressivitÃ©")?(m="overview",t="behavior"):u.includes("taux de vote")?(m="behavior",t="voteRate"):u.includes("prÃ©cision")&&(m="overview",t="accuracy"),x({votingStatsState:{selectedCategory:m,selectedView:t}})}j(s.redirectTo.tab,s.redirectTo.subTab)},a=(s,S)=>{const F=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const u of F){const m=s.match(u);if(m&&m[1]){const t=m[1].trim();if(t!==S)return t}}return null},r=s=>{if(!s.redirectTo)return"Aucune navigation disponible";switch(s.category){case"general":if(s.redirectTo.subTab==="playersGeneral"){const u=s.description.match(/min\.\s*(\d+)/),m=u?parseInt(u[1],10):10,t=s.title.toLowerCase(),v=f==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return t.includes("taux de victoire")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${m} parties)${v}`:t.includes("participation")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir les participations${v}`:`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${v}`}break;case"map":if(s.redirectTo.subTab==="playersGeneral"){const u=s.redirectTo.mapFilter,m=u==="village"?"Village":u==="chateau"?"ChÃ¢teau":"map",t=f==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${m}${t}`}break;case"history":if(s.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(s.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${a(s.description,g.highlightedPlayer||"")||"ce joueur"}`;if(s.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(s.redirectTo.subTab==="deathStats"){const u=s.description.match(/(Villageois|Loups|Autres)/i),m=s.description.match(/min\.\s*(\d+)/),t=m?parseInt(m[1],10):10,v=u?.[1]||"Tous les camps",N=s.redirectTo.chartSection;let k="kills et morts";return N==="killers-total"?k="total des kills":N==="killers-average"?k=`moyenne des kills (min. ${t} parties)`:N==="deaths-total"?k="total des morts":N==="survivors-average"&&(k=`taux de survie (min. ${t} parties)`),`Cliquez pour voir les statistiques de ${k} ${v!=="Tous les camps"?`en ${v}`:""}`}break;case"series":if(s.redirectTo.subTab==="series"){const u=s.title.toLowerCase(),m=s.description.toLowerCase();return u.includes("dÃ©faite")||m.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":u.includes("loup")||m.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":u.includes("villageois")||m.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":u.includes("victoire")||m.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(s.redirectTo.subTab==="campPerformance"){const u=s.redirectTo.chartSection,m=f==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return u==="camp-loup"?`Cliquez pour voir les performances camp Loup${m}`:u==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${m}`:u==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${m}`:u==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${m}`:u==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${m}`:u==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${m}`:`Cliquez pour voir les performances par camp${m}`}break;case"voting":if(s.redirectTo.subTab==="votingStats"){const u=s.description.match(/min\.\s*(\d+)/),m=u?parseInt(u[1],10):25,t=f==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",v=s.title.toLowerCase();return v.includes("agressivitÃ©")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${m} meetings)${t}`:v.includes("taux de vote")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${m} meetings)${t}`:v.includes("prÃ©cision")?`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${t}`:`Classement: ${s.rank}${s.totalRanked?`/${s.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${t}`}break}return`Cliquez pour voir ${s.redirectTo.subTab}`+(f==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},i=s=>p[s]||ce(s),h=s=>{const S=[/avec ([^:]+?):/,/contre ([^:]+?):/];let F=s;return S.forEach(u=>{const m=s.match(u);if(m&&m[1]){const t=m[1].trim(),N=`<span class="player-name-highlight" style="color: ${i(t)};">${t}</span>`;F=F.replace(t,N)}}),F};if(o.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:y}),e.jsx("p",{children:C||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const d=s=>s===1?"ðŸ¥‡":s===2?"ðŸ¥ˆ":s===3?"ðŸ¥‰":"",b=s=>s===1?"rank-1":s===2?"rank-2":s===3?"rank-3":s&&s<=10?"rank-top-10":"",R=o.filter(s=>s.category!=="comparison"&&(s.type==="good"||s.type==="neutral")).sort((s,S)=>(s.rank??999)-(S.rank??999)),$=o.filter(s=>s.category!=="comparison"&&s.type==="bad").sort((s,S)=>(s.rank??999)-(S.rank??999)),D=o.filter(s=>s.category==="comparison"),K=R.filter(s=>s.rank&&s.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:y}),K>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:R.filter(s=>s.rank&&s.rank<=3).map((s,S)=>e.jsxs("div",{className:`top3-card ${b(s.rank)} animate-slide-in`,style:{animationDelay:`${S*.15}s`},onClick:F=>n(s,F),title:r(s),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:d(s.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",s.rank,s.totalRanked?`/${s.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:s.title}),e.jsx("p",{className:"top3-achievement-description",children:s.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},s.id))})]}),R.length>0&&e.jsxs("div",{className:"achievements-section good-achievements",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:R.filter(s=>!s.rank||s.rank>3).map((s,S)=>e.jsxs("div",{className:`achievement-card good ${b(s.rank)}`,onClick:F=>n(s,F),title:r(s),style:{animationDelay:`${S*.05}s`},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:s.title}),e.jsxs("span",{className:"achievement-rank",children:["#",s.rank,s.totalRanked?`/${s.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:s.description})]},s.id))})]}),$.length>0&&e.jsxs("div",{className:"achievements-section bad-achievements",children:[e.jsx("h5",{children:"ðŸ’€ Classements (InversÃ©s)"}),e.jsx("div",{className:"achievements-grid",children:$.map(s=>e.jsxs("div",{className:`achievement-card bad rank-${s.rank}`,onClick:S=>n(s,S),title:r(s),children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:s.title}),e.jsxs("span",{className:"achievement-rank",children:["#",s.rank,s.totalRanked?`/${s.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:s.description})]},s.id))})]}),D.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:D.map(s=>e.jsxs("div",{className:"achievement-card comparison",onClick:S=>n(s,S),title:r(s),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:s.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:h(s.description)}})]},s.id))})]})]})}function be({selectedPlayerName:o,groupingMethod:y,campFilter:C="all"}){const{navigateToGameDetails:f}=H(),{data:j,isLoading:x,error:w}=O(o),g=T.useMemo(()=>{switch(y){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[y]),l=T.useMemo(()=>{if(!j?.games)return new Map;const a=new Map;return j.games.forEach(r=>{if(!a.has(r.date)){const i=r.date.split("/");i.length===3?a.set(r.date,new Date(parseInt(i[2]),parseInt(i[1])-1,parseInt(i[0])).getTime()):a.set(r.date,new Date(r.date).getTime())}}),a},[j?.games]),c=T.useMemo(()=>{if(!j?.games)return[];const a={};return j.games.forEach(r=>{if(C!=="all"){if(C==="solo"){if(r.camp==="Villageois"||r.camp==="Loup")return}else if(r.camp!==C)return}let i;const h=r.date.split("/");if(y==="month")if(h.length===3)i=`${h[1].padStart(2,"0")}/${h[2]}`;else{const d=new Date(r.date);i=`${String(d.getMonth()+1).padStart(2,"0")}/${d.getFullYear()}`}else if(y==="quarter")if(h.length===3){const d=parseInt(h[1],10);i=`T${Math.floor((d-1)/3)+1}/${h[2]}`}else{const d=new Date(r.date);i=`T${Math.floor(d.getMonth()/3)+1}/${d.getFullYear()}`}else y==="year"?h.length===3?i=`${h[2]}`:i=`${new Date(r.date).getFullYear()}`:i=r.date;a[i]||(a[i]={games:[],wins:0,total:0}),a[i].games.push(r),a[i].total++,r.won&&a[i].wins++}),Object.entries(a).map(([r,i])=>({period:r,totalGames:i.total,victories:i.wins,defeats:i.total-i.wins,winRate:i.total>0?(i.wins/i.total*100).toFixed(1):"0.0",winRateNum:i.total>0?i.wins/i.total*100:0})).sort((r,i)=>{if(y==="month"){const[h,d]=r.period.split("/"),[b,R]=i.period.split("/"),$=new Date(parseInt(d),parseInt(h)-1,1),D=new Date(parseInt(R),parseInt(b)-1,1);return $.getTime()-D.getTime()}else if(y==="quarter"){const[h,d]=r.period.split("/"),[b,R]=i.period.split("/"),$=parseInt(h.replace(/\D/g,""),10)||1,D=parseInt(b.replace(/\D/g,""),10)||1,K=new Date(parseInt(d,10),($-1)*3,1),s=new Date(parseInt(R,10),(D-1)*3,1);return K.getTime()-s.getTime()}else if(y==="year"){const h=parseInt(r.period,10),d=parseInt(i.period,10);return h-d}else{const h=l.get(r.period)||0,d=l.get(i.period)||0;return h-d}})},[j,y,l,C]),n=(a=>a<=15?{fontSize:12,angle:-45,height:80,interval:0}:a<=30?{fontSize:12,angle:-45,height:85,interval:1}:a<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(a/12)})(c.length);return x?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):w?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",w]}):j?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",g]}),e.jsx(I,{title:`Ã‰volution des Performances ${g}`,children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(ue,{data:c,margin:{top:20,right:30,left:20,bottom:20},onClick:a=>{if(a&&a.activeLabel){const r=c.find(i=>i.period===a.activeLabel);r&&f({selectedPlayer:o,selectedDate:r.period,fromComponent:`Ã‰volution des Performances ${g}`})}},style:{cursor:"pointer"},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"period",angle:n.angle,textAnchor:"end",height:n.height,interval:n.interval,fontSize:n.fontSize}),e.jsx(G,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(q,{content:({active:a,payload:r})=>{if(a&&r&&r.length>0){const i=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:i.period})}),e.jsxs("div",{children:["Parties: ",i.totalGames]}),e.jsxs("div",{children:["Victoires: ",i.victories]}),e.jsxs("div",{children:["Taux: ",i.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(me,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",g]}),e.jsx(I,{title:`RÃ©partition Victoires/DÃ©faites ${g}`,children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(W,{data:c,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"period",angle:n.angle,textAnchor:"end",height:n.height,interval:n.interval,fontSize:n.fontSize}),e.jsx(G,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(q,{content:({active:a,payload:r})=>{if(a&&r&&r.length>0){const i=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:i.period})}),e.jsxs("div",{children:["Total: ",i.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",i.victories]}),e.jsxs("div",{children:["DÃ©faites: ",i.defeats]}),e.jsxs("div",{children:["Taux: ",i.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(E,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:c.map((a,r)=>e.jsx(L,{fill:"var(--accent-tertiary)",onClick:()=>{f({selectedPlayer:o,selectedDate:a.period,fromComponent:`Historique Joueur - Victoires ${g}`})},style:{cursor:"pointer"}},`cell-victories-${r}`))}),e.jsx(E,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:c.map((a,r)=>e.jsx(L,{fill:"var(--chart-color-4)",onClick:()=>{f({selectedPlayer:o,selectedDate:a.period,fromComponent:`Historique Joueur - DÃ©faites ${g}`})},style:{cursor:"pointer"}},`cell-defeats-${r}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function Ce({selectedPlayerName:o}){const{navigateToGameDetails:y}=H(),{data:C,isLoading:f,error:j}=O(o),x=X(),w=T.useMemo(()=>C?.campStats?Object.entries(C.campStats).map(([l,c])=>({name:l,value:c.appearances,winRate:c.winRate,winRateDisplay:Math.max(parseFloat(c.winRate),1),wins:c.wins,percentage:(c.appearances/C.totalGames*100).toFixed(1)})):[],[C]),g=T.useMemo(()=>{if(!w.length)return[];const l=5;let c=0;const p=[],n=[];if(w.forEach(a=>{parseFloat(a.percentage)<l?(c+=Number(a.value),p.push(a)):n.push(a)}),c>0){const a=w.reduce((r,i)=>r+Number(i.value),0);n.push({name:"Autres",value:c,winRate:"0.0",winRateDisplay:1,wins:p.reduce((r,i)=>r+i.wins,0),percentage:(c/a*100).toFixed(1),_details:p})}return n},[w]);return f?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):j?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",j]}):C?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(pe,{children:[e.jsx(he,{data:g,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:l=>{const c=l.percent!==void 0?l.percent:0;return l.name==="Autres"?`Autres : ${l.value} (${(c*100).toFixed(1)}%)`:`${l.name}: ${l.value} (${(c*100).toFixed(1)}%)`},children:g.map((l,c)=>e.jsx(L,{fill:l.name==="Autres"?Q:x[l.name]||`var(--chart-color-${c%6+1})`,onClick:()=>{if(l.name==="Autres"){const p=l._details?.map(n=>n.name)||[];y({selectedPlayer:o,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:p},fromComponent:"Distribution par Camps"})}else l.name==="TraÃ®tre"||l.name==="Louveteau"?y({selectedPlayer:o,campFilter:{selectedCamp:l.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):l.name==="Loup"?y({selectedPlayer:o,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):y({selectedPlayer:o,campFilter:{selectedCamp:l.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${c}`))}),e.jsx(q,{content:({active:l,payload:c})=>{if(l&&c&&c.length>0){const p=c[0].payload;if(p.name==="Autres"&&p._details){const n=[...p._details].sort((a,r)=>r.value-a.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",p.value," parties (",p.percentage,"%)"]})}),e.jsx("div",{children:n.map((a,r)=>e.jsxs("div",{children:[a.name,": ",a.value," parties (",a.percentage,"%)"]},r))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[p.name," - ",p.value," parties (",p.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(I,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(W,{data:w,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(G,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(q,{content:({active:l,payload:c})=>{if(l&&c&&c.length>0){const p=c[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:p.name})}),e.jsxs("div",{children:["Victoires: ",p.wins," / ",p.value]}),e.jsxs("div",{children:["Taux: ",p.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(E,{dataKey:"winRateDisplay",children:w.map((l,c)=>e.jsx(L,{fill:parseFloat(l.winRate)===0?`${x[l.name]||`var(--chart-color-${c%6+1})`}50`:x[l.name]||`var(--chart-color-${c%6+1})`,onClick:()=>{l.name==="TraÃ®tre"||l.name==="Louveteau"?y({selectedPlayer:o,campFilter:{selectedCamp:l.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):l.name==="Loup"?y({selectedPlayer:o,campFilter:{selectedCamp:l.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):y({selectedPlayer:o,campFilter:{selectedCamp:l.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${c}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function Ne({selectedPlayerName:o}){const{navigateToGameDetails:y,navigationState:C,updateNavigationState:f}=H(),[j,x]=T.useState(C.playerHistoryMapState?.selectedCamp||"Tous les camps"),{data:w}=ge(),{data:g,isLoading:l,error:c}=O(o,j);T.useEffect(()=>{(!C.playerHistoryMapState||C.playerHistoryMapState.selectedCamp!==j)&&f({playerHistoryMapState:{selectedCamp:j}})},[j,C.playerHistoryMapState,f]);const p=a=>{x(a),f({playerHistoryMapState:{selectedCamp:a}})},n=T.useMemo(()=>{if(!g?.mapStats)return[];const a=ye(g.mapStats);return Object.entries(a).map(([r,i])=>({name:r,value:i.appearances,winRate:i.winRate,winRateDisplay:Math.max(parseFloat(i.winRate),.1),wins:i.wins,percentage:(i.appearances/g.totalGames*100).toFixed(1)}))},[g]);return l?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):c?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",c]}):g?n.length===0?e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de carte disponible"}),e.jsx("p",{children:"Aucune statistique de carte n'est disponible pour ce joueur."})]}):e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Performance par Carte",j!=="Tous les camps"?` (${j})`:""]}),e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select-map",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select-map",value:j,onChange:a=>p(a.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),w?.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsx(I,{title:"Performance par Carte",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(W,{data:n,margin:{top:20,right:140,left:20,bottom:20},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(G,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(Y,{y:50,stroke:"var(--text-secondary)",strokeDasharray:"5 5",strokeOpacity:.5}),(()=>{if(n.length>0){const a=n.reduce((h,d)=>h+d.value,0),r=n.reduce((h,d)=>h+d.wins,0),i=a>0?r/a*100:0;if(i!==50)return e.jsx(Y,{y:i,stroke:"var(--accent-primary)",strokeDasharray:"3 3",strokeOpacity:.7,label:{value:`Moyenne: ${i.toFixed(1)}%`,position:"right",offset:5,style:{fill:"var(--accent-primary)"}}})}return null})(),e.jsx(q,{content:({active:a,payload:r})=>{if(a&&r&&r.length>0){const i=r[0].payload,h=[];return n.forEach(d=>{if(d.name!==i.name&&d.value>=5){const b=parseFloat(i.winRate)-parseFloat(d.winRate);Math.abs(b)>=2&&h.push({map:d.name,diff:b,better:b>0})}}),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:"250px"},children:[e.jsx("div",{children:e.jsx("strong",{children:i.name})}),e.jsxs("div",{children:["Parties: ",i.value]}),e.jsxs("div",{children:["Victoires: ",i.wins]}),e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("strong",{children:["Taux: ",i.winRate,"%"]})}),h.length>0&&e.jsxs("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"0.8rem",fontWeight:"bold",marginBottom:"0.25rem"},children:"Comparaisons:"}),h.map((d,b)=>e.jsxs("div",{style:{fontSize:"0.75rem",color:d.better?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[d.better?"â†—":"â†˜"," ",Math.abs(d.diff).toFixed(1),"% vs ",d.map]},b))]}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(E,{dataKey:"winRateDisplay",label:a=>{const{x:r,y:i,width:h,payload:d}=a;if(r===void 0||i===void 0||h===void 0||!d)return null;const b=d.winRate||"0";return e.jsxs("text",{x:r+h/2,y:i-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[b,"%"]})},onClick:a=>{if(a&&a.name){const r={selectedPlayer:o,selectedMapName:a.name,fromComponent:"Performance par Carte"};j!=="Tous les camps"&&(r.campFilter={selectedCamp:j,campFilterMode:"all-assignments"}),y(r)}},children:n.map((a,r)=>{let i;a.name==="Village"?i="var(--accent-secondary)":a.name==="ChÃ¢teau"?i="var(--accent-tertiary)":a.name==="Autres"?i=Q:i=`var(--chart-color-${r%6+1})`;const h=Math.max(...n.map(b=>parseFloat(b.winRate))),d=parseFloat(a.winRate)===h&&h>0;return e.jsx(L,{fill:parseFloat(a.winRate)===0?`${i}30`:i,stroke:"transparent",strokeWidth:d?3:1,style:{cursor:"pointer"}},`cell-map-${r}`)})})]})})})})]})}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function ke({selectedPlayerName:o}){const{gameData:y}=ae(),{joueursData:C}=B(),f=J(C),j=X(),x=T.useMemo(()=>{if(!y||!o)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const g={},l={},c={},p=new Set;y.forEach(h=>{const d=h.PlayerStats.find(b=>b.Username.toLowerCase()===o.toLowerCase());if(d&&(h.PlayerStats.forEach(b=>{b.KillerName?.toLowerCase()===o.toLowerCase()&&(g[b.Username]=(g[b.Username]||0)+1)}),d.KillerName&&(l[d.KillerName]=(l[d.KillerName]||0)+1),d.DeathType)){const b=d.DeathType,R=fe(b);c[R]||(c[R]={count:0,byDeathType:{}}),c[R].count+=1,c[R].byDeathType[b]=(c[R].byDeathType[b]||0)+1,p.add(b)}});const n=Object.entries(g).map(([h,d])=>({player:h,kills:d})).sort((h,d)=>d.kills-h.kills).slice(0,10),a=Object.entries(l).map(([h,d])=>({player:h,kills:d})).sort((h,d)=>d.kills-h.kills).slice(0,10),r=Object.entries(c).map(([h,d])=>{const b={deathType:h,count:d.count};return b[h]=d.count,b}).sort((h,d)=>d.count-h.count).slice(0,10),i=Object.keys(c);return{playersKilled:n,killedBy:a,deathTypes:r,availableDeathTypes:i}},[y,o]),w=T.useMemo(()=>{const g={};x.availableDeathTypes.forEach(p=>{p==="TuÃ© par Loup"?g[p]=j.Loup:p==="Mort aux votes"?g[p]="var(--chart-color-1)":p.includes("Chasseur")?g[p]=j.Chasseur:p==="TuÃ© par Zombie"?g[p]=j.Vaudou:p==="TuÃ© par potion assassin"?g[p]=j.Alchimiste:p==="TuÃ© par Vengeur"?g[p]="var(--chart-color-2)":p==="Amoureux mort"?g[p]=j.Amoureux:p==="TuÃ© par La BÃªte"?g[p]="var(--chart-color-3)":p==="TuÃ© par ShÃ©rif"&&(g[p]="var(--chart-color-4)")});const l=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let c=0;return x.availableDeathTypes.forEach(p=>{g[p]||(g[p]=l[c%l.length],c++)}),g},[x.availableDeathTypes,j]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[x.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(I,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(W,{data:x.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(G,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(q,{content:({active:g,payload:l})=>{if(g&&l&&l.length>0){const c=l[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:c.player})}),e.jsxs("div",{children:["TuÃ© ",c.kills," fois par ",o]})]})}return null}}),e.jsx(E,{dataKey:"kills",children:x.playersKilled.map((g,l)=>e.jsx(L,{fill:f[g.player]||"var(--chart-color-3)"},`cell-killed-${l}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[o," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),x.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(I,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(W,{data:x.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(G,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(q,{content:({active:g,payload:l})=>{if(g&&l&&l.length>0){const c=l[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:c.player})}),e.jsxs("div",{children:["A tuÃ© ",o," ",c.kills," fois"]})]})}return null}}),e.jsx(E,{dataKey:"kills",children:x.killedBy.map((g,l)=>e.jsx(L,{fill:f[g.player]||"var(--chart-color-4)"},`cell-killer-${l}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[o," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),x.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(I,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(W,{data:x.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(G,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(q,{content:({active:g,payload:l})=>{if(g&&l&&l.length>0){const c=l[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:c.deathType})}),e.jsxs("div",{children:[o," est mort ",c.count," fois ainsi"]})]})}return null}}),x.availableDeathTypes.map(g=>e.jsx(E,{dataKey:g,name:g,stackId:"deaths",fill:w[g]||"var(--chart-color-5)"},g))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",o,"."]})]})]})}function We(){const{settings:o,updateSettings:y}=_(),{navigateToGameDetails:C}=H(),{data:f,isLoading:j,error:x}=te(),{joueursData:w,isLoading:g}=B(),{data:l,isLoading:c,error:p}=xe(o.highlightedPlayer),n=J(w),[a,r]=T.useState(""),[i,h]=T.useState(()=>o.useIndependentFilters&&o.independentFilters?.gameTypeEnabled?o.independentFilters.gameFilter==="modded"?"modded":"all":o.gameFilter==="modded"?"modded":"all"),[d,b]=T.useState("achievements"),[R,$]=T.useState("session"),[D,K]=T.useState("all");T.useEffect(()=>{if(o.useIndependentFilters&&o.independentFilters?.gameTypeEnabled){const t=o.independentFilters.gameFilter==="modded"?"modded":"all";h(t)}else if(!o.useIndependentFilters){const t=o.gameFilter==="modded"?"modded":"all";h(t)}},[o.gameFilter,o.useIndependentFilters,o.independentFilters?.gameTypeEnabled,o.independentFilters?.gameFilter]);const{data:s}=O(o.highlightedPlayer||""),S=T.useMemo(()=>{if(!f||!f.GameStats)return[];const t=new Map;return f.GameStats.forEach(v=>{const N=new Date(v.StartDate);v.PlayerStats.forEach(k=>{const P=U(k),Z=w?.Players?.find(ee=>ee.SteamID===P)?.Joueur||k.Username;t.has(P)||t.set(P,{games:0,wins:0,firstDate:N,lastDate:N,displayName:Z});const V=t.get(P);V.games++,k.Victorious&&V.wins++,N<V.firstDate&&(V.firstDate=N),N>V.lastDate&&(V.lastDate=N)})}),Array.from(t.entries()).map(([v,N])=>{let k=w?.Players?.find(P=>P.SteamID===v);return k||(k=w?.Players?.find(P=>P.Joueur===N.displayName)),{id:v,name:N.displayName,totalGames:N.games,totalWins:N.wins,winRate:N.games>0?N.wins/N.games*100:0,firstGameDate:N.firstDate.toLocaleDateString("fr-FR"),lastGameDate:N.lastDate.toLocaleDateString("fr-FR"),isHighlighted:N.displayName===o.highlightedPlayer,image:k?.Image||null,twitch:k?.Twitch||null,youtube:k?.Youtube||null}})},[f,o.highlightedPlayer,w]),F=T.useMemo(()=>{if(!a.trim())return S;const t=a.toLowerCase();return S.filter(v=>v.name.toLowerCase().includes(t))},[S,a]),u=T.useMemo(()=>[...F].sort((t,v)=>v.totalGames-t.totalGames),[F]),m=t=>{y({highlightedPlayer:t}),r("")};return j||g?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):x?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",x]})]}):!f||S.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!o.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:a,onChange:t=>r(t.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[F.length," joueur",F.length!==1?"s":"",a&&` (filtrÃ©${F.length!==1?"s":""} de ${S.length})`]})]})]}),e.jsx("div",{className:"player-display",children:a?F.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{className:"clear-search-btn",onClick:()=>r(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:u.map(t=>e.jsxs("button",{className:`suggestion-btn ${t.isHighlighted?"highlighted":""}`,onClick:()=>m(t.name),children:[t.image?e.jsx("img",{src:t.image,alt:t.name,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":n[t.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[t.name,t.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[t.totalGames," parties â€¢ ",t.winRate.toFixed(1),"% victoires"]})]})]},t.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',a,'"']}),e.jsx("button",{className:"clear-search-btn",onClick:()=>r(""),children:"Effacer la recherche"})]}):o.highlightedPlayer?(()=>{const t=S.find(v=>v.name===o.highlightedPlayer);return t?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:t.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[t.image?e.jsx("img",{src:t.image,alt:t.name,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":n[t.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[t.totalGames," parties â€¢ ",t.totalWins," victoires â€¢ ",t.winRate.toFixed(1),"% taux de victoire"]}),(t.twitch||t.youtube)&&e.jsxs("div",{className:"social-links",children:[t.twitch&&e.jsx("a",{href:t.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),t.youtube&&e.jsx("a",{href:t.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{className:`lycans-categorie-btn ${d==="achievements"?"active":""}`,onClick:()=>b("achievements"),children:"Classement"}),e.jsx("button",{className:`lycans-categorie-btn ${d==="evolution"?"active":""}`,onClick:()=>b("evolution"),children:"Ã‰volution"}),e.jsx("button",{className:`lycans-categorie-btn ${d==="camps"?"active":""}`,onClick:()=>b("camps"),children:"Camps"}),e.jsx("button",{className:`lycans-categorie-btn ${d==="maps"?"active":""}`,onClick:()=>b("maps"),children:"Maps"}),e.jsx("button",{className:`lycans-categorie-btn ${d==="kills"?"active":""}`,onClick:()=>b("kills"),children:"Kills"})]}),d==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[c?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):p?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",p]})}):l?e.jsx(je,{achievements:i==="all"?l.allGamesAchievements:l.moddedOnlyAchievements,title:i==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:i}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[e.jsx("button",{className:`filter-btn ${i==="all"?"active":""}`,onClick:v=>{v.stopPropagation(),h("all")},children:"Toutes les parties"}),e.jsx("button",{className:`filter-btn ${i==="modded"?"active":""}`,onClick:v=>{v.stopPropagation(),h("modded")},children:"Parties moddÃ©es"})]})]}),d==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[s&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{C({selectedPlayer:t.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${t.name}`,style:{fontSize:"1.3rem"},children:s.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem"},children:de(s.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{C({selectedPlayer:t.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${t.name}`,style:{fontSize:"1.3rem"},children:s.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem"},children:[s.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:R,onChange:v=>$(v.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:D,onChange:v=>K(v.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(be,{selectedPlayerName:t.name,groupingMethod:R,campFilter:D})]}),d==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Ce,{selectedPlayerName:t.name})}),d==="maps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Ne,{selectedPlayerName:t.name})}),d==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ke,{selectedPlayerName:t.name})}),e.jsx("button",{className:"highlight-btn active",onClick:v=>{v.stopPropagation(),y({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[t.firstGameDate," - ",t.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',o.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{className:"clear-selection-btn",onClick:()=>y({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:u.map(t=>e.jsxs("div",{className:`character-card ${t.isHighlighted?"highlighted":""}`,onClick:()=>m(t.name),title:`${t.name} - ${t.totalGames} parties, ${t.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:t.image?e.jsx("img",{src:t.image,alt:t.name,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":n[t.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:t.name}),(t.twitch||t.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[t.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),t.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},t.id))})})})]})}export{We as PlayerSelectionPage};
