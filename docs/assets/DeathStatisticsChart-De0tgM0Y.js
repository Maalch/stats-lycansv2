import{u as U,r as M,a as Y,j as e}from"./index-BDe2r90U.js";import{u as J}from"./baseStatsHook-qudnEoPA.js";import{g as E}from"./gameUtils-C0qLdSzT.js";import{F as L,B as R,C as I,X as W,Y as q,a as O,b as V}from"./FullscreenChart-C8kbvnY2.js";import{u as X,m as Z}from"./api-Eg3XKV8i.js";import{R as $,T as w}from"./CategoricalChart-D60L_I2w.js";function Q(h){const s=new Set;h.filter(y=>!y.LegacyData||y.LegacyData.deathInformationFilled===!0).forEach(y=>{y.PlayerStats.forEach(T=>{if(y.PlayerStats.some(f=>f.KillerName===T.Username)){const f=E(T.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupTraitor:!0});s.add(f)}})});const m=Array.from(s),u=["Villageois","Loup","Amoureux"];return[...u.filter(y=>m.includes(y)),...m.filter(y=>!u.includes(y)).sort()]}function _(h){if(!h)return null;const s=h.match(/^([NJM])(\d+)$/);if(!s)return null;const[,g,m]=s,u=parseInt(m,10);let o;switch(g){case"N":o="Nuit";break;case"J":o="Jour";break;case"M":o="Meeting";break;default:return null}return{phase:o,day:u,originalString:h}}function ee(h){if(!h||h=="N/A")return"Survivant";const s=h.trim();return s.includes("vote")||s.includes("Vote")?"Mort aux votes":s.includes("Loup")||s.includes("loup")?"Tué par Loup":s.includes("Zombie")||s.includes("zombie")?"Tué par Zombie":s.includes("Chasseur")||s.includes("chasseur")?"Tué par Chasseur":s.includes("Déco")||s.includes("déco")?"Déconnexion":s.includes("Potion")||s.includes("potion")?"Tué par Potion":s}function te(h,s){return h.PlayerStats.filter(g=>g.DeathTiming||g.DeathType).map(g=>{let m=null;if(g.KillerName){const u=h.PlayerStats.find(o=>o.Username===g.KillerName);u&&(m=E(u.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupTraitor:!0}))}return{playerName:g.Username,deathTiming:_(g.DeathTiming),deathType:ee(g.DeathType),killerName:g.KillerName,killerCamp:m}}).filter(g=>!s||s==="Tous les camps"?!0:g.killerCamp===s)}function ae(h,s){if(h.length===0)return null;const g=h.filter(a=>!a.LegacyData||a.LegacyData.deathInformationFilled===!0);if(g.length===0)return null;const m=[],u={};g.forEach(a=>{te(a,s).forEach(t=>{m.push({...t,gameId:a.Id})}),a.PlayerStats.forEach(t=>{const l=t.Username;(!s||s==="Tous les camps"||E(t.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupTraitor:!0})===s)&&(u[l]=(u[l]||0)+1)})});const o=m.length,y=g.length,T=y>0?o/y:0,v={},f={Nuit:0,Jour:0,Meeting:0};m.forEach(a=>{if(a.deathTiming){const r=`${a.deathTiming.phase}-${a.deathTiming.day}`;v[r]=(v[r]||0)+1,f[a.deathTiming.phase]++}});const C=Object.entries(v).map(([a,r])=>{const[t,l]=a.split("-");return{phase:t,day:parseInt(l,10),count:r,percentage:o>0?r/o*100:0}}).sort((a,r)=>{if(a.phase!==r.phase){const t={Nuit:0,Jour:1,Meeting:2};return t[a.phase]-t[r.phase]}return a.day-r.day}),n={};m.forEach(a=>{n[a.deathType]=(n[a.deathType]||0)+1});const S=Object.entries(n).map(([a,r])=>({type:a,count:r,percentage:o>0?r/o*100:0})).sort((a,r)=>r.count-a.count),x={};m.forEach(a=>{a.killerName&&(x[a.killerName]||(x[a.killerName]={kills:0,victims:new Set}),x[a.killerName].kills++,x[a.killerName].victims.add(a.playerName))});const b=Object.entries(x).map(([a,r])=>{const t=u[a]||0,l=t>0?r.kills/t:0;return{killerName:a,kills:r.kills,victims:Array.from(r.victims),percentage:o>0?r.kills/o*100:0,gamesPlayed:t,averageKillsPerGame:l}}).sort((a,r)=>r.kills-a.kills),D={};m.forEach(a=>{D[a.playerName]||(D[a.playerName]={totalDeaths:0,deathsByPhase:{Nuit:0,Jour:0,Meeting:0},deathsByType:{},killedBy:{},deathDays:[]});const r=D[a.playerName];r.totalDeaths++,a.deathTiming&&(r.deathsByPhase[a.deathTiming.phase]++,r.deathDays.push(a.deathTiming.day)),r.deathsByType[a.deathType]=(r.deathsByType[a.deathType]||0)+1,a.killerName&&(r.killedBy[a.killerName]=(r.killedBy[a.killerName]||0)+1)});const A=Object.entries(D).map(([a,r])=>({playerName:a,totalDeaths:r.totalDeaths,deathsByPhase:r.deathsByPhase,deathsByType:r.deathsByType,killedBy:r.killedBy,averageDeathDay:r.deathDays.length>0?r.deathDays.reduce((t,l)=>t+l,0)/r.deathDays.length:null,deathRate:u[a]>0?r.totalDeaths/u[a]:0})).sort((a,r)=>r.totalDeaths-a.totalDeaths),N=Object.entries(f).reduce((a,[r,t])=>t>a.count?{phase:r,count:t}:a,{phase:"Nuit",count:0}).phase,k={};m.forEach(a=>{a.deathTiming&&(k[a.deathTiming.day]=(k[a.deathTiming.day]||0)+1)});const B=Object.entries(k).reduce((a,[r,t])=>t>a.count?{day:parseInt(r,10),count:t}:a,{day:1,count:0}).day,G=S.length>0?S[0].type:"",z=b.length>0?b[0].killerName:null;return{totalDeaths:o,totalGames:y,averageDeathsPerGame:T,deathsByTiming:C,deathsByPhase:f,deathsByType:S,killerStats:b,playerDeathStats:A,mostDeadlyPhase:N,mostDeadlyDay:B,mostCommonDeathType:G,mostDeadlyKiller:z}}function re(h){return J(s=>ae(s,h))}function ie(){return J(h=>Q(h))}function he(){const{navigateToGameDetails:h,navigationState:s,updateNavigationState:g}=U(),[m,u]=M.useState(s.deathStatsSelectedCamp||"Tous les camps"),[o,y]=M.useState(5),{data:T}=ie(),{data:v,isLoading:f,error:C}=re(m),{settings:n}=Y(),[S,x]=M.useState(null),b=X(),D=t=>{u(t),g({deathStatsSelectedCamp:t})},{totalKillsData:A,averageKillsData:N,highlightedPlayerAddedToTotal:k,highlightedPlayerAddedToAverage:B,gamesWithKillers:G,totalEligibleForAverage:z}=M.useMemo(()=>{if(!v)return{totalKillsData:[],averageKillsData:[],highlightedPlayerAddedToTotal:!1,highlightedPlayerAddedToAverage:!1,gamesWithKillers:0,totalEligibleForAverage:0};const t=v.killerStats.sort((i,P)=>P.kills-i.kills).slice(0,20),l=n.highlightedPlayer&&t.some(i=>i.killerName===n.highlightedPlayer),d=t.map(i=>({name:i.killerName,value:i.kills,victims:i.victims.length,percentage:i.percentage,gamesPlayed:i.gamesPlayed,averageKillsPerGame:i.averageKillsPerGame,isHighlightedAddition:!1}));let c=!1;if(n.highlightedPlayer&&!l){const i=v.killerStats.find(P=>P.killerName===n.highlightedPlayer);i&&(d.push({name:i.killerName,value:i.kills,victims:i.victims.length,percentage:i.percentage,gamesPlayed:i.gamesPlayed,averageKillsPerGame:i.averageKillsPerGame,isHighlightedAddition:!0}),c=!0)}const p=v.killerStats.filter(i=>i.gamesPlayed>=o),j=p.sort((i,P)=>P.averageKillsPerGame-i.averageKillsPerGame).slice(0,20),K=n.highlightedPlayer&&j.some(i=>i.killerName===n.highlightedPlayer),F=j.map(i=>({name:i.killerName,value:i.averageKillsPerGame,victims:i.victims.length,percentage:i.percentage,gamesPlayed:i.gamesPlayed,averageKillsPerGame:i.averageKillsPerGame,isHighlightedAddition:!1}));let H=!1;if(n.highlightedPlayer&&!K){const i=v.killerStats.find(P=>P.killerName===n.highlightedPlayer);i&&(F.push({name:i.killerName,value:i.averageKillsPerGame,victims:i.victims.length,percentage:i.percentage,gamesPlayed:i.gamesPlayed,averageKillsPerGame:i.averageKillsPerGame,isHighlightedAddition:!0}),H=!0)}return{totalKillsData:d,averageKillsData:F,highlightedPlayerAddedToTotal:c,highlightedPlayerAddedToAverage:H,gamesWithKillers:v.totalGames,totalEligibleForAverage:p.length}},[v,n.highlightedPlayer,o]);if(f)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de mort..."});if(C)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",C]});if(!v)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de mort disponible"});const a=({active:t,payload:l,label:d})=>{if(t&&l&&l.length){const c=l[0].payload,p=c.isHighlightedAddition,j=n.highlightedPlayer===c.name;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:j?"var(--accent-primary)":"var(--text-primary)"},children:[d,p&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (🎯)"})]}),e.jsxs("p",{style:{color:"var(--accent-secondary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Victimes totales:"})," ",c.value]}),e.jsxs("p",{style:{color:"var(--accent-tertiary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouées:"})," ",c.gamesPlayed]}),e.jsxs("p",{style:{color:"var(--chart-color-5)",margin:"4px 0"},children:[e.jsx("strong",{children:"Victimes uniques:"})," ",c.victims]}),e.jsxs("p",{style:{color:"var(--chart-color-2)",margin:"4px 0"},children:[e.jsx("strong",{children:"Moyenne par partie:"})," ",c.averageKillsPerGame.toFixed(2)]}),p&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection personnelle"}),j&&!p&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null},r=({active:t,payload:l,label:d})=>{if(t&&l&&l.length){const c=l[0].payload,p=c.isHighlightedAddition,j=n.highlightedPlayer===c.name,K=c.gamesPlayed>=o;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:j?"var(--accent-primary)":"var(--text-primary)"},children:[d,p&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (🎯)"})]}),e.jsxs("p",{style:{color:"var(--accent-secondary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Moyenne par partie:"})," ",c.value.toFixed(2)]}),e.jsxs("p",{style:{color:"var(--accent-tertiary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouées:"})," ",c.gamesPlayed]}),e.jsxs("p",{style:{color:"var(--chart-color-5)",margin:"4px 0"},children:[e.jsx("strong",{children:"Victimes uniques:"})," ",c.victims]}),e.jsxs("p",{style:{color:"var(--chart-color-2)",margin:"4px 0"},children:[e.jsx("strong",{children:"Victimes totales:"})," ",Math.round(c.averageKillsPerGame*c.gamesPlayed)]}),p&&!K&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["🎯 Affiché via sélection (< ",o," parties)"]}),p&&K&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection (hors top 20)"}),j&&!p&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null};return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques de Tueurs (VERSION PROTOTYPE)"}),e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp du tueur :"}),e.jsxs("select",{id:"camp-select",value:m,onChange:t=>D(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),T?.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total des morts"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)"},children:v.totalDeaths})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Tueurs identifiés"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-1)"},children:v.killerStats.length})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Nombre de parties enregistrées"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary)"},children:G})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Top Tueurs (Total)"}),k&&n.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['🎯 "',n.highlightedPlayer,'" affiché en plus du top 20']})]}),e.jsx(L,{title:"Top Tueurs (Total)",children:e.jsx("div",{style:{height:400},children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(R,{data:A,margin:{top:20,right:30,left:20,bottom:10},onMouseEnter:()=>{},onMouseLeave:()=>x(null),children:[e.jsx(I,{strokeDasharray:"3 3"}),e.jsx(W,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:l,payload:d})=>e.jsx("text",{x:t,y:l,dy:16,textAnchor:"end",fill:n.highlightedPlayer===d.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:n.highlightedPlayer===d.value?14:13,fontWeight:n.highlightedPlayer===d.value?"bold":"italic",transform:`rotate(-45 ${t} ${l})`,children:d.value})}),e.jsx(q,{label:{value:"Nombre total de victimes",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(a,{})}),e.jsx(O,{dataKey:"value",name:"Victimes",onMouseEnter:t=>x(t?.name||null),children:A.map(t=>{const l=n.highlightedPlayer===t.name,d=S===t.name,c=t.isHighlightedAddition;return e.jsx(V,{fill:b[t.name]||"#e53e3e",stroke:l?"var(--accent-primary)":d?"var(--text-primary)":"none",strokeWidth:l?3:d?2:0,strokeDasharray:c?"5,5":"none",opacity:c?.8:1,onClick:()=>{const p={selectedPlayer:t.name,fromComponent:"Statistiques de Mort"};m!=="Tous les camps"&&(p.campFilter={selectedCamp:m,campFilterMode:"all-assignments"}),h(p)},onMouseEnter:()=>x(t.name),onMouseLeave:()=>x(null),style:{cursor:"pointer"}},`cell-total-${t.name}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(20,A.filter(t=>!t.isHighlightedAddition).length)," des tueurs les plus actifs (total)"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Top Tueurs (Moyenne par Partie)"}),B&&n.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['🎯 "',n.highlightedPlayer,'" affiché en plus du top 20']})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"min-games-average-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-average-select",value:o,onChange:t=>y(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:Z.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx(L,{title:"Top Tueurs (Moyenne par Partie)",children:e.jsx("div",{style:{height:400},children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(R,{data:N,margin:{top:20,right:30,left:20,bottom:10},onMouseEnter:()=>{},onMouseLeave:()=>x(null),children:[e.jsx(I,{strokeDasharray:"3 3"}),e.jsx(W,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:l,payload:d})=>e.jsx("text",{x:t,y:l,dy:16,textAnchor:"end",fill:n.highlightedPlayer===d.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:n.highlightedPlayer===d.value?14:13,fontWeight:n.highlightedPlayer===d.value?"bold":"italic",transform:`rotate(-45 ${t} ${l})`,children:d.value})}),e.jsx(q,{label:{value:"Moyenne de victimes par partie",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(w,{content:e.jsx(r,{})}),e.jsx(O,{dataKey:"value",name:"Moyenne",onMouseEnter:t=>x(t?.name||null),children:N.map(t=>{const l=n.highlightedPlayer===t.name,d=S===t.name,c=t.isHighlightedAddition;return e.jsx(V,{fill:b[t.name]||"#8884d8",stroke:l?"var(--accent-primary)":d?"var(--text-primary)":"none",strokeWidth:l?3:d?2:0,strokeDasharray:c?"5,5":"none",opacity:c?.8:1,onClick:()=>{const p={selectedPlayer:t.name,fromComponent:"Statistiques de Mort"};m!=="Tous les camps"&&(p.campFilter={selectedCamp:m,campFilterMode:"all-assignments"}),h(p)},onMouseEnter:()=>x(t.name),onMouseLeave:()=>x(null),style:{cursor:"pointer"}},`cell-average-${t.name}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(20,N.filter(t=>!t.isHighlightedAddition).length)," des tueurs les plus efficaces (sur ",z," ayant au moins ",o," partie",o>1?"s":"",")"]})]})]}),e.jsx("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note : "}),"Les morts lors de votes aux conseils ne sont pas comptabilisées ici. ","Données en cours de récupération (données partielles)."]})})]})}export{he as DeathStatisticsChart};
