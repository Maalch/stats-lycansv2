import{g as R,e as z,u as I,a as w,r as f,j as e}from"./index-IJBMYy_y.js";import{a as F}from"./baseStatsHook-Cc6ZV3F_.js";import{c as L}from"./datasyncExport-BirWLS1z.js";import{u as W}from"./useJoueursData-CsKek6WX.js";import{M as B,u as _,C as q,c as Y}from"./api-2x3jNjc4.js";import{F as $,C as K,X as V,Y as X}from"./FullscreenChart-RQqCRGfp.js";import{f as u}from"./durationFormatters-C9UyWcKX.js";import{R as J,T as U,a as Q}from"./CategoricalChart-Cqxd7nSg.js";import{B as Z,a as ee}from"./BarChart-BAeVaoGQ.js";function te(i){return i.PlayerStats.some(d=>d.SecondsTalkedOutsideMeeting>0||d.SecondsTalkedDuringMeeting>0)}function ae(i){if(!i||i.length===0)return null;const d=i.filter(te);if(d.length===0)return{playerStats:[],totalGames:i.length,gamesWithTalkingData:0};const g=new Map;return d.forEach(m=>{m.PlayerStats.forEach(a=>{const s=R(a),n=z(a),T=a.DeathDateIrl||m.EndDate,l=L(m.StartDate,T);if(!l||l<=0)return;g.has(s)||g.set(s,{displayName:n,gamesPlayed:0,totalSecondsOutside:0,totalSecondsDuring:0,totalGameDurationSeconds:0});const p=g.get(s);p.gamesPlayed++,p.totalSecondsOutside+=a.SecondsTalkedOutsideMeeting||0,p.totalSecondsDuring+=a.SecondsTalkedDuringMeeting||0,p.totalGameDurationSeconds+=l})}),{playerStats:Array.from(g.entries()).map(([m,a])=>{const s=a.totalSecondsOutside+a.totalSecondsDuring,n=a.totalGameDurationSeconds>0?3600/a.totalGameDurationSeconds:0;return{player:a.displayName,gamesPlayed:a.gamesPlayed,totalSecondsOutside:a.totalSecondsOutside,totalSecondsDuring:a.totalSecondsDuring,totalSecondsAll:s,totalGameDurationSeconds:a.totalGameDurationSeconds,secondsOutsidePer60Min:a.totalSecondsOutside*n,secondsDuringPer60Min:a.totalSecondsDuring*n,secondsAllPer60Min:s*n}}),totalGames:i.length,gamesWithTalkingData:d.length}}function re(){const{data:i,isLoading:d,error:g}=F(S=>ae(S));return{data:i,isLoading:d,error:g}}const se=Y.STANDARD;function ue(){const{data:i,isLoading:d,error:g}=re(),{navigateToGameDetails:S,navigationState:m,updateNavigationState:a}=I(),{settings:s}=w(),[n,T]=f.useState(m.talkingTimeState?.minGames||B.STANDARD),[l,p]=f.useState(m.talkingTimeState?.displayMode||"total"),[b,D]=f.useState(null),{joueursData:k}=W(),C=_(k);f.useEffect(()=>{const t=m.talkingTimeState;(!t||t.minGames!==n||t.displayMode!==l)&&a({talkingTimeState:{minGames:n,displayMode:l,focusChart:t?.focusChart}})},[n,l,a]);const{chartData:M,highlightedPlayerAdded:G}=f.useMemo(()=>{if(!i?.playerStats)return{chartData:[],highlightedPlayerAdded:!1};const t=i.playerStats,c=t.filter(o=>o.gamesPlayed>=n),r=o=>{switch(l){case"outside":return o.secondsOutsidePer60Min;case"during":return o.secondsDuringPer60Min;default:return o.secondsAllPer60Min}},y=c.sort((o,x)=>r(x)-r(o)).slice(0,q.TOP_20),P=s.highlightedPlayer&&y.some(o=>o.player===s.highlightedPlayer);let v=[...y],h=!1;if(s.highlightedPlayer&&!P){const o=t.find(x=>x.player===s.highlightedPlayer);o&&(v.push({...o,isHighlightedAddition:!0}),h=!0)}return{chartData:v,highlightedPlayerAdded:h}},[i,n,l,s.highlightedPlayer]);if(d)return e.jsx("div",{className:"donnees-attente",children:"R√©cup√©ration des statistiques de temps de parole..."});if(g)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]});if(!i)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de temps de parole disponible"});const N=t=>{switch(l){case"outside":return t.secondsOutsidePer60Min;case"during":return t.secondsDuringPer60Min;default:return t.secondsAllPer60Min}},A=()=>{switch(l){case"outside":return"Temps de Parole Hors Meeting (par 60 min)";case"during":return"Temps de Parole En Meeting (par 60 min)";default:return"Temps de Parole Total (par 60 min)"}},O=()=>{switch(l){case"outside":return"Temps hors meeting (par 60 min)";case"during":return"Temps en meeting (par 60 min)";default:return"Temps de parole (par 60 min)"}},E=i.playerStats.filter(t=>t.gamesPlayed>=n).length;return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques de Temps de Parole"}),e.jsxs("p",{className:"lycans-stats-info",children:[i.gamesWithTalkingData," parties avec donn√©es de temps de parole (depuis la version 0.215 uniquement)"]}),e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:A()}),G&&s.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',s.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"display-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Mode d'affichage:"}),e.jsxs("select",{id:"display-mode-select",value:l,onChange:t=>p(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"total",children:"Temps Total"}),e.jsx("option",{value:"outside",children:"Hors Meeting"}),e.jsx("option",{value:"during",children:"En Meeting"})]}),e.jsx("label",{htmlFor:"min-games-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginLeft:"1rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select",value:n,onChange:t=>T(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:se.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx($,{title:A(),children:e.jsx("div",{style:{height:400},children:e.jsx(J,{width:"100%",height:"100%",children:e.jsxs(Z,{data:M,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(V,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:c,payload:r})=>e.jsx("text",{x:t,y:c,dy:16,textAnchor:"end",fill:s.highlightedPlayer===r.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:s.highlightedPlayer===r.value?14:13,fontWeight:s.highlightedPlayer===r.value?"bold":"italic",transform:`rotate(-45 ${t} ${c})`,children:r.value})}),e.jsx(X,{label:{value:O(),angle:270,position:"left",offset:15,style:{textAnchor:"middle"}},tickFormatter:t=>u(t)}),e.jsx(U,{content:({active:t,payload:c})=>{if(t&&c&&c.length>0){const r=c[0].payload,y=r.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:r.player}),e.jsxs("div",{children:["Parties jou√©es: ",r.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Par 60 minutes:"})}),e.jsxs("div",{children:["Total: ",u(r.secondsAllPer60Min)]}),e.jsxs("div",{children:["Hors meeting: ",u(r.secondsOutsidePer60Min)]}),e.jsxs("div",{children:["En meeting: ",u(r.secondsDuringPer60Min)]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Temps cumul√©s:"})}),e.jsxs("div",{children:["Total: ",u(r.totalSecondsAll)]}),e.jsxs("div",{children:["Hors meeting: ",u(r.totalSecondsOutside)]}),e.jsxs("div",{children:["En meeting: ",u(r.totalSecondsDuring)]}),y&&e.jsxs("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:["üéØ Affich√© via s√©lection personnelle",r.gamesPlayed<n&&` (< ${n} parties)`]})]})}return null}}),e.jsx(ee,{dataKey:t=>N(t),shape:t=>{const{x:c,y:r,width:y,height:P,payload:v}=t,h=v,o=s.highlightedPlayer===h.player,x=b===h.player,j=h.isHighlightedAddition,H=C[h.player]||"var(--chart-primary)";return e.jsx(Q,{x:c,y:r,width:y,height:P,fill:o?"var(--accent-primary)":j?"var(--accent-secondary)":H,stroke:o?"var(--accent-primary)":x?"#000000":"none",strokeWidth:o?3:x?2:0,strokeDasharray:j?"5,5":"none",opacity:j?.8:1,onClick:()=>S({selectedPlayer:h.player}),onMouseEnter:()=>D(h.player),onMouseLeave:()=>D(null),style:{cursor:"pointer"}})}})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",M.length," des joueurs (sur ",E," ayant au moins ",n," partie",n>1?"s":"",")"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Temps normalis√© par 60 minutes de jeu ¬∑ Calcul√© sur ",i.gamesWithTalkingData," parties avec donn√©es"]})]})})]})}export{ue as TalkingTimeChart};
