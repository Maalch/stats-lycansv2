import{s as S,k as z,l as I,u as W,r as C,j as e}from"./index-DCIJsmZO.js";import{a as L}from"./baseStatsHook-BTzK6poH.js";import{a as A,g as N}from"./datasyncExport-BirWLS1z.js";import{b as D,l as q}from"./api-QIlfLpY8.js";import{F,C as P,X as M,Y as G}from"./FullscreenChart-bMFCrFe_.js";import{R as w,T as b,a as T}from"./CategoricalChart-CwGsw23q.js";import{P as _,a as $}from"./PieChart-D65Zj5c2.js";import{B as E,a as k}from"./BarChart-clXTT2iV.js";import"./PolarChart-BmlyvaKk.js";function O(s){const t={};return s.forEach(o=>{const n=o.Id;t[n]||(t[n]={}),o.PlayerStats.forEach(c=>{const l=c.Username,x=c.MainRoleInitial==="Louveteau"?c.MainRoleInitial:A(c.MainRoleInitial,c.MainRoleChanges||[]);let g=N(x);l&&g&&(t[n][l]=g)})}),t}function V(s,t,o){return s[t]?.[o]||"Villageois"}function B(s){const t=[],o=["Villageois","Loup"];return s.PlayerStats.forEach(n=>{const c=n.MainRoleInitial==="Louveteau"?n.MainRoleInitial:A(n.MainRoleInitial,n.MainRoleChanges||[]);let l=N(c);l&&!o.includes(l)&&t.push(l)}),t}function K(s){const t=s.PlayerStats.filter(c=>c.Victorious);if(t.length===0)return null;const o=t[0].MainRoleInitial==="Louveteau"?t[0].MainRoleInitial:A(t[0].MainRoleInitial,t[0].MainRoleChanges||[]);return N(o,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0})}function U(s){return s.PlayerStats.map(t=>t.Username).join(", ")}function X(s){return s.PlayerStats.filter(t=>t.Victorious).map(t=>t.Username).join(", ")}function Y(s,t){s.forEach(o=>{const n=o.trim();n!==""&&(t[n]||(t[n]=0),t[n]++)})}function J(s,t){return s&&s.trim()!==""?(t[s]||(t[s]=0),t[s]++,!0):!1}function H(s,t,o,n,c,l){const x=S(t),g=new Set;x.forEach(m=>{const u=m.trim();if(u){const p=V(c,s,u);g.add(p)}}),g.forEach(m=>{l[m]||(l[m]={totalGames:0,wins:0,winRate:0,players:{}}),l[m].totalGames++}),g.forEach(m=>{z(m,o)&&l[m].wins++}),x.forEach(m=>{const u=m.trim();if(u){const p=V(c,s,m);l[p].players[u]||(l[p].players[u]={games:0,wins:0,winRate:0}),l[p].players[u].games++,I(u,n)&&l[p].players[u].wins++}})}function Q(s){Object.keys(s).forEach(t=>{s[t].totalGames>0&&(s[t].winRate=parseFloat((s[t].wins/s[t].totalGames*100).toFixed(2))),Object.keys(s[t].players).forEach(o=>{const n=s[t].players[o];n.games>0&&(n.winRate=parseFloat((n.wins/n.games*100).toFixed(2)))})})}function Z(s,t){const o=[];return Object.keys(s).forEach(n=>{o.push({camp:n,wins:s[n],winRate:(s[n]/t*100).toFixed(2)})}),o.sort((n,c)=>c.wins-n.wins),o}function ee(s){return Object.keys(s).map(t=>({camp:t,totalGames:s[t].totalGames,wins:s[t].wins,winRate:s[t].winRate.toFixed(2)}))}function te(s){const t=new Set;return Object.keys(s).forEach(o=>{Object.keys(s[o].players).forEach(n=>{t.add(n)})}),t.size}function se(s){const t=[];return Object.keys(s).forEach(o=>{t.push({soloRole:o,appearances:s[o]})}),t.sort((o,n)=>n.appearances-o.appearances),t}function re(s){if(s.length===0)return null;const t=O(s),o={},n={},c={};let l=0;s.forEach(p=>{const y=p.Id,r=B(p),i=K(p),a=U(p),h=X(p);Y(r,o),J(i||"",n)&&l++,y&&a&&i&&h&&H(y,a,i,h,t,c)}),Q(c);const x=Z(n,l),g=ee(c),m=te(c),u=se(o);return{totalGames:l,campStats:x,soloCamps:u,campAverages:g,totalPlayersAnalyzed:m}}function ie(){const{data:s,isLoading:t,error:o}=L(re);return{campWinStats:s,isLoading:t,errorInfo:o}}const ae="#607D8B";function fe(){const{navigateToGameDetails:s}=W(),{campWinStats:t,isLoading:o,errorInfo:n}=ie(),c=D(),l=C.useMemo(()=>t?.campAverages?t.campAverages.map(r=>({...r,winRateNum:parseFloat(r.winRate)})).sort((r,i)=>i.winRateNum-r.winRateNum):[],[t]),x=C.useMemo(()=>t?.campStats?.map(r=>({...r,winRateNum:typeof r.winRate=="string"?parseFloat(r.winRate):r.winRate}))||[],[t]),g=r=>{if(r.camp==="Autres"&&r._details){const i=r._details.map(a=>a.camp);s({campFilter:{selectedCamp:"Autres",campFilterMode:"wins-only",_smallCamps:i},fromComponent:"R√©partition des Victoires par Camp"})}else s({campFilter:{selectedCamp:r.camp,campFilterMode:"wins-only"},fromComponent:"R√©partition des Victoires par Camp"})},m=C.useMemo(()=>{if(!x.length)return[];const r=5;let i=0;const a=[],h=[];return x.forEach(d=>{d.winRateNum<r?(i+=d.winRateNum,a.push(d)):h.push(d)}),i>0&&h.push({camp:"Autres",wins:a.reduce((d,f)=>d+f.wins,0),winRate:i.toFixed(1),winRateNum:i,_details:a}),h},[x]),u=C.useMemo(()=>l.length?l.slice().filter(r=>r.camp!=="Villageois"&&r.camp!=="Loup").sort((r,i)=>i.totalGames-r.totalGames):[],[l]),p=o,y=n;return p?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques des camps..."}):y?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",y]}):t?e.jsxs("div",{className:"lycans-camps-container",children:[e.jsx("h2",{children:"Statistiques des Camps"}),t&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camps Analys√©s"}),e.jsx("div",{className:"lycans-valeur-principale",children:t.campAverages?.length||0}),e.jsx("p",{children:"camps diff√©rents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Joueurs √âvalu√©s"}),e.jsx("div",{className:"lycans-valeur-principale",children:t.totalPlayersAnalyzed||0}),e.jsx("p",{children:"joueurs analys√©s"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:t?.totalGames||0}),e.jsx("p",{children:"parties analys√©es"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[t&&m.length>0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"R√©partition des Victoires par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Distribution des victoires sur ",t.totalGames," parties"]}),e.jsx("div",{style:{height:450},children:e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(_,{children:[e.jsx($,{data:m.map(r=>({...r,fill:r.camp==="Autres"?q:c[r.camp]||ae})),cx:"50%",cy:"50%",outerRadius:140,fill:"#8884d8",dataKey:"winRateNum",onClick:r=>{r&&r.camp&&g(r)},style:{cursor:"pointer"},label:({payload:r})=>{if(!r)return"";const{camp:i,winRate:a}=r;return i==="Autres"?`Autres: ${a}%`:`${i}: ${a}%`}}),e.jsx(b,{content:({active:r,payload:i})=>{if(r&&i&&i.length>0){const a=i[0].payload;if(a.camp==="Autres"&&a._details){const h=[...a._details].sort((d,f)=>f.winRateNum-d.winRateNum);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:"Autres"})}),e.jsx("div",{children:h.map((d,f)=>e.jsxs("div",{children:[d.camp,": ",d.wins," victoires (",d.winRate,"%)"]},f))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold"},children:["Total: ",a.wins," victoires (",a.winRate,"%)"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:a.camp}),e.jsxs("div",{children:["Victoires: ",a.wins]}),e.jsxs("div",{children:["Taux de victoire: ",a.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}})]})})})]})}),t?.campAverages&&l.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire Moyen par Camp"}),e.jsx(F,{title:"Taux de Victoire Moyen par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(E,{data:l,margin:{top:50,right:30,left:20,bottom:0},children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(M,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11,tick:({x:r,y:i,payload:a})=>e.jsx("text",{x:r,y:i,dy:14,textAnchor:"end",fill:"var(--text-secondary)",fontSize:11,transform:`rotate(-45 ${r} ${i})`,children:a.value})}),e.jsx(G,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(b,{content:({active:r,payload:i})=>{if(r&&i&&i.length>0){const a=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.camp})}),e.jsxs("div",{children:["Victoires : ",a.wins," / ",a.totalGames]}),e.jsxs("div",{children:["Taux de victoire: ",a.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(k,{dataKey:"winRateNum",style:{cursor:"pointer"},shape:r=>{const{x:i,y:a,width:h,height:d,payload:f,index:v}=r,j=f,R=c[j.camp]||`var(--chart-color-${(v??0)%6+1})`;return e.jsx(T,{x:i,y:a,width:h,height:d,fill:R,onClick:()=>{s({campFilter:{selectedCamp:j.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Taux de Victoire Moyen par Camp"})},style:{cursor:"pointer"}})}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Parties par Camp (hors villageois et loups)"}),e.jsx(F,{title:"Distribution des Parties par Camp (hors villageois et loups)",children:e.jsx("div",{style:{height:400},children:e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(E,{data:u,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(M,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11,tick:({x:r,y:i,payload:a})=>e.jsx("text",{x:r,y:i,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:11,transform:`rotate(-45 ${r} ${i})`,children:a.value})}),e.jsx(G,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(b,{content:({active:r,payload:i})=>{if(r&&i&&i.length>0){const a=i[0].payload,h=u.reduce((f,v)=>f+v.totalGames,0),d=(a.totalGames/h*100).toFixed(1);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.camp})}),e.jsxs("div",{children:["Parties: ",a.totalGames," (",d,"%)"]}),e.jsxs("div",{children:["Taux victoire: ",a.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(k,{dataKey:"totalGames",style:{cursor:"pointer"},shape:r=>{const{x:i,y:a,width:h,height:d,payload:f,index:v}=r,j=f,R=c[j.camp]||`var(--chart-color-${(v??0)%6+1})`;return e.jsx(T,{x:i,y:a,width:h,height:d,fill:R,onClick:()=>{s({campFilter:{selectedCamp:j.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Distribution des Parties par Camp"})},style:{cursor:"pointer"}})}})]})})})})]})]})]}),e.jsx("div",{className:"lycans-stats-note",style:{marginTop:"2rem",padding:"1rem",textAlign:"center",color:"var(--text-secondary)",fontSize:"0.9rem",fontStyle:"italic"},children:"Statistiques bas√©es sur les r√¥les effectifs des joueurs √† la fin des parties."})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de camp disponible"})}export{fe as CampsChart};
