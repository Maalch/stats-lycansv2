import{r as p,j as l,e as m}from"./index-KqbRsFww.js";function f(e){if(!e)return null;try{const s=new URL(e);let n=null;if(s.hostname==="clips.twitch.tv")n=s.pathname.split("/")[1];else if(s.hostname.includes("twitch.tv")){const i=s.pathname.split("/"),a=i.indexOf("clip");a!==-1&&i[a+1]&&(n=i[a+1])}if(n)return`https://clips.twitch.tv/embed?clip=${n}&parent=${window.location.hostname}`}catch(s){console.warn("Failed to parse Twitch clip URL:",e,s)}return null}function o(e){return e.NewName?e.NewName:e.ClipName?e.ClipName:`Clip ${e.ClipId}`}function y(e){return e?e.split(",").map(s=>s.trim()).filter(s=>s.length>0):[]}function x(e){return e?e.split(",").map(s=>s.trim()).filter(s=>s.length>0):[]}function v(e){const s=[e.POVPlayer],n=y(e.OthersPlayers);return[...s,...n]}function j(e,s){const n=s.toLowerCase();return e.filter(i=>v(i).map(c=>c.toLowerCase()).includes(n))}function C(e,s){const n=x(e.RelatedClips);return s.filter(i=>n.includes(i.ClipId))}function g(e,s){return e.NextClip&&s.find(n=>n.ClipId===e.NextClip)||null}function P(e){const s=new Map;return e.forEach(n=>{const i=n.Category||"Sans catégorie";s.has(i)||s.set(i,[]),s.get(i).push(n)}),s}function b({clip:e,onClose:s,onNextClip:n,onRelatedClip:i,relatedClips:a=[],nextClip:c=null}){p.useEffect(()=>{const r=t=>{t.key==="Escape"&&s()};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[s]);const d=f(e.ClipUrl),u=o(e),h=y(e.OthersPlayers);return l.jsx("div",{className:"lycans-clip-viewer-overlay",onClick:s,children:l.jsxs("div",{className:"lycans-clip-viewer-container",onClick:r=>r.stopPropagation(),children:[l.jsxs("div",{className:"lycans-clip-viewer-header",children:[l.jsxs("div",{className:"lycans-clip-viewer-title",children:[l.jsx("h2",{children:u}),e.Category&&l.jsx("span",{className:"lycans-clip-category",children:e.Category})]}),l.jsx("button",{className:"lycans-clip-viewer-close",onClick:s,children:"✕"})]}),l.jsxs("div",{className:"lycans-clip-viewer-content",children:[l.jsx("div",{className:"lycans-clip-player",children:d?l.jsx("iframe",{src:d,frameBorder:"0",allowFullScreen:!0,scrolling:"no",title:u}):l.jsxs("div",{className:"lycans-clip-no-video",children:[l.jsx("p",{children:"Vidéo non disponible"}),e.ClipUrl&&l.jsx("a",{href:e.ClipUrl,target:"_blank",rel:"noopener noreferrer",children:"Voir sur Twitch"})]})}),l.jsxs("div",{className:"lycans-clip-metadata",children:[l.jsxs("div",{className:"lycans-clip-info-section",children:[l.jsx("h3",{children:"Joueurs"}),l.jsxs("div",{className:"lycans-clip-players",children:[l.jsxs("div",{className:"lycans-clip-pov-player",children:[l.jsx("span",{className:"lycans-clip-pov-badge",children:"POV"}),l.jsx("span",{className:"lycans-clip-player-name",children:e.POVPlayer})]}),h.length>0&&l.jsx("div",{className:"lycans-clip-other-players",children:h.map((r,t)=>l.jsx("span",{className:"lycans-clip-player-name",children:r},t))})]})]}),e.AdditionalInfo&&l.jsxs("div",{className:"lycans-clip-info-section",children:[l.jsx("h3",{children:"Description"}),l.jsx("p",{className:"lycans-clip-description",children:e.AdditionalInfo})]}),(c||a.length>0)&&l.jsxs("div",{className:"lycans-clip-info-section",children:[l.jsx("h3",{children:"Clips liés"}),l.jsxs("div",{className:"lycans-clip-navigation",children:[c&&n&&l.jsxs("button",{className:"lycans-clip-nav-btn lycans-clip-next-btn",onClick:n,children:["▶ Suivant: ",o(c)]}),a.length>0&&i&&l.jsxs("div",{className:"lycans-clip-related-clips",children:[l.jsx("p",{className:"lycans-clip-related-label",children:"Autres POV:"}),a.map(r=>l.jsxs("button",{className:"lycans-clip-nav-btn lycans-clip-related-btn",onClick:()=>i(r.ClipId),children:[o(r)," (",r.POVPlayer,")"]},r.ClipId))]})]})]})]})]})]})})}function N(){const{data:e,isLoading:s,error:n}=m();return{clips:p.useMemo(()=>{if(!e)return[];const a=[];return e.forEach(c=>{c.Clips&&Array.isArray(c.Clips)&&a.push(...c.Clips)}),a},[e]),isLoading:s,error:n}}function I(e){const{clips:s,isLoading:n,error:i}=N();return{clips:p.useMemo(()=>e?j(s,e):[],[s,e]),isLoading:n,error:i}}export{b as C,o as a,C as b,I as c,g as f,P as g,N as u};
