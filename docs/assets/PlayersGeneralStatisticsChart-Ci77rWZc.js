import{r as h,u as _,a as ee,j as e}from"./index-BeW-D-Dk.js";import{u as ie}from"./usePlayerStatsFromRaw-NRUK9hTU.js";import{u as te,m as re}from"./api-OhKOt6KY.js";import{c as ae,r as ne,F as z,B as L,C as M,X as B,Y as V,a as q,b as G}from"./FullscreenChart-iUhNFtye.js";import{u as le,a as se,r as oe,b as ce,c as de,d as W,s as he,e as ge,f as K,g as ue,h as ye,L as me,i as pe,j as fe,k as X,l as Y,R as J,T as $}from"./CategoricalChart-8_aIjrHL.js";import"./baseStatsHook-3ExIZXUC.js";function Q(i,r){var a=Object.keys(i);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(i);r&&(l=l.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),a.push.apply(a,l)}return a}function U(i){for(var r=1;r<arguments.length;r++){var a=arguments[r]!=null?arguments[r]:{};r%2?Q(Object(a),!0).forEach(function(l){E(i,l,a[l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):Q(Object(a)).forEach(function(l){Object.defineProperty(i,l,Object.getOwnPropertyDescriptor(a,l))})}return i}function E(i,r,a){return(r=xe(r))in i?Object.defineProperty(i,r,{value:a,enumerable:!0,configurable:!0,writable:!0}):i[r]=a,i}function xe(i){var r=ve(i,"string");return typeof r=="symbol"?r:r+""}function ve(i,r){if(typeof i!="object"||!i)return i;var a=i[Symbol.toPrimitive];if(a!==void 0){var l=a.call(i,r);if(typeof l!="object")return l;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(i)}function D(){return D=Object.assign?Object.assign.bind():function(i){for(var r=1;r<arguments.length;r++){var a=arguments[r];for(var l in a)({}).hasOwnProperty.call(a,l)&&(i[l]=a[l])}return i},D.apply(null,arguments)}var Pe=(i,r)=>{var a;return h.isValidElement(i)?a=h.cloneElement(i,r):typeof i=="function"?a=i(r):a=h.createElement("line",D({},r,{className:"recharts-reference-line-line"})),a},je=(i,r,a,l,s,g,O,f,u)=>{var{x,y,width:A,height:w}=s;if(a){var{y:v}=u,m=i.y.apply(v,{position:g});if(X(m)||u.ifOverflow==="discard"&&!i.y.isInRange(m))return null;var R=[{x:x+A,y:m},{x,y:m}];return f==="left"?R.reverse():R}if(r){var{x:T}=u,P=i.x.apply(T,{position:g});if(X(P)||u.ifOverflow==="discard"&&!i.x.isInRange(P))return null;var t=[{x:P,y:y+w},{x:P,y}];return O==="top"?t.reverse():t}if(l){var{segment:c}=u,n=c.map(o=>i.apply(o,{position:g}));return u.ifOverflow==="discard"&&n.some(o=>!i.isInRange(o))?null:n}return null};function be(i){var r=le();return h.useEffect(()=>(r(se(i)),()=>{r(oe(i))})),null}function Se(i){var{x:r,y:a,segment:l,xAxisId:s,yAxisId:g,shape:O,className:f,ifOverflow:u}=i,x=ce(),y=de(),A=W(p=>he(p,s)),w=W(p=>ge(p,g)),v=W(p=>K(p,"xAxis",s,x)),m=W(p=>K(p,"yAxis",g,x)),R=ue(),T=Y(r),P=Y(a);if(!y||!R||A==null||w==null||v==null||m==null)return null;var t=ae({x:v,y:m}),c=l&&l.length===2,n=je(t,T,P,c,R,i.position,A.orientation,w.orientation,i);if(!n)return null;var[{x:o,y:j},{x:b,y:I}]=n,C=u==="hidden"?"url(#".concat(y,")"):void 0,F=U(U({clipPath:C},ye(i,!0)),{},{x1:o,y1:j,x2:b,y2:I});return h.createElement(me,{className:pe("recharts-reference-line",f)},Pe(O,F),fe.renderCallByParent(i,ne({x1:o,y1:j,x2:b,y2:I})))}function Ae(i){return h.createElement(h.Fragment,null,h.createElement(be,{yAxisId:i.yAxisId,xAxisId:i.xAxisId,ifOverflow:i.ifOverflow,x:i.x,y:i.y}),h.createElement(Se,i))}class k extends h.Component{render(){return h.createElement(Ae,this.props)}}E(k,"displayName","ReferenceLine");E(k,"defaultProps",{ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});function Fe(){const{data:i,isLoading:r,error:a}=ie(),{navigateToGameDetails:l}=_(),{settings:s}=ee(),[g,O]=h.useState(50),[f,u]=h.useState("best"),[x,y]=h.useState(null),A=te(),{participationData:w,winRateData:v,averageWinRate:m,totalEligiblePlayers:R,highlightedPlayerInParticipation:T,highlightedPlayerInWinRate:P}=h.useMemo(()=>{if(!i?.playerStats)return{participationData:[],winRateData:[],averageWinRate:"0",totalEligiblePlayers:0,highlightedPlayerInParticipation:!1,highlightedPlayerInWinRate:!1};const t=i.playerStats,c=[],n=[];let o=0;for(const d of t)o+=parseFloat(d.winPercent),d.gamesPlayed>=g&&c.push(d),d.gamesPlayed>2&&n.push(d);const j=t.length>0?(o/t.length).toFixed(1):"0",b=n.sort((d,S)=>S.gamesPlayed-d.gamesPlayed).slice(0,20),I=s.highlightedPlayer&&b.some(d=>d.player===s.highlightedPlayer);let C=[...b],F=!1;if(s.highlightedPlayer&&!I){const d=n.find(S=>S.player===s.highlightedPlayer);d&&(C.push({...d,isHighlightedAddition:!0}),F=!0)}const p=c.sort((d,S)=>f==="best"?parseFloat(S.winPercent)-parseFloat(d.winPercent):parseFloat(d.winPercent)-parseFloat(S.winPercent)).slice(0,20),Z=s.highlightedPlayer&&p.some(d=>d.player===s.highlightedPlayer);let N=[...p],H=!1;if(s.highlightedPlayer&&!Z){const d=t.find(S=>S.player===s.highlightedPlayer);d&&(N.push({...d,isHighlightedAddition:!0}),H=!0)}return{participationData:C,winRateData:N,averageWinRate:j,totalEligiblePlayers:c.length,highlightedPlayerInParticipation:F,highlightedPlayerInWinRate:H}},[i,g,f,s.highlightedPlayer]);return r?e.jsx("div",{className:"donnees-attente",children:"Récupération des statistiques des joueurs..."}):a?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",a]}):i?e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques des Joueurs"}),e.jsxs("p",{className:"lycans-stats-info",children:["Total de ",i.totalGames," parties analysées avec ",i.playerStats.length," joueurs"]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Top Participations"}),T&&s.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['🎯 "',s.highlightedPlayer,'" affiché en plus du top 20']})]}),e.jsx(z,{title:"Top Participations",children:e.jsx("div",{style:{height:400},children:e.jsx(J,{width:"100%",height:"100%",children:e.jsxs(L,{data:w,margin:{top:20,right:30,left:20,bottom:10},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(B,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(V,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx($,{content:({active:t,payload:c})=>{if(t&&c&&c.length>0){const n=c[0].payload,o=n.isHighlightedAddition,j=s.highlightedPlayer===n.player;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:n.player})}),e.jsxs("div",{children:["Parties jouées : ",n.gamesPlayed]}),e.jsxs("div",{children:["Pourcentage : ",n.gamesPlayedPercent,"%"]}),o&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection personnelle"}),j&&!o&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(q,{dataKey:"gamesPlayed",name:"Parties jouées",fill:"#00C49F",children:w.map(t=>{const c=s.highlightedPlayer===t.player,n=x===t.player,o=t.isHighlightedAddition;return e.jsx(G,{fill:A[t.player]||"#00C49F",stroke:c?"var(--accent-primary)":n?"var(--text-primary)":"none",strokeWidth:c?3:n?2:0,strokeDasharray:o?"5,5":"none",opacity:o?.8:1,onClick:()=>{l({selectedPlayer:t.player,fromComponent:"Statistiques Joueurs"})},onMouseEnter:()=>y(t.player),onMouseLeave:()=>y(null),style:{cursor:"pointer"}},`cell-participation-${t.player}`)})})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("h3",{children:f==="best"?"Meilleurs Taux de Victoire":"Moins Bon Taux de Victoire"}),P&&s.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0"},children:['🎯 "',s.highlightedPlayer,'" affiché en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"min-games-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select",value:g,onChange:t=>O(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:re.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsxs("select",{value:f,onChange:t=>u(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"best",children:"Meilleurs Taux de Victoire"}),e.jsx("option",{value:"worst",children:"Moins Bon Taux de Victoire"})]})]})]}),e.jsx(z,{title:f==="best"?"Meilleurs Taux de Victoire":"Moins Bon Taux de Victoire",children:e.jsx("div",{style:{height:400},children:e.jsx(J,{width:"100%",height:"100%",children:e.jsxs(L,{data:v,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(B,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(V,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx($,{content:({active:t,payload:c})=>{if(t&&c&&c.length>0){const n=c[0].payload,o=n.isHighlightedAddition,j=s.highlightedPlayer===n.player,b=n.gamesPlayed>=g;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:n.player})}),e.jsxs("div",{children:["Taux de victoire : ",n.winPercent,"%"]}),e.jsxs("div",{children:["Victoires : ",n.wins," / ",n.gamesPlayed]}),o&&!b&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["🎯 Affiché via sélection (< ",g," parties)"]}),o&&b&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection (hors top 20)"}),j&&!o&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(q,{dataKey:"winPercent",name:"Taux de Victoire",fill:"#8884d8",children:v.map(t=>{const c=s.highlightedPlayer===t.player,n=x===t.player,o=t.isHighlightedAddition;return e.jsx(G,{fill:A[t.player]||"#8884d8",stroke:c?"var(--accent-primary)":n?"var(--text-primary)":"none",strokeWidth:c?3:n?2:0,strokeDasharray:o?"5,5":"none",opacity:o?.8:1,onClick:()=>{l({selectedPlayer:t.player,selectedPlayerWinMode:"wins-only",fromComponent:"Taux de Victoire"})},onMouseEnter:()=>y(t.player),onMouseLeave:()=>y(null),style:{cursor:"pointer"}},`cell-winrate-${t.player}`)})}),e.jsx(k,{y:parseFloat(m),stroke:"red",strokeDasharray:"3 3",label:{value:`Moyenne: ${m}%`,position:"insideBottomRight",fill:"red",fontSize:12,fontWeight:"bold"}})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",v.length," des joueurs (sur ",R," ayant au moins ",g," partie",g>1?"s":"",")"]})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de joueur disponible"})}export{Fe as PlayersGeneralStatisticsChart};
