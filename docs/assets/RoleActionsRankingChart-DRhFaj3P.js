import{u as Q,a as Z,d as ee,r as m,h as re,j as e}from"./index-CGtHA2Ok.js";import{u as te}from"./useJoueursData-CISCvvPM.js";import{u as se,b as ae,M as E,C,c as ie}from"./api-B5xp375K.js";import{F as N,C as D,X as H,Y as W,a as G}from"./FullscreenChart-CN0QW_SE.js";import{i as ne,c as oe}from"./wolfTransformUtils-DiCKErCz.js";import{R as M,T as k}from"./CategoricalChart-Dk0YC06Q.js";import{B as R,a as w}from"./BarChart-BKO4CwUO.js";const O=ie.COMPACT;function fe(){const{navigationState:y,updateNavigationState:z}=Q(),{settings:i}=Z(),{gameData:A}=ee(),{joueursData:F}=te(),S=se(F),p=ae(),[c,B]=m.useState(y.roleActionsRankingState?.minWolfGames||E.LOW),[g,q]=m.useState(y.roleActionsRankingState?.minHunterGames||E.VERY_LOW),[d,_]=m.useState(y.roleActionsRankingState?.sortOrder||"highest"),[T,f]=m.useState(null);m.useEffect(()=>{const t=y.roleActionsRankingState;(!t||t.minWolfGames!==c||t.minHunterGames!==g||t.sortOrder!==d)&&z({roleActionsRankingState:{minWolfGames:c,minHunterGames:g,sortOrder:d}})},[c,g,d,z]);const h=m.useMemo(()=>{if(!A)return[];const t={};return A.forEach(a=>{const r=a.Modded&&re(a.Version||"0","0.243");a.PlayerStats.forEach(o=>{const n=o.Username;t[n]||(t[n]={transformCount:0,untransformCount:0,totalNightsAsWolf:0,wolfGamesPlayed:0,hunterSuccessfulShots:0,hunterMissedShots:0,hunterTotalShots:0,hunterGamesPlayed:0});const s=t[n],l=o.Actions||[];let b=!1;if(r)b=!0;else{const u=l.some(I=>I.ActionType==="Transform"||I.ActionType==="Untransform"),P=o.LegacyActionsIncomplete===!0;b=u&&!P}if(ne(o.MainRoleInitial)&&b){s.wolfGamesPlayed++;const u=oe(o.DeathTiming,a.EndTiming);s.totalNightsAsWolf+=u,l.forEach(P=>{P.ActionType==="Transform"?s.transformCount++:P.ActionType==="Untransform"&&s.untransformCount++})}const L=l.filter(u=>u.ActionType==="HunterShoot");L.length>0&&(s.hunterGamesPlayed++,L.forEach(u=>{s.hunterTotalShots++,u.ActionTarget?s.hunterSuccessfulShots++:s.hunterMissedShots++}))})}),Object.entries(t).map(([a,r])=>({player:a,transformCount:r.transformCount,untransformCount:r.untransformCount,totalNightsAsWolf:r.totalNightsAsWolf,transformsPerNight:r.totalNightsAsWolf>0?r.transformCount/r.totalNightsAsWolf:0,untransformPerTransform:r.transformCount>0?r.untransformCount/r.transformCount:0,wolfGamesPlayed:r.wolfGamesPlayed,hunterSuccessfulShots:r.hunterSuccessfulShots,hunterMissedShots:r.hunterMissedShots,hunterTotalShots:r.hunterTotalShots,hunterAccuracy:r.hunterTotalShots>0?r.hunterSuccessfulShots/r.hunterTotalShots*100:0,hunterGamesPlayed:r.hunterGamesPlayed}))},[A]),{transformsPerNightData:x,transformsHighlightedAdded:$}=m.useMemo(()=>{const a=[...h.filter(s=>s.wolfGamesPlayed>=c&&s.totalNightsAsWolf>0)].sort((s,l)=>d==="highest"?l.transformsPerNight-s.transformsPerNight:s.transformsPerNight-l.transformsPerNight).slice(0,C.TOP_20),r=i.highlightedPlayer&&a.some(s=>s.player===i.highlightedPlayer);let o=[...a],n=!1;if(i.highlightedPlayer&&!r){const s=h.find(l=>l.player===i.highlightedPlayer);s&&s.totalNightsAsWolf>0&&(o.push({...s,isHighlightedAddition:!0}),n=!0)}return{transformsPerNightData:o,transformsHighlightedAdded:n}},[h,c,d,i.highlightedPlayer]),{untransformsData:v,untransformsHighlightedAdded:K}=m.useMemo(()=>{const a=[...h.filter(s=>s.wolfGamesPlayed>=c&&s.transformCount>0)].sort((s,l)=>d==="highest"?l.untransformPerTransform-s.untransformPerTransform:s.untransformPerTransform-l.untransformPerTransform).slice(0,C.TOP_20),r=i.highlightedPlayer&&a.some(s=>s.player===i.highlightedPlayer);let o=[...a],n=!1;if(i.highlightedPlayer&&!r){const s=h.find(l=>l.player===i.highlightedPlayer);s&&s.transformCount>0&&(o.push({...s,isHighlightedAddition:!0}),n=!0)}return{untransformsData:o,untransformsHighlightedAdded:n}},[h,c,d,i.highlightedPlayer]),{hunterAccuracyData:j,hunterHighlightedAdded:U}=m.useMemo(()=>{const a=[...h.filter(s=>s.hunterGamesPlayed>=g&&s.hunterTotalShots>0)].sort((s,l)=>d==="highest"?l.hunterAccuracy-s.hunterAccuracy:s.hunterAccuracy-l.hunterAccuracy).slice(0,C.TOP_20),r=i.highlightedPlayer&&a.some(s=>s.player===i.highlightedPlayer);let o=[...a],n=!1;if(i.highlightedPlayer&&!r){const s=h.find(l=>l.player===i.highlightedPlayer);s&&s.hunterTotalShots>0&&(o.push({...s,isHighlightedAddition:!0}),n=!0)}return{hunterAccuracyData:o,hunterHighlightedAdded:n}},[h,g,d,i.highlightedPlayer]),V=x.length>0||v.length>0,Y=j.length>0;if(!V&&!Y)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e d'actions de rÃ´le disponible."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es d'actions de rÃ´le (Chasseur, Loup) ne sont disponibles que pour les parties rÃ©centes avec le mod."})]});const X=h.filter(t=>t.wolfGamesPlayed>=c&&t.totalNightsAsWolf>0).length,J=h.filter(t=>t.hunterGamesPlayed>=g&&t.hunterTotalShots>0).length;return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Classement des Actions de RÃ´le"}),e.jsx("p",{className:"lycans-stats-info",children:"Classement des joueurs par comportement en tant que Loup et Chasseur."}),e.jsx("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1.5rem",flexWrap:"wrap"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"sort-order-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Tri:"}),e.jsxs("select",{id:"sort-order-select",value:d,onChange:t=>_(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"highest",children:"Plus Ã©levÃ© d'abord"}),e.jsx("option",{value:"lowest",children:"Plus bas d'abord"})]})]})}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[x.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"ðŸº Transformations par Nuit (Loup)"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:"Nombre moyen de transformations effectuÃ©es par nuit vÃ©cue en loup"}),$&&i.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem"},children:['ðŸŽ¯ "',i.highlightedPlayer,'" affichÃ© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem",marginTop:"0.5rem"},children:[e.jsx("label",{htmlFor:"min-wolf-games-transform",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties loup:"}),e.jsx("select",{id:"min-wolf-games-transform",value:c,onChange:t=>B(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:O.map(t=>e.jsxs("option",{value:t,children:[t,"+ parties"]},t))}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["(",X," joueurs Ã©ligibles)"]})]}),e.jsx(N,{title:"Transformations par Nuit",children:e.jsx("div",{style:{height:400},children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(R,{data:x,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:a,payload:r})=>e.jsx("text",{x:t,y:a,dy:16,textAnchor:"end",fill:i.highlightedPlayer===r.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:i.highlightedPlayer===r.value?14:13,fontWeight:i.highlightedPlayer===r.value?"bold":"italic",transform:`rotate(-45 ${t} ${a})`,children:r.value})}),e.jsx(W,{label:{value:"Transformations / nuit",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(k,{content:({active:t,payload:a})=>{if(t&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:r.player}),e.jsxs("div",{children:["Parties loup: ",r.wolfGamesPlayed]}),e.jsxs("div",{children:["Nuits vÃ©cues: ",r.totalNightsAsWolf]}),e.jsxs("div",{children:["Transformations: ",r.transformCount]}),e.jsxs("div",{style:{marginTop:"4px",fontWeight:"bold",color:p.Loup},children:["Ratio: ",r.transformsPerNight.toFixed(2)," / nuit"]}),r.isHighlightedAddition&&e.jsx("div",{style:{marginTop:"4px",color:"var(--accent-primary)",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"})]})}return null}}),e.jsx(w,{dataKey:"transformsPerNight",children:x.map((t,a)=>{const r=i.highlightedPlayer===t.player,o=T===t.player,n=t.isHighlightedAddition,s=S[t.player]||p.Loup||"var(--wolf-color)";return e.jsx(G,{fill:r?"var(--accent-primary)":n?"var(--accent-secondary)":s,stroke:r?"var(--accent-primary)":o?"#000000":"none",strokeWidth:r?3:o?2:0,strokeDasharray:n?"5,5":"none",opacity:n?.8:1,onMouseEnter:()=>f(t.player),onMouseLeave:()=>f(null)},`cell-transform-${a}`)})})]})})})})]}),v.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"ðŸº DÃ©transformations par Transformation (Loup)"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:"Ratio de retour Ã  forme humaine. Ã‰levÃ© = joueur qui se dÃ©transforme souvent (+prudent). Bas = reste transformÃ© longtemps (+agressif)."}),K&&i.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem"},children:['ðŸŽ¯ "',i.highlightedPlayer,'" affichÃ© en plus du top 20']})]}),e.jsx(N,{title:"DÃ©transformations par Transformation",children:e.jsx("div",{style:{height:400},children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(R,{data:v,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:a,payload:r})=>e.jsx("text",{x:t,y:a,dy:16,textAnchor:"end",fill:i.highlightedPlayer===r.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:i.highlightedPlayer===r.value?14:13,fontWeight:i.highlightedPlayer===r.value?"bold":"italic",transform:`rotate(-45 ${t} ${a})`,children:r.value})}),e.jsx(W,{label:{value:"Ratio dÃ©transform. / transform.",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(k,{content:({active:t,payload:a})=>{if(t&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:r.player}),e.jsxs("div",{children:["Parties loup: ",r.wolfGamesPlayed]}),e.jsxs("div",{children:["Transformations: ",r.transformCount]}),e.jsxs("div",{children:["DÃ©transformations: ",r.untransformCount]}),e.jsxs("div",{style:{marginTop:"4px",fontWeight:"bold",color:"var(--accent-secondary)"},children:["Ratio: ",(r.untransformPerTransform*100).toFixed(0),"%"]}),r.isHighlightedAddition&&e.jsx("div",{style:{marginTop:"4px",color:"var(--accent-primary)",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"})]})}return null}}),e.jsx(w,{dataKey:"untransformPerTransform",children:v.map((t,a)=>{const r=i.highlightedPlayer===t.player,o=T===t.player,n=t.isHighlightedAddition,s=S[t.player]||"var(--accent-secondary)";return e.jsx(G,{fill:r?"var(--accent-primary)":n?"var(--accent-secondary)":s,stroke:r?"var(--accent-primary)":o?"#000000":"none",strokeWidth:r?3:o?2:0,strokeDasharray:n?"5,5":"none",opacity:n?.8:1,onMouseEnter:()=>f(t.player),onMouseLeave:()=>f(null)},`cell-untransform-${a}`)})})]})})})})]}),j.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"ðŸŽ¯ PrÃ©cision du Chasseur"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:"Pourcentage de tirs rÃ©ussis (cible touchÃ©e) sur le total des tirs effectuÃ©s"}),U&&i.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem"},children:['ðŸŽ¯ "',i.highlightedPlayer,'" affichÃ© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem",marginTop:"0.5rem"},children:[e.jsx("label",{htmlFor:"min-hunter-games",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties avec tir:"}),e.jsx("select",{id:"min-hunter-games",value:g,onChange:t=>q(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:O.map(t=>e.jsxs("option",{value:t,children:[t,"+ parties"]},t))}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["(",J," joueurs Ã©ligibles)"]})]}),e.jsx(N,{title:"PrÃ©cision du Chasseur",children:e.jsx("div",{style:{height:400},children:e.jsx(M,{width:"100%",height:"100%",children:e.jsxs(R,{data:j,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:a,payload:r})=>e.jsx("text",{x:t,y:a,dy:16,textAnchor:"end",fill:i.highlightedPlayer===r.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:i.highlightedPlayer===r.value?14:13,fontWeight:i.highlightedPlayer===r.value?"bold":"italic",transform:`rotate(-45 ${t} ${a})`,children:r.value})}),e.jsx(W,{label:{value:"PrÃ©cision (%)",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(k,{content:({active:t,payload:a})=>{if(t&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:r.player}),e.jsxs("div",{children:["Parties avec tir: ",r.hunterGamesPlayed]}),e.jsxs("div",{children:["Tirs rÃ©ussis: ",r.hunterSuccessfulShots]}),e.jsxs("div",{children:["Tirs manquÃ©s: ",r.hunterMissedShots]}),e.jsxs("div",{children:["Total tirs: ",r.hunterTotalShots]}),e.jsxs("div",{style:{marginTop:"4px",fontWeight:"bold",color:p.Chasseur},children:["PrÃ©cision: ",r.hunterAccuracy.toFixed(1),"%"]}),r.isHighlightedAddition&&e.jsx("div",{style:{marginTop:"4px",color:"var(--accent-primary)",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"})]})}return null}}),e.jsx(w,{dataKey:"hunterAccuracy",children:j.map((t,a)=>{const r=i.highlightedPlayer===t.player,o=T===t.player,n=t.isHighlightedAddition,s=S[t.player]||p.Chasseur||"var(--chart-color-2)";return e.jsx(G,{fill:r?"var(--accent-primary)":n?"var(--accent-secondary)":s,stroke:r?"var(--accent-primary)":o?"#000000":"none",strokeWidth:r?3:o?2:0,strokeDasharray:n?"5,5":"none",opacity:n?.8:1,onMouseEnter:()=>f(t.player),onMouseLeave:()=>f(null)},`cell-hunter-${a}`)})})]})})})})]})]})]})}export{fe as RoleActionsRankingChart};
