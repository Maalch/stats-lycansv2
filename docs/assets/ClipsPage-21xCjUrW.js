import{h as le,a as ne,u as te,r,j as e}from"./index-BGmTEP1w.js";import{c as ce,d as C,g as k,p as ie,C as re,f as _,a as oe}from"./ClipViewer-BOd6L5px.js";import{u as de}from"./useJoueursData-QF_C3hMC.js";import{u as he,P as J}from"./api-BwJrdo4C.js";function xe(){const{data:I,isLoading:U,error:L}=le(),{joueursData:W}=de(),{settings:E}=ne(),{navigationFilters:R}=te(),[m,x]=r.useState(null),M=he(W),[u,w]=r.useState(""),[g,F]=r.useState([]),[y,S]=r.useState(""),[f,$]=r.useState("gameNumber"),[b,O]=r.useState("desc"),[t,h]=r.useState(J.INITIAL_PAGE),[v,z]=r.useState(J.ITEMS_PER_PAGE);r.useEffect(()=>{const s=R.selectedPlayer||E.highlightedPlayer;s&&S(s)},[R.selectedPlayer,E.highlightedPlayer]);const c=r.useMemo(()=>{if(!I)return[];const s=[];return I.forEach(a=>{a.Clips&&Array.isArray(a.Clips)&&a.Clips.forEach(l=>{s.push({...l,gameId:a.DisplayedId||a.Id,gameDate:a.StartDate,gameNumber:parseInt(a.DisplayedId||a.Id,10)})})}),s},[I]),V=r.useMemo(()=>ce(c).filter(a=>!a.toLowerCase().includes("warning")),[c]),H=r.useMemo(()=>{const s=new Set;return c.forEach(a=>{C(a).forEach(l=>s.add(l))}),Array.from(s).sort()},[c]),i=r.useMemo(()=>{let s=[...c];if(g.length>0&&(s=s.filter(a=>g.some(l=>(a.Tags||[]).some(d=>d.toLowerCase()===l.toLowerCase())))),y&&(s=s.filter(a=>C(a).some(l=>l.toLowerCase()===y.toLowerCase()))),u.trim()){const a=u.toLowerCase();s=s.filter(l=>{const n=k(l).toLowerCase(),d=l.AdditionalInfo?.toLowerCase()||"",A=l.ClipName?.toLowerCase()||"",se=C(l).join(" ").toLowerCase(),ae=l.gameId.toLowerCase();return n.includes(a)||d.includes(a)||A.includes(a)||se.includes(a)||ae.includes(a)})}return s.sort((a,l)=>{let n=0;switch(f){case"gameNumber":n=a.gameNumber-l.gameNumber;break;case"date":n=new Date(a.gameDate).getTime()-new Date(l.gameDate).getTime();break;case"name":n=k(a).localeCompare(k(l));break;case"pov":n=a.POVPlayer.localeCompare(l.POVPlayer);break;case"players":const d=C(a).length,A=C(l).length;n=d-A;break;default:n=0}return b==="asc"?n:-n}),s},[c,g,y,u,f,b]),o=Math.ceil(i.length/v),P=(t-1)*v,T=P+v,K=i.slice(P,T),Q=s=>{F(a=>a.includes(s)?a.filter(l=>l!==s):[...a,s]),h(1)},q=()=>{w(""),F([]),S(""),h(1)},B=s=>{x(s)},X=()=>{if(!m)return;const s=_(m,c);if(s){const a=c.find(l=>l.ClipId===s.ClipId);a&&x(a)}},Y=s=>{const a=c.find(l=>l.ClipId===s);a&&x(a)},G=()=>{if(i.length===0)return;const s=Math.floor(Math.random()*i.length),a=i[s];x(a)},j=s=>{f===s?O(b==="asc"?"desc":"asc"):($(s),O("desc")),h(1)},N=s=>f!==s?"â†•ï¸":b==="asc"?"â†—ï¸":"â†˜ï¸",p=s=>{h(s)},Z=s=>{z(s),h(1)},ee=s=>new Date(s).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});if(U)return e.jsx("div",{className:"lycans-clips-page",children:e.jsxs("div",{className:"lycans-clips-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des clips..."})]})});if(L)return e.jsx("div",{className:"lycans-clips-page",children:e.jsx("div",{className:"lycans-clips-error",children:e.jsxs("p",{children:["Erreur lors du chargement des clips : ",L]})})});if(c.length===0)return e.jsx("div",{className:"lycans-clips-page",children:e.jsxs("div",{className:"lycans-clips-empty",children:[e.jsx("div",{className:"lycans-clips-empty-icon",children:"ðŸŽ¬"}),e.jsx("h2",{children:"Aucun clip disponible"}),e.jsx("p",{children:"Il n'y a actuellement aucun clip enregistrÃ© dans les parties."})]})});const D=u.trim()||g.length>0||y;return e.jsxs("div",{className:"lycans-clips-page",children:[e.jsxs("div",{className:"lycans-clips-header",children:[e.jsx("h2",{children:"ðŸŽ¬ BibliothÃ¨que de Clips"}),e.jsxs("div",{className:"lycans-clips-count-row",children:[e.jsxs("p",{className:"lycans-clips-count",children:[i.length," clip",i.length!==1?"s":"",D&&` sur ${c.length}`]}),i.length>0&&e.jsx("button",{className:"lycans-clips-random-btn",onClick:G,title:"Lire un clip alÃ©atoire",children:"ðŸŽ² AlÃ©atoire"})]})]}),e.jsxs("div",{className:"lycans-clips-filters",children:[e.jsxs("div",{className:"lycans-clips-search",children:[e.jsx("input",{type:"text",placeholder:"Rechercher par nom, description, joueur, partie...",value:u,onChange:s=>{w(s.target.value),h(1)},className:"lycans-clips-search-input"}),u&&e.jsx("button",{className:"lycans-clips-search-clear",onClick:()=>{w(""),h(1)},title:"Effacer la recherche",children:"âœ•"})]}),e.jsxs("div",{className:"lycans-clips-filter-controls",children:[e.jsxs("div",{className:"lycans-clips-filter-group",children:[e.jsx("label",{htmlFor:"player-filter",children:"Joueur :"}),e.jsxs("select",{id:"player-filter",value:y,onChange:s=>{S(s.target.value),h(1)},className:"lycans-clips-select",children:[e.jsx("option",{value:"",children:"Tous les joueurs"}),H.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),D&&e.jsx("button",{className:"lycans-clips-clear-filters",onClick:q,children:"âœ• RÃ©initialiser les filtres"})]}),V.length>0&&e.jsxs("div",{className:"lycans-clips-tags-filter",children:[e.jsx("label",{children:"CatÃ©gories :"}),e.jsx("div",{className:"lycans-clips-tags-list",children:V.map(s=>e.jsxs("button",{className:`lycans-clips-tag-btn ${g.includes(s)?"active":""}`,onClick:()=>Q(s),children:[s,g.includes(s)&&e.jsx("span",{className:"tag-check",children:"âœ“"})]},s))})]})]}),i.length===0?e.jsxs("div",{className:"lycans-clips-no-results",children:[e.jsx("div",{className:"lycans-clips-no-results-icon",children:"ðŸ”"}),e.jsx("h3",{children:"Aucun clip trouvÃ©"}),e.jsx("p",{children:"Essayez de modifier vos filtres de recherche."}),D&&e.jsx("button",{className:"lycans-clips-clear-filters-btn",onClick:q,children:"RÃ©initialiser les filtres"})]}):e.jsxs(e.Fragment,{children:[o>1&&e.jsxs("div",{className:"lycans-pagination-container",children:[e.jsxs("div",{className:"lycans-pagination-info",children:["Affichage de ",P+1," Ã  ",Math.min(T,i.length)," sur ",i.length," clips"]}),e.jsxs("div",{className:"lycans-pagination-controls",children:[e.jsxs("select",{value:v,onChange:s=>Z(Number(s.target.value)),className:"lycans-pagination-select",children:[e.jsx("option",{value:10,children:"10 par page"}),e.jsx("option",{value:25,children:"25 par page"}),e.jsx("option",{value:50,children:"50 par page"}),e.jsx("option",{value:100,children:"100 par page"})]}),e.jsxs("div",{className:"lycans-pagination-buttons",children:[e.jsx("button",{onClick:()=>p(1),disabled:t===1,className:"lycans-pagination-btn",children:"Â«Â«"}),e.jsx("button",{onClick:()=>p(t-1),disabled:t===1,className:"lycans-pagination-btn",children:"â€¹"}),e.jsxs("span",{className:"lycans-pagination-current",children:["Page ",t," sur ",o]}),e.jsx("button",{onClick:()=>p(t+1),disabled:t===o,className:"lycans-pagination-btn",children:"â€º"}),e.jsx("button",{onClick:()=>p(o),disabled:t===o,className:"lycans-pagination-btn",children:"Â»Â»"})]})]})]}),e.jsx("div",{className:"lycans-clips-table-container",children:e.jsxs("table",{className:"lycans-clips-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>j("gameNumber"),className:"sortable",children:["Partie ",N("gameNumber")]}),e.jsxs("th",{onClick:()=>j("date"),className:"sortable",children:["Date ",N("date")]}),e.jsxs("th",{onClick:()=>j("name"),className:"sortable",children:["Nom ",N("name")]}),e.jsxs("th",{onClick:()=>j("pov"),className:"sortable",children:["POV ",N("pov")]}),e.jsxs("th",{onClick:()=>j("players"),className:"sortable",children:["Personnes impliquÃ©es ",N("players")]}),e.jsx("th",{children:"Tags"}),e.jsx("th",{children:"Voir"})]})}),e.jsx("tbody",{children:K.map(s=>{const a=ie(s.OthersPlayers),l=(s.Tags||[]).filter(n=>!n.toLowerCase().includes("warning"));return e.jsxs("tr",{className:"clickable-row",onClick:()=>B(s),style:{cursor:"pointer"},children:[e.jsxs("td",{children:["#",s.gameId]}),e.jsx("td",{children:ee(s.gameDate)}),e.jsx("td",{className:"lycans-clip-name-cell",children:k(s)}),e.jsx("td",{children:e.jsx("span",{className:"lycans-clip-pov-badge",style:{backgroundColor:M[s.POVPlayer]||"var(--accent-primary)",color:"white"},children:s.POVPlayer})}),e.jsx("td",{className:"lycans-clip-players-cell",children:a.length>0?a.map((n,d)=>e.jsxs("span",{style:{color:M[n]||"var(--text-secondary)",fontWeight:500},children:[n,d<a.length-1?", ":""]},d)):"-"}),e.jsx("td",{className:"lycans-clip-tags-cell",children:l.length>0?e.jsx("div",{className:"lycans-clip-tags-inline",children:l.map((n,d)=>e.jsx("span",{className:"lycans-clip-tag-small",children:n},d))}):"-"}),e.jsx("td",{children:e.jsx("button",{onClick:n=>{n.stopPropagation(),B(s)},className:"lycans-clip-view-btn",children:"ðŸŽ¬ Voir"})})]},s.ClipId)})})]})}),o>1&&e.jsxs("div",{className:"lycans-pagination-container",children:[e.jsxs("div",{className:"lycans-pagination-info",children:["Affichage de ",P+1," Ã  ",Math.min(T,i.length)," sur ",i.length," clips"]}),e.jsx("div",{className:"lycans-pagination-controls",children:e.jsxs("div",{className:"lycans-pagination-buttons",children:[e.jsx("button",{onClick:()=>p(1),disabled:t===1,className:"lycans-pagination-btn",children:"Â«Â«"}),e.jsx("button",{onClick:()=>p(t-1),disabled:t===1,className:"lycans-pagination-btn",children:"â€¹"}),e.jsxs("span",{className:"lycans-pagination-current",children:["Page ",t," sur ",o]}),e.jsx("button",{onClick:()=>p(t+1),disabled:t===o,className:"lycans-pagination-btn",children:"â€º"}),e.jsx("button",{onClick:()=>p(o),disabled:t===o,className:"lycans-pagination-btn",children:"Â»Â»"})]})})]})]}),m&&e.jsx(re,{clip:m,onClose:()=>x(null),relatedClips:oe(m,c),nextClip:_(m,c),onNextClip:X,onRelatedClip:Y,onRandomClip:G})]})}export{xe as ClipsPage};
