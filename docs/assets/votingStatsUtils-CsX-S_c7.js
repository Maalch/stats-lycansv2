import{g as O,a as D}from"./datasyncExport-BirWLS1z.js";import{D as L}from"./deathTypes-gHH1w6_X.js";import{f as H,g as B}from"./index-KCEoFXda.js";function J(p,V){if(!p.DeathTiming)return!0;const c=p.DeathTiming.toUpperCase();if(c.startsWith("M")){const l=parseInt(c.substring(1));return V<=l}if(c.startsWith("N")||c.startsWith("J")){const l=parseInt(c.substring(1));return V<l}return!0}function x(p,V){return p.PlayerStats.filter(c=>J(c,V))}function U(p,V,c){const l=p.PlayerStats.find(s=>B(s)===c);return l?l.DeathType===L.VOTED&&l.DeathTiming===`M${V}`:!1}function Y(p){const V=[],c=new Map,l=new Map,s=new Map;p.PlayerStats.forEach(r=>{const i=B(r),f=r.Username;c.set(i,{totalMeetings:0,totalVotes:0,totalSkips:0,totalAbstentions:0,displayName:f}),l.set(i,{totalVotes:0,votesForEnemyCamp:0,votesForOwnCamp:0}),s.set(i,{totalTimesTargeted:0,timesTargetedByEnemyCamp:0,timesTargetedByOwnCamp:0,timesTargetedAsVillager:0,timesTargetedAsWolf:0,timesTargetedAsSpecial:0,eliminationsByVote:0})});const u=Math.max(...p.PlayerStats.flatMap(r=>r.Votes.map(i=>i.Day||0)),0);for(let r=1;r<=u;r++){const i=x(p,r),f=p.PlayerStats.flatMap(a=>{const n=B(a);return a.Votes.filter(A=>A.Day===r).map(A=>({voterId:n,voterName:a.Username,vote:A,voterRole:a.MainRoleInitial}))});if(f.length===0&&p.EndTiming===`M${r}`)continue;const m=f.filter(a=>a.vote.Target!=="Passé").length,h=f.filter(a=>a.vote.Target==="Passé").length,y=i.length-f.length,t=new Map;f.filter(a=>a.vote.Target!=="Passé").forEach(a=>{const n=t.get(a.vote.Target)||0;t.set(a.vote.Target,n+1)});let o=null,e=0;for(const[a,n]of t.entries())n>e&&(o=a,e=n);let M=null;if(o&&e>0){const a=p.PlayerStats.find(n=>n.Username===o);if(a){const n=B(a);U(p,r,n)&&(M=a.Username)}}V.push({meetingNumber:r,totalParticipants:i.length,totalVotes:m,totalSkips:h,totalAbstentions:y,participationRate:i.length>0?(m+h)/i.length*100:0,mostTargetedPlayer:o,mostTargetedCount:e,eliminatedPlayer:M}),i.forEach(a=>{const n=B(a),A=c.get(n);A.totalMeetings++,A.displayName=a.Username;const b=f.find(E=>E.voterId===n);if(b)if(b.vote.Target==="Passé")A.totalSkips++;else{A.totalVotes++;const E=l.get(n);E.totalVotes++;const k=O(D(a.MainRoleInitial,a.MainRoleChanges||[]),{regroupWolfSubRoles:!0}),C=p.PlayerStats.find(w=>w.Username===b.vote.Target);if(C){const w=B(C),P=O(D(C.MainRoleInitial,C.MainRoleChanges||[]),{regroupWolfSubRoles:!0});k===P?E.votesForOwnCamp++:E.votesForEnemyCamp++;const F=s.get(w);F.totalTimesTargeted++,k===P?F.timesTargetedByOwnCamp++:F.timesTargetedByEnemyCamp++;const T=D(C.MainRoleInitial,C.MainRoleChanges||[]),v=O(T,{regroupWolfSubRoles:!0});v==="Villageois"?F.timesTargetedAsVillager++:v==="Loup"?F.timesTargetedAsWolf++:F.timesTargetedAsSpecial++,U(p,r,w)&&F.eliminationsByVote++}}else A.totalAbstentions++})}const g=[],S=[],d=[];return p.PlayerStats.forEach(r=>{const i=B(r),f=r.Username,m=c.get(i),h=m.totalMeetings>0?m.totalVotes/m.totalMeetings*100:0,y=m.totalMeetings>0?m.totalSkips/m.totalMeetings*100:0,t=m.totalMeetings>0?m.totalAbstentions/m.totalMeetings*100:0,o=h-y*.5-t*.7;g.push({playerName:f,totalMeetings:m.totalMeetings,totalVotes:m.totalVotes,totalSkips:m.totalSkips,totalAbstentions:m.totalAbstentions,votingRate:h,skippingRate:y,abstentionRate:t,aggressivenessScore:o});const e=l.get(i),M=e.totalVotes>0?e.votesForEnemyCamp/e.totalVotes*100:0,a=e.totalVotes>0?e.votesForOwnCamp/e.totalVotes*100:0;S.push({playerName:f,totalMeetings:m.totalMeetings,totalVotes:e.totalVotes,votesForEnemyCamp:e.votesForEnemyCamp,votesForOwnCamp:e.votesForOwnCamp,accuracyRate:M,friendlyFireRate:a});const n=s.get(i),A=n.totalTimesTargeted>0?(n.totalTimesTargeted-n.eliminationsByVote)/n.totalTimesTargeted*100:100;d.push({playerName:f,totalMeetings:m.totalMeetings,totalTimesTargeted:n.totalTimesTargeted,timesTargetedByEnemyCamp:n.timesTargetedByEnemyCamp,timesTargetedByOwnCamp:n.timesTargetedByOwnCamp,timesTargetedAsVillager:n.timesTargetedAsVillager,timesTargetedAsWolf:n.timesTargetedAsWolf,timesTargetedAsSpecial:n.timesTargetedAsSpecial,eliminationsByVote:n.eliminationsByVote,survivalRate:A})}),{gameId:p.Id,totalMeetings:u,meetingAnalytics:V,playerBehaviors:g,playerAccuracies:S,playerTargetStats:d}}function K(p){const V=new Map;return p.filter(l=>!l.Modded||!l.Version?!1:H(l.Version,"0.201")).forEach(l=>{const s=new Map;l.PlayerStats.forEach(u=>{!u.Votes||u.Votes.length===0||u.Votes.forEach(g=>{if(!g.Date||g.Target==="Passé")return;const S=s.get(g.Day)||[];S.push({playerName:u.Username,date:new Date(g.Date),target:g.Target}),s.set(g.Day,S)})}),s.forEach(u=>{if(u.length===0)return;const g=[...u].sort((d,r)=>d.date.getTime()-r.date.getTime()),S=g[0].date.getTime();g.forEach((d,r)=>{const i=V.get(d.playerName)||{totalActiveVotes:0,totalTimedVotes:0,positionPercentileSum:0,timesFirstVoter:0,timesLastVoter:0,earlyVotes:0,lateVotes:0,voteDelaySum:0};i.totalActiveVotes++,i.totalTimedVotes++;const f=g.length>1?r/(g.length-1)*100:50;i.positionPercentileSum+=f,r===0&&i.timesFirstVoter++,r===g.length-1&&i.timesLastVoter++;const m=Math.ceil(g.length/3),h=g.length-Math.ceil(g.length/3);r<m&&i.earlyVotes++,r>=h&&i.lateVotes++;const y=(d.date.getTime()-S)/1e3;i.voteDelaySum+=y,V.set(d.playerName,i)})})}),Array.from(V.entries()).map(([l,s])=>{const u=s.totalTimedVotes>0?s.positionPercentileSum/s.totalTimedVotes:50,g=s.totalTimedVotes>0?s.earlyVotes/s.totalTimedVotes*100:0,S=s.totalTimedVotes>0?s.lateVotes/s.totalTimedVotes*100:0,d=s.totalTimedVotes>0?s.voteDelaySum/s.totalTimedVotes:0;return{playerName:l,totalActiveVotes:s.totalActiveVotes,totalTimedVotes:s.totalTimedVotes,averageVotePositionPercentile:u,timesFirstVoter:s.timesFirstVoter,timesLastVoter:s.timesLastVoter,earlyVoterRate:g,lateVoterRate:S,averageVoteDelaySeconds:d}})}function Q(p){const V=new Map,c=new Map,l=new Map;l.set("Villageois",0),l.set("Loup",0),l.set("Solo Rôles",0);let s=0,u=0,g=0,S=0,d=0,r=0,i=0,f=0,m=0;p.forEach(o=>{const e=Math.max(...o.PlayerStats.flatMap(M=>M.Votes.map(a=>a.Day)),0);if(e!==0)for(let M=1;M<=e;M++){const a=x(o,M),n=o.PlayerStats.flatMap(T=>T.Votes.filter(v=>v.Day===M).map(v=>({voter:T.Username,vote:v,voterStats:T})));if(n.length===0&&o.EndTiming===`M${M}`)continue;const A=n.filter(T=>T.vote.Target!=="Passé").length,b=n.filter(T=>T.vote.Target==="Passé").length,E=a.length-n.length;u++,g+=A,S+=b,d+=E;const k=a.length>0?A/a.length*100:0,C=a.length>0?b/a.length*100:0,w=a.length>0?E/a.length*100:0;r+=k,i+=C,f+=w,m++;const P=V.get(M)||{meetings:0,totalVotingRates:0,totalSkipRates:0,totalAbstentionRates:0};P.meetings++,P.totalVotingRates+=k,P.totalSkipRates+=C,P.totalAbstentionRates+=w,V.set(M,P),n.filter(T=>T.vote.Target!=="Passé").forEach(({voterStats:T,vote:v})=>{const N=D(T.MainRoleInitial,T.MainRoleChanges||[]),R=O(N,{regroupWolfSubRoles:!0}),W=o.PlayerStats.find(_=>_.Username===v.Target);if(!W)return;const G=D(W.MainRoleInitial,W.MainRoleChanges||[]),$=O(G,{regroupWolfSubRoles:!0}),I=c.get(R)||{totalVotes:0,votesForOppositeCamp:0,votesForOwnCamp:0};I.totalVotes++,R===$?I.votesForOwnCamp++:I.votesForOppositeCamp++,c.set(R,I)}),o.PlayerStats.filter(T=>T.DeathType===L.VOTED&&T.DeathTiming===`M${M}`).forEach(T=>{s++;const v=D(T.MainRoleInitial,T.MainRoleChanges||[]),N=O(v,{regroupWolfSubRoles:!0});let R;N==="Villageois"?R="Villageois":N==="Loup"?R="Loup":R="Solo Rôles",l.set(R,(l.get(R)||0)+1)})}});const h=Array.from(V.entries()).map(([o,e])=>({meetingDay:o,totalMeetings:e.meetings,averageVotingRate:e.meetings>0?e.totalVotingRates/e.meetings:0,averageSkipRate:e.meetings>0?e.totalSkipRates/e.meetings:0,averageAbstentionRate:e.meetings>0?e.totalAbstentionRates/e.meetings:0})).sort((o,e)=>o.meetingDay-e.meetingDay),y=Array.from(c.entries()).map(([o,e])=>({campName:o,totalVotes:e.totalVotes,votesForOppositeCamp:e.votesForOppositeCamp,votesForOwnCamp:e.votesForOwnCamp,accuracyRate:e.totalVotes>0?e.votesForOppositeCamp/e.totalVotes*100:0,friendlyFireRate:e.totalVotes>0?e.votesForOwnCamp/e.totalVotes*100:0})).sort((o,e)=>e.accuracyRate-o.accuracyRate),t=Array.from(l.entries()).filter(([o,e])=>e>0).map(([o,e])=>({campName:o,eliminations:e,percentage:s>0?e/s*100:0})).sort((o,e)=>e.eliminations-o.eliminations);return{totalMeetings:u,totalVotes:g,totalSkips:S,totalAbstentions:d,averageVotingRate:m>0?r/m:0,averageSkipRate:m>0?i/m:0,averageAbstentionRate:m>0?f/m:0,meetingDayStats:h,campVotingStats:y,campEliminationStats:t,totalEliminations:s}}function X(p){const V=p.map(Y),c=new Map,l=new Map,s=new Map;let u=0,g=0,S=0,d=0,r=0,i=0;V.forEach(y=>{u+=y.totalMeetings,y.meetingAnalytics.forEach(t=>{g+=t.participationRate,S++,d+=t.totalVotes,r+=t.totalSkips,i+=t.totalAbstentions}),y.playerBehaviors.forEach(t=>{const o=c.get(t.playerName)||{totalMeetings:0,totalVotes:0,totalSkips:0,totalAbstentions:0};c.set(t.playerName,{totalMeetings:o.totalMeetings+t.totalMeetings,totalVotes:o.totalVotes+t.totalVotes,totalSkips:o.totalSkips+t.totalSkips,totalAbstentions:o.totalAbstentions+t.totalAbstentions})}),y.playerAccuracies.forEach(t=>{const o=l.get(t.playerName)||{totalMeetings:0,totalVotes:0,votesForEnemyCamp:0,votesForOwnCamp:0};l.set(t.playerName,{totalMeetings:o.totalMeetings+t.totalMeetings,totalVotes:o.totalVotes+t.totalVotes,votesForEnemyCamp:o.votesForEnemyCamp+t.votesForEnemyCamp,votesForOwnCamp:o.votesForOwnCamp+t.votesForOwnCamp})}),y.playerTargetStats.forEach(t=>{const o=s.get(t.playerName)||{totalMeetings:0,totalTimesTargeted:0,timesTargetedByEnemyCamp:0,timesTargetedByOwnCamp:0,timesTargetedAsVillager:0,timesTargetedAsWolf:0,timesTargetedAsSpecial:0,eliminationsByVote:0};s.set(t.playerName,{totalMeetings:o.totalMeetings+t.totalMeetings,totalTimesTargeted:o.totalTimesTargeted+t.totalTimesTargeted,timesTargetedByEnemyCamp:o.timesTargetedByEnemyCamp+t.timesTargetedByEnemyCamp,timesTargetedByOwnCamp:o.timesTargetedByOwnCamp+t.timesTargetedByOwnCamp,timesTargetedAsVillager:o.timesTargetedAsVillager+t.timesTargetedAsVillager,timesTargetedAsWolf:o.timesTargetedAsWolf+t.timesTargetedAsWolf,timesTargetedAsSpecial:o.timesTargetedAsSpecial+t.timesTargetedAsSpecial,eliminationsByVote:o.eliminationsByVote+t.eliminationsByVote})})});const f=Array.from(c.entries()).map(([y,t])=>{const o=t.totalMeetings>0?t.totalVotes/t.totalMeetings*100:0,e=t.totalMeetings>0?t.totalSkips/t.totalMeetings*100:0,M=t.totalMeetings>0?t.totalAbstentions/t.totalMeetings*100:0,a=o-e*.5-M*.7;return{playerName:y,totalMeetings:t.totalMeetings,totalVotes:t.totalVotes,totalSkips:t.totalSkips,totalAbstentions:t.totalAbstentions,votingRate:o,skippingRate:e,abstentionRate:M,aggressivenessScore:a}}),m=Array.from(l.entries()).map(([y,t])=>{const o=t.totalVotes>0?t.votesForEnemyCamp/t.totalVotes*100:0,e=t.totalVotes>0?t.votesForOwnCamp/t.totalVotes*100:0;return{playerName:y,totalMeetings:t.totalMeetings,totalVotes:t.totalVotes,votesForEnemyCamp:t.votesForEnemyCamp,votesForOwnCamp:t.votesForOwnCamp,accuracyRate:o,friendlyFireRate:e}}),h=Array.from(s.entries()).map(([y,t])=>{const o=t.totalTimesTargeted>0?(t.totalTimesTargeted-t.eliminationsByVote)/t.totalTimesTargeted*100:100;return{playerName:y,totalMeetings:t.totalMeetings,totalTimesTargeted:t.totalTimesTargeted,timesTargetedByEnemyCamp:t.timesTargetedByEnemyCamp,timesTargetedByOwnCamp:t.timesTargetedByOwnCamp,timesTargetedAsVillager:t.timesTargetedAsVillager,timesTargetedAsWolf:t.timesTargetedAsWolf,timesTargetedAsSpecial:t.timesTargetedAsSpecial,eliminationsByVote:t.eliminationsByVote,survivalRate:o}});return{playerBehaviorStats:f,playerAccuracyStats:m,playerTargetStats:h,overallMeetingStats:{totalMeetings:u,averageParticipationRate:S>0?g/S:0,totalVotes:d,totalSkips:r,totalAbstentions:i}}}export{K as a,Q as b,X as c};
