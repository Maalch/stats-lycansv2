import{g as O,e as K,u as V,a as X,r as S,j as e}from"./index-Dn3O4-e6.js";import{a as Y}from"./baseStatsHook-BKS9nzUX.js";import{b as J,c as U}from"./datasyncExport-BirWLS1z.js";import{u as Q}from"./useJoueursData-P1fdQefL.js";import{M as Z,u as ee,C as A,c as te}from"./api-CE4lPatC.js";import{F as D,C as z,X as G,Y as M}from"./FullscreenChart-BCOflSig.js";import{R as I,T as R,a as N}from"./CategoricalChart-BAXJGr_q.js";import{B as k,a as H}from"./BarChart-CKlIVSLi.js";function re(p){return p.PlayerStats.some(m=>m.TotalCollectedLoot!==void 0&&m.TotalCollectedLoot!==null)}function ae(p,m="all"){if(!p||p.length===0)return null;const x=p.filter(re);if(x.length===0)return{playerStats:[],totalGames:p.length,gamesWithLootData:0};const a=new Map;return x.forEach(v=>{v.PlayerStats.forEach(l=>{const u=O(l),T=K(l);if(l.TotalCollectedLoot===void 0||l.TotalCollectedLoot===null||m!=="all"&&J(l.MainRoleInitial,l.Power)!=={all:"",villageois:"Villageois",loup:"Loup",autres:"Autres"}[m])return;const f=l.DeathDateIrl||v.EndDate,n=U(v.StartDate,f);if(!n||n<=0)return;a.has(u)||a.set(u,{displayName:T,gamesPlayed:0,totalLoot:0,maxLootInGame:0,recordGameId:v.DisplayedId,totalGameDurationSeconds:0});const j=a.get(u);j.gamesPlayed++,j.totalLoot+=l.TotalCollectedLoot,l.TotalCollectedLoot>j.maxLootInGame&&(j.maxLootInGame=l.TotalCollectedLoot,j.recordGameId=v.DisplayedId),j.totalGameDurationSeconds+=n})}),{playerStats:Array.from(a.entries()).map(([v,l])=>{const u=l.totalGameDurationSeconds>0?3600/l.totalGameDurationSeconds:0;return{player:l.displayName,gamesPlayed:l.gamesPlayed,totalLoot:l.totalLoot,averageLoot:l.gamesPlayed>0?l.totalLoot/l.gamesPlayed:0,maxLootInGame:l.maxLootInGame,recordGameId:l.recordGameId,totalGameDurationSeconds:l.totalGameDurationSeconds,lootPer60Min:l.totalLoot*u}}),totalGames:p.length,gamesWithLootData:x.length}}function oe(p="all"){const{data:m,isLoading:x,error:a}=Y(c=>ae(c,p));return{data:m,isLoading:x,error:a}}const ie=te.COMPACT;function me(){const{navigateToGameDetails:p,navigationState:m,updateNavigationState:x}=V(),{settings:a}=X(),[c,v]=S.useState(m.lootStatsState?.minGames||Z.STANDARD),[l,u]=S.useState(m.lootStatsState?.campFilter||"all"),[T,f]=S.useState(null),{data:n,isLoading:j,error:b}=oe(l),{joueursData:F}=Q(),C=ee(F);S.useEffect(()=>{const r=m.lootStatsState;(!r||r.minGames!==c||r.campFilter!==l)&&x({lootStatsState:{minGames:c,campFilter:l}})},[c,l,x]);const{totalLootChartData:W,highlightedPlayerAddedTotal:w}=S.useMemo(()=>{if(!n?.playerStats)return{totalLootChartData:[],highlightedPlayerAddedTotal:!1};const r=n.playerStats,i=r.sort((s,o)=>o.totalLoot-s.totalLoot).slice(0,A.TOP_20),t=a.highlightedPlayer&&i.some(s=>s.player===a.highlightedPlayer);let d=[...i],g=!1;if(a.highlightedPlayer&&!t){const s=r.find(o=>o.player===a.highlightedPlayer);s&&(d.push({...s,isHighlightedAddition:!0}),g=!0)}return{totalLootChartData:d,highlightedPlayerAddedTotal:g}},[n,a.highlightedPlayer]),{recordLootChartData:E,highlightedPlayerAddedRecord:q}=S.useMemo(()=>{if(!n?.playerStats)return{recordLootChartData:[],highlightedPlayerAddedRecord:!1};const r=n.playerStats,i=r.sort((s,o)=>o.maxLootInGame-s.maxLootInGame).slice(0,A.TOP_20),t=a.highlightedPlayer&&i.some(s=>s.player===a.highlightedPlayer);let d=[...i],g=!1;if(a.highlightedPlayer&&!t){const s=r.find(o=>o.player===a.highlightedPlayer);s&&(d.push({...s,isHighlightedAddition:!0}),g=!0)}return{recordLootChartData:d,highlightedPlayerAddedRecord:g}},[n,a.highlightedPlayer]),{normalizedLootChartData:B,highlightedPlayerAddedNormalized:_}=S.useMemo(()=>{if(!n?.playerStats)return{normalizedLootChartData:[],highlightedPlayerAddedNormalized:!1};const r=n.playerStats,t=r.filter(o=>o.gamesPlayed>=c).sort((o,h)=>h.lootPer60Min-o.lootPer60Min).slice(0,A.TOP_20),d=a.highlightedPlayer&&t.some(o=>o.player===a.highlightedPlayer);let g=[...t],s=!1;if(a.highlightedPlayer&&!d){const o=r.find(h=>h.player===a.highlightedPlayer);o&&(g.push({...o,isHighlightedAddition:!0}),s=!0)}return{normalizedLootChartData:g,highlightedPlayerAddedNormalized:s}},[n,c,a.highlightedPlayer]);if(j)return e.jsx("div",{className:"donnees-attente",children:"R√©cup√©ration des statistiques de loot..."});if(b)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",b]});if(!n)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de loot disponible"});const $=n.playerStats.filter(r=>r.gamesPlayed>=c).length;return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques de R√©colte"}),e.jsxs("p",{className:"lycans-stats-info",children:[n.gamesWithLootData," parties avec donn√©es de r√©colte."]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Total Loot Collect√©"}),w&&a.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',a.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:l,onChange:r=>u(r.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"villageois",children:"Camp Villageois"}),e.jsx("option",{value:"loup",children:"Camp Loup"}),e.jsx("option",{value:"autres",children:"Autres (Solo)"})]})]}),e.jsx(D,{title:"Total Loot Collect√©",children:e.jsx("div",{style:{height:400},children:e.jsx(I,{width:"100%",height:"100%",children:e.jsxs(k,{data:W,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(z,{strokeDasharray:"3 3"}),e.jsx(G,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:r,y:i,payload:t})=>e.jsx("text",{x:r,y:i,dy:16,textAnchor:"end",fill:a.highlightedPlayer===t.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:a.highlightedPlayer===t.value?14:13,fontWeight:a.highlightedPlayer===t.value?"bold":"italic",transform:`rotate(-45 ${r} ${i})`,children:t.value})}),e.jsx(M,{label:{value:"Loot total collect√©",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(R,{content:({active:r,payload:i})=>{if(r&&i&&i.length>0){const t=i[0].payload,d=t.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:t.player}),e.jsxs("div",{children:["Parties jou√©es: ",t.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Loot collect√©:"})}),e.jsxs("div",{children:["Total: ",t.totalLoot.toLocaleString()]}),e.jsxs("div",{children:["Moyenne par partie: ",t.averageLoot.toFixed(1)]}),e.jsxs("div",{children:["Taux (par 60 min): ",t.lootPer60Min.toFixed(1)]}),d&&e.jsxs("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:["üéØ Affich√© via s√©lection personnelle",t.gamesPlayed<c&&` (< ${c} parties)`]})]})}return null}}),e.jsx(H,{dataKey:"totalLoot",shape:r=>{const{x:i,y:t,width:d,height:g,payload:s}=r,o=s,h=a.highlightedPlayer===o.player,P=T===o.player,y=o.isHighlightedAddition,L=C[o.player]||"var(--chart-primary)";return e.jsx(N,{x:i,y:t,width:d,height:g,fill:h?"var(--accent-primary)":y?"var(--accent-secondary)":L,stroke:h?"var(--accent-primary)":P?"#000000":"none",strokeWidth:h?3:P?2:0,strokeDasharray:y?"5,5":"none",opacity:y?.8:1,onClick:()=>p({selectedPlayer:o.player,fromComponent:"Total Loot Collect√©"}),onMouseEnter:()=>f(o.player),onMouseLeave:()=>f(null),style:{cursor:"pointer"}})}})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",W.length," des joueurs (tous joueurs inclus)"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Calcul√© sur ",n.gamesWithLootData," parties avec donn√©es de loot"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Taux de R√©colte (par 60 min)"}),_&&a.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',a.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select-normalized",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select-normalized",value:l,onChange:r=>u(r.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"villageois",children:"Camp Villageois"}),e.jsx("option",{value:"loup",children:"Camp Loup"}),e.jsx("option",{value:"autres",children:"Autres (Solo)"})]}),e.jsx("label",{htmlFor:"min-games-select-normalized",style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginLeft:"1rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select-normalized",value:c,onChange:r=>v(Number(r.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:ie.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsx(D,{title:"Taux de R√©colte (par 60 min)",children:e.jsx("div",{style:{height:400},children:e.jsx(I,{width:"100%",height:"100%",children:e.jsxs(k,{data:B,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(z,{strokeDasharray:"3 3"}),e.jsx(G,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:r,y:i,payload:t})=>e.jsx("text",{x:r,y:i,dy:16,textAnchor:"end",fill:a.highlightedPlayer===t.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:a.highlightedPlayer===t.value?14:13,fontWeight:a.highlightedPlayer===t.value?"bold":"italic",transform:`rotate(-45 ${r} ${i})`,children:t.value})}),e.jsx(M,{label:{value:"Loot par 60 minutes",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(R,{content:({active:r,payload:i})=>{if(r&&i&&i.length>0){const t=i[0].payload,d=t.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:t.player}),e.jsxs("div",{children:["Parties jou√©es: ",t.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Taux normalis√© (par 60 min):"})}),e.jsxs("div",{children:[t.lootPer60Min.toFixed(1)," loot/heure"]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Statistiques globales:"})}),e.jsxs("div",{children:["Total: ",t.totalLoot.toLocaleString()]}),e.jsxs("div",{children:["Moyenne par partie: ",t.averageLoot.toFixed(1)]}),d&&e.jsxs("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:["üéØ Affich√© via s√©lection personnelle",t.gamesPlayed<c&&` (< ${c} parties)`]})]})}return null}}),e.jsx(H,{dataKey:"lootPer60Min",shape:r=>{const{x:i,y:t,width:d,height:g,payload:s}=r,o=s,h=a.highlightedPlayer===o.player,P=T===o.player,y=o.isHighlightedAddition,L=C[o.player]||"var(--chart-primary)";return e.jsx(N,{x:i,y:t,width:d,height:g,fill:h?"var(--accent-primary)":y?"var(--accent-secondary)":L,stroke:h?"var(--accent-primary)":P?"#000000":"none",strokeWidth:h?3:P?2:0,strokeDasharray:y?"5,5":"none",opacity:y?.8:1,onClick:()=>p({selectedPlayer:o.player,fromComponent:"Taux de R√©colte (par 60 min)"}),onMouseEnter:()=>f(o.player),onMouseLeave:()=>f(null),style:{cursor:"pointer"}})}})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",B.length," des joueurs (sur ",$," ayant au moins ",c," partie",c>1?"s":"",")"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Taux normalis√© par 60 minutes de jeu ¬∑ Calcul√© sur ",n.gamesWithLootData," parties avec donn√©es"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Record de Loot par Partie"}),q&&a.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',a.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select-record",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select-record",value:l,onChange:r=>u(r.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"villageois",children:"Camp Villageois"}),e.jsx("option",{value:"loup",children:"Camp Loup"}),e.jsx("option",{value:"autres",children:"Autres (Solo)"})]})]}),e.jsx(D,{title:"Record de Loot par Partie",children:e.jsx("div",{style:{height:400},children:e.jsx(I,{width:"100%",height:"100%",children:e.jsxs(k,{data:E,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(z,{strokeDasharray:"3 3"}),e.jsx(G,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:r,y:i,payload:t})=>e.jsx("text",{x:r,y:i,dy:16,textAnchor:"end",fill:a.highlightedPlayer===t.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:a.highlightedPlayer===t.value?14:13,fontWeight:a.highlightedPlayer===t.value?"bold":"italic",transform:`rotate(-45 ${r} ${i})`,children:t.value})}),e.jsx(M,{label:{value:"Loot record en une partie",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(R,{content:({active:r,payload:i})=>{if(r&&i&&i.length>0){const t=i[0].payload,d=t.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:t.player}),e.jsxs("div",{children:["Parties jou√©es: ",t.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Record de loot:"})}),e.jsxs("div",{children:[t.maxLootInGame.toLocaleString()," loot en une partie"]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Statistiques globales:"})}),e.jsxs("div",{children:["Total: ",t.totalLoot.toLocaleString()]}),e.jsxs("div",{children:["Moyenne par partie: ",t.averageLoot.toFixed(1)]}),d&&e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:"üéØ Affich√© via s√©lection personnelle"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir la partie record"})]})}return null}}),e.jsx(H,{dataKey:"maxLootInGame",shape:r=>{const{x:i,y:t,width:d,height:g,payload:s}=r,o=s,h=a.highlightedPlayer===o.player,P=T===o.player,y=o.isHighlightedAddition,L=C[o.player]||"var(--chart-primary)";return e.jsx(N,{x:i,y:t,width:d,height:g,fill:h?"var(--accent-primary)":y?"var(--accent-secondary)":L,stroke:h?"var(--accent-primary)":P?"#000000":"none",strokeWidth:h?3:P?2:0,strokeDasharray:y?"5,5":"none",opacity:y?.8:1,onClick:()=>p({selectedPlayer:o.player,selectedGame:o.recordGameId,fromComponent:"Record de Loot"}),onMouseEnter:()=>f(o.player),onMouseLeave:()=>f(null),style:{cursor:"pointer"}})}})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",E.length," des joueurs (tous joueurs inclus)"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Meilleur score de loot collect√© en une seule partie ¬∑ Calcul√© sur ",n.gamesWithLootData," parties avec donn√©es"]})]})]})]})}export{me as LootStatisticsChart};
