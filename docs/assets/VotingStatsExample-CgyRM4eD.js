import{j as t}from"./index-B-3U2JpG.js";import{a as V}from"./baseStatsHook-1zn2Sakt.js";import{g as m,a as B}from"./gameUtils-C0qLdSzT.js";function E(n){if(n.length===0)return null;let o=0,i=0,s=0;n.forEach(r=>{let c=!1;r.PlayerStats.forEach(l=>{l.Votes&&l.Votes.length>0&&(c=!0,l.Votes.forEach(h=>{h.Target==="Passé"?i++:o++}))}),c&&s++});const d=o+i;return{totalVotes:o,totalAbstentions:i,participationRate:d>0?o/d*100:0,averageVotesPerGame:s>0?o/s:0,averageAbstentionsPerGame:s>0?i/s:0,totalGamesWithVotes:s}}function w(n){if(n.length===0)return[];const o={};return n.forEach(i=>{i.PlayerStats.forEach(s=>{const d=s.Username.trim();if(!d||!s.Votes)return;o[d]||(o[d]={player:d,role:m(s.MainRoleInitial),totalVotesCast:0,totalAbstentions:0,participationRate:0,averageVotesPerGame:0,votesPerMeeting:[],targetsVoted:{},mostTargetedPlayer:null,targetsVotedCount:0,gamesParticipated:0,survivedToMeeting:[],earlyVoter:!1,roleBasedBehavior:{asVillageois:{},asLoup:{},asOther:{}}});const r=o[d];r.gamesParticipated++;const c=s.Votes.length;r.survivedToMeeting.push(c),s.Votes.forEach(p=>{p.Target==="Passé"?r.totalAbstentions++:(r.totalVotesCast++,r.targetsVoted[p.Target]||(r.targetsVoted[p.Target]=0),r.targetsVoted[p.Target]++)});const l=m(s.MainRoleInitial)==="Villageois"?"asVillageois":m(s.MainRoleInitial)==="Loup"?"asLoup":"asOther";r.roleBasedBehavior[l].totalVotesCast||(r.roleBasedBehavior[l]={totalVotesCast:0,totalAbstentions:0,targetsVoted:{},gamesParticipated:0});const h=r.roleBasedBehavior[l];h.gamesParticipated!==void 0&&h.gamesParticipated++})}),Object.values(o).forEach(i=>{const s=i.totalVotesCast+i.totalAbstentions;i.participationRate=s>0?i.totalVotesCast/s*100:0,i.averageVotesPerGame=i.gamesParticipated>0?i.totalVotesCast/i.gamesParticipated:0;let d=0,r=null;Object.entries(i.targetsVoted).forEach(([c,l])=>{l>d&&(d=l,r=c)}),i.mostTargetedPlayer=r,i.targetsVotedCount=Object.keys(i.targetsVoted).length}),Object.values(o).sort((i,s)=>s.totalVotesCast-i.totalVotesCast)}function M(n){if(n.length===0)return[];const o={},i=new Set;return n.forEach(s=>{s.PlayerStats.forEach(d=>{i.add(d.Username.trim())})}),i.forEach(s=>{s&&(o[s]={player:s,timesTargeted:0,targetedByPlayers:{},targetedByRoles:{},targetingPressure:0,survivalAfterBeingTargeted:0,mostFrequentAttacker:null,gamesTargeted:0})}),n.forEach(s=>{const d=new Set;s.PlayerStats.forEach(r=>{r.Votes&&r.Votes.forEach(c=>{if(c.Target!=="Passé"&&o[c.Target]){const l=o[c.Target];l.timesTargeted++,d.add(c.Target),l.targetedByPlayers[r.Username]||(l.targetedByPlayers[r.Username]=0),l.targetedByPlayers[r.Username]++,l.targetedByRoles[m(r.MainRoleInitial)]||(l.targetedByRoles[m(r.MainRoleInitial)]=0),l.targetedByRoles[m(r.MainRoleInitial)]++}})}),d.forEach(r=>{o[r].gamesTargeted++})}),Object.values(o).forEach(s=>{s.targetingPressure=s.gamesTargeted>0?s.timesTargeted/s.gamesTargeted:0;let d=0,r=null;Object.entries(s.targetedByPlayers).forEach(([c,l])=>{l>d&&(d=l,r=c)}),s.mostFrequentAttacker=r}),Object.values(o).filter(s=>s.timesTargeted>0).sort((s,d)=>d.timesTargeted-s.timesTargeted)}function S(n){return n.map(o=>{const i=[],s=Math.max(...o.PlayerStats.map(e=>e.Votes?e.Votes.length:0));for(let e=0;e<s;e++){const x=[],f=new Set;o.PlayerStats.forEach(g=>{g.Votes&&g.Votes[e]&&(f.add(g.Username),x.push({voter:g.Username,target:g.Votes[e].Target,role:m(g.MainRoleInitial)}))});const u=x.filter(g=>g.target!=="Passé").length,j=x.filter(g=>g.target==="Passé").length,y={};x.forEach(g=>{g.target!=="Passé"&&(y[g.target]=(y[g.target]||0)+1)});const v=Object.entries(y).sort(([,g],[,C])=>C-g)[0]?.[0]||null,T=u,A=Math.max(...Object.values(y),0),R=T>0?A/T:0;i.push({meetingNumber:e+1,totalParticipants:f.size,totalVotesCast:u,totalAbstentions:j,participationRate:f.size>0?u/f.size*100:0,playersWhoVoted:x.filter(g=>g.target!=="Passé").map(g=>g.voter),playersWhoAbstained:x.filter(g=>g.target==="Passé").map(g=>g.voter),voteTargets:y,mostTargetedPlayer:v,consensusLevel:R})}const d=o.PlayerStats.flatMap(e=>e.Votes||[]),r=d.filter(e=>e.Target!=="Passé").length,c=d.length,h=o.PlayerStats.map(e=>({player:e.Username,votes:e.Votes?e.Votes.filter(x=>x.Target!=="Passé").length:0})).sort((e,x)=>x.votes-e.votes)[0]?.player||null,p={};d.forEach(e=>{e.Target!=="Passé"&&(p[e.Target]=(p[e.Target]||0)+1)});const b=Object.entries(p).sort(([,e],[,x])=>x-e)[0]?.[0]||null,P=B(o),a={};return o.PlayerStats.forEach(e=>{const x=m(e.MainRoleInitial);if(a[x]||(a[x]={totalVotes:0,totalAbstentions:0,participationRate:0}),e.Votes){const f=e.Votes.filter(j=>j.Target!=="Passé").length,u=e.Votes.filter(j=>j.Target==="Passé").length;a[x].totalVotes+=f,a[x].totalAbstentions+=u}}),Object.values(a).forEach(e=>{const x=e.totalVotes+e.totalAbstentions;e.participationRate=x>0?e.totalVotes/x*100:0}),{gameId:o.Id,gameDate:o.StartDate,totalMeetings:s,meetingAnalysis:i,overallParticipation:c>0?r/c*100:0,mostActiveVoter:h,mostTargetedPlayer:b,winningCamp:P,votingPatternsByRole:a}})}function F(){return V(n=>E(n))}function G(){return V(n=>w(n))}function k(){return V(n=>M(n))}function O(){return V(n=>S(n))}function W(){const{data:n,isLoading:o,error:i}=F(),{data:s,isLoading:d,error:r}=G(),{data:c,isLoading:l,error:h}=k(),{data:p,isLoading:b,error:P}=O();return o||d||l||b?t.jsx("div",{children:"Loading voting statistics..."}):i||r||h||P?t.jsx("div",{children:"Error loading voting statistics"}):t.jsxs("div",{style:{padding:"20px",maxWidth:"1200px",margin:"0 auto"},children:[t.jsx("h1",{children:"Voting Statistics Dashboard"}),n&&t.jsxs("section",{style:{marginBottom:"30px",padding:"15px",border:"1px solid #ddd",borderRadius:"8px"},children:[t.jsx("h2",{children:"Overall Voting Statistics"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"15px"},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Total Votes:"})," ",n.totalVotes]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Total Abstentions:"})," ",n.totalAbstentions]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Participation Rate:"})," ",n.participationRate.toFixed(1),"%"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Avg Votes/Game:"})," ",n.averageVotesPerGame.toFixed(1)]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Games with Votes:"})," ",n.totalGamesWithVotes]})]})]}),s&&s.length>0&&t.jsxs("section",{style:{marginBottom:"30px",padding:"15px",border:"1px solid #ddd",borderRadius:"8px"},children:[t.jsx("h2",{children:"Most Active Voters (Top 10)"}),t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:"#f5f5f5"},children:[t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Player"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Role"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Total Votes"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Abstentions"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Participation %"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Avg Votes/Game"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Most Targeted"})]})}),t.jsx("tbody",{children:s.slice(0,10).map((a,e)=>t.jsxs("tr",{style:{backgroundColor:e%2===0?"#f9f9f9":"white"},children:[t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.player}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.role}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.totalVotesCast}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.totalAbstentions}),t.jsxs("td",{style:{padding:"8px",border:"1px solid #ddd"},children:[a.participationRate.toFixed(1),"%"]}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.averageVotesPerGame.toFixed(1)}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.mostTargetedPlayer||"N/A"})]},a.player))})]})})]}),c&&c.length>0&&t.jsxs("section",{style:{marginBottom:"30px",padding:"15px",border:"1px solid #ddd",borderRadius:"8px"},children:[t.jsx("h2",{children:"Most Targeted Players (Top 10)"}),t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:"#f5f5f5"},children:[t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Player"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Times Targeted"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Games Targeted"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Targeting Pressure"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Most Frequent Attacker"})]})}),t.jsx("tbody",{children:c.slice(0,10).map((a,e)=>t.jsxs("tr",{style:{backgroundColor:e%2===0?"#f9f9f9":"white"},children:[t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.player}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.timesTargeted}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.gamesTargeted}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.targetingPressure.toFixed(1)}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:a.mostFrequentAttacker||"N/A"})]},a.player))})]})})]}),p&&p.length>0&&t.jsxs("section",{style:{marginBottom:"30px",padding:"15px",border:"1px solid #ddd",borderRadius:"8px"},children:[t.jsx("h2",{children:"Recent Game Voting Analysis (Last 3 Games)"}),p.slice(-3).map(a=>t.jsxs("div",{style:{marginBottom:"20px",padding:"10px",backgroundColor:"#f9f9f9",borderRadius:"5px"},children:[t.jsxs("h3",{children:["Game ",a.gameId]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"10px",marginBottom:"15px"},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Total Meetings:"})," ",a.totalMeetings]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Overall Participation:"})," ",a.overallParticipation.toFixed(1),"%"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Most Active Voter:"})," ",a.mostActiveVoter||"N/A"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Most Targeted:"})," ",a.mostTargetedPlayer||"N/A"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Winning Camp:"})," ",a.winningCamp]})]}),t.jsx("h4",{children:"Meeting Breakdown:"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"8px"},children:a.meetingAnalysis.map(e=>t.jsxs("div",{style:{padding:"5px",backgroundColor:"white",borderRadius:"3px",fontSize:"0.9em"},children:[t.jsxs("strong",{children:["Meeting ",e.meetingNumber]}),t.jsx("br",{}),"Participants: ",e.totalParticipants,t.jsx("br",{}),"Votes: ",e.totalVotesCast,t.jsx("br",{}),"Participation: ",e.participationRate.toFixed(0),"%",t.jsx("br",{}),e.mostTargetedPlayer&&t.jsxs("span",{children:["Target: ",e.mostTargetedPlayer]})]},e.meetingNumber))})]},a.gameId))]}),t.jsxs("section",{style:{marginBottom:"30px",padding:"15px",border:"1px solid #ddd",borderRadius:"8px",backgroundColor:"#f0f8ff"},children:[t.jsx("h2",{children:"How to Use These Hooks"}),t.jsx("p",{children:"The voting statistics system provides several hooks for different analysis needs:"}),t.jsxs("ul",{children:[t.jsxs("li",{children:[t.jsx("strong",{children:"useVotingStatsFromRaw()"})," - Overall voting statistics across all games"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"usePlayerVotingBehaviorFromRaw()"})," - Individual player voting behavior and patterns"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"useVoteTargetingAnalysisFromRaw()"})," - Analysis of who gets voted for most often"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"useGameVotingAnalysisFromRaw()"})," - Detailed game-by-game voting breakdown"]})]}),t.jsx("p",{children:"All hooks follow the base hook pattern and automatically respect filter settings from SettingsContext."})]})]})}export{W as default};
