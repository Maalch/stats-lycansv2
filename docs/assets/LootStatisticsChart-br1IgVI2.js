import{g as q,d as I,u as w,a as K,r as v,j as e}from"./index-BA0rguXe.js";import{a as V}from"./baseStatsHook-wEmoScaf.js";import{b as X,c as Y}from"./datasyncExport-CjB7UYqV.js";import{u as J}from"./useJoueursData-BTtfDLik.js";import{u as O}from"./api-fDp4NTmd.js";import{F as D,C as M,X as z,Y as k,a as H}from"./FullscreenChart-Bcfwjqnq.js";import{R as F,T as N}from"./CategoricalChart-BMYA4qbO.js";import{B as G,a as W}from"./BarChart-D7IL8P2n.js";function _(g){return g.PlayerStats.some(p=>p.TotalCollectedLoot!==void 0&&p.TotalCollectedLoot!==null)}function Q(g,p="all"){if(!g||g.length===0)return null;const y=g.filter(_);if(y.length===0)return{playerStats:[],totalGames:g.length,gamesWithLootData:0};const r=new Map;return y.forEach(f=>{f.PlayerStats.forEach(s=>{const x=q(s),j=I(s);if(s.TotalCollectedLoot===void 0||s.TotalCollectedLoot===null||p!=="all"&&X(s.MainRoleInitial,s.Power)!=={all:"",villageois:"Villageois",loup:"Loup",autres:"Autres"}[p])return;const u=s.DeathDateIrl||f.EndDate,c=Y(f.StartDate,u);if(!c||c<=0)return;r.has(x)||r.set(x,{displayName:j,gamesPlayed:0,totalLoot:0,totalGameDurationSeconds:0});const P=r.get(x);P.gamesPlayed++,P.totalLoot+=s.TotalCollectedLoot,P.totalGameDurationSeconds+=c})}),{playerStats:Array.from(r.entries()).map(([f,s])=>{const x=s.totalGameDurationSeconds>0?3600/s.totalGameDurationSeconds:0;return{player:s.displayName,gamesPlayed:s.gamesPlayed,totalLoot:s.totalLoot,averageLoot:s.gamesPlayed>0?s.totalLoot/s.gamesPlayed:0,totalGameDurationSeconds:s.totalGameDurationSeconds,lootPer60Min:s.totalLoot*x}}),totalGames:g.length,gamesWithLootData:y.length}}function U(g="all"){const{data:p,isLoading:y,error:r}=V(o=>Q(o,g));return{data:p,isLoading:y,error:r}}const Z=[3,5,10,15,25,50];function ne(){const{navigateToGameDetails:g,navigationState:p,updateNavigationState:y}=w(),{settings:r}=K(),[o,f]=v.useState(p.lootStatsState?.minGames||5),[s,x]=v.useState(p.lootStatsState?.campFilter||"all"),[j,u]=v.useState(null),{data:c,isLoading:P,error:S}=U(s),{joueursData:R}=J(),L=O(R);v.useEffect(()=>{const a=p.lootStatsState;(!a||a.minGames!==o||a.campFilter!==s)&&y({lootStatsState:{minGames:o,campFilter:s}})},[o,s,y]);const{totalLootChartData:b,highlightedPlayerAddedTotal:$}=v.useMemo(()=>{if(!c?.playerStats)return{totalLootChartData:[],highlightedPlayerAddedTotal:!1};const a=c.playerStats,t=a.filter(l=>l.gamesPlayed>=o).sort((l,m)=>m.totalLoot-l.totalLoot).slice(0,20),n=r.highlightedPlayer&&t.some(l=>l.player===r.highlightedPlayer);let d=[...t],h=!1;if(r.highlightedPlayer&&!n){const l=a.find(m=>m.player===r.highlightedPlayer);l&&(d.push({...l,isHighlightedAddition:!0}),h=!0)}return{totalLootChartData:d,highlightedPlayerAddedTotal:h}},[c,o,r.highlightedPlayer]),{averageLootChartData:T,highlightedPlayerAddedAverage:B}=v.useMemo(()=>{if(!c?.playerStats)return{averageLootChartData:[],highlightedPlayerAddedAverage:!1};const a=c.playerStats,t=a.filter(l=>l.gamesPlayed>=o).sort((l,m)=>m.averageLoot-l.averageLoot).slice(0,20),n=r.highlightedPlayer&&t.some(l=>l.player===r.highlightedPlayer);let d=[...t],h=!1;if(r.highlightedPlayer&&!n){const l=a.find(m=>m.player===r.highlightedPlayer);l&&(d.push({...l,isHighlightedAddition:!0}),h=!0)}return{averageLootChartData:d,highlightedPlayerAddedAverage:h}},[c,o,r.highlightedPlayer]),{normalizedLootChartData:A,highlightedPlayerAddedNormalized:E}=v.useMemo(()=>{if(!c?.playerStats)return{normalizedLootChartData:[],highlightedPlayerAddedNormalized:!1};const a=c.playerStats,t=a.filter(l=>l.gamesPlayed>=o).sort((l,m)=>m.lootPer60Min-l.lootPer60Min).slice(0,20),n=r.highlightedPlayer&&t.some(l=>l.player===r.highlightedPlayer);let d=[...t],h=!1;if(r.highlightedPlayer&&!n){const l=a.find(m=>m.player===r.highlightedPlayer);l&&(d.push({...l,isHighlightedAddition:!0}),h=!0)}return{normalizedLootChartData:d,highlightedPlayerAddedNormalized:h}},[c,o,r.highlightedPlayer]);if(P)return e.jsx("div",{className:"donnees-attente",children:"R√©cup√©ration des statistiques de loot..."});if(S)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",S]});if(!c)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de loot disponible"});const C=c.playerStats.filter(a=>a.gamesPlayed>=o).length;return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques de R√©colte de Loot"}),e.jsxs("p",{className:"lycans-stats-info",children:[c.gamesWithLootData," parties avec donn√©es de loot collect√© ¬∑ Filtrage par camp disponible ¬∑ 3 vues compl√©mentaires : Total cumul√©, Moyenne par partie, et Taux normalis√© par 60 minutes"]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Total Loot Collect√©"}),$&&r.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',r.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:s,onChange:a=>x(a.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"villageois",children:"Camp Villageois"}),e.jsx("option",{value:"loup",children:"Camp Loup"}),e.jsx("option",{value:"autres",children:"Autres (Solo)"})]}),e.jsx("label",{htmlFor:"min-games-select-total",style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginLeft:"1rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select-total",value:o,onChange:a=>f(Number(a.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:Z.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsx(D,{title:"Total Loot Collect√©",children:e.jsx("div",{style:{height:400},children:e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(G,{data:b,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:a,y:i,payload:t})=>e.jsx("text",{x:a,y:i,dy:16,textAnchor:"end",fill:r.highlightedPlayer===t.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:r.highlightedPlayer===t.value?14:13,fontWeight:r.highlightedPlayer===t.value?"bold":"italic",transform:`rotate(-45 ${a} ${i})`,children:t.value})}),e.jsx(k,{label:{value:"Loot total collect√©",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(N,{content:({active:a,payload:i})=>{if(a&&i&&i.length>0){const t=i[0].payload,n=t.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:t.player}),e.jsxs("div",{children:["Parties jou√©es: ",t.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Loot collect√©:"})}),e.jsxs("div",{children:["Total: ",t.totalLoot.toLocaleString()]}),e.jsxs("div",{children:["Moyenne par partie: ",t.averageLoot.toFixed(1)]}),e.jsxs("div",{children:["Taux (par 60 min): ",t.lootPer60Min.toFixed(1)]}),n&&e.jsxs("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:["üéØ Affich√© via s√©lection personnelle",t.gamesPlayed<o&&` (< ${o} parties)`]})]})}return null}}),e.jsx(W,{dataKey:"totalLoot",children:b.map((a,i)=>{const t=r.highlightedPlayer===a.player,n=j===a.player,d=a.isHighlightedAddition,h=L[a.player]||"var(--chart-primary)";return e.jsx(H,{fill:t?"var(--accent-primary)":d?"var(--accent-secondary)":h,stroke:t?"var(--accent-primary)":n?"#000000":"none",strokeWidth:t?3:n?2:0,strokeDasharray:d?"5,5":"none",opacity:d?.8:1,onClick:()=>g({selectedPlayer:a.player}),onMouseEnter:()=>u(a.player),onMouseLeave:()=>u(null),style:{cursor:"pointer"}},`cell-${i}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",b.length," des joueurs (sur ",C," ayant au moins ",o," partie",o>1?"s":"",")"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Calcul√© sur ",c.gamesWithLootData," parties avec donn√©es de loot"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Moyenne de Loot par Partie"}),B&&r.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',r.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsx(D,{title:"Moyenne de Loot par Partie",children:e.jsx("div",{style:{height:400},children:e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(G,{data:T,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:a,y:i,payload:t})=>e.jsx("text",{x:a,y:i,dy:16,textAnchor:"end",fill:r.highlightedPlayer===t.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:r.highlightedPlayer===t.value?14:13,fontWeight:r.highlightedPlayer===t.value?"bold":"italic",transform:`rotate(-45 ${a} ${i})`,children:t.value})}),e.jsx(k,{label:{value:"Loot moyen par partie",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(N,{content:({active:a,payload:i})=>{if(a&&i&&i.length>0){const t=i[0].payload,n=t.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:t.player}),e.jsxs("div",{children:["Parties jou√©es: ",t.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Loot collect√©:"})}),e.jsxs("div",{children:["Moyenne par partie: ",t.averageLoot.toFixed(1)]}),e.jsxs("div",{children:["Total: ",t.totalLoot.toLocaleString()]}),e.jsxs("div",{children:["Taux (par 60 min): ",t.lootPer60Min.toFixed(1)]}),n&&e.jsxs("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:["üéØ Affich√© via s√©lection personnelle",t.gamesPlayed<o&&` (< ${o} parties)`]})]})}return null}}),e.jsx(W,{dataKey:"averageLoot",children:T.map((a,i)=>{const t=r.highlightedPlayer===a.player,n=j===a.player,d=a.isHighlightedAddition,h=L[a.player]||"var(--chart-primary)";return e.jsx(H,{fill:t?"var(--accent-primary)":d?"var(--accent-secondary)":h,stroke:t?"var(--accent-primary)":n?"#000000":"none",strokeWidth:t?3:n?2:0,strokeDasharray:d?"5,5":"none",opacity:d?.8:1,onClick:()=>g({selectedPlayer:a.player}),onMouseEnter:()=>u(a.player),onMouseLeave:()=>u(null),style:{cursor:"pointer"}},`cell-${i}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",T.length," des joueurs (sur ",C," ayant au moins ",o," partie",o>1?"s":"",")"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Calcul√© sur ",c.gamesWithLootData," parties avec donn√©es de loot"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Taux de R√©colte (par 60 min)"}),E&&r.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',r.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsx(D,{title:"Taux de R√©colte (par 60 min)",children:e.jsx("div",{style:{height:400},children:e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(G,{data:A,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:a,y:i,payload:t})=>e.jsx("text",{x:a,y:i,dy:16,textAnchor:"end",fill:r.highlightedPlayer===t.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:r.highlightedPlayer===t.value?14:13,fontWeight:r.highlightedPlayer===t.value?"bold":"italic",transform:`rotate(-45 ${a} ${i})`,children:t.value})}),e.jsx(k,{label:{value:"Loot par 60 minutes",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(N,{content:({active:a,payload:i})=>{if(a&&i&&i.length>0){const t=i[0].payload,n=t.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:t.player}),e.jsxs("div",{children:["Parties jou√©es: ",t.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Taux normalis√© (par 60 min):"})}),e.jsxs("div",{children:[t.lootPer60Min.toFixed(1)," loot/heure"]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Statistiques globales:"})}),e.jsxs("div",{children:["Total: ",t.totalLoot.toLocaleString()]}),e.jsxs("div",{children:["Moyenne par partie: ",t.averageLoot.toFixed(1)]}),n&&e.jsxs("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:["üéØ Affich√© via s√©lection personnelle",t.gamesPlayed<o&&` (< ${o} parties)`]})]})}return null}}),e.jsx(W,{dataKey:"lootPer60Min",children:A.map((a,i)=>{const t=r.highlightedPlayer===a.player,n=j===a.player,d=a.isHighlightedAddition,h=L[a.player]||"var(--chart-primary)";return e.jsx(H,{fill:t?"var(--accent-primary)":d?"var(--accent-secondary)":h,stroke:t?"var(--accent-primary)":n?"#000000":"none",strokeWidth:t?3:n?2:0,strokeDasharray:d?"5,5":"none",opacity:d?.8:1,onClick:()=>g({selectedPlayer:a.player}),onMouseEnter:()=>u(a.player),onMouseLeave:()=>u(null),style:{cursor:"pointer"}},`cell-${i}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",A.length," des joueurs (sur ",C," ayant au moins ",o," partie",o>1?"s":"",")"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Taux normalis√© par 60 minutes de jeu ¬∑ Calcul√© sur ",c.gamesWithLootData," parties avec donn√©es"]})]})]})]})}export{ne as LootStatisticsChart};
