import{g as Z,r as L,a as ee,j as s,u as le}from"./index-CVy_16Yl.js";import{b as re}from"./baseStatsHook-C2H3neZY.js";import{g as q,a as ie}from"./gameUtils-rkfcKAVy.js";import{g as x,a as P}from"./datasyncExport-BirWLS1z.js";import{i as se,g as te}from"./roleUtils-g252S1-m.js";import{b as z,d as oe,e as H,P as Y}from"./api-CYqA0AYs.js";import{g as ce}from"./deathTypes-gHH1w6_X.js";import{g as de,C as ue,f as Q,a as me}from"./ClipViewer-ggEfYu_-.js";import{u as he}from"./useClips-BEsJuNmm.js";import{c as pe}from"./durationFormatters-C9UyWcKX.js";function fe(e,a){if(!e)return null;try{const n=new URL(e);let i="",t=0;if(n.hostname==="youtu.be"){i=n.pathname.slice(1);const m=n.searchParams.get("t");m&&(t=parseInt(m,10)||0)}else if(n.hostname==="www.youtube.com"||n.hostname==="youtube.com"){i=n.searchParams.get("v")||"";const m=n.searchParams.get("t");m&&(t=parseInt(m,10)||0)}return i?`https://www.youtube.com/embed/${i}?start=${t}`:null}catch{return null}}function ye(e){if(!e||Object.keys(e).length===0)return null;const a={};return Object.entries(e).forEach(([n,i])=>{if(i&&typeof i=="string"&&i.trim()){const t=fe(i,null);t&&(a[n]=t)}}),Object.keys(a).length>0?a:null}function ge(e,a){if(!e||!a)return null;try{const n=new Date(e),i=new Date(a);if(isNaN(n.getTime())||isNaN(i.getTime()))return null;const t=i.getTime()-n.getTime();return t>0?Math.round(t/1e3):null}catch{return null}}function Ce(e,a,n=!1,i=!1){const t=e.toLowerCase(),r=a.PlayerStats.find(d=>d.Username.toLowerCase()===t);return r?x(P(r.MainRoleInitial,r.MainRoleChanges||[]),{regroupLovers:!0,regroupVillagers:!i,regroupWolfSubRoles:!n}):"Villageois"}function xe(e,a,n){const i=e.toLowerCase(),t=n.PlayerStats.find(m=>m.Username.toLowerCase()===i);return t?x(P(t.MainRoleInitial,t.MainRoleChanges||[]))===a:!1}function X(e,a,n){const i=e.filter(t=>t.PlayerStats.some(r=>r.Username.toLowerCase()===a.toLowerCase()));return!n||n==="all-assignments"?i:n==="wins-only"?i.filter(t=>t.PlayerStats.some(r=>r.Username.toLowerCase()===a.toLowerCase()&&r.Victorious)):i}function je(e,a){return e.filter(n=>n.DisplayedId===a)}function ve(e,a){return e.filter(n=>a.includes(n.DisplayedId))}function Pe(e,a){return e.filter(n=>{const t=new Date(n.StartDate).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});if(a.includes("/")&&a.split("/").length===2){const[r,m]=a.split("/"),d=t.split("/");if(d.length===3){const[,f,h]=d;return f===r&&h===m}}else return t===a;return!1})}function we(e,a){return e.filter(n=>n.LegacyData?.VictoryType===a)}function Ne(e,a){return e.filter(n=>a==="Village"||a==="Ch√¢teau"?n.MapName===a:a==="Autres"?n.MapName!=="Village"&&n.MapName!=="Ch√¢teau":n.MapName===a)}function be(e,a,n){return e.filter(i=>i.Modded?i.PlayerStats.some(t=>{if(t.MainRoleInitial==="Inconnu"||n&&!(Z(t)===n||t.Username.toLowerCase()===n.toLowerCase()))return!1;const r=x(t.MainRoleInitial),m=r==="Loup"||r==="Tra√Ætre"||r==="Louveteau";return r==="Villageois"&&se(t)?te(t)===a:a==="Aucun pouvoir"?(r==="Villageois"||m)&&(!t.Power||t.Power.trim()==="")&&t.Power!=="Inconnu":t.Power===a}):!1)}function Ie(e,a,n){return e.filter(i=>i.Modded?i.PlayerStats.some(t=>t.MainRoleInitial==="Inconnu"||n&&!(Z(t)===n||t.Username.toLowerCase()===n.toLowerCase())?!1:t.SecondaryRole===a):!1)}function Re(e,a){return e.filter(n=>{const i=n.HarvestGoal,t=n.HarvestDone;if(i==null||t===null||t===void 0||i===0)return!1;const r=t/i*100;switch(a){case"0-25%":return r>=0&&r<=25;case"26-50%":return r>25&&r<=50;case"51-75%":return r>50&&r<=75;case"76-99%":return r>75&&r<=99;case"100%":return r>=100;default:return!0}})}function De(e,a){return e.filter(n=>{if(!n.EndTiming)return!1;const i=n.EndTiming.match(/(?:Nuit|Jour)\s+(\d+)/);return i?parseInt(i[1],10)===a:!1})}function Le(e,a,n){const{selectedCamp:i,campFilterMode:t,_smallCamps:r,excludeWolfSubRoles:m}=a;return e.filter(d=>{if(n){if(i==="Autres"&&r)return r.some(c=>xe(n,c,d))?t==="wins-only"?d.PlayerStats.find(j=>j.Username.toLowerCase()===n.toLowerCase())?.Victorious===!0:!0:!1;const f=Ce(n,d,m);let h=!1;return i==="Loup"&&m?h=f==="Loup"&&!d.PlayerStats.some(p=>p.Username.toLowerCase()===n.toLowerCase()&&(P(p.MainRoleInitial,p.MainRoleChanges||[])==="Tra√Ætre"||P(p.MainRoleInitial,p.MainRoleChanges||[])==="Louveteau")):h=f===i,h?t==="wins-only"?d.PlayerStats.find(c=>c.Username.toLowerCase()===n.toLowerCase())?.Victorious===!0:!0:!1}else if(t==="wins-only"){const f=q(d);return i==="Autres"&&r?r.includes(f):f===i}else return i==="Autres"&&r?r.some(f=>d.PlayerStats.some(h=>x(P(h.MainRoleInitial,h.MainRoleChanges||[]))===f)):d.PlayerStats.some(f=>x(P(f.MainRoleInitial,f.MainRoleChanges||[]))===i)})}function Me(e,a,n){const{selectedPlayers:i,playersFilterMode:t,winnerPlayer:r}=a;return e.filter(m=>{const d=m.PlayerStats.flatMap(p=>[p.Username.toLowerCase(),(p.ID??p.Username).toLowerCase()]);if(!i.every(p=>d.includes(p.toLowerCase())))return!1;const h=i.map(p=>{const c=p.toLowerCase(),j=m.PlayerStats.find(R=>{const l=(R.ID??R.Username).toLowerCase();return R.Username.toLowerCase()===c||l===c}),b=P(j?.MainRoleInitial||"",j?.MainRoleChanges||[]);return x(b,{regroupWolfSubRoles:n?.excludeWolfSubRoles||!1})});switch(t){case"all-common-games":if(r){const l=r.toLowerCase();return m.PlayerStats.find(g=>{const w=(g.ID??g.Username).toLowerCase();return g.Username.toLowerCase()===l||w===l})?.Victorious===!0}return!0;case"opposing-camps":if(!([...new Set(h)].length>1))return!1;if(r){const l=i.findIndex(y=>y.toLowerCase()===r.toLowerCase());if(l!==-1){const y=h[l],g=q(m);return y==="Agent"&&g==="Agent"?m.PlayerStats.find(N=>N.Username.toLowerCase()===r.toLowerCase())?.Victorious===!0:y===g}}return!0;case"same-camp":if(!([...new Set(h)].length===1))return!1;const R=h[0];if(n&&n.selectedCamp){const l=n.selectedCamp;if(R!==l)return!1}if(r){const l=q(m);return R==="Agent"&&l==="Agent"?i.every(y=>m.PlayerStats.find(w=>w.Username.toLowerCase()===y.toLowerCase())?.Victorious===!0):R===l}return!0;default:return!0}})}function Se(e,a){const{selectedPlayerPair:n,selectedPairRole:i}=a;return n.length!==2?e:e.filter(t=>{const r=t.PlayerStats.flatMap(d=>[d.Username.toLowerCase(),(d.ID??d.Username).toLowerCase()]);if(!n.every(d=>r.includes(d.toLowerCase())))return!1;switch(i){case"wolves":return n.every(d=>{const f=d.toLowerCase(),h=t.PlayerStats.find(p=>{const c=(p.ID??p.Username).toLowerCase();return p.Username.toLowerCase()===f||c===f});return x(P(h?.MainRoleInitial||"",h?.MainRoleChanges||[]))==="Loup"});case"lovers":return n.every(d=>{const f=d.toLowerCase(),h=t.PlayerStats.find(p=>{const c=(p.ID??p.Username).toLowerCase();return p.Username.toLowerCase()===f||c===f});return x(P(h?.MainRoleInitial||"",h?.MainRoleChanges||[]))==="Amoureux"});default:return!0}})}function Te(e,a,n){const i=a&&(a.selectedPlayer||a.selectedGame||a.selectedVictoryType||a.selectedDate||a.selectedHarvestRange||a.selectedGameDuration||a.selectedGameIds&&a.selectedGameIds.length>0||a.selectedMapName||a.selectedPower||a.selectedSecondaryRole||a.campFilter||a.playerPairFilter||a.multiPlayerFilter);if(!i&&n)return X(e,n,"all-assignments");if(!i)return e;let t=[...e];return a.selectedPlayer&&(t=X(t,a.selectedPlayer,a.selectedPlayerWinMode)),a.selectedGame&&(t=je(t,a.selectedGame)),a.selectedGameIds&&(t=ve(t,a.selectedGameIds)),a.campFilter&&(t=Le(t,a.campFilter,a.selectedPlayer)),a.selectedDate&&(t=Pe(t,a.selectedDate)),a.selectedHarvestRange&&(t=Re(t,a.selectedHarvestRange)),a.selectedVictoryType&&(t=we(t,a.selectedVictoryType)),a.selectedGameDuration&&(t=De(t,a.selectedGameDuration)),a.selectedMapName&&(t=Ne(t,a.selectedMapName)),a.selectedPower&&(t=be(t,a.selectedPower,a.selectedPlayer)),a.selectedSecondaryRole&&(t=Ie(t,a.selectedSecondaryRole,a.selectedPlayer)),a.multiPlayerFilter&&(t=Me(t,a.multiPlayerFilter,a.campFilter)),a.playerPairFilter&&(t=Se(t,a.playerPairFilter)),t}function Fe(e,a,n){return e.length===0?null:Te(e,a,n).map(t=>{const r=t.PlayerStats.length,m=t.PlayerStats.filter(u=>x(P(u.MainRoleInitial,u.MainRoleChanges||[]))==="Loup"),d=t.PlayerStats.filter(u=>x(P(u.MainRoleInitial,u.MainRoleChanges||[]))==="Tra√Ætre"),f=t.PlayerStats.filter(u=>x(P(u.MainRoleInitial,u.MainRoleChanges||[]))==="Louveteau"),h=t.PlayerStats.filter(u=>x(P(u.MainRoleInitial,u.MainRoleChanges||[]))==="Amoureux"),p=t.PlayerStats.filter(u=>u.Victorious),c=m.length+d.length+f.length,j=q(t),b=["Loup","Villageois","Tra√Ætre","Louveteau"],R=t.PlayerStats.filter(u=>!b.includes(x(u.MainRoleInitial))),l=[...new Set(R.map(u=>x(u.MainRoleInitial)))],y=l.length>0?l.join(", "):null,w=new Date(t.StartDate).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});let N=0;if(t.EndTiming){const u=t.EndTiming.match(/[UNJMC](\d+)/);u&&(N=parseInt(u[1],10))}let M=null;return t.HarvestGoal&&t.HarvestGoal>0&&(M=t.HarvestDone/t.HarvestGoal),{gameId:t.DisplayedId,date:w,isModded:t.Modded||!1,playerCount:r,wolfCount:c,hasTraitor:d.length>0,traitorsCount:d.length,hasWolfCub:f.length>0,wolfCubsCount:f.length,hasLovers:h.length>0,soloRoles:y,winningCamp:j,dayCount:N,winners:p.map(u=>u.Username).join(", "),harvest:t.HarvestDone,totalHarvest:t.HarvestGoal,harvestPercentage:M,playersList:t.PlayerStats.map(u=>u.Username).join(", "),versions:t.Version||null,map:t.MapName,victoryType:t.LegacyData?.VictoryType||null,playerVODs:ye(t.LegacyData?.PlayerVODs),gameDuration:ge(t.StartDate,t.EndDate),playerData:t.PlayerStats,clips:t.Clips||[]}})}function Ge(e,a){const{data:n,isLoading:i,error:t}=re(r=>Fe(r,e,a));return{data:n||[],isLoading:i,error:t}}const Ve=({playerData:e})=>{const a=z(),n=oe(),i=e.reduce((r,m)=>{const d=x(P(m.MainRoleInitial,m.MainRoleChanges||[]));return r[d]||(r[d]=[]),r[d].push(m),r},{}),t=Object.entries(i).sort(([r,m],[d,f])=>{const h=H.includes(r),p=H.includes(d);return h&&!p?-1:!h&&p?1:f.length-m.length});return s.jsxs("div",{className:"lycans-game-detail-section full-width",children:[s.jsx("h4",{children:"Composition des Camps"}),s.jsx("div",{className:"camps-grid",children:t.map(([r,m])=>{const d=m,f=a[r]||"#666",p=d.filter(c=>c.Victorious).length>0;return s.jsxs("div",{className:`camp-group ${p?"winning-camp":""}`,style:{borderColor:f,backgroundColor:`${f}15`,boxShadow:p?`0 0 10px ${f}40`:"none"},children:[s.jsx("div",{className:"camp-header",style:{backgroundColor:`${f}25`},children:s.jsxs("h5",{style:{color:f},children:[r," (",d.length,")",p&&s.jsx("span",{className:"victory-crown",children:"üëë"})]})}),s.jsx("div",{className:"camp-players",children:d.sort((c,j)=>c.Username.localeCompare(j.Username)).map(c=>{let j=f;c.Color&&n[c.Color]&&(j=n[c.Color]);let b="";return c.DeathTiming&&(b=` (Mort ${ie(c.DeathTiming)}`,c.DeathType&&(b+=` - ${ce(c.DeathType)}`),c.KillerName&&(b+=` - Tueur ${c.KillerName}`),b+=")"),s.jsxs("div",{className:`player-badge ${c.Victorious?"winner":""} ${c.DeathTiming?"dead":"alive"}`,style:{borderColor:j},title:`${c.Username} - ${x(c.MainRoleInitial)!==x(P(c.MainRoleInitial,c.MainRoleChanges||[]))?`${x(c.MainRoleInitial)} puis ${x(P(c.MainRoleInitial,c.MainRoleChanges||[]))}`:x(c.MainRoleInitial)}${b}`,children:[s.jsx("span",{className:"gamedetails-player-name",children:c.Username}),c.DeathTiming&&s.jsx("span",{className:"death-indicator",children:"üíÄ"}),c.Victorious&&s.jsx("span",{className:"victory-indicator",children:"‚≠ê"})]},c.Username)})})]},r)})})]})};function $e(e){if(e===null||e<=0)return"N/A";const a=Math.floor(e/60),n=e%60;return a===0?`${n}s`:n===0?`${a}m`:`${a}m ${n}s`}function Ue({game:e}){const[a,n]=L.useState(!1),[i,t]=L.useState(!1),[r,m]=L.useState(null),[d,f]=L.useState(null),h=z(),{clips:p}=he(),{settings:c}=ee(),j=L.useMemo(()=>{const l=[];return e.playerVODs&&typeof e.playerVODs=="object"&&Object.entries(e.playerVODs).forEach(([y,g])=>{if(typeof g=="string"&&g.trim()){const w=e.playerData?.find(S=>S.ID===y),N=w?.Username||y;let M="#666",u="#666";if(w){const S=x(P(w.MainRoleInitial,w.MainRoleChanges||[])),$=P(w.MainRoleInitial,w.MainRoleChanges||[]);M=h[S]||"#666",u=h[$]||"#666",u==="#666"&&(u=h[S]||"#666")}l.push({label:`${N}`,url:g,playerId:y,borderColor:M,textColor:u})}}),l},[e.playerVODs,e.playerData,h]);L.useEffect(()=>{if(a&&j.length>0&&!r){if(j.length===1)m(j[0].url);else if(c.highlightedPlayer){const l=j.find(y=>y.label.toLowerCase()===c.highlightedPlayer?.toLowerCase());l&&m(l.url)}}},[a,j,r,c.highlightedPlayer]);const b=j.length>0,R=j.length>1;return s.jsxs("div",{className:"lycans-game-detail-view",children:[s.jsxs("div",{className:"lycans-game-detail-grid",children:[s.jsxs("div",{className:"lycans-game-detail-section",children:[s.jsx("h4",{children:"Informations G√©n√©rales"}),s.jsxs("div",{className:"lycans-game-detail-stats",children:[s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Nombre de joueurs:"}),s.jsx("span",{className:"value",children:e.playerCount})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Nombre de loups:"}),s.jsx("span",{className:"value",children:e.wolfCount})]}),(e.hasTraitor||e.hasWolfCub)&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"R√¥les sp√©ciaux loup:"}),s.jsx("span",{className:"value",children:[e.hasTraitor&&`Tra√Ætre (${e.traitorsCount})`,e.hasWolfCub&&`Louveteau (${e.wolfCubsCount})`].filter(Boolean).join(", ")})]}),e.soloRoles&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"R√¥les solo:"}),s.jsx("span",{className:"value",children:e.soloRoles})]})]})]}),s.jsxs("div",{className:"lycans-game-detail-section",children:[s.jsx("h4",{children:"Informations Suppl√©mentaires"}),s.jsxs("div",{className:"lycans-game-detail-stats",children:[e.victoryType!==null&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Type de victoire:"}),s.jsx("span",{className:"value",children:e.victoryType})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Jours de jeu:"}),s.jsx("span",{className:"value",children:e.dayCount})]}),e.gameDuration!==null&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Dur√©e de la partie:"}),s.jsx("span",{className:"value",children:$e(e.gameDuration)})]}),e.versions&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Version:"}),s.jsxs("span",{className:"value",children:[e.versions,e.isModded?" (modd√©e)":""]})]}),e.map&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Map:"}),s.jsx("span",{className:"value",children:e.map})]})]})]}),e.harvest!==null&&s.jsxs("div",{className:"lycans-game-detail-section",children:[s.jsx("h4",{children:"R√©colte"}),s.jsxs("div",{className:"lycans-game-detail-stats",children:[s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"R√©colte:"}),s.jsx("span",{className:"value",children:e.harvest})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Total possible:"}),s.jsx("span",{className:"value",children:e.totalHarvest})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Pourcentage:"}),s.jsx("span",{className:"value",children:typeof e.harvestPercentage=="number"?(e.harvestPercentage*100).toFixed(1)+"%":"N/A"})]})]})]}),s.jsx(Ve,{playerData:e.playerData}),s.jsxs("div",{className:"lycans-game-detail-section full-width",children:[s.jsx("h4",{children:"R√¥les des Joueurs"}),s.jsx("div",{className:"lycans-player-roles-grid",children:e.playerData.sort((l,y)=>{const g=x(P(l.MainRoleInitial,l.MainRoleChanges||[])),w=x(P(y.MainRoleInitial,y.MainRoleChanges||[])),N=H.indexOf(g),M=H.indexOf(w);return N!==-1&&M!==-1?N-M:N!==-1?-1:M!==-1?1:g!==w?g.localeCompare(w):l.Username.localeCompare(y.Username)}).map(l=>{const y=x(l.MainRoleInitial),g=l.MainRoleInitial,w=x(P(l.MainRoleInitial,l.MainRoleChanges||[])),N=P(l.MainRoleInitial,l.MainRoleChanges||[]),M=l.Power,u=l.SecondaryRole,S=se(l),$=S?te(l):null;let T;S?(T="Villageois √âlite",$&&$.trim()&&(T+=` - ${$}`),u&&u.trim()&&(T+=` + ${u}`)):(T=y,g&&g!==y&&(T+=` - ${g}`),M&&M.trim()&&(T+=` - ${M}`),u&&u.trim()&&(T+=` + ${u}`)),N&&N!==g&&(T+=` (devient ${N})`);let G=h[P(l.MainRoleInitial,l.MainRoleChanges||[])]||"#666";if(G==="#666"&&(G=h[w]||"#666"),S&&$){const E=h[$];E&&(G=E)}const F=h[w]||"#666",k=l.DeathTiming,B=l.Victorious;return s.jsxs("div",{className:`lycans-player-role-item ${B?"victorious":""}`,style:{borderColor:F},children:[s.jsxs("div",{className:"lycans-player-name",style:{color:G,textAlign:"left"},children:[l.Username,k&&s.jsx("span",{className:"death-skull",children:"üíÄ"})]}),s.jsx("div",{className:"lycans-player-camp",style:{textAlign:"left"},children:T}),l.TotalCollectedLoot!==void 0&&l.TotalCollectedLoot!==null&&s.jsxs("div",{className:"lycans-player-loot",style:{fontSize:"0.85em",color:"var(--text-secondary)",marginTop:"4px",textAlign:"left"},children:["üí∞ ",l.TotalCollectedLoot.toLocaleString()," loot"]})]},l.Username)})})]}),(b||e.clips&&e.clips.length>0)&&s.jsx("div",{className:"lycans-game-detail-section full-width",children:s.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[b&&s.jsx("button",{onClick:()=>n(!a),className:"lycans-video-toggle-btn",style:{width:"auto",flex:"1",minWidth:"200px"},children:a?"üìπ Masquer la vid√©o":"üé• Voir la vid√©o"}),e.clips&&e.clips.length>0&&s.jsx("button",{onClick:()=>t(!i),className:"lycans-video-toggle-btn",style:{width:"auto",flex:"1",minWidth:"200px"},children:i?"üé¨ Masquer les clips":"üé¨ Voir les Clips"})]})}),b&&a&&s.jsxs("div",{className:"lycans-game-detail-section full-width",children:[s.jsx("h4",{children:"Vid√©o de la Partie"}),R&&s.jsx("nav",{className:"lycans-vod-menu",children:j.map((l,y)=>s.jsx("button",{className:`lycans-vod-btn${r===l.url?" active":""}`,onClick:()=>m(l.url),type:"button",title:l.label,style:{borderColor:l.borderColor,color:r===l.url?"white":l.textColor},children:l.label},y))}),s.jsx("div",{className:"lycans-youtube-container",children:r?s.jsx("iframe",{src:r,title:`Partie Lycans #${e.gameId}`,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"lycans-youtube-iframe"}):s.jsx("div",{className:"lycans-vod-placeholder",children:s.jsx("p",{children:"S√©lectionnez une VOD de joueur pour commencer"})})})]}),e.clips&&e.clips.length>0&&i&&s.jsxs("div",{className:"lycans-game-detail-section full-width",children:[s.jsxs("h4",{children:["üé¨ Clips de la Partie (",e.clips.length,")"]}),s.jsx("div",{className:"lycans-clips-grid",children:e.clips.map(l=>s.jsxs("button",{className:"lycans-clip-card",onClick:()=>f(l),children:[s.jsxs("div",{className:"lycans-clip-card-header",children:[s.jsx("span",{className:"lycans-clip-icon",children:"üé¨"}),s.jsx("span",{className:"lycans-clip-name",children:de(l)})]}),s.jsxs("div",{className:"lycans-clip-card-pov",children:["POV: ",l.POVPlayer]}),l.AdditionalInfo&&s.jsx("div",{className:"lycans-clip-card-info",children:l.AdditionalInfo.length>60?`${l.AdditionalInfo.substring(0,60)}...`:l.AdditionalInfo})]},l.ClipId))})]})]}),d&&s.jsx(ue,{clip:d,onClose:()=>f(null),relatedClips:me(d,p),nextClip:Q(d,p),onNextClip:()=>{const l=Q(d,p);l&&f(l)},onRelatedClip:l=>{const y=p.find(g=>g.ClipId===l);y&&f(y)}})]})}function _e(){const{navigationFilters:e,navigateBack:a}=le(),{settings:n}=ee(),i=!!(e.selectedPlayer||e.selectedGame||e.selectedVictoryType||e.selectedDate||e.selectedHarvestRange||e.selectedGameDuration||e.selectedGameIds&&e.selectedGameIds.length>0||e.selectedMapName||e.selectedPower||e.campFilter||e.playerPairFilter||e.multiPlayerFilter),t=i?null:n.highlightedPlayer,{data:r,isLoading:m,error:d}=Ge(e,t),f=z(),[h,p]=L.useState("date"),[c,j]=L.useState("desc"),[b,R]=L.useState(null),[l,y]=L.useState(Y.INITIAL_PAGE),[g,w]=L.useState(Y.ITEMS_PER_PAGE),N=L.useRef(!1),u=e.selectedPlayer?[e.selectedPlayer]:e.playerPairFilter?.selectedPlayerPair?e.playerPairFilter.selectedPlayerPair:e.multiPlayerFilter?.selectedPlayers?e.multiPlayerFilter.selectedPlayers:n.highlightedPlayer?[n.highlightedPlayer]:[],S=u.length>0,$=()=>u.length===0?"Vainqueur":u.length===1?u[0]+" (victoire)":u.length===2?u.join(" & ")+" (victoires)":`${u.slice(0,2).join(" & ")} (+${u.length-2}) (victoires)`,T=o=>{if(!S)return"";if(!i&&t)return(o.winners?o.winners.split(",").map(J=>J.trim()):[]).filter(J=>u.some(ne=>ne.toLowerCase()===J.toLowerCase())).length>0?"‚úÖ":"‚ùå";const v=o.playersList?o.playersList.split(",").map(D=>D.trim()):[];return u.filter(D=>v.some(U=>U.toLowerCase()===D.toLowerCase())).length===0?"Pas dans la partie":(o.winners?o.winners.split(",").map(D=>D.trim()):[]).filter(D=>u.some(U=>U.toLowerCase()===D.toLowerCase())).length>0?"‚úÖ":"‚ùå"},G=L.useMemo(()=>r?[...r].sort((o,v)=>{let C,I;switch(h){case"date":C=new Date(o.date.split("/").reverse().join("-")).getTime(),I=new Date(v.date.split("/").reverse().join("-")).getTime();break;case"gameId":C=parseInt(o.gameId,10),I=parseInt(v.gameId,10);break;case"playerCount":C=o.playerCount,I=v.playerCount;break;case"gameDuration":C=o.gameDuration||0,I=v.gameDuration||0;break;case"winningCamp":C=o.winningCamp,I=v.winningCamp;break;case"winner":C=T(o),I=T(v);break;default:return 0}let V;if(c==="asc"?V=C>I?1:C<I?-1:0:V=C<I?1:C>I?-1:0,V===0){const D=parseInt(o.gameId,10),U=parseInt(v.gameId,10);return c==="asc"?D-U:U-D}return V}):[],[r,h,c]),F=Math.ceil(G.length/g),k=(l-1)*g,B=k+g,E=G.slice(k,B);L.useEffect(()=>{if(N.current){N.current=!1;return}y(1),R(null)},[r]),L.useEffect(()=>{y(1),R(null)},[h,c]);const A=o=>{N.current=!0,y(o),R(null)},ae=o=>{N.current=!0,w(o),y(1),R(null)},_=o=>{N.current=!0,R(b===o?null:o)},W=o=>{h===o?j(c==="asc"?"desc":"asc"):(p(o),j("desc"))},O=o=>h!==o?"‚ÜïÔ∏è":c==="asc"?"‚ÜóÔ∏è":"‚ÜòÔ∏è",K=()=>{const o=[];if(e.selectedPlayer&&e.campFilter){const v=e.selectedPlayerWinMode==="wins-only"?" (victoires uniquement)":"";let C=e.campFilter.selectedCamp;e.campFilter.selectedCamp==="Loup"&&e.campFilter.excludeWolfSubRoles?C="Loups sans Tra√Ætre/Louveteau":e.campFilter.selectedCamp==="Villageois"&&e.campFilter.excludeVillagers&&(C="Villageois sans Villageois √âlite"),o.push(`${e.selectedPlayer} jouant ${C}${v}`)}else{if(e.selectedPlayer&&!e.selectedGameIds){const v=e.selectedPlayerWinMode==="wins-only"?" (victoires uniquement)":e.selectedPlayerWinMode==="all-assignments"?" (toutes parties)":"";o.push(`Joueur: ${e.selectedPlayer}${v}`)}if(e.campFilter){const{campFilterMode:v}=e.campFilter;let C=e.campFilter.selectedCamp;e.campFilter.selectedCamp==="Loup"&&e.campFilter.excludeWolfSubRoles?C="Loups sans Tra√Ætre/Louveteau":e.campFilter.selectedCamp==="Villageois"&&e.campFilter.excludeVillagers&&(C="Villageois sans Villageois √âlite");const I=`Camp: ${C}`,V=v==="wins-only"?" (victoires uniquement)":v==="all-assignments"?" (toutes assignations)":"";o.push(I+V)}}if(e.selectedMapName){const v=e.selectedMapName==="Autres"?"autres cartes":e.selectedMapName;o.push(`Carte: ${v}`)}if(e.selectedPower&&o.push(`Pouvoir: ${e.selectedPower}`),e.selectedSecondaryRole&&o.push(`R√¥le Secondaire: ${e.selectedSecondaryRole}`),e.playerPairFilter){const{selectedPlayerPair:v,selectedPairRole:C}=e.playerPairFilter,I=v.join(" & "),V=C==="wolves"?"loups":"amoureux";o.push(`Paire ${V}: ${I}`)}if(e.multiPlayerFilter){const{selectedPlayers:v,playersFilterMode:C,winnerPlayer:I}=e.multiPlayerFilter,V=v.join(" & ");let D="";C==="all-common-games"?D="toutes les parties communes":C==="opposing-camps"?D="affrontements uniquement":C==="same-camp"&&(D="parties en √©quipe (m√™me camp)");const U=I?` (victoires de ${I})`:"";o.push(`${V} (${D}${U})`)}return e.selectedVictoryType&&o.push(`Victoire: ${e.selectedVictoryType}`),e.selectedHarvestRange&&o.push(`R√©colte: ${e.selectedHarvestRange}`),e.selectedGameDuration&&o.push(`Dur√©e: ${e.selectedGameDuration} jour${e.selectedGameDuration>1?"s":""}`),e.selectedGame&&o.push(`Partie ${e.selectedGame}`),e.selectedDate&&(e.selectedDate.includes("/")&&e.selectedDate.split("/").length===2?o.push(`Mois: ${e.selectedDate}`):o.push(`Date: ${e.selectedDate}`)),e.selectedGameIds&&e.selectedGameIds.length>0&&o.push(`${e.selectedGameIds.length} parties s√©lectionn√©e${e.selectedGameIds.length>1?"s":""}`),o};return m?s.jsx("div",{className:"statistiques-chargement",children:"Chargement des d√©tails des parties..."}):d?s.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",d]}):!r||r.length===0?s.jsxs("div",{className:"lycans-empty-section",children:[s.jsx("h2",{children:"Aucune partie trouv√©e"}),s.jsx("p",{children:"Aucune partie ne correspond aux crit√®res s√©lectionn√©s."}),e.fromComponent&&s.jsxs("button",{onClick:a,className:"lycans-submenu-btn",style:{marginTop:"1rem"},children:["‚Üê Retour √† ",decodeURIComponent(e.fromComponent)]})]}):s.jsxs("div",{className:"lycans-game-details",children:[s.jsxs("div",{className:"lycans-game-details-header",children:[s.jsxs("div",{className:"lycans-game-details-navigation",children:[e.fromComponent&&s.jsxs("button",{onClick:a,className:"lycans-submenu-btn",style:{marginRight:"1rem"},children:["‚Üê Retour √† ",decodeURIComponent(e.fromComponent)]}),s.jsxs("h2",{children:["D√©tails des Parties (",r.length," partie",r.length>1?"s":"",")"]})]}),K().length>0&&s.jsxs("div",{className:"lycans-active-filters",children:[s.jsx("strong",{children:"Filtres actifs:"})," ",K().join(", ")]})]}),F>1&&s.jsxs("div",{className:"lycans-pagination-container",children:[s.jsxs("div",{className:"lycans-pagination-info",children:["Affichage de ",k+1," √† ",Math.min(B,G.length)," sur ",G.length," parties"]}),s.jsxs("div",{className:"lycans-pagination-controls",children:[s.jsxs("select",{value:g,onChange:o=>ae(Number(o.target.value)),className:"lycans-pagination-select",children:[s.jsx("option",{value:10,children:"10 par page"}),s.jsx("option",{value:25,children:"25 par page"}),s.jsx("option",{value:50,children:"50 par page"}),s.jsx("option",{value:100,children:"100 par page"})]}),s.jsxs("div",{className:"lycans-pagination-buttons",children:[s.jsx("button",{onClick:()=>A(1),disabled:l===1,className:"lycans-pagination-btn",children:"¬´¬´"}),s.jsx("button",{onClick:()=>A(l-1),disabled:l===1,className:"lycans-pagination-btn",children:"‚Äπ"}),s.jsxs("span",{className:"lycans-pagination-current",children:["Page ",l," sur ",F]}),s.jsx("button",{onClick:()=>A(l+1),disabled:l===F,className:"lycans-pagination-btn",children:"‚Ä∫"}),s.jsx("button",{onClick:()=>A(F),disabled:l===F,className:"lycans-pagination-btn",children:"¬ª¬ª"})]})]})]}),s.jsx("div",{className:"lycans-games-table-container",children:s.jsxs("table",{className:"lycans-games-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsxs("th",{onClick:()=>W("gameId"),className:"sortable",children:["Partie ",O("gameId")]}),s.jsxs("th",{onClick:()=>W("date"),className:"sortable",children:["Date ",O("date")]}),s.jsxs("th",{onClick:()=>W("playerCount"),className:"sortable",children:["Joueurs ",O("playerCount")]}),s.jsxs("th",{onClick:()=>W("gameDuration"),className:"sortable",children:["Dur√©e ",O("gameDuration")]}),s.jsxs("th",{onClick:()=>W("winningCamp"),className:"sortable",children:["Camp Vainqueur ",O("winningCamp")]}),S&&s.jsxs("th",{onClick:()=>W("winner"),className:"sortable",children:[$()," ",O("winner")]}),s.jsx("th",{children:"D√©tails"})]})}),s.jsx("tbody",{children:E.map(o=>s.jsxs(s.Fragment,{children:[s.jsxs("tr",{className:`${b===o.gameId?"selected":""} clickable-row`,onClick:()=>_(o.gameId),style:{cursor:"pointer"},children:[s.jsxs("td",{children:["#",o.gameId]}),s.jsx("td",{children:o.date}),s.jsx("td",{children:o.playerCount}),s.jsx("td",{children:pe(o.gameDuration)}),s.jsx("td",{style:{color:f[o.winningCamp]||"#fff"},children:o.winningCamp}),S&&s.jsx("td",{style:{textAlign:"left",fontSize:"1.2rem",verticalAlign:"middle"},children:T(o)}),s.jsx("td",{children:s.jsx("button",{onClick:v=>{v.stopPropagation(),_(o.gameId)},className:"lycans-details-btn",children:b===o.gameId?"Masquer":"Voir"})})]},o.gameId),b===o.gameId&&s.jsx("tr",{className:"game-details-row",children:s.jsx("td",{colSpan:S?8:7,children:s.jsx(Ue,{game:o})})},`${o.gameId}-details`)]}))})]})}),F>1&&s.jsxs("div",{className:"lycans-pagination-container",children:[s.jsxs("div",{className:"lycans-pagination-info",children:["Affichage de ",k+1," √† ",Math.min(B,G.length)," sur ",G.length," parties"]}),s.jsx("div",{className:"lycans-pagination-controls",children:s.jsxs("div",{className:"lycans-pagination-buttons",children:[s.jsx("button",{onClick:()=>A(1),disabled:l===1,className:"lycans-pagination-btn",children:"¬´¬´"}),s.jsx("button",{onClick:()=>A(l-1),disabled:l===1,className:"lycans-pagination-btn",children:"‚Äπ"}),s.jsxs("span",{className:"lycans-pagination-current",children:["Page ",l," sur ",F]}),s.jsx("button",{onClick:()=>A(l+1),disabled:l===F,className:"lycans-pagination-btn",children:"‚Ä∫"}),s.jsx("button",{onClick:()=>A(F),disabled:l===F,className:"lycans-pagination-btn",children:"¬ª¬ª"})]})})]})]})}export{_e as GameDetailsChart};
