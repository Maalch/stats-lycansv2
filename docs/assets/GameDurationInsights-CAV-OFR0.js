import{u as g,j as e}from"./index-zDsQQI_Z.js";import{c as b}from"./baseStatsHook-CP81hRHF.js";import{a as C,l as B}from"./api-beq3FXpM.js";import{F as m,B as D,C as p,X as h,Y as x,a as v,b as N}from"./FullscreenChart-Dcn5aLJs.js";import{R as j,T as f,Q as R}from"./CategoricalChart-DklIzZgO.js";import{L as W,a as P}from"./LineChart-CXfHkTUD.js";import{L}from"./Legend-2YBe2pQs.js";import"./ActivePoints-BfN7K9h2.js";function k(n){if(n.length===0)return null;const s={averageDays:"0",maxDays:0,minDays:99,dayDistribution:{},daysByWinnerCamp:{},daysByPlayerCount:{},daysByWolfRatio:{}};let o=0,l=0;n.forEach(i=>{const a=i["Nombre de journées"],r=i["Camp victorieux"],t=i["Nombre de joueurs"],u=i["Nombre de loups"];if(a&&!isNaN(a)&&a>0){if(l++,o+=a,a>s.maxDays&&(s.maxDays=a),a<s.minDays&&(s.minDays=a),s.dayDistribution[a]||(s.dayDistribution[a]=0),s.dayDistribution[a]++,r&&r.trim()!==""&&(s.daysByWinnerCamp[r]||(s.daysByWinnerCamp[r]={totalDays:0,count:0,average:"0"}),s.daysByWinnerCamp[r].totalDays+=a,s.daysByWinnerCamp[r].count++),t&&!isNaN(t)&&t>0){const c=t.toString();s.daysByPlayerCount[c]||(s.daysByPlayerCount[c]={totalDays:0,count:0,average:"0"}),s.daysByPlayerCount[c].totalDays+=a,s.daysByPlayerCount[c].count++}if(t&&u&&!isNaN(t)&&!isNaN(u)&&t>0){const c=Math.round(u/t*100),y=(Math.round(c/1)*1).toString();s.daysByWolfRatio[y]||(s.daysByWolfRatio[y]={totalDays:0,count:0,average:"0"}),s.daysByWolfRatio[y].totalDays+=a,s.daysByWolfRatio[y].count++}}}),l>0&&(s.averageDays=(o/l).toFixed(1),Object.keys(s.daysByWinnerCamp).forEach(i=>{const a=s.daysByWinnerCamp[i];a.count>0&&(a.average=(a.totalDays/a.count).toFixed(1))}),Object.keys(s.daysByPlayerCount).forEach(i=>{const a=s.daysByPlayerCount[i];a.count>0&&(a.average=(a.totalDays/a.count).toFixed(1))}),Object.keys(s.daysByWolfRatio).forEach(i=>{const a=s.daysByWolfRatio[i];a.count>0&&(a.average=(a.totalDays/a.count).toFixed(1))}));const d=Object.keys(s.dayDistribution).map(i=>({days:parseInt(i),count:s.dayDistribution[parseInt(i)]}));return d.sort((i,a)=>i.days-a.days),{averageDays:s.averageDays,maxDays:s.maxDays,minDays:s.minDays,dayDistribution:d,daysByWinnerCamp:s.daysByWinnerCamp,daysByPlayerCount:s.daysByPlayerCount,daysByWolfRatio:s.daysByWolfRatio}}function A(){const{data:n,isLoading:s,error:o}=b(k);return{durationAnalysis:n,fetchingData:s,apiError:o}}function z(){const{durationAnalysis:n,fetchingData:s,apiError:o}=A(),{navigateToGameDetails:l}=g();if(s)return e.jsx("div",{className:"statistiques-attente",children:"Analyse des durées de partie en cours..."});if(o)return e.jsxs("div",{className:"statistiques-echec",children:["Problème rencontré: ",o]});if(!n)return e.jsx("div",{className:"statistiques-indisponibles",children:"Données d'analyse non disponibles"});const d=n?Object.entries(n.daysByWolfRatio).map(([a,r])=>({ratio:parseFloat(a),moyenne:parseFloat(r.average),parties:r.count})).sort((a,r)=>a.ratio-r.ratio):[],i=n?Object.entries(n.daysByWinnerCamp).map(([a,r])=>({camp:a,moyenne:parseFloat(r.average),parties:r.count})).sort((a,r)=>r.moyenne-a.moyenne):[];return e.jsxs("div",{className:"lycans-duree-analyse",children:[e.jsx("h2",{children:"Analyse des Durées de Partie"}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Moyenne"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[n.averageDays," jours"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Minimum"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[n.minDays," jours"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Maximum"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[n.maxDays," jours"]})]})]}),e.jsxs("div",{className:"lycans-graphiques-section",children:[e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Distribution des Durées de Partie"}),e.jsx(m,{title:"Distribution des Durées de Partie",children:e.jsx("div",{style:{height:300},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(D,{data:n?.dayDistribution||[],margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(p,{strokeDasharray:"3 3"}),e.jsx(h,{dataKey:"days",label:{value:"Nombre de Jours",position:"insideBottom",offset:-5}}),e.jsx(x,{label:{value:"Nombre de Parties",angle:-90,position:"insideLeft"}}),e.jsx(f,{content:({active:a,payload:r})=>{if(a&&r&&r.length>0){const t=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsxs("strong",{children:[t.days," jours"]})}),e.jsxs("div",{children:[t.count," parties"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(v,{dataKey:"count",name:"Nombre de Parties",fill:"var(--chart-color-2)",onClick:a=>{a&&a.days&&l({selectedGameDuration:a.days,fromComponent:"Distribution des Durées de Partie"})},style:{cursor:"pointer"}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Durée Moyenne par Ratio Loups/Joueurs"}),e.jsx(m,{title:"Durée Moyenne par Ratio Loups/Joueurs",children:e.jsx("div",{style:{height:300},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(W,{data:d,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(p,{strokeDasharray:"3 3"}),e.jsx(h,{dataKey:"ratio",type:"number",domain:["auto","auto"],allowDecimals:!1,tickFormatter:a=>`${a}%`,label:{value:"Ratio Loups/Joueurs (%)",position:"insideBottom",offset:-5}}),e.jsx(x,{label:{value:"Durée Moyenne (jours)",angle:-90,position:"insideLeft"}}),e.jsx(f,{content:({active:a,payload:r})=>{if(a&&r&&r.length>0){const t=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Pourcentage de loups : ",t.ratio]})}),e.jsxs("div",{children:["Durée moyenne : ",t.moyenne," jours"]}),e.jsxs("div",{children:["Nombre de parties : ",t.parties]})]})}return null}}),e.jsx(L,{}),e.jsx(P,{type:"monotone",dataKey:"moyenne",name:"Durée Moyenne",stroke:"var(--chart-color-5)",activeDot:{r:8}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Durée Moyenne par Camp Victorieux"}),e.jsx(m,{title:"Durée Moyenne par Camp Victorieux",children:e.jsx("div",{style:{height:300},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(D,{data:i,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(p,{strokeDasharray:"3 3"}),e.jsx(h,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(x,{label:{value:"Durée Moyenne (jours)",angle:-90,position:"insideLeft"}}),e.jsx(f,{content:({active:a,payload:r})=>{if(a&&r&&r.length>0){const t=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:t.camp})}),e.jsxs("div",{children:["Durée moyenne : ",t.moyenne," jours"]}),e.jsxs("div",{children:["Nombre de parties : ",t.parties]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsxs(v,{dataKey:"moyenne",name:"moyenne",isAnimationActive:!1,onClick:a=>{a&&a.camp&&l({selectedCamp:a.camp,campFilterMode:"wins-only",fromComponent:"Durée Moyenne par Camp Victorieux"})},style:{cursor:"pointer"},children:[i.map(a=>e.jsx(N,{fill:C[a.camp]||B},`cell-${a.camp}`)),e.jsx(R,{dataKey:"moyenne",position:"top",formatter:a=>{const r=typeof a=="number"?a:Number(a);return isNaN(r)?"":`${r.toFixed(1)}j`},fill:"var(--text-primary)",fontSize:12})]})]})})})})]})]})]})}export{z as GameDurationInsights};
