import{r as S,j as e,u as se,a as pe,e as ae}from"./index-Byn0jXxk.js";import{u as xe,c as ge}from"./useDeathStatisticsFromRaw-B7KjLd3L.js";import{D as W}from"./datasyncExport-CjB7UYqV.js";import{a as ye}from"./api-xwV9f9-o.js";import{F as ve,C as be,X as je,Y as Me,a as ze}from"./FullscreenChart-tQh2-SIV.js";import{g as Se,c as te,a as Ce,b as Ee,d as De,R as we}from"./deathLocationUtils-Ri2fHsc4.js";import{g as J}from"./deathTypes-gHH1w6_X.js";import{a7 as ke,a8 as ie,a9 as re,aa as Re,ab as K,R as Ne,T as Ae}from"./CategoricalChart-DqhaVbQW.js";import{S as Le,a as Te}from"./ScatterChart-CxFE2sFv.js";import"./baseStatsHook-CjbcAppl.js";const Ie=Be(Pe);function Be(t){return function(o,c,n=c){if(!((c=+c)>=0))throw new RangeError("invalid rx");if(!((n=+n)>=0))throw new RangeError("invalid ry");let{data:r,width:i,height:h}=o;if(!((i=Math.floor(i))>=0))throw new RangeError("invalid width");if(!((h=Math.floor(h!==void 0?h:r.length/i))>=0))throw new RangeError("invalid height");if(!i||!h||!c&&!n)return o;const g=c&&t(c),b=n&&t(n),a=r.slice();return g&&b?(U(g,a,r,i,h),U(g,r,a,i,h),U(g,a,r,i,h),Z(b,r,a,i,h),Z(b,a,r,i,h),Z(b,r,a,i,h)):g?(U(g,r,a,i,h),U(g,a,r,i,h),U(g,r,a,i,h)):b&&(Z(b,r,a,i,h),Z(b,a,r,i,h),Z(b,r,a,i,h)),o}}function U(t,o,c,n,r){for(let i=0,h=n*r;i<h;)t(o,c,i,i+=n,1)}function Z(t,o,c,n,r){for(let i=0,h=n*r;i<n;++i)t(o,c,i,i+h,n)}function Pe(t){const o=Math.floor(t);if(o===t)return We(t);const c=t-o,n=2*t+1;return(r,i,h,g,b)=>{if(!((g-=b)>=h))return;let a=o*i[h];const f=b*o,u=f+b;for(let d=h,j=h+f;d<j;d+=b)a+=i[Math.min(g,d)];for(let d=h,j=g;d<=j;d+=b)a+=i[Math.min(g,d+f)],r[d]=(a+c*(i[Math.max(h,d-u)]+i[Math.min(g,d+u)]))/n,a-=i[Math.max(h,d-f)]}}function We(t){const o=2*t+1;return(c,n,r,i,h)=>{if(!((i-=h)>=r))return;let g=t*n[r];const b=h*t;for(let a=r,f=r+b;a<f;a+=h)g+=n[Math.min(i,a)];for(let a=r,f=i;a<=f;a+=h)g+=n[Math.min(i,a+b)],c[a]=g/o,g-=n[Math.max(r,a-b)]}}function Fe(t,o){let c=0;for(let n of t)n!=null&&(n=+n)>=n&&++c;return c}function He(t,o){let c,n;if(o===void 0)for(const r of t)r!=null&&(c===void 0?r>=r&&(c=n=r):(c>r&&(c=r),n<r&&(n=r)));else{let r=-1;for(let i of t)(i=o(i,++r,t))!=null&&(c===void 0?i>=i&&(c=n=i):(c>i&&(c=i),n<i&&(n=i)))}return[c,n]}function Ve(t,o,c){let n;for(;;){const r=ke(t,o,c);if(r===n||r===0||!isFinite(r))return[t,o];r>0?(t=Math.floor(t/r)*r,o=Math.ceil(o/r)*r):r<0&&(t=Math.ceil(t*r)/r,o=Math.floor(o*r)/r),n=r}}function Xe(t){return Math.max(1,Math.ceil(Math.log(Fe(t))/Math.LN2)+1)}var qe=Array.prototype,le=qe.slice;function $e(t,o){return t-o}function Ye(t){for(var o=0,c=t.length,n=t[c-1][1]*t[0][0]-t[c-1][0]*t[0][1];++o<c;)n+=t[o-1][1]*t[o][0]-t[o-1][0]*t[o][1];return n}const Y=t=>()=>t;function Ge(t,o){for(var c=-1,n=o.length,r;++c<n;)if(r=Ue(t,o[c]))return r;return 0}function Ue(t,o){for(var c=o[0],n=o[1],r=-1,i=0,h=t.length,g=h-1;i<h;g=i++){var b=t[i],a=b[0],f=b[1],u=t[g],d=u[0],j=u[1];if(Ze(b,u,o))return 0;f>n!=j>n&&c<(d-a)*(n-f)/(j-f)+a&&(r=-r)}return r}function Ze(t,o,c){var n;return Oe(t,o,c)&&Ke(t[n=+(t[0]===o[0])],c[n],o[n])}function Oe(t,o,c){return(o[0]-t[0])*(c[1]-t[1])===(c[0]-t[0])*(o[1]-t[1])}function Ke(t,o,c){return t<=o&&o<=c||c<=o&&o<=t}function Je(){}var q=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function ne(){var t=1,o=1,c=Xe,n=b;function r(a){var f=c(a);if(Array.isArray(f))f=f.slice().sort($e);else{const u=He(a,Qe);for(f=ie(...Ve(u[0],u[1],f),f);f[f.length-1]>=u[1];)f.pop();for(;f[1]<u[0];)f.shift()}return f.map(u=>i(a,u))}function i(a,f){const u=f==null?NaN:+f;if(isNaN(u))throw new Error(`invalid value: ${f}`);var d=[],j=[];return h(a,u,function(x){n(x,a,u),Ye(x)>0?d.push([x]):j.push(x)}),j.forEach(function(x){for(var w=0,y=d.length,m;w<y;++w)if(Ge((m=d[w])[0],x)!==-1){m.push(x);return}}),{type:"MultiPolygon",value:f,coordinates:d}}function h(a,f,u){var d=new Array,j=new Array,x,w,y,m,s,v;for(x=w=-1,m=G(a[0],f),q[m<<1].forEach(l);++x<t-1;)y=m,m=G(a[x+1],f),q[y|m<<1].forEach(l);for(q[m<<0].forEach(l);++w<o-1;){for(x=-1,m=G(a[w*t+t],f),s=G(a[w*t],f),q[m<<1|s<<2].forEach(l);++x<t-1;)y=m,m=G(a[w*t+t+x+1],f),v=s,s=G(a[w*t+x+1],f),q[y|m<<1|s<<2|v<<3].forEach(l);q[m|s<<3].forEach(l)}for(x=-1,s=a[w*t]>=f,q[s<<2].forEach(l);++x<t-1;)v=s,s=G(a[w*t+x+1],f),q[s<<2|v<<3].forEach(l);q[s<<3].forEach(l);function l(M){var C=[M[0][0]+x,M[0][1]+w],R=[M[1][0]+x,M[1][1]+w],D=g(C),A=g(R),z,L;(z=j[D])?(L=d[A])?(delete j[z.end],delete d[L.start],z===L?(z.ring.push(R),u(z.ring)):d[z.start]=j[L.end]={start:z.start,end:L.end,ring:z.ring.concat(L.ring)}):(delete j[z.end],z.ring.push(R),j[z.end=A]=z):(z=d[A])?(L=j[D])?(delete d[z.start],delete j[L.end],z===L?(z.ring.push(R),u(z.ring)):d[L.start]=j[z.end]={start:L.start,end:z.end,ring:L.ring.concat(z.ring)}):(delete d[z.start],z.ring.unshift(C),d[z.start=D]=z):d[D]=j[A]={start:D,end:A,ring:[C,R]}}}function g(a){return a[0]*2+a[1]*(t+1)*4}function b(a,f,u){a.forEach(function(d){var j=d[0],x=d[1],w=j|0,y=x|0,m=Q(f[y*t+w]);j>0&&j<t&&w===j&&(d[0]=oe(j,Q(f[y*t+w-1]),m,u)),x>0&&x<o&&y===x&&(d[1]=oe(x,Q(f[(y-1)*t+w]),m,u))})}return r.contour=i,r.size=function(a){if(!arguments.length)return[t,o];var f=Math.floor(a[0]),u=Math.floor(a[1]);if(!(f>=0&&u>=0))throw new Error("invalid size");return t=f,o=u,r},r.thresholds=function(a){return arguments.length?(c=typeof a=="function"?a:Array.isArray(a)?Y(le.call(a)):Y(a),r):c},r.smooth=function(a){return arguments.length?(n=a?b:Je,r):n===b},r}function Qe(t){return isFinite(t)?t:NaN}function G(t,o){return t==null?!1:+t>=o}function Q(t){return t==null||isNaN(t=+t)?-1/0:t}function oe(t,o,c,n){const r=n-o,i=c-o,h=isFinite(r)||isFinite(i)?r/i:Math.sign(r)/Math.sign(i);return isNaN(h)?t:t+h-.5}function _e(t){return t[0]}function et(t){return t[1]}function tt(){return 1}function ce(){var t=_e,o=et,c=tt,n=960,r=500,i=20,h=2,g=i*3,b=n+g*2>>h,a=r+g*2>>h,f=Y(20);function u(s){var v=new Float32Array(b*a),l=Math.pow(2,-h),M=-1;for(const O of s){var C=(t(O,++M,s)+g)*l,R=(o(O,M,s)+g)*l,D=+c(O,M,s);if(D&&C>=0&&C<b&&R>=0&&R<a){var A=Math.floor(C),z=Math.floor(R),L=C-A-.5,$=R-z-.5;v[A+z*b]+=(1-L)*(1-$)*D,v[A+1+z*b]+=L*(1-$)*D,v[A+1+(z+1)*b]+=L*$*D,v[A+(z+1)*b]+=(1-L)*$*D}}return Ie({data:v,width:b,height:a},i*l),v}function d(s){var v=u(s),l=f(v),M=Math.pow(2,2*h);return Array.isArray(l)||(l=ie(Number.MIN_VALUE,re(v)/M,l)),ne().size([b,a]).thresholds(l.map(C=>C*M))(v).map((C,R)=>(C.value=+l[R],j(C)))}d.contours=function(s){var v=u(s),l=ne().size([b,a]),M=Math.pow(2,2*h),C=R=>{R=+R;var D=j(l.contour(v,R*M));return D.value=R,D};return Object.defineProperty(C,"max",{get:()=>re(v)/M}),C};function j(s){return s.coordinates.forEach(x),s}function x(s){s.forEach(w)}function w(s){s.forEach(y)}function y(s){s[0]=s[0]*Math.pow(2,h)-g,s[1]=s[1]*Math.pow(2,h)-g}function m(){return g=i*3,b=n+g*2>>h,a=r+g*2>>h,d}return d.x=function(s){return arguments.length?(t=typeof s=="function"?s:Y(+s),d):t},d.y=function(s){return arguments.length?(o=typeof s=="function"?s:Y(+s),d):o},d.weight=function(s){return arguments.length?(c=typeof s=="function"?s:Y(+s),d):c},d.size=function(s){if(!arguments.length)return[n,r];var v=+s[0],l=+s[1];if(!(v>=0&&l>=0))throw new Error("invalid size");return n=v,r=l,m()},d.cellSize=function(s){if(!arguments.length)return 1<<h;if(!((s=+s)>=1))throw new Error("invalid cell size");return h=Math.floor(Math.log(s)/Math.LN2),m()},d.thresholds=function(s){return arguments.length?(f=typeof s=="function"?s:Array.isArray(s)?Y(le.call(s)):Y(s),d):f},d.bandwidth=function(s){if(!arguments.length)return Math.sqrt(i*(i+1));if(!((s=+s)>=0))throw new Error("invalid bandwidth");return i=(Math.sqrt(4*s*s+1)-1)/2,m()},d}function rt(t){for(var o=t.length/6|0,c=new Array(o),n=0;n<o;)c[n]="#"+t.slice(n*6,++n*6);return c}const nt=t=>Re(t[t.length-1]);var ot=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(rt);const de=nt(ot);function st({deathLocations:t,xDomain:o,zDomain:c,width:n=800,height:r=600,bandwidth:i=25,onRegionClick:h,mapConfig:g}){const b=S.useRef(null),a=S.useRef(null),f=S.useRef(null),u=S.useRef(null),[,d]=S.useState(!1),j=S.useMemo(()=>K().domain(c).range([0,n]),[c,n]),x=S.useMemo(()=>K().domain(o).range([r,0]),[o,r]),w=S.useMemo(()=>t.length===0?[]:ce().x(l=>j(l.z)).y(l=>x(l.x)).size([n,r]).bandwidth(i).thresholds(15)(t),[t,x,j,n,r,i]),y=S.useMemo(()=>{const v=w.length>0?Math.max(...w.map(l=>l.value)):1;return l=>{const M=l/v;return de(M)}},[w]);S.useEffect(()=>{const v=f.current;if(!v||!g){d(!1);return}const l=v.getContext("2d");if(!l)return;l.clearRect(0,0,n,r);const M=new Image;M.onload=()=>{l.globalAlpha=.85,l.drawImage(M,0,0,n,r),l.globalAlpha=1,d(!0)},M.onerror=()=>{d(!1)},M.src=g.src},[g,n,r]),S.useEffect(()=>{const v=b.current;if(!v||w.length===0)return;const l=v.getContext("2d");l&&(l.clearRect(0,0,n,r),w.forEach(M=>{l.fillStyle=y(M.value),l.globalAlpha=.6,M.coordinates.forEach(C=>{C.forEach(R=>{l.beginPath(),R.forEach((D,A)=>{A===0?l.moveTo(D[0],D[1]):l.lineTo(D[0],D[1])}),l.closePath(),l.fill()})})}),l.globalAlpha=1)},[w,n,r,y]),S.useEffect(()=>{const v=a.current;if(!v||t.length===0)return;const l=v.getContext("2d");l&&(l.clearRect(0,0,n,r),t.forEach(M=>{const C=j(M.z),R=x(M.x);l.beginPath(),l.arc(C,R,2,0,2*Math.PI),l.fillStyle="rgba(0, 0, 0, 0.3)",l.fill(),l.strokeStyle="rgba(255, 255, 255, 0.5)",l.lineWidth=.5,l.stroke()}))},[t,x,j,n,r]);const m=v=>{if(!h||!u.current)return;const l=u.current.getBoundingClientRect(),M=v.clientX-l.left,C=v.clientY-l.top,R=30,D=t.filter(A=>{const z=j(A.z),L=x(A.x);return Math.sqrt(Math.pow(z-M,2)+Math.pow(L-C,2))<=R});D.length>0&&h(D)},s=v=>{if(!u.current)return;const l=u.current.getBoundingClientRect(),M=v.clientX-l.left,C=v.clientY-l.top,R=20,D=t.filter(A=>{const z=j(A.z),L=x(A.x);return Math.sqrt(Math.pow(z-M,2)+Math.pow(L-C,2))<=R});u.current&&(u.current.style.cursor=D.length>0?"pointer":"default")};return e.jsxs("div",{ref:u,style:{position:"relative",width:`${n}px`,height:`${r}px`,margin:"0 auto"},onClick:m,onMouseMove:s,children:[e.jsx("canvas",{ref:f,width:n,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),e.jsx("canvas",{ref:b,width:n,height:r,style:{position:"absolute",top:0,left:0,borderRadius:"4px",pointerEvents:"none"}}),e.jsx("canvas",{ref:a,width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}})]})}function at({selectedCamp:t,availableDeathTypes:o,deathTypeColors:c}){const{navigateToGameDetails:n,navigationState:r,updateNavigationState:i}=se(),{settings:h}=pe(),{data:g,isLoading:b,error:a}=ae(),[f,u]=S.useState(""),[d,j]=S.useState(r.deathLocationState?.selectedDeathTypes||[]),[x,w]=S.useState(null),[y,m]=S.useState("heatmap"),[s,v]=S.useState(20),[l,M]=S.useState(!1),C=S.useMemo(()=>{if(!g)return[];const p=Se(g),N=te(g,t),E=new Map;return N.forEach(k=>{E.set(k.mapName,(E.get(k.mapName)||0)+1)}),p.sort((k,P)=>{const T=E.get(k)||0;return(E.get(P)||0)-T})},[g,t]),R=C.length>0?C[0]:"";f===""&&R!==""&&u(R);const D=S.useMemo(()=>{if(!g)return[];let p=te(g,t);return f&&(p=p.filter(N=>N.mapName===f)),d.length>0&&(p=p.filter(N=>d.includes(N.deathType))),p},[g,t,f,d]),A=S.useMemo(()=>Ce(D,s),[D,s]),z=S.useMemo(()=>A.map((p,N)=>{const E=p.items[0],k=Ee(p.items);return{x:p.centroidX,z:p.centroidZ,deathCount:p.items.length,allDeaths:p.items,dominantDeathType:k,playerName:p.items.length===1?E.playerName:null,gameId:p.items.length===1?E.gameId:null,camp:E.camp,mapName:E.mapName,deathType:k,killerName:p.items.length===1?E.killerName:null,clusterIndex:N}}),[A]),L=({active:p,payload:N})=>{if(!p||!N||N.length===0)return null;const E=N[0].payload,k=E.allDeaths||[E];if(k.length>1){const F=new Map,V=new Set,X=new Map;k.forEach(I=>{const H=I.deathType?J(I.deathType):"Inconnu";F.set(H,(F.get(H)||0)+1),V.add(I.gameId),X.set(I.playerName,(X.get(I.playerName)||0)+1)});const ue=Array.from(X.entries()).sort((I,H)=>H[1]-I[1]).slice(0,3),fe=X.size>3,me=Array.from(F.entries()).sort((I,H)=>H[1]-I[1]).slice(0,3),he=F.size>3;return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[k.length," morts dans cette zone"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Centre:"})," (",Math.round(E.x),", ",Math.round(E.z),")"]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Joueurs:"}),e.jsxs("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:[ue.map(([I,H])=>e.jsxs("li",{children:[I," ",H>1?`(${H} morts)`:""]},I)),fe&&e.jsxs("li",{style:{color:"var(--text-secondary)"},children:["...et ",X.size-3," autres"]})]})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Types de mort:"}),e.jsxs("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:[me.map(([I,H])=>e.jsxs("li",{children:[I," (",H,")"]},I)),he&&e.jsxs("li",{style:{color:"var(--text-secondary)"},children:["...et ",F.size-3," autres"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Parties:"})," ",V.size," parties",V.size<=5&&e.jsxs("span",{children:[" (",Array.from(V).filter(I=>I).map(I=>`#${I}`).join(", "),")"]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const T=k[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:T.playerName}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Camp:"})," ",T.camp]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type de mort:"})," ",T.deathType?J(T.deathType):"Inconnu"]}),T.killerName&&e.jsxs("div",{children:[e.jsx("strong",{children:"TuÃ© par:"})," ",T.killerName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Carte:"})," ",T.mapName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Partie:"})," #",T.gameId]}),e.jsxs("div",{style:{marginTop:"4px",fontSize:"0.85rem",color:"var(--text-secondary)"},children:["Position: (",Math.round(T.x),", ",Math.round(T.z),")"]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})},$=p=>{if(!p)return;const N=p.allDeaths||[p];if(N.length===1)n({selectedGame:N[0].gameId,fromComponent:"Death Location View"});else{const E=N.map(k=>k.gameId).filter(k=>k);n({selectedGameIds:E,fromComponent:"Death Location View"})}},O=p=>p&&c[p]||"var(--text-secondary)",B=S.useMemo(()=>De(f),[f]),{xDomain:_,zDomain:ee}=S.useMemo(()=>{if(B)return{xDomain:[B.xMin,B.xMax],zDomain:[B.zMin,B.zMax]};if(z.length===0)return{xDomain:[0,100],zDomain:[0,100]};const p=z.map(X=>X.x),N=z.map(X=>X.z),E=Math.min(...p),k=Math.max(...p),P=Math.min(...N),T=Math.max(...N),F=(k-E)*.1||10,V=(T-P)*.1||10;return{xDomain:[E-F,k+F],zDomain:[P-V,T+V]}},[z,B]);return b?e.jsx("div",{className:"donnees-attente",children:"Chargement des localisations de mort..."}):a?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",a]}):g?e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Mode :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>m("heatmap"),style:{background:y==="heatmap"?"var(--accent-primary)":"transparent",color:y==="heatmap"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:y==="heatmap"?"bold":"normal",transition:"all 0.2s"},children:"Carte de chaleur"}),e.jsx("button",{type:"button",onClick:()=>m("scatter"),style:{background:y==="scatter"?"var(--accent-primary)":"transparent",color:y==="scatter"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:y==="scatter"?"bold":"normal",transition:"all 0.2s"},children:"Points"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"map-select",value:f,onChange:p=>u(p.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:C.filter(p=>p==="Village"||p==="ChÃ¢teau").map(p=>e.jsx("option",{value:p,children:p},p))})]}),e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>M(!l),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:l?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:l?"rotate(90deg)":"rotate(0deg)"},children:"â–¶"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[d.length," / ",o.length," sÃ©lectionnÃ©",d.length>1?"s":""]})]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:p=>{p.stopPropagation(),j(o),i({deathLocationState:{...r.deathLocationState,selectedCamp:t,selectedDeathTypes:o}})},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:p=>{p.stopPropagation(),j([]),i({deathLocationState:{...r.deathLocationState,selectedCamp:t,selectedDeathTypes:[]}})},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:o.map(p=>{const N=d.includes(p),E=c[p]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",borderRadius:"4px",cursor:"pointer",background:N?E:"var(--bg-tertiary)",color:N?"white":"var(--text-primary)",border:`1px solid ${N?E:"var(--border-color)"}`,transition:"all 0.2s",fontSize:"0.85rem",fontWeight:N?"600":"normal"},onMouseEnter:k=>{N||(k.currentTarget.style.background="var(--bg-hover)",k.currentTarget.style.borderColor=E)},onMouseLeave:k=>{N||(k.currentTarget.style.background="var(--bg-tertiary)",k.currentTarget.style.borderColor="var(--border-color)")},children:[e.jsx("input",{type:"checkbox",checked:N,onChange:k=>{const P=k.target.checked?[...d,p]:d.filter(T=>T!==p);j(P),i({deathLocationState:{...r.deathLocationState,selectedCamp:t,selectedDeathTypes:P}})},style:{cursor:"pointer",accentColor:E}}),e.jsx("span",{children:J(p)})]},p)})})]})]}),y==="scatter"&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-radius",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-radius",type:"range",min:"0",max:"60",step:"5",value:s,onChange:p=>v(Number(p.target.value)),style:{width:"100px",cursor:"pointer"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.85rem",minWidth:"70px"},children:s===0?"Aucun":`${s} unitÃ©s`})]})]}),D.length>0?e.jsx(ve,{title:y==="scatter"?"Carte des Morts":"Carte de Chaleur des Morts",children:y==="scatter"?e.jsx("div",{style:{height:700,width:"100%",maxWidth:1e3,margin:"0 auto"},children:e.jsx(Ne,{width:"100%",height:"100%",children:e.jsxs(Le,{margin:{top:20,right:30,left:60,bottom:60},children:[B&&e.jsx(we,{x1:B.zMin,x2:B.zMax,y1:B.xMin,y2:B.xMax,fill:"transparent",stroke:"none",shape:p=>{const{x:N,y:E,width:k,height:P}=p;return e.jsx("image",{x:N,y:E,width:k,height:P,href:B.src,preserveAspectRatio:"none",style:{opacity:.85}})}}),e.jsx(be,{strokeDasharray:"3 3",stroke:B?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(je,{dataKey:"z",type:"number",name:"Position Z",domain:ee,hide:!0}),e.jsx(Me,{dataKey:"x",type:"number",name:"Position X",domain:_,hide:!0}),e.jsx(Ae,{content:e.jsx(L,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Te,{data:z,onClick:p=>$(p),onMouseEnter:p=>w(p),onMouseLeave:()=>w(null),style:{cursor:"pointer"},isAnimationActive:!1,children:z.map((p,N)=>{const E=p.allDeaths.some(V=>h.highlightedPlayer===V.playerName),k=x&&p.clusterIndex===x.clusterIndex,P=Math.min(Math.log2(p.deathCount+1)*3+4,18),T=Math.round(P),F=T+2;return e.jsx(ze,{fill:E?"var(--accent-primary-text)":O(p.deathType),stroke:E||k?"white":p.deathCount>1?"rgba(255,255,255,0.6)":"none",strokeWidth:E?3:k?2:p.deathCount>1?1.5:0,opacity:E?1:.8,r:E?F:k?T+1:T},`cell-${N}`)})})]})})}):e.jsx("div",{style:{padding:"2rem 0",display:"flex",justifyContent:"center"},children:e.jsx(st,{deathLocations:D,xDomain:_,zDomain:ee,width:1e3,height:700,bandwidth:25,mapConfig:B,onRegionClick:p=>{if(p.length===1)n({selectedGame:p[0].gameId,fromComponent:"Death Location View (Heatmap)"});else{const N=p.map(E=>E.gameId).filter(E=>E);n({selectedGameIds:N,fromComponent:"Death Location View (Heatmap)"})}}})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1rem"},children:"Aucune localisation de mort disponible pour les filtres sÃ©lectionnÃ©s"}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes (non-legacy)."})]}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginTop:"2rem",marginBottom:"2rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Morts localisÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary-text)"},children:D.length}),y==="scatter"&&s>0&&z.length<D.length&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"4px"},children:["â†’ ",z.length," points groupÃ©s"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camp filtrÃ©"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)",fontSize:"1.2rem"},children:t})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Types de mort"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-2)",fontSize:"1.2rem"},children:d.length===0||d.length===o.length?"Tous":`${d.length} type${d.length>1?"s":""}`})]})]}),e.jsxs("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:[e.jsx("p",{children:e.jsx("strong",{children:"Ã€ propos de cette visualisation :"})}),e.jsxs("ul",{style:{marginTop:"0.5rem",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Les positions sont basÃ©es sur les coordonnÃ©es Z (horizontal) et X (vertical) - vue 2D de la carte"}),y==="scatter"?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:'Les morts proches sont regroupÃ©es en un seul point - ajustez le curseur "Regroupement" pour contrÃ´ler la distance'}),e.jsx("li",{children:"Les points regroupÃ©s ont une petite bordure blanche"}),e.jsx("li",{children:"La couleur indique le type de mort dominant dans ce regroupement"}),e.jsx("li",{children:"Survolez un point pour voir tous les joueurs, types de mort et parties concernÃ©s"}),e.jsxs("li",{children:["Le joueur sÃ©lectionnÃ© est affichÃ© en "," ",e.jsx("span",{style:{color:"var(--accent-primary)",fontWeight:"bold"},children:"couleur primaire"})]}),e.jsx("li",{children:"Cliquez sur un point pour voir les dÃ©tails de la ou des parties"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"La carte de chaleur montre les zones de forte densitÃ© de morts (du jaune au rouge)"}),e.jsx("li",{children:"Les points noirs indiquent l'emplacement exact de chaque mort"}),e.jsx("li",{children:"Les zones rouges indiquent une concentration Ã©levÃ©e de morts"}),e.jsx("li",{children:"Cliquez sur une zone pour voir les dÃ©tails des parties associÃ©es"}),e.jsx("li",{children:'Utilisez le mode "Points" pour voir les dÃ©tails individuels par type de mort'})]})]}),e.jsx("p",{style:{marginTop:"0.5rem",fontStyle:"italic",color:"var(--text-secondary)"},children:"Note : Seules les parties rÃ©centes contiennent des donnÃ©es de position."})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function gt({deathLocations:t,xDomain:o,zDomain:c,width:n=800,height:r=600,bandwidth:i=25,onRegionClick:h}){const g=S.useRef(null),b=S.useRef(null),a=S.useRef(null),f=S.useMemo(()=>K().domain(o).range([0,n]),[o,n]),u=S.useMemo(()=>K().domain(c).range([r,0]),[c,r]),d=S.useMemo(()=>t.length===0?[]:ce().x(m=>f(m.x)).y(m=>u(m.z)).size([n,r]).bandwidth(i).thresholds(15)(t),[t,f,u,n,r,i]),j=S.useMemo(()=>{const y=d.length>0?Math.max(...d.map(m=>m.value)):1;return m=>{const s=m/y;return de(s)}},[d]);S.useEffect(()=>{const y=g.current;if(!y||d.length===0)return;const m=y.getContext("2d");m&&(m.clearRect(0,0,n,r),d.forEach(s=>{m.fillStyle=j(s.value),m.globalAlpha=.6,s.coordinates.forEach(v=>{v.forEach(l=>{m.beginPath(),l.forEach((M,C)=>{C===0?m.moveTo(M[0],M[1]):m.lineTo(M[0],M[1])}),m.closePath(),m.fill()})})}),m.globalAlpha=1)},[d,n,r,j]),S.useEffect(()=>{const y=b.current;if(!y||t.length===0)return;const m=y.getContext("2d");m&&(m.clearRect(0,0,n,r),t.forEach(s=>{const v=f(s.x),l=u(s.z);m.beginPath(),m.arc(v,l,2,0,2*Math.PI),m.fillStyle="rgba(0, 0, 0, 0.3)",m.fill(),m.strokeStyle="rgba(255, 255, 255, 0.5)",m.lineWidth=.5,m.stroke()}))},[t,f,u,n,r]);const x=y=>{if(!h||!a.current)return;const m=a.current.getBoundingClientRect(),s=y.clientX-m.left,v=y.clientY-m.top,l=30,M=t.filter(C=>{const R=f(C.x),D=u(C.z);return Math.sqrt(Math.pow(R-s,2)+Math.pow(D-v,2))<=l});M.length>0&&h(M)},w=y=>{if(!a.current)return;const m=a.current.getBoundingClientRect(),s=y.clientX-m.left,v=y.clientY-m.top,l=20,M=t.filter(C=>{const R=f(C.x),D=u(C.z);return Math.sqrt(Math.pow(R-s,2)+Math.pow(D-v,2))<=l});a.current&&(a.current.style.cursor=M.length>0?"pointer":"default")};return e.jsxs("div",{ref:a,style:{position:"relative",width:`${n}px`,height:`${r}px`,margin:"0 auto"},onClick:x,onMouseMove:w,children:[e.jsx("canvas",{ref:g,width:n,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),e.jsx("canvas",{ref:b,width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),e.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),e.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),e.jsxs("svg",{width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(y=>{const m=n*y,s=o[0]+(o[1]-o[0])*y;return e.jsxs("g",{children:[e.jsx("line",{x1:m,y1:r,x2:m,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:m,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(s)})]},`x-${y}`)}),[0,.25,.5,.75,1].map(y=>{const m=r*(1-y),s=c[0]+(c[1]-c[0])*y;return e.jsxs("g",{children:[e.jsx("line",{x1:0,y1:m,x2:5,y2:m,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:10,y:m,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(s)})]},`z-${y}`)})]})]})}function yt(){const{navigationState:t,updateNavigationState:o}=se(),[c,n]=S.useState(t.deathLocationState?.selectedCamp||"Tous les camps"),{data:r}=xe(),{data:i}=ae(),h=ye(),g=S.useMemo(()=>i?ge(i):[],[i]),b=S.useMemo(()=>g.filter(u=>u!=="VOTED"),[g]);S.useEffect(()=>{!t.deathLocationState?.selectedDeathTypes&&g.length>0&&o({deathLocationState:{selectedCamp:c,selectedDeathTypes:b}})},[g,b,t.deathLocationState,c,o]);const a=S.useMemo(()=>{const u={};g.forEach(x=>{x===W.BY_WOLF?u[x]=h.Loup:x===W.VOTED?u[x]="var(--chart-color-1)":x===W.BULLET||x===W.BULLET_HUMAN||x===W.BULLET_WOLF?u[x]=h.Chasseur:x===W.BY_ZOMBIE?u[x]=h.Vaudou:x===W.ASSASSIN?u[x]=h.Alchimiste:x===W.AVENGER?u[x]="var(--chart-color-2)":x===W.LOVER_DEATH?u[x]=h.Amoureux:x===W.BY_BEAST?u[x]="var(--chart-color-3)":x===W.SHERIF_SUCCESS?u[x]="var(--chart-color-4)":x===W.SMUGGLER_HUNT_KILL&&(u[x]=h.Contrebandier)});const d=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let j=0;return g.forEach(x=>{u[x]||(u[x]=d[j%d.length],j++)}),u},[g,h]),f=u=>{n(u),o({deathLocationState:{selectedCamp:u}})};return e.jsxs("div",{className:"lycans-general-stats",children:[e.jsx("h2",{children:"ðŸ—ºï¸ Carte de Chaleur des Morts"}),e.jsx("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select",value:c,onChange:u=>f(u.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"},"tous"),r?.filter(u=>u!=="Tous les camps").map(u=>e.jsx("option",{value:u,children:u},u))]})]})}),e.jsx(at,{selectedCamp:c,availableDeathTypes:g,deathTypeColors:a})]})}export{yt as DeathLocationHeatmap,gt as DeathLocationHeatmapCanvas};
