import{u as Y,r as z,c as Q,a as _,j as e}from"./index-D7S6jFiA.js";import{u as Z}from"./baseStatsHook-CeWAO9au.js";import{g as W}from"./gameUtils-C0qLdSzT.js";import{F as H,B as w,C as V,X as q,Y as J,a as O}from"./FullscreenChart-Cbx9ZJ7P.js";import{a as ee,m as te}from"./api-CGiD5xL_.js";import{R as $,T as U}from"./CategoricalChart-B8LqodGe.js";function ae(h){const l=new Set;h.filter(j=>!j.LegacyData||j.LegacyData.deathInformationFilled===!0).forEach(j=>{j.PlayerStats.forEach(N=>{if(j.PlayerStats.some(k=>k.KillerName===N.Username)){const k=W(N.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupTraitor:!0});l.add(k)}})});const o=Array.from(l),g=["Villageois","Loup","Amoureux"];return[...g.filter(j=>o.includes(j)),...o.filter(j=>!g.includes(j)).sort()]}function re(h){if(!h)return null;const l=h.match(/^([NJM])(\d+)$/);if(!l)return null;const[,m,o]=l,g=parseInt(o,10);let n;switch(m){case"N":n="Nuit";break;case"J":n="Jour";break;case"M":n="Meeting";break;default:return null}return{phase:n,day:g,originalString:h}}function X(h){if(!h||h=="N/A")return"Survivant";const l=h.trim();return l.includes("vote")||l.includes("Vote")?"Mort aux votes":l.includes("Loup")||l.includes("loup")?"Kill en Loup":l.includes("Zombie")||l.includes("zombie")?"Kill en Zombie":l.includes("Chasseur")||l.includes("chasseur")?"Tir de Chasseur":l.includes("Déco")||l.includes("déco")?"Déconnexion":l.includes("Potion")||l.includes("potion")?"Kill avec Potion":l.includes("vengeur")||l.includes("Vengeur")?"Kill en Vengeur":l}function ie(h){const l=new Set;h.forEach(g=>{g.PlayerStats.forEach(n=>{n.DeathType&&l.add(X(n.DeathType))})});const m=Array.from(l),o=["Kill en Loup","Mort aux votes","Tir de Chasseur","Kill en Zombie","Kill avec Potion","Kill en Vengeur","Déconnexion","Survivant"];return[...o.filter(g=>m.includes(g)),...m.filter(g=>!o.includes(g)).sort()]}function le(h,l){return h.PlayerStats.filter(m=>m.DeathTiming||m.DeathType).map(m=>{let o=null;if(m.KillerName){const g=h.PlayerStats.find(n=>n.Username===m.KillerName);g&&(o=W(g.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupTraitor:!0}))}return{playerName:m.Username,deathTiming:re(m.DeathTiming),deathType:X(m.DeathType),killerName:m.KillerName,killerCamp:o}}).filter(m=>!l||l==="Tous les camps"?!0:m.killerCamp===l)}function se(h,l){if(h.length===0)return null;const m=h.filter(t=>!t.LegacyData||t.LegacyData.deathInformationFilled===!0);if(m.length===0)return null;const o=[],g={};m.forEach(t=>{le(t,l).forEach(p=>{o.push({...p,gameId:t.Id})}),t.PlayerStats.forEach(p=>{const a=p.Username;(!l||l==="Tous les camps"||W(p.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupTraitor:!0})===l)&&(g[a]=(g[a]||0)+1)})});const n=o.length,j=m.length,N=j>0?n/j:0,x={},k={Nuit:0,Jour:0,Meeting:0};o.forEach(t=>{if(t.deathTiming){const r=`${t.deathTiming.phase}-${t.deathTiming.day}`;x[r]=(x[r]||0)+1,k[t.deathTiming.phase]++}});const G=Object.entries(x).map(([t,r])=>{const[p,a]=t.split("-");return{phase:p,day:parseInt(a,10),count:r,percentage:n>0?r/n*100:0}}).sort((t,r)=>{if(t.phase!==r.phase){const p={Nuit:0,Jour:1,Meeting:2};return p[t.phase]-p[r.phase]}return t.day-r.day}),K={};o.forEach(t=>{K[t.deathType]=(K[t.deathType]||0)+1});const c=Object.entries(K).map(([t,r])=>({type:t,count:r,percentage:n>0?r/n*100:0})).sort((t,r)=>r.count-t.count),P={};o.forEach(t=>{if(t.killerName){P[t.killerName]||(P[t.killerName]={kills:0,victims:new Set,killsByDeathType:{}}),P[t.killerName].kills++,P[t.killerName].victims.add(t.playerName);const r=t.deathType;P[t.killerName].killsByDeathType[r]=(P[t.killerName].killsByDeathType[r]||0)+1}});const v=Object.entries(P).map(([t,r])=>{const p=g[t]||0,a=p>0?r.kills/p:0;return{killerName:t,kills:r.kills,victims:Array.from(r.victims),percentage:n>0?r.kills/n*100:0,gamesPlayed:p,averageKillsPerGame:a,killsByDeathType:r.killsByDeathType}}).sort((t,r)=>r.kills-t.kills),S={};o.forEach(t=>{S[t.playerName]||(S[t.playerName]={totalDeaths:0,deathsByPhase:{Nuit:0,Jour:0,Meeting:0},deathsByType:{},killedBy:{},deathDays:[]});const r=S[t.playerName];r.totalDeaths++,t.deathTiming&&(r.deathsByPhase[t.deathTiming.phase]++,r.deathDays.push(t.deathTiming.day)),r.deathsByType[t.deathType]=(r.deathsByType[t.deathType]||0)+1,t.killerName&&(r.killedBy[t.killerName]=(r.killedBy[t.killerName]||0)+1)});const F=Object.entries(S).map(([t,r])=>({playerName:t,totalDeaths:r.totalDeaths,deathsByPhase:r.deathsByPhase,deathsByType:r.deathsByType,killedBy:r.killedBy,averageDeathDay:r.deathDays.length>0?r.deathDays.reduce((p,a)=>p+a,0)/r.deathDays.length:null,deathRate:g[t]>0?r.totalDeaths/g[t]:0})).sort((t,r)=>r.totalDeaths-t.totalDeaths),E=Object.entries(k).reduce((t,[r,p])=>p>t.count?{phase:r,count:p}:t,{phase:"Nuit",count:0}).phase,C={};o.forEach(t=>{t.deathTiming&&(C[t.deathTiming.day]=(C[t.deathTiming.day]||0)+1)});const L=Object.entries(C).reduce((t,[r,p])=>p>t.count?{day:parseInt(r,10),count:p}:t,{day:1,count:0}).day,R=c.length>0?c[0].type:"",I=v.length>0?v[0].killerName:null;return{totalDeaths:n,totalGames:j,averageDeathsPerGame:N,deathsByTiming:G,deathsByPhase:k,deathsByType:c,killerStats:v,playerDeathStats:F,mostDeadlyPhase:E,mostDeadlyDay:L,mostCommonDeathType:R,mostDeadlyKiller:I}}function ne(h){return Z(l=>se(l,h))}function oe(){return Z(h=>ae(h))}function ue(){const{navigateToGameDetails:h,navigationState:l,updateNavigationState:m}=Y(),[o,g]=z.useState(l.deathStatsSelectedCamp||"Tous les camps"),[n,j]=z.useState(5),{data:N}=oe(),{data:x,isLoading:k,error:G}=ne(o),{data:K}=Q(),{settings:c}=_(),P=ee(),v=z.useMemo(()=>K?ie(K.GameStats):[],[K]),S=z.useMemo(()=>{const a={"Kill en Loup":P.Loup,"Mort aux votes":"var(--chart-color-1)","Tir de Chasseur":P.Chasseur,"Kill en Zombie":P.Vaudou,"Kill avec Potion":P.Alchimiste,"Kill en Vengeur":"var(--chart-color-2)",Déconnexion:"var(--chart-color-3)",Survivant:"var(--chart-color-4)"},u=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let d=0;return v.forEach(y=>{a[y]||(a[y]=u[d%u.length],d++)}),a},[v,P]),F=a=>{g(a),m({deathStatsSelectedCamp:a})},{totalKillsData:E,averageKillsData:C,highlightedPlayerAddedToTotal:L,highlightedPlayerAddedToAverage:R,gamesWithKillers:I,totalEligibleForAverage:t}=z.useMemo(()=>{if(!x)return{totalKillsData:[],averageKillsData:[],highlightedPlayerAddedToTotal:!1,highlightedPlayerAddedToAverage:!1,gamesWithKillers:0,totalEligibleForAverage:0};const a=x.killerStats.sort((i,s)=>s.kills-i.kills).slice(0,15),u=c.highlightedPlayer&&a.some(i=>i.killerName===c.highlightedPlayer),d=a.map(i=>{const s={name:i.killerName,value:i.kills,victims:i.victims.length,percentage:i.percentage,gamesPlayed:i.gamesPlayed,averageKillsPerGame:i.averageKillsPerGame,isHighlightedAddition:!1};return v.forEach(f=>{s[f]=i.killsByDeathType[f]||0}),s});let y=!1;if(c.highlightedPlayer&&!u){const i=x.killerStats.find(s=>s.killerName===c.highlightedPlayer);if(i){const s={name:i.killerName,value:i.kills,victims:i.victims.length,percentage:i.percentage,gamesPlayed:i.gamesPlayed,averageKillsPerGame:i.averageKillsPerGame,isHighlightedAddition:!0};v.forEach(f=>{s[f]=i.killsByDeathType[f]||0}),d.push(s),y=!0}}const D=x.killerStats.filter(i=>i.gamesPlayed>=n),A=D.sort((i,s)=>s.averageKillsPerGame-i.averageKillsPerGame).slice(0,15),B=c.highlightedPlayer&&A.some(i=>i.killerName===c.highlightedPlayer),T=A.map(i=>{const s={name:i.killerName,value:i.averageKillsPerGame,victims:i.victims.length,percentage:i.percentage,gamesPlayed:i.gamesPlayed,averageKillsPerGame:i.averageKillsPerGame,isHighlightedAddition:!1};return v.forEach(f=>{const M=i.killsByDeathType[f]||0;s[f]=i.gamesPlayed>0?M/i.gamesPlayed:0}),s});let b=!1;if(c.highlightedPlayer&&!B){const i=x.killerStats.find(s=>s.killerName===c.highlightedPlayer);if(i){const s={name:i.killerName,value:i.averageKillsPerGame,victims:i.victims.length,percentage:i.percentage,gamesPlayed:i.gamesPlayed,averageKillsPerGame:i.averageKillsPerGame,isHighlightedAddition:!0};v.forEach(f=>{const M=i.killsByDeathType[f]||0;s[f]=i.gamesPlayed>0?M/i.gamesPlayed:0}),T.push(s),b=!0}}return{totalKillsData:d,averageKillsData:T,highlightedPlayerAddedToTotal:y,highlightedPlayerAddedToAverage:b,gamesWithKillers:x.totalGames,totalEligibleForAverage:D.length}},[x,c.highlightedPlayer,n,v]);if(k)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de mort..."});if(G)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",G]});if(!x)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de mort disponible"});const r=({active:a,payload:u,label:d})=>{if(a&&u&&u.length){const y=u[0].payload,D=y.isHighlightedAddition,A=c.highlightedPlayer===y.name,B=v.reduce((T,b)=>T+(y[b]||0),0);return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:A?"var(--accent-primary)":"var(--text-primary)"},children:[d,D&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (🎯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Victimes totales:"})," ",B]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouées:"})," ",y.gamesPlayed]}),e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"Répartition par type de mort:"}),v.map(T=>{const b=y[T]||0;return b===0?null:e.jsxs("p",{style:{color:S[T],margin:"2px 0",fontSize:"0.8rem"},children:[e.jsx("span",{style:{display:"inline-block",width:"12px",height:"12px",backgroundColor:S[T],marginRight:"6px",verticalAlign:"middle"}}),e.jsxs("strong",{children:[T,":"]})," ",b]},T)})]}),D&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection personnelle"}),A&&!D&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null},p=({active:a,payload:u,label:d})=>{if(a&&u&&u.length){const y=u[0].payload,D=y.isHighlightedAddition,A=c.highlightedPlayer===y.name,B=y.gamesPlayed>=n,T=x?.killerStats.find(s=>s.killerName===y.name),b=v.reduce((s,f)=>s+(y[f]||0),0),i=T?T.kills:Math.round(b*y.gamesPlayed);return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:A?"var(--accent-primary)":"var(--text-primary)"},children:[d,D&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (🎯)"})]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Moyenne par partie:"})," ",b.toFixed(2)," (",i," kills /",y.gamesPlayed," games)"]}),e.jsxs("p",{style:{color:"var(--text-primary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouées:"})," ",y.gamesPlayed]}),e.jsxs("div",{style:{margin:"8px 0",borderTop:"1px solid var(--border-color)",paddingTop:"8px"},children:[e.jsx("p",{style:{fontWeight:"bold",fontSize:"0.85rem",marginBottom:"4px"},children:"Répartition par type de mort (moyenne):"}),v.map(s=>{const f=y[s]||0;if(f===0)return null;const M=T?T.killsByDeathType[s]||0:Math.round(f*y.gamesPlayed);return e.jsxs("p",{style:{color:S[s],margin:"2px 0",fontSize:"0.8rem"},children:[e.jsx("span",{style:{display:"inline-block",width:"12px",height:"12px",backgroundColor:S[s],marginRight:"6px",verticalAlign:"middle"}}),e.jsxs("strong",{children:[s,":"]})," ",f.toFixed(2)," (",M," kills /",y.gamesPlayed," games)"]},s)})]}),D&&!B&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["🎯 Affiché via sélection (< ",n," parties)"]}),D&&B&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection (hors top 15)"}),A&&!D&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null};return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques de Tueurs"}),e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp du tueur :"}),e.jsxs("select",{id:"camp-select",value:o,onChange:a=>F(a.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),N?.map(a=>e.jsx("option",{value:a,children:a},a))]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total des morts"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)"},children:x.totalDeaths})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Tueurs identifiés"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-1)"},children:x.killerStats.length})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Nombre de parties enregistrées"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary)"},children:I})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Top Tueurs (Total)"}),L&&c.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['🎯 "',c.highlightedPlayer,'" affiché en plus du top 15']})]}),e.jsx(H,{title:"Top Tueurs (Total)",children:e.jsx("div",{style:{height:440},children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(w,{data:E,margin:{top:60,right:30,left:20,bottom:10},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:a,y:u,payload:d})=>e.jsx("text",{x:a,y:u,dy:16,textAnchor:"end",fill:c.highlightedPlayer===d.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:c.highlightedPlayer===d.value?14:13,fontWeight:c.highlightedPlayer===d.value?"bold":"italic",transform:`rotate(-45 ${a} ${u})`,children:d.value})}),e.jsx(J,{label:{value:"Nombre total de victimes",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(U,{content:e.jsx(r,{})}),v.map(a=>e.jsx(O,{dataKey:a,name:a,stackId:"kills",fill:S[a],onClick:u=>{const d={selectedPlayer:u?.name,fromComponent:"Statistiques de Mort"};o!=="Tous les camps"&&(d.campFilter={selectedCamp:o,campFilterMode:"all-assignments"}),h(d)}},a))]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,E.filter(a=>!a.isHighlightedAddition).length)," des tueurs les plus actifs (total)"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Top Tueurs (Moyenne par Partie)"}),R&&c.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['🎯 "',c.highlightedPlayer,'" affiché en plus du top 15']})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"min-games-average-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-average-select",value:n,onChange:a=>j(Number(a.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:te.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsx(H,{title:"Top Tueurs (Moyenne par Partie)",children:e.jsx("div",{style:{height:400},children:e.jsx($,{width:"100%",height:"100%",children:e.jsxs(w,{data:C,margin:{top:20,right:30,left:20,bottom:10},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:a,y:u,payload:d})=>e.jsx("text",{x:a,y:u,dy:16,textAnchor:"end",fill:c.highlightedPlayer===d.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:c.highlightedPlayer===d.value?14:13,fontWeight:c.highlightedPlayer===d.value?"bold":"italic",transform:`rotate(-45 ${a} ${u})`,children:d.value})}),e.jsx(J,{label:{value:"Moyenne de victimes par partie",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(U,{content:e.jsx(p,{})}),v.map(a=>e.jsx(O,{dataKey:a,name:a,stackId:"averageKills",fill:S[a],onClick:u=>{const d={selectedPlayer:u?.name,fromComponent:"Statistiques de Mort"};o!=="Tous les camps"&&(d.campFilter={selectedCamp:o,campFilterMode:"all-assignments"}),h(d)}},a))]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(15,C.filter(a=>!a.isHighlightedAddition).length)," des tueurs les plus efficaces (sur ",t," ayant au moins ",n," partie",n>1?"s":"",")"]})]})]}),e.jsx("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note : "}),"Les morts lors de votes aux conseils ne sont pas comptabilisées ici. ","Données en cours de récupération (données partielles)."]})})]})}export{ue as DeathStatisticsChart};
