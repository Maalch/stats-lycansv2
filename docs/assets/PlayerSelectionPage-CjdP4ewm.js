import{a as ce,r as T,g as Z,f as Ne,u as Q,j as e,d as ve,e as De,o as Ae}from"./index-B4jUaExG.js";import{u as ne}from"./useJoueursData-BBApGWUi.js";import{u as de}from"./baseStatsHook-BLchCDrC.js";import{g as Te}from"./gameUtils-DYpUb-C5.js";import{a as je,g as ie,c as be,b as Me}from"./datasyncExport-CjB7UYqV.js";import{u as ue,g as Fe,a as se,l as Ce,d as pe}from"./api-BywLmfzr.js";import{f as te,d as ze}from"./durationFormatters-C9UyWcKX.js";import{F as B,C as K,X as O,Y as H,a as U}from"./FullscreenChart-BbdjvMEy.js";import{R as G,T as V}from"./CategoricalChart-DN7z63NG.js";import{L as $e,a as Ie}from"./LineChart-BLXlUKw5.js";import{B as J,a as _}from"./BarChart-CUHwG6K3.js";import{P as we,a as Se}from"./PieChart-5pV_cN_H.js";import{u as We}from"./useDeathStatisticsFromRaw-B4v62P4O.js";import{R as me}from"./ReferenceLine-DDONYGeH.js";import{g as re}from"./deathTypes-gHH1w6_X.js";import{i as he,g as ge,V as Le,a as qe}from"./roleUtils-CLjkiQQc.js";import{f as xe,a as Ee,b as Ge,d as Ve,S as Be,R as Ke,e as Oe}from"./deathLocationUtils-BRah3gOl.js";import{L as He}from"./Legend-D5LLBmRr.js";import{a as _e,u as Ue}from"./useClips-DSkGw9P1.js";import{C as Ye,f as fe,a as Je}from"./ClipViewer-D3Eq8Snp.js";import"./ActivePoints-BHqvaIil.js";import"./PolarChart-BH3hafcc.js";function Xe(r){const{settings:p}=ce(),{joueursData:S}=ne(),[b,w]=T.useState(null),[m,R]=T.useState(!1),[f,d]=T.useState(null);T.useEffect(()=>{let l=!0;return(async()=>{try{R(!0),d(null);const o=p.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",a=await fetch(o);if(!a.ok)throw new Error(`Failed to load achievements: ${a.status} ${a.statusText}`);const n=await a.json();l&&w(n)}catch(o){l&&d(o instanceof Error?o.message:"Failed to load achievements")}finally{l&&R(!1)}})(),()=>{l=!1}},[p.dataSource]);const g=(()=>{if(!r||!b)return null;const s=S?.Players?.find(o=>o.Joueur===r)?.SteamID;return s&&b.achievements[s]||null})();return T.useEffect(()=>{r&&b&&S&&S.Players?.find(o=>o.Joueur===r)?.SteamID},[r,b,S,p.dataSource]),{data:g,isLoading:m,error:f,metadata:{generatedAt:b?.generatedAt||null,totalPlayers:b?.totalPlayers||0,totalGames:b?.totalGames||0,totalModdedGames:b?.totalModdedGames||0}}}function Ze(r,p,S){if(!r||r.trim()===""||p.length===0)return null;const b=[];let w=r;p.forEach(s=>{const o=s.PlayerStats.find(a=>Z(a)===r||a.Username.toLowerCase()===r.toLowerCase());if(o){w=o.Username;const a=o.MainRoleInitial==="Louveteau"?o.MainRoleInitial:je(o.MainRoleInitial,o.MainRoleChanges||[]),n=ie(a);if(S&&S!=="Tous les camps"&&n!==S)return;const y=Te(s),i=o.Victorious,x=Ne(new Date(s.StartDate)),F=be(s.StartDate,s.EndDate)||0;b.push({gameId:s.Id,date:x,camp:n,won:i,winnerCamp:y,playersInGame:s.PlayerStats.length,mapName:s.MapName,duration:F})}}),b.sort((s,o)=>{const a=n=>{const y=n.split("/");return y.length===3?new Date(parseInt(y[2]),parseInt(y[1])-1,parseInt(y[0])):new Date(n)};return a(o.date).getTime()-a(s.date).getTime()});const m=b.length,R=b.filter(s=>s.won).length,f=m>0?(R/m*100).toFixed(2):"0.00",d={};b.forEach(s=>{d[s.camp]||(d[s.camp]={appearances:0,wins:0,winRate:"0.00"}),d[s.camp].appearances++,s.won&&d[s.camp].wins++}),Object.keys(d).forEach(s=>{const o=d[s];o.winRate=o.appearances>0?(o.wins/o.appearances*100).toFixed(2):"0.00"});const g={};b.forEach(s=>{g[s.mapName]||(g[s.mapName]={appearances:0,wins:0,winRate:"0.00"}),g[s.mapName].appearances++,s.won&&g[s.mapName].wins++}),Object.keys(g).forEach(s=>{const o=g[s];o.winRate=o.appearances>0?(o.wins/o.appearances*100).toFixed(2):"0.00"});const l=b.reduce((s,o)=>s+o.duration,0);return{playerName:w,totalGames:m,totalWins:R,winRate:f,totalPlayTime:l,games:b,campStats:d,mapStats:g}}function Qe(r){const p={};let S=0,b=0;return Object.entries(r).forEach(([w,m])=>{w==="Village"||w==="ChÃ¢teau"?p[w]={...m}:(S+=m.appearances,b+=m.wins)}),S>=10&&(p.Autres={appearances:S,wins:b,winRate:S>0?(b/S*100).toFixed(2):"0.00"}),p}function oe(r,p){const{data:S,isLoading:b,error:w}=de(m=>r?Ze(r,m,p):null);return{data:S,isLoading:b,error:w}}function et({achievements:r,title:p,emptyMessage:S,achievementType:b="all"}){const{navigateToTab:w,updateNavigationState:m,clearNavigation:R}=Q(),{settings:f,updateSettings:d}=ce(),{joueursData:g}=ne(),l=ue(g),s=(t,P)=>{if(P.stopPropagation(),!t.redirectTo)return;R();const M=f.highlightedPlayer;if(d(b==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:M,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:M,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const h=f.highlightedPlayer||"",c=o(t.description,h);c&&m({playerComparisonState:{selectedPlayer1:h,selectedPlayer2:c,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const h=t.description.toLowerCase().includes("loup");m({selectedPairingTab:h?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const h=t.description.match(/(Villageois|Loups|Autres)/i);h&&m({deathStatsSelectedCamp:h[1]});let c=10;const u=t.description.match(/min\.\s*(\d+)/);u&&(c=parseInt(u[1],10));let D="totalKills",N="killers";const A=t.redirectTo.chartSection;A&&(A==="killers-total"?(D="totalKills",N="killers"):A==="killers-average"?(D="averageKills",N="killers"):A==="deaths-total"?(D="totalDeaths",N="deaths"):A==="survivors-average"?(D="survivalRate",N="deaths"):(A==="hunters-good"||A==="hunters-bad")&&(N="hunter",D="averageKills")),m({deathStatisticsState:{selectedCamp:h?.[1]||"Tous les camps",minGamesForAverage:c,selectedView:N,focusChart:D}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const h=t.redirectTo.mapFilter||"all";let c=10;const u=t.description.match(/min\.\s*(\d+)/);u&&(c=parseInt(u[1])),d(b==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:h,playerFilter:{mode:"none",players:[]},highlightedPlayer:M,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:h,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:h,playerFilter:{mode:"none",players:[]},highlightedPlayer:M,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:h,playerFilter:{mode:"none",players:[]}}}),m({playersGeneralState:{minGamesForWinRate:c,winRateOrder:"best",focusChart:"winRate"}}),w("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&m({selectedPlayerName:f.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let h="wins";const c=t.title.toLowerCase(),u=t.description.toLowerCase();c.includes("dÃ©faite")||u.includes("dÃ©faite")?h="losses":c.includes("loup")||u.includes("loup")?h="loup":c.includes("villageois")||u.includes("villageois")?h="villageois":(c.includes("victoire")||u.includes("victoire"))&&(h="wins"),m({selectedSeriesType:h})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let h=10;const c=t.description.match(/min\.\s*(\d+)/);c&&(h=parseInt(c[1],10));let u="winRate",D="best";const N=t.title.toLowerCase(),A=t.description.toLowerCase();N.includes("participation")||A.includes("participation")?u="participation":(N.includes("taux de victoire")||A.includes("taux de victoire"))&&(u="winRate",(N.includes("moins bon")||N.includes("mauvais")||A.includes("moins bon")||A.includes("mauvais"))&&(D="worst")),m({playersGeneralState:{minGamesForWinRate:h,winRateOrder:D,focusChart:u}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const h=t.redirectTo.chartSection;let c="Villageois",u=1;h&&(h==="camp-loup"?c="Loup":h==="camp-villageois"?c="Villageois":h==="camp-idiot"?c="Idiot du Village":h==="camp-amoureux"?c="Amoureux":(h==="solo-roles"||h==="hall-of-fame")&&(c="Villageois"));const D=t.description.match(/min\.\s*(\d+)/);D&&(u=parseInt(D[1],10)),h==="solo-roles"?c="RÃ´les spÃ©ciaux":h==="hall-of-fame"&&(c="Tous les camps"),m({campPerformanceState:{selectedCampPerformanceCamp:c,selectedCampPerformanceMinGames:u,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const h=t.title.toLowerCase();let c="overview",u="behavior";h.includes("agressivitÃ©")?(c="overview",u="behavior"):h.includes("taux de vote")?(c="behavior",u="voteRate"):h.includes("prÃ©cision")&&(c="overview",u="accuracy"),m({votingStatsState:{selectedCategory:c,selectedView:u}})}if(t.category==="loot"&&t.redirectTo.subTab==="lootStats"){const h=t.redirectTo,c=h.minGames||5,u=h.view||"normalized";m({lootStatsState:{minGames:c,campFilter:"all",view:u}})}w(t.redirectTo.tab,t.redirectTo.subTab)},o=(t,P)=>{const M=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const h of M){const c=t.match(h);if(c&&c[1]){const u=c[1].trim();if(u!==P)return u}}return null},a=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const h=t.description.match(/min\.\s*(\d+)/),c=h?parseInt(h[1],10):10,u=t.title.toLowerCase(),D=b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return u.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${c} parties)${D}`:u.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${D}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${D}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const h=t.redirectTo.mapFilter,c=h==="village"?"Village":h==="chateau"?"ChÃ¢teau":"map",u=b==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${c}${u}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${o(t.description,f.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const h=t.description.match(/(Villageois|Loups|Autres)/i),c=t.description.match(/min\.\s*(\d+)/),u=c?parseInt(c[1],10):10,D=h?.[1]||"Tous les camps",N=t.redirectTo.chartSection;let A="kills et morts";return N==="killers-total"?A="total des kills":N==="killers-average"?A=`moyenne des kills (min. ${u} parties)`:N==="deaths-total"?A="total des morts":N==="survivors-average"&&(A=`taux de survie (min. ${u} parties)`),`Cliquez pour voir les statistiques de ${A} ${D!=="Tous les camps"?`en ${D}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const h=t.title.toLowerCase(),c=t.description.toLowerCase();return h.includes("dÃ©faite")||c.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":h.includes("loup")||c.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":h.includes("villageois")||c.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":h.includes("victoire")||c.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const h=t.redirectTo.chartSection,c=b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return h==="camp-loup"?`Cliquez pour voir les performances camp Loup${c}`:h==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${c}`:h==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${c}`:h==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${c}`:h==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${c}`:h==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${c}`:`Cliquez pour voir les performances par camp${c}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const h=t.description.match(/min\.\s*(\d+)/),c=h?parseInt(h[1],10):25,u=b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",D=t.title.toLowerCase();return D.includes("agressivitÃ©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${c} meetings)${u}`:D.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${c} meetings)${u}`:D.includes("prÃ©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${u}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${u}`}break;case"loot":if(t.redirectTo.subTab==="lootStats"){const h=t.description.match(/min\.\s*(\d+)/),c=h?parseInt(h[1],10):25,u=b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de rÃ©colte (min. ${c} parties)${u}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},n=t=>l[t]||Fe(t),y=t=>{const P=[/avec ([^:]+?):/,/contre ([^:]+?):/];let M=t;return P.forEach(h=>{const c=t.match(h);if(c&&c[1]){const u=c[1].trim(),N=`<span class="player-name-highlight" style="color: ${n(u)};">${u}</span>`;M=M.replace(u,N)}}),M};if(r.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:p}),e.jsx("p",{children:S||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const i=t=>t===1?"ðŸ¥‡":t===2?"ðŸ¥ˆ":t===3?"ðŸ¥‰":"",x=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",F=(t,P)=>{if(!t||t<=3||!P)return;const M=t-3,h=P-3;return h<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(M-1)/(h-1))}, 70%, 50%)`},$=(t,P)=>{if(!t||!P)return;if(P<=1)return"hsl(0, 70%, 50%)";const M=(t-1)/(P-1),h=M*15,c=50-M*15;return`hsl(${h}, 70%, ${c}%)`},W=t=>{if(!t)return;const P=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(P){const[,M,h]=P;return`hsl(${M}, ${h}%, 40%)`}return t},L=r.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,P)=>(t.rank??999)-(P.rank??999)),v=r.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,P)=>(t.rank??999)-(P.rank??999)),C=r.filter(t=>t.category==="comparison"),z=[...L,...v].sort((t,P)=>(t.rank??999)-(P.rank??999)),k=L.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:p}),k>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:L.filter(t=>t.rank&&t.rank<=3).map((t,P)=>e.jsxs("div",{className:`top3-card ${x(t.rank)} animate-slide-in`,style:{animationDelay:`${P*.15}s`},onClick:M=>s(t,M),title:a(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:i(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:t.title}),e.jsx("p",{className:"top3-achievement-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},t.id))})]}),z.length>0&&e.jsxs("div",{className:"achievements-section unified-rankings",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:z.filter(t=>t.type==="bad"?!0:!t.rank||t.rank>3).map((t,P)=>{const M=t.type==="bad",h=M?$(t.rank,t.totalRanked):F(t.rank,t.totalRanked),c=W(h),u=M?"":x(t.rank);return e.jsxs("div",{className:`achievement-card ${M?"bad":"good"} ${u}`,onClick:D=>s(t,D),title:a(t),style:{animationDelay:`${P*.05}s`,borderLeftColor:c,borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsxs("span",{className:"achievement-title",children:[M&&"ðŸ’€ ",t.title]}),e.jsxs("span",{className:"achievement-rank",style:h?{backgroundColor:h}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:t.description})]},t.id)})})]}),C.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques CoÃ©quipiers et Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:C.map(t=>e.jsxs("div",{className:"achievement-card comparison",onClick:P=>s(t,P),title:a(t),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:t.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:y(t.description)}})]},t.id))})]})]})}function tt({selectedPlayerName:r,groupingMethod:p,campFilter:S="all"}){const{navigateToGameDetails:b}=Q(),{data:w,isLoading:m,error:R}=oe(r),f=T.useMemo(()=>{switch(p){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[p]),d=T.useMemo(()=>{if(!w?.games)return new Map;const o=new Map;return w.games.forEach(a=>{if(!o.has(a.date)){const n=a.date.split("/");n.length===3?o.set(a.date,new Date(parseInt(n[2]),parseInt(n[1])-1,parseInt(n[0])).getTime()):o.set(a.date,new Date(a.date).getTime())}}),o},[w?.games]),g=T.useMemo(()=>{if(!w?.games)return[];const o={};return w.games.forEach(a=>{if(S!=="all"){if(S==="solo"){if(a.camp==="Villageois"||a.camp==="Loup")return}else if(a.camp!==S)return}let n;const y=a.date.split("/");if(p==="month")if(y.length===3)n=`${y[1].padStart(2,"0")}/${y[2]}`;else{const i=new Date(a.date);n=`${String(i.getMonth()+1).padStart(2,"0")}/${i.getFullYear()}`}else if(p==="quarter")if(y.length===3){const i=parseInt(y[1],10);n=`T${Math.floor((i-1)/3)+1}/${y[2]}`}else{const i=new Date(a.date);n=`T${Math.floor(i.getMonth()/3)+1}/${i.getFullYear()}`}else p==="year"?y.length===3?n=`${y[2]}`:n=`${new Date(a.date).getFullYear()}`:n=a.date;o[n]||(o[n]={games:[],wins:0,total:0}),o[n].games.push(a),o[n].total++,a.won&&o[n].wins++}),Object.entries(o).map(([a,n])=>({period:a,totalGames:n.total,victories:n.wins,defeats:n.total-n.wins,winRate:n.total>0?(n.wins/n.total*100).toFixed(1):"0.0",winRateNum:n.total>0?n.wins/n.total*100:0})).sort((a,n)=>{if(p==="month"){const[y,i]=a.period.split("/"),[x,F]=n.period.split("/"),$=new Date(parseInt(i),parseInt(y)-1,1),W=new Date(parseInt(F),parseInt(x)-1,1);return $.getTime()-W.getTime()}else if(p==="quarter"){const[y,i]=a.period.split("/"),[x,F]=n.period.split("/"),$=parseInt(y.replace(/\D/g,""),10)||1,W=parseInt(x.replace(/\D/g,""),10)||1,L=new Date(parseInt(i,10),($-1)*3,1),v=new Date(parseInt(F,10),(W-1)*3,1);return L.getTime()-v.getTime()}else if(p==="year"){const y=parseInt(a.period,10),i=parseInt(n.period,10);return y-i}else{const y=d.get(a.period)||0,i=d.get(n.period)||0;return y-i}})},[w,p,d,S]),s=(o=>o<=15?{fontSize:12,angle:-45,height:80,interval:0}:o<=30?{fontSize:12,angle:-45,height:85,interval:1}:o<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(o/12)})(g.length);return m?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):R?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",R]}):w?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",f]}),e.jsx(B,{title:`Ã‰volution des Performances ${f}`,children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs($e,{data:g,margin:{top:20,right:30,left:20,bottom:20},onClick:o=>{if(o&&o.activeLabel){const a=g.find(n=>n.period===o.activeLabel);a&&b({selectedPlayer:r,selectedDate:a.period,fromComponent:`Ã‰volution des Performances ${f}`})}},style:{cursor:"pointer"},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"period",angle:s.angle,textAnchor:"end",height:s.height,interval:s.interval,fontSize:s.fontSize}),e.jsx(H,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(V,{content:({active:o,payload:a})=>{if(o&&a&&a.length>0){const n=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.period})}),e.jsxs("div",{children:["Parties: ",n.totalGames]}),e.jsxs("div",{children:["Victoires: ",n.victories]}),e.jsxs("div",{children:["Taux: ",n.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Ie,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",f]}),e.jsx(B,{title:`RÃ©partition Victoires/DÃ©faites ${f}`,children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:g,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"period",angle:s.angle,textAnchor:"end",height:s.height,interval:s.interval,fontSize:s.fontSize}),e.jsx(H,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(V,{content:({active:o,payload:a})=>{if(o&&a&&a.length>0){const n=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.period})}),e.jsxs("div",{children:["Total: ",n.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",n.victories]}),e.jsxs("div",{children:["DÃ©faites: ",n.defeats]}),e.jsxs("div",{children:["Taux: ",n.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(_,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:g.map((o,a)=>e.jsx(U,{fill:"var(--accent-tertiary)",onClick:()=>{b({selectedPlayer:r,selectedDate:o.period,fromComponent:`Historique Joueur - Victoires ${f}`})},style:{cursor:"pointer"}},`cell-victories-${a}`))}),e.jsx(_,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:g.map((o,a)=>e.jsx(U,{fill:"var(--chart-color-4)",onClick:()=>{b({selectedPlayer:r,selectedDate:o.period,fromComponent:`Historique Joueur - DÃ©faites ${f}`})},style:{cursor:"pointer"}},`cell-defeats-${a}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function at({selectedPlayerName:r}){const{navigateToGameDetails:p}=Q(),{data:S,isLoading:b,error:w}=oe(r),m=se(),R=T.useMemo(()=>S?.campStats?Object.entries(S.campStats).map(([d,g])=>({name:d,value:g.appearances,winRate:g.winRate,winRateDisplay:Math.max(parseFloat(g.winRate),1),wins:g.wins,percentage:(g.appearances/S.totalGames*100).toFixed(1)})):[],[S]),f=T.useMemo(()=>{if(!R.length)return[];const d=5;let g=0;const l=[],s=[];if(R.forEach(o=>{parseFloat(o.percentage)<d?(g+=Number(o.value),l.push(o)):s.push(o)}),g>0){const o=R.reduce((a,n)=>a+Number(n.value),0);s.push({name:"Autres",value:g,winRate:"0.0",winRateDisplay:1,wins:l.reduce((a,n)=>a+n.wins,0),percentage:(g/o*100).toFixed(1),_details:l})}return s},[R]);return b?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):w?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",w]}):S?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(we,{children:[e.jsx(Se,{data:f,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:d=>{const g=d.percent!==void 0?d.percent:0;return d.name==="Autres"?`Autres : ${d.value} (${(g*100).toFixed(1)}%)`:`${d.name}: ${d.value} (${(g*100).toFixed(1)}%)`},children:f.map((d,g)=>e.jsx(U,{fill:d.name==="Autres"?Ce:m[d.name]||`var(--chart-color-${g%6+1})`,onClick:()=>{if(d.name==="Autres"){const l=d._details?.map(s=>s.name)||[];p({selectedPlayer:r,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:l},fromComponent:"Distribution par Camps"})}else d.name==="TraÃ®tre"||d.name==="Louveteau"?p({selectedPlayer:r,campFilter:{selectedCamp:d.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):d.name==="Loup"?p({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):p({selectedPlayer:r,campFilter:{selectedCamp:d.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${g}`))}),e.jsx(V,{content:({active:d,payload:g})=>{if(d&&g&&g.length>0){const l=g[0].payload;if(l.name==="Autres"&&l._details){const s=[...l._details].sort((o,a)=>a.value-o.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",l.value," parties (",l.percentage,"%)"]})}),e.jsx("div",{children:s.map((o,a)=>e.jsxs("div",{children:[o.name,": ",o.value," parties (",o.percentage,"%)"]},a))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[l.name," - ",l.value," parties (",l.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(B,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:R,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(V,{content:({active:d,payload:g})=>{if(d&&g&&g.length>0){const l=g[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:l.name})}),e.jsxs("div",{children:["Victoires: ",l.wins," / ",l.value]}),e.jsxs("div",{children:["Taux: ",l.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(_,{dataKey:"winRateDisplay",children:R.map((d,g)=>e.jsx(U,{fill:parseFloat(d.winRate)===0?`${m[d.name]||`var(--chart-color-${g%6+1})`}50`:m[d.name]||`var(--chart-color-${g%6+1})`,onClick:()=>{d.name==="TraÃ®tre"||d.name==="Louveteau"?p({selectedPlayer:r,campFilter:{selectedCamp:d.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):d.name==="Loup"?p({selectedPlayer:r,campFilter:{selectedCamp:d.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):p({selectedPlayer:r,campFilter:{selectedCamp:d.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${g}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function st({selectedPlayerName:r}){const{navigateToGameDetails:p,navigationState:S,updateNavigationState:b}=Q(),[w,m]=T.useState(S.playerHistoryMapState?.selectedCamp||"Tous les camps"),{data:R}=We(),{data:f,isLoading:d,error:g}=oe(r,w);T.useEffect(()=>{(!S.playerHistoryMapState||S.playerHistoryMapState.selectedCamp!==w)&&b({playerHistoryMapState:{selectedCamp:w}})},[w,S.playerHistoryMapState,b]);const l=o=>{m(o),b({playerHistoryMapState:{selectedCamp:o}})},s=T.useMemo(()=>{if(!f?.mapStats)return[];const o=Qe(f.mapStats);return Object.entries(o).map(([a,n])=>({name:a,value:n.appearances,winRate:n.winRate,winRateDisplay:Math.max(parseFloat(n.winRate),.1),wins:n.wins,percentage:(n.appearances/f.totalGames*100).toFixed(1)}))},[f]);return d?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):g?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]}):f?e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Performance par Carte",w!=="Tous les camps"?` (${w})`:""]}),e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select-map",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select-map",value:w,onChange:o=>l(o.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),R?.map(o=>e.jsx("option",{value:o,children:o},o))]})]}),s.length===0?e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de carte disponible"}),e.jsx("p",{children:"Aucune statistique de carte n'est disponible pour ce joueur avec le camp sÃ©lectionnÃ©."})]}):e.jsx(B,{title:"Performance par Carte",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:s,margin:{top:20,right:140,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(me,{y:50,stroke:"var(--text-secondary)",strokeDasharray:"5 5",strokeOpacity:.5}),(()=>{if(s.length>0){const o=s.reduce((y,i)=>y+i.value,0),a=s.reduce((y,i)=>y+i.wins,0),n=o>0?a/o*100:0;if(n!==50)return e.jsx(me,{y:n,stroke:"var(--accent-primary)",strokeDasharray:"3 3",strokeOpacity:.7,label:{value:`Moyenne: ${n.toFixed(1)}%`,position:"right",offset:5,style:{fill:"var(--accent-primary)"}}})}return null})(),e.jsx(V,{content:({active:o,payload:a})=>{if(o&&a&&a.length>0){const n=a[0].payload,y=[];return s.forEach(i=>{if(i.name!==n.name&&i.value>=5){const x=parseFloat(n.winRate)-parseFloat(i.winRate);Math.abs(x)>=2&&y.push({map:i.name,diff:x,better:x>0})}}),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:"250px"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.name})}),e.jsxs("div",{children:["Parties: ",n.value]}),e.jsxs("div",{children:["Victoires: ",n.wins]}),e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("strong",{children:["Taux: ",n.winRate,"%"]})}),y.length>0&&e.jsxs("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"0.8rem",fontWeight:"bold",marginBottom:"0.25rem"},children:"Comparaisons:"}),y.map((i,x)=>e.jsxs("div",{style:{fontSize:"0.75rem",color:i.better?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[i.better?"â†—":"â†˜"," ",Math.abs(i.diff).toFixed(1),"% vs ",i.map]},x))]}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(_,{dataKey:"winRateDisplay",label:o=>{const{x:a,y:n,width:y,payload:i}=o;if(a===void 0||n===void 0||y===void 0||!i)return null;const x=i.winRate||"0";return e.jsxs("text",{x:a+y/2,y:n-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[x,"%"]})},onClick:o=>{if(o&&o.name){const a={selectedPlayer:r,selectedMapName:o.name,fromComponent:"Performance par Carte"};w!=="Tous les camps"&&(a.campFilter={selectedCamp:w,campFilterMode:"all-assignments"}),p(a)}},children:s.map((o,a)=>{let n;o.name==="Village"?n="var(--accent-secondary)":o.name==="ChÃ¢teau"?n="var(--accent-tertiary)":o.name==="Autres"?n=Ce:n=`var(--chart-color-${a%6+1})`;const y=Math.max(...s.map(x=>parseFloat(x.winRate))),i=parseFloat(o.winRate)===y&&y>0;return e.jsx(U,{fill:parseFloat(o.winRate)===0?`${n}30`:n,stroke:"transparent",strokeWidth:i?3:1,style:{cursor:"pointer"}},`cell-map-${a}`)})})]})})})})]})}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function rt({selectedPlayerName:r}){const{gameData:p}=ve(),{joueursData:S}=ne(),b=ue(S),w=se(),m=T.useMemo(()=>{if(!p||!r)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const f={},d={},g={},l=new Set;p.forEach(y=>{const i=y.PlayerStats.find(x=>x.Username.toLowerCase()===r.toLowerCase());if(i&&(y.PlayerStats.forEach(x=>{x.KillerName?.toLowerCase()===r.toLowerCase()&&(f[x.Username]=(f[x.Username]||0)+1)}),i.KillerName&&(d[i.KillerName]=(d[i.KillerName]||0)+1),i.DeathType)){const x=i.DeathType,F=re(x);g[F]||(g[F]={count:0,byDeathType:{}}),g[F].count+=1,g[F].byDeathType[x]=(g[F].byDeathType[x]||0)+1,l.add(x)}});const s=Object.entries(f).map(([y,i])=>({player:y,kills:i})).sort((y,i)=>i.kills-y.kills).slice(0,10),o=Object.entries(d).map(([y,i])=>({player:y,kills:i})).sort((y,i)=>i.kills-y.kills).slice(0,10),a=Object.entries(g).map(([y,i])=>{const x={deathType:y,count:i.count};return x[y]=i.count,x}).sort((y,i)=>i.count-y.count).slice(0,10),n=Object.keys(g);return{playersKilled:s,killedBy:o,deathTypes:a,availableDeathTypes:n}},[p,r]),R=T.useMemo(()=>{const f={};m.availableDeathTypes.forEach(l=>{l==="TuÃ© par Loup"?f[l]=w.Loup:l==="Mort aux votes"?f[l]="var(--chart-color-1)":l.includes("Chasseur")?f[l]=w.Chasseur:l==="TuÃ© par Zombie"?f[l]=w.Vaudou:l==="TuÃ© par potion assassin"?f[l]=w.Alchimiste:l==="TuÃ© par Vengeur"?f[l]="var(--chart-color-2)":l==="Amoureux mort"?f[l]=w.Amoureux:l==="TuÃ© par La BÃªte"?f[l]="var(--chart-color-3)":l==="TuÃ© par ShÃ©rif"&&(f[l]="var(--chart-color-4)")});const d=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let g=0;return m.availableDeathTypes.forEach(l=>{f[l]||(f[l]=d[g%d.length],g++)}),f},[m.availableDeathTypes,w]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[m.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(B,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:m.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(V,{content:({active:f,payload:d})=>{if(f&&d&&d.length>0){const g=d[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:g.player})}),e.jsxs("div",{children:["TuÃ© ",g.kills," fois par ",r]})]})}return null}}),e.jsx(_,{dataKey:"kills",children:m.playersKilled.map((f,d)=>e.jsx(U,{fill:b[f.player]||"var(--chart-color-3)"},`cell-killed-${d}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[r," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),m.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(B,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:m.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(V,{content:({active:f,payload:d})=>{if(f&&d&&d.length>0){const g=d[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:g.player})}),e.jsxs("div",{children:["A tuÃ© ",r," ",g.kills," fois"]})]})}return null}}),e.jsx(_,{dataKey:"kills",children:m.killedBy.map((f,d)=>e.jsx(U,{fill:b[f.player]||"var(--chart-color-4)"},`cell-killer-${d}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[r," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),m.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(B,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:m.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(H,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(V,{content:({active:f,payload:d})=>{if(f&&d&&d.length>0){const g=d[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:g.deathType})}),e.jsxs("div",{children:[r," est mort ",g.count," fois ainsi"]})]})}return null}}),m.availableDeathTypes.map(f=>e.jsx(_,{dataKey:f,name:f,stackId:"deaths",fill:R[f]||"var(--chart-color-5)"},f))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",r,"."]})]})]})}function it(r,p){if(!r||r.trim()===""||p.length===0)return null;const S=new Map,b=new Map,w=new Map;p.forEach(g=>{if(!g.Modded)return;const l=g.PlayerStats.find(s=>Z(s)===r||s.Username.toLowerCase()===r.toLowerCase());if(l){if(l.MainRoleInitial==="Inconnu")return;const s=l.Victorious,a=je(l.MainRoleInitial,l.MainRoleChanges||[])!==l.MainRoleInitial,n=ie(l.MainRoleInitial),y=n==="Loup"||n==="TraÃ®tre"||n==="Louveteau";if(n==="Villageois"&&he(l)){const i=ge(l);if(i&&Le.includes(i)){const x=S.get(i)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};S.set(i,{appearances:x.appearances+1,wins:x.wins+(s?1:0),winsWithoutRoleChange:x.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:x.gamesWithoutRoleChange+(a?0:1)})}}else if(l.Power&&l.Power.trim()!==""&&l.Power!=="Inconnu"){if(n==="Villageois"){const i=S.get(l.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};S.set(l.Power,{appearances:i.appearances+1,wins:i.wins+(s?1:0),winsWithoutRoleChange:i.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:i.gamesWithoutRoleChange+(a?0:1)})}else if(y){const i=b.get(l.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},x=i.roleBreakdown;x.set(l.MainRoleInitial,(x.get(l.MainRoleInitial)||0)+1),b.set(l.Power,{appearances:i.appearances+1,wins:i.wins+(s?1:0),winsWithoutRoleChange:i.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:i.gamesWithoutRoleChange+(a?0:1),roleBreakdown:x})}}else if((n==="Villageois"||y)&&l.Power!=="Inconnu")if(n==="Villageois"){const i=S.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};S.set("Aucun pouvoir",{appearances:i.appearances+1,wins:i.wins+(s?1:0),winsWithoutRoleChange:i.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:i.gamesWithoutRoleChange+(a?0:1)})}else{const i=b.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},x=i.roleBreakdown;x.set(l.MainRoleInitial,(x.get(l.MainRoleInitial)||0)+1),b.set("Aucun pouvoir",{appearances:i.appearances+1,wins:i.wins+(s?1:0),winsWithoutRoleChange:i.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:i.gamesWithoutRoleChange+(a?0:1),roleBreakdown:x})}if(l.SecondaryRole&&l.SecondaryRole.trim()!==""&&l.SecondaryRole!=="Inconnu"){const i=w.get(l.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};w.set(l.SecondaryRole,{appearances:i.appearances+1,wins:i.wins+(s?1:0),winsWithoutRoleChange:i.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:i.gamesWithoutRoleChange+(a?0:1)})}}});const m=new Map;p.forEach(g=>{const l=g.PlayerStats.find(s=>Z(s)===r||s.Username.toLowerCase()===r.toLowerCase());if(l&&he(l)){const s=ge(l);s&&m.set(s,(m.get(s)||0)+1)}});const R=g=>Array.from(g.entries()).map(([l,s])=>({name:l,appearances:s.appearances,wins:s.wins,winsWithoutRoleChange:s.winsWithoutRoleChange,gamesWithoutRoleChange:s.gamesWithoutRoleChange,winRate:s.gamesWithoutRoleChange>0?(s.winsWithoutRoleChange/s.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...m.has(l)&&{totalGamesAllModes:m.get(l)}})).sort((l,s)=>s.appearances-l.appearances),f=g=>Array.from(g.entries()).map(([l,s])=>({name:l,appearances:s.appearances,wins:s.wins,winsWithoutRoleChange:s.winsWithoutRoleChange,gamesWithoutRoleChange:s.gamesWithoutRoleChange,winRate:s.gamesWithoutRoleChange>0?(s.winsWithoutRoleChange/s.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(s.roleBreakdown.entries()).map(([o,a])=>({role:o,count:a})).sort((o,a)=>a.count-o.count)})).sort((l,s)=>s.appearances-l.appearances),d=g=>Array.from(g.entries()).map(([l,s])=>({name:l,appearances:s.appearances,wins:s.wins,winsWithoutRoleChange:s.winsWithoutRoleChange,gamesWithoutRoleChange:s.gamesWithoutRoleChange,winRate:s.gamesWithoutRoleChange>0?(s.winsWithoutRoleChange/s.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((l,s)=>s.appearances-l.appearances);return{villageoisPowers:R(S),loupPowers:f(b),secondaryRoles:d(w)}}function nt({selectedPlayerName:r}){const{navigateToGameDetails:p,navigationState:S,updateNavigationState:b}=Q(),w=se(),[m,R]=T.useState(S.playerHistoryRolesState?.chartMode||"appearances"),{data:f,isLoading:d,error:g}=de(x=>it(r,x));T.useEffect(()=>{(!S.playerHistoryRolesState||S.playerHistoryRolesState.chartMode!==m)&&b({playerHistoryRolesState:{chartMode:m}})},[m,S.playerHistoryRolesState,b]);const l=x=>{R(x),b({playerHistoryRolesState:{chartMode:x}})},s=T.useMemo(()=>{if(!f)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const x=1,F=1,$=15,W=m==="winRate"?(v,C)=>parseFloat(C.winRate)-parseFloat(v.winRate):(v,C)=>C.appearances-v.appearances,L=v=>({...v,winRateDisplay:Math.max(parseFloat(v.winRate),1)});return{villageoisPowers:f.villageoisPowers.filter(v=>v.appearances>=x).map(L).sort(W).slice(0,$),loupPowers:f.loupPowers.filter(v=>v.appearances>=x).map(L).sort(W).slice(0,$),secondaryRoles:f.secondaryRoles.filter(v=>v.appearances>=F).map(L).sort(W).slice(0,$)}},[f,m]);if(d)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(g)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]});if(!f)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const o=s.villageoisPowers.length>0,a=s.loupPowers.length>0,n=s.secondaryRoles.length>0;if(!o&&!a&&!n)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const y=({active:x,payload:F})=>{if(x&&F&&F.length>0){const $=F[0].payload,W=$.gamesWithoutRoleChange<$.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:$.name})}),e.jsxs("div",{children:["Apparitions: ",$.appearances]}),W&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",$.appearances-$.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",$.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",$.winRate,"%"]})}),$.totalGamesAllModes&&$.totalGamesAllModes!==$.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",$.totalGamesAllModes,")"]}),$.roleBreakdown&&$.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),$.roleBreakdown.map((L,v)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",L.role,": ",L.count]},v))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},i=(x,F,$,W,L)=>{const v=m==="appearances"?"appearances":"winRateDisplay",C=m==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",z=m==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:F}),e.jsx(B,{title:F,children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:x,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:C,angle:270,position:"left",style:{textAnchor:"middle"}},domain:z}),e.jsx(V,{content:e.jsx(y,{})}),e.jsx(_,{dataKey:v,label:m==="winRate"?k=>{const{x:t,y:P,width:M,payload:h}=k;if(t===void 0||P===void 0||M===void 0||!h)return null;const c=h.winRate||"0";return e.jsxs("text",{x:t+M/2,y:P-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[c,"%"]})}:void 0,children:x.map((k,t)=>e.jsx(U,{fill:L?L(k.name,t):$,onClick:()=>W(k.name),style:{cursor:"pointer"}},`cell-${t}`))})]})})})})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:m,onChange:x=>l(x.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[o&&i(s.villageoisPowers,"Camp Villageois","var(--chart-color-1)",x=>{p({selectedPlayer:r,campFilter:{selectedCamp:"Villageois",campFilterMode:m==="winRate"?"wins-only":"all-assignments"},selectedPower:x,fromComponent:`Historique des RÃ´les - Pouvoir: ${x}`})},x=>x==="Chasseur"&&w.Chasseur?w.Chasseur:x==="Alchimiste"&&w.Alchimiste?w.Alchimiste:x==="Protecteur"&&w.Protecteur?w.Protecteur:x==="Disciple"&&w.Disciple?w.Disciple:"var(--chart-color-1)"),a&&i(s.loupPowers,"Camp Loups","var(--chart-color-2)",x=>{p({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:m==="winRate"?"wins-only":"all-assignments"},selectedPower:x,fromComponent:`Historique des RÃ´les - Pouvoir: ${x}`})},()=>w.Loup||"var(--chart-color-2)"),n&&i(s.secondaryRoles,"RÃ´les Secondaires","var(--chart-color-3)",x=>{p({selectedPlayer:r,selectedSecondaryRole:x,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${x}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}function ye(r){return r==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":r}function ot({selectedPlayerName:r}){const{navigateToGameDetails:p}=Q(),{gameData:S,isLoading:b,error:w}=ve(),m=se(),[R,f]=T.useState("deaths"),[d,g]=T.useState(""),[l,s]=T.useState(0),o=T.useMemo(()=>{if(!S)return[];const v=new Set;return S.forEach(C=>{const z=C.PlayerStats.find(k=>k.Username.toLowerCase()===r.toLowerCase());z&&(z.DeathPosition!==null&&C.MapName&&v.add(C.MapName),C.PlayerStats.forEach(k=>{k.KillerName?.toLowerCase()===r.toLowerCase()&&k.DeathPosition!==null&&C.MapName&&v.add(C.MapName)}))}),Array.from(v).filter(C=>C==="Village"||C==="ChÃ¢teau").sort((C,z)=>C==="Village"?-1:z==="Village"?1:C.localeCompare(z))},[S,r]),a=o.length>0?o[0]:"";d===""&&a!==""&&g(a);const n=T.useMemo(()=>{if(!S||!r)return[];const v=[];return S.forEach(C=>{if(d&&C.MapName!==d)return;const z=C.PlayerStats.find(k=>k.Username.toLowerCase()===r.toLowerCase());if(z)if(R==="deaths"){if(z.DeathPosition){const k=ie(z.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),t=xe(z.DeathPosition.x,z.DeathPosition.z,C.MapName);v.push({x:t.x,z:t.z,victimName:z.Username,killerName:z.KillerName||null,deathType:ye(z.DeathType),mapName:C.MapName,camp:k,gameId:C.DisplayedId,displayedGameId:C.DisplayedId})}}else C.PlayerStats.forEach(k=>{if(k.KillerName?.toLowerCase()===r.toLowerCase()&&k.DeathPosition){const t=ie(k.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),P=xe(k.DeathPosition.x,k.DeathPosition.z,C.MapName);v.push({x:P.x,z:P.z,victimName:k.Username,killerName:r,deathType:ye(k.DeathType),mapName:C.MapName,camp:t,gameId:C.DisplayedId,displayedGameId:C.DisplayedId})}})}),v},[S,r,R,d]),y=T.useMemo(()=>Ee(n,l).map((C,z)=>{const k=C.items[0],t=Ge(C.items);return{x:C.centroidX,z:C.centroidZ,count:C.items.length,allLocations:C.items,victimName:C.items.length===1?k.victimName:null,killerName:C.items.length===1?k.killerName:null,deathType:t,mapName:k.mapName,camp:k.camp,gameId:C.items.length===1?k.gameId:null,displayedGameId:C.items.length===1?k.displayedGameId:null,clusterIndex:z}}),[n,l]),i=T.useMemo(()=>Ve(d),[d]),{xDomain:x,zDomain:F}=T.useMemo(()=>{if(i)return{xDomain:[i.xMin,i.xMax],zDomain:[i.zMin,i.zMax]};if(y.length===0)return{xDomain:[0,100],zDomain:[0,100]};const v=y.map(c=>c.x),C=y.map(c=>c.z),z=Math.min(...v),k=Math.max(...v),t=Math.min(...C),P=Math.max(...C),M=(k-z)*.1||10,h=(P-t)*.1||10;return{xDomain:[z-M,k+M],zDomain:[t-h,P+h]}},[y,i]),$=v=>v?v==="BY_WOLF"||v==="SURVIVALIST_NOT_SAVED"?m.Loup:v==="VOTED"?"var(--chart-color-1)":v==="BULLET"||v==="BULLET_HUMAN"||v==="BULLET_WOLF"?m.Chasseur:v==="BY_ZOMBIE"?m.Vaudou:v==="ASSASSIN"?m.Alchimiste:v==="AVENGER"?"var(--chart-color-2)":v==="LOVER_DEATH"?m.Amoureux:v==="BY_BEAST"?"var(--chart-color-3)":v==="SHERIF_SUCCESS"?"var(--chart-color-4)":v==="SMUGGLER_HUNT_KILL"?m.Contrebandier:"var(--accent-primary-text)":"var(--text-secondary)",W=({active:v,payload:C})=>{if(!v||!C||C.length===0)return null;const z=C[0].payload,k=z.allLocations||[z];if(k.length>1){const M=new Map,h=new Map,c=new Set;k.forEach(N=>{M.set(N.victimName,(M.get(N.victimName)||0)+1);const A=N.deathType?re(N.deathType):"Inconnu";h.set(A,(h.get(A)||0)+1),c.add(N.gameId)});const u=Array.from(M.entries()).sort((N,A)=>A[1]-N[1]).slice(0,3),D=Array.from(h.entries()).sort((N,A)=>A[1]-N[1]).slice(0,3);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[R==="deaths"?"ðŸ’€":"âš”ï¸"," ",k.length," ",R==="deaths"?"morts":"kills"," Ã  cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:R==="deaths"?"Par:":"Victimes:"}),u.map(([N,A])=>e.jsxs("div",{style:{paddingLeft:"0.5rem"},children:["â€¢ ",N," (",A,"x)"]},N)),M.size>3&&e.jsxs("div",{style:{paddingLeft:"0.5rem",color:"var(--text-secondary)"},children:["+",M.size-3," autres..."]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Types de mort:"}),D.map(([N,A])=>e.jsxs("div",{style:{paddingLeft:"0.5rem"},children:["â€¢ ",N," (",A,"x)"]},N))]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["ðŸ“ ",c.size," partie",c.size>1?"s":""," diffÃ©rente",c.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const P=k[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[R==="deaths"?"ðŸ’€":"âš”ï¸"," ",R==="deaths"?"Mort de":"Kill de"," ",r]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[R==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"TuÃ© par:"})," ",P.killerName||"Inconnu"]}),e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Cause:"})," ",P.deathType?re(P.deathType):"Inconnue"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Victime:"})," ",P.victimName]}),e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Cause:"})," ",P.deathType?re(P.deathType):"Inconnue"]}),e.jsxs("div",{children:["ðŸ‘¥ ",e.jsx("strong",{children:"Camp victime:"})," ",P.camp]})]}),e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",P.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",P.gameId]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})},L=v=>{if(!v)return;const C=v.allLocations||[v];if(C.length===1)p({selectedGame:C[0].gameId,fromComponent:"Player Death Map"});else{const z=C.map(k=>k.gameId).filter(k=>k);p({selectedGameIds:z,fromComponent:"Player Death Map"})}};return b?e.jsx("div",{className:"donnees-attente",children:"Chargement des donnÃ©es..."}):w?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",w]}):S?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>f("deaths"),style:{background:R==="deaths"?"var(--accent-primary)":"transparent",color:R==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:R==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"ðŸ’€ Morts"}),e.jsx("button",{type:"button",onClick:()=>f("kills"),style:{background:R==="kills"?"var(--accent-primary)":"transparent",color:R==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:R==="kills"?"bold":"normal",transition:"all 0.2s"},children:"âš”ï¸ Kills"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:d,onChange:v=>g(v.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:o.map(v=>e.jsx("option",{value:v,children:v},v))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:l,onChange:v=>s(parseInt(v.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:l===0?"Aucun":`${l} unitÃ©${l>1?"s":""}`})]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{flex:"1 1 100%",marginBottom:"1.5rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:R==="deaths"?"Morts localisÃ©es":"Kills localisÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:R==="deaths"?"var(--accent-secondary)":"var(--accent-primary-text)"},children:n.length}),l>0&&y.length<n.length&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"4px"},children:["â†’ ",y.length," points groupÃ©s"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Carte"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-2)",fontSize:"1.2rem"},children:d||"Aucune"})]})]}),e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:n.length>0?e.jsx(B,{title:R==="deaths"?`Carte des Morts de ${r}`:`Carte des Kills de ${r}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(Be,{margin:{top:20,right:30,left:60,bottom:60},children:[i&&e.jsx(Ke,{x1:i.zMin,x2:i.zMax,y1:i.xMin,y2:i.xMax,fill:"transparent",stroke:"none",shape:v=>{const{x:C,y:z,width:k,height:t}=v;return e.jsx("image",{x:C,y:z,width:k,height:t,href:i.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),e.jsx(K,{strokeDasharray:"3 3",stroke:i?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(O,{dataKey:"z",type:"number",name:"Position Z",domain:F,hide:!0}),e.jsx(H,{dataKey:"x",type:"number",name:"Position X",domain:x,hide:!0}),e.jsx(V,{content:e.jsx(W,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Oe,{data:y,onClick:v=>L(v),style:{cursor:"pointer"},isAnimationActive:!1,children:y.map((v,C)=>{const z=Math.min(Math.log2(v.count+1)*3+5,18),k=Math.round(z);return e.jsx(U,{fill:$(v.deathType),stroke:v.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:v.count>1?2:1,opacity:.85,r:k},`cell-${C}`)})})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:R==="deaths"?`Aucune mort localisÃ©e pour ${r} sur cette carte.`:`Aucun kill localisÃ© pour ${r} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes."})]})}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"Ã€ propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",R==="deaths"?`les emplacements oÃ¹ ${r} est mort`:`les emplacements oÃ¹ ${r} a Ã©liminÃ© d'autres joueurs`," au cours des parties. Les couleurs indiquent le type de mort. Cliquez sur un point pour voir les dÃ©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroupÃ©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’€ Morts:"})," OÃ¹ le joueur a Ã©tÃ© Ã©liminÃ©",e.jsx("br",{}),e.jsx("strong",{children:"âš”ï¸ Kills:"})," OÃ¹ le joueur a Ã©liminÃ© d'autres joueurs"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function Re(r){return r.PlayerStats.some(p=>p.SecondsTalkedOutsideMeeting>0||p.SecondsTalkedDuringMeeting>0)}function le(r,p){const S=p.DeathDateIrl||r.EndDate,b=be(r.StartDate,S);return b&&b>0?b:0}function lt(r){const p=r.filter(Re),S=new Map;return p.forEach(b=>{b.PlayerStats.forEach(w=>{const m=Z(w),R=De(w),f=le(b,w);if(f<=0)return;S.has(m)||S.set(m,{displayName:R,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const d=S.get(m);d.gamesPlayed++,d.totalSecondsAll+=(w.SecondsTalkedOutsideMeeting||0)+(w.SecondsTalkedDuringMeeting||0),d.totalGameDuration+=f})}),{playerStats:S,gamesWithTalkingData:p.length}}function ct(r,p){if(!p||p.length===0||!r)return null;const S=lt(p),b=p.filter(Re);if(b.length===0||S.playerStats.size===0)return null;let w=null;for(const[c,u]of S.playerStats)if(u.displayName===r){w=c;break}if(!w)return null;let m=0,R=0,f=0,d=0;const g={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},l=new Map;let s=0,o=0,a=0,n=0;if(b.forEach(c=>{const u=c.PlayerStats.find(q=>Z(q)===w);if(!u)return;const D=le(c,u);if(D<=0)return;m++;const N=u.SecondsTalkedOutsideMeeting||0,A=u.SecondsTalkedDuringMeeting||0,ae=N+A;R+=N,f+=A,d+=D;const j=Me(u.MainRoleInitial,u.Power);g[j].gamesPlayed++,g[j].secondsOutside+=N,g[j].secondsDuring+=A,g[j].gameDuration+=D;const I=qe(u);l.has(I)||l.set(I,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const E=l.get(I);E.gamesPlayed++,E.totalSecondsAll+=ae,E.totalGameDuration+=D}),m===0||d<=0)return null;const y=3600/d,i=R*y,x=f*y,F=(R+f)*y,$=R+f>0?f/(R+f)*100:0,W=[];for(const[c,u]of Object.entries(g)){if(u.gamesPlayed===0)continue;const D=u.gameDuration>0?3600/u.gameDuration:0,N=u.secondsOutside+u.secondsDuring;W.push({camp:c,gamesPlayed:u.gamesPlayed,totalSecondsOutside:u.secondsOutside,totalSecondsDuring:u.secondsDuring,totalSecondsAll:N,totalGameDurationSeconds:u.gameDuration,secondsOutsidePer60Min:u.secondsOutside*D,secondsDuringPer60Min:u.secondsDuring*D,secondsAllPer60Min:N*D,meetingRatio:N>0?u.secondsDuring/N*100:0})}W.sort((c,u)=>u.gamesPlayed-c.gamesPlayed);const L=Array.from(l.entries()).filter(([c,u])=>u.gamesPlayed>=1).map(([c,u])=>({role:c,gamesPlayed:u.gamesPlayed,secondsAllPer60Min:u.totalGameDuration>0?u.totalSecondsAll/u.totalGameDuration*3600:0,totalSecondsAll:u.totalSecondsAll})).sort((c,u)=>u.secondsAllPer60Min-c.secondsAllPer60Min),v=[];for(const[c,u]of S.playerStats)u.totalGameDuration>0&&v.push({id:c,name:u.displayName,per60:u.totalSecondsAll/u.totalGameDuration*3600});v.sort((c,u)=>u.per60-c.per60);const C=v.reduce((c,u)=>c+u.per60,0),z=v.length>0?C/v.length:0,k=v.findIndex(c=>c.id===w)+1,t=v.length,P=t>0?Math.round((1-(k-1)/t)*100):0,M=F;b.forEach(c=>{const u=c.PlayerStats.find(ae=>Z(ae)===w);if(!u)return;const D=le(c,u);if(D<=0)return;((u.SecondsTalkedOutsideMeeting||0)+(u.SecondsTalkedDuringMeeting||0))/D*3600>=M?(s++,u.Victorious&&o++):(a++,u.Victorious&&n++)});const h={gamesAboveAverage:s,winsAboveAverage:o,winRateAboveAverage:s>0?o/s*100:0,gamesBelowAverage:a,winsBelowAverage:n,winRateBelowAverage:a>0?n/a*100:0};return{playerName:r,gamesPlayed:m,gamesWithTalkingData:S.gamesWithTalkingData,totalSecondsOutside:R,totalSecondsDuring:f,totalSecondsAll:R+f,totalGameDurationSeconds:d,secondsOutsidePer60Min:i,secondsDuringPer60Min:x,secondsAllPer60Min:F,meetingRatio:$,campBreakdown:W,globalAverageSecondsAllPer60Min:z,playerRank:k,totalPlayersWithData:t,percentile:P,roleBreakdown:L,winCorrelation:h}}function dt(r,p){return r?r.roleBreakdown.slice(0,p):[]}function ut(r){const{data:p,isLoading:S,error:b}=de(w=>r?ct(r,w):null);return{data:p,isLoading:S,error:b}}function pt({selectedPlayerName:r}){const{data:p,isLoading:S,error:b}=ut(r),w=se(),[m,R]=T.useState("both"),f=T.useMemo(()=>p?.campBreakdown?p.campBreakdown.map(a=>({camp:a.camp,"Hors rÃ©union":Math.round(a.secondsOutsidePer60Min),"En rÃ©union":Math.round(a.secondsDuringPer60Min),total:Math.round(a.secondsAllPer60Min),gamesPlayed:a.gamesPlayed,meetingRatio:a.meetingRatio.toFixed(1)})):[],[p]),d=T.useMemo(()=>p?[{name:"En rÃ©union",value:p.totalSecondsDuring,color:"#2196F3"},{name:"Hors rÃ©union",value:p.totalSecondsOutside,color:"#FF9800"}]:[],[p]);if(S)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(b)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",b]});if(!p)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de temps de parole ne sont disponibles que pour les parties rÃ©centes."})]});const g=p.secondsAllPer60Min-p.globalAverageSecondsAllPer60Min,l=p.globalAverageSecondsAllPer60Min>0?(g/p.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",s=g>0,o=p.winCorrelation.winRateAboveAverage-p.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¤ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:te(p.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:s?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[s?"+":"",l,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",p.playerRank," / ",p.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-p.percentile+1,"% ",p.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“ˆ Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:p.gamesPlayed}),e.jsxs("p",{children:["sur ",p.gamesWithTalkingData," avec donnÃ©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ—£ï¸ Ratio en rÃ©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[p.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),f.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(B,{title:"Temps de parole par camp (par 60min de jeu)",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>R("meeting"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:m==="meeting"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:m==="meeting"?"var(--accent-primary)":"var(--bg-secondary)",color:m==="meeting"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:m==="meeting"?"bold":"normal"},children:"En rÃ©union"}),e.jsx("button",{onClick:()=>R("outside"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:m==="outside"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:m==="outside"?"var(--accent-primary)":"var(--bg-secondary)",color:m==="outside"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:m==="outside"?"bold":"normal"},children:"Hors rÃ©union"}),e.jsx("button",{onClick:()=>R("both"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:m==="both"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:m==="both"?"var(--accent-primary)":"var(--bg-secondary)",color:m==="both"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:m==="both"?"bold":"normal"},children:"Les deux"})]}),e.jsx("div",{style:{height:350},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:f,layout:"vertical",children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(O,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:a=>`${Math.floor(a/60)}m`}),e.jsx(H,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(V,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(a,n)=>[te(a),n],labelFormatter:a=>{const n=f.find(y=>y.camp===a);return`${a} (${n?.gamesPlayed||0} parties)`}}),e.jsx(He,{}),(m==="both"||m==="outside")&&e.jsx(_,{dataKey:"Hors rÃ©union",stackId:"talk",fill:"#FF9800"}),(m==="both"||m==="meeting")&&e.jsx(_,{dataKey:"En rÃ©union",stackId:"talk",fill:"#2196F3"})]})})})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:(()=>{const a=f.find(x=>x.camp==="Villageois"),n=f.find(x=>x.camp==="Loup");if(!a||!n)return e.jsx("p",{children:"ðŸ’¡ Pas assez de donnÃ©es pour comparer les camps Villageois et Loups."});const y=a.total-n.total,i=n.total>0?(Math.abs(y)/n.total*100).toFixed(0):"0";return y>0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:pe("Villageois")},children:[te(y)," de plus (+",i,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Villageois"})," qu'en tant que"," ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]}):y<0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:pe("Loup")},children:[te(Math.abs(y))," de plus (+",i,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Loup"})," qu'en tant que"," ",e.jsx("strong",{children:"Villageois"})," (par heure de jeu)."]}):e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle exactement autant en tant que"," ",e.jsx("strong",{children:"Villageois"})," qu'en tant que ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(B,{title:"RÃ©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(we,{children:[e.jsx(Se,{data:d,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:a=>`${a.name}: ${((a.percent||0)*100).toFixed(1)}%`,children:d.map((a,n)=>e.jsx(U,{fill:a.color},`cell-${n}`))}),e.jsx(V,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:a=>te(a)})]})})})})}),p&&p.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(B,{title:a=>a?"Top 15 rÃ´les les plus bavards (par 60min)":"Top 5 rÃ´les les plus bavards (par 60min)",children:a=>{const y=dt(p,a?15:5).map(i=>({role:i.role,secondsPer60Min:Math.round(i.secondsAllPer60Min),gamesPlayed:i.gamesPlayed}));return e.jsx("div",{style:{height:a?400:300},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:y,children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(O,{dataKey:"role",tick:{fill:"var(--text-primary)",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(H,{tick:{fill:"var(--text-secondary)"},tickFormatter:i=>`${Math.floor(i/60)}m`}),e.jsx(V,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:i=>[te(i),"Temps de parole"],labelFormatter:i=>{const x=y.find(F=>F.role===i);return`${i} (${x?.gamesPlayed||0} parties)`}}),e.jsx(_,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",children:y.map((i,x)=>e.jsx(U,{fill:w[i.role]||w.Villageois},`cell-${x}`))})]})})})}})}),(p.winCorrelation.gamesAboveAverage>0||p.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"ðŸŽ¯ CorrÃ©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[p.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",p.winCorrelation.winsAboveAverage,"/",p.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[p.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",p.winCorrelation.winsBelowAverage,"/",p.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(o)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:o>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[o>0?"supÃ©rieur":"infÃ©rieur"," de ",Math.abs(o).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function It(){const{settings:r,updateSettings:p}=ce(),{navigateToGameDetails:S,navigationState:b,updateNavigationState:w}=Q(),{data:m,isLoading:R,error:f}=Ae(),{joueursData:d,isLoading:g}=ne(),{data:l,isLoading:s,error:o}=Xe(r.highlightedPlayer),a=ue(d),[n,y]=T.useState(""),[i,x]=T.useState(null),{clips:F}=_e(r.highlightedPlayer),{clips:$}=Ue(),[W,L]=T.useState(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded"?"modded":"all":r.gameFilter==="modded"?"modded":"all"),v=T.useMemo(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded":r.gameFilter==="modded",[r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter,r.gameFilter]),[C,z]=T.useState(b.selectedPlayerSelectionView||"achievements"),[k,t]=T.useState("session"),[P,M]=T.useState("all");T.useEffect(()=>{if(r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled){const j=r.independentFilters.gameFilter==="modded"?"modded":"all";L(j)}else if(!r.useIndependentFilters){const j=r.gameFilter==="modded"?"modded":"all";L(j)}},[r.gameFilter,r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter]),T.useEffect(()=>{v&&W!=="modded"&&L("modded")},[v,W]),T.useEffect(()=>{b.selectedPlayerSelectionView&&z(b.selectedPlayerSelectionView)},[b.selectedPlayerSelectionView]);const{data:h}=oe(r.highlightedPlayer||""),c=T.useMemo(()=>{if(!m||!m.GameStats)return[];const j=v?m.GameStats.filter(E=>E.Modded===!0):m.GameStats,I=new Map;return j.forEach(E=>{const q=new Date(E.StartDate);E.PlayerStats.forEach(Y=>{const X=Z(Y),ke=d?.Players?.find(Pe=>Pe.SteamID===X)?.Joueur||Y.Username;I.has(X)||I.set(X,{games:0,wins:0,firstDate:q,lastDate:q,displayName:ke});const ee=I.get(X);ee.games++,Y.Victorious&&ee.wins++,q<ee.firstDate&&(ee.firstDate=q),q>ee.lastDate&&(ee.lastDate=q)})}),Array.from(I.entries()).map(([E,q])=>{let Y=d?.Players?.find(X=>X.SteamID===E);return Y||(Y=d?.Players?.find(X=>X.Joueur===q.displayName)),{id:E,name:q.displayName,totalGames:q.games,totalWins:q.wins,winRate:q.games>0?q.wins/q.games*100:0,firstGameDate:q.firstDate.toLocaleDateString("fr-FR"),lastGameDate:q.lastDate.toLocaleDateString("fr-FR"),isHighlighted:q.displayName===r.highlightedPlayer,image:Y?.Image||null,twitch:Y?.Twitch||null,youtube:Y?.Youtube||null}})},[m,r.highlightedPlayer,d,v]),u=T.useMemo(()=>{if(!n.trim())return c;const j=n.toLowerCase();return c.filter(I=>I.name.toLowerCase().includes(j))},[c,n]),D=T.useMemo(()=>[...u].sort((j,I)=>I.totalGames-j.totalGames),[u]),N=j=>{p({highlightedPlayer:j}),y("")},A=j=>{z(j),w({selectedPlayerSelectionView:j})},ae=()=>{if(F.length===0)return;const j=Math.floor(Math.random()*F.length);x(F[j])};return R||g?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):f?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",f]})]}):!m||c.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!r.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:n,onChange:j=>y(j.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[u.length," joueur",u.length!==1?"s":"",n&&` (filtrÃ©${u.length!==1?"s":""} de ${c.length})`]})]})]}),e.jsx("div",{className:"player-display",children:n?u.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>y(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:D.map(j=>e.jsxs("button",{type:"button",className:`suggestion-btn ${j.isHighlighted?"highlighted":""}`,onClick:()=>N(j.name),children:[j.image?e.jsx("img",{src:j.image,alt:`Photo de profil de ${j.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":a[j.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[j.name,j.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[j.totalGames," parties â€¢ ",j.winRate.toFixed(1),"% victoires"]})]})]},j.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',n,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>y(""),children:"Effacer la recherche"})]}):r.highlightedPlayer?(()=>{const j=c.find(I=>I.name===r.highlightedPlayer);return j?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:j.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[j.image?e.jsx("img",{src:j.image,alt:`Photo de profil de ${j.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":a[j.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[j.totalGames," parties â€¢ ",j.totalWins," victoires â€¢ ",j.winRate.toFixed(1),"% taux de victoire"]}),(j.twitch||j.youtube||F.length>0)&&e.jsxs("div",{className:"social-links",children:[j.twitch&&e.jsx("a",{href:j.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),j.youtube&&e.jsx("a",{href:j.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"}),F.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:I=>{I.stopPropagation(),ae()},title:`${F.length} clip${F.length>1?"s":""} disponible${F.length>1?"s":""}`,children:["ðŸŽ¬ Clip alÃ©atoire (",F.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${C==="achievements"?"active":""}`,onClick:()=>A("achievements"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${C==="evolution"?"active":""}`,onClick:()=>A("evolution"),children:"Ã‰volution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${C==="camps"?"active":""}`,onClick:()=>A("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${C==="roles"?"active":""}`,onClick:()=>A("roles"),children:"RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${C==="maps"?"active":""}`,onClick:()=>A("maps"),children:"Maps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${C==="kills"?"active":""}`,onClick:()=>A("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${C==="deathmap"?"active":""}`,onClick:()=>A("deathmap"),children:"Carte"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${C==="talkingtime"?"active":""}`,onClick:()=>A("talkingtime"),children:"Parole"})]}),C==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[s?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):o?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",o]})}):l?e.jsx(et,{achievements:W==="all"?l.allGamesAchievements:l.moddedOnlyAchievements,title:W==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:W}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[!v&&e.jsx("button",{type:"button",className:`filter-btn ${W==="all"?"active":""}`,onClick:I=>{I.stopPropagation(),L("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${W==="modded"?"active":""}`,onClick:I=>{I.stopPropagation(),L("modded")},disabled:v,children:"Parties moddÃ©es"})]})]}),C==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[h&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{S({selectedPlayer:j.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${j.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:h.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:ze(h.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{S({selectedPlayer:j.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${j.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:h.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[h.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:k,onChange:I=>t(I.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:P,onChange:I=>M(I.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(tt,{selectedPlayerName:j.name,groupingMethod:k,campFilter:P})]}),C==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(at,{selectedPlayerName:j.name})}),C==="maps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(st,{selectedPlayerName:j.name})}),C==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(nt,{selectedPlayerName:j.name})}),C==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(rt,{selectedPlayerName:j.name})}),C==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ot,{selectedPlayerName:j.name})}),C==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(pt,{selectedPlayerName:j.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:I=>{I.stopPropagation(),p({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[j.firstGameDate," - ",j.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',r.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>p({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:D.map(j=>e.jsxs("div",{className:`character-card ${j.isHighlighted?"highlighted":""}`,onClick:()=>N(j.name),title:`${j.name} - ${j.totalGames} parties, ${j.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:j.image?e.jsx("img",{src:j.image,alt:`Photo de profil de ${j.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":a[j.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:j.name}),(j.twitch||j.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[j.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),j.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},j.id))})})}),i&&e.jsx(Ye,{clip:i,onClose:()=>x(null),relatedClips:Je(i,$),nextClip:fe(i,$),onNextClip:()=>{const j=fe(i,$);j&&x(j)},onRelatedClip:j=>{const I=$.find(E=>E.ClipId===j);I&&x(I)}})]})}export{It as PlayerSelectionPage};
