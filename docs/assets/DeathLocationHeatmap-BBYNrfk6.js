import{r as E,j as t,u as J,a as ne,e as Q}from"./index-BlE2yhdl.js";import{d as oe,e as G,u as se,c as ae}from"./useDeathStatisticsFromRaw-C8z4GmR7.js";import{D as I}from"./datasyncExport-D6_8Fmuy.js";import{a as ie}from"./api-CwWxZwOP.js";import{F as le,C as ce,X as de,Y as ue,a as fe}from"./FullscreenChart-DEqjFIwf.js";import{g as H}from"./deathTypes-CGUOTngO.js";import{ak as he,al as _,am as O,an as me,ao as Y,R as xe,T as pe}from"./CategoricalChart-DEhNfwCA.js";import{S as ge,a as ve}from"./ScatterChart-UUT5V1VI.js";import"./baseStatsHook-on70_lDu.js";const ye=be(je);function be(e){return function(c,u,s=u){if(!((u=+u)>=0))throw new RangeError("invalid rx");if(!((s=+s)>=0))throw new RangeError("invalid ry");let{data:r,width:d,height:f}=c;if(!((d=Math.floor(d))>=0))throw new RangeError("invalid width");if(!((f=Math.floor(f!==void 0?f:r.length/d))>=0))throw new RangeError("invalid height");if(!d||!f||!u&&!s)return c;const g=u&&e(u),p=s&&e(s),l=r.slice();return g&&p?(X(g,l,r,d,f),X(g,r,l,d,f),X(g,l,r,d,f),q(p,r,l,d,f),q(p,l,r,d,f),q(p,r,l,d,f)):g?(X(g,r,l,d,f),X(g,l,r,d,f),X(g,r,l,d,f)):p&&(q(p,r,l,d,f),q(p,l,r,d,f),q(p,r,l,d,f)),c}}function X(e,c,u,s,r){for(let d=0,f=s*r;d<f;)e(c,u,d,d+=s,1)}function q(e,c,u,s,r){for(let d=0,f=s*r;d<s;++d)e(c,u,d,d+f,s)}function je(e){const c=Math.floor(e);if(c===e)return Me(e);const u=e-c,s=2*e+1;return(r,d,f,g,p)=>{if(!((g-=p)>=f))return;let l=c*d[f];const a=p*c,y=a+p;for(let h=f,x=f+a;h<x;h+=p)l+=d[Math.min(g,h)];for(let h=f,x=g;h<=x;h+=p)l+=d[Math.min(g,h+a)],r[h]=(l+u*(d[Math.max(f,h-y)]+d[Math.min(g,h+y)]))/s,l-=d[Math.max(f,h-a)]}}function Me(e){const c=2*e+1;return(u,s,r,d,f)=>{if(!((d-=f)>=r))return;let g=e*s[r];const p=f*e;for(let l=r,a=r+p;l<a;l+=f)g+=s[Math.min(d,l)];for(let l=r,a=d;l<=a;l+=f)g+=s[Math.min(d,l+p)],u[l]=g/c,g-=s[Math.max(r,l-p)]}}function ze(e,c){let u=0;for(let s of e)s!=null&&(s=+s)>=s&&++u;return u}function Se(e,c){let u,s;if(c===void 0)for(const r of e)r!=null&&(u===void 0?r>=r&&(u=s=r):(u>r&&(u=r),s<r&&(s=r)));else{let r=-1;for(let d of e)(d=c(d,++r,e))!=null&&(u===void 0?d>=d&&(u=s=d):(u>d&&(u=d),s<d&&(s=d)))}return[u,s]}function Ce(e,c,u){let s;for(;;){const r=he(e,c,u);if(r===s||r===0||!isFinite(r))return[e,c];r>0?(e=Math.floor(e/r)*r,c=Math.ceil(c/r)*r):r<0&&(e=Math.ceil(e*r)/r,c=Math.floor(c*r)/r),s=r}}function Ee(e){return Math.max(1,Math.ceil(Math.log(ze(e))/Math.LN2)+1)}var ke=Array.prototype,ee=ke.slice;function we(e,c){return e-c}function Ae(e){for(var c=0,u=e.length,s=e[u-1][1]*e[0][0]-e[u-1][0]*e[0][1];++c<u;)s+=e[c-1][1]*e[c][0]-e[c-1][0]*e[c][1];return s}const B=e=>()=>e;function Ne(e,c){for(var u=-1,s=c.length,r;++u<s;)if(r=Re(e,c[u]))return r;return 0}function Re(e,c){for(var u=c[0],s=c[1],r=-1,d=0,f=e.length,g=f-1;d<f;g=d++){var p=e[d],l=p[0],a=p[1],y=e[g],h=y[0],x=y[1];if(De(p,y,c))return 0;a>s!=x>s&&u<(h-l)*(s-a)/(x-a)+l&&(r=-r)}return r}function De(e,c,u){var s;return Le(e,c,u)&&Ie(e[s=+(e[0]===c[0])],u[s],c[s])}function Le(e,c,u){return(c[0]-e[0])*(u[1]-e[1])===(u[0]-e[0])*(c[1]-e[1])}function Ie(e,c,u){return e<=c&&c<=u||u<=c&&c<=e}function We(){}var W=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function U(){var e=1,c=1,u=Ee,s=p;function r(l){var a=u(l);if(Array.isArray(a))a=a.slice().sort(we);else{const y=Se(l,Be);for(a=_(...Ce(y[0],y[1],a),a);a[a.length-1]>=y[1];)a.pop();for(;a[1]<y[0];)a.shift()}return a.map(y=>d(l,y))}function d(l,a){const y=a==null?NaN:+a;if(isNaN(y))throw new Error(`invalid value: ${a}`);var h=[],x=[];return f(l,y,function(z){s(z,l,y),Ae(z)>0?h.push([z]):x.push(z)}),x.forEach(function(z){for(var k=0,m=h.length,n;k<m;++k)if(Ne((n=h[k])[0],z)!==-1){n.push(z);return}}),{type:"MultiPolygon",value:a,coordinates:h}}function f(l,a,y){var h=new Array,x=new Array,z,k,m,n,o,M;for(z=k=-1,n=F(l[0],a),W[n<<1].forEach(b);++z<e-1;)m=n,n=F(l[z+1],a),W[m|n<<1].forEach(b);for(W[n<<0].forEach(b);++k<c-1;){for(z=-1,n=F(l[k*e+e],a),o=F(l[k*e],a),W[n<<1|o<<2].forEach(b);++z<e-1;)m=n,n=F(l[k*e+e+z+1],a),M=o,o=F(l[k*e+z+1],a),W[m|n<<1|o<<2|M<<3].forEach(b);W[n|o<<3].forEach(b)}for(z=-1,o=l[k*e]>=a,W[o<<2].forEach(b);++z<e-1;)M=o,o=F(l[k*e+z+1],a),W[o<<2|M<<3].forEach(b);W[o<<3].forEach(b);function b(S){var C=[S[0][0]+z,S[0][1]+k],w=[S[1][0]+z,S[1][1]+k],A=g(C),R=g(w),i,v;(i=x[A])?(v=h[R])?(delete x[i.end],delete h[v.start],i===v?(i.ring.push(w),y(i.ring)):h[i.start]=x[v.end]={start:i.start,end:v.end,ring:i.ring.concat(v.ring)}):(delete x[i.end],i.ring.push(w),x[i.end=R]=i):(i=h[R])?(v=x[A])?(delete h[i.start],delete x[v.end],i===v?(i.ring.push(w),y(i.ring)):h[v.start]=x[i.end]={start:v.start,end:i.end,ring:v.ring.concat(i.ring)}):(delete h[i.start],i.ring.unshift(C),h[i.start=A]=i):h[A]=x[R]={start:A,end:R,ring:[C,w]}}}function g(l){return l[0]*2+l[1]*(e+1)*4}function p(l,a,y){l.forEach(function(h){var x=h[0],z=h[1],k=x|0,m=z|0,n=Z(a[m*e+k]);x>0&&x<e&&k===x&&(h[0]=K(x,Z(a[m*e+k-1]),n,y)),z>0&&z<c&&m===z&&(h[1]=K(z,Z(a[(m-1)*e+k]),n,y))})}return r.contour=d,r.size=function(l){if(!arguments.length)return[e,c];var a=Math.floor(l[0]),y=Math.floor(l[1]);if(!(a>=0&&y>=0))throw new Error("invalid size");return e=a,c=y,r},r.thresholds=function(l){return arguments.length?(u=typeof l=="function"?l:Array.isArray(l)?B(ee.call(l)):B(l),r):u},r.smooth=function(l){return arguments.length?(s=l?p:We,r):s===p},r}function Be(e){return isFinite(e)?e:NaN}function F(e,c){return e==null?!1:+e>=c}function Z(e){return e==null||isNaN(e=+e)?-1/0:e}function K(e,c,u,s){const r=s-c,d=u-c,f=isFinite(r)||isFinite(d)?r/d:Math.sign(r)/Math.sign(d);return isNaN(f)?e:e+f-.5}function Pe(e){return e[0]}function Te(e){return e[1]}function Fe(){return 1}function te(){var e=Pe,c=Te,u=Fe,s=960,r=500,d=20,f=2,g=d*3,p=s+g*2>>f,l=r+g*2>>f,a=B(20);function y(o){var M=new Float32Array(p*l),b=Math.pow(2,-f),S=-1;for(const N of o){var C=(e(N,++S,o)+g)*b,w=(c(N,S,o)+g)*b,A=+u(N,S,o);if(A&&C>=0&&C<p&&w>=0&&w<l){var R=Math.floor(C),i=Math.floor(w),v=C-R-.5,j=w-i-.5;M[R+i*p]+=(1-v)*(1-j)*A,M[R+1+i*p]+=v*(1-j)*A,M[R+1+(i+1)*p]+=v*j*A,M[R+(i+1)*p]+=(1-v)*j*A}}return ye({data:M,width:p,height:l},d*b),M}function h(o){var M=y(o),b=a(M),S=Math.pow(2,2*f);return Array.isArray(b)||(b=_(Number.MIN_VALUE,O(M)/S,b)),U().size([p,l]).thresholds(b.map(C=>C*S))(M).map((C,w)=>(C.value=+b[w],x(C)))}h.contours=function(o){var M=y(o),b=U().size([p,l]),S=Math.pow(2,2*f),C=w=>{w=+w;var A=x(b.contour(M,w*S));return A.value=w,A};return Object.defineProperty(C,"max",{get:()=>O(M)/S}),C};function x(o){return o.coordinates.forEach(z),o}function z(o){o.forEach(k)}function k(o){o.forEach(m)}function m(o){o[0]=o[0]*Math.pow(2,f)-g,o[1]=o[1]*Math.pow(2,f)-g}function n(){return g=d*3,p=s+g*2>>f,l=r+g*2>>f,h}return h.x=function(o){return arguments.length?(e=typeof o=="function"?o:B(+o),h):e},h.y=function(o){return arguments.length?(c=typeof o=="function"?o:B(+o),h):c},h.weight=function(o){return arguments.length?(u=typeof o=="function"?o:B(+o),h):u},h.size=function(o){if(!arguments.length)return[s,r];var M=+o[0],b=+o[1];if(!(M>=0&&b>=0))throw new Error("invalid size");return s=M,r=b,n()},h.cellSize=function(o){if(!arguments.length)return 1<<f;if(!((o=+o)>=1))throw new Error("invalid cell size");return f=Math.floor(Math.log(o)/Math.LN2),n()},h.thresholds=function(o){return arguments.length?(a=typeof o=="function"?o:Array.isArray(o)?B(ee.call(o)):B(o),h):a},h.bandwidth=function(o){if(!arguments.length)return Math.sqrt(d*(d+1));if(!((o=+o)>=0))throw new Error("invalid bandwidth");return d=(Math.sqrt(4*o*o+1)-1)/2,n()},h}function Xe(e){for(var c=e.length/6|0,u=new Array(c),s=0;s<c;)u[s]="#"+e.slice(s*6,++s*6);return u}const qe=e=>me(e[e.length-1]);var $e=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Xe);const re=qe($e);function He({deathLocations:e,xDomain:c,zDomain:u,width:s=800,height:r=600,bandwidth:d=25,onRegionClick:f}){const g=E.useRef(null),p=E.useRef(null),l=E.useRef(null),a=E.useMemo(()=>Y().domain(c).range([0,s]),[c,s]),y=E.useMemo(()=>Y().domain(u).range([r,0]),[u,r]),h=E.useMemo(()=>e.length===0?[]:te().x(n=>a(n.x)).y(n=>y(n.z)).size([s,r]).bandwidth(d).thresholds(15)(e),[e,a,y,s,r,d]),x=E.useMemo(()=>{const m=h.length>0?Math.max(...h.map(n=>n.value)):1;return n=>{const o=n/m;return re(o)}},[h]);E.useEffect(()=>{const m=g.current;if(!m||h.length===0)return;const n=m.getContext("2d");n&&(n.clearRect(0,0,s,r),h.forEach(o=>{n.fillStyle=x(o.value),n.globalAlpha=.6,o.coordinates.forEach(M=>{M.forEach(b=>{n.beginPath(),b.forEach((S,C)=>{C===0?n.moveTo(S[0],S[1]):n.lineTo(S[0],S[1])}),n.closePath(),n.fill()})})}),n.globalAlpha=1)},[h,s,r,x]),E.useEffect(()=>{const m=p.current;if(!m||e.length===0)return;const n=m.getContext("2d");n&&(n.clearRect(0,0,s,r),e.forEach(o=>{const M=a(o.x),b=y(o.z);n.beginPath(),n.arc(M,b,2,0,2*Math.PI),n.fillStyle="rgba(0, 0, 0, 0.3)",n.fill(),n.strokeStyle="rgba(255, 255, 255, 0.5)",n.lineWidth=.5,n.stroke()}))},[e,a,y,s,r]);const z=m=>{if(!f||!l.current)return;const n=l.current.getBoundingClientRect(),o=m.clientX-n.left,M=m.clientY-n.top,b=30,S=e.filter(C=>{const w=a(C.x),A=y(C.z);return Math.sqrt(Math.pow(w-o,2)+Math.pow(A-M,2))<=b});S.length>0&&f(S)},k=m=>{if(!l.current)return;const n=l.current.getBoundingClientRect(),o=m.clientX-n.left,M=m.clientY-n.top,b=20,S=e.filter(C=>{const w=a(C.x),A=y(C.z);return Math.sqrt(Math.pow(w-o,2)+Math.pow(A-M,2))<=b});l.current&&(l.current.style.cursor=S.length>0?"pointer":"default")};return t.jsxs("div",{ref:l,style:{position:"relative",width:`${s}px`,height:`${r}px`,margin:"0 auto"},onClick:z,onMouseMove:k,children:[t.jsx("canvas",{ref:g,width:s,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),t.jsx("canvas",{ref:p,width:s,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),t.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),t.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),t.jsxs("svg",{width:s,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(m=>{const n=s*m,o=c[0]+(c[1]-c[0])*m;return t.jsxs("g",{children:[t.jsx("line",{x1:n,y1:r,x2:n,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:n,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(o)})]},`x-${m}`)}),[0,.25,.5,.75,1].map(m=>{const n=r*(1-m),o=u[0]+(u[1]-u[0])*m;return t.jsxs("g",{children:[t.jsx("line",{x1:0,y1:n,x2:5,y2:n,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:10,y:n,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(o)})]},`z-${m}`)})]})]})}function Ve({selectedCamp:e,availableDeathTypes:c,deathTypeColors:u}){const{navigateToGameDetails:s}=J(),{settings:r}=ne(),{data:d,isLoading:f,error:g}=Q(),[p,l]=E.useState(""),[a,y]=E.useState("all"),[h,x]=E.useState(null),[z,k]=E.useState("scatter"),m=E.useMemo(()=>{if(!d)return[];const i=oe(d),v=G(d,e),j=new Map;return v.forEach(N=>{j.set(N.mapName,(j.get(N.mapName)||0)+1)}),i.sort((N,L)=>{const P=j.get(N)||0;return(j.get(L)||0)-P})},[d,e]),n=m.length>0?m[0]:"";p===""&&n!==""&&l(n);const o=E.useMemo(()=>{if(!d)return[];let i=G(d,e);return p&&(i=i.filter(v=>v.mapName===p)),a!=="all"&&(i=i.filter(v=>v.deathType===a)),i},[d,e,p,a]),M=E.useMemo(()=>{const i=new Map;return o.forEach(v=>{const j=`${Math.round(v.x)}_${Math.round(v.z)}`;i.has(j)||i.set(j,[]),i.get(j).push(v)}),i},[o]),b=E.useMemo(()=>Array.from(M.entries()).map(([i,v])=>({...v[0],deathCount:v.length,allDeaths:v,locationKey:i})),[M]),S=({active:i,payload:v})=>{if(!i||!v||v.length===0)return null;const j=v[0].payload,N=`${Math.round(j.x)}_${Math.round(j.z)}`,L=M.get(N)||[j];if(L.length>1){const T=new Map,$=new Set;return L.forEach(D=>{const V=D.deathType?H(D.deathType):"Inconnu";T.set(V,(T.get(V)||0)+1),$.add(D.gameId)}),t.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[t.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:[L.length," morts Ã  cet endroit"]}),t.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[t.jsxs("div",{style:{marginBottom:"8px"},children:[t.jsx("strong",{children:"Position:"})," (",Math.round(j.x),", ",Math.round(j.z),")"]}),t.jsxs("div",{style:{marginBottom:"8px"},children:[t.jsx("strong",{children:"Types de mort:"}),t.jsx("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:Array.from(T.entries()).map(([D,V])=>t.jsxs("li",{children:[D," (",V,")"]},D))})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Parties:"})," ",Array.from($).filter(D=>D).map(D=>`#${D}`).join(", ")]})]}),t.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir une des parties"})]})}return t.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[t.jsx("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:j.playerName}),t.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Camp:"})," ",j.camp]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Type de mort:"})," ",j.deathType?H(j.deathType):"Inconnu"]}),j.killerName&&t.jsxs("div",{children:[t.jsx("strong",{children:"TuÃ© par:"})," ",j.killerName]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Carte:"})," ",j.mapName]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Partie:"})," #",j.gameId]}),t.jsxs("div",{style:{marginTop:"4px",fontSize:"0.85rem",color:"var(--text-secondary)"},children:["Position: (",Math.round(j.x),", ",Math.round(j.z),")"]})]}),t.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})},C=i=>{if(!i)return;const v=i.allDeaths||[i];if(v.length===1)s({selectedGame:v[0].gameId,fromComponent:"Death Location View"});else{const j=v.map(N=>N.gameId).filter(N=>N);s({selectedGameIds:j,fromComponent:"Death Location View"})}},w=i=>i&&u[i]||"var(--text-secondary)",{xDomain:A,zDomain:R}=E.useMemo(()=>{if(b.length===0)return{xDomain:[0,100],zDomain:[0,100]};const i=b.map(D=>D.x),v=b.map(D=>D.z),j=Math.min(...i),N=Math.max(...i),L=Math.min(...v),P=Math.max(...v),T=(N-j)*.1||10,$=(P-L)*.1||10;return{xDomain:[j-T,N+T],zDomain:[L-$,P+$]}},[b]);return f?t.jsx("div",{className:"donnees-attente",children:"Chargement des localisations de mort..."}):g?t.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]}):d?t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Mode :"}),t.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[t.jsx("button",{onClick:()=>k("scatter"),style:{background:z==="scatter"?"var(--accent-primary)":"transparent",color:z==="scatter"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:z==="scatter"?"bold":"normal",transition:"all 0.2s"},children:"Points"}),t.jsx("button",{onClick:()=>k("heatmap"),style:{background:z==="heatmap"?"var(--accent-primary)":"transparent",color:z==="heatmap"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:z==="heatmap"?"bold":"normal",transition:"all 0.2s"},children:"Carte de chaleur"})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),t.jsx("select",{id:"map-select",value:p,onChange:i=>l(i.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:m.map(i=>t.jsx("option",{value:i,children:i},i))})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"death-type-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Type de mort :"}),t.jsxs("select",{id:"death-type-select",value:a,onChange:i=>y(i.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[t.jsx("option",{value:"all",children:"Tous les types"}),c.map(i=>t.jsx("option",{value:i,children:H(i)},i))]})]})]}),t.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Morts localisÃ©es"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary)"},children:o.length})]}),t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Camp filtrÃ©"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)",fontSize:"1.2rem"},children:e})]}),t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Type de mort"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-2)",fontSize:"1.2rem"},children:a==="all"?"Tous":H(a)})]})]}),o.length>0?t.jsx(le,{title:z==="scatter"?"Carte des Morts":"Carte de Chaleur des Morts",children:z==="scatter"?t.jsx("div",{style:{height:600},children:t.jsx(xe,{width:"100%",height:"100%",children:t.jsxs(ge,{margin:{top:20,right:30,left:60,bottom:60},children:[t.jsx(ce,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),t.jsx(de,{dataKey:"x",type:"number",name:"Position X",label:{value:"Position X",position:"bottom",offset:10,style:{fill:"var(--text-secondary)"}},domain:A,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:i=>Math.round(i).toString()}),t.jsx(ue,{dataKey:"z",type:"number",name:"Position Z",label:{value:"Position Z",angle:-90,position:"left",offset:20,style:{fill:"var(--text-secondary)"}},domain:R,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:i=>Math.round(i).toString()}),t.jsx(pe,{content:t.jsx(S,{}),cursor:{strokeDasharray:"3 3"}}),t.jsx(ve,{data:b,onClick:i=>C(i),onMouseEnter:i=>x(i),onMouseLeave:()=>x(null),style:{cursor:"pointer"},children:b.map((i,v)=>{const j=r.highlightedPlayer===i.playerName,N=h?.playerName===i.playerName&&h?.gameId===i.gameId,L=i.deathCount>1?7:5,P=L+2;return t.jsx(fe,{fill:j?"var(--accent-primary)":w(i.deathType),stroke:j||N?"white":i.deathCount>1?"var(--accent-secondary)":"none",strokeWidth:j?3:N?2:i.deathCount>1?1:0,opacity:j?1:.7,r:j?P:N?L+1:L},`cell-${v}`)})})]})})}):t.jsx("div",{style:{padding:"2rem 0",display:"flex",justifyContent:"center"},children:t.jsx(He,{deathLocations:o,xDomain:A,zDomain:R,width:800,height:600,bandwidth:25,onRegionClick:i=>{if(i.length===1)s({selectedGame:i[0].gameId,fromComponent:"Death Location View (Heatmap)"});else{const v=i.map(j=>j.gameId).filter(j=>j);s({selectedGameIds:v,fromComponent:"Death Location View (Heatmap)"})}}})})}):t.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[t.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1rem"},children:"Aucune localisation de mort disponible pour les filtres sÃ©lectionnÃ©s"}),t.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes (non-legacy)."})]}),o.length>0&&t.jsxs("div",{style:{marginTop:"2rem",padding:"1rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[t.jsx("h3",{style:{marginBottom:"1rem",color:"var(--text-primary)"},children:"LÃ©gende des types de mort"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem"},children:c.map(i=>{const v=o.filter(j=>j.deathType===i).length;return v===0?null:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.9rem"},children:[t.jsx("div",{style:{width:"16px",height:"16px",borderRadius:"50%",backgroundColor:u[i],flexShrink:0}}),t.jsxs("span",{style:{color:"var(--text-primary)"},children:[H(i)," (",v,")"]})]},i)})})]}),t.jsxs("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:[t.jsx("p",{children:t.jsx("strong",{children:"Ã€ propos de cette visualisation :"})}),t.jsxs("ul",{style:{marginTop:"0.5rem",paddingLeft:"1.5rem"},children:[t.jsx("li",{children:"Les positions sont basÃ©es sur les coordonnÃ©es X et Z (vue 2D de la carte)"}),z==="scatter"?t.jsxs(t.Fragment,{children:[t.jsx("li",{children:"Chaque point reprÃ©sente la mort d'un joueur Ã  un endroit prÃ©cis"}),t.jsx("li",{children:"La couleur indique le type de mort (voir lÃ©gende ci-dessus)"}),t.jsxs("li",{children:["Les joueurs en surbrillance sont affichÃ©s en "," ",t.jsx("span",{style:{color:"var(--accent-primary)",fontWeight:"bold"},children:"couleur primaire"})]}),t.jsx("li",{children:"Cliquez sur un point pour voir les dÃ©tails de la partie"}),t.jsx("li",{children:"Survolez un point pour voir les informations dÃ©taillÃ©es"})]}):t.jsxs(t.Fragment,{children:[t.jsx("li",{children:"La carte de chaleur montre les zones de forte densitÃ© de morts (du jaune au rouge)"}),t.jsx("li",{children:"Les points noirs indiquent l'emplacement exact de chaque mort"}),t.jsx("li",{children:"Les zones rouges indiquent une concentration Ã©levÃ©e de morts"}),t.jsx("li",{children:"Cliquez sur une zone pour voir les dÃ©tails des parties associÃ©es"}),t.jsx("li",{children:'Utilisez le mode "Points" pour voir les dÃ©tails individuels par type de mort'})]})]}),t.jsx("p",{style:{marginTop:"0.5rem",fontStyle:"italic",color:"var(--text-secondary)"},children:"Note : Seules les parties rÃ©centes contiennent des donnÃ©es de position. Les parties legacy sont exclues."})]})]}):t.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function et({deathLocations:e,xDomain:c,zDomain:u,width:s=800,height:r=600,bandwidth:d=25,onRegionClick:f}){const g=E.useRef(null),p=E.useRef(null),l=E.useRef(null),a=E.useMemo(()=>Y().domain(c).range([0,s]),[c,s]),y=E.useMemo(()=>Y().domain(u).range([r,0]),[u,r]),h=E.useMemo(()=>e.length===0?[]:te().x(n=>a(n.x)).y(n=>y(n.z)).size([s,r]).bandwidth(d).thresholds(15)(e),[e,a,y,s,r,d]),x=E.useMemo(()=>{const m=h.length>0?Math.max(...h.map(n=>n.value)):1;return n=>{const o=n/m;return re(o)}},[h]);E.useEffect(()=>{const m=g.current;if(!m||h.length===0)return;const n=m.getContext("2d");n&&(n.clearRect(0,0,s,r),h.forEach(o=>{n.fillStyle=x(o.value),n.globalAlpha=.6,o.coordinates.forEach(M=>{M.forEach(b=>{n.beginPath(),b.forEach((S,C)=>{C===0?n.moveTo(S[0],S[1]):n.lineTo(S[0],S[1])}),n.closePath(),n.fill()})})}),n.globalAlpha=1)},[h,s,r,x]),E.useEffect(()=>{const m=p.current;if(!m||e.length===0)return;const n=m.getContext("2d");n&&(n.clearRect(0,0,s,r),e.forEach(o=>{const M=a(o.x),b=y(o.z);n.beginPath(),n.arc(M,b,2,0,2*Math.PI),n.fillStyle="rgba(0, 0, 0, 0.3)",n.fill(),n.strokeStyle="rgba(255, 255, 255, 0.5)",n.lineWidth=.5,n.stroke()}))},[e,a,y,s,r]);const z=m=>{if(!f||!l.current)return;const n=l.current.getBoundingClientRect(),o=m.clientX-n.left,M=m.clientY-n.top,b=30,S=e.filter(C=>{const w=a(C.x),A=y(C.z);return Math.sqrt(Math.pow(w-o,2)+Math.pow(A-M,2))<=b});S.length>0&&f(S)},k=m=>{if(!l.current)return;const n=l.current.getBoundingClientRect(),o=m.clientX-n.left,M=m.clientY-n.top,b=20,S=e.filter(C=>{const w=a(C.x),A=y(C.z);return Math.sqrt(Math.pow(w-o,2)+Math.pow(A-M,2))<=b});l.current&&(l.current.style.cursor=S.length>0?"pointer":"default")};return t.jsxs("div",{ref:l,style:{position:"relative",width:`${s}px`,height:`${r}px`,margin:"0 auto"},onClick:z,onMouseMove:k,children:[t.jsx("canvas",{ref:g,width:s,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),t.jsx("canvas",{ref:p,width:s,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),t.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),t.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),t.jsxs("svg",{width:s,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(m=>{const n=s*m,o=c[0]+(c[1]-c[0])*m;return t.jsxs("g",{children:[t.jsx("line",{x1:n,y1:r,x2:n,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:n,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(o)})]},`x-${m}`)}),[0,.25,.5,.75,1].map(m=>{const n=r*(1-m),o=u[0]+(u[1]-u[0])*m;return t.jsxs("g",{children:[t.jsx("line",{x1:0,y1:n,x2:5,y2:n,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:10,y:n,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(o)})]},`z-${m}`)})]})]})}function tt(){const{navigationState:e,updateNavigationState:c}=J(),[u,s]=E.useState(e.deathLocationState?.selectedCamp||"Tous les camps"),{data:r}=se(),{data:d}=Q(),f=ie();E.useEffect(()=>{(!e.deathLocationState||e.deathLocationState.selectedCamp!==u)&&c({deathLocationState:{selectedCamp:u}})},[u,e.deathLocationState,c]);const g=E.useMemo(()=>d?ae(d):[],[d]),p=E.useMemo(()=>{const a={};g.forEach(x=>{x===I.BY_WOLF?a[x]=f.Loup:x===I.VOTED?a[x]="var(--chart-color-1)":x===I.BULLET||x===I.BULLET_HUMAN||x===I.BULLET_WOLF?a[x]=f.Chasseur:x===I.BY_ZOMBIE?a[x]=f.Vaudou:x===I.ASSASSIN?a[x]=f.Alchimiste:x===I.AVENGER?a[x]="var(--chart-color-2)":x===I.LOVER_DEATH?a[x]=f.Amoureux:x===I.BY_BEAST?a[x]="var(--chart-color-3)":x===I.SHERIF_SUCCESS&&(a[x]="var(--chart-color-4)")});const y=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let h=0;return g.forEach(x=>{a[x]||(a[x]=y[h%y.length],h++)}),a},[g,f]),l=a=>{s(a),c({deathLocationState:{selectedCamp:a}})};return t.jsxs("div",{className:"lycans-general-stats",children:[t.jsx("h2",{children:"ðŸ—ºï¸ Carte de Chaleur des Morts"}),t.jsx("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),t.jsxs("select",{id:"camp-select",value:u,onChange:a=>l(a.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[t.jsx("option",{value:"Tous les camps",children:"Tous les camps"},"tous"),r?.filter(a=>a!=="Tous les camps").map(a=>t.jsx("option",{value:a,children:a},a))]})]})}),t.jsx(Ve,{selectedCamp:u,availableDeathTypes:g,deathTypeColors:p})]})}export{tt as DeathLocationHeatmap,et as DeathLocationHeatmapCanvas};
