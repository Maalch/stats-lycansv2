import{r as g,u as L,j as e}from"./index-BtOt8ZXX.js";import{u as R}from"./useRawGameData-CGaXdtqz.js";import{a as f}from"./api-beq3FXpM.js";import{F as T,R as C,T as b}from"./FullscreenChart-C1mPfNF2.js";import{B as N,C as V,X as S,Y as k,a as w}from"./BarChart-DZ-Xa8gc.js";import{L as F}from"./Legend-DUx4MYkv.js";function B(){const{data:a,isLoading:y,error:x}=R();return{victoryTypesStats:g.useMemo(()=>{if(!a||a.length===0)return null;const l={},d={};let h=0;a.forEach(i=>{const r=i["Type de victoire"],n=i["Camp victorieux"];r&&r.trim()!==""&&n&&n.trim()!==""&&(h++,l[r]||(l[r]=0),l[r]++,d[r]||(d[r]={}),d[r][n]||(d[r][n]=0),d[r][n]++)});const t=new Set;Object.values(d).forEach(i=>{Object.keys(i).forEach(r=>t.add(r))});const s=Object.keys(l).map(i=>{const r={type:i,count:l[i],percentage:(l[i]/h*100).toFixed(1)},n=d[i]||{};return t.forEach(p=>{const j=n[p]||0,G=l[i]>0?(j/l[i]*100).toFixed(1):"0.0";r[p]=j,r[`${p}_percentage`]=G}),r});s.sort((i,r)=>r.count-i.count);const c=Array.from(t).sort();return{totalGames:h,victoryTypes:s,winningCamps:c}},[a]),isLoading:y,errorInfo:x}}function M(){const{victoryTypesStats:a,isLoading:y,errorInfo:x}=B(),{navigateToGameDetails:v}=L(),m=g.useMemo(()=>a?.victoryTypes?a.victoryTypes.map(t=>({...t,percentageNum:parseFloat(t.percentage)})):[],[a?.victoryTypes]),{mainVictoryTypes:u,rareVictoryTypes:l}=g.useMemo(()=>{if(!m.length)return{mainVictoryTypes:[],rareVictoryTypes:[]};const t=Math.max(5,Math.ceil(m[0].count*.1)),s=m.filter(o=>o.count>=t),c=m.filter(o=>o.count<t);return{mainVictoryTypes:s,rareVictoryTypes:c}},[m]),d=y,h=x;return d?e.jsx("div",{className:"donnees-attente",children:"Chargement des types de victoire..."}):h?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",h]}):a?e.jsxs("div",{className:"lycans-victory-types-container",children:[e.jsx("h2",{children:"Types de Victoire"}),a&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Types Principaux"}),e.jsx("div",{className:"lycans-valeur-principale",children:u.length}),e.jsx("p",{children:"types fréquents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Types Spéciaux"}),e.jsx("div",{className:"lycans-valeur-principale",children:l.length}),e.jsx("p",{children:"types rares"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:a?.totalGames||0}),e.jsx("p",{children:"parties analysées"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[u.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Victoire Principaux par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Types de victoire les plus fréquents (",u.reduce((t,s)=>t+s.count,0)," parties sur ",a?.totalGames,")"]}),e.jsx(T,{title:"Types de Victoire Principaux par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(N,{data:u,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(S,{dataKey:"type",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:11}),e.jsx(k,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(b,{content:({active:t,payload:s,label:c})=>{if(t&&s&&s.length>0){const o=s.reduce((r,n)=>r+(n.value||0),0);let i="";return a?.totalGames&&o>0&&(i=(o/a.totalGames*100).toFixed(1)),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:300},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8},children:c}),e.jsxs("div",{style:{marginBottom:4},children:["Total: ",o," parties",i&&` (${i}%)`]}),s.filter(r=>r.value&&r.value>0).sort((r,n)=>(n.value||0)-(r.value||0)).map((r,n)=>{const p=o>0?((r.value||0)/o*100).toFixed(1):"0.0";return e.jsxs("div",{style:{marginBottom:2},children:[e.jsx("span",{style:{display:"inline-block",width:12,height:12,backgroundColor:r.color,marginRight:8,borderRadius:2}}),r.dataKey,": ",r.value," (",p,"%)"]},n)}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(F,{}),a?.winningCamps?.map((t,s)=>e.jsx(w,{dataKey:t,stackId:"victory",fill:f[t]||`var(--chart-color-${s%6+1})`,name:t,onClick:c=>{c&&c.type&&v({selectedVictoryType:c.type,fromComponent:"Types de Victoire Principaux"})},style:{cursor:"pointer"}},t))]})})})})]}),l.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Victoire Spéciaux par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Types de victoire moins fréquents (",l.reduce((t,s)=>t+s.count,0)," parties sur ",a?.totalGames,")"]}),e.jsx(T,{title:"Types de Victoire Spéciaux par Camp",children:e.jsx("div",{style:{height:500},children:e.jsx(C,{width:"100%",height:"100%",children:e.jsxs(N,{data:l,margin:{top:20,right:30,left:20,bottom:120},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(S,{dataKey:"type",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:10}),e.jsx(k,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"},domain:[0,"dataMax"]}),e.jsx(b,{content:({active:t,payload:s,label:c})=>{if(t&&s&&s.length>0){const o=s.reduce((r,n)=>r+(n.value||0),0);let i="";return a?.totalGames&&o>0&&(i=(o/a.totalGames*100).toFixed(1)),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:300},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8},children:c}),e.jsxs("div",{style:{marginBottom:4},children:["Total: ",o," parties",i&&` (${i}%)`]}),s.filter(r=>r.value&&r.value>0).sort((r,n)=>(n.value||0)-(r.value||0)).map((r,n)=>{const p=o>0?((r.value||0)/o*100).toFixed(1):"0.0";return e.jsxs("div",{style:{marginBottom:2},children:[e.jsx("span",{style:{display:"inline-block",width:12,height:12,backgroundColor:r.color,marginRight:8,borderRadius:2}}),r.dataKey,": ",r.value," (",p,"%)"]},n)}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(F,{}),a?.winningCamps?.map((t,s)=>e.jsx(w,{dataKey:t,stackId:"victory",fill:f[t]||`var(--chart-color-${s%6+1})`,name:t,onClick:c=>{c&&c.type&&v({selectedVictoryType:c.type,fromComponent:"Types de Victoire Spéciaux"})},style:{cursor:"pointer"}},t))]})})})})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de victoire disponible"})}export{M as VictoryTypesChart};
