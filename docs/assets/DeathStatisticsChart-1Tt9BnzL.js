import{u as O,r as M,a as w,j as e}from"./index-DUf69Ux8.js";import{u as V}from"./baseStatsHook-CGXTt5xz.js";import{g as B}from"./gameUtils-C0qLdSzT.js";import{F as E,B as G,C as H,X as W,Y as R,a as F,b as L}from"./FullscreenChart-Bnt4cGo5.js";import{u as $}from"./api-Vz0b6-ow.js";import{R as I,T as q}from"./CategoricalChart-CjSTxuol.js";function J(h){const l=new Set;h.forEach(c=>{c.PlayerStats.forEach(u=>{if(c.PlayerStats.some(x=>x.KillerName===u.Username)){const x=B(u.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupTraitor:!0});l.add(x)}})});const o=Array.from(l),m=["Villageois","Loup","Amoureux"];return[...m.filter(c=>o.includes(c)),...o.filter(c=>!m.includes(c)).sort()]}function U(h){if(!h)return null;const l=h.match(/^([NJM])(\d+)$/);if(!l)return null;const[,o,m]=l,p=parseInt(m,10);let c;switch(o){case"N":c="Nuit";break;case"J":c="Jour";break;case"M":c="Meeting";break;default:return null}return{phase:c,day:p,originalString:h}}function Y(h){if(!h)return"Survivant";const l=h.trim();return l.includes("vote")||l.includes("Vote")?"Mort aux votes":l.includes("Loup")||l.includes("loup")?"Tué par Loup":l.includes("Zombie")||l.includes("zombie")?"Tué par Zombie":l.includes("Chasseur")||l.includes("chasseur")?"Tué par Chasseur":l.includes("Déco")||l.includes("déco")?"Déconnexion":l.includes("Potion")||l.includes("potion")?"Tué par Potion":l}function X(h,l){return h.PlayerStats.filter(o=>o.DeathTiming||o.DeathType).map(o=>{let m=null;if(o.KillerName){const p=h.PlayerStats.find(c=>c.Username===o.KillerName);p&&(m=B(p.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupTraitor:!0}))}return{playerName:o.Username,deathTiming:U(o.DeathTiming),deathType:Y(o.DeathType),killerName:o.KillerName,killerCamp:m}}).filter(o=>!l||l==="Tous les camps"?!0:o.killerCamp===l)}function Z(h,l){if(h.length===0)return null;const o=[],m={},p=new Set;h.forEach(t=>{const a=X(t,l);a.length>0&&p.add(t.Id),a.forEach(i=>{o.push({...i,gameId:t.Id})}),t.PlayerStats.forEach(i=>{const g=i.Username;(!l||l==="Tous les camps"||B(i.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupTraitor:!0})===l)&&(m[g]=(m[g]||0)+1)})});const c=o.length,u=h.length,N=p.size,x=u>0?c/u:0,n={},P={Nuit:0,Jour:0,Meeting:0};o.forEach(t=>{if(t.deathTiming){const a=`${t.deathTiming.phase}-${t.deathTiming.day}`;n[a]=(n[a]||0)+1,P[t.deathTiming.phase]++}});const y=Object.entries(n).map(([t,a])=>{const[i,g]=t.split("-");return{phase:i,day:parseInt(g,10),count:a,percentage:c>0?a/c*100:0}}).sort((t,a)=>{if(t.phase!==a.phase){const i={Nuit:0,Jour:1,Meeting:2};return i[t.phase]-i[a.phase]}return t.day-a.day}),T={};o.forEach(t=>{T[t.deathType]=(T[t.deathType]||0)+1});const D=Object.entries(T).map(([t,a])=>({type:t,count:a,percentage:c>0?a/c*100:0})).sort((t,a)=>a.count-t.count),v={};o.forEach(t=>{t.killerName&&(v[t.killerName]||(v[t.killerName]={kills:0,victims:new Set}),v[t.killerName].kills++,v[t.killerName].victims.add(t.playerName))});const f=Object.entries(v).map(([t,a])=>{const i=m[t]||0,g=i>0?a.kills/i:0;return{killerName:t,kills:a.kills,victims:Array.from(a.victims),percentage:c>0?a.kills/c*100:0,gamesPlayed:i,averageKillsPerGame:g}}).sort((t,a)=>a.kills-t.kills),S={};o.forEach(t=>{S[t.playerName]||(S[t.playerName]={totalDeaths:0,deathsByPhase:{Nuit:0,Jour:0,Meeting:0},deathsByType:{},killedBy:{},deathDays:[]});const a=S[t.playerName];a.totalDeaths++,t.deathTiming&&(a.deathsByPhase[t.deathTiming.phase]++,a.deathDays.push(t.deathTiming.day)),a.deathsByType[t.deathType]=(a.deathsByType[t.deathType]||0)+1,t.killerName&&(a.killedBy[t.killerName]=(a.killedBy[t.killerName]||0)+1)});const b=Object.entries(S).map(([t,a])=>({playerName:t,totalDeaths:a.totalDeaths,deathsByPhase:a.deathsByPhase,deathsByType:a.deathsByType,killedBy:a.killedBy,averageDeathDay:a.deathDays.length>0?a.deathDays.reduce((i,g)=>i+g,0)/a.deathDays.length:null,deathRate:m[t]>0?a.totalDeaths/m[t]:0})).sort((t,a)=>a.totalDeaths-t.totalDeaths),A=Object.entries(P).reduce((t,[a,i])=>i>t.count?{phase:a,count:i}:t,{phase:"Nuit",count:0}).phase,k={};o.forEach(t=>{t.deathTiming&&(k[t.deathTiming.day]=(k[t.deathTiming.day]||0)+1)});const C=Object.entries(k).reduce((t,[a,i])=>i>t.count?{day:parseInt(a,10),count:i}:t,{day:1,count:0}).day,r=D.length>0?D[0].type:"",d=f.length>0?f[0].killerName:null;return{totalDeaths:c,totalGames:u,gamesWithDeaths:N,averageDeathsPerGame:x,deathsByTiming:y,deathsByPhase:P,deathsByType:D,killerStats:f,playerDeathStats:b,mostDeadlyPhase:A,mostDeadlyDay:C,mostCommonDeathType:r,mostDeadlyKiller:d}}function Q(h){return V(l=>Z(l,h))}function _(){return V(h=>J(h))}function le(){const{navigateToGameDetails:h,navigationState:l,updateNavigationState:o}=O(),[m,p]=M.useState(l.deathStatsSelectedCamp||"Tous les camps"),{data:c}=_(),{data:u,isLoading:N,error:x}=Q(m),{settings:n}=w(),[P,y]=M.useState(null),T=$(),D=r=>{p(r),o({deathStatsSelectedCamp:r})},{totalKillsData:v,averageKillsData:f,highlightedPlayerAddedToTotal:S,highlightedPlayerAddedToAverage:b,gamesWithKillers:A}=M.useMemo(()=>{if(!u)return{totalKillsData:[],averageKillsData:[],highlightedPlayerAddedToTotal:!1,highlightedPlayerAddedToAverage:!1,gamesWithKillers:0};const r=u.killerStats.sort((s,j)=>j.kills-s.kills).slice(0,20),d=n.highlightedPlayer&&r.some(s=>s.killerName===n.highlightedPlayer),t=r.map(s=>({name:s.killerName,value:s.kills,victims:s.victims.length,percentage:s.percentage,gamesPlayed:s.gamesPlayed,averageKillsPerGame:s.averageKillsPerGame,isHighlightedAddition:!1}));let a=!1;if(n.highlightedPlayer&&!d){const s=u.killerStats.find(j=>j.killerName===n.highlightedPlayer);s&&(t.push({name:s.killerName,value:s.kills,victims:s.victims.length,percentage:s.percentage,gamesPlayed:s.gamesPlayed,averageKillsPerGame:s.averageKillsPerGame,isHighlightedAddition:!0}),a=!0)}const i=u.killerStats.sort((s,j)=>j.averageKillsPerGame-s.averageKillsPerGame).slice(0,20),g=n.highlightedPlayer&&i.some(s=>s.killerName===n.highlightedPlayer),K=i.map(s=>({name:s.killerName,value:s.averageKillsPerGame,victims:s.victims.length,percentage:s.percentage,gamesPlayed:s.gamesPlayed,averageKillsPerGame:s.averageKillsPerGame,isHighlightedAddition:!1}));let z=!1;if(n.highlightedPlayer&&!g){const s=u.killerStats.find(j=>j.killerName===n.highlightedPlayer);s&&(K.push({name:s.killerName,value:s.averageKillsPerGame,victims:s.victims.length,percentage:s.percentage,gamesPlayed:s.gamesPlayed,averageKillsPerGame:s.averageKillsPerGame,isHighlightedAddition:!0}),z=!0)}return{totalKillsData:t,averageKillsData:K,highlightedPlayerAddedToTotal:a,highlightedPlayerAddedToAverage:z,gamesWithKillers:u.gamesWithDeaths}},[u,n.highlightedPlayer]);if(N)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de mort..."});if(x)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",x]});if(!u)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de mort disponible"});const k=({active:r,payload:d,label:t})=>{if(r&&d&&d.length){const a=d[0].payload,i=a.isHighlightedAddition,g=n.highlightedPlayer===a.name;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:g?"var(--accent-primary)":"var(--text-primary)"},children:[t,i&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (🎯)"})]}),e.jsxs("p",{style:{color:"var(--accent-secondary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Victimes totales:"})," ",a.value]}),e.jsxs("p",{style:{color:"var(--accent-tertiary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouées:"})," ",a.gamesPlayed]}),e.jsxs("p",{style:{color:"var(--chart-color-5)",margin:"4px 0"},children:[e.jsx("strong",{children:"Victimes uniques:"})," ",a.victims]}),e.jsxs("p",{style:{color:"var(--chart-color-2)",margin:"4px 0"},children:[e.jsx("strong",{children:"Moyenne par partie:"})," ",a.averageKillsPerGame.toFixed(2)]}),i&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection personnelle"}),g&&!i&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null},C=({active:r,payload:d,label:t})=>{if(r&&d&&d.length){const a=d[0].payload,i=a.isHighlightedAddition,g=n.highlightedPlayer===a.name;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px",padding:"12px",boxShadow:"0 4px 12px rgba(0,0,0,0.15)",color:"var(--text-primary)",fontSize:"0.9rem"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:"8px",color:g?"var(--accent-primary)":"var(--text-primary)"},children:[t,i&&e.jsx("span",{style:{color:"var(--accent-primary)",fontSize:"0.8rem",fontStyle:"italic",marginLeft:"4px"},children:" (🎯)"})]}),e.jsxs("p",{style:{color:"var(--accent-secondary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Moyenne par partie:"})," ",a.value.toFixed(2)]}),e.jsxs("p",{style:{color:"var(--accent-tertiary)",margin:"4px 0"},children:[e.jsx("strong",{children:"Parties jouées:"})," ",a.gamesPlayed]}),e.jsxs("p",{style:{color:"var(--chart-color-5)",margin:"4px 0"},children:[e.jsx("strong",{children:"Victimes uniques:"})," ",a.victims]}),e.jsxs("p",{style:{color:"var(--chart-color-2)",margin:"4px 0"},children:[e.jsx("strong",{children:"Victimes totales:"})," ",Math.round(a.averageKillsPerGame*a.gamesPlayed)]}),i&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection personnelle"}),g&&!i&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null};return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques de Tueurs (VERSION PROTOTYPE)"}),e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp du tueur :"}),e.jsxs("select",{id:"camp-select",value:m,onChange:r=>D(r.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),c?.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total des morts"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)"},children:u.totalDeaths})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Tueurs identifiés"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-1)"},children:u.killerStats.length})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Nombre de parties enregistrées"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary)"},children:A})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Top Tueurs (Total)"}),S&&n.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['🎯 "',n.highlightedPlayer,'" affiché en plus du top 20']})]}),e.jsx(E,{title:"Top Tueurs (Total)",children:e.jsx("div",{style:{height:400},children:e.jsx(I,{width:"100%",height:"100%",children:e.jsxs(G,{data:v,margin:{top:20,right:30,left:20,bottom:10},onMouseEnter:()=>{},onMouseLeave:()=>y(null),children:[e.jsx(H,{strokeDasharray:"3 3"}),e.jsx(W,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:r,y:d,payload:t})=>e.jsx("text",{x:r,y:d,dy:16,textAnchor:"end",fill:n.highlightedPlayer===t.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:n.highlightedPlayer===t.value?14:13,fontWeight:n.highlightedPlayer===t.value?"bold":"italic",transform:`rotate(-45 ${r} ${d})`,children:t.value})}),e.jsx(R,{label:{value:"Nombre total de victimes",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(q,{content:e.jsx(k,{})}),e.jsx(F,{dataKey:"value",name:"Victimes",onMouseEnter:r=>y(r?.name||null),children:v.map(r=>{const d=n.highlightedPlayer===r.name,t=P===r.name,a=r.isHighlightedAddition;return e.jsx(L,{fill:T[r.name]||"#e53e3e",stroke:d?"var(--accent-primary)":t?"var(--text-primary)":"none",strokeWidth:d?3:t?2:0,strokeDasharray:a?"5,5":"none",opacity:a?.8:1,onClick:()=>{const i={selectedPlayer:r.name,fromComponent:"Statistiques de Mort"};m!=="Tous les camps"&&(i.campFilter={selectedCamp:m,campFilterMode:"all-assignments"}),h(i)},onMouseEnter:()=>y(r.name),onMouseLeave:()=>y(null),style:{cursor:"pointer"}},`cell-total-${r.name}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(20,v.filter(r=>!r.isHighlightedAddition).length)," des tueurs les plus actifs (total)"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Top Tueurs (Moyenne par Partie)"}),b&&n.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['🎯 "',n.highlightedPlayer,'" affiché en plus du top 20']})]}),e.jsx(E,{title:"Top Tueurs (Moyenne par Partie)",children:e.jsx("div",{style:{height:400},children:e.jsx(I,{width:"100%",height:"100%",children:e.jsxs(G,{data:f,margin:{top:20,right:30,left:20,bottom:10},onMouseEnter:()=>{},onMouseLeave:()=>y(null),children:[e.jsx(H,{strokeDasharray:"3 3"}),e.jsx(W,{dataKey:"name",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:r,y:d,payload:t})=>e.jsx("text",{x:r,y:d,dy:16,textAnchor:"end",fill:n.highlightedPlayer===t.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:n.highlightedPlayer===t.value?14:13,fontWeight:n.highlightedPlayer===t.value?"bold":"italic",transform:`rotate(-45 ${r} ${d})`,children:t.value})}),e.jsx(R,{label:{value:"Moyenne de victimes par partie",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(q,{content:e.jsx(C,{})}),e.jsx(F,{dataKey:"value",name:"Moyenne",onMouseEnter:r=>y(r?.name||null),children:f.map(r=>{const d=n.highlightedPlayer===r.name,t=P===r.name,a=r.isHighlightedAddition;return e.jsx(L,{fill:T[r.name]||"#8884d8",stroke:d?"var(--accent-primary)":t?"var(--text-primary)":"none",strokeWidth:d?3:t?2:0,strokeDasharray:a?"5,5":"none",opacity:a?.8:1,onClick:()=>{const i={selectedPlayer:r.name,fromComponent:"Statistiques de Mort"};m!=="Tous les camps"&&(i.campFilter={selectedCamp:m,campFilterMode:"all-assignments"}),h(i)},onMouseEnter:()=>y(r.name),onMouseLeave:()=>y(null),style:{cursor:"pointer"}},`cell-average-${r.name}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",Math.min(20,f.filter(r=>!r.isHighlightedAddition).length)," des tueurs les plus efficaces (moyenne)"]})]})]}),e.jsx("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note : "}),"Les morts lors de votes aux conseils ne sont pas comptabilisées ici. ","Données en cours de récupération (données partielles)."]})})]})}export{le as DeathStatisticsChart};
