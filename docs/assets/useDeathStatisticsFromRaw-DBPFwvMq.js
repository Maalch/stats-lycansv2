import{u as N}from"./baseStatsHook-C4tTIrrj.js";import{g as B,a as P}from"./datasyncExport-BirWLS1z.js";import{i as k,D as e}from"./deathTypes-gHH1w6_X.js";import{e as K}from"./api-t3AbXwJt.js";import{g as L,f as O}from"./index-9DrA1pQo.js";const v=["Chasseur","Alchimiste","Protecteur","Disciple","Inquisiteur"],U=["Chasseur","Alchimiste"];function _(r){return r.MainRoleInitial==="Villageois Élite"?r.Power||null:U.includes(r.MainRoleInitial)?r.MainRoleInitial:null}function M(r,o){return o==="Tous les camps"?!0:v.includes(o)?_(r)===o:B(r.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===o}function C(r){return r?r===e.SURVIVALIST_NOT_SAVED?e.BY_WOLF:r:e.UNKNOWN}function b(r){const o=new Set;r.forEach(a=>{a.PlayerStats.forEach(t=>{const n=B(t.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});o.add(n)})});const i=Array.from(o);return[...K.filter(a=>i.includes(a)),...i.filter(a=>!K.includes(a)).sort()]}function z(r){switch(r){case e.VOTED:return"Mort aux votes";case e.BY_WOLF:case e.SURVIVALIST_NOT_SAVED:return"Kill en Loup";case e.BY_ZOMBIE:return"Kill en Zombie";case e.BY_BEAST:return"Kill en Bête";case e.BY_AVATAR_CHAIN:return"Mort d'Avatar";case e.BULLET:return"Tir de Chasseur";case e.BULLET_HUMAN:return"Kill de Chasseur (sur humain)";case e.BULLET_WOLF:return"Kill de Chasseur (sur loup)";case e.SHERIF_SUCCESS:return"Kill de Shérif";case e.OTHER_AGENT:return"Kill d'Agent";case e.AVENGER:return"Kill de Vengeur";case e.SEER:return"Kill de Devin";case e.HANTED:return"Kill avec Potion hantée";case e.ASSASSIN:return"Kill avec Potion (Assassin)";case e.LOVER_DEATH:return"Kill d'amoureux";case e.BOMB:return"Explosion";case e.CRUSHED:return"Écrasement";case e.STARVATION:return"Famine";case e.STARVATION_AS_BEAST:return"Tuerie bestiale";case e.FALL:return"Chute mortelle";case e.UNKNOWN:return"Kill inconnu";case e.SMUGGLER_HUNT_KILL:return"Kill sur Contrebandier";default:return""}}function q(r){const o=new Set;r.forEach(a=>{a.PlayerStats.forEach(t=>{if(t.DeathType&&k(t.DeathType)){const n=C(t.DeathType);n&&o.add(n)}})});const i=Array.from(o),m=[e.BY_WOLF,e.VOTED,e.BULLET,e.BULLET_HUMAN,e.BULLET_WOLF,e.BY_ZOMBIE,e.ASSASSIN,e.AVENGER,e.LOVER_DEATH,e.SHERIF_SUCCESS];return[...m.filter(a=>i.includes(a)),...i.filter(a=>!m.includes(a)).sort()]}function H(r,o){return r.PlayerStats.filter(i=>i.DeathType&&k(i.DeathType)&&(i.DeathTiming||i.DeathType)).map(i=>{let m=null,a=null;if(i.KillerName){const t=r.PlayerStats.find(n=>n.Username===i.KillerName);if(t){a=L(t);const n=P(t.MainRoleInitial,t.MainRoleChanges||[]);m=B(n,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1}),n&&n!==t.MainRoleInitial&&(n==="Loup"?m="Loup":n==="Zombie"&&(m="Vaudou"))}}return{playerId:L(i),playerName:i.Username,deathType:C(i.DeathType),killerId:a,killerName:i.KillerName,killerCamp:m}}).filter(i=>{if(!o||o==="Tous les camps")return!0;const m=r.PlayerStats.find(a=>a.Username===i.playerName);return m?M(m,o):!1})}function G(r,o,i){const m=[];r.PlayerStats.forEach(t=>{if(t.KillerName&&t.DeathType){if(t.DeathType===e.VOTED||t.DeathType===e.STARVATION||t.DeathType===e.FALL||t.DeathType===e.BY_AVATAR_CHAIN)return;const n=r.PlayerStats.find(c=>c.Username===t.KillerName);if(!n)return;let E=B(n.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});const R=P(n.MainRoleInitial,n.MainRoleChanges||[]);R&&R!==n.MainRoleInitial&&(R==="Loup"?E="Loup":R==="Zombie"&&(E="Vaudou"));const d=B(t.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0});m.push({killerId:L(n),killerName:n.Username,victimId:L(t),victimName:t.Username,deathType:C(t.DeathType),killerCamp:E,killerPower:_(n),victimCamp:d})}});let a=m;return o&&o!=="Tous les camps"&&(v.includes(o)?a=a.filter(t=>t.killerPower===o):a=a.filter(t=>t.killerCamp===o)),i&&i!=="Tous les camps"&&(a=a.filter(t=>i==="Roles solo"?t.victimCamp!=="Villageois"&&t.victimCamp!=="Loup":t.victimCamp===i)),a}function W(r,o,i){if(r.length===0||r.length===0)return null;const m=[],a={},t={};r.forEach(l=>{H(l,o).forEach(s=>{m.push({...s,gameId:l.Id})}),l.PlayerStats.forEach(s=>{const g=L(s),I=s.Username;t[g]=I,(!o||o==="Tous les camps"||M(s,o))&&(a[g]=(a[g]||0)+1)})});const n=m.length,E=r.length,R=E>0?n/E:0,d={};m.forEach(l=>{d[l.deathType]=(d[l.deathType]||0)+1});const c=Object.entries(d).map(([l,u])=>({type:l,count:u||0,percentage:n>0?(u||0)/n*100:0})).sort((l,u)=>u.count-l.count),h={};r.forEach(l=>{G(l,o,i).forEach(s=>{t[s.killerId]=s.killerName,t[s.victimId]=s.victimName,h[s.killerId]||(h[s.killerId]={kills:0,victims:new Set,killsByDeathType:{}}),h[s.killerId].kills++,h[s.killerId].victims.add(s.victimId),h[s.killerId].killsByDeathType[s.deathType]=(h[s.killerId].killsByDeathType[s.deathType]||0)+1})});const y=Object.entries(h).map(([l,u])=>{const s=a[l]||0,g=s>0?u.kills/s:0;return{killerName:t[l]||l,kills:u.kills,victims:Array.from(u.victims).map(I=>t[I]||I),percentage:n>0?u.kills/n*100:0,gamesPlayed:s,averageKillsPerGame:g,killsByDeathType:u.killsByDeathType}}).sort((l,u)=>u.kills-l.kills),T={};m.forEach(l=>{T[l.playerId]||(T[l.playerId]={totalDeaths:0,deathsByType:{},killedById:{},deathDays:[]});const u=T[l.playerId];u.totalDeaths++,u.deathsByType[l.deathType]=(u.deathsByType[l.deathType]||0)+1,l.killerId&&(u.killedById[l.killerId]=(u.killedById[l.killerId]||0)+1)});const p=[];Object.entries(T).forEach(([l,u])=>{const s=t[l]||l,g={};Object.entries(u.killedById).forEach(([I,A])=>{const V=t[I]||I;g[V]=(g[V]||0)+A}),p.push({playerName:s,totalDeaths:u.totalDeaths,deathsByType:u.deathsByType,killedBy:g,deathRate:a[l]>0?u.totalDeaths/a[l]:0,gamesPlayed:a[l]||0})}),Object.entries(a).forEach(([l,u])=>{T[l]||p.push({playerName:t[l]||l,totalDeaths:0,deathsByType:{},killedBy:{},deathRate:0,gamesPlayed:u})});const f=p.sort((l,u)=>u.totalDeaths-l.totalDeaths),S=c.length>0?c[0].type:null,D=y.length>0?y[0].killerName:null;return{totalDeaths:n,totalGames:E,averageDeathsPerGame:R,deathsByType:c,killerStats:y,playerDeathStats:f,mostCommonDeathType:S,mostDeadlyKiller:D}}function w(r,o){const i={},m={},a=r.length,t=[e.BULLET,e.BULLET_HUMAN,e.BULLET_WOLF];r.forEach(d=>{const c=new Set;d.PlayerStats.forEach(h=>{const y=h.MainRoleInitial,T=P(h.MainRoleInitial,h.MainRoleChanges||[]);if(y==="Chasseur"||T==="Chasseur"||y==="Villageois Élite"&&h.Power==="Chasseur"){const f=L(h);m[f]=h.Username,c.add(f),i[f]||(i[f]={kills:[],gamesPlayed:0,victimsCamps:[],gameVersions:[],gameModded:[]}),i[f].gamesPlayed++}}),d.PlayerStats.forEach(h=>{const y=h.DeathType,T=h.KillerName,p=T?d.PlayerStats.find(S=>S.Username===T):null,f=p?L(p):null;if(f&&p&&(m[f]=p.Username),y&&t.includes(y)&&f&&c.has(f)){const S=B(h.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});i[f].kills.push(y),i[f].victimsCamps.push(S),i[f].gameVersions.push(d.Version),i[f].gameModded.push(d.Modded)}})});const n=Object.entries(i).map(([d,c])=>{const h=c.kills.length,y={};c.kills.forEach(s=>{y[s]=(y[s]||0)+1});const T={};c.victimsCamps.forEach(s=>{T[s]=(T[s]||0)+1});let p=0,f=0;const S={},D={};c.victimsCamps.forEach((s,g)=>{const I=c.gameVersions[g],A=c.gameModded[g];s==="Idiot du Village"?A&&O(I,"0.202")?(f++,D[s]=(D[s]||0)+1):(p++,S[s]=(S[s]||0)+1):s==="Villageois"?(f++,D[s]=(D[s]||0)+1):(p++,S[s]=(S[s]||0)+1)});const l=c.gamesPlayed>0?h/c.gamesPlayed:0,u=c.gamesPlayed>0?p/c.gamesPlayed:0;return{hunterName:m[d]||d,totalKills:h,nonVillageoisKills:p,villageoisKills:f,gamesPlayedAsHunter:c.gamesPlayed,averageKillsPerGame:l,averageNonVillageoisKillsPerGame:u,killsByDeathType:y,victimsByCamp:T,goodVictimsByCamp:S,badVictimsByCamp:D}}).sort((d,c)=>c.totalKills-d.totalKills),E=n.length>0?n[0].hunterName:null,R=n.length>0?n.sort((d,c)=>c.averageNonVillageoisKillsPerGame-d.averageNonVillageoisKillsPerGame)[0].hunterName:null;return{totalHunters:n.length,totalGames:a,hunterStats:n,bestHunter:E,bestAverageHunter:R}}function J(r,o){return N(i=>W(i,r,o))}function Q(){return N(r=>b(r))}function X(r){return N(o=>w(o))}export{J as a,X as b,q as c,z as g,Q as u};
