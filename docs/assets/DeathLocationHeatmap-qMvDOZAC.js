import{r as M,j as t,u as ie,a as me,e as le}from"./index-DFS0-ZAP.js";import{u as he,c as xe}from"./useDeathStatisticsFromRaw-DSra7nvT.js";import{g as J,D as L}from"./datasyncExport-D6_8Fmuy.js";import{a as pe}from"./api-DhJD1NPo.js";import{c as ge,r as ve,F as ye,C as be,X as je,Y as Me,a as Se}from"./FullscreenChart-voaCllTT.js";import{g as q}from"./deathTypes-CGUOTngO.js";import{ak as ze,w as Ee,al as Ce,am as Ae,an as we,H as Pe,u as Q,ao as ee,L as Re,c as ke,s as De,ap as Ie,aq as Ne,ar as $,as as Le,at as ce,au as te,av as Oe,aw as G,R as We,T as Te}from"./CategoricalChart-ClSyxGrx.js";import{S as Be,a as Ve}from"./ScatterChart-D4YJxoyN.js";import"./baseStatsHook-C8n5HKRb.js";const Fe=Xe(He);function Xe(e){return function(n,o,a=o){if(!((o=+o)>=0))throw new RangeError("invalid rx");if(!((a=+a)>=0))throw new RangeError("invalid ry");let{data:r,width:s,height:d}=n;if(!((s=Math.floor(s))>=0))throw new RangeError("invalid width");if(!((d=Math.floor(d!==void 0?d:r.length/s))>=0))throw new RangeError("invalid height");if(!s||!d||!o&&!a)return n;const y=o&&e(o),p=a&&e(a),l=r.slice();return y&&p?(F(y,l,r,s,d),F(y,r,l,s,d),F(y,l,r,s,d),X(p,r,l,s,d),X(p,l,r,s,d),X(p,r,l,s,d)):y?(F(y,r,l,s,d),F(y,l,r,s,d),F(y,r,l,s,d)):p&&(X(p,r,l,s,d),X(p,l,r,s,d),X(p,r,l,s,d)),n}}function F(e,n,o,a,r){for(let s=0,d=a*r;s<d;)e(n,o,s,s+=a,1)}function X(e,n,o,a,r){for(let s=0,d=a*r;s<a;++s)e(n,o,s,s+d,a)}function He(e){const n=Math.floor(e);if(n===e)return qe(e);const o=e-n,a=2*e+1;return(r,s,d,y,p)=>{if(!((y-=p)>=d))return;let l=n*s[d];const i=p*n,g=i+p;for(let h=d,x=d+i;h<x;h+=p)l+=s[Math.min(y,h)];for(let h=d,x=y;h<=x;h+=p)l+=s[Math.min(y,h+i)],r[h]=(l+o*(s[Math.max(d,h-g)]+s[Math.min(y,h+g)]))/a,l-=s[Math.max(d,h-i)]}}function qe(e){const n=2*e+1;return(o,a,r,s,d)=>{if(!((s-=d)>=r))return;let y=e*a[r];const p=d*e;for(let l=r,i=r+p;l<i;l+=d)y+=a[Math.min(s,l)];for(let l=r,i=s;l<=i;l+=d)y+=a[Math.min(s,l+p)],o[l]=y/n,y-=a[Math.max(r,l-p)]}}function Ye(e,n){let o=0;for(let a of e)a!=null&&(a=+a)>=a&&++o;return o}function $e(e,n){let o,a;if(n===void 0)for(const r of e)r!=null&&(o===void 0?r>=r&&(o=a=r):(o>r&&(o=r),a<r&&(a=r)));else{let r=-1;for(let s of e)(s=n(s,++r,e))!=null&&(o===void 0?s>=s&&(o=a=s):(o>s&&(o=s),a<s&&(a=s)))}return[o,a]}function Ge(e,n,o){let a;for(;;){const r=ze(e,n,o);if(r===a||r===0||!isFinite(r))return[e,n];r>0?(e=Math.floor(e/r)*r,n=Math.ceil(n/r)*r):r<0&&(e=Math.ceil(e*r)/r,n=Math.floor(n*r)/r),a=r}}function Ze(e){return Math.max(1,Math.ceil(Math.log(Ye(e))/Math.LN2)+1)}function re(e,n){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),o.push.apply(o,a)}return o}function ne(e){for(var n=1;n<arguments.length;n++){var o=arguments[n]!=null?arguments[n]:{};n%2?re(Object(o),!0).forEach(function(a){K(e,a,o[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):re(Object(o)).forEach(function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(o,a))})}return e}function K(e,n,o){return(n=Ue(n))in e?Object.defineProperty(e,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[n]=o,e}function Ue(e){var n=Ke(e,"string");return typeof n=="symbol"?n:n+""}function Ke(e,n){if(typeof e!="object"||!e)return e;var o=e[Symbol.toPrimitive];if(o!==void 0){var a=o.call(e,n);if(typeof a!="object")return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function U(){return U=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var a in o)({}).hasOwnProperty.call(o,a)&&(e[a]=o[a])}return e},U.apply(null,arguments)}var _e=(e,n,o,a,r,s,d)=>{var{x1:y,x2:p,y1:l,y2:i}=d;if(r==null||s==null)return null;var g=ge({x:r,y:s}),h={x:e?g.x.apply(y,{position:"start"}):g.x.rangeMin,y:o?g.y.apply(l,{position:"start"}):g.y.rangeMin},x={x:n?g.x.apply(p,{position:"end"}):g.x.rangeMax,y:a?g.y.apply(i,{position:"end"}):g.y.rangeMax};return d.ifOverflow==="discard"&&(!g.isInRange(h)||!g.isInRange(x))?null:ve(h,x)},Je=(e,n)=>{var o;return M.isValidElement(e)?o=M.cloneElement(e,n):typeof e=="function"?o=e(n):o=M.createElement(Le,U({},n,{className:"recharts-reference-area-rect"})),o};function Qe(e){var n=Ee();return M.useEffect(()=>(n(Ce(e)),()=>{n(Ae(e))})),null}function et(e){var{x1:n,x2:o,y1:a,y2:r,className:s,shape:d,xAxisId:y,yAxisId:p}=e,l=we(),i=Pe(),g=Q(c=>ee(c,"xAxis",y,i)),h=Q(c=>ee(c,"yAxis",p,i));if(g==null||!h==null)return null;var x=$(n),b=$(o),w=$(a),z=$(r);if(!x&&!b&&!w&&!z&&!d)return null;var m=_e(x,b,w,z,g,h,e);if(!m&&!d)return null;var u=e.ifOverflow==="hidden",v=u?"url(#".concat(l,")"):void 0;return M.createElement(Re,{className:ke("recharts-reference-area",s)},Je(d,ne(ne({clipPath:v},De(e)),m)),M.createElement(Ie,m,M.createElement(Ne,{label:e.label}),e.children))}function tt(e){return M.createElement(M.Fragment,null,M.createElement(Qe,{yAxisId:e.yAxisId,xAxisId:e.xAxisId,ifOverflow:e.ifOverflow,x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2}),M.createElement(et,e))}class _ extends M.Component{render(){return M.createElement(tt,this.props)}}K(_,"displayName","ReferenceArea");K(_,"defaultProps",{ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});var rt=Array.prototype,ue=rt.slice;function nt(e,n){return e-n}function at(e){for(var n=0,o=e.length,a=e[o-1][1]*e[0][0]-e[o-1][0]*e[0][1];++n<o;)a+=e[n-1][1]*e[n][0]-e[n-1][0]*e[n][1];return a}const W=e=>()=>e;function ot(e,n){for(var o=-1,a=n.length,r;++o<a;)if(r=st(e,n[o]))return r;return 0}function st(e,n){for(var o=n[0],a=n[1],r=-1,s=0,d=e.length,y=d-1;s<d;y=s++){var p=e[s],l=p[0],i=p[1],g=e[y],h=g[0],x=g[1];if(it(p,g,n))return 0;i>a!=x>a&&o<(h-l)*(a-i)/(x-i)+l&&(r=-r)}return r}function it(e,n,o){var a;return lt(e,n,o)&&ct(e[a=+(e[0]===n[0])],o[a],n[a])}function lt(e,n,o){return(n[0]-e[0])*(o[1]-e[1])===(o[0]-e[0])*(n[1]-e[1])}function ct(e,n,o){return e<=n&&n<=o||o<=n&&n<=e}function ut(){}var O=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function ae(){var e=1,n=1,o=Ze,a=p;function r(l){var i=o(l);if(Array.isArray(i))i=i.slice().sort(nt);else{const g=$e(l,dt);for(i=ce(...Ge(g[0],g[1],i),i);i[i.length-1]>=g[1];)i.pop();for(;i[1]<g[0];)i.shift()}return i.map(g=>s(l,g))}function s(l,i){const g=i==null?NaN:+i;if(isNaN(g))throw new Error(`invalid value: ${i}`);var h=[],x=[];return d(l,g,function(b){a(b,l,g),at(b)>0?h.push([b]):x.push(b)}),x.forEach(function(b){for(var w=0,z=h.length,m;w<z;++w)if(ot((m=h[w])[0],b)!==-1){m.push(b);return}}),{type:"MultiPolygon",value:i,coordinates:h}}function d(l,i,g){var h=new Array,x=new Array,b,w,z,m,u,v;for(b=w=-1,m=V(l[0],i),O[m<<1].forEach(c);++b<e-1;)z=m,m=V(l[b+1],i),O[z|m<<1].forEach(c);for(O[m<<0].forEach(c);++w<n-1;){for(b=-1,m=V(l[w*e+e],i),u=V(l[w*e],i),O[m<<1|u<<2].forEach(c);++b<e-1;)z=m,m=V(l[w*e+e+b+1],i),v=u,u=V(l[w*e+b+1],i),O[z|m<<1|u<<2|v<<3].forEach(c);O[m|u<<3].forEach(c)}for(b=-1,u=l[w*e]>=i,O[u<<2].forEach(c);++b<e-1;)v=u,u=V(l[w*e+b+1],i),O[u<<2|v<<3].forEach(c);O[u<<3].forEach(c);function c(S){var P=[S[0][0]+b,S[0][1]+w],R=[S[1][0]+b,S[1][1]+w],E=y(P),k=y(R),A,f;(A=x[E])?(f=h[k])?(delete x[A.end],delete h[f.start],A===f?(A.ring.push(R),g(A.ring)):h[A.start]=x[f.end]={start:A.start,end:f.end,ring:A.ring.concat(f.ring)}):(delete x[A.end],A.ring.push(R),x[A.end=k]=A):(A=h[k])?(f=x[E])?(delete h[A.start],delete x[f.end],A===f?(A.ring.push(R),g(A.ring)):h[f.start]=x[A.end]={start:f.start,end:A.end,ring:f.ring.concat(A.ring)}):(delete h[A.start],A.ring.unshift(P),h[A.start=E]=A):h[E]=x[k]={start:E,end:k,ring:[P,R]}}}function y(l){return l[0]*2+l[1]*(e+1)*4}function p(l,i,g){l.forEach(function(h){var x=h[0],b=h[1],w=x|0,z=b|0,m=Z(i[z*e+w]);x>0&&x<e&&w===x&&(h[0]=oe(x,Z(i[z*e+w-1]),m,g)),b>0&&b<n&&z===b&&(h[1]=oe(b,Z(i[(z-1)*e+w]),m,g))})}return r.contour=s,r.size=function(l){if(!arguments.length)return[e,n];var i=Math.floor(l[0]),g=Math.floor(l[1]);if(!(i>=0&&g>=0))throw new Error("invalid size");return e=i,n=g,r},r.thresholds=function(l){return arguments.length?(o=typeof l=="function"?l:Array.isArray(l)?W(ue.call(l)):W(l),r):o},r.smooth=function(l){return arguments.length?(a=l?p:ut,r):a===p},r}function dt(e){return isFinite(e)?e:NaN}function V(e,n){return e==null?!1:+e>=n}function Z(e){return e==null||isNaN(e=+e)?-1/0:e}function oe(e,n,o,a){const r=a-n,s=o-n,d=isFinite(r)||isFinite(s)?r/s:Math.sign(r)/Math.sign(s);return isNaN(d)?e:e+d-.5}function ft(e){return e[0]}function mt(e){return e[1]}function ht(){return 1}function de(){var e=ft,n=mt,o=ht,a=960,r=500,s=20,d=2,y=s*3,p=a+y*2>>d,l=r+y*2>>d,i=W(20);function g(u){var v=new Float32Array(p*l),c=Math.pow(2,-d),S=-1;for(const j of u){var P=(e(j,++S,u)+y)*c,R=(n(j,S,u)+y)*c,E=+o(j,S,u);if(E&&P>=0&&P<p&&R>=0&&R<l){var k=Math.floor(P),A=Math.floor(R),f=P-k-.5,C=R-A-.5;v[k+A*p]+=(1-f)*(1-C)*E,v[k+1+A*p]+=f*(1-C)*E,v[k+1+(A+1)*p]+=f*C*E,v[k+(A+1)*p]+=(1-f)*C*E}}return Fe({data:v,width:p,height:l},s*c),v}function h(u){var v=g(u),c=i(v),S=Math.pow(2,2*d);return Array.isArray(c)||(c=ce(Number.MIN_VALUE,te(v)/S,c)),ae().size([p,l]).thresholds(c.map(P=>P*S))(v).map((P,R)=>(P.value=+c[R],x(P)))}h.contours=function(u){var v=g(u),c=ae().size([p,l]),S=Math.pow(2,2*d),P=R=>{R=+R;var E=x(c.contour(v,R*S));return E.value=R,E};return Object.defineProperty(P,"max",{get:()=>te(v)/S}),P};function x(u){return u.coordinates.forEach(b),u}function b(u){u.forEach(w)}function w(u){u.forEach(z)}function z(u){u[0]=u[0]*Math.pow(2,d)-y,u[1]=u[1]*Math.pow(2,d)-y}function m(){return y=s*3,p=a+y*2>>d,l=r+y*2>>d,h}return h.x=function(u){return arguments.length?(e=typeof u=="function"?u:W(+u),h):e},h.y=function(u){return arguments.length?(n=typeof u=="function"?u:W(+u),h):n},h.weight=function(u){return arguments.length?(o=typeof u=="function"?u:W(+u),h):o},h.size=function(u){if(!arguments.length)return[a,r];var v=+u[0],c=+u[1];if(!(v>=0&&c>=0))throw new Error("invalid size");return a=v,r=c,m()},h.cellSize=function(u){if(!arguments.length)return 1<<d;if(!((u=+u)>=1))throw new Error("invalid cell size");return d=Math.floor(Math.log(u)/Math.LN2),m()},h.thresholds=function(u){return arguments.length?(i=typeof u=="function"?u:Array.isArray(u)?W(ue.call(u)):W(u),h):i},h.bandwidth=function(u){if(!arguments.length)return Math.sqrt(s*(s+1));if(!((u=+u)>=0))throw new Error("invalid bandwidth");return s=(Math.sqrt(4*u*u+1)-1)/2,m()},h}function xt(e){for(var n=e.length/6|0,o=new Array(n),a=0;a<n;)o[a]="#"+e.slice(a*6,++a*6);return o}const pt=e=>Oe(e[e.length-1]);var gt=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(xt);const fe=pt(gt),vt={Village:{src:"/Village.webp",zMin:-820,zMax:820,xMin:-461,xMax:461},ChÃ¢teau:{src:"/ChÃ¢teau.webp",zMin:-820,zMax:820,xMin:-461,xMax:461}};function yt(e){return vt[e]||null}function bt(e){return e==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":e}function se(e,n){const o=[],a={x:166.35,z:176.22,multiplier:5.45},r={x:403.32,z:-121.11,multiplier:18.4};return e.forEach(s=>{s.PlayerStats.filter(d=>d.DeathPosition!==null).filter(d=>!n||n==="Tous les camps"?!0:J(d.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0})===n).forEach(d=>{if(d.DeathPosition){const y=J(d.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0});let p=d.DeathPosition.x,l=d.DeathPosition.z;s.MapName==="Village"?(p=(p-a.x)*a.multiplier,l=(l-a.z)*a.multiplier*-1):s.MapName==="ChÃ¢teau"&&(p=(p-r.x)*r.multiplier,l=(l-r.z)*r.multiplier*-1),o.push({x:p,z:l,playerName:d.Username,deathType:bt(d.DeathType),mapName:s.MapName,killerName:d.KillerName||null,camp:y,gameId:s.DisplayedId,displayedGameId:s.DisplayedId})}})}),o}function jt(e){const n=new Set;return e.forEach(o=>{o.PlayerStats.some(r=>r.DeathPosition!==null)&&o.MapName&&n.add(o.MapName)}),Array.from(n).sort()}function Mt({deathLocations:e,xDomain:n,zDomain:o,width:a=800,height:r=600,bandwidth:s=25,onRegionClick:d,mapConfig:y}){const p=M.useRef(null),l=M.useRef(null),i=M.useRef(null),g=M.useRef(null),[,h]=M.useState(!1),x=M.useMemo(()=>G().domain(o).range([0,a]),[o,a]),b=M.useMemo(()=>G().domain(n).range([r,0]),[n,r]),w=M.useMemo(()=>e.length===0?[]:de().x(c=>x(c.z)).y(c=>b(c.x)).size([a,r]).bandwidth(s).thresholds(15)(e),[e,b,x,a,r,s]),z=M.useMemo(()=>{const v=w.length>0?Math.max(...w.map(c=>c.value)):1;return c=>{const S=c/v;return fe(S)}},[w]);M.useEffect(()=>{const v=i.current;if(!v||!y){h(!1);return}const c=v.getContext("2d");if(!c)return;c.clearRect(0,0,a,r);const S=new Image;S.onload=()=>{c.globalAlpha=.85,c.drawImage(S,0,0,a,r),c.globalAlpha=1,h(!0)},S.onerror=()=>{h(!1)},S.src=y.src},[y,a,r]),M.useEffect(()=>{const v=p.current;if(!v||w.length===0)return;const c=v.getContext("2d");c&&(c.clearRect(0,0,a,r),w.forEach(S=>{c.fillStyle=z(S.value),c.globalAlpha=.6,S.coordinates.forEach(P=>{P.forEach(R=>{c.beginPath(),R.forEach((E,k)=>{k===0?c.moveTo(E[0],E[1]):c.lineTo(E[0],E[1])}),c.closePath(),c.fill()})})}),c.globalAlpha=1)},[w,a,r,z]),M.useEffect(()=>{const v=l.current;if(!v||e.length===0)return;const c=v.getContext("2d");c&&(c.clearRect(0,0,a,r),e.forEach(S=>{const P=x(S.z),R=b(S.x);c.beginPath(),c.arc(P,R,2,0,2*Math.PI),c.fillStyle="rgba(0, 0, 0, 0.3)",c.fill(),c.strokeStyle="rgba(255, 255, 255, 0.5)",c.lineWidth=.5,c.stroke()}))},[e,b,x,a,r]);const m=v=>{if(!d||!g.current)return;const c=g.current.getBoundingClientRect(),S=v.clientX-c.left,P=v.clientY-c.top,R=30,E=e.filter(k=>{const A=x(k.z),f=b(k.x);return Math.sqrt(Math.pow(A-S,2)+Math.pow(f-P,2))<=R});E.length>0&&d(E)},u=v=>{if(!g.current)return;const c=g.current.getBoundingClientRect(),S=v.clientX-c.left,P=v.clientY-c.top,R=20,E=e.filter(k=>{const A=x(k.z),f=b(k.x);return Math.sqrt(Math.pow(A-S,2)+Math.pow(f-P,2))<=R});g.current&&(g.current.style.cursor=E.length>0?"pointer":"default")};return t.jsxs("div",{ref:g,style:{position:"relative",width:`${a}px`,height:`${r}px`,margin:"0 auto"},onClick:m,onMouseMove:u,children:[t.jsx("canvas",{ref:i,width:a,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),t.jsx("canvas",{ref:p,width:a,height:r,style:{position:"absolute",top:0,left:0,borderRadius:"4px",pointerEvents:"none"}}),t.jsx("canvas",{ref:l,width:a,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),t.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),t.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),t.jsxs("svg",{width:a,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(v=>{const c=a*v,S=o[0]+(o[1]-o[0])*v;return t.jsxs("g",{children:[t.jsx("line",{x1:c,y1:r,x2:c,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:c,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(S)})]},`z-${v}`)}),[0,.25,.5,.75,1].map(v=>{const c=r*(1-v),S=n[0]+(n[1]-n[0])*v;return t.jsxs("g",{children:[t.jsx("line",{x1:0,y1:c,x2:5,y2:c,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:10,y:c,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(S)})]},`x-${v}`)})]})]})}function St({selectedCamp:e,availableDeathTypes:n,deathTypeColors:o}){const{navigateToGameDetails:a}=ie(),{settings:r}=me(),{data:s,isLoading:d,error:y}=le(),[p,l]=M.useState(""),[i,g]=M.useState("all"),[h,x]=M.useState(null),[b,w]=M.useState("scatter"),z=M.useMemo(()=>{if(!s)return[];const f=jt(s),C=se(s,e),j=new Map;return C.forEach(D=>{j.set(D.mapName,(j.get(D.mapName)||0)+1)}),f.sort((D,I)=>{const T=j.get(D)||0;return(j.get(I)||0)-T})},[s,e]),m=z.length>0?z[0]:"";p===""&&m!==""&&l(m);const u=M.useMemo(()=>{if(!s)return[];let f=se(s,e);return p&&(f=f.filter(C=>C.mapName===p)),i!=="all"&&(f=f.filter(C=>C.deathType===i)),f},[s,e,p,i]),v=M.useMemo(()=>{const f=new Map;return u.forEach(C=>{const j=`${Math.round(C.x)}_${Math.round(C.z)}`;f.has(j)||f.set(j,[]),f.get(j).push(C)}),f},[u]),c=M.useMemo(()=>Array.from(v.entries()).map(([f,C])=>({...C[0],deathCount:C.length,allDeaths:C,locationKey:f})),[v]),S=({active:f,payload:C})=>{if(!f||!C||C.length===0)return null;const j=C[0].payload,D=`${Math.round(j.x)}_${Math.round(j.z)}`,I=v.get(D)||[j];if(I.length>1){const B=new Map,H=new Set;return I.forEach(N=>{const Y=N.deathType?q(N.deathType):"Inconnu";B.set(Y,(B.get(Y)||0)+1),H.add(N.gameId)}),t.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[t.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:[I.length," morts Ã  cet endroit"]}),t.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[t.jsxs("div",{style:{marginBottom:"8px"},children:[t.jsx("strong",{children:"Position:"})," (",Math.round(j.x),", ",Math.round(j.z),")"]}),t.jsxs("div",{style:{marginBottom:"8px"},children:[t.jsx("strong",{children:"Types de mort:"}),t.jsx("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:Array.from(B.entries()).map(([N,Y])=>t.jsxs("li",{children:[N," (",Y,")"]},N))})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Parties:"})," ",Array.from(H).filter(N=>N).map(N=>`#${N}`).join(", ")]})]}),t.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir une des parties"})]})}return t.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[t.jsx("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:j.playerName}),t.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Camp:"})," ",j.camp]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Type de mort:"})," ",j.deathType?q(j.deathType):"Inconnu"]}),j.killerName&&t.jsxs("div",{children:[t.jsx("strong",{children:"TuÃ© par:"})," ",j.killerName]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Carte:"})," ",j.mapName]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Partie:"})," #",j.gameId]}),t.jsxs("div",{style:{marginTop:"4px",fontSize:"0.85rem",color:"var(--text-secondary)"},children:["Position: (",Math.round(j.x),", ",Math.round(j.z),")"]})]}),t.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})},P=f=>{if(!f)return;const C=f.allDeaths||[f];if(C.length===1)a({selectedGame:C[0].gameId,fromComponent:"Death Location View"});else{const j=C.map(D=>D.gameId).filter(D=>D);a({selectedGameIds:j,fromComponent:"Death Location View"})}},R=f=>f&&o[f]||"var(--text-secondary)",E=M.useMemo(()=>yt(p),[p]),{xDomain:k,zDomain:A}=M.useMemo(()=>{if(E)return{xDomain:[E.xMin,E.xMax],zDomain:[E.zMin,E.zMax]};if(c.length===0)return{xDomain:[0,100],zDomain:[0,100]};const f=c.map(N=>N.x),C=c.map(N=>N.z),j=Math.min(...f),D=Math.max(...f),I=Math.min(...C),T=Math.max(...C),B=(D-j)*.1||10,H=(T-I)*.1||10;return{xDomain:[j-B,D+B],zDomain:[I-H,T+H]}},[c,E]);return d?t.jsx("div",{className:"donnees-attente",children:"Chargement des localisations de mort..."}):y?t.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",y]}):s?t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Mode :"}),t.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[t.jsx("button",{onClick:()=>w("scatter"),style:{background:b==="scatter"?"var(--accent-primary)":"transparent",color:b==="scatter"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:b==="scatter"?"bold":"normal",transition:"all 0.2s"},children:"Points"}),t.jsx("button",{onClick:()=>w("heatmap"),style:{background:b==="heatmap"?"var(--accent-primary)":"transparent",color:b==="heatmap"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:b==="heatmap"?"bold":"normal",transition:"all 0.2s"},children:"Carte de chaleur"})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),t.jsx("select",{id:"map-select",value:p,onChange:f=>l(f.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:z.map(f=>t.jsx("option",{value:f,children:f},f))})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"death-type-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Type de mort :"}),t.jsxs("select",{id:"death-type-select",value:i,onChange:f=>g(f.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[t.jsx("option",{value:"all",children:"Tous les types"}),n.map(f=>t.jsx("option",{value:f,children:q(f)},f))]})]})]}),t.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Morts localisÃ©es"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary)"},children:u.length})]}),t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Camp filtrÃ©"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)",fontSize:"1.2rem"},children:e})]}),t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Type de mort"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-2)",fontSize:"1.2rem"},children:i==="all"?"Tous":q(i)})]})]}),u.length>0?t.jsx(ye,{title:b==="scatter"?"Carte des Morts":"Carte de Chaleur des Morts",children:b==="scatter"?t.jsx("div",{style:{height:600,width:800},children:t.jsx(We,{width:"100%",height:"100%",children:t.jsxs(Be,{margin:{top:20,right:30,left:60,bottom:60},children:[E&&t.jsx(_,{x1:E.zMin,x2:E.zMax,y1:E.xMin,y2:E.xMax,fill:"transparent",stroke:"none",shape:f=>{const{x:C,y:j,width:D,height:I}=f;return t.jsx("image",{x:C,y:j,width:D,height:I,href:E.src,preserveAspectRatio:"none",style:{opacity:.85}})}}),t.jsx(be,{strokeDasharray:"3 3",stroke:E?"rgba(255,255,255,0.3)":"var(--border-color)"}),t.jsx(je,{dataKey:"z",type:"number",name:"Position Z",label:{value:"Position Z",position:"bottom",offset:10,style:{fill:"var(--text-secondary)"}},domain:A,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:f=>Math.round(f).toString()}),t.jsx(Me,{dataKey:"x",type:"number",name:"Position X",label:{value:"Position X",angle:-90,position:"left",offset:20,style:{fill:"var(--text-secondary)"}},domain:k,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:f=>Math.round(f).toString()}),t.jsx(Te,{content:t.jsx(S,{}),cursor:{strokeDasharray:"3 3"}}),t.jsx(Ve,{data:c,onClick:f=>P(f),onMouseEnter:f=>x(f),onMouseLeave:()=>x(null),style:{cursor:"pointer"},children:c.map((f,C)=>{const j=r.highlightedPlayer===f.playerName,D=h?.playerName===f.playerName&&h?.gameId===f.gameId,I=f.deathCount>1?7:5,T=I+2;return t.jsx(Se,{fill:j?"var(--accent-primary)":R(f.deathType),stroke:j||D?"white":f.deathCount>1?"var(--accent-secondary)":"none",strokeWidth:j?3:D?2:f.deathCount>1?1:0,opacity:j?1:.7,r:j?T:D?I+1:I},`cell-${C}`)})})]})})}):t.jsx("div",{style:{padding:"2rem 0",display:"flex",justifyContent:"center"},children:t.jsx(Mt,{deathLocations:u,xDomain:k,zDomain:A,width:800,height:600,bandwidth:25,mapConfig:E,onRegionClick:f=>{if(f.length===1)a({selectedGame:f[0].gameId,fromComponent:"Death Location View (Heatmap)"});else{const C=f.map(j=>j.gameId).filter(j=>j);a({selectedGameIds:C,fromComponent:"Death Location View (Heatmap)"})}}})})}):t.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[t.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1rem"},children:"Aucune localisation de mort disponible pour les filtres sÃ©lectionnÃ©s"}),t.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes (non-legacy)."})]}),u.length>0&&t.jsxs("div",{style:{marginTop:"2rem",padding:"1rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[t.jsx("h3",{style:{marginBottom:"1rem",color:"var(--text-primary)"},children:"LÃ©gende des types de mort"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem"},children:n.map(f=>{const C=u.filter(j=>j.deathType===f).length;return C===0?null:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.9rem"},children:[t.jsx("div",{style:{width:"16px",height:"16px",borderRadius:"50%",backgroundColor:o[f],flexShrink:0}}),t.jsxs("span",{style:{color:"var(--text-primary)"},children:[q(f)," (",C,")"]})]},f)})})]}),t.jsxs("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:[t.jsx("p",{children:t.jsx("strong",{children:"Ã€ propos de cette visualisation :"})}),t.jsxs("ul",{style:{marginTop:"0.5rem",paddingLeft:"1.5rem"},children:[t.jsx("li",{children:"Les positions sont basÃ©es sur les coordonnÃ©es Z (horizontal) et X (vertical) - vue 2D de la carte"}),b==="scatter"?t.jsxs(t.Fragment,{children:[t.jsx("li",{children:"Chaque point reprÃ©sente la mort d'un joueur Ã  un endroit prÃ©cis"}),t.jsx("li",{children:"La couleur indique le type de mort (voir lÃ©gende ci-dessus)"}),t.jsxs("li",{children:["Les joueurs en surbrillance sont affichÃ©s en "," ",t.jsx("span",{style:{color:"var(--accent-primary)",fontWeight:"bold"},children:"couleur primaire"})]}),t.jsx("li",{children:"Cliquez sur un point pour voir les dÃ©tails de la partie"}),t.jsx("li",{children:"Survolez un point pour voir les informations dÃ©taillÃ©es"})]}):t.jsxs(t.Fragment,{children:[t.jsx("li",{children:"La carte de chaleur montre les zones de forte densitÃ© de morts (du jaune au rouge)"}),t.jsx("li",{children:"Les points noirs indiquent l'emplacement exact de chaque mort"}),t.jsx("li",{children:"Les zones rouges indiquent une concentration Ã©levÃ©e de morts"}),t.jsx("li",{children:"Cliquez sur une zone pour voir les dÃ©tails des parties associÃ©es"}),t.jsx("li",{children:'Utilisez le mode "Points" pour voir les dÃ©tails individuels par type de mort'})]})]}),t.jsx("p",{style:{marginTop:"0.5rem",fontStyle:"italic",color:"var(--text-secondary)"},children:"Note : Seules les parties rÃ©centes contiennent des donnÃ©es de position. Les parties legacy sont exclues."})]})]}):t.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function It({deathLocations:e,xDomain:n,zDomain:o,width:a=800,height:r=600,bandwidth:s=25,onRegionClick:d}){const y=M.useRef(null),p=M.useRef(null),l=M.useRef(null),i=M.useMemo(()=>G().domain(n).range([0,a]),[n,a]),g=M.useMemo(()=>G().domain(o).range([r,0]),[o,r]),h=M.useMemo(()=>e.length===0?[]:de().x(m=>i(m.x)).y(m=>g(m.z)).size([a,r]).bandwidth(s).thresholds(15)(e),[e,i,g,a,r,s]),x=M.useMemo(()=>{const z=h.length>0?Math.max(...h.map(m=>m.value)):1;return m=>{const u=m/z;return fe(u)}},[h]);M.useEffect(()=>{const z=y.current;if(!z||h.length===0)return;const m=z.getContext("2d");m&&(m.clearRect(0,0,a,r),h.forEach(u=>{m.fillStyle=x(u.value),m.globalAlpha=.6,u.coordinates.forEach(v=>{v.forEach(c=>{m.beginPath(),c.forEach((S,P)=>{P===0?m.moveTo(S[0],S[1]):m.lineTo(S[0],S[1])}),m.closePath(),m.fill()})})}),m.globalAlpha=1)},[h,a,r,x]),M.useEffect(()=>{const z=p.current;if(!z||e.length===0)return;const m=z.getContext("2d");m&&(m.clearRect(0,0,a,r),e.forEach(u=>{const v=i(u.x),c=g(u.z);m.beginPath(),m.arc(v,c,2,0,2*Math.PI),m.fillStyle="rgba(0, 0, 0, 0.3)",m.fill(),m.strokeStyle="rgba(255, 255, 255, 0.5)",m.lineWidth=.5,m.stroke()}))},[e,i,g,a,r]);const b=z=>{if(!d||!l.current)return;const m=l.current.getBoundingClientRect(),u=z.clientX-m.left,v=z.clientY-m.top,c=30,S=e.filter(P=>{const R=i(P.x),E=g(P.z);return Math.sqrt(Math.pow(R-u,2)+Math.pow(E-v,2))<=c});S.length>0&&d(S)},w=z=>{if(!l.current)return;const m=l.current.getBoundingClientRect(),u=z.clientX-m.left,v=z.clientY-m.top,c=20,S=e.filter(P=>{const R=i(P.x),E=g(P.z);return Math.sqrt(Math.pow(R-u,2)+Math.pow(E-v,2))<=c});l.current&&(l.current.style.cursor=S.length>0?"pointer":"default")};return t.jsxs("div",{ref:l,style:{position:"relative",width:`${a}px`,height:`${r}px`,margin:"0 auto"},onClick:b,onMouseMove:w,children:[t.jsx("canvas",{ref:y,width:a,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),t.jsx("canvas",{ref:p,width:a,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),t.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),t.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),t.jsxs("svg",{width:a,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(z=>{const m=a*z,u=n[0]+(n[1]-n[0])*z;return t.jsxs("g",{children:[t.jsx("line",{x1:m,y1:r,x2:m,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:m,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(u)})]},`x-${z}`)}),[0,.25,.5,.75,1].map(z=>{const m=r*(1-z),u=o[0]+(o[1]-o[0])*z;return t.jsxs("g",{children:[t.jsx("line",{x1:0,y1:m,x2:5,y2:m,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:10,y:m,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(u)})]},`z-${z}`)})]})]})}function Nt(){const{navigationState:e,updateNavigationState:n}=ie(),[o,a]=M.useState(e.deathLocationState?.selectedCamp||"Tous les camps"),{data:r}=he(),{data:s}=le(),d=pe();M.useEffect(()=>{(!e.deathLocationState||e.deathLocationState.selectedCamp!==o)&&n({deathLocationState:{selectedCamp:o}})},[o,e.deathLocationState,n]);const y=M.useMemo(()=>s?xe(s):[],[s]),p=M.useMemo(()=>{const i={};y.forEach(x=>{x===L.BY_WOLF?i[x]=d.Loup:x===L.VOTED?i[x]="var(--chart-color-1)":x===L.BULLET||x===L.BULLET_HUMAN||x===L.BULLET_WOLF?i[x]=d.Chasseur:x===L.BY_ZOMBIE?i[x]=d.Vaudou:x===L.ASSASSIN?i[x]=d.Alchimiste:x===L.AVENGER?i[x]="var(--chart-color-2)":x===L.LOVER_DEATH?i[x]=d.Amoureux:x===L.BY_BEAST?i[x]="var(--chart-color-3)":x===L.SHERIF_SUCCESS&&(i[x]="var(--chart-color-4)")});const g=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let h=0;return y.forEach(x=>{i[x]||(i[x]=g[h%g.length],h++)}),i},[y,d]),l=i=>{a(i),n({deathLocationState:{selectedCamp:i}})};return t.jsxs("div",{className:"lycans-general-stats",children:[t.jsx("h2",{children:"ðŸ—ºï¸ Carte de Chaleur des Morts"}),t.jsx("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),t.jsxs("select",{id:"camp-select",value:o,onChange:i=>l(i.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[t.jsx("option",{value:"Tous les camps",children:"Tous les camps"},"tous"),r?.filter(i=>i!=="Tous les camps").map(i=>t.jsx("option",{value:i,children:i},i))]})]})}),t.jsx(St,{selectedCamp:o,availableDeathTypes:y,deathTypeColors:p})]})}export{Nt as DeathLocationHeatmap,It as DeathLocationHeatmapCanvas};
