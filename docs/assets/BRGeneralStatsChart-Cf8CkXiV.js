import{a as H,p as k,r as P,j as e}from"./index-BeW-D-Dk.js";import{F as S,B as A,C as B,X as F,Y as T,a as b,b as N}from"./FullscreenChart-iUhNFtye.js";import{u as Z,g as ee}from"./api-OhKOt6KY.js";import{R as D,T as w}from"./CategoricalChart-8_aIjrHL.js";import{P as te,a as ae}from"./PieChart-BTI6kz51.js";import{L as ie}from"./Legend-d_WiSiUc.js";import"./PolarChart-BF5ntwZ4.js";function J(){const[i,g]=P.useState(null),[f,m]=P.useState(null),[x,u]=P.useState(!0),[r,d]=P.useState(null);return P.useEffect(()=>{(async()=>{try{u(!0),d(null);const y=await fetch("/data/rawBRData.json");if(!y.ok)throw new Error("Failed to fetch rawBRData");const R=await y.json();g(R.BRParties?.data||[]),m(R.BRRefParties?.data||[])}catch(y){console.error("Error fetching raw BR data:",y),d(y instanceof Error?y.message:"Unknown error")}finally{u(!1)}})()},[]),{brPartiesData:i,brRefPartiesData:f,isLoading:x,error:r}}function re(){const{settings:i}=H(),{brPartiesData:g,brRefPartiesData:f,isLoading:m,error:x}=J();return{data:g?.filter(r=>{if(!r.Game||!r.Participants)return!1;const d=f?.find(p=>p.Game===r.Game);if(!d)return K(r,i);if(i.filterMode==="gameType"&&i.gameFilter!=="all"){if(i.gameFilter==="modded"){if(!d["Game Modd√©e"])return!1}else if(i.gameFilter==="non-modded"&&d["Game Modd√©e"])return!1}else if(i.filterMode==="dateRange"&&(i.dateRange.start||i.dateRange.end)){const p=k(d.Date);if(!p)return!1;if(i.dateRange.start){const y=new Date(i.dateRange.start);if(p<y)return!1}if(i.dateRange.end){const y=new Date(i.dateRange.end);if(p>y)return!1}}return K(r,i)})||null,isLoading:m,error:x}}function se(){const{settings:i}=H(),{brRefPartiesData:g,isLoading:f,error:m}=J();return{data:g?.filter(u=>{if(!u.Game||!u.Date)return!1;if(i.filterMode==="gameType"&&i.gameFilter!=="all"){if(i.gameFilter==="modded"){if(!u["Game Modd√©e"])return!1}else if(i.gameFilter==="non-modded"&&u["Game Modd√©e"])return!1}else if(i.filterMode==="dateRange"&&(i.dateRange.start||i.dateRange.end)){const r=k(u.Date);if(!r)return!1;if(i.dateRange.start){const d=new Date(i.dateRange.start);if(r<d)return!1}if(i.dateRange.end){const d=new Date(i.dateRange.end);if(r>d)return!1}}return!0})||null,isLoading:f,error:m}}function K(i,g){if(g.playerFilter.mode!=="none"&&g.playerFilter.players.length>0){const f=i.Participants.toLowerCase();if(g.playerFilter.mode==="include"){if(!g.playerFilter.players.some(x=>x.toLowerCase()===f))return!1}else if(g.playerFilter.mode==="exclude"&&g.playerFilter.players.some(x=>x.toLowerCase()===f))return!1}return!0}function fe(){const{data:i,isLoading:g,error:f}=re(),{data:m,isLoading:x,error:u}=se(),{settings:r}=H(),[d,p]=P.useState(null),y=Z(),R=["var(--chart-color-1)","var(--chart-color-2)","var(--chart-color-3)","var(--chart-color-4)","var(--chart-color-5)","var(--chart-color-6)"],L=a=>y[a]||ee(a),c=P.useMemo(()=>{if(!i||!m)return null;const a=m.length,s=i.length,n=i.filter(t=>t.Gagnant).length,h=i.reduce((t,l)=>{const o=l.Participants;return t[o]||(t[o]={name:o,participations:0,wins:0,totalScore:0,averageScore:0,winRate:0}),t[o].participations++,t[o].totalScore+=l.Score,l.Gagnant&&t[o].wins++,t},{});Object.values(h).forEach(t=>{t.averageScore=t.totalScore/t.participations,t.winRate=t.wins/t.participations*100});const v=Object.values(h).sort((t,l)=>l.participations-t.participations),j=v.slice(0,20),$=r.highlightedPlayer&&j.some(t=>t.name===r.highlightedPlayer);let G=!1,C=[...j];if(r.highlightedPlayer&&!$){const t=v.find(l=>l.name===r.highlightedPlayer);t&&(C.push({...t,isHighlightedAddition:!0}),G=!0)}const E=Object.values(h).filter(t=>t.participations>=3).sort((t,l)=>l.winRate-t.winRate).slice(0,20),V=r.highlightedPlayer&&E.some(t=>t.name===r.highlightedPlayer);let z=!1,I=[...E];if(r.highlightedPlayer&&!V){const t=v.find(l=>l.name===r.highlightedPlayer);t&&(I.push({...t,isHighlightedAddition:!0}),z=!0)}const W=Object.values(h).filter(t=>t.participations>=3).sort((t,l)=>l.averageScore-t.averageScore).slice(0,20),X=r.highlightedPlayer&&W.some(t=>t.name===r.highlightedPlayer);let O=!1,q=[...W];if(r.highlightedPlayer&&!X){const t=v.find(l=>l.name===r.highlightedPlayer);t&&(q.push({...t,isHighlightedAddition:!0}),O=!0)}const Y=i.reduce((t,l)=>{const o=l.Score,M=o===0?"0":o===1?"1":o===2?"2":o===3?"3":o===4?"4":o<=6?"5-6":"7+";return t[M]||(t[M]=0),t[M]++,t},{}),U=Object.entries(Y).map(([t,l])=>({range:t,count:l,percentage:(l/s*100).toFixed(1)})),_=m.reduce((t,l)=>{const o=l["Nombre de participants"];return t[o]||(t[o]=0),t[o]++,t},{}),Q=Object.entries(_).map(([t,l])=>({participants:parseInt(t),games:l,percentage:(l/a*100).toFixed(1)})).sort((t,l)=>t.participants-l.participants);return{totalGames:a,totalParticipations:s,totalWins:n,winRate:(n/s*100).toFixed(1),averageParticipantsPerGame:(s/a).toFixed(1),topPlayersByParticipations:C,topPlayersByWins:I,topPlayersByAverageScore:q,scoreData:U,participantData:Q,highlightedPlayerInParticipations:G,highlightedPlayerInWinRate:z,highlightedPlayerInAverageScore:O}},[i,m]);return g||x?e.jsx("div",{className:"statistiques-chargement",children:"Chargement des donn√©es Battle Royale..."}):f||u?e.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",f||u]}):c?e.jsxs("div",{className:"lycans-chart-container",children:[e.jsx("div",{className:"lycans-chart-header",children:e.jsx("h2",{children:"Statistiques Battle Royale"})}),e.jsxs("div",{className:"lycans-stats-grid",children:[e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Parties totales"}),e.jsx("div",{className:"lycans-stat-value",children:c.totalGames})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Participations"}),e.jsx("div",{className:"lycans-stat-value",children:c.totalParticipations})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Moy. participants/partie"}),e.jsx("div",{className:"lycans-stat-value",children:c.averageParticipantsPerGame})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Participations"}),c.highlightedPlayerInParticipations&&r.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--accent-primary)",margin:"0.5rem 0"},children:["üéØ ",r.highlightedPlayer," affich√© en plus du top 20"]}),e.jsx(S,{title:"Top Joueurs par Participations - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(D,{width:"100%",height:400,children:e.jsxs(A,{data:c.topPlayersByParticipations,onMouseEnter:a=>p(a?.activeLabel||null),onMouseLeave:()=>p(null),children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(T,{}),e.jsx(w,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const n=s[0].payload,h=n.isHighlightedAddition,v=r.highlightedPlayer===n.name;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:n.name})}),e.jsxs("div",{children:["Participations : ",n.participations]}),e.jsxs("div",{children:["Victoires : ",n.wins]}),h&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"üéØ Affich√© via s√©lection (hors top 20)"}),v&&!h&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"üéØ Joueur s√©lectionn√©"})]})}return null}}),e.jsx(b,{dataKey:"participations",name:"Participations",children:c.topPlayersByParticipations.map((a,s)=>{const n=a.isHighlightedAddition;return e.jsx(N,{fill:r.highlightedPlayer===a.name?"var(--accent-primary)":n?"var(--accent-secondary)":d===a.name?"var(--accent-hover)":L(a.name)},`cell-${s}`)})}),e.jsx(b,{dataKey:"wins",fill:"var(--chart-color-2)",name:"Victoires"})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Taux de Victoire (min. 3 parties)"}),c.highlightedPlayerInWinRate&&r.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--accent-primary)",margin:"0.5rem 0"},children:["üéØ ",r.highlightedPlayer," affich√© en plus du top 20"]}),e.jsx(S,{title:"Top Joueurs par Taux de Victoire - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(D,{width:"100%",height:400,children:e.jsxs(A,{data:c.topPlayersByWins,onMouseEnter:a=>p(a?.activeLabel||null),onMouseLeave:()=>p(null),children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(T,{}),e.jsx(w,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const n=s[0].payload,h=n.isHighlightedAddition,v=r.highlightedPlayer===n.name,j=n.participations>=3;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:n.name})}),e.jsxs("div",{children:["Taux de victoire : ",n.winRate.toFixed(2),"%"]}),e.jsxs("div",{children:["Victoires : ",n.wins," / ",n.participations]}),h&&!j&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"üéØ Affich√© via s√©lection (< 3 parties)"}),h&&j&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"üéØ Affich√© via s√©lection (hors top 20)"}),v&&!h&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"üéØ Joueur s√©lectionn√©"})]})}return null}}),e.jsx(b,{dataKey:"winRate",name:"Taux de victoire (%)",children:c.topPlayersByWins.map((a,s)=>{const n=a.isHighlightedAddition;return e.jsx(N,{fill:r.highlightedPlayer===a.name?"var(--accent-primary)":n?"var(--accent-secondary)":d===a.name?"var(--accent-hover)":L(a.name)},`cell-${s}`)})})]})})})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Score Moyen par Partie (min. 3 parties)"}),c.highlightedPlayerInAverageScore&&r.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--accent-primary)",margin:"0.5rem 0"},children:["üéØ ",r.highlightedPlayer," affich√© en plus du top 20"]}),e.jsx(S,{title:"Top Joueurs par Score Moyen - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(D,{width:"100%",height:400,children:e.jsxs(A,{data:c.topPlayersByAverageScore,onMouseEnter:a=>p(a?.activeLabel||null),onMouseLeave:()=>p(null),children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(T,{}),e.jsx(w,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const n=s[0].payload,h=n.isHighlightedAddition,v=r.highlightedPlayer===n.name,j=n.participations>=3;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:n.name})}),e.jsxs("div",{children:["Score moyen : ",n.averageScore.toFixed(2)]}),e.jsxs("div",{children:["Score total : ",n.totalScore," / ",n.participations," parties"]}),h&&!j&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"üéØ Affich√© via s√©lection (< 3 parties)"}),h&&j&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"üéØ Affich√© via s√©lection (hors top 20)"}),v&&!h&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"üéØ Joueur s√©lectionn√©"})]})}return null}}),e.jsx(b,{dataKey:"averageScore",name:"Score moyen par partie",children:c.topPlayersByAverageScore.map((a,s)=>{const n=a.isHighlightedAddition;return e.jsx(N,{fill:r.highlightedPlayer===a.name?"var(--accent-primary)":n?"var(--accent-secondary)":d===a.name?"var(--accent-hover)":L(a.name)},`cell-${s}`)})})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Scores"}),e.jsx(S,{title:"Distribution des Scores - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(D,{width:"100%",height:400,children:e.jsxs(te,{children:[e.jsx(ae,{data:c.scoreData,cx:"50%",cy:"50%",labelLine:!1,label:({range:a,percentage:s})=>`${a}: ${s}%`,outerRadius:140,fill:"#8884d8",dataKey:"count",children:c.scoreData.map((a,s)=>e.jsx(N,{fill:R[s%R.length]},`cell-${s}`))}),e.jsx(w,{formatter:a=>[a,"Participations"]})]})})})]})]}),e.jsxs("div",{className:"lycans-chart-section",children:[e.jsx("h3",{children:"R√©partition par Nombre de Participants"}),e.jsx(S,{title:"R√©partition par Nombre de Participants - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(D,{width:"100%",height:400,children:e.jsxs(A,{data:c.participantData,children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"participants"}),e.jsx(T,{}),e.jsx(w,{formatter:(a,s)=>[a,s==="games"?"Parties":s]}),e.jsx(ie,{}),e.jsx(b,{dataKey:"games",fill:"var(--chart-color-4)",name:"Nombre de parties"})]})})})]})]}):e.jsx("div",{className:"statistiques-vide",children:"Aucune donn√©e Battle Royale disponible"})}export{fe as BRGeneralStatsChart};
