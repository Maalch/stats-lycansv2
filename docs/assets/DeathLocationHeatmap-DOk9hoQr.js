import{r as z,j as t,u as de,a as be,e as ue}from"./index-CzZndlXA.js";import{u as je,c as Me}from"./useDeathStatisticsFromRaw-fpAz2Qmi.js";import{g as te,D as V}from"./datasyncExport-D6_8Fmuy.js";import{a as ze}from"./api-D1htb1Jd.js";import{c as Se,r as Ee,F as Ce,C as we,X as Ae,Y as Pe,a as Re}from"./FullscreenChart-C6BH4H_K.js";import{g as G}from"./deathTypes-CGUOTngO.js";import{ak as De,w as Ne,al as Ie,am as ke,an as Le,H as Te,u as re,ao as ne,L as Oe,c as We,s as Be,ap as Ve,aq as Fe,ar as U,as as Xe,at as fe,au as ae,av as He,aw as K,R as qe,T as Ye}from"./CategoricalChart-CbpqXhU3.js";import{S as Ze,a as $e}from"./ScatterChart-BKOWx5cP.js";import"./baseStatsHook-DgYWPYDl.js";const Ge=Ue(Ke);function Ue(e){return function(a,o,n=o){if(!((o=+o)>=0))throw new RangeError("invalid rx");if(!((n=+n)>=0))throw new RangeError("invalid ry");let{data:r,width:s,height:d}=a;if(!((s=Math.floor(s))>=0))throw new RangeError("invalid width");if(!((d=Math.floor(d!==void 0?d:r.length/s))>=0))throw new RangeError("invalid height");if(!s||!d||!o&&!n)return a;const v=o&&e(o),p=n&&e(n),l=r.slice();return v&&p?(Z(v,l,r,s,d),Z(v,r,l,s,d),Z(v,l,r,s,d),$(p,r,l,s,d),$(p,l,r,s,d),$(p,r,l,s,d)):v?(Z(v,r,l,s,d),Z(v,l,r,s,d),Z(v,r,l,s,d)):p&&($(p,r,l,s,d),$(p,l,r,s,d),$(p,r,l,s,d)),a}}function Z(e,a,o,n,r){for(let s=0,d=n*r;s<d;)e(a,o,s,s+=n,1)}function $(e,a,o,n,r){for(let s=0,d=n*r;s<n;++s)e(a,o,s,s+d,n)}function Ke(e){const a=Math.floor(e);if(a===e)return _e(e);const o=e-a,n=2*e+1;return(r,s,d,v,p)=>{if(!((v-=p)>=d))return;let l=a*s[d];const i=p*a,g=i+p;for(let m=d,x=d+i;m<x;m+=p)l+=s[Math.min(v,m)];for(let m=d,x=v;m<=x;m+=p)l+=s[Math.min(v,m+i)],r[m]=(l+o*(s[Math.max(d,m-g)]+s[Math.min(v,m+g)]))/n,l-=s[Math.max(d,m-i)]}}function _e(e){const a=2*e+1;return(o,n,r,s,d)=>{if(!((s-=d)>=r))return;let v=e*n[r];const p=d*e;for(let l=r,i=r+p;l<i;l+=d)v+=n[Math.min(s,l)];for(let l=r,i=s;l<=i;l+=d)v+=n[Math.min(s,l+p)],o[l]=v/a,v-=n[Math.max(r,l-p)]}}function Je(e,a){let o=0;for(let n of e)n!=null&&(n=+n)>=n&&++o;return o}function Qe(e,a){let o,n;if(a===void 0)for(const r of e)r!=null&&(o===void 0?r>=r&&(o=n=r):(o>r&&(o=r),n<r&&(n=r)));else{let r=-1;for(let s of e)(s=a(s,++r,e))!=null&&(o===void 0?s>=s&&(o=n=s):(o>s&&(o=s),n<s&&(n=s)))}return[o,n]}function et(e,a,o){let n;for(;;){const r=De(e,a,o);if(r===n||r===0||!isFinite(r))return[e,a];r>0?(e=Math.floor(e/r)*r,a=Math.ceil(a/r)*r):r<0&&(e=Math.ceil(e*r)/r,a=Math.floor(a*r)/r),n=r}}function tt(e){return Math.max(1,Math.ceil(Math.log(Je(e))/Math.LN2)+1)}function oe(e,a){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),o.push.apply(o,n)}return o}function se(e){for(var a=1;a<arguments.length;a++){var o=arguments[a]!=null?arguments[a]:{};a%2?oe(Object(o),!0).forEach(function(n){Q(e,n,o[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):oe(Object(o)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(o,n))})}return e}function Q(e,a,o){return(a=rt(a))in e?Object.defineProperty(e,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[a]=o,e}function rt(e){var a=nt(e,"string");return typeof a=="symbol"?a:a+""}function nt(e,a){if(typeof e!="object"||!e)return e;var o=e[Symbol.toPrimitive];if(o!==void 0){var n=o.call(e,a);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(e)}function J(){return J=Object.assign?Object.assign.bind():function(e){for(var a=1;a<arguments.length;a++){var o=arguments[a];for(var n in o)({}).hasOwnProperty.call(o,n)&&(e[n]=o[n])}return e},J.apply(null,arguments)}var at=(e,a,o,n,r,s,d)=>{var{x1:v,x2:p,y1:l,y2:i}=d;if(r==null||s==null)return null;var g=Se({x:r,y:s}),m={x:e?g.x.apply(v,{position:"start"}):g.x.rangeMin,y:o?g.y.apply(l,{position:"start"}):g.y.rangeMin},x={x:a?g.x.apply(p,{position:"end"}):g.x.rangeMax,y:n?g.y.apply(i,{position:"end"}):g.y.rangeMax};return d.ifOverflow==="discard"&&(!g.isInRange(m)||!g.isInRange(x))?null:Ee(m,x)},ot=(e,a)=>{var o;return z.isValidElement(e)?o=z.cloneElement(e,a):typeof e=="function"?o=e(a):o=z.createElement(Xe,J({},a,{className:"recharts-reference-area-rect"})),o};function st(e){var a=Ne();return z.useEffect(()=>(a(Ie(e)),()=>{a(ke(e))})),null}function it(e){var{x1:a,x2:o,y1:n,y2:r,className:s,shape:d,xAxisId:v,yAxisId:p}=e,l=Le(),i=Te(),g=re(c=>ne(c,"xAxis",v,i)),m=re(c=>ne(c,"yAxis",p,i));if(g==null||!m==null)return null;var x=U(a),b=U(o),C=U(n),j=U(r);if(!x&&!b&&!C&&!j&&!d)return null;var h=at(x,b,C,j,g,m,e);if(!h&&!d)return null;var u=e.ifOverflow==="hidden",y=u?"url(#".concat(l,")"):void 0;return z.createElement(Oe,{className:We("recharts-reference-area",s)},ot(d,se(se({clipPath:y},Be(e)),h)),z.createElement(Ve,h,z.createElement(Fe,{label:e.label}),e.children))}function lt(e){return z.createElement(z.Fragment,null,z.createElement(st,{yAxisId:e.yAxisId,xAxisId:e.xAxisId,ifOverflow:e.ifOverflow,x1:e.x1,x2:e.x2,y1:e.y1,y2:e.y2}),z.createElement(it,e))}class ee extends z.Component{render(){return z.createElement(lt,this.props)}}Q(ee,"displayName","ReferenceArea");Q(ee,"defaultProps",{ifOverflow:"discard",xAxisId:0,yAxisId:0,r:10,fill:"#ccc",fillOpacity:.5,stroke:"none",strokeWidth:1});var ct=Array.prototype,he=ct.slice;function dt(e,a){return e-a}function ut(e){for(var a=0,o=e.length,n=e[o-1][1]*e[0][0]-e[o-1][0]*e[0][1];++a<o;)n+=e[a-1][1]*e[a][0]-e[a-1][0]*e[a][1];return n}const q=e=>()=>e;function ft(e,a){for(var o=-1,n=a.length,r;++o<n;)if(r=ht(e,a[o]))return r;return 0}function ht(e,a){for(var o=a[0],n=a[1],r=-1,s=0,d=e.length,v=d-1;s<d;v=s++){var p=e[s],l=p[0],i=p[1],g=e[v],m=g[0],x=g[1];if(mt(p,g,a))return 0;i>n!=x>n&&o<(m-l)*(n-i)/(x-i)+l&&(r=-r)}return r}function mt(e,a,o){var n;return xt(e,a,o)&&pt(e[n=+(e[0]===a[0])],o[n],a[n])}function xt(e,a,o){return(a[0]-e[0])*(o[1]-e[1])===(o[0]-e[0])*(a[1]-e[1])}function pt(e,a,o){return e<=a&&a<=o||o<=a&&a<=e}function gt(){}var H=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function ie(){var e=1,a=1,o=tt,n=p;function r(l){var i=o(l);if(Array.isArray(i))i=i.slice().sort(dt);else{const g=Qe(l,yt);for(i=fe(...et(g[0],g[1],i),i);i[i.length-1]>=g[1];)i.pop();for(;i[1]<g[0];)i.shift()}return i.map(g=>s(l,g))}function s(l,i){const g=i==null?NaN:+i;if(isNaN(g))throw new Error(`invalid value: ${i}`);var m=[],x=[];return d(l,g,function(b){n(b,l,g),ut(b)>0?m.push([b]):x.push(b)}),x.forEach(function(b){for(var C=0,j=m.length,h;C<j;++C)if(ft((h=m[C])[0],b)!==-1){h.push(b);return}}),{type:"MultiPolygon",value:i,coordinates:m}}function d(l,i,g){var m=new Array,x=new Array,b,C,j,h,u,y;for(b=C=-1,h=Y(l[0],i),H[h<<1].forEach(c);++b<e-1;)j=h,h=Y(l[b+1],i),H[j|h<<1].forEach(c);for(H[h<<0].forEach(c);++C<a-1;){for(b=-1,h=Y(l[C*e+e],i),u=Y(l[C*e],i),H[h<<1|u<<2].forEach(c);++b<e-1;)j=h,h=Y(l[C*e+e+b+1],i),y=u,u=Y(l[C*e+b+1],i),H[j|h<<1|u<<2|y<<3].forEach(c);H[h|u<<3].forEach(c)}for(b=-1,u=l[C*e]>=i,H[u<<2].forEach(c);++b<e-1;)y=u,u=Y(l[C*e+b+1],i),H[u<<2|y<<3].forEach(c);H[u<<3].forEach(c);function c(S){var E=[S[0][0]+b,S[0][1]+C],R=[S[1][0]+b,S[1][1]+C],D=v(E),k=v(R),M,I;(M=x[D])?(I=m[k])?(delete x[M.end],delete m[I.start],M===I?(M.ring.push(R),g(M.ring)):m[M.start]=x[I.end]={start:M.start,end:I.end,ring:M.ring.concat(I.ring)}):(delete x[M.end],M.ring.push(R),x[M.end=k]=M):(M=m[k])?(I=x[D])?(delete m[M.start],delete x[I.end],M===I?(M.ring.push(R),g(M.ring)):m[I.start]=x[M.end]={start:I.start,end:M.end,ring:I.ring.concat(M.ring)}):(delete m[M.start],M.ring.unshift(E),m[M.start=D]=M):m[D]=x[k]={start:D,end:k,ring:[E,R]}}}function v(l){return l[0]*2+l[1]*(e+1)*4}function p(l,i,g){l.forEach(function(m){var x=m[0],b=m[1],C=x|0,j=b|0,h=_(i[j*e+C]);x>0&&x<e&&C===x&&(m[0]=le(x,_(i[j*e+C-1]),h,g)),b>0&&b<a&&j===b&&(m[1]=le(b,_(i[(j-1)*e+C]),h,g))})}return r.contour=s,r.size=function(l){if(!arguments.length)return[e,a];var i=Math.floor(l[0]),g=Math.floor(l[1]);if(!(i>=0&&g>=0))throw new Error("invalid size");return e=i,a=g,r},r.thresholds=function(l){return arguments.length?(o=typeof l=="function"?l:Array.isArray(l)?q(he.call(l)):q(l),r):o},r.smooth=function(l){return arguments.length?(n=l?p:gt,r):n===p},r}function yt(e){return isFinite(e)?e:NaN}function Y(e,a){return e==null?!1:+e>=a}function _(e){return e==null||isNaN(e=+e)?-1/0:e}function le(e,a,o,n){const r=n-a,s=o-a,d=isFinite(r)||isFinite(s)?r/s:Math.sign(r)/Math.sign(s);return isNaN(d)?e:e+d-.5}function vt(e){return e[0]}function bt(e){return e[1]}function jt(){return 1}function me(){var e=vt,a=bt,o=jt,n=960,r=500,s=20,d=2,v=s*3,p=n+v*2>>d,l=r+v*2>>d,i=q(20);function g(u){var y=new Float32Array(p*l),c=Math.pow(2,-d),S=-1;for(const f of u){var E=(e(f,++S,u)+v)*c,R=(a(f,S,u)+v)*c,D=+o(f,S,u);if(D&&E>=0&&E<p&&R>=0&&R<l){var k=Math.floor(E),M=Math.floor(R),I=E-k-.5,F=R-M-.5;y[k+M*p]+=(1-I)*(1-F)*D,y[k+1+M*p]+=I*(1-F)*D,y[k+1+(M+1)*p]+=I*F*D,y[k+(M+1)*p]+=(1-I)*F*D}}return Ge({data:y,width:p,height:l},s*c),y}function m(u){var y=g(u),c=i(y),S=Math.pow(2,2*d);return Array.isArray(c)||(c=fe(Number.MIN_VALUE,ae(y)/S,c)),ie().size([p,l]).thresholds(c.map(E=>E*S))(y).map((E,R)=>(E.value=+c[R],x(E)))}m.contours=function(u){var y=g(u),c=ie().size([p,l]),S=Math.pow(2,2*d),E=R=>{R=+R;var D=x(c.contour(y,R*S));return D.value=R,D};return Object.defineProperty(E,"max",{get:()=>ae(y)/S}),E};function x(u){return u.coordinates.forEach(b),u}function b(u){u.forEach(C)}function C(u){u.forEach(j)}function j(u){u[0]=u[0]*Math.pow(2,d)-v,u[1]=u[1]*Math.pow(2,d)-v}function h(){return v=s*3,p=n+v*2>>d,l=r+v*2>>d,m}return m.x=function(u){return arguments.length?(e=typeof u=="function"?u:q(+u),m):e},m.y=function(u){return arguments.length?(a=typeof u=="function"?u:q(+u),m):a},m.weight=function(u){return arguments.length?(o=typeof u=="function"?u:q(+u),m):o},m.size=function(u){if(!arguments.length)return[n,r];var y=+u[0],c=+u[1];if(!(y>=0&&c>=0))throw new Error("invalid size");return n=y,r=c,h()},m.cellSize=function(u){if(!arguments.length)return 1<<d;if(!((u=+u)>=1))throw new Error("invalid cell size");return d=Math.floor(Math.log(u)/Math.LN2),h()},m.thresholds=function(u){return arguments.length?(i=typeof u=="function"?u:Array.isArray(u)?q(he.call(u)):q(u),m):i},m.bandwidth=function(u){if(!arguments.length)return Math.sqrt(s*(s+1));if(!((u=+u)>=0))throw new Error("invalid bandwidth");return s=(Math.sqrt(4*u*u+1)-1)/2,h()},m}function Mt(e){for(var a=e.length/6|0,o=new Array(a),n=0;n<a;)o[n]="#"+e.slice(n*6,++n*6);return o}const zt=e=>He(e[e.length-1]);var St=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Mt);const xe=zt(St),Et={Village:{src:"/Village.webp",zMin:-820,zMax:820,xMin:-461,xMax:461},ChÃ¢teau:{src:"/ChÃ¢teau.webp",zMin:-820,zMax:820,xMin:-461,xMax:461}};function Ct(e){return Et[e]||null}function wt(e){return e==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":e}function ce(e,a){const o=[],n={x:166.35,z:176.22,multiplier:5.45},r={x:403.32,z:-121.11,multiplier:18.4};return e.forEach(s=>{s.PlayerStats.filter(d=>d.DeathPosition!==null).filter(d=>!a||a==="Tous les camps"?!0:te(d.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0})===a).forEach(d=>{if(d.DeathPosition){const v=te(d.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0});let p=d.DeathPosition.x,l=d.DeathPosition.z;s.MapName==="Village"?(p=(p-n.x)*n.multiplier,l=(l-n.z)*n.multiplier*-1):s.MapName==="ChÃ¢teau"&&(p=(p-r.x)*r.multiplier,l=(l-r.z)*r.multiplier*-1),o.push({x:p,z:l,playerName:d.Username,deathType:wt(d.DeathType),mapName:s.MapName,killerName:d.KillerName||null,camp:v,gameId:s.DisplayedId,displayedGameId:s.DisplayedId})}})}),o}function At(e){const a=new Set;return e.forEach(o=>{o.PlayerStats.some(r=>r.DeathPosition!==null)&&o.MapName&&a.add(o.MapName)}),Array.from(a).sort()}function Pt({deathLocations:e,xDomain:a,zDomain:o,width:n=800,height:r=600,bandwidth:s=25,onRegionClick:d,mapConfig:v}){const p=z.useRef(null),l=z.useRef(null),i=z.useRef(null),g=z.useRef(null),[,m]=z.useState(!1),x=z.useMemo(()=>K().domain(o).range([0,n]),[o,n]),b=z.useMemo(()=>K().domain(a).range([r,0]),[a,r]),C=z.useMemo(()=>e.length===0?[]:me().x(c=>x(c.z)).y(c=>b(c.x)).size([n,r]).bandwidth(s).thresholds(15)(e),[e,b,x,n,r,s]),j=z.useMemo(()=>{const y=C.length>0?Math.max(...C.map(c=>c.value)):1;return c=>{const S=c/y;return xe(S)}},[C]);z.useEffect(()=>{const y=i.current;if(!y||!v){m(!1);return}const c=y.getContext("2d");if(!c)return;c.clearRect(0,0,n,r);const S=new Image;S.onload=()=>{c.globalAlpha=.85,c.drawImage(S,0,0,n,r),c.globalAlpha=1,m(!0)},S.onerror=()=>{m(!1)},S.src=v.src},[v,n,r]),z.useEffect(()=>{const y=p.current;if(!y||C.length===0)return;const c=y.getContext("2d");c&&(c.clearRect(0,0,n,r),C.forEach(S=>{c.fillStyle=j(S.value),c.globalAlpha=.6,S.coordinates.forEach(E=>{E.forEach(R=>{c.beginPath(),R.forEach((D,k)=>{k===0?c.moveTo(D[0],D[1]):c.lineTo(D[0],D[1])}),c.closePath(),c.fill()})})}),c.globalAlpha=1)},[C,n,r,j]),z.useEffect(()=>{const y=l.current;if(!y||e.length===0)return;const c=y.getContext("2d");c&&(c.clearRect(0,0,n,r),e.forEach(S=>{const E=x(S.z),R=b(S.x);c.beginPath(),c.arc(E,R,2,0,2*Math.PI),c.fillStyle="rgba(0, 0, 0, 0.3)",c.fill(),c.strokeStyle="rgba(255, 255, 255, 0.5)",c.lineWidth=.5,c.stroke()}))},[e,b,x,n,r]);const h=y=>{if(!d||!g.current)return;const c=g.current.getBoundingClientRect(),S=y.clientX-c.left,E=y.clientY-c.top,R=30,D=e.filter(k=>{const M=x(k.z),I=b(k.x);return Math.sqrt(Math.pow(M-S,2)+Math.pow(I-E,2))<=R});D.length>0&&d(D)},u=y=>{if(!g.current)return;const c=g.current.getBoundingClientRect(),S=y.clientX-c.left,E=y.clientY-c.top,R=20,D=e.filter(k=>{const M=x(k.z),I=b(k.x);return Math.sqrt(Math.pow(M-S,2)+Math.pow(I-E,2))<=R});g.current&&(g.current.style.cursor=D.length>0?"pointer":"default")};return t.jsxs("div",{ref:g,style:{position:"relative",width:`${n}px`,height:`${r}px`,margin:"0 auto"},onClick:h,onMouseMove:u,children:[t.jsx("canvas",{ref:i,width:n,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),t.jsx("canvas",{ref:p,width:n,height:r,style:{position:"absolute",top:0,left:0,borderRadius:"4px",pointerEvents:"none"}}),t.jsx("canvas",{ref:l,width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),t.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),t.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),t.jsxs("svg",{width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(y=>{const c=n*y,S=o[0]+(o[1]-o[0])*y;return t.jsxs("g",{children:[t.jsx("line",{x1:c,y1:r,x2:c,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:c,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(S)})]},`z-${y}`)}),[0,.25,.5,.75,1].map(y=>{const c=r*(1-y),S=a[0]+(a[1]-a[0])*y;return t.jsxs("g",{children:[t.jsx("line",{x1:0,y1:c,x2:5,y2:c,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:10,y:c,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(S)})]},`x-${y}`)})]})]})}function Rt({selectedCamp:e,availableDeathTypes:a,deathTypeColors:o}){const{navigateToGameDetails:n}=de(),{settings:r}=be(),{data:s,isLoading:d,error:v}=ue(),[p,l]=z.useState(""),[i,g]=z.useState("all"),[m,x]=z.useState(null),[b,C]=z.useState("scatter"),[j,h]=z.useState(20),u=z.useMemo(()=>{if(!s)return[];const f=At(s),P=ce(s,e),w=new Map;return P.forEach(A=>{w.set(A.mapName,(w.get(A.mapName)||0)+1)}),f.sort((A,O)=>{const N=w.get(A)||0;return(w.get(O)||0)-N})},[s,e]),y=u.length>0?u[0]:"";p===""&&y!==""&&l(y);const c=z.useMemo(()=>{if(!s)return[];let f=ce(s,e);return p&&(f=f.filter(P=>P.mapName===p)),i!=="all"&&(f=f.filter(P=>P.deathType===i)),f},[s,e,p,i]),S=z.useMemo(()=>{const f=[];return c.forEach(P=>{let w=!1;for(const A of f)if(Math.sqrt(Math.pow(P.x-A.centroidX,2)+Math.pow(P.z-A.centroidZ,2))<=j){const N=A.deaths.length;A.centroidX=(A.centroidX*N+P.x)/(N+1),A.centroidZ=(A.centroidZ*N+P.z)/(N+1),A.deaths.push(P),w=!0;break}w||f.push({centroidX:P.x,centroidZ:P.z,deaths:[P]})}),f},[c,j]),E=z.useMemo(()=>S.map((f,P)=>{const w=f.deaths[0],A=new Map;f.deaths.forEach(T=>{A.set(T.deathType,(A.get(T.deathType)||0)+1)});let O=w.deathType,N=0;return A.forEach((T,W)=>{T>N&&(N=T,O=W)}),{x:f.centroidX,z:f.centroidZ,deathCount:f.deaths.length,allDeaths:f.deaths,dominantDeathType:O,playerName:f.deaths.length===1?w.playerName:null,gameId:f.deaths.length===1?w.gameId:null,camp:w.camp,mapName:w.mapName,deathType:O,killerName:f.deaths.length===1?w.killerName:null,clusterIndex:P}}),[S]),R=({active:f,payload:P})=>{if(!f||!P||P.length===0)return null;const w=P[0].payload,A=w.allDeaths||[w];if(A.length>1){const T=new Map,W=new Set,X=new Map;A.forEach(L=>{const B=L.deathType?G(L.deathType):"Inconnu";T.set(B,(T.get(B)||0)+1),W.add(L.gameId),X.set(L.playerName,(X.get(L.playerName)||0)+1)});const pe=Array.from(X.entries()).sort((L,B)=>B[1]-L[1]).slice(0,3),ge=X.size>3,ye=Array.from(T.entries()).sort((L,B)=>B[1]-L[1]).slice(0,3),ve=T.size>3;return t.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[t.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:[A.length," morts dans cette zone"]}),t.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[t.jsxs("div",{style:{marginBottom:"8px"},children:[t.jsx("strong",{children:"Centre:"})," (",Math.round(w.x),", ",Math.round(w.z),")"]}),t.jsxs("div",{style:{marginBottom:"8px"},children:[t.jsx("strong",{children:"Joueurs:"}),t.jsxs("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:[pe.map(([L,B])=>t.jsxs("li",{children:[L," ",B>1?`(${B} morts)`:""]},L)),ge&&t.jsxs("li",{style:{color:"var(--text-secondary)"},children:["...et ",X.size-3," autres"]})]})]}),t.jsxs("div",{style:{marginBottom:"8px"},children:[t.jsx("strong",{children:"Types de mort:"}),t.jsxs("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:[ye.map(([L,B])=>t.jsxs("li",{children:[L," (",B,")"]},L)),ve&&t.jsxs("li",{style:{color:"var(--text-secondary)"},children:["...et ",T.size-3," autres"]})]})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Parties:"})," ",W.size," parties",W.size<=5&&t.jsxs("span",{children:[" (",Array.from(W).filter(L=>L).map(L=>`#${L}`).join(", "),")"]})]})]}),t.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const N=A[0];return t.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[t.jsx("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:N.playerName}),t.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Camp:"})," ",N.camp]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Type de mort:"})," ",N.deathType?G(N.deathType):"Inconnu"]}),N.killerName&&t.jsxs("div",{children:[t.jsx("strong",{children:"TuÃ© par:"})," ",N.killerName]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Carte:"})," ",N.mapName]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Partie:"})," #",N.gameId]}),t.jsxs("div",{style:{marginTop:"4px",fontSize:"0.85rem",color:"var(--text-secondary)"},children:["Position: (",Math.round(N.x),", ",Math.round(N.z),")"]})]}),t.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})},D=f=>{if(!f)return;const P=f.allDeaths||[f];if(P.length===1)n({selectedGame:P[0].gameId,fromComponent:"Death Location View"});else{const w=P.map(A=>A.gameId).filter(A=>A);n({selectedGameIds:w,fromComponent:"Death Location View"})}},k=f=>f&&o[f]||"var(--text-secondary)",M=z.useMemo(()=>Ct(p),[p]),{xDomain:I,zDomain:F}=z.useMemo(()=>{if(M)return{xDomain:[M.xMin,M.xMax],zDomain:[M.zMin,M.zMax]};if(E.length===0)return{xDomain:[0,100],zDomain:[0,100]};const f=E.map(X=>X.x),P=E.map(X=>X.z),w=Math.min(...f),A=Math.max(...f),O=Math.min(...P),N=Math.max(...P),T=(A-w)*.1||10,W=(N-O)*.1||10;return{xDomain:[w-T,A+T],zDomain:[O-W,N+W]}},[E,M]);return d?t.jsx("div",{className:"donnees-attente",children:"Chargement des localisations de mort..."}):v?t.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",v]}):s?t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Mode :"}),t.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[t.jsx("button",{onClick:()=>C("scatter"),style:{background:b==="scatter"?"var(--accent-primary)":"transparent",color:b==="scatter"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:b==="scatter"?"bold":"normal",transition:"all 0.2s"},children:"Points"}),t.jsx("button",{onClick:()=>C("heatmap"),style:{background:b==="heatmap"?"var(--accent-primary)":"transparent",color:b==="heatmap"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:b==="heatmap"?"bold":"normal",transition:"all 0.2s"},children:"Carte de chaleur"})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),t.jsx("select",{id:"map-select",value:p,onChange:f=>l(f.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:u.filter(f=>f==="Village"||f==="ChÃ¢teau").map(f=>t.jsx("option",{value:f,children:f},f))})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"death-type-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Type de mort :"}),t.jsxs("select",{id:"death-type-select",value:i,onChange:f=>g(f.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[t.jsx("option",{value:"all",children:"Tous les types"}),a.map(f=>t.jsx("option",{value:f,children:G(f)},f))]})]}),b==="scatter"&&t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"cluster-radius",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),t.jsx("input",{id:"cluster-radius",type:"range",min:"0",max:"60",step:"5",value:j,onChange:f=>h(Number(f.target.value)),style:{width:"100px",cursor:"pointer"}}),t.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.85rem",minWidth:"70px"},children:j===0?"Aucun":`${j} unitÃ©s`})]})]}),t.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Morts localisÃ©es"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary)"},children:c.length}),b==="scatter"&&j>0&&E.length<c.length&&t.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"4px"},children:["â†’ ",E.length," points groupÃ©s"]})]}),t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Camp filtrÃ©"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)",fontSize:"1.2rem"},children:e})]}),t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Type de mort"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-2)",fontSize:"1.2rem"},children:i==="all"?"Tous":G(i)})]})]}),c.length>0?t.jsx(Ce,{title:b==="scatter"?"Carte des Morts":"Carte de Chaleur des Morts",children:b==="scatter"?t.jsx("div",{style:{height:700,width:"100%",maxWidth:1e3,margin:"0 auto"},children:t.jsx(qe,{width:"100%",height:"100%",children:t.jsxs(Ze,{margin:{top:20,right:30,left:60,bottom:60},children:[M&&t.jsx(ee,{x1:M.zMin,x2:M.zMax,y1:M.xMin,y2:M.xMax,fill:"transparent",stroke:"none",shape:f=>{const{x:P,y:w,width:A,height:O}=f;return t.jsx("image",{x:P,y:w,width:A,height:O,href:M.src,preserveAspectRatio:"none",style:{opacity:.85}})}}),t.jsx(we,{strokeDasharray:"3 3",stroke:M?"rgba(255,255,255,0.3)":"var(--border-color)"}),t.jsx(Ae,{dataKey:"z",type:"number",name:"Position Z",label:{value:"Position Z",position:"bottom",offset:10,style:{fill:"var(--text-secondary)"}},domain:F,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:f=>Math.round(f).toString()}),t.jsx(Pe,{dataKey:"x",type:"number",name:"Position X",label:{value:"Position X",angle:-90,position:"left",offset:20,style:{fill:"var(--text-secondary)"}},domain:I,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:f=>Math.round(f).toString()}),t.jsx(Ye,{content:t.jsx(R,{}),cursor:{strokeDasharray:"3 3"}}),t.jsx($e,{data:E,onClick:f=>D(f),onMouseEnter:f=>x(f),onMouseLeave:()=>x(null),style:{cursor:"pointer"},children:E.map((f,P)=>{const w=f.allDeaths.some(W=>r.highlightedPlayer===W.playerName),A=m&&f.clusterIndex===m.clusterIndex,O=Math.min(Math.log2(f.deathCount+1)*3+4,18),N=Math.round(O),T=N+2;return t.jsx(Re,{fill:w?"var(--accent-primary)":k(f.deathType),stroke:w||A?"white":f.deathCount>1?"rgba(255,255,255,0.6)":"none",strokeWidth:w?3:A?2:f.deathCount>1?1.5:0,opacity:w?1:.8,r:w?T:A?N+1:N},`cell-${P}`)})})]})})}):t.jsx("div",{style:{padding:"2rem 0",display:"flex",justifyContent:"center"},children:t.jsx(Pt,{deathLocations:c,xDomain:I,zDomain:F,width:1e3,height:700,bandwidth:25,mapConfig:M,onRegionClick:f=>{if(f.length===1)n({selectedGame:f[0].gameId,fromComponent:"Death Location View (Heatmap)"});else{const P=f.map(w=>w.gameId).filter(w=>w);n({selectedGameIds:P,fromComponent:"Death Location View (Heatmap)"})}}})})}):t.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[t.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1rem"},children:"Aucune localisation de mort disponible pour les filtres sÃ©lectionnÃ©s"}),t.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes (non-legacy)."})]}),t.jsxs("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:[t.jsx("p",{children:t.jsx("strong",{children:"Ã€ propos de cette visualisation :"})}),t.jsxs("ul",{style:{marginTop:"0.5rem",paddingLeft:"1.5rem"},children:[t.jsx("li",{children:"Les positions sont basÃ©es sur les coordonnÃ©es Z (horizontal) et X (vertical) - vue 2D de la carte"}),b==="scatter"?t.jsxs(t.Fragment,{children:[t.jsx("li",{children:'Les morts proches sont regroupÃ©es en un seul point - ajustez le curseur "Regroupement" pour contrÃ´ler la distance'}),t.jsx("li",{children:"La couleur indique le type de mort dominant dans le groupe"}),t.jsx("li",{children:"Survolez un point pour voir tous les joueurs, types de mort et parties concernÃ©s"}),t.jsxs("li",{children:["Le joueur sÃ©lectionnÃ© est affichÃ© en "," ",t.jsx("span",{style:{color:"var(--accent-primary)",fontWeight:"bold"},children:"couleur primaire"})]}),t.jsx("li",{children:"Cliquez sur un point pour voir les dÃ©tails de la ou des parties"})]}):t.jsxs(t.Fragment,{children:[t.jsx("li",{children:"La carte de chaleur montre les zones de forte densitÃ© de morts (du jaune au rouge)"}),t.jsx("li",{children:"Les points noirs indiquent l'emplacement exact de chaque mort"}),t.jsx("li",{children:"Les zones rouges indiquent une concentration Ã©levÃ©e de morts"}),t.jsx("li",{children:"Cliquez sur une zone pour voir les dÃ©tails des parties associÃ©es"}),t.jsx("li",{children:'Utilisez le mode "Points" pour voir les dÃ©tails individuels par type de mort'})]})]}),t.jsx("p",{style:{marginTop:"0.5rem",fontStyle:"italic",color:"var(--text-secondary)"},children:"Note : Seules les parties rÃ©centes contiennent des donnÃ©es de position."})]})]}):t.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function Vt({deathLocations:e,xDomain:a,zDomain:o,width:n=800,height:r=600,bandwidth:s=25,onRegionClick:d}){const v=z.useRef(null),p=z.useRef(null),l=z.useRef(null),i=z.useMemo(()=>K().domain(a).range([0,n]),[a,n]),g=z.useMemo(()=>K().domain(o).range([r,0]),[o,r]),m=z.useMemo(()=>e.length===0?[]:me().x(h=>i(h.x)).y(h=>g(h.z)).size([n,r]).bandwidth(s).thresholds(15)(e),[e,i,g,n,r,s]),x=z.useMemo(()=>{const j=m.length>0?Math.max(...m.map(h=>h.value)):1;return h=>{const u=h/j;return xe(u)}},[m]);z.useEffect(()=>{const j=v.current;if(!j||m.length===0)return;const h=j.getContext("2d");h&&(h.clearRect(0,0,n,r),m.forEach(u=>{h.fillStyle=x(u.value),h.globalAlpha=.6,u.coordinates.forEach(y=>{y.forEach(c=>{h.beginPath(),c.forEach((S,E)=>{E===0?h.moveTo(S[0],S[1]):h.lineTo(S[0],S[1])}),h.closePath(),h.fill()})})}),h.globalAlpha=1)},[m,n,r,x]),z.useEffect(()=>{const j=p.current;if(!j||e.length===0)return;const h=j.getContext("2d");h&&(h.clearRect(0,0,n,r),e.forEach(u=>{const y=i(u.x),c=g(u.z);h.beginPath(),h.arc(y,c,2,0,2*Math.PI),h.fillStyle="rgba(0, 0, 0, 0.3)",h.fill(),h.strokeStyle="rgba(255, 255, 255, 0.5)",h.lineWidth=.5,h.stroke()}))},[e,i,g,n,r]);const b=j=>{if(!d||!l.current)return;const h=l.current.getBoundingClientRect(),u=j.clientX-h.left,y=j.clientY-h.top,c=30,S=e.filter(E=>{const R=i(E.x),D=g(E.z);return Math.sqrt(Math.pow(R-u,2)+Math.pow(D-y,2))<=c});S.length>0&&d(S)},C=j=>{if(!l.current)return;const h=l.current.getBoundingClientRect(),u=j.clientX-h.left,y=j.clientY-h.top,c=20,S=e.filter(E=>{const R=i(E.x),D=g(E.z);return Math.sqrt(Math.pow(R-u,2)+Math.pow(D-y,2))<=c});l.current&&(l.current.style.cursor=S.length>0?"pointer":"default")};return t.jsxs("div",{ref:l,style:{position:"relative",width:`${n}px`,height:`${r}px`,margin:"0 auto"},onClick:b,onMouseMove:C,children:[t.jsx("canvas",{ref:v,width:n,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),t.jsx("canvas",{ref:p,width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),t.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),t.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),t.jsxs("svg",{width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(j=>{const h=n*j,u=a[0]+(a[1]-a[0])*j;return t.jsxs("g",{children:[t.jsx("line",{x1:h,y1:r,x2:h,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:h,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(u)})]},`x-${j}`)}),[0,.25,.5,.75,1].map(j=>{const h=r*(1-j),u=o[0]+(o[1]-o[0])*j;return t.jsxs("g",{children:[t.jsx("line",{x1:0,y1:h,x2:5,y2:h,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:10,y:h,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(u)})]},`z-${j}`)})]})]})}function Ft(){const{navigationState:e,updateNavigationState:a}=de(),[o,n]=z.useState(e.deathLocationState?.selectedCamp||"Tous les camps"),{data:r}=je(),{data:s}=ue(),d=ze();z.useEffect(()=>{(!e.deathLocationState||e.deathLocationState.selectedCamp!==o)&&a({deathLocationState:{selectedCamp:o}})},[o,e.deathLocationState,a]);const v=z.useMemo(()=>s?Me(s):[],[s]),p=z.useMemo(()=>{const i={};v.forEach(x=>{x===V.BY_WOLF?i[x]=d.Loup:x===V.VOTED?i[x]="var(--chart-color-1)":x===V.BULLET||x===V.BULLET_HUMAN||x===V.BULLET_WOLF?i[x]=d.Chasseur:x===V.BY_ZOMBIE?i[x]=d.Vaudou:x===V.ASSASSIN?i[x]=d.Alchimiste:x===V.AVENGER?i[x]="var(--chart-color-2)":x===V.LOVER_DEATH?i[x]=d.Amoureux:x===V.BY_BEAST?i[x]="var(--chart-color-3)":x===V.SHERIF_SUCCESS&&(i[x]="var(--chart-color-4)")});const g=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let m=0;return v.forEach(x=>{i[x]||(i[x]=g[m%g.length],m++)}),i},[v,d]),l=i=>{n(i),a({deathLocationState:{selectedCamp:i}})};return t.jsxs("div",{className:"lycans-general-stats",children:[t.jsx("h2",{children:"ðŸ—ºï¸ Carte de Chaleur des Morts"}),t.jsx("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),t.jsxs("select",{id:"camp-select",value:o,onChange:i=>l(i.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[t.jsx("option",{value:"Tous les camps",children:"Tous les camps"},"tous"),r?.filter(i=>i!=="Tous les camps").map(i=>t.jsx("option",{value:i,children:i},i))]})]})}),t.jsx(Rt,{selectedCamp:o,availableDeathTypes:v,deathTypeColors:p})]})}export{Ft as DeathLocationHeatmap,Vt as DeathLocationHeatmapCanvas};
