import{r as z,j as e,a as se,b as pe,i as ae}from"./index-CRVotvbE.js";import{u as xe,c as ge}from"./useDeathStatisticsFromRaw-CxTe8WS_.js";import{D as W}from"./datasyncExport-BirWLS1z.js";import{a as ye,b as ve}from"./api-BHqP4DlK.js";import{F as be,C as je,X as Me,Y as Se,a as ze}from"./FullscreenChart-CvK6X1_C.js";import{g as Ee,c as te,a as Ce,b as De,d as Re,S as we,R as ke,e as Le}from"./deathLocationUtils-C9QebsFC.js";import{g as J}from"./deathTypes-gHH1w6_X.js";import{aH as Ae,aI as ie,aJ as re,aK as Ne,aL as K,R as Ie,T as Te}from"./CategoricalChart-I4QsiQeR.js";import"./baseStatsHook-B0G-DkG5.js";import"./CartesianScaleHelper-B5QcuZLv.js";const Be=Pe(We);function Pe(t){return function(o,c,n=c){if(!((c=+c)>=0))throw new RangeError("invalid rx");if(!((n=+n)>=0))throw new RangeError("invalid ry");let{data:r,width:i,height:p}=o;if(!((i=Math.floor(i))>=0))throw new RangeError("invalid width");if(!((p=Math.floor(p!==void 0?p:r.length/i))>=0))throw new RangeError("invalid height");if(!i||!p||!c&&!n)return o;const g=c&&t(c),b=n&&t(n),a=r.slice();return g&&b?(U(g,a,r,i,p),U(g,r,a,i,p),U(g,a,r,i,p),O(b,r,a,i,p),O(b,a,r,i,p),O(b,r,a,i,p)):g?(U(g,r,a,i,p),U(g,a,r,i,p),U(g,r,a,i,p)):b&&(O(b,r,a,i,p),O(b,a,r,i,p),O(b,r,a,i,p)),o}}function U(t,o,c,n,r){for(let i=0,p=n*r;i<p;)t(o,c,i,i+=n,1)}function O(t,o,c,n,r){for(let i=0,p=n*r;i<n;++i)t(o,c,i,i+p,n)}function We(t){const o=Math.floor(t);if(o===t)return Fe(t);const c=t-o,n=2*t+1;return(r,i,p,g,b)=>{if(!((g-=b)>=p))return;let a=o*i[p];const m=b*o,u=m+b;for(let d=p,j=p+m;d<j;d+=b)a+=i[Math.min(g,d)];for(let d=p,j=g;d<=j;d+=b)a+=i[Math.min(g,d+m)],r[d]=(a+c*(i[Math.max(p,d-u)]+i[Math.min(g,d+u)]))/n,a-=i[Math.max(p,d-m)]}}function Fe(t){const o=2*t+1;return(c,n,r,i,p)=>{if(!((i-=p)>=r))return;let g=t*n[r];const b=p*t;for(let a=r,m=r+b;a<m;a+=p)g+=n[Math.min(i,a)];for(let a=r,m=i;a<=m;a+=p)g+=n[Math.min(i,a+b)],c[a]=g/o,g-=n[Math.max(r,a-b)]}}function He(t,o){let c=0;for(let n of t)n!=null&&(n=+n)>=n&&++c;return c}function Ve(t,o){let c,n;if(o===void 0)for(const r of t)r!=null&&(c===void 0?r>=r&&(c=n=r):(c>r&&(c=r),n<r&&(n=r)));else{let r=-1;for(let i of t)(i=o(i,++r,t))!=null&&(c===void 0?i>=i&&(c=n=i):(c>i&&(c=i),n<i&&(n=i)))}return[c,n]}function Xe(t,o,c){let n;for(;;){const r=Ae(t,o,c);if(r===n||r===0||!isFinite(r))return[t,o];r>0?(t=Math.floor(t/r)*r,o=Math.ceil(o/r)*r):r<0&&(t=Math.ceil(t*r)/r,o=Math.floor(o*r)/r),n=r}}function qe(t){return Math.max(1,Math.ceil(Math.log(He(t))/Math.LN2)+1)}var $e=Array.prototype,le=$e.slice;function Ye(t,o){return t-o}function Ge(t){for(var o=0,c=t.length,n=t[c-1][1]*t[0][0]-t[c-1][0]*t[0][1];++o<c;)n+=t[o-1][1]*t[o][0]-t[o-1][0]*t[o][1];return n}const Y=t=>()=>t;function Ue(t,o){for(var c=-1,n=o.length,r;++c<n;)if(r=Oe(t,o[c]))return r;return 0}function Oe(t,o){for(var c=o[0],n=o[1],r=-1,i=0,p=t.length,g=p-1;i<p;g=i++){var b=t[i],a=b[0],m=b[1],u=t[g],d=u[0],j=u[1];if(Ze(b,u,o))return 0;m>n!=j>n&&c<(d-a)*(n-m)/(j-m)+a&&(r=-r)}return r}function Ze(t,o,c){var n;return Ke(t,o,c)&&Je(t[n=+(t[0]===o[0])],c[n],o[n])}function Ke(t,o,c){return(o[0]-t[0])*(c[1]-t[1])===(c[0]-t[0])*(o[1]-t[1])}function Je(t,o,c){return t<=o&&o<=c||c<=o&&o<=t}function Qe(){}var q=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function ne(){var t=1,o=1,c=qe,n=b;function r(a){var m=c(a);if(Array.isArray(m))m=m.slice().sort(Ye);else{const u=Ve(a,_e);for(m=ie(...Xe(u[0],u[1],m),m);m[m.length-1]>=u[1];)m.pop();for(;m[1]<u[0];)m.shift()}return m.map(u=>i(a,u))}function i(a,m){const u=m==null?NaN:+m;if(isNaN(u))throw new Error(`invalid value: ${m}`);var d=[],j=[];return p(a,u,function(x){n(x,a,u),Ge(x)>0?d.push([x]):j.push(x)}),j.forEach(function(x){for(var R=0,y=d.length,h;R<y;++R)if(Ue((h=d[R])[0],x)!==-1){h.push(x);return}}),{type:"MultiPolygon",value:m,coordinates:d}}function p(a,m,u){var d=new Array,j=new Array,x,R,y,h,s,v;for(x=R=-1,h=G(a[0],m),q[h<<1].forEach(l);++x<t-1;)y=h,h=G(a[x+1],m),q[y|h<<1].forEach(l);for(q[h<<0].forEach(l);++R<o-1;){for(x=-1,h=G(a[R*t+t],m),s=G(a[R*t],m),q[h<<1|s<<2].forEach(l);++x<t-1;)y=h,h=G(a[R*t+t+x+1],m),v=s,s=G(a[R*t+x+1],m),q[y|h<<1|s<<2|v<<3].forEach(l);q[h|s<<3].forEach(l)}for(x=-1,s=a[R*t]>=m,q[s<<2].forEach(l);++x<t-1;)v=s,s=G(a[R*t+x+1],m),q[s<<2|v<<3].forEach(l);q[s<<3].forEach(l);function l(M){var E=[M[0][0]+x,M[0][1]+R],w=[M[1][0]+x,M[1][1]+R],C=g(E),A=g(w),S,N;(S=j[C])?(N=d[A])?(delete j[S.end],delete d[N.start],S===N?(S.ring.push(w),u(S.ring)):d[S.start]=j[N.end]={start:S.start,end:N.end,ring:S.ring.concat(N.ring)}):(delete j[S.end],S.ring.push(w),j[S.end=A]=S):(S=d[A])?(N=j[C])?(delete d[S.start],delete j[N.end],S===N?(S.ring.push(w),u(S.ring)):d[N.start]=j[S.end]={start:N.start,end:S.end,ring:N.ring.concat(S.ring)}):(delete d[S.start],S.ring.unshift(E),d[S.start=C]=S):d[C]=j[A]={start:C,end:A,ring:[E,w]}}}function g(a){return a[0]*2+a[1]*(t+1)*4}function b(a,m,u){a.forEach(function(d){var j=d[0],x=d[1],R=j|0,y=x|0,h=Q(m[y*t+R]);j>0&&j<t&&R===j&&(d[0]=oe(j,Q(m[y*t+R-1]),h,u)),x>0&&x<o&&y===x&&(d[1]=oe(x,Q(m[(y-1)*t+R]),h,u))})}return r.contour=i,r.size=function(a){if(!arguments.length)return[t,o];var m=Math.floor(a[0]),u=Math.floor(a[1]);if(!(m>=0&&u>=0))throw new Error("invalid size");return t=m,o=u,r},r.thresholds=function(a){return arguments.length?(c=typeof a=="function"?a:Array.isArray(a)?Y(le.call(a)):Y(a),r):c},r.smooth=function(a){return arguments.length?(n=a?b:Qe,r):n===b},r}function _e(t){return isFinite(t)?t:NaN}function G(t,o){return t==null?!1:+t>=o}function Q(t){return t==null||isNaN(t=+t)?-1/0:t}function oe(t,o,c,n){const r=n-o,i=c-o,p=isFinite(r)||isFinite(i)?r/i:Math.sign(r)/Math.sign(i);return isNaN(p)?t:t+p-.5}function et(t){return t[0]}function tt(t){return t[1]}function rt(){return 1}function ce(){var t=et,o=tt,c=rt,n=960,r=500,i=20,p=2,g=i*3,b=n+g*2>>p,a=r+g*2>>p,m=Y(20);function u(s){var v=new Float32Array(b*a),l=Math.pow(2,-p),M=-1;for(const Z of s){var E=(t(Z,++M,s)+g)*l,w=(o(Z,M,s)+g)*l,C=+c(Z,M,s);if(C&&E>=0&&E<b&&w>=0&&w<a){var A=Math.floor(E),S=Math.floor(w),N=E-A-.5,$=w-S-.5;v[A+S*b]+=(1-N)*(1-$)*C,v[A+1+S*b]+=N*(1-$)*C,v[A+1+(S+1)*b]+=N*$*C,v[A+(S+1)*b]+=(1-N)*$*C}}return Be({data:v,width:b,height:a},i*l),v}function d(s){var v=u(s),l=m(v),M=Math.pow(2,2*p);return Array.isArray(l)||(l=ie(Number.MIN_VALUE,re(v)/M,l)),ne().size([b,a]).thresholds(l.map(E=>E*M))(v).map((E,w)=>(E.value=+l[w],j(E)))}d.contours=function(s){var v=u(s),l=ne().size([b,a]),M=Math.pow(2,2*p),E=w=>{w=+w;var C=j(l.contour(v,w*M));return C.value=w,C};return Object.defineProperty(E,"max",{get:()=>re(v)/M}),E};function j(s){return s.coordinates.forEach(x),s}function x(s){s.forEach(R)}function R(s){s.forEach(y)}function y(s){s[0]=s[0]*Math.pow(2,p)-g,s[1]=s[1]*Math.pow(2,p)-g}function h(){return g=i*3,b=n+g*2>>p,a=r+g*2>>p,d}return d.x=function(s){return arguments.length?(t=typeof s=="function"?s:Y(+s),d):t},d.y=function(s){return arguments.length?(o=typeof s=="function"?s:Y(+s),d):o},d.weight=function(s){return arguments.length?(c=typeof s=="function"?s:Y(+s),d):c},d.size=function(s){if(!arguments.length)return[n,r];var v=+s[0],l=+s[1];if(!(v>=0&&l>=0))throw new Error("invalid size");return n=v,r=l,h()},d.cellSize=function(s){if(!arguments.length)return 1<<p;if(!((s=+s)>=1))throw new Error("invalid cell size");return p=Math.floor(Math.log(s)/Math.LN2),h()},d.thresholds=function(s){return arguments.length?(m=typeof s=="function"?s:Array.isArray(s)?Y(le.call(s)):Y(s),d):m},d.bandwidth=function(s){if(!arguments.length)return Math.sqrt(i*(i+1));if(!((s=+s)>=0))throw new Error("invalid bandwidth");return i=(Math.sqrt(4*s*s+1)-1)/2,h()},d}function nt(t){for(var o=t.length/6|0,c=new Array(o),n=0;n<o;)c[n]="#"+t.slice(n*6,++n*6);return c}const ot=t=>Ne(t[t.length-1]);var st=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(nt);const de=ot(st);function at({deathLocations:t,xDomain:o,zDomain:c,width:n=800,height:r=600,bandwidth:i=25,onRegionClick:p,mapConfig:g}){const b=z.useRef(null),a=z.useRef(null),m=z.useRef(null),u=z.useRef(null),[,d]=z.useState(!1),j=z.useMemo(()=>K().domain(c).range([0,n]),[c,n]),x=z.useMemo(()=>K().domain(o).range([r,0]),[o,r]),R=z.useMemo(()=>t.length===0?[]:ce().x(l=>j(l.z)).y(l=>x(l.x)).size([n,r]).bandwidth(i).thresholds(15)(t),[t,x,j,n,r,i]),y=z.useMemo(()=>{const v=R.length>0?Math.max(...R.map(l=>l.value)):1;return l=>{const M=l/v;return de(M)}},[R]);z.useEffect(()=>{const v=m.current;if(!v||!g){d(!1);return}const l=v.getContext("2d");if(!l)return;l.clearRect(0,0,n,r);const M=new Image;M.onload=()=>{l.globalAlpha=.85,l.drawImage(M,0,0,n,r),l.globalAlpha=1,d(!0)},M.onerror=()=>{d(!1)},M.src=g.src},[g,n,r]),z.useEffect(()=>{const v=b.current;if(!v||R.length===0)return;const l=v.getContext("2d");l&&(l.clearRect(0,0,n,r),R.forEach(M=>{l.fillStyle=y(M.value),l.globalAlpha=.6,M.coordinates.forEach(E=>{E.forEach(w=>{l.beginPath(),w.forEach((C,A)=>{A===0?l.moveTo(C[0],C[1]):l.lineTo(C[0],C[1])}),l.closePath(),l.fill()})})}),l.globalAlpha=1)},[R,n,r,y]),z.useEffect(()=>{const v=a.current;if(!v||t.length===0)return;const l=v.getContext("2d");l&&(l.clearRect(0,0,n,r),t.forEach(M=>{const E=j(M.z),w=x(M.x);l.beginPath(),l.arc(E,w,2,0,2*Math.PI),l.fillStyle="rgba(0, 0, 0, 0.3)",l.fill(),l.strokeStyle="rgba(255, 255, 255, 0.5)",l.lineWidth=.5,l.stroke()}))},[t,x,j,n,r]);const h=v=>{if(!p||!u.current)return;const l=u.current.getBoundingClientRect(),M=v.clientX-l.left,E=v.clientY-l.top,w=30,C=t.filter(A=>{const S=j(A.z),N=x(A.x);return Math.sqrt(Math.pow(S-M,2)+Math.pow(N-E,2))<=w});C.length>0&&p(C)},s=v=>{if(!u.current)return;const l=u.current.getBoundingClientRect(),M=v.clientX-l.left,E=v.clientY-l.top,w=20,C=t.filter(A=>{const S=j(A.z),N=x(A.x);return Math.sqrt(Math.pow(S-M,2)+Math.pow(N-E,2))<=w});u.current&&(u.current.style.cursor=C.length>0?"pointer":"default")};return e.jsxs("div",{ref:u,style:{position:"relative",width:`${n}px`,height:`${r}px`,margin:"0 auto"},onClick:h,onMouseMove:s,children:[e.jsx("canvas",{ref:m,width:n,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),e.jsx("canvas",{ref:b,width:n,height:r,style:{position:"absolute",top:0,left:0,borderRadius:"4px",pointerEvents:"none"}}),e.jsx("canvas",{ref:a,width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}})]})}function it({selectedCamp:t,availableDeathTypes:o,deathTypeColors:c}){const{navigateToGameDetails:n,navigationState:r,updateNavigationState:i}=se(),{settings:p}=pe(),{data:g,isLoading:b,error:a}=ae(),[m,u]=z.useState(""),[d,j]=z.useState(r.deathLocationState?.selectedDeathTypes||[]),[x,R]=z.useState(null),[y,h]=z.useState("heatmap"),[s,v]=z.useState(ye.CLUSTER_RADIUS),[l,M]=z.useState(!1);z.useEffect(()=>{if(d.length===0&&o.length>0){const f=o.filter(k=>k!=="VOTED");j(f),i({deathLocationState:{...r.deathLocationState,selectedCamp:t,selectedDeathTypes:f}})}},[o.length]);const E=z.useMemo(()=>{if(!g)return[];const f=Ee(g),k=te(g,t),D=new Map;return k.forEach(L=>{D.set(L.mapName,(D.get(L.mapName)||0)+1)}),f.sort((L,P)=>{const I=D.get(L)||0;return(D.get(P)||0)-I})},[g,t]),w=E.length>0?E[0]:"";m===""&&w!==""&&u(w);const C=z.useMemo(()=>{if(!g)return[];let f=te(g,t);return m&&(f=f.filter(k=>k.mapName===m)),d.length>0&&(f=f.filter(k=>d.includes(k.deathType))),f},[g,t,m,d]),A=z.useMemo(()=>Ce(C,s),[C,s]),S=z.useMemo(()=>A.map((f,k)=>{const D=f.items[0],L=De(f.items);return{x:f.centroidX,z:f.centroidZ,deathCount:f.items.length,allDeaths:f.items,dominantDeathType:L,playerName:f.items.length===1?D.playerName:null,gameId:f.items.length===1?D.gameId:null,camp:D.camp,mapName:D.mapName,deathType:L,killerName:f.items.length===1?D.killerName:null,clusterIndex:k}}),[A]),N=({active:f,payload:k})=>{if(!f||!k||k.length===0)return null;const D=k[0].payload,L=D.allDeaths||[D];if(L.length>1){const F=new Map,V=new Set,X=new Map;L.forEach(T=>{const H=T.deathType?J(T.deathType):"Inconnu";F.set(H,(F.get(H)||0)+1),V.add(T.gameId),X.set(T.playerName,(X.get(T.playerName)||0)+1)});const ue=Array.from(X.entries()).sort((T,H)=>H[1]-T[1]).slice(0,3),fe=X.size>3,me=Array.from(F.entries()).sort((T,H)=>H[1]-T[1]).slice(0,3),he=F.size>3;return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[L.length," morts dans cette zone"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Centre:"})," (",Math.round(D.x),", ",Math.round(D.z),")"]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Joueurs:"}),e.jsxs("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:[ue.map(([T,H])=>e.jsxs("li",{children:[T," ",H>1?`(${H} morts)`:""]},T)),fe&&e.jsxs("li",{style:{color:"var(--text-secondary)"},children:["...et ",X.size-3," autres"]})]})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Types de mort:"}),e.jsxs("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:[me.map(([T,H])=>e.jsxs("li",{children:[T," (",H,")"]},T)),he&&e.jsxs("li",{style:{color:"var(--text-secondary)"},children:["...et ",F.size-3," autres"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Parties:"})," ",V.size," parties",V.size<=5&&e.jsxs("span",{children:[" (",Array.from(V).filter(T=>T).map(T=>`#${T}`).join(", "),")"]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const I=L[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:I.playerName}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Camp:"})," ",I.camp]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type de mort:"})," ",I.deathType?J(I.deathType):"Inconnu"]}),I.killerName&&e.jsxs("div",{children:[e.jsx("strong",{children:"TuÃ© par:"})," ",I.killerName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Carte:"})," ",I.mapName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Partie:"})," #",I.gameId]}),e.jsxs("div",{style:{marginTop:"4px",fontSize:"0.85rem",color:"var(--text-secondary)"},children:["Position: (",Math.round(I.x),", ",Math.round(I.z),")"]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})},$=f=>{if(!f)return;const k=f.allDeaths||[f];if(k.length===1)n({selectedGame:k[0].gameId,fromComponent:"Death Location View"});else{const D=k.map(L=>L.gameId).filter(L=>L);n({selectedGameIds:D,fromComponent:"Death Location View"})}},Z=f=>f&&c[f]||"var(--text-secondary)",B=z.useMemo(()=>Re(m),[m]),{xDomain:_,zDomain:ee}=z.useMemo(()=>{if(B)return{xDomain:[B.xMin,B.xMax],zDomain:[B.zMin,B.zMax]};if(S.length===0)return{xDomain:[0,100],zDomain:[0,100]};const f=S.map(X=>X.x),k=S.map(X=>X.z),D=Math.min(...f),L=Math.max(...f),P=Math.min(...k),I=Math.max(...k),F=(L-D)*.1||10,V=(I-P)*.1||10;return{xDomain:[D-F,L+F],zDomain:[P-V,I+V]}},[S,B]);return b?e.jsx("div",{className:"donnees-attente",children:"Chargement des localisations de mort..."}):a?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",a]}):g?e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Mode :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>h("heatmap"),style:{background:y==="heatmap"?"var(--accent-primary)":"transparent",color:y==="heatmap"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:y==="heatmap"?"bold":"normal",transition:"all 0.2s"},children:"Carte de chaleur"}),e.jsx("button",{type:"button",onClick:()=>h("scatter"),style:{background:y==="scatter"?"var(--accent-primary)":"transparent",color:y==="scatter"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:y==="scatter"?"bold":"normal",transition:"all 0.2s"},children:"Points"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"map-select",value:m,onChange:f=>u(f.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:E.filter(f=>f==="Village"||f==="ChÃ¢teau").map(f=>e.jsx("option",{value:f,children:f},f))})]}),e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>M(!l),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:l?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:l?"rotate(90deg)":"rotate(0deg)"},children:"â–¶"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[d.length," / ",o.length," sÃ©lectionnÃ©",d.length>1?"s":""]})]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:f=>{f.stopPropagation(),j(o),i({deathLocationState:{...r.deathLocationState,selectedCamp:t,selectedDeathTypes:o}})},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:f=>{f.stopPropagation(),j([]),i({deathLocationState:{...r.deathLocationState,selectedCamp:t,selectedDeathTypes:[]}})},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:o.map(f=>{const k=d.includes(f),D=c[f]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",background:k?"var(--bg-tertiary)":"transparent",borderRadius:"4px",border:`1px solid ${k?D:"var(--border-color)"}`,cursor:"pointer",transition:"all 0.2s",fontSize:"0.9rem"},onClick:L=>{L.stopPropagation();const P=k?d.filter(I=>I!==f):[...d,f];j(P),i({deathLocationState:{...r.deathLocationState,selectedCamp:t,selectedDeathTypes:P}})},children:[e.jsx("input",{type:"checkbox",checked:k,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:D,flexShrink:0}}),e.jsx("span",{children:J(f)})]},f)})})]})]}),y==="scatter"&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-radius",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-radius",type:"range",min:"0",max:"60",step:"5",value:s,onChange:f=>v(Number(f.target.value)),style:{width:"100px",cursor:"pointer"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.85rem",minWidth:"70px"},children:s===0?"Aucun":`${s} unitÃ©s`})]})]}),C.length>0?e.jsx(be,{title:y==="scatter"?"Carte des Morts":"Carte de Chaleur des Morts",children:y==="scatter"?e.jsx("div",{style:{height:700,width:"100%",maxWidth:1e3,margin:"0 auto"},children:e.jsx(Ie,{width:"100%",height:"100%",children:e.jsxs(we,{margin:{top:20,right:30,left:60,bottom:60},children:[B&&e.jsx(ke,{x1:B.zMin,x2:B.zMax,y1:B.xMin,y2:B.xMax,fill:"transparent",stroke:"none",shape:f=>{const{x:k,y:D,width:L,height:P}=f;return e.jsx("image",{x:k,y:D,width:L,height:P,href:B.src,preserveAspectRatio:"none",style:{opacity:.85}})}}),e.jsx(je,{strokeDasharray:"3 3",stroke:B?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(Me,{dataKey:"z",type:"number",name:"Position Z",domain:ee,hide:!0}),e.jsx(Se,{dataKey:"x",type:"number",name:"Position X",domain:_,hide:!0}),e.jsx(Te,{content:e.jsx(N,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Le,{data:S,onClick:f=>$(f),onMouseEnter:f=>R(f),onMouseLeave:()=>R(null),style:{cursor:"pointer"},isAnimationActive:!1,children:S.map((f,k)=>{const D=f.allDeaths.some(V=>p.highlightedPlayer===V.playerName),L=x&&f.clusterIndex===x.clusterIndex,P=Math.min(Math.log2(f.deathCount+1)*3+4,18),I=Math.round(P),F=I+2;return e.jsx(ze,{fill:D?"var(--accent-primary-text)":Z(f.deathType),stroke:D||L?"white":f.deathCount>1?"rgba(255,255,255,0.6)":"none",strokeWidth:D?3:L?2:f.deathCount>1?1.5:0,opacity:D?1:.8,r:D?F:L?I+1:I},`cell-${k}`)})})]})})}):e.jsx("div",{style:{padding:"2rem 0",display:"flex",justifyContent:"center"},children:e.jsx(at,{deathLocations:C,xDomain:_,zDomain:ee,width:1e3,height:700,bandwidth:25,mapConfig:B,onRegionClick:f=>{if(f.length===1)n({selectedGame:f[0].gameId,fromComponent:"Death Location View (Heatmap)"});else{const k=f.map(D=>D.gameId).filter(D=>D);n({selectedGameIds:k,fromComponent:"Death Location View (Heatmap)"})}}})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1rem"},children:"Aucune localisation de mort disponible pour les filtres sÃ©lectionnÃ©s"}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes (non-legacy)."})]}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginTop:"2rem",marginBottom:"2rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Morts localisÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary-text)"},children:C.length}),y==="scatter"&&s>0&&S.length<C.length&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"4px"},children:["â†’ ",S.length," points groupÃ©s"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camp filtrÃ©"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)",fontSize:"1.2rem"},children:t})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Types de mort"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-2)",fontSize:"1.2rem"},children:d.length===0||d.length===o.length?"Tous":`${d.length} type${d.length>1?"s":""}`})]})]}),e.jsxs("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:[e.jsx("p",{children:e.jsx("strong",{children:"Ã€ propos de cette visualisation :"})}),e.jsxs("ul",{style:{marginTop:"0.5rem",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Les positions sont basÃ©es sur les coordonnÃ©es Z (horizontal) et X (vertical) - vue 2D de la carte"}),y==="scatter"?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:'Les morts proches sont regroupÃ©es en un seul point - ajustez le curseur "Regroupement" pour contrÃ´ler la distance'}),e.jsx("li",{children:"Les points regroupÃ©s ont une petite bordure blanche"}),e.jsx("li",{children:"La couleur indique le type de mort dominant dans ce regroupement"}),e.jsx("li",{children:"Survolez un point pour voir tous les joueurs, types de mort et parties concernÃ©s"}),e.jsxs("li",{children:["Le joueur sÃ©lectionnÃ© est affichÃ© en "," ",e.jsx("span",{style:{color:"var(--accent-primary)",fontWeight:"bold"},children:"couleur primaire"})]}),e.jsx("li",{children:"Cliquez sur un point pour voir les dÃ©tails de la ou des parties"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"La carte de chaleur montre les zones de forte densitÃ© de morts (du jaune au rouge)"}),e.jsx("li",{children:"Les points noirs indiquent l'emplacement exact de chaque mort"}),e.jsx("li",{children:"Les zones rouges indiquent une concentration Ã©levÃ©e de morts"}),e.jsx("li",{children:"Cliquez sur une zone pour voir les dÃ©tails des parties associÃ©es"}),e.jsx("li",{children:'Utilisez le mode "Points" pour voir les dÃ©tails individuels par type de mort'})]})]}),e.jsx("p",{style:{marginTop:"0.5rem",fontStyle:"italic",color:"var(--text-secondary)"},children:"Note : Seules les parties rÃ©centes contiennent des donnÃ©es de position."})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function yt({deathLocations:t,xDomain:o,zDomain:c,width:n=800,height:r=600,bandwidth:i=25,onRegionClick:p}){const g=z.useRef(null),b=z.useRef(null),a=z.useRef(null),m=z.useMemo(()=>K().domain(o).range([0,n]),[o,n]),u=z.useMemo(()=>K().domain(c).range([r,0]),[c,r]),d=z.useMemo(()=>t.length===0?[]:ce().x(h=>m(h.x)).y(h=>u(h.z)).size([n,r]).bandwidth(i).thresholds(15)(t),[t,m,u,n,r,i]),j=z.useMemo(()=>{const y=d.length>0?Math.max(...d.map(h=>h.value)):1;return h=>{const s=h/y;return de(s)}},[d]);z.useEffect(()=>{const y=g.current;if(!y||d.length===0)return;const h=y.getContext("2d");h&&(h.clearRect(0,0,n,r),d.forEach(s=>{h.fillStyle=j(s.value),h.globalAlpha=.6,s.coordinates.forEach(v=>{v.forEach(l=>{h.beginPath(),l.forEach((M,E)=>{E===0?h.moveTo(M[0],M[1]):h.lineTo(M[0],M[1])}),h.closePath(),h.fill()})})}),h.globalAlpha=1)},[d,n,r,j]),z.useEffect(()=>{const y=b.current;if(!y||t.length===0)return;const h=y.getContext("2d");h&&(h.clearRect(0,0,n,r),t.forEach(s=>{const v=m(s.x),l=u(s.z);h.beginPath(),h.arc(v,l,2,0,2*Math.PI),h.fillStyle="rgba(0, 0, 0, 0.3)",h.fill(),h.strokeStyle="rgba(255, 255, 255, 0.5)",h.lineWidth=.5,h.stroke()}))},[t,m,u,n,r]);const x=y=>{if(!p||!a.current)return;const h=a.current.getBoundingClientRect(),s=y.clientX-h.left,v=y.clientY-h.top,l=30,M=t.filter(E=>{const w=m(E.x),C=u(E.z);return Math.sqrt(Math.pow(w-s,2)+Math.pow(C-v,2))<=l});M.length>0&&p(M)},R=y=>{if(!a.current)return;const h=a.current.getBoundingClientRect(),s=y.clientX-h.left,v=y.clientY-h.top,l=20,M=t.filter(E=>{const w=m(E.x),C=u(E.z);return Math.sqrt(Math.pow(w-s,2)+Math.pow(C-v,2))<=l});a.current&&(a.current.style.cursor=M.length>0?"pointer":"default")};return e.jsxs("div",{ref:a,style:{position:"relative",width:`${n}px`,height:`${r}px`,margin:"0 auto"},onClick:x,onMouseMove:R,children:[e.jsx("canvas",{ref:g,width:n,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),e.jsx("canvas",{ref:b,width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),e.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),e.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),e.jsxs("svg",{width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(y=>{const h=n*y,s=o[0]+(o[1]-o[0])*y;return e.jsxs("g",{children:[e.jsx("line",{x1:h,y1:r,x2:h,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:h,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(s)})]},`x-${y}`)}),[0,.25,.5,.75,1].map(y=>{const h=r*(1-y),s=c[0]+(c[1]-c[0])*y;return e.jsxs("g",{children:[e.jsx("line",{x1:0,y1:h,x2:5,y2:h,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:10,y:h,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(s)})]},`z-${y}`)})]})]})}function vt(){const{navigationState:t,updateNavigationState:o}=se(),[c,n]=z.useState(t.deathLocationState?.selectedCamp||"Tous les camps"),{data:r}=xe(),{data:i}=ae(),p=ve(),g=z.useMemo(()=>i?ge(i):[],[i]),b=z.useMemo(()=>g.filter(u=>u!=="VOTED"),[g]);z.useEffect(()=>{!t.deathLocationState?.selectedDeathTypes&&g.length>0&&o({deathLocationState:{selectedCamp:c,selectedDeathTypes:b}})},[g,b,t.deathLocationState,c,o]);const a=z.useMemo(()=>{const u={};g.forEach(x=>{x===W.BY_WOLF?u[x]=p.Loup:x===W.VOTED?u[x]="var(--chart-color-1)":x===W.BULLET||x===W.BULLET_HUMAN||x===W.BULLET_WOLF?u[x]=p.Chasseur:x===W.BY_ZOMBIE?u[x]=p.Vaudou:x===W.ASSASSIN?u[x]=p.Alchimiste:x===W.AVENGER?u[x]="var(--chart-color-2)":x===W.LOVER_DEATH?u[x]=p.Amoureux:x===W.BY_BEAST?u[x]="var(--chart-color-3)":x===W.SHERIF_SUCCESS?u[x]="var(--chart-color-4)":x===W.SMUGGLER_HUNT_KILL&&(u[x]=p.Contrebandier)});const d=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let j=0;return g.forEach(x=>{u[x]||(u[x]=d[j%d.length],j++)}),u},[g,p]),m=u=>{n(u),o({deathLocationState:{selectedCamp:u}})};return e.jsxs("div",{className:"lycans-general-stats",children:[e.jsx("h2",{children:"ðŸ—ºï¸ Carte de Chaleur des Morts"}),e.jsx("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select",value:c,onChange:u=>m(u.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"},"tous"),r?.filter(u=>u!=="Tous les camps").map(u=>e.jsx("option",{value:u,children:u},u))]})]})}),e.jsx(it,{selectedCamp:c,availableDeathTypes:g,deathTypeColors:a})]})}export{vt as DeathLocationHeatmap,yt as DeathLocationHeatmapCanvas};
