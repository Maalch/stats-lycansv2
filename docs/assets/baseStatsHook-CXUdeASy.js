import{a as R,r as c}from"./index-Dy-nKJZi.js";function F(a){if(!a)return null;const[e,t,r]=a.split("/");return!e||!t||!r?null:new Date(Number(r),Number(t)-1,Number(e))}function P(a){return a?a.split(",").map(e=>e.trim()).filter(Boolean):[]}function A(a,e){return e&&e.trim()!==""?P(e).some(r=>r.toLowerCase()===a.toLowerCase()):!1}function b(a,e,t){return a[e]&&a[e][t]||"Villageois"}function G(a){if(a instanceof Date){const e=a.getDate().toString().padStart(2,"0"),t=(a.getMonth()+1).toString().padStart(2,"0"),r=a.getFullYear();return`${e}/${t}/${r}`}if(typeof a=="string"){if(a.match(/^\d{2}\/\d{2}\/\d{4}$/))return a;const e=new Date(a);if(!isNaN(e.getTime()))return G(e)}return a?.toString()||""}function q(a){const e={};return a.forEach(t=>{const r=t.Game?.toString();if(!r)return;e[r]||(e[r]={});const n=(i,s)=>{if(i&&i.toString().trim()!==""){const u=i.toString().trim();e[r][u]||(e[r][u]=s)}},l=(i,s)=>{i&&P(i.toString()).forEach(f=>{e[r][f]||(e[r][f]=s)})};l(t.Loups,"Loups"),n(t.Traître,"Traître"),n(t["Idiot du village"],"Idiot du Village"),n(t.Cannibale,"Cannibale"),n(t.Espion,"Espion"),n(t["La Bête"],"La Bête"),n(t["Chasseur de primes"],"Chasseur de primes"),n(t.Vaudou,"Vaudou"),l(t.Agent,"Agent"),l(t.Scientifique,"Scientifique"),l(t.Amoureux,"Amoureux")}),e}function B(a,e){return a===e||a==="Traître"&&e==="Loups"}function E(a,e,t){const r=b(a,e,t);return r==="Loups"||r==="Traître"?"Loups":["Idiot du Village","Cannibale","Agent","Espion","Scientifique","La Bête","Chasseur de primes","Vaudou","Amoureux"].includes(r)?"Autres":"Villageois"}function w(){const[a,e]=c.useState(null),[t,r]=c.useState(!0),[n,l]=c.useState(null);return c.useEffect(()=>{(async()=>{try{r(!0),l(null);const[s,u,f,d]=await Promise.all([fetch("/stats-lycansv2/data/rawGameData.json"),fetch("/stats-lycansv2/data/rawRoleData.json"),fetch("/stats-lycansv2/data/rawPonceData.json"),fetch("/stats-lycansv2/data/rawBRData.json")]);if(!s.ok)throw new Error("Failed to fetch game data");if(!u.ok)throw new Error("Failed to fetch role data");if(!f.ok)throw new Error("Failed to fetch ponce data");if(!d.ok)throw new Error("Failed to fetch BR data");const[o,m,g,p]=await Promise.all([s.json(),u.json(),f.json(),d.json()]);e({gameData:o.data||[],roleData:m.data||[],ponceData:g.data||[],brPartiesData:p.BRParties?.data||[],brRefPartiesData:p.BRRefParties?.data||[]})}catch(s){console.error("Error fetching combined raw data:",s),l(s instanceof Error?s.message:"Unknown error")}finally{r(!1)}})()},[]),{data:a,isLoading:t,error:n}}function D(a,e,t){return a.filter(r=>{let n=r;if(t&&r.Game){const l=t.find(i=>i.Game===r.Game);if(!l)return!1;n=l}if(e.filterMode==="gameType"&&e.gameFilter!=="all"){if(e.gameFilter==="modded"){if(!n["Game Moddée"])return!1}else if(e.gameFilter==="non-modded"&&n["Game Moddée"])return!1}else if(e.filterMode==="dateRange"&&(e.dateRange.start||e.dateRange.end)){const l=F(n.Date);if(!l)return!1;if(e.dateRange.start){const i=new Date(e.dateRange.start);if(l<i)return!1}if(e.dateRange.end){const i=new Date(e.dateRange.end);if(l>i)return!1}}return!0})}function L(a,e){return e.playerFilter.mode==="none"||e.playerFilter.players.length===0?a:a.filter(t=>{const r=t["Liste des joueurs"].toLowerCase();return e.playerFilter.mode==="include"?e.playerFilter.players.every(l=>r.includes(l.toLowerCase())):e.playerFilter.mode==="exclude"?!e.playerFilter.players.some(l=>r.includes(l.toLowerCase())):!0})}function h(a,e){return e.playerFilter.mode==="none"||e.playerFilter.players.length===0?a:a.filter(t=>{const r=t.Participants.toLowerCase();return e.playerFilter.mode==="include"?e.playerFilter.players.some(n=>r.includes(n.toLowerCase())):e.playerFilter.mode==="exclude"?!e.playerFilter.players.some(n=>r.includes(n.toLowerCase())):!0})}function C(){const{settings:a}=R(),{data:e,isLoading:t,error:r}=w();return{...c.useMemo(()=>{if(!e)return{gameData:null,roleData:null,ponceData:null,brPartiesData:null,brRefPartiesData:null};let l=D(e.gameData,a);l=L(l,a);const i=new Set(l.map(o=>o.Game)),s=e.roleData.filter(o=>i.has(o.Game)),u=e.ponceData.filter(o=>i.has(o.Game));let f=e.brPartiesData.filter(o=>{if(!o.Game||!o.Participants)return!1;const m=e.brRefPartiesData.find(p=>p.Game===o.Game);return m?D([o],a,[m]).length===0?!1:h([o],a).length>0:h([o],a).length>0});const d=D(e.brRefPartiesData,a);return{gameData:l,roleData:s,ponceData:u,brPartiesData:f,brRefPartiesData:d}},[e,a]),isLoading:t,error:r}}function y(a,e={requireGameData:!0,requireRoleData:!1,requirePonceData:!1}){const{gameData:t,roleData:r,ponceData:n,isLoading:l,error:i}=C();return{data:c.useMemo(()=>e.requireGameData&&(!t||t.length===0)||e.requireRoleData&&(!r||r.length===0)||e.requirePonceData&&(!n||n.length===0)?null:a({gameData:t||[],roleData:r||[],ponceData:n||[]}),[t,r,n,a,e]),isLoading:l,error:i}}function j(a){return y(({gameData:e})=>a(e),{requireGameData:!0})}function M(a){return y(({gameData:e,roleData:t})=>a(e,t),{requireGameData:!0,requireRoleData:!0})}function T(a){return y(({gameData:e,roleData:t,ponceData:r})=>a(e,t,r),{requireGameData:!0,requireRoleData:!0,requirePonceData:!0})}export{A as a,q as b,C as c,B as d,E as e,G as f,b as g,j as h,T as i,P as s,M as u};
