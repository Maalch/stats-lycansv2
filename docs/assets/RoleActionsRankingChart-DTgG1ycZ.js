import{u as Q,a as Z,d as ee,r as y,f as re,j as e}from"./index-C9WrXpnL.js";import{u as te}from"./useJoueursData-BJSd3EHC.js";import{u as se,b as ae,M as E,C as N,c as ie}from"./api-Do5h0ZdH.js";import{F as D}from"./FullscreenChart-Dr9iDddc.js";import{i as ne,c as oe}from"./wolfTransformUtils-DiCKErCz.js";import{R as H,T as W,a as G}from"./CategoricalChart-Bnq5kTxw.js";import{B as M,a as k}from"./BarChart-DJ7fFtJM.js";import{C as R,X as w,Y as z}from"./CartesianChart-C9qU33mA.js";const O=ie.COMPACT;function ye(){const{navigationState:v,updateNavigationState:L}=Q(),{settings:n}=Z(),{gameData:P}=ee(),{joueursData:F}=te(),A=se(F),j=ae(),[f,B]=y.useState(v.roleActionsRankingState?.minWolfGames||E.LOW),[p,q]=y.useState(v.roleActionsRankingState?.minHunterGames||E.VERY_LOW),[m,_]=y.useState(v.roleActionsRankingState?.sortOrder||"highest"),[S,x]=y.useState(null);y.useEffect(()=>{const t=v.roleActionsRankingState;(!t||t.minWolfGames!==f||t.minHunterGames!==p||t.sortOrder!==m)&&L({roleActionsRankingState:{minWolfGames:f,minHunterGames:p,sortOrder:m}})},[f,p,m,L]);const c=y.useMemo(()=>{if(!P)return[];const t={};return P.forEach(a=>{const r=a.Modded&&re(a.Version||"0","0.243");a.PlayerStats.forEach(o=>{const h=o.Username;t[h]||(t[h]={transformCount:0,untransformCount:0,totalNightsAsWolf:0,wolfGamesPlayed:0,hunterSuccessfulShots:0,hunterMissedShots:0,hunterTotalShots:0,hunterGamesPlayed:0});const s=t[h],i=o.Actions||[];let d=!1;if(r)d=!0;else{const l=i.some(I=>I.ActionType==="Transform"||I.ActionType==="Untransform"),u=o.LegacyActionsIncomplete===!0;d=l&&!u}if(ne(o.MainRoleInitial)&&d){s.wolfGamesPlayed++;const l=oe(o.DeathTiming,a.EndTiming);s.totalNightsAsWolf+=l,i.forEach(u=>{u.ActionType==="Transform"?s.transformCount++:u.ActionType==="Untransform"&&s.untransformCount++})}const g=i.filter(l=>l.ActionType==="HunterShoot");g.length>0&&(s.hunterGamesPlayed++,g.forEach(l=>{s.hunterTotalShots++,l.ActionTarget?s.hunterSuccessfulShots++:s.hunterMissedShots++}))})}),Object.entries(t).map(([a,r])=>({player:a,transformCount:r.transformCount,untransformCount:r.untransformCount,totalNightsAsWolf:r.totalNightsAsWolf,transformsPerNight:r.totalNightsAsWolf>0?r.transformCount/r.totalNightsAsWolf:0,untransformPerTransform:r.transformCount>0?r.untransformCount/r.transformCount:0,wolfGamesPlayed:r.wolfGamesPlayed,hunterSuccessfulShots:r.hunterSuccessfulShots,hunterMissedShots:r.hunterMissedShots,hunterTotalShots:r.hunterTotalShots,hunterAccuracy:r.hunterTotalShots>0?r.hunterSuccessfulShots/r.hunterTotalShots*100:0,hunterGamesPlayed:r.hunterGamesPlayed}))},[P]),{transformsPerNightData:T,transformsHighlightedAdded:K}=y.useMemo(()=>{const a=[...c.filter(s=>s.wolfGamesPlayed>=f&&s.totalNightsAsWolf>0)].sort((s,i)=>m==="highest"?i.transformsPerNight-s.transformsPerNight:s.transformsPerNight-i.transformsPerNight).slice(0,N.TOP_20),r=n.highlightedPlayer&&a.some(s=>s.player===n.highlightedPlayer);let o=[...a],h=!1;if(n.highlightedPlayer&&!r){const s=c.find(i=>i.player===n.highlightedPlayer);s&&s.totalNightsAsWolf>0&&(o.push({...s,isHighlightedAddition:!0}),h=!0)}return{transformsPerNightData:o,transformsHighlightedAdded:h}},[c,f,m,n.highlightedPlayer]),{untransformsData:b,untransformsHighlightedAdded:$}=y.useMemo(()=>{const a=[...c.filter(s=>s.wolfGamesPlayed>=f&&s.transformCount>0)].sort((s,i)=>m==="highest"?i.untransformPerTransform-s.untransformPerTransform:s.untransformPerTransform-i.untransformPerTransform).slice(0,N.TOP_20),r=n.highlightedPlayer&&a.some(s=>s.player===n.highlightedPlayer);let o=[...a],h=!1;if(n.highlightedPlayer&&!r){const s=c.find(i=>i.player===n.highlightedPlayer);s&&s.transformCount>0&&(o.push({...s,isHighlightedAddition:!0}),h=!0)}return{untransformsData:o,untransformsHighlightedAdded:h}},[c,f,m,n.highlightedPlayer]),{hunterAccuracyData:C,hunterHighlightedAdded:U}=y.useMemo(()=>{const a=[...c.filter(s=>s.hunterGamesPlayed>=p&&s.hunterTotalShots>0)].sort((s,i)=>{const d=m==="highest"?i.hunterAccuracy-s.hunterAccuracy:s.hunterAccuracy-i.hunterAccuracy;return d===0?i.hunterTotalShots-s.hunterTotalShots:d}).slice(0,N.TOP_20),r=n.highlightedPlayer&&a.some(s=>s.player===n.highlightedPlayer);let o=[...a],h=!1;if(n.highlightedPlayer&&!r){const s=c.find(i=>i.player===n.highlightedPlayer);s&&s.hunterTotalShots>0&&(o.push({...s,isHighlightedAddition:!0}),h=!0)}return{hunterAccuracyData:o,hunterHighlightedAdded:h}},[c,p,m,n.highlightedPlayer]),V=T.length>0||b.length>0,Y=C.length>0;if(!V&&!Y)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e d'actions de rÃ´le disponible."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es d'actions de rÃ´le (Chasseur, Loup) ne sont disponibles que pour les parties rÃ©centes avec le mod."})]});const X=c.filter(t=>t.wolfGamesPlayed>=f&&t.totalNightsAsWolf>0).length,J=c.filter(t=>t.hunterGamesPlayed>=p&&t.hunterTotalShots>0).length;return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Classement des Actions de RÃ´le"}),e.jsx("p",{className:"lycans-stats-info",children:"Classement des joueurs par comportement en tant que Loup et Chasseur."}),e.jsx("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1.5rem",flexWrap:"wrap"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"sort-order-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Tri:"}),e.jsxs("select",{id:"sort-order-select",value:m,onChange:t=>_(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"highest",children:"Plus Ã©levÃ© d'abord"}),e.jsx("option",{value:"lowest",children:"Plus bas d'abord"})]})]})}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[T.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"ðŸº Transformations par Nuit (Loup)"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:"Nombre moyen de transformations effectuÃ©es par nuit vÃ©cue en loup"}),K&&n.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem"},children:['ðŸŽ¯ "',n.highlightedPlayer,'" affichÃ© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem",marginTop:"0.5rem"},children:[e.jsx("label",{htmlFor:"min-wolf-games-transform",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties loup:"}),e.jsx("select",{id:"min-wolf-games-transform",value:f,onChange:t=>B(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:O.map(t=>e.jsxs("option",{value:t,children:[t,"+ parties"]},t))}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["(",X," joueurs Ã©ligibles)"]})]}),e.jsx(D,{title:"Transformations par Nuit",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(M,{data:T,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(w,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:a,payload:r})=>e.jsx("text",{x:t,y:a,dy:16,textAnchor:"end",fill:n.highlightedPlayer===r.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:n.highlightedPlayer===r.value?14:13,fontWeight:n.highlightedPlayer===r.value?"bold":"italic",transform:`rotate(-45 ${t} ${a})`,children:r.value})}),e.jsx(z,{label:{value:"Transformations / nuit",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(W,{content:({active:t,payload:a})=>{if(t&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:r.player}),e.jsxs("div",{children:["Parties loup: ",r.wolfGamesPlayed]}),e.jsxs("div",{children:["Nuits vÃ©cues: ",r.totalNightsAsWolf]}),e.jsxs("div",{children:["Transformations: ",r.transformCount]}),e.jsxs("div",{style:{marginTop:"4px",fontWeight:"bold",color:j.Loup},children:["Ratio: ",r.transformsPerNight.toFixed(2)," / nuit"]}),r.isHighlightedAddition&&e.jsx("div",{style:{marginTop:"4px",color:"var(--accent-primary)",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"})]})}return null}}),e.jsx(k,{dataKey:"transformsPerNight",shape:t=>{const{x:a,y:r,width:o,height:h,payload:s}=t,i=s,d=n.highlightedPlayer===i.player,g=S===i.player,l=i.isHighlightedAddition,u=A[i.player]||j.Loup||"var(--wolf-color)";return e.jsx(G,{x:a,y:r,width:o,height:h,fill:d?"var(--accent-primary)":l?"var(--accent-secondary)":u,stroke:d?"var(--accent-primary)":g?"#000000":"none",strokeWidth:d?3:g?2:0,strokeDasharray:l?"5,5":"none",opacity:l?.8:1,onMouseEnter:()=>x(i.player),onMouseLeave:()=>x(null)})}})]})})})})]}),b.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"ðŸº DÃ©transformations par Transformation (Loup)"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:"Ratio de retour Ã  forme humaine. Ã‰levÃ© = joueur qui se dÃ©transforme souvent. Bas = reste transformÃ© longtemps."}),$&&n.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem"},children:['ðŸŽ¯ "',n.highlightedPlayer,'" affichÃ© en plus du top 20']})]}),e.jsx(D,{title:"DÃ©transformations par Transformation",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(M,{data:b,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(w,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:a,payload:r})=>e.jsx("text",{x:t,y:a,dy:16,textAnchor:"end",fill:n.highlightedPlayer===r.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:n.highlightedPlayer===r.value?14:13,fontWeight:n.highlightedPlayer===r.value?"bold":"italic",transform:`rotate(-45 ${t} ${a})`,children:r.value})}),e.jsx(z,{label:{value:"Ratio dÃ©transform. / transform.",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(W,{content:({active:t,payload:a})=>{if(t&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:r.player}),e.jsxs("div",{children:["Parties loup: ",r.wolfGamesPlayed]}),e.jsxs("div",{children:["Transformations: ",r.transformCount]}),e.jsxs("div",{children:["DÃ©transformations: ",r.untransformCount]}),e.jsxs("div",{style:{marginTop:"4px",fontWeight:"bold",color:"var(--accent-secondary)"},children:["Ratio: ",(r.untransformPerTransform*100).toFixed(0),"%"]}),r.isHighlightedAddition&&e.jsx("div",{style:{marginTop:"4px",color:"var(--accent-primary)",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"})]})}return null}}),e.jsx(k,{dataKey:"untransformPerTransform",shape:t=>{const{x:a,y:r,width:o,height:h,payload:s}=t,i=s,d=n.highlightedPlayer===i.player,g=S===i.player,l=i.isHighlightedAddition,u=A[i.player]||"var(--accent-secondary)";return e.jsx(G,{x:a,y:r,width:o,height:h,fill:d?"var(--accent-primary)":l?"var(--accent-secondary)":u,stroke:d?"var(--accent-primary)":g?"#000000":"none",strokeWidth:d?3:g?2:0,strokeDasharray:l?"5,5":"none",opacity:l?.8:1,onMouseEnter:()=>x(i.player),onMouseLeave:()=>x(null)})}})]})})})})]}),C.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"ðŸŽ¯ PrÃ©cision du Chasseur"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:"Pourcentage de tirs rÃ©ussis (cible touchÃ©e) sur le total des tirs effectuÃ©s"}),U&&n.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem"},children:['ðŸŽ¯ "',n.highlightedPlayer,'" affichÃ© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem",marginTop:"0.5rem"},children:[e.jsx("label",{htmlFor:"min-hunter-games",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties avec tir:"}),e.jsx("select",{id:"min-hunter-games",value:p,onChange:t=>q(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:O.map(t=>e.jsxs("option",{value:t,children:[t,"+ parties"]},t))}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["(",J," joueurs Ã©ligibles)"]})]}),e.jsx(D,{title:"PrÃ©cision du Chasseur",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(M,{data:C,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(w,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:a,payload:r})=>e.jsx("text",{x:t,y:a,dy:16,textAnchor:"end",fill:n.highlightedPlayer===r.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:n.highlightedPlayer===r.value?14:13,fontWeight:n.highlightedPlayer===r.value?"bold":"italic",transform:`rotate(-45 ${t} ${a})`,children:r.value})}),e.jsx(z,{label:{value:"PrÃ©cision (%)",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(W,{content:({active:t,payload:a})=>{if(t&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:r.player}),e.jsxs("div",{children:["Parties avec tir: ",r.hunterGamesPlayed]}),e.jsxs("div",{children:["Tirs rÃ©ussis: ",r.hunterSuccessfulShots]}),e.jsxs("div",{children:["Tirs manquÃ©s: ",r.hunterMissedShots]}),e.jsxs("div",{children:["Total tirs: ",r.hunterTotalShots]}),e.jsxs("div",{style:{marginTop:"4px",fontWeight:"bold",color:j.Chasseur},children:["PrÃ©cision: ",r.hunterAccuracy.toFixed(1),"%"]}),r.isHighlightedAddition&&e.jsx("div",{style:{marginTop:"4px",color:"var(--accent-primary)",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"})]})}return null}}),e.jsx(k,{dataKey:"hunterAccuracy",shape:t=>{const{x:a,y:r,width:o,height:h,payload:s}=t,i=s,d=n.highlightedPlayer===i.player,g=S===i.player,l=i.isHighlightedAddition,u=A[i.player]||j.Chasseur||"var(--chart-color-2)";return e.jsx(G,{x:a,y:r,width:o,height:h,fill:d?"var(--accent-primary)":l?"var(--accent-secondary)":u,stroke:d?"var(--accent-primary)":g?"#000000":"none",strokeWidth:d?3:g?2:0,strokeDasharray:l?"5,5":"none",opacity:l?.8:1,onMouseEnter:()=>x(i.player),onMouseLeave:()=>x(null)})}})]})})})})]})]})]})}export{ye as RoleActionsRankingChart};
