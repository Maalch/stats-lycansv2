import{u as F,r as x,j as e}from"./index-v9TyNfcl.js";import{F as w,R as g,B as D,C as b,X as P,Y as N,T as j,o as y,p as G,q as $,x as K}from"./FullscreenChart-C7pzezFN.js";import{P as k,a as V}from"./PieChart-rS58yUN0.js";import{L as q}from"./Legend-BiHe5Vz4.js";function B(a){if(!a)return null;const[p,h,d]=a.split("/");return!p||!h||!d?null:new Date(Number(d),Number(h)-1,Number(p))}function S(a){const[p,h]=x.useState(null),[d,f]=x.useState(!0),[r,n]=x.useState(null);return x.useEffect(()=>{(async()=>{try{f(!0),n(null);const s=await fetch(`/stats-lycansv2/data/${a}.json`);if(!s.ok)throw new Error(`Failed to fetch ${a}`);const i=await s.json();h(i.data||[])}catch(s){console.error(`Error fetching raw ${a}:`,s),n(s instanceof Error?s.message:"Unknown error")}finally{f(!1)}})()},[a]),{data:p,isLoading:d,error:r}}function A(){const{settings:a}=F(),{data:p,isLoading:h,error:d}=S("rawBRData");return{data:p?.filter(r=>{if(!r.Game||!r.Participants)return!1;if(a.filterMode==="gameType"&&a.gameFilter!=="all"){if(a.gameFilter==="modded"){if(!r["Game Moddée"])return!1}else if(a.gameFilter==="non-modded"&&r["Game Moddée"])return!1}else if(a.filterMode==="dateRange"&&(a.dateRange.start||a.dateRange.end)){const n=B(r.Date);if(!n)return!1;if(a.dateRange.start){const m=new Date(a.dateRange.start);if(n<m)return!1}if(a.dateRange.end){const m=new Date(a.dateRange.end);if(n>m)return!1}}if(a.playerFilter.mode!=="none"&&a.playerFilter.players.length>0){const n=r.Participants.toLowerCase();if(a.playerFilter.mode==="include"){if(!a.playerFilter.players.some(s=>s.toLowerCase()===n))return!1}else if(a.playerFilter.mode==="exclude"&&a.playerFilter.players.some(s=>s.toLowerCase()===n))return!1}return!0})?.map(r=>({Game:r.Game,Participants:r.Participants,Score:r.Score,Gagnant:r.Gagnant}))||null,isLoading:h,error:d}}function I(){const{settings:a}=F(),{data:p,isLoading:h,error:d}=S("rawBRData");return{data:p?.reduce((r,n)=>{if(!n.Game2||!n.Date||r.find(s=>s.Game===n.Game2))return r;if(a.filterMode==="gameType"&&a.gameFilter!=="all"){if(a.gameFilter==="modded"){if(!n["Game Moddée"])return r}else if(a.gameFilter==="non-modded"&&n["Game Moddée"])return r}else if(a.filterMode==="dateRange"&&(a.dateRange.start||a.dateRange.end)){const s=B(n.Date);if(!s)return r;if(a.dateRange.start){const i=new Date(a.dateRange.start);if(s<i)return r}if(a.dateRange.end){const i=new Date(a.dateRange.end);if(s>i)return r}}return r.push({Game:n.Game2,"Nombre de participants":n["Nombre de participants"],Date:n.Date,VOD:n.VOD,"Game Moddée":n["Game Moddée"]}),r},[])||null,isLoading:h,error:d}}function Y(){const{data:a,isLoading:p,error:h}=A(),{data:d,isLoading:f,error:r}=I(),n=["var(--chart-color-1)","var(--chart-color-2)","var(--chart-color-3)","var(--chart-color-4)","var(--chart-color-5)","var(--chart-color-6)"],m=i=>$[i]||K(i),s=x.useMemo(()=>{if(!a||!d)return null;const i=d.length,l=a.length,u=a.filter(t=>t.Gagnant).length,v=a.reduce((t,o)=>{const c=o.Participants;return t[c]||(t[c]={name:c,participations:0,wins:0,totalScore:0,averageScore:0,winRate:0}),t[c].participations++,t[c].totalScore+=o.Score,o.Gagnant&&t[c].wins++,t},{});Object.values(v).forEach(t=>{t.averageScore=t.totalScore/t.participations,t.winRate=t.wins/t.participations*100});const C=Object.values(v).sort((t,o)=>o.participations-t.participations).slice(0,10),L=Object.values(v).filter(t=>t.participations>=3).sort((t,o)=>o.winRate-t.winRate).slice(0,10),E=a.reduce((t,o)=>{const c=o.Score,R=c===0?"0":c<=2?"1-2":c<=4?"3-4":c<=6?"5-6":"7+";return t[R]||(t[R]=0),t[R]++,t},{}),O=Object.entries(E).map(([t,o])=>({range:t,count:o,percentage:(o/l*100).toFixed(1)})),M=d.reduce((t,o)=>{const c=o["Nombre de participants"];return t[c]||(t[c]=0),t[c]++,t},{}),T=Object.entries(M).map(([t,o])=>({participants:parseInt(t),games:o,percentage:(o/i*100).toFixed(1)})).sort((t,o)=>t.participants-o.participants);return{totalGames:i,totalParticipations:l,totalWins:u,winRate:(u/l*100).toFixed(1),averageParticipantsPerGame:(l/i).toFixed(1),topPlayersByParticipations:C,topPlayersByWins:L,scoreData:O,participantData:T}},[a,d]);return p||f?e.jsx("div",{className:"statistiques-chargement",children:"Chargement des données Battle Royale..."}):h||r?e.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",h||r]}):s?e.jsxs("div",{className:"lycans-chart-container",children:[e.jsx("div",{className:"lycans-chart-header",children:e.jsx("h2",{children:"Statistiques Battle Royale"})}),e.jsxs("div",{className:"lycans-stats-grid",children:[e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Parties totales"}),e.jsx("div",{className:"lycans-stat-value",children:s.totalGames})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Participations"}),e.jsx("div",{className:"lycans-stat-value",children:s.totalParticipations})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Moy. participants/partie"}),e.jsx("div",{className:"lycans-stat-value",children:s.averageParticipantsPerGame})]})]}),e.jsxs("div",{className:"lycans-chart-section",children:[e.jsx("h3",{children:"Top Joueurs - Participations"}),e.jsx(w,{title:"Top Joueurs par Participations - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(g,{width:"100%",height:400,children:e.jsxs(D,{data:s.topPlayersByParticipations,children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(N,{}),e.jsx(j,{content:({active:i,payload:l})=>{if(i&&l&&l.length>0){const u=l[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:u.name})}),e.jsxs("div",{children:["Participations : ",u.participations]}),e.jsxs("div",{children:["Victoires : ",u.wins]})]})}return null}}),e.jsx(y,{dataKey:"participations",name:"Participations",children:s.topPlayersByParticipations.map((i,l)=>e.jsx(G,{fill:m(i.name)},`cell-${l}`))}),e.jsx(y,{dataKey:"wins",fill:"var(--chart-color-2)",name:"Victoires"})]})})})]}),e.jsxs("div",{className:"lycans-chart-section",children:[e.jsx("h3",{children:"Top Joueurs - Taux de Victoire (min. 3 parties)"}),e.jsx(w,{title:"Top Joueurs par Taux de Victoire - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(g,{width:"100%",height:400,children:e.jsxs(D,{data:s.topPlayersByWins,children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(N,{}),e.jsx(j,{content:({active:i,payload:l})=>{if(i&&l&&l.length>0){const u=l[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:u.name})}),e.jsxs("div",{children:["Taux de victoire : ",u.winRate.toFixed(2),"%"]}),e.jsxs("div",{children:["Victoires : ",u.wins," / ",u.participations]})]})}return null}}),e.jsx(y,{dataKey:"winRate",name:"Taux de victoire (%)",children:s.topPlayersByWins.map((i,l)=>e.jsx(G,{fill:m(i.name)},`cell-${l}`))})]})})})]}),e.jsxs("div",{className:"lycans-chart-section",children:[e.jsx("h3",{children:"Distribution des Scores"}),e.jsx(g,{width:"100%",height:400,children:e.jsxs(k,{children:[e.jsx(V,{data:s.scoreData,cx:"50%",cy:"50%",labelLine:!1,label:({range:i,percentage:l})=>`${i}: ${l}%`,outerRadius:140,fill:"#8884d8",dataKey:"count",children:s.scoreData.map((i,l)=>e.jsx(G,{fill:n[l%n.length]},`cell-${l}`))}),e.jsx(j,{formatter:i=>[i,"Participations"]})]})})]}),e.jsxs("div",{className:"lycans-chart-section",children:[e.jsx("h3",{children:"Répartition par Nombre de Participants"}),e.jsx(w,{title:"Répartition par Nombre de Participants - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(g,{width:"100%",height:400,children:e.jsxs(D,{data:s.participantData,children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"participants"}),e.jsx(N,{}),e.jsx(j,{formatter:(i,l)=>[i,l==="games"?"Parties":l]}),e.jsx(q,{}),e.jsx(y,{dataKey:"games",fill:"var(--chart-color-4)",name:"Nombre de parties"})]})})})]})]}):e.jsx("div",{className:"statistiques-vide",children:"Aucune donnée Battle Royale disponible"})}export{Y as BRGeneralStatsChart};
