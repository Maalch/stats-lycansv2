import{a as he,r as P,g as te,f as Ne,u as re,j as e,d as we,e as Ae,o as Fe}from"./index-89bYlr0t.js";import{u as de}from"./useJoueursData-D_R0WtL4.js";import{u as ge}from"./baseStatsHook-CtNlca2P.js";import{g as ze}from"./gameUtils-DYpUb-C5.js";import{a as Se,g as ce,c as Re,b as $e}from"./datasyncExport-CjB7UYqV.js";import{u as xe,g as We,a as oe,l as ke,d as fe}from"./api-B86LhYUK.js";import{f as se,d as Ie}from"./durationFormatters-C9UyWcKX.js";import{F as U,C as Y,X as J,Y as Z,a as X}from"./FullscreenChart-C9JFNXHE.js";import{R as H,T as _}from"./CategoricalChart-C3ilzi9f.js";import{L as qe,a as Le}from"./LineChart-zQZW-MsV.js";import{B as ee,a as Q}from"./BarChart-ByOW3lh0.js";import{P as Pe,a as De}from"./PieChart-CI3KCSb8.js";import{u as Ee}from"./useDeathStatisticsFromRaw-DxKYz7X5.js";import{R as ye}from"./ReferenceLine-Bud-5bly.js";import{g as ne}from"./deathTypes-gHH1w6_X.js";import{i as ve,g as je,V as Ge,a as Ve}from"./roleUtils-CLjkiQQc.js";import{f as Be,h as ue,a as Oe,b as Ke,d as He,S as _e,R as ie,e as Ue}from"./deathLocationUtils-DSgPDBr-.js";import{L as Ye}from"./Legend-B8s3BSnG.js";import{a as Je,u as Ze}from"./useClips-mcL4yiny.js";import{C as Qe,f as be,a as Xe}from"./ClipViewer-C1mvVauo.js";import"./ActivePoints-BmIubocc.js";import"./PolarChart-cqt0FaFQ.js";function et(a){const{settings:d}=he(),{joueursData:C}=de(),[w,S]=P.useState(null),[x,k]=P.useState(!1),[v,u]=P.useState(null);P.useEffect(()=>{let c=!0;return(async()=>{try{k(!0),u(null);const n=d.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",s=await fetch(n);if(!s.ok)throw new Error(`Failed to load achievements: ${s.status} ${s.statusText}`);const o=await s.json();c&&S(o)}catch(n){c&&u(n instanceof Error?n.message:"Failed to load achievements")}finally{c&&k(!1)}})(),()=>{c=!1}},[d.dataSource]);const g=(()=>{if(!a||!w)return null;const i=C?.Players?.find(n=>n.Joueur===a)?.SteamID;return i&&w.achievements[i]||null})();return P.useEffect(()=>{a&&w&&C&&C.Players?.find(n=>n.Joueur===a)?.SteamID},[a,w,C,d.dataSource]),{data:g,isLoading:x,error:v,metadata:{generatedAt:w?.generatedAt||null,totalPlayers:w?.totalPlayers||0,totalGames:w?.totalGames||0,totalModdedGames:w?.totalModdedGames||0}}}function tt(a,d,C){if(!a||a.trim()===""||d.length===0)return null;const w=[];let S=a;d.forEach(i=>{const n=i.PlayerStats.find(s=>te(s)===a||s.Username.toLowerCase()===a.toLowerCase());if(n){S=n.Username;const s=n.MainRoleInitial==="Louveteau"?n.MainRoleInitial:Se(n.MainRoleInitial,n.MainRoleChanges||[]),o=ce(s);if(C&&C!=="Tous les camps"&&o!==C)return;const j=ze(i),l=n.Victorious,f=Ne(new Date(i.StartDate)),T=Re(i.StartDate,i.EndDate)||0;w.push({gameId:i.Id,date:f,camp:o,won:l,winnerCamp:j,playersInGame:i.PlayerStats.length,mapName:i.MapName,duration:T})}}),w.sort((i,n)=>{const s=o=>{const j=o.split("/");return j.length===3?new Date(parseInt(j[2]),parseInt(j[1])-1,parseInt(j[0])):new Date(o)};return s(n.date).getTime()-s(i.date).getTime()});const x=w.length,k=w.filter(i=>i.won).length,v=x>0?(k/x*100).toFixed(2):"0.00",u={};w.forEach(i=>{u[i.camp]||(u[i.camp]={appearances:0,wins:0,winRate:"0.00"}),u[i.camp].appearances++,i.won&&u[i.camp].wins++}),Object.keys(u).forEach(i=>{const n=u[i];n.winRate=n.appearances>0?(n.wins/n.appearances*100).toFixed(2):"0.00"});const g={};w.forEach(i=>{g[i.mapName]||(g[i.mapName]={appearances:0,wins:0,winRate:"0.00"}),g[i.mapName].appearances++,i.won&&g[i.mapName].wins++}),Object.keys(g).forEach(i=>{const n=g[i];n.winRate=n.appearances>0?(n.wins/n.appearances*100).toFixed(2):"0.00"});const c=w.reduce((i,n)=>i+n.duration,0);return{playerName:S,totalGames:x,totalWins:k,winRate:v,totalPlayTime:c,games:w,campStats:u,mapStats:g}}function rt(a){const d={};let C=0,w=0;return Object.entries(a).forEach(([S,x])=>{S==="Village"||S==="ChÃ¢teau"?d[S]={...x}:(C+=x.appearances,w+=x.wins)}),C>=10&&(d.Autres={appearances:C,wins:w,winRate:C>0?(w/C*100).toFixed(2):"0.00"}),d}function pe(a,d){const{data:C,isLoading:w,error:S}=ge(x=>a?tt(a,x,d):null);return{data:C,isLoading:w,error:S}}function at({achievements:a,title:d,emptyMessage:C,achievementType:w="all"}){const{navigateToTab:S,updateNavigationState:x,clearNavigation:k}=re(),{settings:v,updateSettings:u}=he(),{joueursData:g}=de(),c=xe(g),i=(t,M)=>{if(M.stopPropagation(),!t.redirectTo)return;k();const W=v.highlightedPlayer;if(u(w==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:W,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:W,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const y=v.highlightedPlayer||"",h=n(t.description,y);h&&x({playerComparisonState:{selectedPlayer1:y,selectedPlayer2:h,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const y=t.description.toLowerCase().includes("loup");x({selectedPairingTab:y?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const y=t.description.match(/(Villageois|Loups|Autres)/i);y&&x({deathStatsSelectedCamp:y[1]});let h=10;const r=t.description.match(/min\.\s*(\d+)/);r&&(h=parseInt(r[1],10));let p="totalKills",R="killers";const b=t.redirectTo.chartSection;b&&(b==="killers-total"?(p="totalKills",R="killers"):b==="killers-average"?(p="averageKills",R="killers"):b==="deaths-total"?(p="totalDeaths",R="deaths"):b==="survivors-average"?(p="survivalRate",R="deaths"):(b==="hunters-good"||b==="hunters-bad")&&(R="hunter",p="averageKills")),x({deathStatisticsState:{selectedCamp:y?.[1]||"Tous les camps",minGamesForAverage:h,selectedView:R,focusChart:p}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const y=t.redirectTo.mapFilter||"all";let h=10;const r=t.description.match(/min\.\s*(\d+)/);r&&(h=parseInt(r[1])),u(w==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:y,playerFilter:{mode:"none",players:[]},highlightedPlayer:W,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:y,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:y,playerFilter:{mode:"none",players:[]},highlightedPlayer:W,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:y,playerFilter:{mode:"none",players:[]}}}),x({playersGeneralState:{minGamesForWinRate:h,winRateOrder:"best",focusChart:"winRate"}}),S("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&x({selectedPlayerName:v.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let y="wins";const h=t.title.toLowerCase(),r=t.description.toLowerCase();h.includes("dÃ©faite")||r.includes("dÃ©faite")?y="losses":h.includes("loup")||r.includes("loup")?y="loup":h.includes("villageois")||r.includes("villageois")?y="villageois":(h.includes("victoire")||r.includes("victoire"))&&(y="wins"),x({selectedSeriesType:y})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let y=10;const h=t.description.match(/min\.\s*(\d+)/);h&&(y=parseInt(h[1],10));let r="winRate",p="best";const R=t.title.toLowerCase(),b=t.description.toLowerCase();R.includes("participation")||b.includes("participation")?r="participation":(R.includes("taux de victoire")||b.includes("taux de victoire"))&&(r="winRate",(R.includes("moins bon")||R.includes("mauvais")||b.includes("moins bon")||b.includes("mauvais"))&&(p="worst")),x({playersGeneralState:{minGamesForWinRate:y,winRateOrder:p,focusChart:r}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const y=t.redirectTo.chartSection;let h="Villageois",r=1;y&&(y==="camp-loup"?h="Loup":y==="camp-villageois"?h="Villageois":y==="camp-idiot"?h="Idiot du Village":y==="camp-amoureux"?h="Amoureux":(y==="solo-roles"||y==="hall-of-fame")&&(h="Villageois"));const p=t.description.match(/min\.\s*(\d+)/);p&&(r=parseInt(p[1],10)),y==="solo-roles"?h="RÃ´les spÃ©ciaux":y==="hall-of-fame"&&(h="Tous les camps"),x({campPerformanceState:{selectedCampPerformanceCamp:h,selectedCampPerformanceMinGames:r,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const y=t.title.toLowerCase();let h="overview",r="behavior";y.includes("agressivitÃ©")?(h="overview",r="behavior"):y.includes("taux de vote")?(h="behavior",r="voteRate"):y.includes("prÃ©cision")&&(h="overview",r="accuracy"),x({votingStatsState:{selectedCategory:h,selectedView:r}})}if(t.category==="loot"&&t.redirectTo.subTab==="lootStats"){const y=t.redirectTo,h=y.minGames||5,r=y.view||"normalized";x({lootStatsState:{minGames:h,campFilter:"all",view:r}})}S(t.redirectTo.tab,t.redirectTo.subTab)},n=(t,M)=>{const W=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const y of W){const h=t.match(y);if(h&&h[1]){const r=h[1].trim();if(r!==M)return r}}return null},s=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const y=t.description.match(/min\.\s*(\d+)/),h=y?parseInt(y[1],10):10,r=t.title.toLowerCase(),p=w==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return r.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${h} parties)${p}`:r.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${p}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${p}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const y=t.redirectTo.mapFilter,h=y==="village"?"Village":y==="chateau"?"ChÃ¢teau":"map",r=w==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${h}${r}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${n(t.description,v.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const y=t.description.match(/(Villageois|Loups|Autres)/i),h=t.description.match(/min\.\s*(\d+)/),r=h?parseInt(h[1],10):10,p=y?.[1]||"Tous les camps",R=t.redirectTo.chartSection;let b="kills et morts";return R==="killers-total"?b="total des kills":R==="killers-average"?b=`moyenne des kills (min. ${r} parties)`:R==="deaths-total"?b="total des morts":R==="survivors-average"&&(b=`taux de survie (min. ${r} parties)`),`Cliquez pour voir les statistiques de ${b} ${p!=="Tous les camps"?`en ${p}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const y=t.title.toLowerCase(),h=t.description.toLowerCase();return y.includes("dÃ©faite")||h.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":y.includes("loup")||h.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":y.includes("villageois")||h.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":y.includes("victoire")||h.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const y=t.redirectTo.chartSection,h=w==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return y==="camp-loup"?`Cliquez pour voir les performances camp Loup${h}`:y==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${h}`:y==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${h}`:y==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${h}`:y==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${h}`:y==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${h}`:`Cliquez pour voir les performances par camp${h}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const y=t.description.match(/min\.\s*(\d+)/),h=y?parseInt(y[1],10):25,r=w==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",p=t.title.toLowerCase();return p.includes("agressivitÃ©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${h} meetings)${r}`:p.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${h} meetings)${r}`:p.includes("prÃ©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${r}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${r}`}break;case"loot":if(t.redirectTo.subTab==="lootStats"){const y=t.description.match(/min\.\s*(\d+)/),h=y?parseInt(y[1],10):25,r=w==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de rÃ©colte (min. ${h} parties)${r}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(w==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},o=t=>c[t]||We(t),j=t=>{const M=[/avec ([^:]+?):/,/contre ([^:]+?):/];let W=t;return M.forEach(y=>{const h=t.match(y);if(h&&h[1]){const r=h[1].trim(),R=`<span class="player-name-highlight" style="color: ${o(r)};">${r}</span>`;W=W.replace(r,R)}}),W};if(a.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:d}),e.jsx("p",{children:C||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const l=t=>t===1?"ðŸ¥‡":t===2?"ðŸ¥ˆ":t===3?"ðŸ¥‰":"",f=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",T=(t,M)=>{if(!t||t<=3||!M)return;const W=t-3,y=M-3;return y<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(W-1)/(y-1))}, 70%, 50%)`},N=(t,M)=>{if(!t||!M)return;if(M<=1)return"hsl(0, 70%, 50%)";const W=(t-1)/(M-1),y=W*15,h=50-W*15;return`hsl(${y}, 70%, ${h}%)`},z=t=>{if(!t)return;const M=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(M){const[,W,y]=M;return`hsl(${W}, ${y}%, 40%)`}return t},L=a.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,M)=>(t.rank??999)-(M.rank??999)),A=a.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,M)=>(t.rank??999)-(M.rank??999)),$=a.filter(t=>t.category==="comparison"),K=[...L,...A].sort((t,M)=>(t.rank??999)-(M.rank??999)),B=L.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:d}),B>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:L.filter(t=>t.rank&&t.rank<=3).map((t,M)=>e.jsxs("div",{className:`top3-card ${f(t.rank)} animate-slide-in`,style:{animationDelay:`${M*.15}s`},onClick:W=>i(t,W),title:s(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:l(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:t.title}),e.jsx("p",{className:"top3-achievement-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},t.id))})]}),K.length>0&&e.jsxs("div",{className:"achievements-section unified-rankings",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:K.filter(t=>t.type==="bad"?!0:!t.rank||t.rank>3).map((t,M)=>{const W=t.type==="bad",y=W?N(t.rank,t.totalRanked):T(t.rank,t.totalRanked),h=z(y),r=W?"":f(t.rank);return e.jsxs("div",{className:`achievement-card ${W?"bad":"good"} ${r}`,onClick:p=>i(t,p),title:s(t),style:{animationDelay:`${M*.05}s`,borderLeftColor:h,borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsxs("span",{className:"achievement-title",children:[W&&"ðŸ’€ ",t.title]}),e.jsxs("span",{className:"achievement-rank",style:y?{backgroundColor:y}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:t.description})]},t.id)})})]}),$.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques CoÃ©quipiers et Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:$.map(t=>e.jsxs("div",{className:"achievement-card comparison",onClick:M=>i(t,M),title:s(t),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:t.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:j(t.description)}})]},t.id))})]})]})}function st({selectedPlayerName:a,groupingMethod:d,campFilter:C="all"}){const{navigateToGameDetails:w}=re(),{data:S,isLoading:x,error:k}=pe(a),v=P.useMemo(()=>{switch(d){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[d]),u=P.useMemo(()=>{if(!S?.games)return new Map;const n=new Map;return S.games.forEach(s=>{if(!n.has(s.date)){const o=s.date.split("/");o.length===3?n.set(s.date,new Date(parseInt(o[2]),parseInt(o[1])-1,parseInt(o[0])).getTime()):n.set(s.date,new Date(s.date).getTime())}}),n},[S?.games]),g=P.useMemo(()=>{if(!S?.games)return[];const n={};return S.games.forEach(s=>{if(C!=="all"){if(C==="solo"){if(s.camp==="Villageois"||s.camp==="Loup")return}else if(s.camp!==C)return}let o;const j=s.date.split("/");if(d==="month")if(j.length===3)o=`${j[1].padStart(2,"0")}/${j[2]}`;else{const l=new Date(s.date);o=`${String(l.getMonth()+1).padStart(2,"0")}/${l.getFullYear()}`}else if(d==="quarter")if(j.length===3){const l=parseInt(j[1],10);o=`T${Math.floor((l-1)/3)+1}/${j[2]}`}else{const l=new Date(s.date);o=`T${Math.floor(l.getMonth()/3)+1}/${l.getFullYear()}`}else d==="year"?j.length===3?o=`${j[2]}`:o=`${new Date(s.date).getFullYear()}`:o=s.date;n[o]||(n[o]={games:[],wins:0,total:0}),n[o].games.push(s),n[o].total++,s.won&&n[o].wins++}),Object.entries(n).map(([s,o])=>({period:s,totalGames:o.total,victories:o.wins,defeats:o.total-o.wins,winRate:o.total>0?(o.wins/o.total*100).toFixed(1):"0.0",winRateNum:o.total>0?o.wins/o.total*100:0})).sort((s,o)=>{if(d==="month"){const[j,l]=s.period.split("/"),[f,T]=o.period.split("/"),N=new Date(parseInt(l),parseInt(j)-1,1),z=new Date(parseInt(T),parseInt(f)-1,1);return N.getTime()-z.getTime()}else if(d==="quarter"){const[j,l]=s.period.split("/"),[f,T]=o.period.split("/"),N=parseInt(j.replace(/\D/g,""),10)||1,z=parseInt(f.replace(/\D/g,""),10)||1,L=new Date(parseInt(l,10),(N-1)*3,1),A=new Date(parseInt(T,10),(z-1)*3,1);return L.getTime()-A.getTime()}else if(d==="year"){const j=parseInt(s.period,10),l=parseInt(o.period,10);return j-l}else{const j=u.get(s.period)||0,l=u.get(o.period)||0;return j-l}})},[S,d,u,C]),i=(n=>n<=15?{fontSize:12,angle:-45,height:80,interval:0}:n<=30?{fontSize:12,angle:-45,height:85,interval:1}:n<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(n/12)})(g.length);return x?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):k?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",k]}):S?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",v]}),e.jsx(U,{title:`Ã‰volution des Performances ${v}`,children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(qe,{data:g,margin:{top:20,right:30,left:20,bottom:20},onClick:n=>{if(n&&n.activeLabel){const s=g.find(o=>o.period===n.activeLabel);s&&w({selectedPlayer:a,selectedDate:s.period,fromComponent:`Ã‰volution des Performances ${v}`})}},style:{cursor:"pointer"},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"period",angle:i.angle,textAnchor:"end",height:i.height,interval:i.interval,fontSize:i.fontSize}),e.jsx(Z,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(_,{content:({active:n,payload:s})=>{if(n&&s&&s.length>0){const o=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:o.period})}),e.jsxs("div",{children:["Parties: ",o.totalGames]}),e.jsxs("div",{children:["Victoires: ",o.victories]}),e.jsxs("div",{children:["Taux: ",o.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Le,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",v]}),e.jsx(U,{title:`RÃ©partition Victoires/DÃ©faites ${v}`,children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:g,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"period",angle:i.angle,textAnchor:"end",height:i.height,interval:i.interval,fontSize:i.fontSize}),e.jsx(Z,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(_,{content:({active:n,payload:s})=>{if(n&&s&&s.length>0){const o=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:o.period})}),e.jsxs("div",{children:["Total: ",o.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",o.victories]}),e.jsxs("div",{children:["DÃ©faites: ",o.defeats]}),e.jsxs("div",{children:["Taux: ",o.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Q,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:g.map((n,s)=>e.jsx(X,{fill:"var(--accent-tertiary)",onClick:()=>{w({selectedPlayer:a,selectedDate:n.period,fromComponent:`Historique Joueur - Victoires ${v}`})},style:{cursor:"pointer"}},`cell-victories-${s}`))}),e.jsx(Q,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:g.map((n,s)=>e.jsx(X,{fill:"var(--chart-color-4)",onClick:()=>{w({selectedPlayer:a,selectedDate:n.period,fromComponent:`Historique Joueur - DÃ©faites ${v}`})},style:{cursor:"pointer"}},`cell-defeats-${s}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function it({selectedPlayerName:a}){const{navigateToGameDetails:d}=re(),{data:C,isLoading:w,error:S}=pe(a),x=oe(),k=P.useMemo(()=>C?.campStats?Object.entries(C.campStats).map(([u,g])=>({name:u,value:g.appearances,winRate:g.winRate,winRateDisplay:Math.max(parseFloat(g.winRate),1),wins:g.wins,percentage:(g.appearances/C.totalGames*100).toFixed(1)})):[],[C]),v=P.useMemo(()=>{if(!k.length)return[];const u=5;let g=0;const c=[],i=[];if(k.forEach(n=>{parseFloat(n.percentage)<u?(g+=Number(n.value),c.push(n)):i.push(n)}),g>0){const n=k.reduce((s,o)=>s+Number(o.value),0);i.push({name:"Autres",value:g,winRate:"0.0",winRateDisplay:1,wins:c.reduce((s,o)=>s+o.wins,0),percentage:(g/n*100).toFixed(1),_details:c})}return i},[k]);return w?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):S?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",S]}):C?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(Pe,{children:[e.jsx(De,{data:v,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:u=>{const g=u.percent!==void 0?u.percent:0;return u.name==="Autres"?`Autres : ${u.value} (${(g*100).toFixed(1)}%)`:`${u.name}: ${u.value} (${(g*100).toFixed(1)}%)`},children:v.map((u,g)=>e.jsx(X,{fill:u.name==="Autres"?ke:x[u.name]||`var(--chart-color-${g%6+1})`,onClick:()=>{if(u.name==="Autres"){const c=u._details?.map(i=>i.name)||[];d({selectedPlayer:a,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:c},fromComponent:"Distribution par Camps"})}else u.name==="TraÃ®tre"||u.name==="Louveteau"?d({selectedPlayer:a,campFilter:{selectedCamp:u.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):u.name==="Loup"?d({selectedPlayer:a,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):d({selectedPlayer:a,campFilter:{selectedCamp:u.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${g}`))}),e.jsx(_,{content:({active:u,payload:g})=>{if(u&&g&&g.length>0){const c=g[0].payload;if(c.name==="Autres"&&c._details){const i=[...c._details].sort((n,s)=>s.value-n.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",c.value," parties (",c.percentage,"%)"]})}),e.jsx("div",{children:i.map((n,s)=>e.jsxs("div",{children:[n.name,": ",n.value," parties (",n.percentage,"%)"]},s))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[c.name," - ",c.value," parties (",c.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(U,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:k,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Z,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(_,{content:({active:u,payload:g})=>{if(u&&g&&g.length>0){const c=g[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:c.name})}),e.jsxs("div",{children:["Victoires: ",c.wins," / ",c.value]}),e.jsxs("div",{children:["Taux: ",c.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Q,{dataKey:"winRateDisplay",children:k.map((u,g)=>e.jsx(X,{fill:parseFloat(u.winRate)===0?`${x[u.name]||`var(--chart-color-${g%6+1})`}50`:x[u.name]||`var(--chart-color-${g%6+1})`,onClick:()=>{u.name==="TraÃ®tre"||u.name==="Louveteau"?d({selectedPlayer:a,campFilter:{selectedCamp:u.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):u.name==="Loup"?d({selectedPlayer:a,campFilter:{selectedCamp:u.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):d({selectedPlayer:a,campFilter:{selectedCamp:u.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${g}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function nt({selectedPlayerName:a}){const{navigateToGameDetails:d,navigationState:C,updateNavigationState:w}=re(),[S,x]=P.useState(C.playerHistoryMapState?.selectedCamp||"Tous les camps"),{data:k}=Ee(),{data:v,isLoading:u,error:g}=pe(a,S);P.useEffect(()=>{(!C.playerHistoryMapState||C.playerHistoryMapState.selectedCamp!==S)&&w({playerHistoryMapState:{selectedCamp:S}})},[S,C.playerHistoryMapState,w]);const c=n=>{x(n),w({playerHistoryMapState:{selectedCamp:n}})},i=P.useMemo(()=>{if(!v?.mapStats)return[];const n=rt(v.mapStats);return Object.entries(n).map(([s,o])=>({name:s,value:o.appearances,winRate:o.winRate,winRateDisplay:Math.max(parseFloat(o.winRate),.1),wins:o.wins,percentage:(o.appearances/v.totalGames*100).toFixed(1)}))},[v]);return u?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):g?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]}):v?e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Performance par Carte",S!=="Tous les camps"?` (${S})`:""]}),e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select-map",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select-map",value:S,onChange:n=>c(n.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),k?.map(n=>e.jsx("option",{value:n,children:n},n))]})]}),i.length===0?e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de carte disponible"}),e.jsx("p",{children:"Aucune statistique de carte n'est disponible pour ce joueur avec le camp sÃ©lectionnÃ©."})]}):e.jsx(U,{title:"Performance par Carte",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:i,margin:{top:20,right:140,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Z,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(ye,{y:50,stroke:"var(--text-secondary)",strokeDasharray:"5 5",strokeOpacity:.5}),(()=>{if(i.length>0){const n=i.reduce((j,l)=>j+l.value,0),s=i.reduce((j,l)=>j+l.wins,0),o=n>0?s/n*100:0;if(o!==50)return e.jsx(ye,{y:o,stroke:"var(--accent-primary)",strokeDasharray:"3 3",strokeOpacity:.7,label:{value:`Moyenne: ${o.toFixed(1)}%`,position:"right",offset:5,style:{fill:"var(--accent-primary)"}}})}return null})(),e.jsx(_,{content:({active:n,payload:s})=>{if(n&&s&&s.length>0){const o=s[0].payload,j=[];return i.forEach(l=>{if(l.name!==o.name&&l.value>=5){const f=parseFloat(o.winRate)-parseFloat(l.winRate);Math.abs(f)>=2&&j.push({map:l.name,diff:f,better:f>0})}}),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:"250px"},children:[e.jsx("div",{children:e.jsx("strong",{children:o.name})}),e.jsxs("div",{children:["Parties: ",o.value]}),e.jsxs("div",{children:["Victoires: ",o.wins]}),e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("strong",{children:["Taux: ",o.winRate,"%"]})}),j.length>0&&e.jsxs("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"0.8rem",fontWeight:"bold",marginBottom:"0.25rem"},children:"Comparaisons:"}),j.map((l,f)=>e.jsxs("div",{style:{fontSize:"0.75rem",color:l.better?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[l.better?"â†—":"â†˜"," ",Math.abs(l.diff).toFixed(1),"% vs ",l.map]},f))]}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Q,{dataKey:"winRateDisplay",label:n=>{const{x:s,y:o,width:j,payload:l}=n;if(s===void 0||o===void 0||j===void 0||!l)return null;const f=l.winRate||"0";return e.jsxs("text",{x:s+j/2,y:o-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[f,"%"]})},onClick:n=>{if(n&&n.name){const s={selectedPlayer:a,selectedMapName:n.name,fromComponent:"Performance par Carte"};S!=="Tous les camps"&&(s.campFilter={selectedCamp:S,campFilterMode:"all-assignments"}),d(s)}},children:i.map((n,s)=>{let o;n.name==="Village"?o="var(--accent-tertiary)":n.name==="ChÃ¢teau"?o="var(--accent-secondary)":n.name==="Autres"?o=ke:o=`var(--chart-color-${s%6+1})`;const j=Math.max(...i.map(f=>parseFloat(f.winRate))),l=parseFloat(n.winRate)===j&&j>0;return e.jsx(X,{fill:parseFloat(n.winRate)===0?`${o}30`:o,stroke:"transparent",strokeWidth:l?3:1,style:{cursor:"pointer"}},`cell-map-${s}`)})})]})})})})]})}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function ot({selectedPlayerName:a}){const{gameData:d}=we(),{joueursData:C}=de(),w=xe(C),S=oe(),x=P.useMemo(()=>{if(!d||!a)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const v={},u={},g={},c=new Set;d.forEach(j=>{const l=j.PlayerStats.find(f=>f.Username.toLowerCase()===a.toLowerCase());if(l&&(j.PlayerStats.forEach(f=>{f.KillerName?.toLowerCase()===a.toLowerCase()&&(v[f.Username]=(v[f.Username]||0)+1)}),l.KillerName&&(u[l.KillerName]=(u[l.KillerName]||0)+1),l.DeathType)){const f=l.DeathType,T=ne(f);g[T]||(g[T]={count:0,byDeathType:{}}),g[T].count+=1,g[T].byDeathType[f]=(g[T].byDeathType[f]||0)+1,c.add(f)}});const i=Object.entries(v).map(([j,l])=>({player:j,kills:l})).sort((j,l)=>l.kills-j.kills).slice(0,10),n=Object.entries(u).map(([j,l])=>({player:j,kills:l})).sort((j,l)=>l.kills-j.kills).slice(0,10),s=Object.entries(g).map(([j,l])=>{const f={deathType:j,count:l.count};return f[j]=l.count,f}).sort((j,l)=>l.count-j.count).slice(0,10),o=Object.keys(g);return{playersKilled:i,killedBy:n,deathTypes:s,availableDeathTypes:o}},[d,a]),k=P.useMemo(()=>{const v={};x.availableDeathTypes.forEach(c=>{c==="TuÃ© par Loup"?v[c]=S.Loup:c==="Mort aux votes"?v[c]="var(--chart-color-1)":c.includes("Chasseur")?v[c]=S.Chasseur:c==="TuÃ© par Zombie"?v[c]=S.Vaudou:c==="TuÃ© par potion assassin"?v[c]=S.Alchimiste:c==="TuÃ© par Vengeur"?v[c]="var(--chart-color-2)":c==="Amoureux mort"?v[c]=S.Amoureux:c==="TuÃ© par La BÃªte"?v[c]="var(--chart-color-3)":c==="TuÃ© par ShÃ©rif"&&(v[c]="var(--chart-color-4)")});const u=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let g=0;return x.availableDeathTypes.forEach(c=>{v[c]||(v[c]=u[g%u.length],g++)}),v},[x.availableDeathTypes,S]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[x.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(U,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:x.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Z,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(_,{content:({active:v,payload:u})=>{if(v&&u&&u.length>0){const g=u[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:g.player})}),e.jsxs("div",{children:["TuÃ© ",g.kills," fois par ",a]})]})}return null}}),e.jsx(Q,{dataKey:"kills",children:x.playersKilled.map((v,u)=>e.jsx(X,{fill:w[v.player]||"var(--chart-color-3)"},`cell-killed-${u}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[a," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),x.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(U,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:x.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Z,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(_,{content:({active:v,payload:u})=>{if(v&&u&&u.length>0){const g=u[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:g.player})}),e.jsxs("div",{children:["A tuÃ© ",a," ",g.kills," fois"]})]})}return null}}),e.jsx(Q,{dataKey:"kills",children:x.killedBy.map((v,u)=>e.jsx(X,{fill:w[v.player]||"var(--chart-color-4)"},`cell-killer-${u}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[a," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),x.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(U,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:x.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(Z,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(_,{content:({active:v,payload:u})=>{if(v&&u&&u.length>0){const g=u[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:g.deathType})}),e.jsxs("div",{children:[a," est mort ",g.count," fois ainsi"]})]})}return null}}),x.availableDeathTypes.map(v=>e.jsx(Q,{dataKey:v,name:v,stackId:"deaths",fill:k[v]||"var(--chart-color-5)"},v))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",a,"."]})]})]})}function lt(a,d){if(!a||a.trim()===""||d.length===0)return null;const C=new Map,w=new Map,S=new Map;d.forEach(g=>{if(!g.Modded)return;const c=g.PlayerStats.find(i=>te(i)===a||i.Username.toLowerCase()===a.toLowerCase());if(c){if(c.MainRoleInitial==="Inconnu")return;const i=c.Victorious,s=Se(c.MainRoleInitial,c.MainRoleChanges||[])!==c.MainRoleInitial,o=ce(c.MainRoleInitial),j=o==="Loup"||o==="TraÃ®tre"||o==="Louveteau";if(o==="Villageois"&&ve(c)){const l=je(c);if(l&&Ge.includes(l)){const f=C.get(l)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};C.set(l,{appearances:f.appearances+1,wins:f.wins+(i?1:0),winsWithoutRoleChange:f.winsWithoutRoleChange+(!s&&i?1:0),gamesWithoutRoleChange:f.gamesWithoutRoleChange+(s?0:1)})}}else if(c.Power&&c.Power.trim()!==""&&c.Power!=="Inconnu"){if(o==="Villageois"){const l=C.get(c.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};C.set(c.Power,{appearances:l.appearances+1,wins:l.wins+(i?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!s&&i?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(s?0:1)})}else if(j){const l=w.get(c.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},f=l.roleBreakdown;f.set(c.MainRoleInitial,(f.get(c.MainRoleInitial)||0)+1),w.set(c.Power,{appearances:l.appearances+1,wins:l.wins+(i?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!s&&i?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(s?0:1),roleBreakdown:f})}}else if((o==="Villageois"||j)&&c.Power!=="Inconnu")if(o==="Villageois"){const l=C.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};C.set("Aucun pouvoir",{appearances:l.appearances+1,wins:l.wins+(i?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!s&&i?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(s?0:1)})}else{const l=w.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},f=l.roleBreakdown;f.set(c.MainRoleInitial,(f.get(c.MainRoleInitial)||0)+1),w.set("Aucun pouvoir",{appearances:l.appearances+1,wins:l.wins+(i?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!s&&i?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(s?0:1),roleBreakdown:f})}if(c.SecondaryRole&&c.SecondaryRole.trim()!==""&&c.SecondaryRole!=="Inconnu"){const l=S.get(c.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};S.set(c.SecondaryRole,{appearances:l.appearances+1,wins:l.wins+(i?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!s&&i?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(s?0:1)})}}});const x=new Map;d.forEach(g=>{const c=g.PlayerStats.find(i=>te(i)===a||i.Username.toLowerCase()===a.toLowerCase());if(c&&ve(c)){const i=je(c);i&&x.set(i,(x.get(i)||0)+1)}});const k=g=>Array.from(g.entries()).map(([c,i])=>({name:c,appearances:i.appearances,wins:i.wins,winsWithoutRoleChange:i.winsWithoutRoleChange,gamesWithoutRoleChange:i.gamesWithoutRoleChange,winRate:i.gamesWithoutRoleChange>0?(i.winsWithoutRoleChange/i.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...x.has(c)&&{totalGamesAllModes:x.get(c)}})).sort((c,i)=>i.appearances-c.appearances),v=g=>Array.from(g.entries()).map(([c,i])=>({name:c,appearances:i.appearances,wins:i.wins,winsWithoutRoleChange:i.winsWithoutRoleChange,gamesWithoutRoleChange:i.gamesWithoutRoleChange,winRate:i.gamesWithoutRoleChange>0?(i.winsWithoutRoleChange/i.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(i.roleBreakdown.entries()).map(([n,s])=>({role:n,count:s})).sort((n,s)=>s.count-n.count)})).sort((c,i)=>i.appearances-c.appearances),u=g=>Array.from(g.entries()).map(([c,i])=>({name:c,appearances:i.appearances,wins:i.wins,winsWithoutRoleChange:i.winsWithoutRoleChange,gamesWithoutRoleChange:i.gamesWithoutRoleChange,winRate:i.gamesWithoutRoleChange>0?(i.winsWithoutRoleChange/i.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((c,i)=>i.appearances-c.appearances);return{villageoisPowers:k(C),loupPowers:v(w),secondaryRoles:u(S)}}function ct({selectedPlayerName:a}){const{navigateToGameDetails:d,navigationState:C,updateNavigationState:w}=re(),S=oe(),[x,k]=P.useState(C.playerHistoryRolesState?.chartMode||"appearances"),{data:v,isLoading:u,error:g}=ge(f=>lt(a,f));P.useEffect(()=>{(!C.playerHistoryRolesState||C.playerHistoryRolesState.chartMode!==x)&&w({playerHistoryRolesState:{chartMode:x}})},[x,C.playerHistoryRolesState,w]);const c=f=>{k(f),w({playerHistoryRolesState:{chartMode:f}})},i=P.useMemo(()=>{if(!v)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const f=1,T=1,N=15,z=x==="winRate"?(A,$)=>parseFloat($.winRate)-parseFloat(A.winRate):(A,$)=>$.appearances-A.appearances,L=A=>({...A,winRateDisplay:Math.max(parseFloat(A.winRate),1)});return{villageoisPowers:v.villageoisPowers.filter(A=>A.appearances>=f).map(L).sort(z).slice(0,N),loupPowers:v.loupPowers.filter(A=>A.appearances>=f).map(L).sort(z).slice(0,N),secondaryRoles:v.secondaryRoles.filter(A=>A.appearances>=T).map(L).sort(z).slice(0,N)}},[v,x]);if(u)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(g)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]});if(!v)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const n=i.villageoisPowers.length>0,s=i.loupPowers.length>0,o=i.secondaryRoles.length>0;if(!n&&!s&&!o)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const j=({active:f,payload:T})=>{if(f&&T&&T.length>0){const N=T[0].payload,z=N.gamesWithoutRoleChange<N.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:N.name})}),e.jsxs("div",{children:["Apparitions: ",N.appearances]}),z&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",N.appearances-N.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",N.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",N.winRate,"%"]})}),N.totalGamesAllModes&&N.totalGamesAllModes!==N.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",N.totalGamesAllModes,")"]}),N.roleBreakdown&&N.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),N.roleBreakdown.map((L,A)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",L.role,": ",L.count]},A))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},l=(f,T,N,z,L)=>{const A=x==="appearances"?"appearances":"winRateDisplay",$=x==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",K=x==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:T}),e.jsx(U,{title:T,children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:f,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Z,{label:{value:$,angle:270,position:"left",style:{textAnchor:"middle"}},domain:K}),e.jsx(_,{content:e.jsx(j,{})}),e.jsx(Q,{dataKey:A,label:x==="winRate"?B=>{const{x:t,y:M,width:W,payload:y}=B;if(t===void 0||M===void 0||W===void 0||!y)return null;const h=y.winRate||"0";return e.jsxs("text",{x:t+W/2,y:M-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[h,"%"]})}:void 0,children:f.map((B,t)=>e.jsx(X,{fill:L?L(B.name,t):N,onClick:()=>z(B.name),style:{cursor:"pointer"}},`cell-${t}`))})]})})})})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:x,onChange:f=>c(f.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[n&&l(i.villageoisPowers,"Camp Villageois","var(--chart-color-1)",f=>{d({selectedPlayer:a,campFilter:{selectedCamp:"Villageois",campFilterMode:x==="winRate"?"wins-only":"all-assignments"},selectedPower:f,fromComponent:`Historique des RÃ´les - Pouvoir: ${f}`})},f=>f==="Chasseur"&&S.Chasseur?S.Chasseur:f==="Alchimiste"&&S.Alchimiste?S.Alchimiste:f==="Protecteur"&&S.Protecteur?S.Protecteur:f==="Disciple"&&S.Disciple?S.Disciple:"var(--chart-color-1)"),s&&l(i.loupPowers,"Camp Loups","var(--chart-color-2)",f=>{d({selectedPlayer:a,campFilter:{selectedCamp:"Loup",campFilterMode:x==="winRate"?"wins-only":"all-assignments"},selectedPower:f,fromComponent:`Historique des RÃ´les - Pouvoir: ${f}`})},()=>S.Loup||"var(--chart-color-2)"),o&&l(i.secondaryRoles,"RÃ´les Secondaires","var(--chart-color-3)",f=>{d({selectedPlayer:a,selectedSecondaryRole:f,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${f}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}function Ce(a,d){return d>=-250&&d<=100&&a>=-450&&a<=-120?"Village Principal":d>=-550&&d<=-250&&a>=-150&&a<=150?"Ferme":d>=150&&d<=500&&a>=-320&&a<=80?"Village PÃªcheur":d>=-220&&d<=200&&a>=100&&a<=450?"Ruines":"Reste de la Carte"}function le(a){return a==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":a}function dt({selectedPlayerName:a}){const{navigateToGameDetails:d}=re(),{gameData:C,isLoading:w,error:S}=we(),x=oe(),[k,v]=P.useState("deaths"),[u,g]=P.useState(""),[c,i]=P.useState(0),[n,s]=P.useState(null),[o,j]=P.useState([]),[l,f]=P.useState(!1),T=P.useMemo(()=>{if(!C)return[];const r=new Set;return C.forEach(p=>{const R=p.PlayerStats.find(b=>b.Username.toLowerCase()===a.toLowerCase());R&&(R.DeathPosition!==null&&p.MapName&&r.add(p.MapName),p.PlayerStats.forEach(b=>{b.KillerName?.toLowerCase()===a.toLowerCase()&&b.DeathPosition!==null&&p.MapName&&r.add(p.MapName)}))}),Array.from(r).filter(p=>p==="Village"||p==="ChÃ¢teau").sort((p,R)=>p==="Village"?-1:R==="Village"?1:p.localeCompare(R))},[C,a]),N=T.length>0?T[0]:"";u===""&&N!==""&&g(N);const{availableDeathTypes:z,deathTypeColors:L}=P.useMemo(()=>{if(!C||!a)return{availableDeathTypes:[],deathTypeColors:{}};const r=new Set,p={};return C.forEach(R=>{const b=R.PlayerStats.find(F=>F.Username.toLowerCase()===a.toLowerCase());if(b){if(b.DeathPosition&&b.DeathType){const F=le(b.DeathType);F&&r.add(F)}R.PlayerStats.forEach(F=>{if(F.KillerName?.toLowerCase()===a.toLowerCase()&&F.DeathPosition&&F.DeathType){const m=le(F.DeathType);m&&r.add(m)}})}}),r.forEach(R=>{p[R]=Be(R,x)}),{availableDeathTypes:Array.from(r).sort(),deathTypeColors:p}},[C,a,x]),A=r=>r&&L[r]||"var(--text-secondary)";P.useEffect(()=>{if(o.length===0&&z.length>0){const r=z.filter(p=>p!=="VOTED");j(r)}},[z.length]);const $=P.useMemo(()=>{if(!C||!a)return[];const r=[];return C.forEach(p=>{if(u&&p.MapName!==u)return;const R=p.PlayerStats.find(b=>b.Username.toLowerCase()===a.toLowerCase());if(R)if(k==="deaths"){if(R.DeathPosition){const b=ce(R.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),F=ue(R.DeathPosition.x,R.DeathPosition.z,p.MapName);r.push({x:F.x,z:F.z,victimName:R.Username,killerName:R.KillerName||null,deathType:le(R.DeathType),mapName:p.MapName,camp:b,gameId:p.DisplayedId,displayedGameId:p.DisplayedId})}}else p.PlayerStats.forEach(b=>{if(b.KillerName?.toLowerCase()===a.toLowerCase()&&b.DeathPosition){const F=ce(b.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),m=ue(b.DeathPosition.x,b.DeathPosition.z,p.MapName);r.push({x:m.x,z:m.z,victimName:b.Username,killerName:a,deathType:le(b.DeathType),mapName:p.MapName,camp:F,gameId:p.DisplayedId,displayedGameId:p.DisplayedId})}})}),o.length>0&&o.length<z.length?r.filter(p=>p.deathType&&o.includes(p.deathType)):r},[C,a,k,u,o,z]),K=P.useMemo(()=>{if(u!=="Village"||k!=="deaths")return null;const r=$.filter(q=>q.deathType!=="VOTED");if(r.length===0)return null;const p={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};if(r.forEach(q=>{const E=Ce(q.x,q.z);p[E]=(p[E]||0)+1}),!C)return null;const R={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};C.forEach(q=>{q.MapName==="Village"&&q.PlayerStats.forEach(E=>{if(!E.DeathPosition||E.DeathType==="VOTED")return;const V=ue(E.DeathPosition.x,E.DeathPosition.z,"Village"),O=Ce(V.x,V.z);R[O]=(R[O]||0)+1})});const b=Object.values(R).reduce((q,E)=>q+E,0),F=Object.values(p).reduce((q,E)=>q+E,0);if(b===0||F===0)return null;const m=["Village Principal","Village PÃªcheur","Ferme","Ruines","Reste de la Carte"];let D=0,G=null;const I=m.map(q=>{const E=p[q]/F*100,V=R[q]/b*100,O=E-V;return O>D&&p[q]>=2&&(D=O,G=q),{zone:q,playerCount:p[q],playerPercent:E,avgPercent:V,deviation:O}});return{totalPlayerDeaths:F,totalAllDeaths:b,zoneStats:I,dominantZone:G,maxDeviation:D}},[$,u,k,C]),B=P.useMemo(()=>Oe($,c).map((p,R)=>{const b=p.items[0],F=Ke(p.items);return{x:p.centroidX,z:p.centroidZ,count:p.items.length,allLocations:p.items,victimName:p.items.length===1?b.victimName:null,killerName:p.items.length===1?b.killerName:null,deathType:F,mapName:b.mapName,camp:b.camp,gameId:p.items.length===1?b.gameId:null,displayedGameId:p.items.length===1?b.displayedGameId:null,clusterIndex:R}}),[$,c]),t=P.useMemo(()=>He(u),[u]),{xDomain:M,zDomain:W}=P.useMemo(()=>{if(t)return{xDomain:[t.xMin,t.xMax],zDomain:[t.zMin,t.zMax]};if(B.length===0)return{xDomain:[0,100],zDomain:[0,100]};const r=B.map(I=>I.x),p=B.map(I=>I.z),R=Math.min(...r),b=Math.max(...r),F=Math.min(...p),m=Math.max(...p),D=(b-R)*.1||10,G=(m-F)*.1||10;return{xDomain:[R-D,b+D],zDomain:[F-G,m+G]}},[B,t]),y=({active:r,payload:p})=>{if(!r||!p||p.length===0)return null;const R=p[0].payload,b=R.allLocations||[R];if(b.length>1){const D=new Map,G=new Map,I=new Set;b.forEach(V=>{D.set(V.victimName,(D.get(V.victimName)||0)+1);const O=V.deathType?ne(V.deathType):"Inconnu";G.set(O,(G.get(O)||0)+1),I.add(V.gameId)});const q=Array.from(D.entries()).sort((V,O)=>O[1]-V[1]).slice(0,3),E=Array.from(G.entries()).sort((V,O)=>O[1]-V[1]).slice(0,3);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[k==="deaths"?"ðŸ’€":"âš”ï¸"," ",b.length," ",k==="deaths"?"morts":"kills"," Ã  cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:k==="deaths"?"Par:":"Victimes:"}),q.map(([V,O])=>e.jsxs("div",{style:{paddingLeft:"0.5rem"},children:["â€¢ ",V," (",O,"x)"]},V)),D.size>3&&e.jsxs("div",{style:{paddingLeft:"0.5rem",color:"var(--text-secondary)"},children:["+",D.size-3," autres..."]})]}),e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Types de mort:"}),E.map(([V,O])=>e.jsxs("div",{style:{paddingLeft:"0.5rem"},children:["â€¢ ",V," (",O,"x)"]},V))]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["ðŸ“ ",I.size," partie",I.size>1?"s":""," diffÃ©rente",I.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const m=b[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[k==="deaths"?"ðŸ’€":"âš”ï¸"," ",k==="deaths"?"Mort de":"Kill de"," ",a]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[k==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"TuÃ© par:"})," ",m.killerName||"Inconnu"]}),e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Cause:"})," ",m.deathType?ne(m.deathType):"Inconnue"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Victime:"})," ",m.victimName]}),e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Cause:"})," ",m.deathType?ne(m.deathType):"Inconnue"]}),e.jsxs("div",{children:["ðŸ‘¥ ",e.jsx("strong",{children:"Camp victime:"})," ",m.camp]})]}),e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",m.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",m.gameId]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})},h=r=>{if(!r)return;const p=r.allLocations||[r];if(p.length===1)d({selectedGame:p[0].gameId,fromComponent:"Player Death Map"});else{const R=p.map(b=>b.gameId).filter(b=>b);d({selectedGameIds:R,fromComponent:"Player Death Map"})}};return w?e.jsx("div",{className:"donnees-attente",children:"Chargement des donnÃ©es..."}):S?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",S]}):C?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>v("deaths"),style:{background:k==="deaths"?"var(--accent-primary)":"transparent",color:k==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:k==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"ðŸ’€ Morts"}),e.jsx("button",{type:"button",onClick:()=>v("kills"),style:{background:k==="kills"?"var(--accent-primary)":"transparent",color:k==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:k==="kills"?"bold":"normal",transition:"all 0.2s"},children:"âš”ï¸ Kills"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:u,onChange:r=>g(r.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:T.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:c,onChange:r=>i(parseInt(r.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:c===0?"Aucun":`${c} unitÃ©${c>1?"s":""}`})]}),e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>f(!l),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:l?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:l?"rotate(90deg)":"rotate(0deg)"},children:"â–¶"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[o.length," / ",z.length," sÃ©lectionnÃ©",o.length>1?"s":""]})]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),j(z)},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),j([])},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:z.map(r=>{const p=o.includes(r),R=L[r]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",background:p?"var(--bg-tertiary)":"transparent",borderRadius:"4px",border:`1px solid ${p?R:"var(--border-color)"}`,cursor:"pointer",transition:"all 0.2s",fontSize:"0.9rem"},onClick:b=>{b.stopPropagation(),j(p?F=>F.filter(m=>m!==r):F=>[...F,r])},children:[e.jsx("input",{type:"checkbox",checked:p,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:R,flexShrink:0}}),e.jsx("span",{children:ne(r)})]},r)})})]})]})]}),K&&u==="Village"&&k==="deaths"&&e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"0rem",padding:"1.5rem",background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",borderRadius:"12px",border:"2px solid var(--accent-primary)",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",color:"var(--accent-primary)",fontSize:"1.3rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"ðŸ“Š Analyse par zone (Village)"}),e.jsx("p",{style:{fontSize:"0.95rem",marginBottom:"1rem",color:"var(--text-secondary)",lineHeight:"1.5"},children:"Distribution des morts (hors votes) comparÃ©e Ã  la moyenne de tous les joueurs:"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:K.zoneStats.map(r=>{const p=r.zone===K.dominantZone&&K.maxDeviation>10;return e.jsxs("div",{onMouseEnter:()=>s(r.zone),onMouseLeave:()=>s(null),style:{padding:"1rem",background:"var(--bg-primary)",borderRadius:"8px",border:n===r.zone?"1px solid var(--accent-primary)":"1px solid var(--border-color)",color:"var(--text-primary)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.95rem"},children:r.zone}),e.jsxs("div",{style:{fontSize:"0.85rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[a,": ",e.jsxs("strong",{children:[r.playerPercent.toFixed(1),"%"]})," (",r.playerCount,")"]}),e.jsxs("div",{style:{opacity:.85},children:["Moyenne: ",r.avgPercent.toFixed(1),"%"]}),e.jsxs("div",{style:{marginTop:"0.25rem",color:p?"var(--accent-secondary)":r.deviation>0?"var(--accent-primary)":"var(--text-secondary)",fontWeight:Math.abs(r.deviation)>5?"bold":"normal"},children:[r.deviation>0?"+":"",r.deviation.toFixed(1),"% vs moyenne"]})]})]},r.zone)})}),K.dominantZone&&K.maxDeviation>10&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",fontSize:"0.95rem",color:"var(--accent-primary)",fontWeight:"bold",background:"var(--bg-primary)",borderRadius:"8px",border:"2px solid var(--accent-primary)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"âš ï¸"}),e.jsxs("span",{children:[a," meurt significativement plus souvent en zone ",K.dominantZone,"(","+"+K.maxDeviation.toFixed(1),"% par rapport Ã  la moyenne)"]})]})]}),e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:$.length>0?e.jsx(U,{title:k==="deaths"?`Carte des Morts de ${a}`:`Carte des Kills de ${a}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(_e,{margin:{top:20,right:30,left:60,bottom:20},children:[t&&e.jsx(ie,{x1:t.zMin,x2:t.zMax,y1:t.xMin,y2:t.xMax,fill:"transparent",stroke:"none",shape:r=>{const{x:p,y:R,width:b,height:F}=r;return e.jsx("image",{x:p,y:R,width:b,height:F,href:t.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),u==="Village"&&n&&e.jsxs(e.Fragment,{children:[n==="Ruines"&&e.jsx(ie,{x1:-220,x2:200,y1:100,y2:450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),n==="Village Principal"&&e.jsx(ie,{x1:-250,x2:100,y1:-120,y2:-450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),n==="Ferme"&&e.jsx(ie,{x1:-550,x2:-250,y1:150,y2:-150,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),n==="Village PÃªcheur"&&e.jsx(ie,{x1:150,x2:500,y1:80,y2:-320,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),n==="Reste de la Carte"&&e.jsx(ie,{x1:t?.zMin??-600,x2:t?.zMax??600,y1:t?.xMin??-500,y2:t?.xMax??500,fill:"var(--accent-primary)",fillOpacity:.15,stroke:"var(--accent-primary)",strokeWidth:2,strokeDasharray:"5 5"})]}),e.jsx(Y,{strokeDasharray:"3 3",stroke:t?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(J,{dataKey:"z",type:"number",name:"Position Z",domain:W,hide:!0}),e.jsx(Z,{dataKey:"x",type:"number",name:"Position X",domain:M,hide:!0}),e.jsx(_,{content:e.jsx(y,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Ue,{data:B,onClick:r=>h(r),style:{cursor:"pointer"},isAnimationActive:!1,children:B.map((r,p)=>{const R=Math.min(Math.log2(r.count+1)*3+5,18),b=Math.round(R);return e.jsx(X,{fill:A(r.deathType),stroke:r.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:r.count>1?2:1,opacity:.85,r:b},`cell-${p}`)})})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:k==="deaths"?`Aucune mort localisÃ©e pour ${a} sur cette carte.`:`Aucun kill localisÃ© pour ${a} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes."})]})}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"Ã€ propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",k==="deaths"?`les emplacements oÃ¹ ${a} est mort`:`les emplacements oÃ¹ ${a} a Ã©liminÃ© d'autres joueurs`," au cours des parties. Les couleurs indiquent le type de mort. Cliquez sur un point pour voir les dÃ©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroupÃ©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’€ Morts:"})," OÃ¹ le joueur a Ã©tÃ© Ã©liminÃ©",e.jsx("br",{}),e.jsx("strong",{children:"âš”ï¸ Kills:"})," OÃ¹ le joueur a Ã©liminÃ© d'autres joueurs"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function Te(a){return a.PlayerStats.some(d=>d.SecondsTalkedOutsideMeeting>0||d.SecondsTalkedDuringMeeting>0)}function me(a,d){const C=d.DeathDateIrl||a.EndDate,w=Re(a.StartDate,C);return w&&w>0?w:0}function pt(a){const d=a.filter(Te),C=new Map;return d.forEach(w=>{w.PlayerStats.forEach(S=>{const x=te(S),k=Ae(S),v=me(w,S);if(v<=0)return;C.has(x)||C.set(x,{displayName:k,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const u=C.get(x);u.gamesPlayed++,u.totalSecondsAll+=(S.SecondsTalkedOutsideMeeting||0)+(S.SecondsTalkedDuringMeeting||0),u.totalGameDuration+=v})}),{playerStats:C,gamesWithTalkingData:d.length}}function ut(a,d){if(!d||d.length===0||!a)return null;const C=pt(d),w=d.filter(Te);if(w.length===0||C.playerStats.size===0)return null;let S=null;for(const[h,r]of C.playerStats)if(r.displayName===a){S=h;break}if(!S)return null;let x=0,k=0,v=0,u=0;const g={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},c=new Map;let i=0,n=0,s=0,o=0;if(w.forEach(h=>{const r=h.PlayerStats.find(I=>te(I)===S);if(!r)return;const p=me(h,r);if(p<=0)return;x++;const R=r.SecondsTalkedOutsideMeeting||0,b=r.SecondsTalkedDuringMeeting||0,F=R+b;k+=R,v+=b,u+=p;const m=$e(r.MainRoleInitial,r.Power);g[m].gamesPlayed++,g[m].secondsOutside+=R,g[m].secondsDuring+=b,g[m].gameDuration+=p;const D=Ve(r);c.has(D)||c.set(D,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const G=c.get(D);G.gamesPlayed++,G.totalSecondsAll+=F,G.totalGameDuration+=p}),x===0||u<=0)return null;const j=3600/u,l=k*j,f=v*j,T=(k+v)*j,N=k+v>0?v/(k+v)*100:0,z=[];for(const[h,r]of Object.entries(g)){if(r.gamesPlayed===0)continue;const p=r.gameDuration>0?3600/r.gameDuration:0,R=r.secondsOutside+r.secondsDuring;z.push({camp:h,gamesPlayed:r.gamesPlayed,totalSecondsOutside:r.secondsOutside,totalSecondsDuring:r.secondsDuring,totalSecondsAll:R,totalGameDurationSeconds:r.gameDuration,secondsOutsidePer60Min:r.secondsOutside*p,secondsDuringPer60Min:r.secondsDuring*p,secondsAllPer60Min:R*p,meetingRatio:R>0?r.secondsDuring/R*100:0})}z.sort((h,r)=>r.gamesPlayed-h.gamesPlayed);const L=Array.from(c.entries()).filter(([h,r])=>r.gamesPlayed>=1).map(([h,r])=>({role:h,gamesPlayed:r.gamesPlayed,secondsAllPer60Min:r.totalGameDuration>0?r.totalSecondsAll/r.totalGameDuration*3600:0,totalSecondsAll:r.totalSecondsAll})).sort((h,r)=>r.secondsAllPer60Min-h.secondsAllPer60Min),A=[];for(const[h,r]of C.playerStats)r.totalGameDuration>0&&A.push({id:h,name:r.displayName,per60:r.totalSecondsAll/r.totalGameDuration*3600});A.sort((h,r)=>r.per60-h.per60);const $=A.reduce((h,r)=>h+r.per60,0),K=A.length>0?$/A.length:0,B=A.findIndex(h=>h.id===S)+1,t=A.length,M=t>0?Math.round((1-(B-1)/t)*100):0,W=T;w.forEach(h=>{const r=h.PlayerStats.find(F=>te(F)===S);if(!r)return;const p=me(h,r);if(p<=0)return;((r.SecondsTalkedOutsideMeeting||0)+(r.SecondsTalkedDuringMeeting||0))/p*3600>=W?(i++,r.Victorious&&n++):(s++,r.Victorious&&o++)});const y={gamesAboveAverage:i,winsAboveAverage:n,winRateAboveAverage:i>0?n/i*100:0,gamesBelowAverage:s,winsBelowAverage:o,winRateBelowAverage:s>0?o/s*100:0};return{playerName:a,gamesPlayed:x,gamesWithTalkingData:C.gamesWithTalkingData,totalSecondsOutside:k,totalSecondsDuring:v,totalSecondsAll:k+v,totalGameDurationSeconds:u,secondsOutsidePer60Min:l,secondsDuringPer60Min:f,secondsAllPer60Min:T,meetingRatio:N,campBreakdown:z,globalAverageSecondsAllPer60Min:K,playerRank:B,totalPlayersWithData:t,percentile:M,roleBreakdown:L,winCorrelation:y}}function mt(a,d){return a?a.roleBreakdown.slice(0,d):[]}function ht(a){const{data:d,isLoading:C,error:w}=ge(S=>a?ut(a,S):null);return{data:d,isLoading:C,error:w}}function gt({selectedPlayerName:a}){const{data:d,isLoading:C,error:w}=ht(a),S=oe(),[x,k]=P.useState("both"),v=P.useMemo(()=>d?.campBreakdown?d.campBreakdown.map(s=>({camp:s.camp,"Hors rÃ©union":Math.round(s.secondsOutsidePer60Min),"En rÃ©union":Math.round(s.secondsDuringPer60Min),total:Math.round(s.secondsAllPer60Min),gamesPlayed:s.gamesPlayed,meetingRatio:s.meetingRatio.toFixed(1)})):[],[d]),u=P.useMemo(()=>d?[{name:"En rÃ©union",value:d.totalSecondsDuring,color:"#2196F3"},{name:"Hors rÃ©union",value:d.totalSecondsOutside,color:"#FF9800"}]:[],[d]);if(C)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(w)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",w]});if(!d)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de temps de parole ne sont disponibles que pour les parties rÃ©centes."})]});const g=d.secondsAllPer60Min-d.globalAverageSecondsAllPer60Min,c=d.globalAverageSecondsAllPer60Min>0?(g/d.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",i=g>0,n=d.winCorrelation.winRateAboveAverage-d.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¤ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:se(d.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:i?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[i?"+":"",c,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",d.playerRank," / ",d.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-d.percentile+1,"% ",d.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“ˆ Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:d.gamesPlayed}),e.jsxs("p",{children:["sur ",d.gamesWithTalkingData," avec donnÃ©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ—£ï¸ Ratio en rÃ©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[d.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),v.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(U,{title:"Temps de parole par camp (par 60min de jeu)",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>k("meeting"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:x==="meeting"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:x==="meeting"?"var(--accent-primary)":"var(--bg-secondary)",color:x==="meeting"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:x==="meeting"?"bold":"normal"},children:"En rÃ©union"}),e.jsx("button",{onClick:()=>k("outside"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:x==="outside"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:x==="outside"?"var(--accent-primary)":"var(--bg-secondary)",color:x==="outside"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:x==="outside"?"bold":"normal"},children:"Hors rÃ©union"}),e.jsx("button",{onClick:()=>k("both"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:x==="both"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:x==="both"?"var(--accent-primary)":"var(--bg-secondary)",color:x==="both"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:x==="both"?"bold":"normal"},children:"Les deux"})]}),e.jsx("div",{style:{height:350},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:v,layout:"vertical",children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(J,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:s=>`${Math.floor(s/60)}m`}),e.jsx(Z,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(_,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(s,o)=>[se(s),o],labelFormatter:s=>{const o=v.find(j=>j.camp===s);return`${s} (${o?.gamesPlayed||0} parties)`}}),e.jsx(Ye,{}),(x==="both"||x==="outside")&&e.jsx(Q,{dataKey:"Hors rÃ©union",stackId:"talk",fill:"#FF9800"}),(x==="both"||x==="meeting")&&e.jsx(Q,{dataKey:"En rÃ©union",stackId:"talk",fill:"#2196F3"})]})})})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:(()=>{const s=v.find(f=>f.camp==="Villageois"),o=v.find(f=>f.camp==="Loup");if(!s||!o)return e.jsx("p",{children:"ðŸ’¡ Pas assez de donnÃ©es pour comparer les camps Villageois et Loups."});const j=s.total-o.total,l=o.total>0?(Math.abs(j)/o.total*100).toFixed(0):"0";return j>0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:a})," parle"," ",e.jsxs("strong",{style:{color:fe("Villageois")},children:[se(j)," de plus (+",l,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Villageois"})," qu'en tant que"," ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]}):j<0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:a})," parle"," ",e.jsxs("strong",{style:{color:fe("Loup")},children:[se(Math.abs(j))," de plus (+",l,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Loup"})," qu'en tant que"," ",e.jsx("strong",{children:"Villageois"})," (par heure de jeu)."]}):e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:a})," parle exactement autant en tant que"," ",e.jsx("strong",{children:"Villageois"})," qu'en tant que ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(U,{title:"RÃ©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(Pe,{children:[e.jsx(De,{data:u,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:s=>`${s.name}: ${((s.percent||0)*100).toFixed(1)}%`,children:u.map((s,o)=>e.jsx(X,{fill:s.color},`cell-${o}`))}),e.jsx(_,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:s=>se(s)})]})})})})}),d&&d.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(U,{title:s=>s?"Top 15 rÃ´les les plus bavards (par 60min)":"Top 5 rÃ´les les plus bavards (par 60min)",children:s=>{const j=mt(d,s?15:5).map(l=>({role:l.role,secondsPer60Min:Math.round(l.secondsAllPer60Min),gamesPlayed:l.gamesPlayed}));return e.jsx("div",{style:{height:s?400:300},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:j,children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(J,{dataKey:"role",tick:{fill:"var(--text-primary)",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(Z,{tick:{fill:"var(--text-secondary)"},tickFormatter:l=>`${Math.floor(l/60)}m`}),e.jsx(_,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:l=>[se(l),"Temps de parole"],labelFormatter:l=>{const f=j.find(T=>T.role===l);return`${l} (${f?.gamesPlayed||0} parties)`}}),e.jsx(Q,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",children:j.map((l,f)=>e.jsx(X,{fill:S[l.role]||S.Villageois},`cell-${f}`))})]})})})}})}),(d.winCorrelation.gamesAboveAverage>0||d.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"ðŸŽ¯ CorrÃ©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[d.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",d.winCorrelation.winsAboveAverage,"/",d.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[d.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",d.winCorrelation.winsBelowAverage,"/",d.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(n)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:a})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:n>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[n>0?"supÃ©rieur":"infÃ©rieur"," de ",Math.abs(n).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function qt(){const{settings:a,updateSettings:d}=he(),{navigateToGameDetails:C,navigationState:w,updateNavigationState:S}=re(),{data:x,isLoading:k,error:v}=Fe(),{joueursData:u,isLoading:g}=de(),{data:c,isLoading:i,error:n}=et(a.highlightedPlayer),s=xe(u),[o,j]=P.useState(""),[l,f]=P.useState(null),{clips:T}=Je(a.highlightedPlayer),{clips:N}=Ze(),[z,L]=P.useState(()=>a.useIndependentFilters&&a.independentFilters?.gameTypeEnabled?a.independentFilters.gameFilter==="modded"?"modded":"all":a.gameFilter==="modded"?"modded":"all"),A=P.useMemo(()=>a.useIndependentFilters&&a.independentFilters?.gameTypeEnabled?a.independentFilters.gameFilter==="modded":a.gameFilter==="modded",[a.useIndependentFilters,a.independentFilters?.gameTypeEnabled,a.independentFilters?.gameFilter,a.gameFilter]),[$,K]=P.useState(a.selectedPlayerSelectionView||w.selectedPlayerSelectionView||"achievements"),[B,t]=P.useState("session"),[M,W]=P.useState("all");P.useEffect(()=>{if(a.useIndependentFilters&&a.independentFilters?.gameTypeEnabled){const m=a.independentFilters.gameFilter==="modded"?"modded":"all";L(m)}else if(!a.useIndependentFilters){const m=a.gameFilter==="modded"?"modded":"all";L(m)}},[a.gameFilter,a.useIndependentFilters,a.independentFilters?.gameTypeEnabled,a.independentFilters?.gameFilter]),P.useEffect(()=>{A&&z!=="modded"&&L("modded")},[A,z]),P.useEffect(()=>{const m=a.selectedPlayerSelectionView||w.selectedPlayerSelectionView;m&&m!==$&&K(m)},[a.selectedPlayerSelectionView,w.selectedPlayerSelectionView]);const{data:y}=pe(a.highlightedPlayer||""),h=P.useMemo(()=>{if(!x||!x.GameStats)return[];const m=A?x.GameStats.filter(G=>G.Modded===!0):x.GameStats,D=new Map;return m.forEach(G=>{const I=new Date(G.StartDate);G.PlayerStats.forEach(q=>{const E=te(q),O=u?.Players?.find(Me=>Me.SteamID===E)?.Joueur||q.Username;D.has(E)||D.set(E,{games:0,wins:0,firstDate:I,lastDate:I,displayName:O});const ae=D.get(E);ae.games++,q.Victorious&&ae.wins++,I<ae.firstDate&&(ae.firstDate=I),I>ae.lastDate&&(ae.lastDate=I)})}),Array.from(D.entries()).map(([G,I])=>{let q=u?.Players?.find(E=>E.SteamID===G);return q||(q=u?.Players?.find(E=>E.Joueur===I.displayName)),{id:G,name:I.displayName,totalGames:I.games,totalWins:I.wins,winRate:I.games>0?I.wins/I.games*100:0,firstGameDate:I.firstDate.toLocaleDateString("fr-FR"),lastGameDate:I.lastDate.toLocaleDateString("fr-FR"),isHighlighted:I.displayName===a.highlightedPlayer,image:q?.Image||null,twitch:q?.Twitch||null,youtube:q?.Youtube||null}})},[x,a.highlightedPlayer,u,A]),r=P.useMemo(()=>{if(!o.trim())return h;const m=o.toLowerCase();return h.filter(D=>D.name.toLowerCase().includes(m))},[h,o]),p=P.useMemo(()=>[...r].sort((m,D)=>D.totalGames-m.totalGames),[r]),R=m=>{d({highlightedPlayer:m}),j("")},b=m=>{K(m),S({selectedPlayerSelectionView:m}),d({selectedPlayerSelectionView:m,tab:"playerSelection"})},F=()=>{if(T.length===0)return;const m=Math.floor(Math.random()*T.length);f(T[m])};return k||g?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):v?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",v]})]}):!x||h.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!a.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:o,onChange:m=>j(m.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[r.length," joueur",r.length!==1?"s":"",o&&` (filtrÃ©${r.length!==1?"s":""} de ${h.length})`]})]})]}),e.jsx("div",{className:"player-display",children:o?r.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>j(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:p.map(m=>e.jsxs("button",{type:"button",className:`suggestion-btn ${m.isHighlighted?"highlighted":""}`,onClick:()=>R(m.name),children:[m.image?e.jsx("img",{src:m.image,alt:`Photo de profil de ${m.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":s[m.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[m.name,m.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[m.totalGames," parties â€¢ ",m.winRate.toFixed(1),"% victoires"]})]})]},m.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',o,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>j(""),children:"Effacer la recherche"})]}):a.highlightedPlayer?(()=>{const m=h.find(D=>D.name===a.highlightedPlayer);return m?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:m.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[m.image?e.jsx("img",{src:m.image,alt:`Photo de profil de ${m.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":s[m.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[m.totalGames," parties â€¢ ",m.totalWins," victoires â€¢ ",m.winRate.toFixed(1),"% taux de victoire"]}),(m.twitch||m.youtube||T.length>0)&&e.jsxs("div",{className:"social-links",children:[m.twitch&&e.jsx("a",{href:m.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),m.youtube&&e.jsx("a",{href:m.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"}),T.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:D=>{D.stopPropagation(),F()},title:`${T.length} clip${T.length>1?"s":""} disponible${T.length>1?"s":""}`,children:["ðŸŽ¬ Clip alÃ©atoire (",T.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="achievements"?"active":""}`,onClick:()=>b("achievements"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="evolution"?"active":""}`,onClick:()=>b("evolution"),children:"Ã‰volution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="camps"?"active":""}`,onClick:()=>b("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="roles"?"active":""}`,onClick:()=>b("roles"),children:"RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="maptypes"?"active":""}`,onClick:()=>b("maptypes"),children:"Types de cartes"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="kills"?"active":""}`,onClick:()=>b("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="deathmap"?"active":""}`,onClick:()=>b("deathmap"),children:"Cartes"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="talkingtime"?"active":""}`,onClick:()=>b("talkingtime"),children:"Parole"})]}),$==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[i?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):n?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",n]})}):c?e.jsx(at,{achievements:z==="all"?c.allGamesAchievements:c.moddedOnlyAchievements,title:z==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:z}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[!A&&e.jsx("button",{type:"button",className:`filter-btn ${z==="all"?"active":""}`,onClick:D=>{D.stopPropagation(),L("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${z==="modded"?"active":""}`,onClick:D=>{D.stopPropagation(),L("modded")},disabled:A,children:"Parties moddÃ©es"})]})]}),$==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[y&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{C({selectedPlayer:m.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${m.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:y.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:Ie(y.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{C({selectedPlayer:m.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${m.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:y.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[y.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:B,onChange:D=>t(D.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:M,onChange:D=>W(D.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(st,{selectedPlayerName:m.name,groupingMethod:B,campFilter:M})]}),$==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(it,{selectedPlayerName:m.name})}),$==="maptypes"&&e.jsx("div",{className:"player-history-section",children:e.jsx(nt,{selectedPlayerName:m.name})}),$==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ct,{selectedPlayerName:m.name})}),$==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ot,{selectedPlayerName:m.name})}),$==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(dt,{selectedPlayerName:m.name})}),$==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(gt,{selectedPlayerName:m.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:D=>{D.stopPropagation(),d({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[m.firstGameDate," - ",m.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',a.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>d({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:p.map(m=>e.jsxs("div",{className:`character-card ${m.isHighlighted?"highlighted":""}`,onClick:()=>R(m.name),title:`${m.name} - ${m.totalGames} parties, ${m.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:m.image?e.jsx("img",{src:m.image,alt:`Photo de profil de ${m.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":s[m.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:m.name}),(m.twitch||m.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[m.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),m.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},m.id))})})}),l&&e.jsx(Qe,{clip:l,onClose:()=>f(null),relatedClips:Xe(l,N),nextClip:be(l,N),onNextClip:()=>{const m=be(l,N);m&&f(m)},onRelatedClip:m=>{const D=N.find(G=>G.ClipId===m);D&&f(D)}})]})}export{qt as PlayerSelectionPage};
