import{g as B,a as b}from"./datasyncExport-CjB7UYqV.js";import{D as L}from"./deathTypes-gHH1w6_X.js";import{g as E}from"./index-C9L6Rryr.js";function x(c,f){if(!c.DeathTiming)return!0;const T=c.DeathTiming.toUpperCase();if(T.startsWith("M")){const m=parseInt(T.substring(1));return f<=m}if(T.startsWith("N")||T.startsWith("J")){const m=parseInt(T.substring(1));return f<m}return!0}function I(c,f){return c.PlayerStats.filter(T=>x(T,f))}function N(c,f,T){const m=c.PlayerStats.find(a=>E(a)===T);return m?m.DeathType===L.VOTED&&m.DeathTiming===`M${f}`:!1}function G(c){const f=[],T=new Map,m=new Map,a=new Map;c.PlayerStats.forEach(i=>{const s=E(i),M=i.Username;T.set(s,{totalMeetings:0,totalVotes:0,totalSkips:0,totalAbstentions:0,displayName:M}),m.set(s,{totalVotes:0,votesForEnemyCamp:0,votesForOwnCamp:0}),a.set(s,{totalTimesTargeted:0,timesTargetedByEnemyCamp:0,timesTargetedByOwnCamp:0,timesTargetedAsVillager:0,timesTargetedAsWolf:0,timesTargetedAsSpecial:0,eliminationsByVote:0})});const V=Math.max(...c.PlayerStats.flatMap(i=>i.Votes.map(s=>s.Day||0)),0);for(let i=1;i<=V;i++){const s=I(c,i),M=c.PlayerStats.flatMap(n=>{const l=E(n);return n.Votes.filter(A=>A.Day===i).map(A=>({voterId:l,voterName:n.Username,vote:A,voterRole:n.MainRoleInitial}))});if(M.length===0&&c.EndTiming===`M${i}`)continue;const p=M.filter(n=>n.vote.Target!=="Passé").length,y=M.filter(n=>n.vote.Target==="Passé").length,e=s.length-M.length,t=new Map;M.filter(n=>n.vote.Target!=="Passé").forEach(n=>{const l=t.get(n.vote.Target)||0;t.set(n.vote.Target,l+1)});let o=null,g=0;for(const[n,l]of t.entries())l>g&&(o=n,g=l);let h=null;if(o&&g>0){const n=c.PlayerStats.find(l=>l.Username===o);if(n){const l=E(n);N(c,i,l)&&(h=n.Username)}}f.push({meetingNumber:i,totalParticipants:s.length,totalVotes:p,totalSkips:y,totalAbstentions:e,participationRate:s.length>0?(p+y)/s.length*100:0,mostTargetedPlayer:o,mostTargetedCount:g,eliminatedPlayer:h}),s.forEach(n=>{const l=E(n),A=T.get(l);A.totalMeetings++,A.displayName=n.Username;const F=M.find(R=>R.voterId===l);if(F)if(F.vote.Target==="Passé")A.totalSkips++;else{A.totalVotes++;const R=m.get(l);R.totalVotes++;const P=B(b(n.MainRoleInitial,n.MainRoleChanges||[]),{regroupWolfSubRoles:!0}),u=c.PlayerStats.find(C=>C.Username===F.vote.Target);if(u){const C=E(u),O=B(b(u.MainRoleInitial,u.MainRoleChanges||[]),{regroupWolfSubRoles:!0});P===O?R.votesForOwnCamp++:R.votesForEnemyCamp++;const v=a.get(C);v.totalTimesTargeted++,P===O?v.timesTargetedByOwnCamp++:v.timesTargetedByEnemyCamp++;const w=b(u.MainRoleInitial,u.MainRoleChanges||[]),k=B(w,{regroupWolfSubRoles:!0});k==="Villageois"?v.timesTargetedAsVillager++:k==="Loup"?v.timesTargetedAsWolf++:v.timesTargetedAsSpecial++,N(c,i,C)&&v.eliminationsByVote++}}else A.totalAbstentions++})}const r=[],S=[],d=[];return c.PlayerStats.forEach(i=>{const s=E(i),M=i.Username,p=T.get(s),y=p.totalMeetings>0?p.totalVotes/p.totalMeetings*100:0,e=p.totalMeetings>0?p.totalSkips/p.totalMeetings*100:0,t=p.totalMeetings>0?p.totalAbstentions/p.totalMeetings*100:0,o=y-e*.5-t*.7;r.push({playerName:M,totalMeetings:p.totalMeetings,totalVotes:p.totalVotes,totalSkips:p.totalSkips,totalAbstentions:p.totalAbstentions,votingRate:y,skippingRate:e,abstentionRate:t,aggressivenessScore:o});const g=m.get(s),h=g.totalVotes>0?g.votesForEnemyCamp/g.totalVotes*100:0,n=g.totalVotes>0?g.votesForOwnCamp/g.totalVotes*100:0;S.push({playerName:M,totalMeetings:p.totalMeetings,totalVotes:g.totalVotes,votesForEnemyCamp:g.votesForEnemyCamp,votesForOwnCamp:g.votesForOwnCamp,accuracyRate:h,friendlyFireRate:n});const l=a.get(s),A=l.totalTimesTargeted>0?(l.totalTimesTargeted-l.eliminationsByVote)/l.totalTimesTargeted*100:100;d.push({playerName:M,totalMeetings:p.totalMeetings,totalTimesTargeted:l.totalTimesTargeted,timesTargetedByEnemyCamp:l.timesTargetedByEnemyCamp,timesTargetedByOwnCamp:l.timesTargetedByOwnCamp,timesTargetedAsVillager:l.timesTargetedAsVillager,timesTargetedAsWolf:l.timesTargetedAsWolf,timesTargetedAsSpecial:l.timesTargetedAsSpecial,eliminationsByVote:l.eliminationsByVote,survivalRate:A})}),{gameId:c.Id,totalMeetings:V,meetingAnalytics:f,playerBehaviors:r,playerAccuracies:S,playerTargetStats:d}}function J(c){const f=new Map;return c.filter(m=>{if(!m.Modded||!m.Version)return!1;const a=m.Version.match(/^(\d+)\.(\d+)/);if(!a)return!1;const V=parseInt(a[1]),r=parseInt(a[2]);return V===0&&r>=201||V>=1}).forEach(m=>{const a=new Map;m.PlayerStats.forEach(V=>{!V.Votes||V.Votes.length===0||V.Votes.forEach(r=>{if(!r.Date||r.Target==="Passé")return;const S=a.get(r.Day)||[];S.push({playerName:V.Username,date:new Date(r.Date),target:r.Target}),a.set(r.Day,S)})}),a.forEach(V=>{if(V.length===0)return;const r=[...V].sort((d,i)=>d.date.getTime()-i.date.getTime()),S=r[0].date.getTime();r.forEach((d,i)=>{const s=f.get(d.playerName)||{totalActiveVotes:0,totalTimedVotes:0,positionPercentileSum:0,timesFirstVoter:0,timesLastVoter:0,earlyVotes:0,lateVotes:0,voteDelaySum:0};s.totalActiveVotes++,s.totalTimedVotes++;const M=r.length>1?i/(r.length-1)*100:50;s.positionPercentileSum+=M,i===0&&s.timesFirstVoter++,i===r.length-1&&s.timesLastVoter++;const p=Math.ceil(r.length/3),y=r.length-Math.ceil(r.length/3);i<p&&s.earlyVotes++,i>=y&&s.lateVotes++;const e=(d.date.getTime()-S)/1e3;s.voteDelaySum+=e,f.set(d.playerName,s)})})}),Array.from(f.entries()).map(([m,a])=>{const V=a.totalTimedVotes>0?a.positionPercentileSum/a.totalTimedVotes:50,r=a.totalTimedVotes>0?a.earlyVotes/a.totalTimedVotes*100:0,S=a.totalTimedVotes>0?a.lateVotes/a.totalTimedVotes*100:0,d=a.totalTimedVotes>0?a.voteDelaySum/a.totalTimedVotes:0;return{playerName:m,totalActiveVotes:a.totalActiveVotes,totalTimedVotes:a.totalTimedVotes,averageVotePositionPercentile:V,timesFirstVoter:a.timesFirstVoter,timesLastVoter:a.timesLastVoter,earlyVoterRate:r,lateVoterRate:S,averageVoteDelaySeconds:d}})}function Y(c){const f=new Map,T=new Map;let m=0,a=0,V=0,r=0,S=0,d=0,i=0,s=0;c.forEach(y=>{const e=Math.max(...y.PlayerStats.flatMap(t=>t.Votes.map(o=>o.Day)),0);if(e!==0)for(let t=1;t<=e;t++){const o=I(y,t),g=y.PlayerStats.flatMap(u=>u.Votes.filter(C=>C.Day===t).map(C=>({voter:u.Username,vote:C,voterStats:u})));if(g.length===0&&y.EndTiming===`M${t}`)continue;const h=g.filter(u=>u.vote.Target!=="Passé").length,n=g.filter(u=>u.vote.Target==="Passé").length,l=o.length-g.length;m++,a+=h,V+=n,r+=l;const A=o.length>0?h/o.length*100:0,F=o.length>0?n/o.length*100:0,R=o.length>0?l/o.length*100:0;S+=A,d+=F,i+=R,s++;const P=f.get(t)||{meetings:0,totalVotingRates:0,totalSkipRates:0,totalAbstentionRates:0};P.meetings++,P.totalVotingRates+=A,P.totalSkipRates+=F,P.totalAbstentionRates+=R,f.set(t,P),g.filter(u=>u.vote.Target!=="Passé").forEach(({voterStats:u,vote:C})=>{const O=b(u.MainRoleInitial,u.MainRoleChanges||[]),v=B(O,{regroupWolfSubRoles:!0}),w=y.PlayerStats.find(U=>U.Username===C.Target);if(!w)return;const k=b(w.MainRoleInitial,w.MainRoleChanges||[]),W=B(k,{regroupWolfSubRoles:!0}),D=T.get(v)||{totalVotes:0,votesForOppositeCamp:0,votesForOwnCamp:0};D.totalVotes++,v===W?D.votesForOwnCamp++:D.votesForOppositeCamp++,T.set(v,D)})}});const M=Array.from(f.entries()).map(([y,e])=>({meetingDay:y,totalMeetings:e.meetings,averageVotingRate:e.meetings>0?e.totalVotingRates/e.meetings:0,averageSkipRate:e.meetings>0?e.totalSkipRates/e.meetings:0,averageAbstentionRate:e.meetings>0?e.totalAbstentionRates/e.meetings:0})).sort((y,e)=>y.meetingDay-e.meetingDay),p=Array.from(T.entries()).map(([y,e])=>({campName:y,totalVotes:e.totalVotes,votesForOppositeCamp:e.votesForOppositeCamp,votesForOwnCamp:e.votesForOwnCamp,accuracyRate:e.totalVotes>0?e.votesForOppositeCamp/e.totalVotes*100:0,friendlyFireRate:e.totalVotes>0?e.votesForOwnCamp/e.totalVotes*100:0})).sort((y,e)=>e.accuracyRate-y.accuracyRate);return{totalMeetings:m,totalVotes:a,totalSkips:V,totalAbstentions:r,averageVotingRate:s>0?S/s:0,averageSkipRate:s>0?d/s:0,averageAbstentionRate:s>0?i/s:0,meetingDayStats:M,campVotingStats:p}}function _(c){const f=c.map(G),T=new Map,m=new Map,a=new Map;let V=0,r=0,S=0,d=0,i=0,s=0;f.forEach(e=>{V+=e.totalMeetings,e.meetingAnalytics.forEach(t=>{r+=t.participationRate,S++,d+=t.totalVotes,i+=t.totalSkips,s+=t.totalAbstentions}),e.playerBehaviors.forEach(t=>{const o=T.get(t.playerName)||{totalMeetings:0,totalVotes:0,totalSkips:0,totalAbstentions:0};T.set(t.playerName,{totalMeetings:o.totalMeetings+t.totalMeetings,totalVotes:o.totalVotes+t.totalVotes,totalSkips:o.totalSkips+t.totalSkips,totalAbstentions:o.totalAbstentions+t.totalAbstentions})}),e.playerAccuracies.forEach(t=>{const o=m.get(t.playerName)||{totalMeetings:0,totalVotes:0,votesForEnemyCamp:0,votesForOwnCamp:0};m.set(t.playerName,{totalMeetings:o.totalMeetings+t.totalMeetings,totalVotes:o.totalVotes+t.totalVotes,votesForEnemyCamp:o.votesForEnemyCamp+t.votesForEnemyCamp,votesForOwnCamp:o.votesForOwnCamp+t.votesForOwnCamp})}),e.playerTargetStats.forEach(t=>{const o=a.get(t.playerName)||{totalMeetings:0,totalTimesTargeted:0,timesTargetedByEnemyCamp:0,timesTargetedByOwnCamp:0,timesTargetedAsVillager:0,timesTargetedAsWolf:0,timesTargetedAsSpecial:0,eliminationsByVote:0};a.set(t.playerName,{totalMeetings:o.totalMeetings+t.totalMeetings,totalTimesTargeted:o.totalTimesTargeted+t.totalTimesTargeted,timesTargetedByEnemyCamp:o.timesTargetedByEnemyCamp+t.timesTargetedByEnemyCamp,timesTargetedByOwnCamp:o.timesTargetedByOwnCamp+t.timesTargetedByOwnCamp,timesTargetedAsVillager:o.timesTargetedAsVillager+t.timesTargetedAsVillager,timesTargetedAsWolf:o.timesTargetedAsWolf+t.timesTargetedAsWolf,timesTargetedAsSpecial:o.timesTargetedAsSpecial+t.timesTargetedAsSpecial,eliminationsByVote:o.eliminationsByVote+t.eliminationsByVote})})});const M=Array.from(T.entries()).map(([e,t])=>{const o=t.totalMeetings>0?t.totalVotes/t.totalMeetings*100:0,g=t.totalMeetings>0?t.totalSkips/t.totalMeetings*100:0,h=t.totalMeetings>0?t.totalAbstentions/t.totalMeetings*100:0,n=o-g*.5-h*.7;return{playerName:e,totalMeetings:t.totalMeetings,totalVotes:t.totalVotes,totalSkips:t.totalSkips,totalAbstentions:t.totalAbstentions,votingRate:o,skippingRate:g,abstentionRate:h,aggressivenessScore:n}}),p=Array.from(m.entries()).map(([e,t])=>{const o=t.totalVotes>0?t.votesForEnemyCamp/t.totalVotes*100:0,g=t.totalVotes>0?t.votesForOwnCamp/t.totalVotes*100:0;return{playerName:e,totalMeetings:t.totalMeetings,totalVotes:t.totalVotes,votesForEnemyCamp:t.votesForEnemyCamp,votesForOwnCamp:t.votesForOwnCamp,accuracyRate:o,friendlyFireRate:g}}),y=Array.from(a.entries()).map(([e,t])=>{const o=t.totalTimesTargeted>0?(t.totalTimesTargeted-t.eliminationsByVote)/t.totalTimesTargeted*100:100;return{playerName:e,totalMeetings:t.totalMeetings,totalTimesTargeted:t.totalTimesTargeted,timesTargetedByEnemyCamp:t.timesTargetedByEnemyCamp,timesTargetedByOwnCamp:t.timesTargetedByOwnCamp,timesTargetedAsVillager:t.timesTargetedAsVillager,timesTargetedAsWolf:t.timesTargetedAsWolf,timesTargetedAsSpecial:t.timesTargetedAsSpecial,eliminationsByVote:t.eliminationsByVote,survivalRate:o}});return{playerBehaviorStats:M,playerAccuracyStats:p,playerTargetStats:y,overallMeetingStats:{totalMeetings:V,averageParticipationRate:S>0?r/S:0,totalVotes:d,totalSkips:i,totalAbstentions:s}}}export{J as a,Y as b,_ as c};
