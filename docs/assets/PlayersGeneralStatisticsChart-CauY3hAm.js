import{r as u,j as e}from"./index-CNPNIKLs.js";import{u as Q}from"./usePlayerStatsFromRaw-B0yb1G97.js";import{u as U,a as Z,r as ee,b as re,c as te,d as S,s as ae,e as ie,f as I,g as se,h as ne,i as le,L as oe,j as ce,k as de,l as ue,m as W,n as k,F as B,R as A,B as M,C as V,X as q,Y as K,T as C,o as $,p as D,q as G,t as me,v as xe,w as z,x as X}from"./FullscreenChart-Ck9_lLWY.js";import{P as pe,a as he}from"./PieChart-XmXxwUeI.js";import{L as ge}from"./Legend-DcIFhPCm.js";import"./useRawGameData-BUV9ePlG.js";function Y(r,a){var i=Object.keys(r);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(r);a&&(s=s.filter(function(x){return Object.getOwnPropertyDescriptor(r,x).enumerable})),i.push.apply(i,s)}return i}function _(r){for(var a=1;a<arguments.length;a++){var i=arguments[a]!=null?arguments[a]:{};a%2?Y(Object(i),!0).forEach(function(s){E(r,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(i)):Y(Object(i)).forEach(function(s){Object.defineProperty(r,s,Object.getOwnPropertyDescriptor(i,s))})}return r}function E(r,a,i){return(a=ye(a))in r?Object.defineProperty(r,a,{value:i,enumerable:!0,configurable:!0,writable:!0}):r[a]=i,r}function ye(r){var a=ve(r,"string");return typeof a=="symbol"?a:a+""}function ve(r,a){if(typeof r!="object"||!r)return r;var i=r[Symbol.toPrimitive];if(i!==void 0){var s=i.call(r,a);if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(a==="string"?String:Number)(r)}function F(){return F=Object.assign?Object.assign.bind():function(r){for(var a=1;a<arguments.length;a++){var i=arguments[a];for(var s in i)({}).hasOwnProperty.call(i,s)&&(r[s]=i[s])}return r},F.apply(null,arguments)}var fe=(r,a)=>{var i;return u.isValidElement(r)?i=u.cloneElement(r,a):typeof r=="function"?i=r(a):i=u.createElement("line",F({},a,{className:"recharts-reference-line-line"})),i},je=(r,a,i,s,x,p,O,g,h)=>{var{x:f,y,width:j,height:R}=x;if(i){var{y:b}=h,t=r.y.apply(b,{position:p});if(W(t)||h.ifOverflow==="discard"&&!r.y.isInRange(t))return null;var l=[{x:f+j,y:t},{x:f,y:t}];return g==="left"?l.reverse():l}if(a){var{x:n}=h,m=r.x.apply(n,{position:p});if(W(m)||h.ifOverflow==="discard"&&!r.x.isInRange(m))return null;var o=[{x:m,y:y+R},{x:m,y}];return O==="top"?o.reverse():o}if(s){var{segment:d}=h,v=d.map(c=>r.apply(c,{position:p}));return h.ifOverflow==="discard"&&v.some(c=>!r.isInRange(c))?null:v}return null};function be(r){var a=U();return u.useEffect(()=>(a(Z(r)),()=>{a(ee(r))})),null}function Pe(r){var{x:a,y:i,segment:s,xAxisId:x,yAxisId:p,shape:O,className:g,ifOverflow:h}=r,f=re(),y=te(),j=S(w=>ae(w,x)),R=S(w=>ie(w,p)),b=S(w=>I(w,"xAxis",x,f)),t=S(w=>I(w,"yAxis",p,f)),l=se(),n=k(a),m=k(i);if(!y||!l||j==null||R==null||b==null||t==null)return null;var o=ne({x:b,y:t}),d=s&&s.length===2,v=je(o,n,m,d,l,r.position,j.orientation,R.orientation,r);if(!v)return null;var[{x:c,y:P},{x:T,y:L}]=v,J=h==="hidden"?"url(#".concat(y,")"):void 0,H=_(_({clipPath:J},le(r,!0)),{},{x1:c,y1:P,x2:T,y2:L});return u.createElement(oe,{className:ce("recharts-reference-line",g)},fe(O,H),de.renderCallByParent(r,ue({x1:c,y1:P,x2:T,y2:L})))}function we(r){return u.createElement(u.Fragment,null,u.createElement(be,{yAxisId:r.yAxisId,xAxisId:r.xAxisId,ifOverflow:r.ifOverflow,x:r.x,y:r.y}),u.createElement(Pe,r))}class N extends u.Component{render(){return u.createElement(we,this.props)}}E(N,"displayName","ReferenceLine");E(N,"defaultProps",{ifOverflow:"discard",xAxisId:0,yAxisId:0,fill:"none",stroke:"#ccc",fillOpacity:1,strokeWidth:1,position:"middle"});const Re=(r,a)=>{const i=a?.playerStats.find(s=>s.player===r);return i?Object.entries(i.camps).filter(([,s])=>s>0).map(([s,x])=>({name:s,value:x,percentage:(x/i.gamesPlayed*100).toFixed(1)})):[]};function Ee(){const{data:r,isLoading:a,error:i}=Q(),[s,x]=u.useState(null),[p,O]=u.useState(50),[g,h]=u.useState("best"),{participationData:f,winRateData:y,averageWinRate:j,totalEligiblePlayers:R}=u.useMemo(()=>{if(!r?.playerStats)return{participationData:[],winRateData:[],averageWinRate:"0",totalEligiblePlayers:0};const t=r.playerStats,l=[],n=[];let m=0;for(const c of t)m+=parseFloat(c.winPercent),c.gamesPlayed>=p&&l.push(c),c.gamesPlayed>2&&n.push(c);const o=t.length>0?(m/t.length).toFixed(1):"0",d=n.sort((c,P)=>P.gamesPlayed-c.gamesPlayed).slice(0,20),v=l.sort((c,P)=>g==="best"?parseFloat(P.winPercent)-parseFloat(c.winPercent):parseFloat(c.winPercent)-parseFloat(P.winPercent)).slice(0,20);return{participationData:d,winRateData:v,averageWinRate:o,totalEligiblePlayers:l.length}},[r,p,g]),b=u.useMemo(()=>{if(!s||!r)return[];const t=Re(s,r);if(!t.length)return[];const l=5;let n=0;const m=[],o=[];return t.forEach(d=>{parseFloat(d.percentage)<l?(n+=Number(d.value),m.push(d)):o.push(d)}),n>0&&o.push({name:"Autres",value:n,percentage:(n/t.reduce((d,v)=>d+Number(v.value),0)*100).toFixed(1),_details:m}),o},[s,r]);return a?e.jsx("div",{className:"donnees-attente",children:"Récupération des statistiques des joueurs..."}):i?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",i]}):r?e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques des Joueurs"}),e.jsxs("p",{className:"lycans-stats-info",children:["Total de ",r.totalGames," parties analysées avec ",r.playerStats.length," joueurs"]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Participations"}),e.jsx(B,{title:"Top Participations",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(M,{data:f,margin:{top:20,right:30,left:20,bottom:70},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(K,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(C,{content:({active:t,payload:l})=>{if(t&&l&&l.length>0){const n=l[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:n.player})}),e.jsxs("div",{children:["Parties jouées : ",n.gamesPlayed]}),e.jsxs("div",{children:["Pourcentage : ",n.gamesPlayedPercent,"%"]})]})}return null}}),e.jsx($,{dataKey:"gamesPlayed",name:"Parties jouées",fill:"#00C49F",children:f.map(t=>e.jsx(D,{fill:G[t.player]||"#00C49F",onClick:()=>x(t.player),style:{cursor:"pointer"}},`cell-participation-${t.player}`))})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{children:g==="best"?"Meilleurs Taux de Victoire":"Moins Bon Taux de Victoire"}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"min-games-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select",value:p,onChange:t=>O(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:me.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsxs("select",{value:g,onChange:t=>h(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"best",children:"Meilleurs Taux de Victoire"}),e.jsx("option",{value:"worst",children:"Moins Bon Taux de Victoire"})]})]})]}),e.jsx(B,{title:g==="best"?"Meilleurs Taux de Victoire":"Moins Bon Taux de Victoire",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(M,{data:y,margin:{top:20,right:30,left:20,bottom:70},children:[e.jsx(V,{strokeDasharray:"3 3"}),e.jsx(q,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(K,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(C,{content:({active:t,payload:l})=>{if(t&&l&&l.length>0){const n=l[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:n.player})}),e.jsxs("div",{children:["Taux de victoire : ",n.winPercent,"%"]}),e.jsxs("div",{children:["Victoires : ",n.wins," / ",n.gamesPlayed]})]})}return null}}),e.jsx($,{dataKey:"winPercent",name:"Taux de Victoire",fill:"#8884d8",children:y.map(t=>e.jsx(D,{fill:G[t.player]||"#8884d8",onClick:()=>x(t.player),style:{cursor:"pointer"}},`cell-winrate-${t.player}`))}),e.jsx(N,{y:parseFloat(j),stroke:"red",strokeDasharray:"3 3",label:{value:`Moyenne: ${j}%`,position:"insideBottomRight",fill:"red",fontSize:12,fontWeight:"bold"}})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",y.length," des joueurs (sur ",R," ayant au moins ",p," partie",p>1?"s":"",")"]})]})]}),s&&e.jsxs("div",{className:"lycans-graphique-section lycans-joueur-details",children:[e.jsxs("h3",{children:["Distribution des Camps - ",s]}),e.jsx("div",{style:{height:300},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(pe,{children:[e.jsx(he,{data:b,cx:"50%",cy:"50%",labelLine:!0,outerRadius:80,fill:"#8884d8",dataKey:"value",nameKey:"name",label:({name:t,percentage:l})=>t==="Autres"?`Autres : ${l}%`:`${t}: ${l}%`,children:b.map((t,l)=>e.jsx(D,{fill:t.name==="Autres"?xe:z[t.name]||X(t.name)},`cell-${l}`))}),e.jsx(C,{content:({active:t,payload:l})=>{if(t&&l&&l.length>0){const n=l[0].payload;if(n.name==="Autres"&&n._details){const m=[...n._details].sort((o,d)=>parseFloat(d.percentage)-parseFloat(o.percentage));return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:300},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8},children:"Autres"}),e.jsx("div",{children:m.map((o,d)=>e.jsxs("div",{style:{marginBottom:2},children:[e.jsx("span",{style:{color:z[o.name]||X(o.name),fontWeight:"bold"},children:o.name}),": ",o.value," parties (",o.percentage,"%)"]},d))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold",borderTop:"1px solid var(--border-color)",paddingTop:4},children:["Total: ",n.value," parties (",n.percentage,"%)"]})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:n.name}),e.jsxs("div",{children:[n.value," parties (",n.percentage,"%)"]})]})}return null}}),e.jsx(ge,{})]})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de joueur disponible"})}export{Ee as PlayersGeneralStatisticsChart};
