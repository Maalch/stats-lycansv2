import{r as B,j as a}from"./index-Dz3v_09V.js";import{y as N,R as p,B as g,C as x,X as j,Y as D,T as f,o as b,p as C,w as R,v as W,ae as P}from"./api-FcbQwksq.js";import{L as A,a as L}from"./LineChart-D4gXDgge.js";import{L as k}from"./Legend-DJhCiwIh.js";function w(){const{data:i,isLoading:m,error:c}=N();return{durationAnalysis:B.useMemo(()=>{if(!i||i.length===0)return null;const e={averageDays:"0",maxDays:0,minDays:99,dayDistribution:{},daysByWinnerCamp:{},daysByPlayerCount:{},daysByWolfRatio:{}};let r=0,t=0;i.forEach(n=>{const s=n["Nombre de journées"],d=n["Camp victorieux"],l=n["Nombre de joueurs"],h=n["Nombre de loups"];if(s&&!isNaN(s)&&s>0){if(t++,r+=s,s>e.maxDays&&(e.maxDays=s),s<e.minDays&&(e.minDays=s),e.dayDistribution[s]||(e.dayDistribution[s]=0),e.dayDistribution[s]++,d&&d.trim()!==""&&(e.daysByWinnerCamp[d]||(e.daysByWinnerCamp[d]={totalDays:0,count:0,average:"0"}),e.daysByWinnerCamp[d].totalDays+=s,e.daysByWinnerCamp[d].count++),l&&!isNaN(l)&&l>0){const y=l.toString();e.daysByPlayerCount[y]||(e.daysByPlayerCount[y]={totalDays:0,count:0,average:"0"}),e.daysByPlayerCount[y].totalDays+=s,e.daysByPlayerCount[y].count++}if(l&&h&&!isNaN(l)&&!isNaN(h)&&l>0){const y=Math.round(h/l*100),u=(Math.round(y/1)*1).toString();e.daysByWolfRatio[u]||(e.daysByWolfRatio[u]={totalDays:0,count:0,average:"0"}),e.daysByWolfRatio[u].totalDays+=s,e.daysByWolfRatio[u].count++}}}),t>0&&(e.averageDays=(r/t).toFixed(1),Object.keys(e.daysByWinnerCamp).forEach(n=>{const s=e.daysByWinnerCamp[n];s.count>0&&(s.average=(s.totalDays/s.count).toFixed(1))}),Object.keys(e.daysByPlayerCount).forEach(n=>{const s=e.daysByPlayerCount[n];s.count>0&&(s.average=(s.totalDays/s.count).toFixed(1))}),Object.keys(e.daysByWolfRatio).forEach(n=>{const s=e.daysByWolfRatio[n];s.count>0&&(s.average=(s.totalDays/s.count).toFixed(1))}));const o=Object.keys(e.dayDistribution).map(n=>({days:parseInt(n),count:e.dayDistribution[parseInt(n)]}));return o.sort((n,s)=>n.days-s.days),{averageDays:e.averageDays,maxDays:e.maxDays,minDays:e.minDays,dayDistribution:o,daysByWinnerCamp:e.daysByWinnerCamp,daysByPlayerCount:e.daysByPlayerCount,daysByWolfRatio:e.daysByWolfRatio}},[i]),fetchingData:m,apiError:c}}function G(){const{durationAnalysis:i,fetchingData:m,apiError:c}=w();if(m)return a.jsx("div",{className:"statistiques-attente",children:"Analyse des durées de partie en cours..."});if(c)return a.jsxs("div",{className:"statistiques-echec",children:["Problème rencontré: ",c]});if(!i)return a.jsx("div",{className:"statistiques-indisponibles",children:"Données d'analyse non disponibles"});const v=i?Object.entries(i.daysByWolfRatio).map(([r,t])=>({ratio:parseFloat(r),moyenne:parseFloat(t.average),parties:t.count})).sort((r,t)=>r.ratio-t.ratio):[],e=i?Object.entries(i.daysByWinnerCamp).map(([r,t])=>({camp:r,moyenne:parseFloat(t.average),parties:t.count})).sort((r,t)=>t.moyenne-r.moyenne):[];return a.jsxs("div",{className:"lycans-duree-analyse",children:[a.jsx("h2",{children:"Analyse des Durées de Partie"}),a.jsxs("div",{className:"lycans-resume-conteneur",children:[a.jsxs("div",{className:"lycans-stat-carte",children:[a.jsx("h3",{children:"Durée Moyenne"}),a.jsxs("p",{className:"lycans-valeur-principale",children:[i.averageDays," jours"]})]}),a.jsxs("div",{className:"lycans-stat-carte",children:[a.jsx("h3",{children:"Durée Minimum"}),a.jsxs("p",{className:"lycans-valeur-principale",children:[i.minDays," jours"]})]}),a.jsxs("div",{className:"lycans-stat-carte",children:[a.jsx("h3",{children:"Durée Maximum"}),a.jsxs("p",{className:"lycans-valeur-principale",children:[i.maxDays," jours"]})]})]}),a.jsxs("div",{className:"lycans-graphiques-section",children:[a.jsxs("div",{className:"lycans-graphique-element",children:[a.jsx("h3",{children:"Distribution des Durées de Partie"}),a.jsx("div",{style:{height:300},children:a.jsx(p,{width:"100%",height:"100%",children:a.jsxs(g,{data:i?.dayDistribution||[],margin:{top:20,right:30,left:20,bottom:5},children:[a.jsx(x,{strokeDasharray:"3 3"}),a.jsx(j,{dataKey:"days",label:{value:"Nombre de Jours",position:"insideBottom",offset:-5}}),a.jsx(D,{label:{value:"Nombre de Parties",angle:-90,position:"insideLeft"}}),a.jsx(f,{content:({active:r,payload:t})=>{if(r&&t&&t.length>0){const o=t[0].payload;return a.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[a.jsx("div",{children:a.jsxs("strong",{children:[o.days," jours"]})}),a.jsxs("div",{children:[o.count," parties"]})]})}return null}}),a.jsx(b,{dataKey:"count",name:"Nombre de Parties",fill:"var(--chart-color-2)"})]})})})]}),a.jsxs("div",{className:"lycans-graphique-element",children:[a.jsx("h3",{children:"Durée Moyenne par Ratio Loups/Joueurs"}),a.jsx("div",{style:{height:300},children:a.jsx(p,{width:"100%",height:"100%",children:a.jsxs(A,{data:v,margin:{top:20,right:30,left:20,bottom:5},children:[a.jsx(x,{strokeDasharray:"3 3"}),a.jsx(j,{dataKey:"ratio",type:"number",domain:["auto","auto"],allowDecimals:!1,tickFormatter:r=>`${r}%`,label:{value:"Ratio Loups/Joueurs (%)",position:"insideBottom",offset:-5}}),a.jsx(D,{label:{value:"Durée Moyenne (jours)",angle:-90,position:"insideLeft"}}),a.jsx(f,{content:({active:r,payload:t})=>{if(r&&t&&t.length>0){const o=t[0].payload;return a.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[a.jsx("div",{children:a.jsxs("strong",{children:["Pourcentage de loups : ",o.ratio]})}),a.jsxs("div",{children:["Durée moyenne : ",o.moyenne," jours"]}),a.jsxs("div",{children:["Nombre de parties : ",o.parties]})]})}return null}}),a.jsx(k,{}),a.jsx(L,{type:"monotone",dataKey:"moyenne",name:"Durée Moyenne",stroke:"var(--chart-color-5)",activeDot:{r:8}})]})})})]}),a.jsxs("div",{className:"lycans-graphique-element",children:[a.jsx("h3",{children:"Durée Moyenne par Camp Victorieux"}),a.jsx("div",{style:{height:300},children:a.jsx(p,{width:"100%",height:"100%",children:a.jsxs(g,{data:e,margin:{top:20,right:30,left:20,bottom:60},children:[a.jsx(x,{strokeDasharray:"3 3"}),a.jsx(j,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0}),a.jsx(D,{label:{value:"Durée Moyenne (jours)",angle:-90,position:"insideLeft"}}),a.jsx(f,{content:({active:r,payload:t})=>{if(r&&t&&t.length>0){const o=t[0].payload;return a.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[a.jsx("div",{children:a.jsx("strong",{children:o.camp})}),a.jsxs("div",{children:["Durée moyenne : ",o.moyenne," jours"]}),a.jsxs("div",{children:["Nombre de parties : ",o.parties]})]})}return null}}),a.jsxs(b,{dataKey:"moyenne",name:"moyenne",isAnimationActive:!1,children:[e.map(r=>a.jsx(C,{fill:R[r.camp]||W},`cell-${r.camp}`)),a.jsx(P,{dataKey:"moyenne",position:"top",formatter:r=>{const t=typeof r=="number"?r:Number(r);return isNaN(t)?"":`${t.toFixed(1)}j`},fill:"var(--text-primary)",fontSize:12})]})]})})})]})]})]})}export{G as GameDurationInsights};
