import{g as ne,b as oe,j as e,u as le,a as ce,r as $}from"./index-3ij-MxWK.js";import{u as me}from"./baseStatsHook-OvWDU9WG.js";import{a as Y,b as te,g as pe}from"./datasyncExport-BirWLS1z.js";import{g as Q}from"./roleUtils-g252S1-m.js";import{a as ue,b as fe,u as he,m as de}from"./api-SpRv-SBp.js";import{u as ge}from"./useJoueursData-ZlClGpy0.js";import{F as ye,C as Pe,X as xe,Y as je}from"./FullscreenChart-lMidrNmQ.js";import{R as ve,T as Ce,a as Re}from"./CategoricalChart-01AbwW7h.js";import{B as we,a as be}from"./BarChart-B0uxc1xy.js";function X(n,a){const o=Y(n.MainRoleInitial,n.MainRoleChanges||[]),i=Q(n);return pe(o,a,i)}function se(n,a=!1,o=!1){const i={};return n.forEach(m=>{const l=new Set;m.PlayerStats.forEach(s=>{const f=X(s,{regroupWolfSubRoles:a,regroupVillagers:o});l.add(f)}),l.forEach(s=>{i[s]||(i[s]={totalGames:0,wins:0,winRate:0,players:{}}),i[s].totalGames++});const d=new Set;m.PlayerStats.forEach(s=>{if(s.Victorious){const f=X(s,{regroupWolfSubRoles:a,regroupVillagers:o});d.add(f)}}),d.forEach(s=>{i[s]&&i[s].wins++})}),i}function re(n,a,o=!1,i=!1){const m={};return n.forEach(l=>{l.PlayerStats.forEach(d=>{const s=ne(d),f=d.Username,c=X(d,{regroupWolfSubRoles:o,regroupVillagers:i}),h=c==="Autres"?"R√¥les sp√©ciaux":c;a[h].players[s]||(a[h].players[s]={games:0,wins:0,winRate:0,displayName:f}),a[h].players[s].games++,a[h].players[s].displayName=f,d.Victorious&&a[h].players[s].wins++,m[s]||(m[s]={totalGames:0,camps:{},displayName:f}),m[s].displayName=f,m[s].camps[h]||(m[s].camps[h]={games:0,wins:0,winRate:0,performance:0}),m[s].totalGames++,m[s].camps[h].games++,d.Victorious&&m[s].camps[h].wins++})}),m}function Te(n){const a={};return a["R√¥les sp√©ciaux"]={totalGames:0,wins:0,winRate:0,players:{}},n.forEach(o=>{o.PlayerStats.forEach(i=>{const m=Q(i),l=Y(i.MainRoleInitial,i.MainRoleChanges||[]);te(l,m)==="Autres"&&(a["R√¥les sp√©ciaux"].totalGames++,i.Victorious&&a["R√¥les sp√©ciaux"].wins++)})}),a}function Ae(n,a){const o={};return n.forEach(i=>{i.PlayerStats.forEach(m=>{const l=ne(m),d=m.Username,s=Q(m);if(te(Y(m.MainRoleInitial,m.MainRoleChanges||[]),s)==="Autres"){const c="R√¥les sp√©ciaux";a[c].players[l]||(a[c].players[l]={games:0,wins:0,winRate:0,displayName:d}),a[c].players[l].games++,a[c].players[l].displayName=d,m.Victorious&&a[c].players[l].wins++,o[l]||(o[l]={totalGames:0,camps:{},displayName:d}),o[l].displayName=d,o[l].camps[c]||(o[l].camps[c]={games:0,wins:0,winRate:0,performance:0}),o[l].totalGames++,o[l].camps[c].games++,m.Victorious&&o[l].camps[c].wins++}})}),o}function U(n){Object.keys(n).forEach(a=>{n[a].totalGames>0&&(n[a].winRate=parseFloat((n[a].wins/n[a].totalGames*100).toFixed(2))),Object.keys(n[a].players).forEach(o=>{const i=n[a].players[o];i.games>0&&(i.winRate=parseFloat((i.wins/i.games*100).toFixed(2)))})})}function _(n,a){Object.keys(n).forEach(o=>{Object.keys(n[o].camps).forEach(i=>{const m=n[o].camps[i];m.games>0&&(m.winRate=parseFloat((m.wins/m.games*100).toFixed(2)),a[i]&&a[i].winRate!==void 0?m.performance=parseFloat((m.winRate-a[i].winRate).toFixed(2)):m.performance=0)})})}function Fe(n,a,o){const i=[];return Object.keys(n).forEach(l=>{const d=n[l],s=[];Object.keys(d.camps).forEach(f=>{const c=d.camps[f];if(c.games>=o){const h=a[f]&&a[f].winRate!==void 0?a[f].winRate.toFixed(2):"0.00";s.push({camp:f,games:c.games,wins:c.wins,winRate:c.winRate.toFixed(2),campAvgWinRate:h,performance:c.performance.toFixed(2)})}}),s.sort((f,c)=>parseFloat(c.performance)-parseFloat(f.performance)),s.length>0&&i.push({player:d.displayName,totalGames:d.totalGames,campPerformance:s})}),i.sort((l,d)=>d.totalGames-l.totalGames),{campAverages:Object.keys(a).map(l=>({camp:l,totalGames:a[l].totalGames,wins:a[l].wins,winRate:a[l].winRate.toFixed(2)})),playerPerformanceArray:i}}function Ne(n){if(n.length===0)return null;const a=se(n,!1,!1),o=se(n,!0,!0),i=Te(n),m=re(n,a,!1,!1),l=re(n,o,!0,!0),d=Ae(n,i);U(a),U(o),U(i),_(m,a),_(l,o),_(d,i);const s={...a},f={...m};o.Loup&&(s["Camp Loup"]=o.Loup,Object.keys(l).forEach(x=>{f[x]||(f[x]=l[x]),l[x].camps.Loup&&(f[x].camps["Camp Loup"]=l[x].camps.Loup)})),o.Villageois&&(s["Camp Villageois"]=o.Villageois,Object.keys(l).forEach(x=>{f[x]||(f[x]=l[x]),l[x].camps.Villageois&&(f[x].camps["Camp Villageois"]=l[x].camps.Villageois)})),i["R√¥les sp√©ciaux"]&&(s["R√¥les sp√©ciaux"]=i["R√¥les sp√©ciaux"],Object.keys(d).forEach(x=>{f[x]||(f[x]=d[x]),d[x].camps["R√¥les sp√©ciaux"]&&(f[x].camps["R√¥les sp√©ciaux"]=d[x].camps["R√¥les sp√©ciaux"])}));const c=ue.MIN_CAMP_GAMES,{campAverages:h,playerPerformanceArray:T}=Fe(f,s,c);return{campAverages:h,playerPerformance:T,minGamesRequired:c}}function Me(){const{data:n,isLoading:a,error:o}=me(Ne);return{playerCampPerformance:n,isLoading:a,error:o}}function Le({infoId:n,title:a,children:o}){const{activeInfo:i,toggleInfo:m}=oe(),l=i===n;return e.jsxs("div",{className:"info-bubble-container",children:[e.jsx("button",{className:"info-bubble-trigger",onClick:()=>m(n),"aria-label":"Afficher les informations",title:"Informations sur ce graphique",children:"‚ÑπÔ∏è"}),l&&e.jsxs("div",{className:"info-bubble-content",children:[e.jsxs("div",{className:"info-bubble-header",children:[e.jsx("h4",{children:a}),e.jsx("button",{className:"info-bubble-close",onClick:()=>m(n),"aria-label":"Fermer",children:"‚úï"})]}),e.jsx("div",{className:"info-bubble-body",children:o})]})]})}function ie({viewMode:n,selectedCamp:a,minGames:o,chartData:i,highlightedPlayer:m,lycansColorScheme:l,playersColor:d,onBarClick:s}){return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("h3",{style:{margin:0},children:n==="performance"?a==="Tous les camps"?"Meilleures performances - Tous les camps":`Meilleurs joueurs en ${a}`:a==="Tous les camps"?"Plus grand % de parties - Tous les camps":`Plus grand % de parties en ${a}`}),e.jsx(Le,{infoId:`bar-chart-${n}-${a}`,title:"√Ä propos de ce graphique",children:n==="performance"?e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:"Filtres actuels :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Affichage :"})," Meilleures Performances"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Camp/R√¥le :"})," ",a]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Minimum de parties :"})," ",o]})]}),(a==="Tous les camps"||a==="Camp Villageois"||a==="Camp Loup"||a==="R√¥les sp√©ciaux")&&e.jsxs("p",{style:{background:"var(--bg-primary)",padding:"0.75rem",borderRadius:"6px",marginTop:"0.5rem"},children:[e.jsxs("strong",{children:["‚ÑπÔ∏è ",a," :"]})," ",a==="Tous les camps"&&"Affiche le meilleur r√¥le de chaque joueur (toutes cat√©gories confondues).",a==="Camp Villageois"&&"Inclut Villageois, Chasseur, Alchimiste, Protecteur, Disciple, Inquisiteur...",a==="Camp Loup"&&"Inclut Loup, Tra√Ætre et Louveteau.",a==="R√¥les sp√©ciaux"&&"Inclut les r√¥les solo comme Amoureux, Idiot du Village, Agent, etc."]}),e.jsx("p",{children:e.jsx("strong",{children:"Comment √ßa marche :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Taux personnel"})," : Le pourcentage de victoires du joueur dans ce camp"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Moyenne du camp"})," : Le taux de victoire moyen de tous les joueurs dans ce camp"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Performance"})," : La diff√©rence entre le taux personnel et la moyenne du camp"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Interpr√©tation :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Performance positive (+)"})," : Le joueur performe mieux que la moyenne"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Performance n√©gative (-)"})," : Le joueur performe moins bien que la moyenne"]})]}),e.jsxs("p",{children:[e.jsx("em",{children:"Exemple :"})," Si un joueur a 60% de victoires en Camp Villageois et que la moyenne est 45%, sa performance est de ",e.jsx("code",{children:"+15%"}),"."]})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{children:e.jsx("strong",{children:"Filtres actuels :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Affichage :"})," Pourcentage de Parties Jou√©es"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Camp/R√¥le :"})," ",a]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Minimum de parties :"})," ",o]})]}),(a==="Tous les camps"||a==="Camp Villageois"||a==="Camp Loup"||a==="R√¥les sp√©ciaux")&&e.jsxs("p",{style:{background:"var(--bg-primary)",padding:"0.75rem",borderRadius:"6px",marginTop:"0.5rem"},children:[e.jsxs("strong",{children:["‚ÑπÔ∏è ",a," :"]})," ",a==="Tous les camps"&&"Affiche le r√¥le le plus jou√© par chaque joueur (toutes cat√©gories confondues).",a==="Camp Villageois"&&"Inclut Villageois, Chasseur, Alchimiste, Protecteur, Disciple, Inquisiteur...",a==="Camp Loup"&&"Inclut Loup, Tra√Ætre et Louveteau.",a==="R√¥les sp√©ciaux"&&"Inclut les r√¥les solo comme Amoureux, Idiot du Village, Agent, etc."]}),e.jsx("p",{children:e.jsx("strong",{children:"Comment √ßa marche :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Parties dans ce r√¥le"})," : Nombre de parties jou√©es avec ce r√¥le/camp"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Total parties"})," : Nombre total de parties jou√©es par le joueur"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Pourcentage"})," : (Parties dans ce r√¥le / Total parties) √ó 100"]})]}),e.jsx("p",{children:e.jsx("strong",{children:"Interpr√©tation :"})}),e.jsxs("ul",{children:[e.jsxs("li",{children:["Un ",e.jsx("strong",{children:"pourcentage √©lev√©"})," indique que le joueur a souvent eu ce r√¥le"]}),e.jsxs("li",{children:["Permet d'identifier les ",e.jsx("strong",{children:"r√¥les r√©currents"})," pour chaque joueur"]}),e.jsxs("li",{children:["Utile pour comprendre l'",e.jsx("strong",{children:"exp√©rience de jeu"})," de chacun"]})]})]})})]}),e.jsx(ye,{title:n==="performance"?a==="Tous les camps"?"Meilleures Performances - Tous les camps":`Meilleurs Joueurs - ${a}`:a==="Tous les camps"?"Pourcentage de Parties Jou√©es - Tous les camps":`Pourcentage de Parties Jou√©es - ${a}`,children:e.jsx("div",{style:{height:500},children:e.jsx(ve,{width:"100%",height:"100%",children:e.jsxs(we,{data:i,margin:{top:20,right:30,left:20,bottom:0},children:[e.jsx(Pe,{strokeDasharray:"3 3"}),e.jsx(xe,{dataKey:a==="Tous les camps"?"uniqueKey":"player",angle:-45,textAnchor:"end",height:110,interval:0,fontSize:15,tick:({x:f,y:c,payload:h,index:T})=>{const x=i[T],W=x?.player||h.value,G=m===(x?.player||h.value);return e.jsx("text",{x:f,y:c,dy:16,textAnchor:"end",fill:G?"var(--accent-primary)":"var(--text-secondary)",fontSize:G?14:13,fontWeight:G?"bold":"italic",transform:`rotate(-45 ${f} ${c})`,children:W})}}),e.jsx(je,{domain:["auto","auto"],label:{value:n==="performance"?"Performance vs moyenne (%)":"Pourcentage de parties jou√©es (%)",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(Ce,{content:({active:f,payload:c})=>{if(f&&c&&c.length>0){const h=c[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a==="Tous les camps"?`${h.player} - ${h.camp}`:h.player})}),n==="performance"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Parties: ",h.games]}),e.jsxs("div",{children:["Victoires: ",h.wins]}),e.jsxs("div",{children:["Taux personnel: ",h.winRate,"%"]}),a!=="Tous les camps"&&e.jsxs("div",{children:["Moyenne camp: ",h.campAvgWinRate,"%"]}),e.jsxs("div",{children:["Performance: ",h.performance>0?"+":"",h.performance]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Parties dans ce r√¥le: ",h.games]}),e.jsxs("div",{children:["Total parties: ",h.totalGames]}),e.jsxs("div",{children:["Pourcentage: ",h.playPercentage?.toFixed(1),"%"]}),e.jsxs("div",{children:["Moyenne tous joueurs: ",h.campAvgPlayPercentage?.toFixed(1),"%"]}),e.jsxs("div",{children:["Taux de victoire: ",h.winRate,"%"]})]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(be,{dataKey:n==="performance"?"performanceNum":"playPercentage",style:{cursor:"pointer"},onClick:s,shape:f=>{const{x:c,y:h,width:T,height:x,payload:W,index:G}=f,V=W,I=m===V.player,H=V.isHighlightedAddition,z=a==="Tous les camps"?l[V.camp]||`var(--chart-color-${(G??0)%6+1})`:d[V.player]||"var(--accent-primary)";return e.jsx(Re,{x:c,y:h,width:T,height:x,fill:z,stroke:I?"var(--accent-primary)":"transparent",strokeWidth:I?3:0,strokeDasharray:H?"5,5":"none",opacity:H?.8:1})}})]})})})})]})}function He(){const{navigateToGameDetails:n,navigationState:a,updateNavigationState:o}=le(),{settings:i}=ce(),m=fe(),{joueursData:l}=ge(),d=he(l),[s,f]=$.useState(a.campPerformanceState?.selectedCampPerformanceCamp||"Camp Villageois"),[c,h]=$.useState(a.campPerformanceState?.selectedCampPerformanceMinGames||50),{playerCampPerformance:T,isLoading:x,error:W}=Me();$.useEffect(()=>{a.campPerformanceState||o({campPerformanceState:{viewMode:"performance",selectedCampPerformanceCamp:s,selectedCampPerformanceMinGames:c}})},[s,c,a.campPerformanceState,o]);const G=$.useMemo(()=>{if(!T?.campAverages)return["Tous les camps"];const r=T.campAverages.map(M=>M.camp),p=["Tous les camps"];r.includes("Camp Villageois")&&p.push("Camp Villageois"),r.includes("Villageois")&&p.push("Villageois"),r.includes("Chasseur")&&p.push("Chasseur"),r.includes("Alchimiste")&&p.push("Alchimiste"),r.includes("Protecteur")&&p.push("Protecteur"),r.includes("Disciple")&&p.push("Disciple"),r.includes("Inquisiteur")&&p.push("Inquisiteur"),r.includes("Camp Loup")&&p.push("Camp Loup"),r.includes("Loup")&&p.push("Loup"),r.includes("Tra√Ætre")&&p.push("Tra√Ætre"),r.includes("Louveteau")&&p.push("Louveteau"),r.includes("R√¥les sp√©ciaux")&&p.push("R√¥les sp√©ciaux");const v=["Camp Villageois","Camp Loup","R√¥les sp√©ciaux"],N=[...["Camp Villageois","Villageois","Chasseur","Alchimiste","Protecteur","Disciple","Inquisiteur","Camp Loup","Loup","Tra√Ætre","Louveteau"],...v],D=r.filter(M=>!N.includes(M)).sort();return[...p,...D]},[T]),{campPlayPercentageData:V,topPlayPercentageData:I}=$.useMemo(()=>{if(!T?.playerPerformance)return{campPlayPercentageData:[],topPlayPercentageData:[],totalPlayPercentagePlayers:0};const{playerPerformance:r}=T,p=new Map,v=new Map;for(const u of r){const P=u.campPerformance.reduce((t,j)=>t+j.games,0);v.set(u.player,P);for(const t of u.campPerformance)if(t.games>=c){const j=p.get(t.camp)||{totalGames:0,totalPlayersWithCamp:0};j.totalGames+=t.games,j.totalPlayersWithCamp+=1,p.set(t.camp,j)}}const A=new Map;for(const[u,P]of p.entries()){const t=P.totalGames/P.totalPlayersWithCamp,j=P.totalPlayersWithCamp;let R=0;for(const g of r)g.campPerformance.find(q=>q.camp===u&&q.games>=c)&&(R+=v.get(g.player)||0);const w=R/j,L=t/w*100;A.set(u,L)}const N=[],D=[],M=new Map;for(const u of r){const P=v.get(u.player)||0;for(const t of u.campPerformance)if(t.games>=c){const j=A.get(t.camp)||0,R=t.games/P*100,w=`${u.player}-${t.camp}`,L={player:u.player,camp:t.camp,games:t.games,wins:t.wins,winRate:t.winRate,performance:t.performance,winRateNum:parseFloat(t.winRate),performanceNum:parseFloat(t.performance),campAvgWinRateNum:parseFloat(t.campAvgWinRate),totalGames:P,playPercentage:R,campAvgPlayPercentage:j,isHighlightedAddition:!1,uniqueKey:w,playerCamp:w},g=M.get(u.player);(!g||L.playPercentage>g.playPercentage)&&M.set(u.player,L),s!=="Tous les camps"&&t.camp===s&&N.push(L)}}D.push(...M.values());const B=(u,P,t=!1)=>{if(!i.highlightedPlayer||u.some(g=>g.player===i.highlightedPlayer&&(!P||g.camp===P)))return u;const R=r.find(g=>g.player===i.highlightedPlayer);if(!R)return u;const w=v.get(i.highlightedPlayer)||R.campPerformance.reduce((g,b)=>g+b.games,0);if(t){let g=null;for(const b of R.campPerformance)if(b.games>=1){const q=b.games/w*100,J=A.get(b.camp)||0,ee=`${R.player}-${b.camp}`,ae={player:R.player,camp:b.camp,games:b.games,wins:b.wins,winRate:b.winRate,performance:b.performance,winRateNum:parseFloat(b.winRate),performanceNum:parseFloat(b.performance),campAvgWinRateNum:parseFloat(b.campAvgWinRate),totalGames:w,playPercentage:q,campAvgPlayPercentage:J,isHighlightedAddition:!0,uniqueKey:ee,playerCamp:ee};(!g||ae.playPercentage>g.playPercentage)&&(g=ae)}return g?[...u,g]:u}const L=[];for(const g of R.campPerformance)if((!P||g.camp===P)&&g.games>=1){const b=g.games/w*100,q=A.get(g.camp)||0,J=`${R.player}-${g.camp}`;L.push({player:R.player,camp:g.camp,games:g.games,wins:g.wins,winRate:g.winRate,performance:g.performance,winRateNum:parseFloat(g.winRate),performanceNum:parseFloat(g.performance),campAvgWinRateNum:parseFloat(g.campAvgWinRate),totalGames:w,playPercentage:b,campAvgPlayPercentage:q,isHighlightedAddition:!0,uniqueKey:J,playerCamp:J})}return[...u,...L]},K=s!=="Tous les camps"?B(N,s,!1):[],S=B(D,void 0,!0),k=K.sort((u,P)=>P.playPercentage-u.playPercentage),C=S.sort((u,P)=>P.playPercentage-u.playPercentage),y=(u,P)=>{const t=u.slice(0,P);if(t.some(w=>w.player===i.highlightedPlayer)||!i.highlightedPlayer)return t;const R=u.find(w=>w.player===i.highlightedPlayer);if(R){const w={...R,isHighlightedAddition:!0};return[...t,w]}return t},F=y(k,15),E=y(C,15);return{campPlayPercentageData:F,topPlayPercentageData:E}},[T,s,c,i.highlightedPlayer]),{campPlayerData:H,topPerformersData:z,totalMatchingPlayers:O}=$.useMemo(()=>{if(!T?.playerPerformance)return{campPlayerData:[],topPerformersData:[],totalMatchingPlayers:0};const{playerPerformance:r}=T,p=[],v=[],A=new Map;for(const C of r)for(const y of C.campPerformance)if(y.games>=c){const F=`${C.player}-${y.camp}`,E={player:C.player,camp:y.camp,games:y.games,wins:y.wins,winRate:y.winRate,performance:y.performance,winRateNum:parseFloat(y.winRate),performanceNum:parseFloat(y.performance),campAvgWinRateNum:parseFloat(y.campAvgWinRate),isHighlightedAddition:!1,uniqueKey:F,playerCamp:F},u=A.get(C.player);(!u||E.performanceNum>u.performanceNum)&&A.set(C.player,E),s!=="Tous les camps"&&y.camp===s&&p.push({player:C.player,...y,winRateNum:parseFloat(y.winRate),performanceNum:parseFloat(y.performance),campAvgWinRateNum:parseFloat(y.campAvgWinRate),isHighlightedAddition:!1,uniqueKey:F,playerCamp:F})}v.push(...A.values());const N=(C,y,F=!1)=>{if(!i.highlightedPlayer||C.some(t=>t.player===i.highlightedPlayer&&(!y||t.camp===y)))return C;const u=r.find(t=>t.player===i.highlightedPlayer);if(!u)return C;if(F){let t=null;for(const j of u.campPerformance)if(j.games>=1){const R=`${u.player}-${j.camp}`,w={player:u.player,camp:j.camp,games:j.games,wins:j.wins,winRate:j.winRate,performance:j.performance,winRateNum:parseFloat(j.winRate),performanceNum:parseFloat(j.performance),campAvgWinRateNum:parseFloat(j.campAvgWinRate),isHighlightedAddition:!0,uniqueKey:R,playerCamp:R};(!t||w.performanceNum>t.performanceNum)&&(t=w)}return t?[...C,t]:C}const P=[];for(const t of u.campPerformance)if((!y||t.camp===y)&&t.games>=1){const j=`${u.player}-${t.camp}`;P.push({player:u.player,camp:t.camp,games:t.games,wins:t.wins,winRate:t.winRate,performance:t.performance,winRateNum:parseFloat(t.winRate),performanceNum:parseFloat(t.performance),campAvgWinRateNum:parseFloat(t.campAvgWinRate),isHighlightedAddition:!0,uniqueKey:j,playerCamp:j})}return[...C,...P]},D=s!=="Tous les camps"?N(p,s,!1):[],M=N(v,void 0,!0),B=D.sort((C,y)=>y.performanceNum-C.performanceNum),K=M.sort((C,y)=>y.performanceNum-C.performanceNum),S=(C,y)=>{const F=C.slice(0,y);if(F.some(P=>P.player===i.highlightedPlayer)||!i.highlightedPlayer)return F;const u=C.find(P=>P.player===i.highlightedPlayer);if(u){const P={...u,isHighlightedAddition:!0};return[...F,P]}return F};let k=0;return s==="Tous les camps"?k=A.size:k=p.length,{campPlayerData:S(B,15),topPerformersData:S(K,15),totalMatchingPlayers:k}},[T,s,c,i.highlightedPlayer]),Z=r=>{r&&r.player&&(s!=="Tous les camps"?n(s==="Camp Loup"?{selectedPlayer:r.player,campFilter:{selectedCamp:"Camp Loup",campFilterMode:"wins-only",excludeWolfSubRoles:!1},fromComponent:`Performance des Joueurs - ${s}`}:s==="Camp Villageois"?{selectedPlayer:r.player,campFilter:{selectedCamp:"Villageois",campFilterMode:"wins-only",excludeVillagers:!1},fromComponent:`Performance des Joueurs - ${s}`}:s==="R√¥les sp√©ciaux"?{selectedPlayer:r.player,fromComponent:`Performance des Joueurs - ${s}`}:{selectedPlayer:r.player,campFilter:{selectedCamp:s,campFilterMode:"wins-only",excludeWolfSubRoles:s==="Tra√Ætre"||s==="Louveteau",excludeVillagers:s==="Chasseur"||s==="Alchimiste"||s==="Protecteur"||s==="Disciple"||s==="Inquisiteur"},fromComponent:`Performance des Joueurs - ${s}`}):r.camp==="Camp Loup"?n({selectedPlayer:r.player,campFilter:{selectedCamp:"Loup",campFilterMode:"wins-only",excludeWolfSubRoles:!1},fromComponent:"Performance des Joueurs - Tous les camps"}):r.camp==="Camp Villageois"?n({selectedPlayer:r.player,campFilter:{selectedCamp:"Villageois",campFilterMode:"wins-only",excludeWolfSubRoles:!0},fromComponent:"Performance des Joueurs - Tous les camps"}):r.camp==="R√¥les sp√©ciaux"?n({selectedPlayer:r.player,fromComponent:"Performance des Joueurs - Tous les camps"}):n({selectedPlayer:r.player,campFilter:{selectedCamp:r.camp,campFilterMode:"wins-only",excludeWolfSubRoles:r.camp==="Tra√Ætre"||r.camp==="Louveteau",excludeVillagers:r.camp==="Chasseur"||r.camp==="Alchimiste"||r.camp==="Protecteur"||r.camp==="Disciple"||r.camp==="Inquisiteur"},fromComponent:"Performance des Joueurs - Tous les camps"}))};return x?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de performance par camp..."}):W?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",W]}):T?e.jsxs("div",{className:"lycans-player-camp-performance",children:[e.jsx("h2",{children:"Comparaison des Camps"}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsx("select",{id:"camp-select",value:s,onChange:r=>{const p=r.target.value;f(p),o({campPerformanceState:{viewMode:"performance",selectedCampPerformanceCamp:p,selectedCampPerformanceMinGames:c}})},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"200px"},children:G.map(r=>{let p=r,v=!1,A=!1,N=!1;return r==="Tous les camps"?(p="üìä Tous les camps",N=!0):r==="Camp Villageois"?(p="   üèòÔ∏è Camp Villageois",v=!0,A=!0):r==="Villageois"?(p="   Villageois",v=!0):r==="Chasseur"?(p="     Chasseur",v=!0):r==="Alchimiste"?(p="     Alchimiste",v=!0):r==="Protecteur"?(p="     Protecteur",v=!0):r==="Disciple"?(p="     Disciple",v=!0):r==="Inquisiteur"?(p="     Inquisiteur",v=!0):r==="Camp Loup"?(p="   üê∫ Camp Loup",v=!0,A=!0):r==="Loup"?(p="     Loup",v=!0):r==="Tra√Ætre"?(p="     Tra√Ætre",v=!0):r==="Louveteau"?(p="     Louveteau",v=!0):r==="R√¥les sp√©ciaux"?(p="   ‚≠ê R√¥les sp√©ciaux",v=!0,A=!0):(p=`     ${r}`,v=!0),e.jsx("option",{value:r,style:{fontFamily:"monospace",fontSize:v?"0.85rem":"0.9rem",fontWeight:A?"bold":"normal",color:A?"var(--accent-primary)":N?"var(--accent-secondary)":"inherit"},children:p},r)})})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"min-games-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select",value:c,onChange:r=>{const p=Number(r.target.value);h(p),o({campPerformanceState:{viewMode:"performance",selectedCampPerformanceCamp:s,selectedCampPerformanceMinGames:p}})},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",width:"90px"},children:de.map(r=>e.jsx("option",{value:r,children:r},r))})]})]}),e.jsx("div",{style:{textAlign:"center",marginBottom:"1.5rem",padding:"0.75rem",background:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.95rem",fontWeight:"500"},children:[O," joueur",O!==1?"s":""," ",O!==1?"correspondent":"correspond"," aux crit√®res"]})}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"2rem",marginBottom:"2rem"},children:[e.jsxs("div",{children:[e.jsx("h3",{style:{textAlign:"center",marginBottom:"1rem"},children:"Meilleures Performances par Camp"}),e.jsx(ie,{viewMode:"performance",selectedCamp:s,minGames:c,chartData:s==="Tous les camps"?z:H,highlightedPlayer:i.highlightedPlayer,lycansColorScheme:m,playersColor:d,onBarClick:Z})]}),e.jsxs("div",{children:[e.jsx("h3",{style:{textAlign:"center",marginBottom:"1rem"},children:"Pourcentage de Parties Jou√©es par R√¥le"}),e.jsx(ie,{viewMode:"playPercentage",selectedCamp:s,minGames:c,chartData:s==="Tous les camps"?I:V,highlightedPlayer:i.highlightedPlayer,lycansColorScheme:m,playersColor:d,onBarClick:Z})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de performance par camp disponible"})}export{He as PlayerCampChart};
