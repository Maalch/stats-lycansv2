import{c as G,r as x,j as e}from"./index-g8DWQRoS.js";import{a as b}from"./baseStatsHook-DmuJ54Fe.js";import{F as v,C as j,X as p,Y as y,a as f}from"./FullscreenChart-BWQ0mX6C.js";import{b as S}from"./api-kDPDcdrM.js";import{R as C,T as P}from"./CategoricalChart-CRZ4pUwh.js";import{B as w,a as R}from"./BarChart-B3JDtKGY.js";function W(s){const u=s.length,n=new Map;return s.forEach(i=>{const r=new Set;i.PlayerStats.forEach(l=>{const c=l.Color;if(!c)return;n.has(c)||n.set(c,{gamesWithColor:new Set,totalPlayerInstances:0,totalWins:0});const d=n.get(c);r.add(c),d.totalPlayerInstances++,l.Victorious&&d.totalWins++}),r.forEach(l=>{n.get(l).gamesWithColor.add(i.Id)})}),Array.from(n.entries()).map(([i,r])=>{const l=r.gamesWithColor.size,c=r.totalPlayerInstances>0?r.totalWins/r.totalPlayerInstances*100:0,d=u>0?r.totalPlayerInstances/u:0;return{color:i,totalGames:l,totalPlayers:r.totalPlayerInstances,totalWins:r.totalWins,winRate:c,avgPlayersPerGame:d}}).sort((i,r)=>r.winRate-i.winRate)}function M(){const{data:s,isLoading:u,error:n}=b(h=>W(h));return{data:s,isLoading:u,error:n}}function E(){const{data:s,isLoading:u,error:n}=M(),{gameData:h}=G(),i=S(),[r,l]=x.useState(null),c=x.useMemo(()=>h?.length||0,[h]),{winRateChartData:d,usageChartData:g}=x.useMemo(()=>{if(!s||s.length===0)return{winRateChartData:[],usageChartData:[]};const a=[...s].sort((t,m)=>m.winRate-t.winRate).map(t=>({color:t.color,winRate:parseFloat(t.winRate.toFixed(2)),totalGames:t.totalGames,totalWins:t.totalWins,totalPlayers:t.totalPlayers,displayColor:i[t.color]||"#888888"})),o=[...s].sort((t,m)=>m.avgPlayersPerGame-t.avgPlayersPerGame).map(t=>({color:t.color,avgPlayersPerGame:parseFloat(t.avgPlayersPerGame.toFixed(2)),totalGames:t.totalGames,totalPlayers:t.totalPlayers,displayColor:i[t.color]||"#888888"}));return{winRateChartData:a,usageChartData:o}},[s,i]);return u?e.jsx("div",{className:"statistiques-chargement",children:"Chargement des statistiques de couleurs..."}):n?e.jsxs("div",{className:"statistiques-erreur",children:["Erreur lors du chargement : ",n]}):!s||s.length===0?e.jsx("div",{className:"statistiques-vide",children:"Aucune donnée de couleur disponible"}):e.jsxs("div",{className:"color-statistics-container",children:[e.jsx("h2",{children:"Statistiques des Couleurs"}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire par Couleur"}),e.jsx(v,{title:"Taux de Victoire par Couleur",children:e.jsx(C,{width:"100%",height:400,children:e.jsxs(w,{data:d,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(j,{strokeDasharray:"3 3"}),e.jsx(p,{dataKey:"color",angle:-45,textAnchor:"end",height:100,interval:0,tick:({x:a,y:o,payload:t})=>e.jsx("text",{x:a,y:o,dy:16,textAnchor:"end",fill:r===t.value?"var(--text-primary)":"var(--text-secondary)",fontSize:r===t.value?14:12,fontWeight:r===t.value?"bold":"normal",transform:`rotate(-45 ${a} ${o})`,children:t.value})}),e.jsx(y,{label:{value:"Taux de Victoire (%)",angle:270,position:"left",style:{fill:"var(--text-secondary)",textAnchor:"middle"}},domain:[0,100]}),e.jsx(P,{content:({active:a,payload:o})=>{if(a&&o&&o.length){const t=o[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:t.color})}),e.jsxs("div",{children:["Taux de Victoire: ",e.jsxs("strong",{children:[t.winRate.toFixed(2),"%"]})]}),e.jsxs("div",{children:["Victoires: ",t.totalWins," / ",t.totalPlayers]}),e.jsxs("div",{children:["Parties: ",t.totalGames]})]})}return null}}),e.jsx(R,{dataKey:"winRate",children:d.map((a,o)=>e.jsx(f,{fill:a.displayColor,stroke:r===a.color?"var(--text-primary)":"none",strokeWidth:r===a.color?2:0,onMouseEnter:()=>l(a.color),onMouseLeave:()=>l(null),style:{cursor:"pointer"}},`cell-${o}`))})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Nombre Moyen de Joueurs par Couleur"}),e.jsx(v,{title:"Nombre Moyen de Joueurs par Couleur",children:e.jsx(C,{width:"100%",height:400,children:e.jsxs(w,{data:g,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(j,{strokeDasharray:"3 3"}),e.jsx(p,{dataKey:"color",angle:-45,textAnchor:"end",height:100,interval:0,tick:({x:a,y:o,payload:t})=>e.jsx("text",{x:a,y:o,dy:16,textAnchor:"end",fill:r===t.value?"var(--text-primary)":"var(--text-secondary)",fontSize:r===t.value?14:12,fontWeight:r===t.value?"bold":"normal",transform:`rotate(-45 ${a} ${o})`,children:t.value})}),e.jsx(y,{label:{value:"Joueurs par Partie",angle:270,position:"left",style:{fill:"var(--text-secondary)",textAnchor:"middle"}}}),e.jsx(P,{content:({active:a,payload:o})=>{if(a&&o&&o.length){const t=o[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:t.color})}),e.jsxs("div",{children:["Moyenne: ",e.jsxs("strong",{children:[t.avgPlayersPerGame.toFixed(2)," joueurs/partie"]})]}),e.jsxs("div",{children:["Calcul: ",t.totalPlayers," joueurs ÷ ",c," parties totales"]}),e.jsxs("div",{children:["Parties avec cette couleur: ",t.totalGames]})]})}return null}}),e.jsx(R,{dataKey:"avgPlayersPerGame",children:g.map((a,o)=>e.jsx(f,{fill:a.displayColor,stroke:r===a.color?"var(--text-primary)":"none",strokeWidth:r===a.color?2:0,onMouseEnter:()=>l(a.color),onMouseLeave:()=>l(null),style:{cursor:"pointer"}},`cell-${o}`))})]})})})]})]})]})}export{E as ColorStatisticsChart};
