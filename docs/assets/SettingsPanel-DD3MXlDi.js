import{a as S,r as i,j as e}from"./index-BxAOeDzO.js";function E(){const{generateUrlWithSettings:a}=S(),[r,o]=i.useState(!1),u=async()=>{const h=a();try{await navigator.clipboard.writeText(h),o(!0),setTimeout(()=>o(!1),2e3)}catch{const m=document.createElement("textarea");m.value=h,document.body.appendChild(m),m.select(),document.execCommand("copy"),document.body.removeChild(m),o(!0),setTimeout(()=>o(!1),2e3)}};return e.jsx("div",{className:"shareable-url-container",children:e.jsx("button",{onClick:u,className:"shareable-url-btn",type:"button",title:"Copier le lien avec les filtres actuels",children:r?"‚úÖ Copi√©!":"üîó Copier le lien"})})}function A(){const{settings:a,updateSettings:r,resetSettings:o}=S(),[u,h]=i.useState(null),c=i.useRef({filterMode:a.filterMode,gameFilter:a.gameFilter,dateStart:a.dateRange.start,dateEnd:a.dateRange.end,mapNameFilter:a.mapNameFilter});i.useEffect(()=>{(async()=>{try{const l=await(await fetch("/data/gameLog.json")).json();h(l.GameStats||[])}catch(t){console.error("Error fetching game log data:",t)}})()},[]),i.useEffect(()=>{const s={filterMode:a.filterMode,gameFilter:a.gameFilter,dateStart:a.dateRange.start,dateEnd:a.dateRange.end,mapNameFilter:a.mapNameFilter};(c.current.filterMode!==s.filterMode||c.current.gameFilter!==s.gameFilter||c.current.dateStart!==s.dateStart||c.current.dateEnd!==s.dateEnd||c.current.mapNameFilter!==s.mapNameFilter)&&a.playerFilter.players.length>0&&r({playerFilter:{mode:a.playerFilter.mode,players:[]}}),c.current=s},[a.filterMode,a.gameFilter,a.dateRange.start,a.dateRange.end,a.mapNameFilter,a.playerFilter.players.length,r]);const m=s=>{if(!s)return null;try{return new Date(s)}catch{return null}},p=i.useMemo(()=>u?u.filter(s=>{if(a.filterMode==="gameType"&&(a.gameFilter==="modded"&&!s.Modded||a.gameFilter==="non-modded"&&s.Modded))return!1;if(a.filterMode==="dateRange"&&(a.dateRange.start||a.dateRange.end)){const t=m(s.StartDate);if(!t)return!1;if(a.dateRange.start){const l=new Date(a.dateRange.start);if(t<l)return!1}if(a.dateRange.end){const l=new Date(a.dateRange.end);if(t>l)return!1}}if(a.filterMode==="mapName"&&a.mapNameFilter!=="all"){const t=s.MapName||"";if(a.mapNameFilter==="village"&&t!=="Village"||a.mapNameFilter==="chateau"&&t!=="Ch√¢teau"||a.mapNameFilter==="others"&&(t==="Village"||t==="Ch√¢teau"))return!1}return!0}):[],[u,a.filterMode,a.gameFilter,a.dateRange,a.mapNameFilter]),v=i.useMemo(()=>{const s=new Set;return p.forEach(t=>{t.PlayerStats.forEach(l=>{s.add(l.Username)})}),Array.from(s)},[p]),F=i.useMemo(()=>{const s={};return p.forEach(t=>{const l=t.PlayerStats.map(n=>n.Username);l.forEach(n=>{s[n]||(s[n]=new Set),l.forEach(d=>{n!==d&&s[n].add(d)})})}),s},[p]),{availablePlayers:b,selectablePlayers:g}=i.useMemo(()=>{const s=v.sort();if(a.playerFilter.mode==="none"||a.playerFilter.players.length===0)return{availablePlayers:s,selectablePlayers:new Set(s)};const t=new Set;return a.playerFilter.mode==="include"?s.forEach(l=>{(a.playerFilter.players.includes(l)||a.playerFilter.players.every(d=>F[l]?.has(d)||!1))&&t.add(l)}):a.playerFilter.mode==="exclude"&&s.forEach(l=>{(a.playerFilter.players.includes(l)||p.some(d=>{const k=d.PlayerStats.map(N=>N.Username.toLowerCase());return k.includes(l.toLowerCase())?!a.playerFilter.players.some(N=>k.includes(N.toLowerCase())):!1}))&&t.add(l)}),{availablePlayers:s,selectablePlayers:t}},[v,a.playerFilter,F,p]),j=s=>{r({filterMode:s})},y=s=>{r({gameFilter:s})},C=(s,t)=>{r({dateRange:{...a.dateRange,[s]:t||null}})},x=s=>{r({mapNameFilter:s})},f=s=>{r({playerFilter:{...a.playerFilter,mode:s}})},R=s=>{const t=a.playerFilter.players;if(t.includes(s)){const n=t.filter(d=>d!==s);r({playerFilter:{...a.playerFilter,players:n}})}else r({playerFilter:{...a.playerFilter,players:[...t,s]}})},M=()=>{r({playerFilter:{...a.playerFilter,players:[...g]}})},P=()=>{r({playerFilter:{...a.playerFilter,players:[]}})},T=s=>{r({highlightedPlayer:s||null})};return e.jsxs("div",{className:"settings-panel",children:[e.jsxs("div",{className:"settings-section",children:[e.jsx("div",{className:"settings-section-header",children:e.jsx("h3",{children:"Joueur √† Mettre en √âvidence"})}),e.jsxs("div",{className:"settings-group",children:[e.jsx("p",{className:"settings-explanation",children:"S√©lectionnez un joueur qui sera toujours affich√© et mis en √©vidence dans tous les graphiques g√©n√©raux, m√™me s'il n'est pas dans le top classement."}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("label",{htmlFor:"highlighted-player-select",style:{display:"block",marginBottom:"0.5rem",color:"var(--text-primary)",fontWeight:"500"},children:"Joueur √† mettre en √©vidence :"}),e.jsxs("select",{id:"highlighted-player-select",value:a.highlightedPlayer||"",onChange:s=>T(s.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",width:"100%",maxWidth:"300px"},children:[e.jsx("option",{value:"",children:"Aucun joueur s√©lectionn√©"}),b.map(s=>e.jsx("option",{value:s,children:s},s))]}),a.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontStyle:"italic"},children:['Le joueur "',a.highlightedPlayer,'" sera mis en √©vidence dans tous les graphiques.']})]})]})]}),e.jsxs("div",{className:"settings-header",children:[e.jsx("h3",{children:"Param√®tres de Filtrage"}),e.jsx("button",{onClick:o,className:"settings-reset-btn",type:"button",children:"R√©initialiser"})]}),e.jsxs("div",{className:"settings-sections-container",children:[e.jsxs("div",{className:"settings-section",children:[e.jsx("div",{className:"settings-section-header",children:e.jsx("h3",{children:"1. Filtre Principal"})}),e.jsxs("div",{className:"settings-group",children:[e.jsx("h4",{children:"Mode de Filtrage"}),e.jsx("p",{className:"settings-explanation",children:"Choisissez le type de filtre principal √† appliquer aux donn√©es :"}),e.jsxs("div",{className:"settings-radio-group",style:{flexDirection:"row",gap:"2rem"},children:[e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"filterMode",value:"gameType",checked:a.filterMode==="gameType",onChange:()=>j("gameType")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Filtrer par type de partie",e.jsx("small",{children:"S√©lectionner selon le type de jeu (modd√©/standard)"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"filterMode",value:"dateRange",checked:a.filterMode==="dateRange",onChange:()=>j("dateRange")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Filtrer par p√©riode",e.jsx("small",{children:"S√©lectionner selon une plage de dates"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"filterMode",value:"mapName",checked:a.filterMode==="mapName",onChange:()=>j("mapName")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Filtrer par carte",e.jsx("small",{children:"S√©lectionner selon la carte utilis√©e"})]})]})]})]}),a.filterMode==="gameType"&&e.jsxs("div",{className:"settings-group",children:[e.jsx("h4",{children:"Filtres de Type de Partie"}),e.jsxs("div",{className:"settings-radio-group",children:[e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"all",checked:a.gameFilter==="all",onChange:()=>y("all")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Tous les types de parties",e.jsx("small",{children:"Inclut toutes les parties, modd√©es et non-modd√©es"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"modded",checked:a.gameFilter==="modded",onChange:()=>y("modded")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Parties modd√©es uniquement",e.jsx("small",{children:"Affiche uniquement les parties avec des r√¥les modifi√©s"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"non-modded",checked:a.gameFilter==="non-modded",onChange:()=>y("non-modded")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Parties non-modd√©es uniquement",e.jsx("small",{children:"Affiche uniquement les parties avec des r√¥les standards"})]})]})]})]}),a.filterMode==="dateRange"&&e.jsxs("div",{className:"settings-group",children:[e.jsx("h4",{children:"Filtres de Dates"}),e.jsxs("div",{className:"settings-radio-group",children:[e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"dateFilter",value:"all",checked:!a.dateRange.start&&!a.dateRange.end,onChange:()=>{r({dateRange:{start:null,end:null}})}}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Toutes les dates",e.jsx("small",{children:"Affiche toutes les parties sans restriction de date"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"dateFilter",value:"custom",checked:!!(a.dateRange.start||a.dateRange.end),onChange:()=>{if(!a.dateRange.start&&!a.dateRange.end){const s=new Date,t=new Date(s.getFullYear(),s.getMonth()-1,s.getDate());r({dateRange:{start:t.toISOString().split("T")[0],end:s.toISOString().split("T")[0]}})}}}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Plage de dates personnalis√©e",e.jsx("small",{children:"D√©finir une p√©riode sp√©cifique √† analyser"})]})]})]}),(a.dateRange.start||a.dateRange.end)&&e.jsxs("div",{className:"settings-nested-group",children:[e.jsxs("div",{className:"settings-date-inputs",children:[e.jsxs("label",{className:"settings-date-label",children:["Date de d√©but",e.jsx("input",{type:"date",value:a.dateRange.start||"",onChange:s=>C("start",s.target.value),className:"settings-date-input",max:a.dateRange.end||void 0})]}),e.jsx("span",{className:"settings-date-separator",children:"‚Äî"}),e.jsxs("label",{className:"settings-date-label",children:["Date de fin",e.jsx("input",{type:"date",value:a.dateRange.end||"",onChange:s=>C("end",s.target.value),className:"settings-date-input",min:a.dateRange.start||void 0})]})]}),e.jsx("small",{style:{color:"var(--text-secondary, #6c757d)",marginTop:8,display:"block"},children:"Laissez vide pour ne pas limiter le d√©but ou la fin de la p√©riode."})]})]}),a.filterMode==="mapName"&&e.jsxs("div",{className:"settings-group",children:[e.jsx("h4",{children:"S√©lection de Cartes"}),e.jsx("p",{className:"settings-explanation",children:"Choisissez quelles cartes inclure dans les statistiques :"}),e.jsxs("div",{className:"settings-radio-group",children:[e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"mapNameFilter",value:"all",checked:a.mapNameFilter==="all",onChange:()=>x("all")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Toutes les cartes",e.jsx("small",{children:"Inclure toutes les cartes disponibles"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"mapNameFilter",value:"village",checked:a.mapNameFilter==="village",onChange:()=>x("village")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Village",e.jsx("small",{children:"Uniquement les parties sur la carte Village"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"mapNameFilter",value:"chateau",checked:a.mapNameFilter==="chateau",onChange:()=>x("chateau")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Ch√¢teau",e.jsx("small",{children:"Uniquement les parties sur la carte Ch√¢teau"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"mapNameFilter",value:"others",checked:a.mapNameFilter==="others",onChange:()=>x("others")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Autres",e.jsx("small",{children:"Toutes les autres cartes (Ashfang Woods, Donjon, etc.)"})]})]})]})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("div",{className:"settings-section-header",children:e.jsx("h3",{children:"2. Filtre Additionnel par Joueurs"})}),e.jsxs("div",{className:"settings-group",children:[e.jsxs("div",{className:"settings-radio-group",children:[e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"playerFilterMode",value:"none",checked:a.playerFilter.mode==="none",onChange:()=>f("none")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Aucun filtre par joueur",e.jsx("small",{children:"Affiche toutes les parties sans restriction par joueur"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"playerFilterMode",value:"include",checked:a.playerFilter.mode==="include",onChange:()=>f("include")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Inclure seulement les parties avec ces joueurs",e.jsx("small",{children:"Affiche uniquement les parties o√π TOUS les joueurs s√©lectionn√©s ont particip√© ensemble"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"playerFilterMode",value:"exclude",checked:a.playerFilter.mode==="exclude",onChange:()=>f("exclude")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Exclure les parties avec ces joueurs",e.jsx("small",{children:"Affiche uniquement les parties o√π aucun des joueurs list√©s n'a particip√©"})]})]})]}),(a.playerFilter.mode==="include"||a.playerFilter.mode==="exclude")&&e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[e.jsxs("label",{style:{fontWeight:500},children:["S√©lection des joueurs (",a.playerFilter.players.length," s√©lectionn√©",a.playerFilter.players.length!==1?"s":""," sur ",g.size," disponible",g.size!==1?"s":"",")"]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:M,style:{padding:"4px 8px",fontSize:"0.8rem",border:"1px solid var(--border-color, #ccc)",borderRadius:"4px",background:"var(--bg-tertiary, #f0f0f0)",color:"var(--text-primary, #333)",cursor:"pointer"},children:"Tout s√©lectionner"}),e.jsx("button",{type:"button",onClick:P,style:{padding:"4px 8px",fontSize:"0.8rem",border:"1px solid var(--border-color, #ccc)",borderRadius:"4px",background:"var(--bg-tertiary, #f0f0f0)",color:"var(--text-primary, #333)",cursor:"pointer"},children:"Tout d√©s√©lectionner"})]})]}),e.jsx("div",{className:"settings-player-grid",children:b.map(s=>{const t=g.has(s),l=a.playerFilter.players.includes(s);return e.jsxs("label",{className:`settings-player-checkbox ${t?"":"disabled"}`,style:{opacity:t?1:.5,cursor:t?"pointer":"not-allowed"},children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>t&&R(s),disabled:!t}),e.jsx("span",{className:"settings-player-checkmark"}),e.jsx("span",{className:"settings-player-name",title:!t&&!l?`${s} n'a ${a.playerFilter.mode==="include"?"pas jou√© avec tous les joueurs s√©lectionn√©s":"que des parties avec les joueurs exclus"}`:s,children:s})]},s)})}),e.jsxs("small",{style:{color:"var(--text-secondary, #6c757d)",marginTop:8,display:"block"},children:["S√©lectionnez les joueurs √† ",a.playerFilter.mode==="include"?"inclure":"exclure"," dans le filtrage."]})]})]})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("div",{className:"settings-section-header",children:e.jsx("h3",{children:"Partage des Filtres"})}),e.jsxs("div",{className:"settings-group",children:[e.jsx("p",{className:"settings-explanation",children:"Copiez le lien ci-dessous pour partager les filtres actuels avec d'autres personnes. Ils pourront ouvrir le site avec ces m√™mes filtres appliqu√©s."}),e.jsx(E,{})]})]}),e.jsx("div",{className:"settings-info",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," Les changements de filtres sont sauvegard√©s automatiquement et s'appliquent √† toutes les statistiques affich√©es."]})})]})}export{A as SettingsPanel};
