import{r as b,u as A,a as w,j as s,l as L,k as E}from"./index-B0D0EGXu.js";import{u as q,g as D}from"./api-bxHpvbf5.js";function z(o){const[h,k]=b.useState(null),[v,P]=b.useState(!1),[g,F]=b.useState(null);b.useEffect(()=>{let i=!0;return(async()=>{try{P(!0),F(null);const c=await fetch("/data/playerAchievements.json");if(!c.ok)throw new Error(`Failed to load achievements: ${c.status} ${c.statusText}`);const y=await c.json();i&&(k(y),console.log("âœ… Pre-calculated achievements loaded:",{totalPlayers:y.totalPlayers,totalGames:y.totalGames,generatedAt:y.generatedAt,playersWithAchievements:Object.keys(y.achievements).length}))}catch(c){i&&(F(c instanceof Error?c.message:"Failed to load achievements"),console.error("Error loading pre-calculated achievements:",c))}finally{i&&P(!1)}})(),()=>{i=!1}},[]);const C=o&&h?.achievements[o]||null;return b.useEffect(()=>{if(o&&h){const i=h.achievements[o];i?console.log(`ðŸ† Achievements for ${o}:`,{allGames:i.allGamesAchievements.length,moddedOnly:i.moddedOnlyAchievements.length,categories:[...new Set([...i.allGamesAchievements.map(j=>j.category),...i.moddedOnlyAchievements.map(j=>j.category)])]}):console.log(`âŒ No achievements found for ${o}`)}},[o,h]),{data:C,isLoading:v,error:g,metadata:{generatedAt:h?.generatedAt||null,totalPlayers:h?.totalPlayers||0,totalGames:h?.totalGames||0,totalModdedGames:h?.totalModdedGames||0}}}function M({achievements:o,title:h,emptyMessage:k,achievementType:v="all"}){const{navigateToTab:P,updateNavigationState:g,clearNavigation:F}=A(),{settings:C,updateSettings:i}=w(),j=q(),c=(e,u)=>{if(u.stopPropagation(),!e.redirectTo)return;F();const f=C.highlightedPlayer;if(i(v==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:f,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:f,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),e.category==="comparison"&&e.redirectTo.subTab==="comparison"){const a=C.highlightedPlayer||"",t=y(e.description,a);t&&g({playerComparisonState:{selectedPlayer1:a,selectedPlayer2:t,showDetailedStats:!0}})}if(e.category==="comparison"&&e.redirectTo.subTab==="pairing"){const a=e.description.toLowerCase().includes("loup");g({selectedPairingTab:a?"wolves":"lovers"})}if(e.category==="kills"&&e.redirectTo.subTab==="deathStats"){const a=e.description.match(/(Villageois|Loups|Autres)/i);a&&g({deathStatsSelectedCamp:a[1]});let t=10;const l=e.description.match(/min\.\s*(\d+)/);l&&(t=parseInt(l[1],10));let d="totalKills";const p=e.redirectTo.chartSection;p&&(p==="killers-total"?d="totalKills":p==="killers-average"?d="averageKills":p==="deaths-total"?d="totalDeaths":p==="survivors-average"&&(d="survivalRate")),g({deathStatisticsState:{selectedCamp:a?.[1]||"Tous les camps",minGamesForAverage:t,focusChart:d}})}if(e.category==="map"&&e.redirectTo.subTab==="playersGeneral"){const a=e.redirectTo.mapFilter||"all";let t=10;const l=e.description.match(/min\.\s*(\d+)/);l&&(t=parseInt(l[1])),i(v==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:a,playerFilter:{mode:"none",players:[]},highlightedPlayer:f,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:a,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:a,playerFilter:{mode:"none",players:[]},highlightedPlayer:f,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:a,playerFilter:{mode:"none",players:[]}}}),g({playersGeneralState:{minGamesForWinRate:t,winRateOrder:"best",focusChart:"winRate"}}),P("players","playersGeneral");return}if(e.category==="history"&&e.redirectTo.subTab==="history"&&g({selectedPlayerName:C.highlightedPlayer||"",groupingMethod:"session"}),e.category==="series"&&e.redirectTo.subTab==="series"){let a="wins";const t=e.title.toLowerCase(),l=e.description.toLowerCase();t.includes("dÃ©faite")||l.includes("dÃ©faite")?a="losses":t.includes("loup")||l.includes("loup")?a="loup":t.includes("villageois")||l.includes("villageois")?a="villageois":(t.includes("victoire")||l.includes("victoire"))&&(a="wins"),g({selectedSeriesType:a})}if(e.category==="general"&&e.redirectTo.subTab==="playersGeneral"){let a=10;const t=e.description.match(/min\.\s*(\d+)/);t&&(a=parseInt(t[1],10));let l="winRate",d="best";const p=e.title.toLowerCase(),N=e.description.toLowerCase();p.includes("participation")||N.includes("participation")?l="participation":(p.includes("taux de victoire")||N.includes("taux de victoire"))&&(l="winRate",(p.includes("moins bon")||p.includes("mauvais")||N.includes("moins bon")||N.includes("mauvais"))&&(d="worst")),g({playersGeneralState:{minGamesForWinRate:a,winRateOrder:d,focusChart:l}})}if(e.category==="performance"&&e.redirectTo.subTab==="campPerformance"){const a=e.redirectTo.chartSection;let t="Villageois",l=1;a&&(a==="camp-loup"?t="Loup":a==="camp-villageois"?t="Villageois":a==="camp-idiot"?t="Idiot du Village":a==="camp-amoureux"?t="Amoureux":(a==="solo-roles"||a==="hall-of-fame")&&(t="Villageois"));const d=e.description.match(/min\.\s*(\d+)/);d&&(l=parseInt(d[1],10)),a==="solo-roles"?t="RÃ´les spÃ©ciaux":a==="hall-of-fame"&&(t="Tous les camps"),g({campPerformanceState:{selectedCampPerformanceCamp:t,selectedCampPerformanceMinGames:l}})}P(e.redirectTo.tab,e.redirectTo.subTab)},y=(e,u)=>{const f=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const a of f){const t=e.match(a);if(t&&t[1]){const l=t[1].trim();if(l!==u)return l}}return null},x=e=>{if(!e.redirectTo)return"Aucune navigation disponible";switch(e.category){case"general":if(e.redirectTo.subTab==="playersGeneral"){const a=e.description.match(/min\.\s*(\d+)/),t=a?parseInt(a[1],10):10,l=e.title.toLowerCase(),d=v==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return l.includes("taux de victoire")?`Classement: ${e.rank}${e.totalRanked?`/${e.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${t} parties)${d}`:l.includes("participation")?`Classement: ${e.rank}${e.totalRanked?`/${e.totalRanked} joueurs`:""} - Cliquez pour voir les participations${d}`:`Classement: ${e.rank}${e.totalRanked?`/${e.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${d}`}break;case"map":if(e.redirectTo.subTab==="playersGeneral"){const a=e.redirectTo.mapFilter,t=a==="village"?"Village":a==="chateau"?"ChÃ¢teau":"map",l=v==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${e.rank}${e.totalRanked?`/${e.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${t}${l}`}break;case"history":if(e.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(e.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${y(e.description,C.highlightedPlayer||"")||"ce joueur"}`;if(e.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(e.redirectTo.subTab==="deathStats"){const a=e.description.match(/(Villageois|Loups|Autres)/i),t=e.description.match(/min\.\s*(\d+)/),l=t?parseInt(t[1],10):10,d=a?.[1]||"Tous les camps",p=e.redirectTo.chartSection;let N="kills et morts";return p==="killers-total"?N="total des kills":p==="killers-average"?N=`moyenne des kills (min. ${l} parties)`:p==="deaths-total"?N="total des morts":p==="survivors-average"&&(N=`taux de survie (min. ${l} parties)`),`Cliquez pour voir les statistiques de ${N} ${d!=="Tous les camps"?`en ${d}`:""}`}break;case"series":if(e.redirectTo.subTab==="series"){const a=e.title.toLowerCase(),t=e.description.toLowerCase();return a.includes("dÃ©faite")||t.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":a.includes("loup")||t.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":a.includes("villageois")||t.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":a.includes("victoire")||t.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(e.redirectTo.subTab==="campPerformance"){const a=e.redirectTo.chartSection,t=v==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return a==="camp-loup"?`Cliquez pour voir les performances camp Loup${t}`:a==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${t}`:a==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${t}`:a==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${t}`:a==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${t}`:a==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${t}`:`Cliquez pour voir les performances par camp${t}`}break}return`Cliquez pour voir ${e.redirectTo.subTab}`+(v==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},T=e=>j[e]||D(e),R=e=>{const u=[/avec ([^:]+?):/,/contre ([^:]+?):/];let f=e;return u.forEach(a=>{const t=e.match(a);if(t&&t[1]){const l=t[1].trim(),p=`<span class="player-name-highlight" style="color: ${T(l)};">${l}</span>`;f=f.replace(l,p)}}),f};if(o.length===0)return s.jsxs("div",{className:"achievements-empty",children:[s.jsx("h4",{children:h}),s.jsx("p",{children:k||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const S=e=>e===1?"ðŸ¥‡":e===2?"ðŸ¥ˆ":e===3?"ðŸ¥‰":"",r=e=>e===1?"rank-1":e===2?"rank-2":e===3?"rank-3":e&&e<=10?"rank-top-10":"",n=o.filter(e=>e.category!=="comparison"&&e.type==="good").sort((e,u)=>(e.rank??999)-(u.rank??999)),m=o.filter(e=>e.category!=="comparison"&&e.type==="bad").sort((e,u)=>(e.rank??999)-(u.rank??999)),$=o.filter(e=>e.category==="comparison"),G=n.filter(e=>e.rank&&e.rank<=3).length;return s.jsxs("div",{className:"achievements-container",children:[s.jsx("h4",{children:h}),G>0&&s.jsxs("div",{className:"top3-showcase",children:[s.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),s.jsx("div",{className:"top3-grid",children:n.filter(e=>e.rank&&e.rank<=3).map((e,u)=>s.jsxs("div",{className:`top3-card ${r(e.rank)} animate-slide-in`,style:{animationDelay:`${u*.15}s`},onClick:f=>c(e,f),title:x(e),children:[s.jsx("div",{className:"top3-medal-container",children:s.jsx("span",{className:"top3-medal",children:S(e.rank)})}),s.jsxs("div",{className:"top3-content",children:[s.jsxs("div",{className:"top3-rank-badge",children:["#",e.rank,e.totalRanked?`/${e.totalRanked}`:""]}),s.jsx("h6",{className:"top3-achievement-title",children:e.title}),s.jsx("p",{className:"top3-achievement-description",children:e.description})]}),s.jsxs("div",{className:"top3-sparkles",children:[s.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),s.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),s.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},e.id))})]}),n.length>0&&s.jsxs("div",{className:"achievements-section good-achievements",children:[s.jsx("h5",{children:"ðŸ† Classements"}),s.jsx("div",{className:"achievements-grid",children:n.filter(e=>!e.rank||e.rank>3).map((e,u)=>s.jsxs("div",{className:`achievement-card good ${r(e.rank)}`,onClick:f=>c(e,f),title:x(e),style:{animationDelay:`${u*.05}s`},children:[s.jsxs("div",{className:"achievement-header",children:[s.jsx("span",{className:"achievement-title",children:e.title}),s.jsxs("span",{className:"achievement-rank",children:["#",e.rank,e.totalRanked?`/${e.totalRanked}`:""]})]}),s.jsx("p",{className:"achievement-description",children:e.description})]},e.id))})]}),m.length>0&&s.jsxs("div",{className:"achievements-section bad-achievements",children:[s.jsx("h5",{children:"ðŸ’€ Classements (InversÃ©s)"}),s.jsx("div",{className:"achievements-grid",children:m.map(e=>s.jsxs("div",{className:`achievement-card bad rank-${e.rank}`,onClick:u=>c(e,u),title:x(e),children:[s.jsxs("div",{className:"achievement-header",children:[s.jsx("span",{className:"achievement-title",children:e.title}),s.jsxs("span",{className:"achievement-rank",children:["#",e.rank,e.totalRanked?`/${e.totalRanked}`:""]})]}),s.jsx("p",{className:"achievement-description",children:e.description})]},e.id))})]}),$.length>0&&s.jsxs("div",{className:"achievements-section comparison-achievements",children:[s.jsx("h5",{children:"ðŸ“Š Statistiques Face-Ã -Face"}),s.jsx("div",{className:"achievements-grid",children:$.map(e=>s.jsxs("div",{className:"achievement-card comparison",onClick:u=>c(e,u),title:x(e),children:[s.jsx("div",{className:"achievement-header",children:s.jsx("span",{className:"achievement-title",children:e.title})}),s.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:R(e.description)}})]},e.id))})]})]})}function O(){const{settings:o,updateSettings:h}=w(),{data:k,isLoading:v,error:P}=L(),{data:g,isLoading:F,error:C}=z(o.highlightedPlayer),[i,j]=b.useState(""),[c,y]=b.useState("all"),x=b.useMemo(()=>{if(!k||!k.GameStats)return[];const r=new Map;return k.GameStats.forEach(n=>{const m=new Date(n.StartDate);n.PlayerStats.forEach($=>{const G=E($.Username);r.has(G)||r.set(G,{games:0,wins:0,firstDate:m,lastDate:m});const e=r.get(G);e.games++,$.Victorious&&e.wins++,m<e.firstDate&&(e.firstDate=m),m>e.lastDate&&(e.lastDate=m)})}),Array.from(r.entries()).map(([n,m])=>({name:n,totalGames:m.games,totalWins:m.wins,winRate:m.games>0?m.wins/m.games*100:0,firstGameDate:m.firstDate.toLocaleDateString("fr-FR"),lastGameDate:m.lastDate.toLocaleDateString("fr-FR"),isHighlighted:n===o.highlightedPlayer}))},[k,o.highlightedPlayer]),T=b.useMemo(()=>{if(!i.trim())return x;const r=i.toLowerCase();return x.filter(n=>n.name.toLowerCase().includes(r))},[x,i]),R=b.useMemo(()=>[...T].sort((r,n)=>n.totalGames-r.totalGames),[T]),S=r=>{h({highlightedPlayer:r}),j("")};return v?s.jsxs("div",{className:"player-selection-loading",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Chargement des joueurs..."})]}):P?s.jsxs("div",{className:"player-selection-error",children:[s.jsx("h2",{children:"Erreur"}),s.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",P]})]}):!k||x.length===0?s.jsxs("div",{className:"player-selection-empty",children:[s.jsx("h2",{children:"Aucune donnÃ©e disponible"}),s.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):s.jsxs("div",{className:"player-selection-container",children:[s.jsxs("div",{className:"player-selection-header",children:[s.jsx("h2",{children:"SÃ©lection de Joueur"}),s.jsx("p",{className:"header-description",children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."}),s.jsxs("div",{className:"search-controls",children:[s.jsxs("div",{className:"search-box",children:[s.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:i,onChange:r=>j(r.target.value),className:"search-input"}),s.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),s.jsxs("div",{className:"player-count",children:[T.length," joueur",T.length!==1?"s":"",i&&` (filtrÃ©${T.length!==1?"s":""} de ${x.length})`]})]})]}),s.jsx("div",{className:"player-display",children:i?T.length>0?s.jsxs("div",{className:"search-results",children:[s.jsxs("div",{className:"search-results-header",children:[s.jsx("h3",{children:"RÃ©sultats de recherche:"}),s.jsx("button",{className:"clear-search-btn",onClick:()=>j(""),children:"Effacer la recherche"})]}),s.jsx("div",{className:"suggestion-list",children:R.map(r=>s.jsxs("button",{className:`suggestion-btn ${r.isHighlighted?"highlighted":""}`,onClick:()=>S(r.name),children:[r.name," (",r.totalGames," parties, ",r.winRate.toFixed(1),"% victoires)",r.isHighlighted&&s.jsx("span",{className:"highlight-indicator",children:" â˜…"})]},r.name))})]}):s.jsxs("div",{className:"no-results",children:[s.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',i,'"']}),s.jsx("button",{className:"clear-search-btn",onClick:()=>j(""),children:"Effacer la recherche"})]}):o.highlightedPlayer?(()=>{const r=x.find(n=>n.name===o.highlightedPlayer);return r?s.jsxs("div",{className:"single-player-card highlighted",children:[s.jsxs("div",{className:"player-card-header",children:[s.jsx("h3",{className:"player-name",children:r.name}),s.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),s.jsxs("div",{className:"player-actions",children:[s.jsxs("div",{className:"achievements-section",children:[F?s.jsxs("div",{className:"achievements-loading",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Chargement des classements..."})]}):C?s.jsx("div",{className:"achievements-error",children:s.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",C]})}):g?s.jsx(M,{achievements:c==="all"?g.allGamesAchievements:g.moddedOnlyAchievements,title:c==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:c}):s.jsx("div",{className:"achievements-empty",children:s.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),s.jsxs("div",{className:"achievements-filter",children:[s.jsx("button",{className:`filter-btn ${c==="all"?"active":""}`,onClick:n=>{n.stopPropagation(),y("all")},children:"Toutes les parties"}),s.jsx("button",{className:`filter-btn ${c==="modded"?"active":""}`,onClick:n=>{n.stopPropagation(),y("modded")},children:"Parties moddÃ©es"})]}),s.jsx("button",{className:"highlight-btn active",onClick:n=>{n.stopPropagation(),h({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),s.jsxs("div",{className:"player-period",children:[s.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),s.jsxs("span",{className:"period-range",children:[r.firstGameDate," - ",r.lastGameDate]})]})]})]}):s.jsxs("div",{className:"no-player-found",children:[s.jsxs("p",{children:['Le joueur "',o.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),s.jsx("button",{className:"clear-selection-btn",onClick:()=>h({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():s.jsx("div",{className:"player-selection-prompt",children:s.jsxs("div",{className:"selection-prompt-content",children:[s.jsx("h2",{children:"SÃ©lectionnez un joueur"}),s.jsx("p",{children:"Utilisez la recherche ci-dessus pour trouver et sÃ©lectionner un joueur Ã  mettre en Ã©vidence."}),T.length>0&&s.jsxs("div",{className:"suggested-players",children:[s.jsx("h3",{children:"Joueurs suggÃ©rÃ©s:"}),s.jsx("div",{className:"suggestion-list",children:R.slice(0,5).map(r=>s.jsxs("button",{className:"suggestion-btn",onClick:()=>S(r.name),children:[r.name," (",r.totalGames," parties)"]},r.name))})]})]})})})]})}export{O as PlayerSelectionPage};
