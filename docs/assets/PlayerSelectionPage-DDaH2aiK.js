import{a as pe,r as A,g as te,f as ze,u as ne,j as e,d as ye,e as Fe,q as $e}from"./index-Bd84vRdD.js";import{u as ue}from"./useJoueursData-CywOhdDX.js";import{u as ve}from"./baseStatsHook-BuHEpFIU.js";import{g as Le}from"./gameUtils-rkfcKAVy.js";import{a as Re,g as ce,c as ke,b as Ie}from"./datasyncExport-BirWLS1z.js";import{u as he,g as We,b as oe,l as qe,C as ie,f as je}from"./api-DUw3O2jw.js";import{f as se,d as Ee}from"./durationFormatters-C9UyWcKX.js";import{F as U,C as Y,X as J,Y as Q,a as X}from"./FullscreenChart-fUkWywhz.js";import{R as O,T as K}from"./CategoricalChart-BhzGv7Ao.js";import{L as Ge,a as Ve}from"./LineChart-XUUyvdB7.js";import{B as ee,a as Z}from"./BarChart-D7gOfzU7.js";import{P as Pe,a as Ne}from"./PieChart-NWXBpqnT.js";import{g as de}from"./deathTypes-gHH1w6_X.js";import{i as be,g as Ce,V as Be,a as Oe}from"./roleUtils-g252S1-m.js";import{S as Ke,R as ae,e as He,f as _e,h as me,a as Ue,b as Ye,d as Je}from"./deathLocationUtils-RAnW80Pk.js";import{L as Qe}from"./Legend-D4VlhhKO.js";import{a as Xe,u as Ze}from"./useClips-7l5kAAbY.js";import{C as et,f as Se,a as tt}from"./ClipViewer-jp1dNI0F.js";import"./ActivePoints-B1aWqndc.js";import"./PolarChart-yVV2mPEV.js";function rt(r){const{settings:d}=pe(),{joueursData:j}=ue(),[y,w]=A.useState(null),[a,g]=A.useState(!1),[o,s]=A.useState(null);A.useEffect(()=>{let c=!0;return(async()=>{try{g(!0),s(null);const u=d.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",i=await fetch(u);if(!i.ok)throw new Error(`Failed to load achievements: ${i.status} ${i.statusText}`);const m=await i.json();c&&w(m)}catch(u){c&&s(u instanceof Error?u.message:"Failed to load achievements")}finally{c&&g(!1)}})(),()=>{c=!1}},[d.dataSource]);const n=(()=>{if(!r||!y)return null;const l=j?.Players?.find(u=>u.Joueur===r)?.SteamID;return l&&y.achievements[l]||null})();return A.useEffect(()=>{r&&y&&j&&j.Players?.find(u=>u.Joueur===r)?.SteamID},[r,y,j,d.dataSource]),{data:n,isLoading:a,error:o,metadata:{generatedAt:y?.generatedAt||null,totalPlayers:y?.totalPlayers||0,totalGames:y?.totalGames||0,totalModdedGames:y?.totalModdedGames||0}}}function st(r,d,j){if(!r||r.trim()===""||d.length===0)return null;const y=[];let w=r;d.forEach(l=>{const u=l.PlayerStats.find(i=>te(i)===r||i.Username.toLowerCase()===r.toLowerCase());if(u){w=u.Username;const i=u.MainRoleInitial==="Louveteau"?u.MainRoleInitial:Re(u.MainRoleInitial,u.MainRoleChanges||[]),m=ce(i);if(j&&j!=="Tous les camps"&&m!==j)return;const S=Le(l),h=u.Victorious,R=ze(new Date(l.StartDate)),T=ke(l.StartDate,l.EndDate)||0;y.push({gameId:l.Id,date:R,camp:m,won:h,winnerCamp:S,playersInGame:l.PlayerStats.length,mapName:l.MapName,duration:T})}}),y.sort((l,u)=>{const i=m=>{const S=m.split("/");return S.length===3?new Date(parseInt(S[2]),parseInt(S[1])-1,parseInt(S[0])):new Date(m)};return i(u.date).getTime()-i(l.date).getTime()});const a=y.length,g=y.filter(l=>l.won).length,o=a>0?(g/a*100).toFixed(2):"0.00",s={};y.forEach(l=>{s[l.camp]||(s[l.camp]={appearances:0,wins:0,winRate:"0.00"}),s[l.camp].appearances++,l.won&&s[l.camp].wins++}),Object.keys(s).forEach(l=>{const u=s[l];u.winRate=u.appearances>0?(u.wins/u.appearances*100).toFixed(2):"0.00"});const n={};y.forEach(l=>{n[l.mapName]||(n[l.mapName]={appearances:0,wins:0,winRate:"0.00"}),n[l.mapName].appearances++,l.won&&n[l.mapName].wins++}),Object.keys(n).forEach(l=>{const u=n[l];u.winRate=u.appearances>0?(u.wins/u.appearances*100).toFixed(2):"0.00"});const c=y.reduce((l,u)=>l+u.duration,0);return{playerName:w,totalGames:a,totalWins:g,winRate:o,totalPlayTime:c,games:y,campStats:s,mapStats:n}}function ge(r,d){const{data:j,isLoading:y,error:w}=ve(a=>r?st(r,a,d):null);return{data:j,isLoading:y,error:w}}function at(r){const{settings:d}=pe(),[j,y]=A.useState(null),[w,a]=A.useState(null),[g,o]=A.useState(!0),[s,n]=A.useState(null);return A.useEffect(()=>{(async()=>{o(!0),n(null);try{const l=d.dataSource==="discord"?"/data/discord/playerTitles.json":"/data/playerTitles.json",u=await fetch(l);if(!u.ok){if(u.status===404)y(null),a(null),n("Les titres n'ont pas encore Ã©tÃ© gÃ©nÃ©rÃ©s. Ils seront disponibles aprÃ¨s la prochaine synchronisation hebdomadaire.");else throw new Error(`HTTP error! status: ${u.status}`);return}const i=await u.json();if(y(i),r&&i.players){const m=Object.entries(i.players).find(([S,h])=>h.playerName===r);a(m?m[1]:null)}else a(null)}catch(l){console.error("Error loading player titles:",l),n(l instanceof Error?l.message:"Erreur inconnue"),y(null),a(null)}finally{o(!1)}})()},[d.dataSource,r]),{data:j,playerData:w,isLoading:g,error:s}}function it({achievements:r,title:d,emptyMessage:j,achievementType:y="all"}){const{navigateToTab:w,updateNavigationState:a,clearNavigation:g}=ne(),{settings:o,updateSettings:s}=pe(),{joueursData:n}=ue(),c=he(n),l=(t,k)=>{if(k.stopPropagation(),!t.redirectTo)return;g();const $=o.highlightedPlayer;if(s(y==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:$,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:$,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const b=o.highlightedPlayer||"",x=u(t.description,b);x&&a({playerComparisonState:{selectedPlayer1:b,selectedPlayer2:x,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const b=t.description.toLowerCase().includes("loup");a({selectedPairingTab:b?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const b=t.description.match(/(Villageois|Loups|Autres)/i);b&&a({deathStatsSelectedCamp:b[1]});let x=10;const p=t.description.match(/min\.\s*(\d+)/);p&&(x=parseInt(p[1],10));let C="totalKills",f="killers";const P=t.redirectTo.chartSection;P&&(P==="killers-total"?(C="totalKills",f="killers"):P==="killers-average"?(C="averageKills",f="killers"):P==="deaths-total"?(C="totalDeaths",f="deaths"):P==="survivors-average"?(C="survivalRate",f="deaths"):(P==="hunters-good"||P==="hunters-bad")&&(f="hunter",C="averageKills")),a({deathStatisticsState:{selectedCamp:b?.[1]||"Tous les camps",minGamesForAverage:x,selectedView:f,focusChart:C}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const b=t.redirectTo.mapFilter||"all";let x=10;const p=t.description.match(/min\.\s*(\d+)/);p&&(x=parseInt(p[1])),s(y==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:b,playerFilter:{mode:"none",players:[]},highlightedPlayer:$,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:b,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:b,playerFilter:{mode:"none",players:[]},highlightedPlayer:$,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:b,playerFilter:{mode:"none",players:[]}}}),a({playersGeneralState:{minGamesForWinRate:x,winRateOrder:"best",focusChart:"winRate"}}),w("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&a({selectedPlayerName:o.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let b="wins";const x=t.title.toLowerCase(),p=t.description.toLowerCase();x.includes("dÃ©faite")||p.includes("dÃ©faite")?b="losses":x.includes("loup")||p.includes("loup")?b="loup":x.includes("villageois")||p.includes("villageois")?b="villageois":(x.includes("victoire")||p.includes("victoire"))&&(b="wins"),a({selectedSeriesType:b})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let b=10;const x=t.description.match(/min\.\s*(\d+)/);x&&(b=parseInt(x[1],10));let p="winRate",C="best";const f=t.title.toLowerCase(),P=t.description.toLowerCase();f.includes("participation")||P.includes("participation")?p="participation":(f.includes("taux de victoire")||P.includes("taux de victoire"))&&(p="winRate",(f.includes("moins bon")||f.includes("mauvais")||P.includes("moins bon")||P.includes("mauvais"))&&(C="worst")),a({playersGeneralState:{minGamesForWinRate:b,winRateOrder:C,focusChart:p}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const b=t.redirectTo.chartSection;let x="Villageois",p=1;b&&(b==="camp-loup"?x="Loup":b==="camp-villageois"?x="Villageois":b==="camp-idiot"?x="Idiot du Village":b==="camp-amoureux"?x="Amoureux":(b==="solo-roles"||b==="hall-of-fame")&&(x="Villageois"));const C=t.description.match(/min\.\s*(\d+)/);C&&(p=parseInt(C[1],10)),b==="solo-roles"?x="RÃ´les spÃ©ciaux":b==="hall-of-fame"&&(x="Tous les camps"),a({campPerformanceState:{selectedCampPerformanceCamp:x,selectedCampPerformanceMinGames:p,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const b=t.title.toLowerCase();let x="overview",p="behavior";b.includes("agressivitÃ©")?(x="overview",p="behavior"):b.includes("taux de vote")?(x="behavior",p="voteRate"):b.includes("prÃ©cision")&&(x="overview",p="accuracy"),a({votingStatsState:{selectedCategory:x,selectedView:p}})}if(t.category==="loot"&&t.redirectTo.subTab==="lootStats"){const b=t.redirectTo,x=b.minGames||5,p=b.view||"normalized";a({lootStatsState:{minGames:x,campFilter:"all",view:p}})}w(t.redirectTo.tab,t.redirectTo.subTab)},u=(t,k)=>{const $=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const b of $){const x=t.match(b);if(x&&x[1]){const p=x[1].trim();if(p!==k)return p}}return null},i=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const b=t.description.match(/min\.\s*(\d+)/),x=b?parseInt(b[1],10):10,p=t.title.toLowerCase(),C=y==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return p.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${x} parties)${C}`:p.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${C}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${C}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const b=t.redirectTo.mapFilter,x=b==="village"?"Village":b==="chateau"?"ChÃ¢teau":"map",p=y==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${x}${p}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${u(t.description,o.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const b=t.description.match(/(Villageois|Loups|Autres)/i),x=t.description.match(/min\.\s*(\d+)/),p=x?parseInt(x[1],10):10,C=b?.[1]||"Tous les camps",f=t.redirectTo.chartSection;let P="kills et morts";return f==="killers-total"?P="total des kills":f==="killers-average"?P=`moyenne des kills (min. ${p} parties)`:f==="deaths-total"?P="total des morts":f==="survivors-average"&&(P=`taux de survie (min. ${p} parties)`),`Cliquez pour voir les statistiques de ${P} ${C!=="Tous les camps"?`en ${C}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const b=t.title.toLowerCase(),x=t.description.toLowerCase();return b.includes("dÃ©faite")||x.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":b.includes("loup")||x.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":b.includes("villageois")||x.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":b.includes("victoire")||x.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const b=t.redirectTo.chartSection,x=y==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return b==="camp-loup"?`Cliquez pour voir les performances camp Loup${x}`:b==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${x}`:b==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${x}`:b==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${x}`:b==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${x}`:b==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${x}`:`Cliquez pour voir les performances par camp${x}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const b=t.description.match(/min\.\s*(\d+)/),x=b?parseInt(b[1],10):25,p=y==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",C=t.title.toLowerCase();return C.includes("agressivitÃ©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${x} meetings)${p}`:C.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${x} meetings)${p}`:C.includes("prÃ©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${p}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${p}`}break;case"loot":if(t.redirectTo.subTab==="lootStats"){const b=t.description.match(/min\.\s*(\d+)/),x=b?parseInt(b[1],10):25,p=y==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de rÃ©colte (min. ${x} parties)${p}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(y==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},m=t=>c[t]||We(t),S=t=>{const k=[/avec ([^:]+?):/,/contre ([^:]+?):/];let $=t;return k.forEach(b=>{const x=t.match(b);if(x&&x[1]){const p=x[1].trim(),f=`<span class="player-name-highlight" style="color: ${m(p)};">${p}</span>`;$=$.replace(p,f)}}),$};if(r.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:d}),e.jsx("p",{children:j||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const h=t=>t===1?"ðŸ¥‡":t===2?"ðŸ¥ˆ":t===3?"ðŸ¥‰":"",R=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",T=(t,k)=>{if(!t||t<=3||!k)return;const $=t-3,b=k-3;return b<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-($-1)/(b-1))}, 70%, 50%)`},q=(t,k)=>{if(!t||!k)return;if(k<=1)return"hsl(0, 70%, 50%)";const $=(t-1)/(k-1),b=$*15,x=50-$*15;return`hsl(${b}, 70%, ${x}%)`},M=t=>{if(!t)return;const k=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(k){const[,$,b]=k;return`hsl(${$}, ${b}%, 40%)`}return t},W=r.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,k)=>(t.rank??999)-(k.rank??999)),L=r.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,k)=>(t.rank??999)-(k.rank??999)),z=r.filter(t=>t.category==="comparison"),N=[...W,...L].sort((t,k)=>(t.rank??999)-(k.rank??999)),F=W.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:d}),F>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:W.filter(t=>t.rank&&t.rank<=3).map((t,k)=>e.jsxs("div",{className:`top3-card ${R(t.rank)} animate-slide-in`,style:{animationDelay:`${k*.15}s`},onClick:$=>l(t,$),title:i(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:h(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:t.title}),e.jsx("p",{className:"top3-achievement-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},t.id))})]}),N.length>0&&e.jsxs("div",{className:"achievements-section unified-rankings",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:N.filter(t=>t.type==="bad"?!0:!t.rank||t.rank>3).map((t,k)=>{const $=t.type==="bad",b=$?q(t.rank,t.totalRanked):T(t.rank,t.totalRanked),x=M(b),p=$?"":R(t.rank);return e.jsxs("div",{className:`achievement-card ${$?"bad":"good"} ${p}`,onClick:C=>l(t,C),title:i(t),style:{animationDelay:`${k*.05}s`,borderLeftColor:x,borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsxs("span",{className:"achievement-title",children:[$&&"ðŸ’€ ",t.title]}),e.jsxs("span",{className:"achievement-rank",style:b?{backgroundColor:b}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:t.description})]},t.id)})})]}),z.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques CoÃ©quipiers et Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:z.map(t=>e.jsxs("div",{className:"achievement-card comparison",onClick:k=>l(t,k),title:i(t),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:t.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:S(t.description)}})]},t.id))})]})]})}function nt({selectedPlayerName:r,groupingMethod:d,campFilter:j="all"}){const{navigateToGameDetails:y}=ne(),{data:w,isLoading:a,error:g}=ge(r),o=A.useMemo(()=>{switch(d){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[d]),s=A.useMemo(()=>{if(!w?.games)return new Map;const u=new Map;return w.games.forEach(i=>{if(!u.has(i.date)){const m=i.date.split("/");m.length===3?u.set(i.date,new Date(parseInt(m[2]),parseInt(m[1])-1,parseInt(m[0])).getTime()):u.set(i.date,new Date(i.date).getTime())}}),u},[w?.games]),n=A.useMemo(()=>{if(!w?.games)return[];const u={};return w.games.forEach(i=>{if(j!=="all"){if(j==="solo"){if(i.camp==="Villageois"||i.camp==="Loup")return}else if(i.camp!==j)return}let m;const S=i.date.split("/");if(d==="month")if(S.length===3)m=`${S[1].padStart(2,"0")}/${S[2]}`;else{const h=new Date(i.date);m=`${String(h.getMonth()+1).padStart(2,"0")}/${h.getFullYear()}`}else if(d==="quarter")if(S.length===3){const h=parseInt(S[1],10);m=`T${Math.floor((h-1)/3)+1}/${S[2]}`}else{const h=new Date(i.date);m=`T${Math.floor(h.getMonth()/3)+1}/${h.getFullYear()}`}else d==="year"?S.length===3?m=`${S[2]}`:m=`${new Date(i.date).getFullYear()}`:m=i.date;u[m]||(u[m]={games:[],wins:0,total:0}),u[m].games.push(i),u[m].total++,i.won&&u[m].wins++}),Object.entries(u).map(([i,m])=>({period:i,totalGames:m.total,victories:m.wins,defeats:m.total-m.wins,winRate:m.total>0?(m.wins/m.total*100).toFixed(1):"0.0",winRateNum:m.total>0?m.wins/m.total*100:0})).sort((i,m)=>{if(d==="month"){const[S,h]=i.period.split("/"),[R,T]=m.period.split("/"),q=new Date(parseInt(h),parseInt(S)-1,1),M=new Date(parseInt(T),parseInt(R)-1,1);return q.getTime()-M.getTime()}else if(d==="quarter"){const[S,h]=i.period.split("/"),[R,T]=m.period.split("/"),q=parseInt(S.replace(/\D/g,""),10)||1,M=parseInt(R.replace(/\D/g,""),10)||1,W=new Date(parseInt(h,10),(q-1)*3,1),L=new Date(parseInt(T,10),(M-1)*3,1);return W.getTime()-L.getTime()}else if(d==="year"){const S=parseInt(i.period,10),h=parseInt(m.period,10);return S-h}else{const S=s.get(i.period)||0,h=s.get(m.period)||0;return S-h}})},[w,d,s,j]),l=(u=>u<=15?{fontSize:12,angle:-45,height:80,interval:0}:u<=30?{fontSize:12,angle:-45,height:85,interval:1}:u<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(u/12)})(n.length);return a?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):g?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]}):w?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",o]}),e.jsx(U,{title:`Ã‰volution des Performances ${o}`,children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(Ge,{data:n,margin:{top:20,right:30,left:20,bottom:20},onClick:u=>{if(u&&u.activeLabel){const i=n.find(m=>m.period===u.activeLabel);i&&y({selectedPlayer:r,selectedDate:i.period,fromComponent:`Ã‰volution des Performances ${o}`})}},style:{cursor:"pointer"},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"period",angle:l.angle,textAnchor:"end",height:l.height,interval:l.interval,fontSize:l.fontSize}),e.jsx(Q,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(K,{content:({active:u,payload:i})=>{if(u&&i&&i.length>0){const m=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.period})}),e.jsxs("div",{children:["Parties: ",m.totalGames]}),e.jsxs("div",{children:["Victoires: ",m.victories]}),e.jsxs("div",{children:["Taux: ",m.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Ve,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",o]}),e.jsx(U,{title:`RÃ©partition Victoires/DÃ©faites ${o}`,children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"period",angle:l.angle,textAnchor:"end",height:l.height,interval:l.interval,fontSize:l.fontSize}),e.jsx(Q,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:u,payload:i})=>{if(u&&i&&i.length>0){const m=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.period})}),e.jsxs("div",{children:["Total: ",m.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",m.victories]}),e.jsxs("div",{children:["DÃ©faites: ",m.defeats]}),e.jsxs("div",{children:["Taux: ",m.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Z,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:n.map((u,i)=>e.jsx(X,{fill:"var(--accent-tertiary)",onClick:()=>{y({selectedPlayer:r,selectedDate:u.period,fromComponent:`Historique Joueur - Victoires ${o}`})},style:{cursor:"pointer"}},`cell-victories-${i}`))}),e.jsx(Z,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:n.map((u,i)=>e.jsx(X,{fill:"var(--chart-color-4)",onClick:()=>{y({selectedPlayer:r,selectedDate:u.period,fromComponent:`Historique Joueur - DÃ©faites ${o}`})},style:{cursor:"pointer"}},`cell-defeats-${i}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function ot({selectedPlayerName:r}){const{navigateToGameDetails:d}=ne(),{data:j,isLoading:y,error:w}=ge(r),a=oe(),g=A.useMemo(()=>j?.campStats?Object.entries(j.campStats).map(([s,n])=>({name:s,value:n.appearances,winRate:n.winRate,winRateDisplay:Math.max(parseFloat(n.winRate),1),wins:n.wins,percentage:(n.appearances/j.totalGames*100).toFixed(1)})):[],[j]),o=A.useMemo(()=>{if(!g.length)return[];const s=5;let n=0;const c=[],l=[];if(g.forEach(u=>{parseFloat(u.percentage)<s?(n+=Number(u.value),c.push(u)):l.push(u)}),n>0){const u=g.reduce((i,m)=>i+Number(m.value),0);l.push({name:"Autres",value:n,winRate:"0.0",winRateDisplay:1,wins:c.reduce((i,m)=>i+m.wins,0),percentage:(n/u*100).toFixed(1),_details:c})}return l},[g]);return y?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):w?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",w]}):j?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(Pe,{children:[e.jsx(Ne,{data:o,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:s=>{const n=s.percent!==void 0?s.percent:0;return s.name==="Autres"?`Autres : ${s.value} (${(n*100).toFixed(1)}%)`:`${s.name}: ${s.value} (${(n*100).toFixed(1)}%)`},children:o.map((s,n)=>e.jsx(X,{fill:s.name==="Autres"?qe:a[s.name]||`var(--chart-color-${n%6+1})`,onClick:()=>{if(s.name==="Autres"){const c=s._details?.map(l=>l.name)||[];d({selectedPlayer:r,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:c},fromComponent:"Distribution par Camps"})}else s.name==="TraÃ®tre"||s.name==="Louveteau"?d({selectedPlayer:r,campFilter:{selectedCamp:s.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):s.name==="Loup"?d({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):d({selectedPlayer:r,campFilter:{selectedCamp:s.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${n}`))}),e.jsx(K,{content:({active:s,payload:n})=>{if(s&&n&&n.length>0){const c=n[0].payload;if(c.name==="Autres"&&c._details){const l=[...c._details].sort((u,i)=>i.value-u.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",c.value," parties (",c.percentage,"%)"]})}),e.jsx("div",{children:l.map((u,i)=>e.jsxs("div",{children:[u.name,": ",u.value," parties (",u.percentage,"%)"]},i))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[c.name," - ",c.value," parties (",c.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(U,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:g,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Q,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(K,{content:({active:s,payload:n})=>{if(s&&n&&n.length>0){const c=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:c.name})}),e.jsxs("div",{children:["Victoires: ",c.wins," / ",c.value]}),e.jsxs("div",{children:["Taux: ",c.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Z,{dataKey:"winRateDisplay",children:g.map((s,n)=>e.jsx(X,{fill:parseFloat(s.winRate)===0?`${a[s.name]||`var(--chart-color-${n%6+1})`}50`:a[s.name]||`var(--chart-color-${n%6+1})`,onClick:()=>{s.name==="TraÃ®tre"||s.name==="Louveteau"?d({selectedPlayer:r,campFilter:{selectedCamp:s.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):s.name==="Loup"?d({selectedPlayer:r,campFilter:{selectedCamp:s.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):d({selectedPlayer:r,campFilter:{selectedCamp:s.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${n}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function lt({selectedPlayerName:r}){const{gameData:d}=ye(),{joueursData:j}=ue(),y=he(j),w=oe(),a=A.useMemo(()=>{if(!d||!r)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const o={},s={},n={},c=new Set;d.forEach(S=>{const h=S.PlayerStats.find(R=>R.Username.toLowerCase()===r.toLowerCase());if(h&&(S.PlayerStats.forEach(R=>{R.KillerName?.toLowerCase()===r.toLowerCase()&&(o[R.Username]=(o[R.Username]||0)+1)}),h.KillerName&&(s[h.KillerName]=(s[h.KillerName]||0)+1),h.DeathType)){const R=h.DeathType,T=de(R);n[T]||(n[T]={count:0,byDeathType:{}}),n[T].count+=1,n[T].byDeathType[R]=(n[T].byDeathType[R]||0)+1,c.add(R)}});const l=Object.entries(o).map(([S,h])=>({player:S,kills:h})).sort((S,h)=>h.kills-S.kills).slice(0,ie.TOP_10),u=Object.entries(s).map(([S,h])=>({player:S,kills:h})).sort((S,h)=>h.kills-S.kills).slice(0,ie.TOP_10),i=Object.entries(n).map(([S,h])=>{const R={deathType:S,count:h.count};return R[S]=h.count,R}).sort((S,h)=>h.count-S.count).slice(0,ie.TOP_10),m=Object.keys(n);return{playersKilled:l,killedBy:u,deathTypes:i,availableDeathTypes:m}},[d,r]),g=A.useMemo(()=>{const o={};a.availableDeathTypes.forEach(c=>{c==="TuÃ© par Loup"?o[c]=w.Loup:c==="Mort aux votes"?o[c]="var(--chart-color-1)":c.includes("Chasseur")?o[c]=w.Chasseur:c==="TuÃ© par Zombie"?o[c]=w.Vaudou:c==="TuÃ© par potion assassin"?o[c]=w.Alchimiste:c==="TuÃ© par Vengeur"?o[c]="var(--chart-color-2)":c==="Amoureux mort"?o[c]=w.Amoureux:c==="TuÃ© par La BÃªte"?o[c]="var(--chart-color-3)":c==="TuÃ© par ShÃ©rif"&&(o[c]="var(--chart-color-4)")});const s=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let n=0;return a.availableDeathTypes.forEach(c=>{o[c]||(o[c]=s[n%s.length],n++)}),o},[a.availableDeathTypes,w]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[a.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(U,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Q,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:o,payload:s})=>{if(o&&s&&s.length>0){const n=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.player})}),e.jsxs("div",{children:["TuÃ© ",n.kills," fois par ",r]})]})}return null}}),e.jsx(Z,{dataKey:"kills",children:a.playersKilled.map((o,s)=>e.jsx(X,{fill:y[o.player]||"var(--chart-color-3)"},`cell-killed-${s}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[r," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),a.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(U,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Q,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:o,payload:s})=>{if(o&&s&&s.length>0){const n=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.player})}),e.jsxs("div",{children:["A tuÃ© ",r," ",n.kills," fois"]})]})}return null}}),e.jsx(Z,{dataKey:"kills",children:a.killedBy.map((o,s)=>e.jsx(X,{fill:y[o.player]||"var(--chart-color-4)"},`cell-killer-${s}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[r," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),a.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(U,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(Q,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:o,payload:s})=>{if(o&&s&&s.length>0){const n=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.deathType})}),e.jsxs("div",{children:[r," est mort ",n.count," fois ainsi"]})]})}return null}}),a.availableDeathTypes.map(o=>e.jsx(Z,{dataKey:o,name:o,stackId:"deaths",fill:g[o]||"var(--chart-color-5)"},o))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",r,"."]})]})]})}function ct(r,d){if(!r||r.trim()===""||d.length===0)return null;const j=new Map,y=new Map,w=new Map;d.forEach(n=>{if(!n.Modded)return;const c=n.PlayerStats.find(l=>te(l)===r||l.Username.toLowerCase()===r.toLowerCase());if(c){if(c.MainRoleInitial==="Inconnu")return;const l=c.Victorious,i=Re(c.MainRoleInitial,c.MainRoleChanges||[])!==c.MainRoleInitial,m=ce(c.MainRoleInitial),S=m==="Loup"||m==="TraÃ®tre"||m==="Louveteau";if(m==="Villageois"&&be(c)){const h=Ce(c);if(h&&Be.includes(h)){const R=j.get(h)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};j.set(h,{appearances:R.appearances+1,wins:R.wins+(l?1:0),winsWithoutRoleChange:R.winsWithoutRoleChange+(!i&&l?1:0),gamesWithoutRoleChange:R.gamesWithoutRoleChange+(i?0:1)})}}else if(c.Power&&c.Power.trim()!==""&&c.Power!=="Inconnu"){if(m==="Villageois"){const h=j.get(c.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};j.set(c.Power,{appearances:h.appearances+1,wins:h.wins+(l?1:0),winsWithoutRoleChange:h.winsWithoutRoleChange+(!i&&l?1:0),gamesWithoutRoleChange:h.gamesWithoutRoleChange+(i?0:1)})}else if(S){const h=y.get(c.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},R=h.roleBreakdown;R.set(c.MainRoleInitial,(R.get(c.MainRoleInitial)||0)+1),y.set(c.Power,{appearances:h.appearances+1,wins:h.wins+(l?1:0),winsWithoutRoleChange:h.winsWithoutRoleChange+(!i&&l?1:0),gamesWithoutRoleChange:h.gamesWithoutRoleChange+(i?0:1),roleBreakdown:R})}}else if((m==="Villageois"||S)&&c.Power!=="Inconnu")if(m==="Villageois"){const h=j.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};j.set("Aucun pouvoir",{appearances:h.appearances+1,wins:h.wins+(l?1:0),winsWithoutRoleChange:h.winsWithoutRoleChange+(!i&&l?1:0),gamesWithoutRoleChange:h.gamesWithoutRoleChange+(i?0:1)})}else{const h=y.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},R=h.roleBreakdown;R.set(c.MainRoleInitial,(R.get(c.MainRoleInitial)||0)+1),y.set("Aucun pouvoir",{appearances:h.appearances+1,wins:h.wins+(l?1:0),winsWithoutRoleChange:h.winsWithoutRoleChange+(!i&&l?1:0),gamesWithoutRoleChange:h.gamesWithoutRoleChange+(i?0:1),roleBreakdown:R})}if(c.SecondaryRole&&c.SecondaryRole.trim()!==""&&c.SecondaryRole!=="Inconnu"){const h=w.get(c.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};w.set(c.SecondaryRole,{appearances:h.appearances+1,wins:h.wins+(l?1:0),winsWithoutRoleChange:h.winsWithoutRoleChange+(!i&&l?1:0),gamesWithoutRoleChange:h.gamesWithoutRoleChange+(i?0:1)})}}});const a=new Map;d.forEach(n=>{const c=n.PlayerStats.find(l=>te(l)===r||l.Username.toLowerCase()===r.toLowerCase());if(c&&be(c)){const l=Ce(c);l&&a.set(l,(a.get(l)||0)+1)}});const g=n=>Array.from(n.entries()).map(([c,l])=>({name:c,appearances:l.appearances,wins:l.wins,winsWithoutRoleChange:l.winsWithoutRoleChange,gamesWithoutRoleChange:l.gamesWithoutRoleChange,winRate:l.gamesWithoutRoleChange>0?(l.winsWithoutRoleChange/l.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...a.has(c)&&{totalGamesAllModes:a.get(c)}})).sort((c,l)=>l.appearances-c.appearances),o=n=>Array.from(n.entries()).map(([c,l])=>({name:c,appearances:l.appearances,wins:l.wins,winsWithoutRoleChange:l.winsWithoutRoleChange,gamesWithoutRoleChange:l.gamesWithoutRoleChange,winRate:l.gamesWithoutRoleChange>0?(l.winsWithoutRoleChange/l.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(l.roleBreakdown.entries()).map(([u,i])=>({role:u,count:i})).sort((u,i)=>i.count-u.count)})).sort((c,l)=>l.appearances-c.appearances),s=n=>Array.from(n.entries()).map(([c,l])=>({name:c,appearances:l.appearances,wins:l.wins,winsWithoutRoleChange:l.winsWithoutRoleChange,gamesWithoutRoleChange:l.gamesWithoutRoleChange,winRate:l.gamesWithoutRoleChange>0?(l.winsWithoutRoleChange/l.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((c,l)=>l.appearances-c.appearances);return{villageoisPowers:g(j),loupPowers:o(y),secondaryRoles:s(w)}}function dt({selectedPlayerName:r}){const{navigateToGameDetails:d,navigationState:j,updateNavigationState:y}=ne(),w=oe(),[a,g]=A.useState(j.playerHistoryRolesState?.chartMode||"appearances"),{data:o,isLoading:s,error:n}=ve(T=>ct(r,T));A.useEffect(()=>{(!j.playerHistoryRolesState||j.playerHistoryRolesState.chartMode!==a)&&y({playerHistoryRolesState:{chartMode:a}})},[a,j.playerHistoryRolesState,y]);const c=T=>{g(T),y({playerHistoryRolesState:{chartMode:T}})},l=A.useCallback(T=>{if(!o)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const q=1,M=1,W=a==="winRate"?(N,F)=>parseFloat(F.winRate)-parseFloat(N.winRate):(N,F)=>F.appearances-N.appearances,L=N=>({...N,winRateDisplay:Math.max(parseFloat(N.winRate),1)}),z=N=>T===null?N:N.slice(0,T);return{villageoisPowers:z(o.villageoisPowers.filter(N=>N.appearances>=q).map(L).sort(W)),loupPowers:z(o.loupPowers.filter(N=>N.appearances>=q).map(L).sort(W)),secondaryRoles:z(o.secondaryRoles.filter(N=>N.appearances>=M).map(L).sort(W))}},[o,a]),u=A.useMemo(()=>l(15),[l]);if(s)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(n)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",n]});if(!o)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const i=u.villageoisPowers.length>0,m=u.loupPowers.length>0,S=u.secondaryRoles.length>0;if(!i&&!m&&!S)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const h=({active:T,payload:q})=>{if(T&&q&&q.length>0){const M=q[0].payload,W=M.gamesWithoutRoleChange<M.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:M.name})}),e.jsxs("div",{children:["Apparitions: ",M.appearances]}),W&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",M.appearances-M.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",M.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",M.winRate,"%"]})}),M.totalGamesAllModes&&M.totalGamesAllModes!==M.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",M.totalGamesAllModes,")"]}),M.roleBreakdown&&M.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),M.roleBreakdown.map((L,z)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",L.role,": ",L.count]},z))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},R=(T,q,M,W,L)=>{const z=a==="appearances"?"appearances":"winRateDisplay",N=a==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",F=a==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:q}),e.jsx(U,{title:q,children:t=>{const $=l(t?null:15)[T];return e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:$,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Q,{label:{value:N,angle:270,position:"left",style:{textAnchor:"middle"}},domain:F}),e.jsx(K,{content:e.jsx(h,{})}),e.jsx(Z,{dataKey:z,label:a==="winRate"?b=>{const{x,y:p,width:C,payload:f}=b;if(x===void 0||p===void 0||C===void 0||!f)return null;const P=f.winRate||"0";return e.jsxs("text",{x:x+C/2,y:p-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[P,"%"]})}:void 0,children:$.map((b,x)=>e.jsx(X,{fill:L?L(b.name,x):M,onClick:()=>W(b.name),style:{cursor:"pointer"}},`cell-${x}`))})]})})})}})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:a,onChange:T=>c(T.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[i&&R("villageoisPowers","Camp Villageois","var(--chart-color-1)",T=>{d({selectedPlayer:r,campFilter:{selectedCamp:"Villageois",campFilterMode:a==="winRate"?"wins-only":"all-assignments"},selectedPower:T,fromComponent:`Historique des RÃ´les - Pouvoir: ${T}`})},T=>T==="Chasseur"&&w.Chasseur?w.Chasseur:T==="Alchimiste"&&w.Alchimiste?w.Alchimiste:T==="Protecteur"&&w.Protecteur?w.Protecteur:T==="Disciple"&&w.Disciple?w.Disciple:T==="Inquisiteur"&&w.Inquisiteur?w.Inquisiteur:"var(--chart-color-1)"),m&&R("loupPowers","Camp Loups","var(--chart-color-2)",T=>{d({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:a==="winRate"?"wins-only":"all-assignments"},selectedPower:T,fromComponent:`Historique des RÃ´les - Pouvoir: ${T}`})},()=>w.Loup||"var(--chart-color-2)"),S&&R("secondaryRoles","RÃ´les Secondaires","var(--chart-color-3)",T=>{d({selectedPlayer:r,selectedSecondaryRole:T,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${T}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}const we=["Transform","Untransform","UseGadget","HunterShoot","DrinkPotion"],ut={Transform:"Transformation (Loup)",Untransform:"DÃ©transformation",UseGadget:"Utilisation Gadget",HunterShoot:"Tir du Chasseur",DrinkPotion:"Potion bue"},mt={Transform:"var(--wolf-color, #8B0000)",Untransform:"var(--wolf-color-light, #CD5C5C)",UseGadget:"var(--chart-color-1, #8884d8)",HunterShoot:"var(--chart-color-2, #82ca9d)",DrinkPotion:"var(--chart-color-3, #ffc658)"};function pt({selectedPlayerName:r}){const{gameData:d}=ye(),{joueursData:j}=ue(),y=oe(),w=he(j),a=A.useMemo(()=>{if(!d||!r)return{actionTypeCounts:[],gadgetDetails:[],potionDetails:[],hunterTargets:[],hunterMissedShots:0,hunterTotalShots:0,transformationsPerGame:0,totalGamesWithActions:0,totalGamesPlayed:0};const o={Transform:0,Untransform:0,UseGadget:0,HunterShoot:0,DrinkPotion:0},s={},n={},c={};let l=0,u=0;d.forEach(z=>{const N=z.PlayerStats.find(k=>k.Username.toLowerCase()===r.toLowerCase());if(!N)return;u++;let F=!1;(N.Actions||[]).forEach(k=>{if(k.ActionType==="HunterShoot"){o.HunterShoot++,F=!0,k.ActionTarget&&(c[k.ActionTarget]=(c[k.ActionTarget]||0)+1);return}const $=k.ActionType;we.includes($)&&(o[$]++,F=!0,$==="UseGadget"&&k.ActionName&&k.ActionName!=="Balle"&&(s[k.ActionName]=(s[k.ActionName]||0)+1),$==="DrinkPotion"&&k.ActionName&&(n[k.ActionName]=(n[k.ActionName]||0)+1))}),F&&l++});const i=we.filter(z=>o[z]>0).map(z=>({actionType:z,label:ut[z],count:o[z],color:mt[z]})).sort((z,N)=>N.count-z.count),m=Object.entries(s).map(([z,N])=>({gadgetName:z,count:N})).sort((z,N)=>N.count-z.count).slice(0,ie.TOP_10),S=Object.entries(n).map(([z,N])=>({potionName:z,count:N})).sort((z,N)=>N.count-z.count).slice(0,ie.TOP_10),h=Object.entries(c).map(([z,N])=>({target:z,count:N})).sort((z,N)=>N.count-z.count).slice(0,ie.TOP_10),R=o.HunterShoot,T=Object.values(c).reduce((z,N)=>z+N,0),q=R-T,M=o.Transform,W=M>0?Math.max(1,d.filter(z=>{const N=z.PlayerStats.find(t=>t.Username.toLowerCase()===r.toLowerCase());return N?(N.Actions||[]).some(t=>t.ActionType==="Transform"):!1}).length):0,L=W>0?M/W:0;return{actionTypeCounts:i,gadgetDetails:m,potionDetails:S,hunterTargets:h,hunterMissedShots:q,hunterTotalShots:R,transformationsPerGame:L,totalGamesWithActions:l,totalGamesPlayed:u}},[d,r]);return a.actionTypeCounts.length>0?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ® Parties avec actions"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:a.totalGamesWithActions}),e.jsxs("p",{children:["sur ",a.totalGamesPlayed," parties analysÃ©es"]})]}),a.actionTypeCounts.find(o=>o.actionType==="Transform")&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸº Transformations / partie loup"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:y.Loup||"var(--wolf-color)"},children:a.transformationsPerGame.toFixed(1)}),e.jsx("p",{children:"en moyenne par partie loup"})]}),a.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ”§ Gadgets utilisÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:a.gadgetDetails.reduce((o,s)=>o+s.count,0)}),e.jsxs("p",{children:[a.gadgetDetails.length," types diffÃ©rents"]})]}),a.potionDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ§ª Potions bues"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:a.potionDetails.reduce((o,s)=>o+s.count,0)}),e.jsxs("p",{children:[a.potionDetails.length," types diffÃ©rents"]})]})]}),a.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Gadgets UtilisÃ©s"}),e.jsx(U,{title:"Gadgets UtilisÃ©s",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.gadgetDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"gadgetName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(Q,{label:{value:"Utilisations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:o,payload:s})=>{if(o&&s&&s.length>0){const n=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.gadgetName})}),e.jsxs("div",{children:["UtilisÃ© ",n.count," fois"]})]})}return null}}),e.jsx(Z,{dataKey:"count",fill:"var(--chart-color-1)",children:a.gadgetDetails.map((o,s)=>e.jsx(X,{fill:`hsl(${200+s*20}, 70%, 50%)`},`cell-gadget-${s}`))})]})})})})]}),a.potionDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Potions Bues"}),e.jsx(U,{title:"Potions Bues",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.potionDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"potionName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(Q,{label:{value:"Consommations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:o,payload:s})=>{if(o&&s&&s.length>0){const n=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.potionName})}),e.jsxs("div",{children:["Bue ",n.count," fois"]})]})}return null}}),e.jsx(Z,{dataKey:"count",fill:"var(--chart-color-3)",children:a.potionDetails.map((o,s)=>e.jsx(X,{fill:`hsl(${40+s*15}, 80%, 55%)`},`cell-potion-${s}`))})]})})})})]}),a.hunterTotalShots>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Statistiques du Chasseur"}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¯ Tirs totaux"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:a.hunterTotalShots}),e.jsx("p",{children:"tirs effectuÃ©s"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"âœ… Tirs rÃ©ussis"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:y.Chasseur||"var(--chart-color-2)"},children:a.hunterTotalShots-a.hunterMissedShots}),e.jsx("p",{children:"cibles touchÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"âŒ Tirs manquÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--text-secondary)"},children:a.hunterMissedShots}),e.jsx("p",{children:"tirs sans cible"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š PrÃ©cision"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:y.Chasseur||"var(--chart-color-2)"},children:[a.hunterTotalShots>0?((a.hunterTotalShots-a.hunterMissedShots)/a.hunterTotalShots*100).toFixed(1):"0","%"]}),e.jsx("p",{children:"taux de rÃ©ussite"})]})]}),a.hunterTargets.length>0&&e.jsx(U,{title:"Cibles Ã‰liminÃ©es par le Chasseur",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.hunterTargets,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"target",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(Q,{label:{value:"Nombre de tirs",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:o,payload:s})=>{if(o&&s&&s.length>0){const n=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.target})}),e.jsxs("div",{children:["TuÃ© par le chasseur ",n.count," fois"]})]})}return null}}),e.jsx(Z,{dataKey:"count",fill:y.Chasseur||"var(--chart-color-2)",children:a.hunterTargets.map((o,s)=>e.jsx(X,{fill:w[o.target]||y.Chasseur||`hsl(${120+s*15}, 60%, 45%)`},`cell-hunter-${s}`))})]})})})})]}),(a.actionTypeCounts.find(o=>o.actionType==="Transform")||a.actionTypeCounts.find(o=>o.actionType==="Untransform"))&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Habitudes de Transformation (Loup)"}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸº Transformations"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:y.Loup||"var(--wolf-color)"},children:a.actionTypeCounts.find(o=>o.actionType==="Transform")?.count||0}),e.jsx("p",{children:"transformations totales"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ‘¤ DÃ©transformations"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-secondary)"},children:a.actionTypeCounts.find(o=>o.actionType==="Untransform")?.count||0}),e.jsx("p",{children:"retours en forme humaine"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Ratio"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:(()=>{const o=a.actionTypeCounts.find(n=>n.actionType==="Transform")?.count||0,s=a.actionTypeCounts.find(n=>n.actionType==="Untransform")?.count||0;return o===0?"0%":`${(s/o*100).toFixed(0)}%`})()}),e.jsx("p",{children:"dÃ©transformations / transformations"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¯ Moyenne / partie"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:y.Loup||"var(--wolf-color)"},children:a.transformationsPerGame.toFixed(1)}),e.jsx("p",{children:"transformations par partie loup"})]})]}),e.jsx(U,{title:"Comparaison Transformations vs DÃ©transformations",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:[{name:"Transformations",count:a.actionTypeCounts.find(o=>o.actionType==="Transform")?.count||0,fill:y.Loup||"var(--wolf-color)"},{name:"DÃ©transformations",count:a.actionTypeCounts.find(o=>o.actionType==="Untransform")?.count||0,fill:"var(--accent-secondary)"}].filter(o=>o.count>0),margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"name",fontSize:14}),e.jsx(Q,{label:{value:"Nombre d'actions",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:o,payload:s})=>{if(o&&s&&s.length>0){const n=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.name})}),e.jsxs("div",{children:[n.count," fois"]})]})}return null}}),e.jsx(Z,{dataKey:"count",children:[{name:"Transformations",count:a.actionTypeCounts.find(o=>o.actionType==="Transform")?.count||0,fill:y.Loup||"var(--wolf-color)"},{name:"DÃ©transformations",count:a.actionTypeCounts.find(o=>o.actionType==="Untransform")?.count||0,fill:"var(--accent-secondary)"}].filter(o=>o.count>0).map((o,s)=>e.jsx(X,{fill:o.fill},`cell-transform-${s}`))})]})})})})]})]}):e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune donnÃ©e d'actions disponible pour ",r,"."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es d'actions ne sont disponibles que pour les parties rÃ©centes."})]})}function ht({viewMode:r,setViewMode:d,selectedMap:j,setSelectedMap:y,availableMaps:w,clusterRadius:a,setClusterRadius:g,availableDeathTypes:o,selectedDeathTypes:s,setSelectedDeathTypes:n,deathTypeColors:c,isDeathTypesExpanded:l,setIsDeathTypesExpanded:u}){return e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>d("deaths"),style:{background:r==="deaths"?"var(--accent-primary)":"transparent",color:r==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"ðŸ’€ Morts"}),e.jsx("button",{type:"button",onClick:()=>d("kills"),style:{background:r==="kills"?"var(--accent-primary)":"transparent",color:r==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="kills"?"bold":"normal",transition:"all 0.2s"},children:"âš”ï¸ Kills"}),e.jsx("button",{type:"button",onClick:()=>d("transformations"),style:{background:r==="transformations"?"var(--accent-primary)":"transparent",color:r==="transformations"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="transformations"?"bold":"normal",transition:"all 0.2s"},children:"ðŸº Transfos"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:j,onChange:i=>y(i.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:w.map(i=>e.jsx("option",{value:i,children:i},i))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:a,onChange:i=>g(parseInt(i.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:a===0?"Aucun":`${a} unitÃ©${a>1?"s":""}`})]}),r!=="transformations"&&e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>u(!l),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:l?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:l?"rotate(90deg)":"rotate(0deg)"},children:"â–¶"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[s.length," / ",o.length," sÃ©lectionnÃ©",s.length>1?"s":""]})]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),n(o)},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),n([])},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:o.map(i=>{const m=s.includes(i),S=c[i]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",background:m?"var(--bg-tertiary)":"transparent",borderRadius:"4px",border:`1px solid ${m?S:"var(--border-color)"}`,cursor:"pointer",transition:"all 0.2s",fontSize:"0.9rem"},onClick:h=>{h.stopPropagation(),n(m?R=>R.filter(T=>T!==i):R=>[...R,i])},children:[e.jsx("input",{type:"checkbox",checked:m,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:S,flexShrink:0}}),e.jsx("span",{children:de(i)})]},i)})})]})]})]})}function gt({zoneAnalysis:r,selectedMap:d,viewMode:j,selectedPlayerName:y,hoveredZone:w,setHoveredZone:a}){return!r||d!=="Village"||j!=="deaths"?null:e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"0rem",padding:"1.5rem",background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",borderRadius:"12px",border:"2px solid var(--accent-primary)",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",color:"var(--accent-primary)",fontSize:"1.3rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"ðŸ“Š Analyse par zone (Village)"}),e.jsx("p",{style:{fontSize:"0.95rem",marginBottom:"1rem",color:"var(--text-secondary)",lineHeight:"1.5"},children:"Distribution des morts (selon les types sÃ©lectionnÃ©s) comparÃ©e Ã  la moyenne de tous les joueurs:"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:r.zoneStats.map(g=>{const o=g.zone===r.dominantZone&&r.maxDeviation>10;return e.jsxs("div",{onMouseEnter:()=>a(g.zone),onMouseLeave:()=>a(null),style:{padding:"1rem",background:"var(--bg-primary)",borderRadius:"8px",border:w===g.zone?"1px solid var(--accent-primary)":"1px solid var(--border-color)",color:"var(--text-primary)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.95rem"},children:g.zone}),e.jsxs("div",{style:{fontSize:"0.85rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[y,": ",e.jsxs("strong",{children:[g.playerPercent.toFixed(1),"%"]})," (",g.playerCount,")"]}),e.jsxs("div",{style:{opacity:.85},children:["Moyenne: ",g.avgPercent.toFixed(1),"%"]}),e.jsxs("div",{style:{marginTop:"0.25rem",color:o?"var(--accent-secondary)":g.deviation>0?"var(--accent-primary)":"var(--text-secondary)",fontWeight:Math.abs(g.deviation)>5?"bold":"normal"},children:[g.deviation>0?"+":"",g.deviation.toFixed(1),"% vs moyenne"]})]})]},g.zone)})}),r.dominantZone&&r.maxDeviation>10&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",fontSize:"0.95rem",color:"var(--accent-primary)",fontWeight:"bold",background:"var(--bg-primary)",borderRadius:"8px",border:"2px solid var(--accent-primary)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"âš ï¸"}),e.jsxs("span",{children:[y," meurt significativement plus souvent en zone ",r.dominantZone,"(","+"+r.maxDeviation.toFixed(1),"% par rapport Ã  la moyenne)"]})]})]})}function xt({locationData:r,clusteredData:d,viewMode:j,selectedPlayerName:y,selectedMap:w,mapConfig:a,xDomain:g,zDomain:o,hoveredZone:s,getDeathColor:n,handleLocationClick:c}){const l=({active:u,payload:i})=>{if(!u||!i||i.length===0)return null;const m=i[0].payload,S=m.allLocations||[m],h=S.length>1,R=j==="transformations";if(h){const q=new Map,M=new Map,W=new Set,L=new Map;S.forEach(t=>{if(q.set(t.victimName,(q.get(t.victimName)||0)+1),R)L.set(t.camp,(L.get(t.camp)||0)+1);else{const k=t.deathType?de(t.deathType):"Inconnu";M.set(k,(M.get(k)||0)+1)}W.add(t.gameId)});const z=Array.from(q.entries()).sort((t,k)=>k[1]-t[1]).slice(0,3),N=Array.from(M.entries()).sort((t,k)=>k[1]-t[1]).slice(0,3),F=Array.from(L.entries()).sort((t,k)=>k[1]-t[1]);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[R?"ðŸº":j==="deaths"?"ðŸ’€":"âš”ï¸"," ",S.length," ",R?"transformations":j==="deaths"?"morts":"kills"," Ã  cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[R?e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Camps loup:"}),F.map(([t,k])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",k,"Ã—)"]},t))]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:j==="deaths"?"Victimes:":"Kills sur:"}),z.map(([t,k])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",k,"Ã—)"]},t))]}),e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Types de mort:"}),N.map(([t,k])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",k,"Ã—)"]},t))]})]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["ðŸ“ ",W.size," partie",W.size>1?"s":""," diffÃ©rente",W.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const T=S[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[R?"ðŸº":j==="deaths"?"ðŸ’€":"âš”ï¸"," ",R?"Transformation de":j==="deaths"?"Mort de":"Kill de"," ",y]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[R?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ‘¤ ",e.jsx("strong",{children:"Joueur:"})," ",T.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp loup:"})," ",T.camp]}),e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",T.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",T.gameId]})]}):j==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Victime:"})," ",T.victimName]}),e.jsxs("div",{children:["âš”ï¸ ",e.jsx("strong",{children:"Tueur:"})," ",T.killerName||"Inconnu"]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",T.deathType?de(T.deathType):"Inconnu"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Victime:"})," ",T.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp victime:"})," ",T.camp]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",T.deathType?de(T.deathType):"Inconnu"]})]}),!R&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",T.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",T.gameId]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})};return e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:r.length>0?e.jsx(U,{title:j==="deaths"?`Carte des Morts de ${y}`:`Carte des Kills de ${y}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(Ke,{margin:{top:20,right:30,left:60,bottom:20},children:[a&&e.jsx(ae,{x1:a.zMin,x2:a.zMax,y1:a.xMin,y2:a.xMax,fill:"transparent",stroke:"none",shape:u=>{const{x:i,y:m,width:S,height:h}=u;return e.jsx("image",{x:i,y:m,width:S,height:h,href:a.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),w==="Village"&&s&&e.jsxs(e.Fragment,{children:[s==="Ruines"&&e.jsx(ae,{x1:-220,x2:200,y1:100,y2:450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),s==="Village Principal"&&e.jsx(ae,{x1:-250,x2:100,y1:-120,y2:-450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),s==="Ferme"&&e.jsx(ae,{x1:-550,x2:-250,y1:150,y2:-150,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),s==="Village PÃªcheur"&&e.jsx(ae,{x1:150,x2:500,y1:80,y2:-320,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),s==="Reste de la Carte"&&e.jsx(ae,{x1:a?.zMin??-600,x2:a?.zMax??600,y1:a?.xMin??-500,y2:a?.xMax??500,fill:"var(--accent-primary)",fillOpacity:.15,stroke:"var(--accent-primary)",strokeWidth:2,strokeDasharray:"5 5"})]}),e.jsx(Y,{strokeDasharray:"3 3",stroke:a?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(J,{dataKey:"z",type:"number",name:"Position Z",domain:o,hide:!0}),e.jsx(Q,{dataKey:"x",type:"number",name:"Position X",domain:g,hide:!0}),e.jsx(K,{content:e.jsx(l,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(He,{data:d,onClick:u=>c(u),style:{cursor:"pointer"},isAnimationActive:!1,children:d.map((u,i)=>{const m=Math.min(Math.log2(u.count+1)*3+5,18),S=Math.round(m);return e.jsx(X,{fill:n(u.deathType,u.camp),stroke:u.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:u.count>1?2:1,opacity:.85,r:S},`cell-${i}`)})})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:j==="deaths"?`Aucune mort localisÃ©e pour ${y} sur cette carte.`:j==="kills"?`Aucun kill localisÃ© pour ${y} sur cette carte.`:`Aucune transformation en loup localisÃ©e pour ${y} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes."})]})})}function Te(r,d){return d>=-250&&d<=100&&r>=-450&&r<=-120?"Village Principal":d>=-550&&d<=-250&&r>=-150&&r<=150?"Ferme":d>=150&&d<=500&&r>=-320&&r<=80?"Village PÃªcheur":d>=-220&&d<=200&&r>=100&&r<=450?"Ruines":"Reste de la Carte"}function le(r){return r==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":r}function ft({selectedPlayerName:r}){const{navigateToGameDetails:d}=ne(),{gameData:j,isLoading:y,error:w}=ye(),a=oe(),[g,o]=A.useState("deaths"),[s,n]=A.useState(""),[c,l]=A.useState(0),[u,i]=A.useState(null),[m,S]=A.useState([]),[h,R]=A.useState(!1),{data:T}=ge(r,"Tous les camps"),q=A.useMemo(()=>{if(!j)return[];const C=new Set;return j.forEach(f=>{const P=f.PlayerStats.find(D=>D.Username.toLowerCase()===r.toLowerCase());P&&(P.DeathPosition!==null&&f.MapName&&C.add(f.MapName),f.PlayerStats.forEach(D=>{D.KillerName?.toLowerCase()===r.toLowerCase()&&D.DeathPosition!==null&&f.MapName&&C.add(f.MapName)}),P.Actions&&Array.isArray(P.Actions)&&P.Actions.some(D=>D.ActionType==="Transform")&&f.MapName&&C.add(f.MapName))}),Array.from(C).filter(f=>f==="Village"||f==="ChÃ¢teau").sort((f,P)=>f==="Village"?-1:P==="Village"?1:f.localeCompare(P))},[j,r]),M=q.length>0?q[0]:"";s===""&&M!==""&&n(M);const{availableDeathTypes:W,deathTypeColors:L}=A.useMemo(()=>{if(!j||!r)return{availableDeathTypes:[],deathTypeColors:{}};const C=new Set,f={};return j.forEach(P=>{const D=P.PlayerStats.find(I=>I.Username.toLowerCase()===r.toLowerCase());if(D){if(D.DeathPosition&&D.DeathType){const I=le(D.DeathType);I&&C.add(I)}P.PlayerStats.forEach(I=>{if(I.KillerName?.toLowerCase()===r.toLowerCase()&&I.DeathPosition&&I.DeathType){const B=le(I.DeathType);B&&C.add(B)}})}}),C.forEach(P=>{f[P]=_e(P,a)}),{availableDeathTypes:Array.from(C).sort(),deathTypeColors:f}},[j,r,a]),z=(C,f)=>g==="transformations"&&f?a[f]||"var(--text-secondary)":C&&L[C]||"var(--text-secondary)";A.useEffect(()=>{if(m.length===0&&W.length>0){const C=W.filter(f=>f!=="VOTED");S(C)}},[W.length]);const N=A.useMemo(()=>{if(!j||!r)return[];const C=[];return j.forEach(f=>{if(s&&f.MapName!==s)return;const P=f.PlayerStats.find(D=>D.Username.toLowerCase()===r.toLowerCase());if(P)if(g==="deaths"){if(P.DeathPosition){const D=ce(P.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),I=me(P.DeathPosition.x,P.DeathPosition.z,f.MapName);C.push({x:I.x,z:I.z,victimName:P.Username,killerName:P.KillerName||null,deathType:le(P.DeathType),mapName:f.MapName,camp:D,gameId:f.DisplayedId,displayedGameId:f.DisplayedId})}}else g==="kills"?f.PlayerStats.forEach(D=>{if(D.KillerName?.toLowerCase()===r.toLowerCase()&&D.DeathPosition){const I=ce(D.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),B=me(D.DeathPosition.x,D.DeathPosition.z,f.MapName);C.push({x:B.x,z:B.z,victimName:D.Username,killerName:r,deathType:le(D.DeathType),mapName:f.MapName,camp:I,gameId:f.DisplayedId,displayedGameId:f.DisplayedId})}}):g==="transformations"&&P.Actions&&Array.isArray(P.Actions)&&P.Actions.forEach(D=>{if(D.ActionType==="Transform"&&D.Position){const I=ce(P.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),B=me(D.Position.x,D.Position.z,f.MapName);C.push({x:B.x,z:B.z,victimName:P.Username,killerName:null,deathType:null,mapName:f.MapName,camp:I,gameId:f.DisplayedId,displayedGameId:f.DisplayedId})}})}),g!=="transformations"&&m.length>0&&m.length<W.length?C.filter(f=>f.deathType&&m.includes(f.deathType)):C},[j,r,g,s,m,W]),F=A.useMemo(()=>{if(s!=="Village"||g!=="deaths"||N.length===0)return null;const C={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};if(N.forEach(V=>{const G=Te(V.x,V.z);C[G]=(C[G]||0)+1}),!j)return null;const f={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};j.forEach(V=>{V.MapName==="Village"&&V.PlayerStats.forEach(G=>{if(!G.DeathPosition)return;const H=le(G.DeathType);if(m.length>0&&m.length<W.length&&(!H||!m.includes(H)))return;const _=me(G.DeathPosition.x,G.DeathPosition.z,"Village"),xe=Te(_.x,_.z);f[xe]=(f[xe]||0)+1})});const P=Object.values(f).reduce((V,G)=>V+G,0),D=Object.values(C).reduce((V,G)=>V+G,0);if(P===0||D===0)return null;const I=["Village Principal","Village PÃªcheur","Ferme","Ruines","Reste de la Carte"];let B=0,v=null;const E=I.map(V=>{const G=C[V]/D*100,H=f[V]/P*100,_=G-H;return _>B&&C[V]>=2&&(B=_,v=V),{zone:V,playerCount:C[V],playerPercent:G,avgPercent:H,deviation:_}});return{totalPlayerDeaths:D,totalAllDeaths:P,zoneStats:E,dominantZone:v,maxDeviation:B}},[N,s,g,j,m,W]),t=A.useMemo(()=>Ue(N,c).map((f,P)=>{const D=f.items[0],I=Ye(f.items);return{x:f.centroidX,z:f.centroidZ,count:f.items.length,allLocations:f.items,victimName:f.items.length===1?D.victimName:null,killerName:f.items.length===1?D.killerName:null,deathType:I,mapName:D.mapName,camp:D.camp,gameId:f.items.length===1?D.gameId:null,displayedGameId:f.items.length===1?D.displayedGameId:null,clusterIndex:P}}),[N,c]),k=A.useMemo(()=>Je(s),[s]),{xDomain:$,zDomain:b}=A.useMemo(()=>{if(k)return{xDomain:[k.xMin,k.xMax],zDomain:[k.zMin,k.zMax]};if(t.length===0)return{xDomain:[0,100],zDomain:[0,100]};const C=t.map(V=>V.x),f=t.map(V=>V.z),P=Math.min(...C),D=Math.max(...C),I=Math.min(...f),B=Math.max(...f),v=(D-P)*.1||10,E=(B-I)*.1||10;return{xDomain:[P-v,D+v],zDomain:[I-E,B+E]}},[t,k]),x=C=>{if(!C)return;const f=C.allLocations||[C];if(f.length===1)d({selectedGame:f[0].gameId,fromComponent:"Player Death Map"});else{const P=f.map(D=>D.gameId).filter(D=>D);d({selectedGameIds:P,fromComponent:"Player Death Map"})}},p=A.useMemo(()=>{if(!T?.mapStats||!s)return null;const C=T.mapStats[s];return C?{winRate:C.winRate,wins:C.wins,total:C.appearances}:null},[T,s]);return y?e.jsx("div",{className:"donnees-attente",children:"Chargement des donnÃ©es..."}):w?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",w]}):j?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsx(ht,{viewMode:g,setViewMode:o,selectedMap:s,setSelectedMap:n,availableMaps:q,clusterRadius:c,setClusterRadius:l,availableDeathTypes:W,selectedDeathTypes:m,setSelectedDeathTypes:S,deathTypeColors:L,isDeathTypesExpanded:h,setIsDeathTypesExpanded:R}),e.jsx(xt,{locationData:N,clusteredData:t,viewMode:g,selectedPlayerName:r,selectedMap:s,mapConfig:k,xDomain:$,zDomain:b,hoveredZone:u,getDeathColor:z,handleLocationClick:x}),e.jsx(gt,{zoneAnalysis:F,selectedMap:s,viewMode:g,selectedPlayerName:r,hoveredZone:u,setHoveredZone:i}),p&&e.jsxs("div",{style:{flex:"1 1 100%",textAlign:"center",padding:"0.75rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)",marginTop:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginRight:"1rem"},children:["Taux de victoire sur ",e.jsx("strong",{children:s})," :"]}),e.jsxs("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:parseFloat(p.winRate)>=50?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[p.winRate,"%"]}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["(",p.wins," / ",p.total," victoires)"]})]}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"Ã€ propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",g==="deaths"?`les emplacements oÃ¹ ${r} est mort`:g==="kills"?`les emplacements oÃ¹ ${r} a Ã©liminÃ© d'autres joueurs`:`les emplacements oÃ¹ ${r} s'est transformÃ© en loup`," au cours des parties.",g!=="transformations"&&"Les couleurs indiquent le type de mort."," Cliquez sur un point pour voir les dÃ©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroupÃ©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’€ Morts:"})," OÃ¹ le joueur a Ã©tÃ© Ã©liminÃ©",e.jsx("br",{}),e.jsx("strong",{children:"âš”ï¸ Kills:"})," OÃ¹ le joueur a Ã©liminÃ© d'autres joueurs",e.jsx("br",{}),e.jsx("strong",{children:"ðŸº Transformations:"})," OÃ¹ le joueur s'est transformÃ© en loup"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function De(r){return r.PlayerStats.some(d=>d.SecondsTalkedOutsideMeeting>0||d.SecondsTalkedDuringMeeting>0)}function fe(r,d){const j=d.DeathDateIrl||r.EndDate,y=ke(r.StartDate,j);return y&&y>0?y:0}function yt(r){const d=r.filter(De),j=new Map;return d.forEach(y=>{y.PlayerStats.forEach(w=>{const a=te(w),g=Fe(w),o=fe(y,w);if(o<=0)return;j.has(a)||j.set(a,{displayName:g,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const s=j.get(a);s.gamesPlayed++,s.totalSecondsAll+=(w.SecondsTalkedOutsideMeeting||0)+(w.SecondsTalkedDuringMeeting||0),s.totalGameDuration+=o})}),{playerStats:j,gamesWithTalkingData:d.length}}function vt(r,d){if(!d||d.length===0||!r)return null;const j=yt(d),y=d.filter(De);if(y.length===0||j.playerStats.size===0)return null;let w=null;for(const[x,p]of j.playerStats)if(p.displayName===r){w=x;break}if(!w)return null;let a=0,g=0,o=0,s=0;const n={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},c=new Map;let l=0,u=0,i=0,m=0;if(y.forEach(x=>{const p=x.PlayerStats.find(E=>te(E)===w);if(!p)return;const C=fe(x,p);if(C<=0)return;a++;const f=p.SecondsTalkedOutsideMeeting||0,P=p.SecondsTalkedDuringMeeting||0,D=f+P;g+=f,o+=P,s+=C;const I=Ie(p.MainRoleInitial,p.Power);n[I].gamesPlayed++,n[I].secondsOutside+=f,n[I].secondsDuring+=P,n[I].gameDuration+=C;const B=Oe(p);c.has(B)||c.set(B,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const v=c.get(B);v.gamesPlayed++,v.totalSecondsAll+=D,v.totalGameDuration+=C}),a===0||s<=0)return null;const S=3600/s,h=g*S,R=o*S,T=(g+o)*S,q=g+o>0?o/(g+o)*100:0,M=[];for(const[x,p]of Object.entries(n)){if(p.gamesPlayed===0)continue;const C=p.gameDuration>0?3600/p.gameDuration:0,f=p.secondsOutside+p.secondsDuring;M.push({camp:x,gamesPlayed:p.gamesPlayed,totalSecondsOutside:p.secondsOutside,totalSecondsDuring:p.secondsDuring,totalSecondsAll:f,totalGameDurationSeconds:p.gameDuration,secondsOutsidePer60Min:p.secondsOutside*C,secondsDuringPer60Min:p.secondsDuring*C,secondsAllPer60Min:f*C,meetingRatio:f>0?p.secondsDuring/f*100:0})}M.sort((x,p)=>p.gamesPlayed-x.gamesPlayed);const W=Array.from(c.entries()).filter(([x,p])=>p.gamesPlayed>=1).map(([x,p])=>({role:x,gamesPlayed:p.gamesPlayed,secondsAllPer60Min:p.totalGameDuration>0?p.totalSecondsAll/p.totalGameDuration*3600:0,totalSecondsAll:p.totalSecondsAll})).sort((x,p)=>p.secondsAllPer60Min-x.secondsAllPer60Min),L=[];for(const[x,p]of j.playerStats)p.totalGameDuration>0&&L.push({id:x,name:p.displayName,per60:p.totalSecondsAll/p.totalGameDuration*3600});L.sort((x,p)=>p.per60-x.per60);const z=L.reduce((x,p)=>x+p.per60,0),N=L.length>0?z/L.length:0,F=L.findIndex(x=>x.id===w)+1,t=L.length,k=t>0?Math.round((1-(F-1)/t)*100):0,$=T;y.forEach(x=>{const p=x.PlayerStats.find(D=>te(D)===w);if(!p)return;const C=fe(x,p);if(C<=0)return;((p.SecondsTalkedOutsideMeeting||0)+(p.SecondsTalkedDuringMeeting||0))/C*3600>=$?(l++,p.Victorious&&u++):(i++,p.Victorious&&m++)});const b={gamesAboveAverage:l,winsAboveAverage:u,winRateAboveAverage:l>0?u/l*100:0,gamesBelowAverage:i,winsBelowAverage:m,winRateBelowAverage:i>0?m/i*100:0};return{playerName:r,gamesPlayed:a,gamesWithTalkingData:j.gamesWithTalkingData,totalSecondsOutside:g,totalSecondsDuring:o,totalSecondsAll:g+o,totalGameDurationSeconds:s,secondsOutsidePer60Min:h,secondsDuringPer60Min:R,secondsAllPer60Min:T,meetingRatio:q,campBreakdown:M,globalAverageSecondsAllPer60Min:N,playerRank:F,totalPlayersWithData:t,percentile:k,roleBreakdown:W,winCorrelation:b}}function jt(r,d){return r?r.roleBreakdown.slice(0,d):[]}function bt(r){const{data:d,isLoading:j,error:y}=ve(w=>r?vt(r,w):null);return{data:d,isLoading:j,error:y}}function Ct({selectedPlayerName:r}){const{data:d,isLoading:j,error:y}=bt(r),w=oe(),[a,g]=A.useState("both"),o=A.useMemo(()=>d?.campBreakdown?d.campBreakdown.map(i=>({camp:i.camp,"Hors rÃ©union":Math.round(i.secondsOutsidePer60Min),"En rÃ©union":Math.round(i.secondsDuringPer60Min),total:Math.round(i.secondsAllPer60Min),gamesPlayed:i.gamesPlayed,meetingRatio:i.meetingRatio.toFixed(1)})):[],[d]),s=A.useMemo(()=>d?[{name:"En rÃ©union",value:d.totalSecondsDuring,color:"#2196F3"},{name:"Hors rÃ©union",value:d.totalSecondsOutside,color:"#FF9800"}]:[],[d]);if(j)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(y)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",y]});if(!d)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de temps de parole ne sont disponibles que pour les parties rÃ©centes."})]});const n=d.secondsAllPer60Min-d.globalAverageSecondsAllPer60Min,c=d.globalAverageSecondsAllPer60Min>0?(n/d.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",l=n>0,u=d.winCorrelation.winRateAboveAverage-d.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¤ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:se(d.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:l?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[l?"+":"",c,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",d.playerRank," / ",d.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-d.percentile+1,"% ",d.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“ˆ Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:d.gamesPlayed}),e.jsxs("p",{children:["sur ",d.gamesWithTalkingData," avec donnÃ©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ—£ï¸ Ratio en rÃ©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[d.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),o.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(U,{title:"Temps de parole par camp (par 60min de jeu)",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>g("meeting"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="meeting"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="meeting"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="meeting"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="meeting"?"bold":"normal"},children:"En rÃ©union"}),e.jsx("button",{onClick:()=>g("outside"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="outside"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="outside"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="outside"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="outside"?"bold":"normal"},children:"Hors rÃ©union"}),e.jsx("button",{onClick:()=>g("both"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="both"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="both"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="both"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="both"?"bold":"normal"},children:"Les deux"})]}),e.jsx("div",{style:{height:350},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:o,layout:"vertical",children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(J,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:i=>`${Math.floor(i/60)}m`}),e.jsx(Q,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(K,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(i,m)=>[se(i),m],labelFormatter:i=>{const m=o.find(S=>S.camp===i);return`${i} (${m?.gamesPlayed||0} parties)`}}),e.jsx(Qe,{}),(a==="both"||a==="outside")&&e.jsx(Z,{dataKey:"Hors rÃ©union",stackId:"talk",fill:"#FF9800"}),(a==="both"||a==="meeting")&&e.jsx(Z,{dataKey:"En rÃ©union",stackId:"talk",fill:"#2196F3"})]})})})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:(()=>{const i=o.find(R=>R.camp==="Villageois"),m=o.find(R=>R.camp==="Loup");if(!i||!m)return e.jsx("p",{children:"ðŸ’¡ Pas assez de donnÃ©es pour comparer les camps Villageois et Loups."});const S=i.total-m.total,h=m.total>0?(Math.abs(S)/m.total*100).toFixed(0):"0";return S>0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:je("Villageois")},children:[se(S)," de plus (+",h,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Villageois"})," qu'en tant que"," ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]}):S<0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:je("Loup")},children:[se(Math.abs(S))," de plus (+",h,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Loup"})," qu'en tant que"," ",e.jsx("strong",{children:"Villageois"})," (par heure de jeu)."]}):e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle exactement autant en tant que"," ",e.jsx("strong",{children:"Villageois"})," qu'en tant que ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(U,{title:"RÃ©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(Pe,{children:[e.jsx(Ne,{data:s,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:i=>`${i.name}: ${((i.percent||0)*100).toFixed(1)}%`,children:s.map((i,m)=>e.jsx(X,{fill:i.color},`cell-${m}`))}),e.jsx(K,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:i=>se(i)})]})})})})}),d&&d.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(U,{title:i=>i?"Top 15 rÃ´les les plus bavards (par 60min)":"Top 5 rÃ´les les plus bavards (par 60min)",children:i=>{const S=jt(d,i?15:5).map(h=>({role:h.role,secondsPer60Min:Math.round(h.secondsAllPer60Min),gamesPlayed:h.gamesPlayed}));return e.jsx("div",{style:{height:i?400:300},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:S,children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(J,{dataKey:"role",tick:{fill:"var(--text-primary)",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(Q,{tick:{fill:"var(--text-secondary)"},tickFormatter:h=>`${Math.floor(h/60)}m`}),e.jsx(K,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:h=>[se(h),"Temps de parole"],labelFormatter:h=>{const R=S.find(T=>T.role===h);return`${h} (${R?.gamesPlayed||0} parties)`}}),e.jsx(Z,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",children:S.map((h,R)=>e.jsx(X,{fill:w[h.role]||w.Villageois},`cell-${R}`))})]})})})}})}),(d.winCorrelation.gamesAboveAverage>0||d.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"ðŸŽ¯ CorrÃ©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[d.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",d.winCorrelation.winsAboveAverage,"/",d.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[d.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",d.winCorrelation.winsBelowAverage,"/",d.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(u)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:u>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[u>0?"supÃ©rieur":"infÃ©rieur"," de ",Math.abs(u).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function St({playerTitles:r,titlesLoading:d}){if(d)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des titres..."})]})});if(!r||r.titles.length===0)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-empty",children:[e.jsx("p",{children:"ðŸ“œ Aucun titre disponible"}),e.jsx("p",{className:"empty-subtitle",children:r?.gamesPlayed?`${r.gamesPlayed} parties jouÃ©es - minimum 25 parties requises pour obtenir des titres`:"Les titres sont gÃ©nÃ©rÃ©s chaque dimanche pour les joueurs avec 25+ parties en mode moddÃ©"})]})});const j=[...r.titles].sort((g,o)=>{const s=r.titles.indexOf(g),c=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(g.category||"")?100-(g.percentile||50):g.percentile||50,l=(g.priority||0)*1e3+c*10-s,u=r.titles.indexOf(o),m=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(o.category||"")?100-(o.percentile||50):o.percentile||50;return(o.priority||0)*1e3+m*10-u-l}),y=j.filter(g=>!g.primaryOwner),w=j.filter(g=>g.primaryOwner),a=(g,o)=>{const s=r.primaryTitle?.id===g.id;return e.jsxs("div",{className:`title-card ${g.type} ${s?"primary":""} ${g.primaryOwner?"awarded-elsewhere":""}`,title:`${g.description}${g.percentile!==void 0?`
MeilleurÂ·e que ${g.percentile.toFixed(1)}% des joueurs`:""}`,children:[e.jsx("div",{className:"title-rank",children:o+1}),s&&e.jsx("div",{className:"title-crown",children:"ðŸ‘‘"}),e.jsx("div",{className:"title-emoji",children:g.emoji}),e.jsxs("div",{className:"title-info",children:[e.jsx("div",{className:"title-name",children:g.title}),e.jsx("div",{className:"title-description",children:g.description}),g.percentile!==void 0&&g.type!=="combination"&&e.jsxs("div",{className:"title-percentile",children:["Top ",(100-g.percentile).toFixed(0),"%"]}),e.jsx("div",{className:"title-type-badge",children:g.type==="combination"?"Combo":g.type==="role"?"RÃ´le":"Stat"}),!s&&g.primaryOwner&&e.jsxs("div",{className:"title-primary-owner",children:["ðŸ‘¤ Titre principal de: ",e.jsx("strong",{children:g.primaryOwner})]}),g.type==="combination"&&g.conditions&&g.conditions.length>0&&e.jsxs("div",{className:"title-conditions-breakdown",children:[e.jsx("div",{className:"breakdown-header",children:"Conditions:"}),g.conditions.map((n,c)=>e.jsxs("div",{className:"condition-item",children:[e.jsxs("span",{className:"condition-stat",children:[n.stat==="winRate"?"Victoires":n.stat==="loot"?"RÃ©colte":n.stat==="lootVillageois"?"RÃ©colte (Villageois)":n.stat==="lootLoup"?"RÃ©colte (Loup)":n.stat==="survival"?"Survie":n.stat==="killRate"?"Kills":n.stat==="talking"?"Parole":n.stat==="talkingOutsideMeeting"?"Parole (hors dÃ©bats)":n.stat==="talkingDuringMeeting"?"Parole (meeting)":n.stat==="votingAggressive"?"Vote agressif":n.stat==="votingAccuracy"?"PrÃ©cision vote":n.stat==="votingFirst"?"Vote rapide":n.stat==="survivalDay1"?"Survie J1":n.stat==="winRateVillageois"?"Victoires Villageois":n.stat==="winRateLoup"?"Victoires Loup":n.stat==="winRateSolo"?"Victoires Solo":n.stat==="hunterAccuracy"?"PrÃ©cision cible chasseur":n.stat==="hunterShotAccuracy"?"PrÃ©cision tir chasseur":n.stat==="zoneVillagePrincipal"?"Village Principal":n.stat==="zoneFerme"?"Ferme":n.stat==="zoneVillagePecheur"?"Village PÃªcheur":n.stat==="zoneRuines"?"Ruines":n.stat==="zoneResteCarte"?"Reste de la carte":n.stat==="zoneDominantPercentage"?"Dominance zone":n.stat,":"]}),e.jsx("span",{className:`condition-category ${n.category?.toLowerCase()}`,children:n.category}),n.actualPercentile!==void 0&&e.jsxs("span",{className:"condition-percentile",children:["(Top ",(100-n.actualPercentile).toFixed(0),"%)"]})]},c))]})]})]},g.id)};return e.jsxs("div",{className:"titles-section",children:[e.jsxs("div",{className:"titles-header",children:[e.jsx("h3",{children:"ðŸ·ï¸ Titres actuels"}),e.jsxs("p",{className:"titles-info",children:[r.titles.length," titre",r.titles.length>1?"s":""," â€¢ ",r.gamesPlayed," parties jouÃ©es"]})]}),y.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"titles-subsection-header",children:[e.jsxs("h4",{children:["âœ¨ Vos Titres (",y.length,")"]}),e.jsx("p",{children:"Titres que vous possÃ©dez ou partagez"})]}),e.jsx("div",{className:"titles-grid",children:y.map((g,o)=>a(g,o))})]}),w.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"titles-subsection-header secondary",children:[e.jsxs("h4",{children:["ðŸ–ï¸ Titres QualifiÃ©s (",w.length,")"]}),e.jsx("p",{children:"Vous remplissez les conditions, mais un autre joueur a une meilleure revendication"})]}),e.jsx("div",{className:"titles-grid awarded-elsewhere-grid",children:w.map((g,o)=>a(g,y.length+o))})]})]})}function Ot(){const{settings:r,updateSettings:d}=pe(),{navigateToGameDetails:j,navigationState:y,updateNavigationState:w}=ne(),{data:a,isLoading:g,error:o}=$e(),{joueursData:s,isLoading:n}=ue(),{data:c,isLoading:l,error:u}=rt(r.highlightedPlayer),{playerData:i,isLoading:m}=at(r.highlightedPlayer),S=he(s),[h,R]=A.useState(""),[T,q]=A.useState(null),{clips:M}=Xe(r.highlightedPlayer),{clips:W}=Ze(),[L,z]=A.useState(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded"?"modded":"all":r.gameFilter==="modded"?"modded":"all"),N=A.useMemo(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded":r.gameFilter==="modded",[r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter,r.gameFilter]),[F,t]=A.useState(r.selectedPlayerSelectionView||y.selectedPlayerSelectionView||"achievements"),[k,$]=A.useState("session"),[b,x]=A.useState("all");A.useEffect(()=>{if(r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled){const v=r.independentFilters.gameFilter==="modded"?"modded":"all";z(v)}else if(!r.useIndependentFilters){const v=r.gameFilter==="modded"?"modded":"all";z(v)}},[r.gameFilter,r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter]),A.useEffect(()=>{N&&L!=="modded"&&z("modded")},[N,L]),A.useEffect(()=>{const v=r.selectedPlayerSelectionView||y.selectedPlayerSelectionView;v&&v!==F&&t(v)},[r.selectedPlayerSelectionView,y.selectedPlayerSelectionView]);const{data:p}=ge(r.highlightedPlayer||""),C=A.useMemo(()=>{if(!a||!a.GameStats)return[];const v=N?a.GameStats.filter(V=>V.Modded===!0):a.GameStats,E=new Map;return v.forEach(V=>{const G=new Date(V.StartDate);V.PlayerStats.forEach(H=>{const _=te(H),Ae=s?.Players?.find(Me=>Me.SteamID===_)?.Joueur||H.Username;E.has(_)||E.set(_,{games:0,wins:0,firstDate:G,lastDate:G,displayName:Ae});const re=E.get(_);re.games++,H.Victorious&&re.wins++,G<re.firstDate&&(re.firstDate=G),G>re.lastDate&&(re.lastDate=G)})}),Array.from(E.entries()).map(([V,G])=>{let H=s?.Players?.find(_=>_.SteamID===V);return H||(H=s?.Players?.find(_=>_.Joueur===G.displayName)),{id:V,name:G.displayName,totalGames:G.games,totalWins:G.wins,winRate:G.games>0?G.wins/G.games*100:0,firstGameDate:G.firstDate.toLocaleDateString("fr-FR"),lastGameDate:G.lastDate.toLocaleDateString("fr-FR"),isHighlighted:G.displayName===r.highlightedPlayer,image:H?.Image||null,twitch:H?.Twitch||null,youtube:H?.Youtube||null}})},[a,r.highlightedPlayer,s,N]),f=A.useMemo(()=>{if(!h.trim())return C;const v=h.toLowerCase();return C.filter(E=>E.name.toLowerCase().includes(v))},[C,h]),P=A.useMemo(()=>[...f].sort((v,E)=>E.totalGames-v.totalGames),[f]),D=v=>{d({highlightedPlayer:v}),R("")},I=v=>{t(v),w({selectedPlayerSelectionView:v}),d({selectedPlayerSelectionView:v,tab:"playerSelection"})},B=()=>{if(M.length===0)return;const v=Math.floor(Math.random()*M.length);q(M[v])};return g||n?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):o?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",o]})]}):!a||C.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!r.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:h,onChange:v=>R(v.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[f.length," joueur",f.length!==1?"s":"",h&&` (filtrÃ©${f.length!==1?"s":""} de ${C.length})`]})]})]}),e.jsx("div",{className:"player-display",children:h?f.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>R(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:P.map(v=>e.jsxs("button",{type:"button",className:`suggestion-btn ${v.isHighlighted?"highlighted":""}`,onClick:()=>D(v.name),children:[v.image?e.jsx("img",{src:v.image,alt:`Photo de profil de ${v.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":S[v.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[v.name,v.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[v.totalGames," parties â€¢ ",v.winRate.toFixed(1),"% victoires"]})]})]},v.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',h,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>R(""),children:"Effacer la recherche"})]}):r.highlightedPlayer?(()=>{const v=C.find(E=>E.name===r.highlightedPlayer);return v?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:v.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[v.image?e.jsx("img",{src:v.image,alt:`Photo de profil de ${v.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":S[v.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[v.totalGames," parties â€¢ ",v.totalWins," victoires â€¢ ",v.winRate.toFixed(1),"% taux de victoire"]}),i?.primaryTitle?e.jsxs("div",{className:"player-primary-title",title:i.primaryTitle.description,style:{marginTop:"0.5rem",display:"inline-flex",alignItems:"center",gap:"0.3rem",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("span",{className:"title-emoji",children:i.primaryTitle.emoji}),e.jsx("span",{className:"title-text",children:i.primaryTitle.title})]}):e.jsx("div",{className:"player-no-title",style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic"},children:"ðŸ“œ 25 parties moddÃ©es minimum pour obtenir un titre"}),(v.twitch||v.youtube||M.length>0)&&e.jsxs("div",{className:"social-links",children:[v.twitch&&e.jsx("a",{href:v.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),v.youtube&&e.jsx("a",{href:v.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"}),M.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:E=>{E.stopPropagation(),B()},title:`${M.length} clip${M.length>1?"s":""} disponible${M.length>1?"s":""}`,children:["ðŸŽ¬ Clip alÃ©atoire (",M.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="achievements"?"active":""}`,onClick:()=>I("achievements"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="titles"?"active":""}`,onClick:()=>I("titles"),children:"Titres"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="evolution"?"active":""}`,onClick:()=>I("evolution"),children:"Ã‰volution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="camps"?"active":""}`,onClick:()=>I("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="roles"?"active":""}`,onClick:()=>I("roles"),children:"RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="actions"?"active":""}`,onClick:()=>I("actions"),children:"Actions"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="kills"?"active":""}`,onClick:()=>I("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="deathmap"?"active":""}`,onClick:()=>I("deathmap"),children:"Cartes"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="talkingtime"?"active":""}`,onClick:()=>I("talkingtime"),children:"Parole"})]}),F==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[l?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):u?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",u]})}):c?e.jsx(it,{achievements:L==="all"?c.allGamesAchievements:c.moddedOnlyAchievements,title:L==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:L}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[!N&&e.jsx("button",{type:"button",className:`filter-btn ${L==="all"?"active":""}`,onClick:E=>{E.stopPropagation(),z("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${L==="modded"?"active":""}`,onClick:E=>{E.stopPropagation(),z("modded")},disabled:N,children:"Parties moddÃ©es"})]})]}),F==="titles"&&e.jsx(St,{playerTitles:i,titlesLoading:m}),F==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[p&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{j({selectedPlayer:v.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${v.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:p.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:Ee(p.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{j({selectedPlayer:v.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${v.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:p.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[p.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:k,onChange:E=>$(E.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:b,onChange:E=>x(E.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(nt,{selectedPlayerName:v.name,groupingMethod:k,campFilter:b})]}),F==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ot,{selectedPlayerName:v.name})}),F==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(dt,{selectedPlayerName:v.name})}),F==="actions"&&e.jsx("div",{className:"player-history-section",children:e.jsx(pt,{selectedPlayerName:v.name})}),F==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(lt,{selectedPlayerName:v.name})}),F==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ft,{selectedPlayerName:v.name})}),F==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Ct,{selectedPlayerName:v.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:E=>{E.stopPropagation(),d({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[v.firstGameDate," - ",v.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',r.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>d({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:P.map(v=>e.jsxs("div",{className:`character-card ${v.isHighlighted?"highlighted":""}`,onClick:()=>D(v.name),title:`${v.name} - ${v.totalGames} parties, ${v.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:v.image?e.jsx("img",{src:v.image,alt:`Photo de profil de ${v.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":S[v.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:v.name}),(v.twitch||v.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[v.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),v.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},v.id))})})}),T&&e.jsx(et,{clip:T,onClose:()=>q(null),relatedClips:tt(T,W),nextClip:Se(T,W),onNextClip:()=>{const v=Se(T,W);v&&q(v)},onRelatedClip:v=>{const E=W.find(V=>V.ClipId===v);E&&q(E)}})]})}export{Ot as PlayerSelectionPage};
