import{u as F,r as g,j as e}from"./index-BnMfkUOW.js";import{h as G}from"./baseStatsHook-B7Qeo-jQ.js";import{a as f}from"./api-beq3FXpM.js";import{F as j,B as T,C as b,X as C,Y as V,a as N}from"./FullscreenChart-CzTQQWrz.js";import{R as k,T as S}from"./CategoricalChart-DbTomGcB.js";import{L as A}from"./Legend-qQiSHqQT.js";function w(r,n,a){const i=r["Type de victoire"],o=r["Camp victorieux"];return i&&i.trim()!==""&&o&&o.trim()!==""?(n[i]||(n[i]=0),n[i]++,a[i]||(a[i]={}),a[i][o]||(a[i][o]=0),a[i][o]++,!0):!1}function R(r){const n=new Set;return Object.values(r).forEach(a=>{Object.keys(a).forEach(i=>n.add(i))}),Array.from(n).sort()}function q(r,n,a,i,o){const l={type:r,count:n,percentage:(n/a*100).toFixed(1)},h=i[r]||{};return o.forEach(y=>{const x=h[y]||0,t=n>0?(x/n*100).toFixed(1):"0.0";l[y]=x,l[`${y}_percentage`]=t}),l}function L(r,n,a,i){const o=Object.keys(r).map(l=>q(l,r[l],n,a,i));return o.sort((l,h)=>h.count-l.count),o}function W(r){if(r.length===0)return null;const n={},a={};let i=0;r.forEach(h=>{w(h,n,a)&&i++});const o=R(a),l=L(n,i,a,o);return{totalGames:i,victoryTypes:l,winningCamps:o}}function B(){const{data:r,isLoading:n,error:a}=G(W);return{victoryTypesStats:r,isLoading:n,errorInfo:a}}function O(){const{victoryTypesStats:r,isLoading:n,errorInfo:a}=B(),{navigateToGameDetails:i}=F(),o=g.useMemo(()=>r?.victoryTypes?r.victoryTypes.map(t=>({...t,percentageNum:parseFloat(t.percentage)})):[],[r?.victoryTypes]),{mainVictoryTypes:l,rareVictoryTypes:h}=g.useMemo(()=>{if(!o.length)return{mainVictoryTypes:[],rareVictoryTypes:[]};const t=Math.max(5,Math.ceil(o[0].count*.1)),c=o.filter(d=>d.count>=t),p=o.filter(d=>d.count<t);return{mainVictoryTypes:c,rareVictoryTypes:p}},[o]),y=n,x=a;return y?e.jsx("div",{className:"donnees-attente",children:"Chargement des types de victoire..."}):x?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",x]}):r?e.jsxs("div",{className:"lycans-victory-types-container",children:[e.jsx("h2",{children:"Types de Victoire"}),r&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Types Principaux"}),e.jsx("div",{className:"lycans-valeur-principale",children:l.length}),e.jsx("p",{children:"types fr√©quents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Types Sp√©ciaux"}),e.jsx("div",{className:"lycans-valeur-principale",children:h.length}),e.jsx("p",{children:"types rares"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:r?.totalGames||0}),e.jsx("p",{children:"parties analys√©es"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[l.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Victoire Principaux par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Types de victoire les plus fr√©quents (",l.reduce((t,c)=>t+c.count,0)," parties sur ",r?.totalGames,")"]}),e.jsx(j,{title:"Types de Victoire Principaux par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(T,{data:l,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"type",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:11}),e.jsx(V,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(S,{content:({active:t,payload:c,label:p})=>{if(t&&c&&c.length>0){const d=c.reduce((s,u)=>s+(u.value||0),0);let m="";return r?.totalGames&&d>0&&(m=(d/r.totalGames*100).toFixed(1)),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:300},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8},children:p}),e.jsxs("div",{style:{marginBottom:4},children:["Total: ",d," parties",m&&` (${m}%)`]}),c.filter(s=>s.value&&s.value>0).sort((s,u)=>(u.value||0)-(s.value||0)).map((s,u)=>{const v=d>0?((s.value||0)/d*100).toFixed(1):"0.0";return e.jsxs("div",{style:{marginBottom:2},children:[e.jsx("span",{style:{display:"inline-block",width:12,height:12,backgroundColor:s.color,marginRight:8,borderRadius:2}}),s.dataKey,": ",s.value," (",v,"%)"]},u)}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(A,{}),r?.winningCamps?.map((t,c)=>e.jsx(N,{dataKey:t,stackId:"victory",fill:f[t]||`var(--chart-color-${c%6+1})`,name:t,onClick:p=>{p&&p.type&&i({selectedVictoryType:p.type,fromComponent:"Types de Victoire Principaux"})},style:{cursor:"pointer"}},t))]})})})})]}),h.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Victoire Sp√©ciaux par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Types de victoire moins fr√©quents (",h.reduce((t,c)=>t+c.count,0)," parties sur ",r?.totalGames,")"]}),e.jsx(j,{title:"Types de Victoire Sp√©ciaux par Camp",children:e.jsx("div",{style:{height:500},children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(T,{data:h,margin:{top:20,right:30,left:20,bottom:120},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"type",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:10}),e.jsx(V,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"},domain:[0,"dataMax"]}),e.jsx(S,{content:({active:t,payload:c,label:p})=>{if(t&&c&&c.length>0){const d=c.reduce((s,u)=>s+(u.value||0),0);let m="";return r?.totalGames&&d>0&&(m=(d/r.totalGames*100).toFixed(1)),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:300},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8},children:p}),e.jsxs("div",{style:{marginBottom:4},children:["Total: ",d," parties",m&&` (${m}%)`]}),c.filter(s=>s.value&&s.value>0).sort((s,u)=>(u.value||0)-(s.value||0)).map((s,u)=>{const v=d>0?((s.value||0)/d*100).toFixed(1):"0.0";return e.jsxs("div",{style:{marginBottom:2},children:[e.jsx("span",{style:{display:"inline-block",width:12,height:12,backgroundColor:s.color,marginRight:8,borderRadius:2}}),s.dataKey,": ",s.value," (",v,"%)"]},u)}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(A,{}),r?.winningCamps?.map((t,c)=>e.jsx(N,{dataKey:t,stackId:"victory",fill:f[t]||`var(--chart-color-${c%6+1})`,name:t,onClick:p=>{p&&p.type&&i({selectedVictoryType:p.type,fromComponent:"Types de Victoire Sp√©ciaux"})},style:{cursor:"pointer"}},t))]})})})})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de victoire disponible"})}export{O as VictoryTypesChart};
