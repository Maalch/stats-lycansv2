import{r as f,j as e}from"./index-DP0a61rw.js";import{a as B}from"./baseStatsHook-KX5Qm48e.js";import{a as j,g as v}from"./datasyncExport-D6_8Fmuy.js";import{g as V}from"./gameUtils-CCGRmivF.js";import{F as W,C as b,X as F,Y as N,a as $}from"./FullscreenChart-DD1XCsNV.js";import{R as S,T as R}from"./CategoricalChart-Q0XNgkFa.js";import{B as L,a as g}from"./BarChart-TT1a3qn5.js";import{L as T}from"./Legend-BQe9XDgV.js";function k(a){const l=a.PlayerStats.length;let x=0,d=0,m=0;const p=a.PlayerStats.filter(r=>{const c=j(r.MainRoleInitial,r.MainRoleChanges||[]),u=v(c,{regroupWolfSubRoles:!1}),n=u==="Loup"||u==="Traître"||u==="Louveteau";return n&&(u==="Loup"?x++:u==="Traître"?d++:u==="Louveteau"&&m++),n}),i=a.PlayerStats.filter(r=>{const c=j(r.MainRoleInitial,r.MainRoleChanges||[]),u=v(c);return u!=="Villageois"&&u!=="Loup"});return{playerCount:l,wolfCount:p.length,pureWolfCount:x,traitreCount:d,louveteuCount:m,soloCount:i.length,villageoisCount:l-p.length-i.length}}function P(a){if(a.length===0)return null;const l={};a.forEach(m=>{const p=k(m),{playerCount:i,wolfCount:r,pureWolfCount:c,traitreCount:u,louveteuCount:n,soloCount:o,villageoisCount:t}=p;l[i]||(l[i]={});const s=`${c}L-${u}T-${n}Lou`,h=`${r}w-${o}s-${s}`;l[i][h]||(l[i][h]={wolfCount:r,pureWolfCount:c,traitreCount:u,louveteuCount:n,soloCount:o,villageoisCount:t,appearances:0,winsByWolves:0,winsByVillageois:0,winsBySolo:0,wolfWinRate:0,villageoisWinRate:0,soloWinRate:0,configKey:h,wolfBreakdownKey:s}),l[i][h].appearances++;const C=V(m);C==="Loup"?l[i][h].winsByWolves++:C==="Villageois"?l[i][h].winsByVillageois++:l[i][h].winsBySolo++});const x=[];let d=0;return Object.keys(l).map(Number).sort((m,p)=>m-p).forEach(m=>{const p=l[m],i=[];Object.values(p).forEach(t=>{const s=t.appearances>0?t.winsByWolves/t.appearances*100:0,h=t.appearances>0?t.winsByVillageois/t.appearances*100:0,C=t.appearances>0?t.winsBySolo/t.appearances*100:0;i.push({...t,wolfWinRate:s,villageoisWinRate:h,soloWinRate:C}),t.appearances>=5&&d++}),i.sort((t,s)=>s.appearances-t.appearances);const r=i.filter(t=>t.appearances>=5),c=r.length>0?r[0]:void 0,u=r.length>0?r.reduce((t,s)=>s.wolfWinRate>t.wolfWinRate?s:t):void 0,n=r.length>0?r.reduce((t,s)=>s.villageoisWinRate>t.villageoisWinRate?s:t):void 0,o=i.reduce((t,s)=>t+s.appearances,0);x.push({playerCount:m,totalGames:o,configurations:i,mostCommon:c,bestWolfWinRate:u,bestVillageoisWinRate:n})}),{compositionsByPlayerCount:x,totalGamesAnalyzed:a.length,configurationsWithMinAppearances:d}}function w(){const{data:a,isLoading:l,error:x}=B(P);return{teamCompositionStats:a,isLoading:l,error:x}}function y(a){const l=[];return a.pureWolfCount>0&&l.push(`${a.pureWolfCount}L`),a.traitreCount>0&&l.push(`${a.traitreCount}T`),a.louveteuCount>0&&l.push(`${a.louveteuCount}Lou`),l.length>0?l.join("+"):"0L"}function O(){const{teamCompositionStats:a,isLoading:l,error:x}=w(),[d,m]=f.useState(null),[p,i]=f.useState("overview");if(l)return e.jsx("div",{children:"Chargement des compositions d'équipe..."});if(x)return e.jsxs("div",{children:["Erreur: ",x]});if(!a||a.compositionsByPlayerCount.length===0)return e.jsx("div",{children:"Aucune donnée de composition disponible"});const r=a.compositionsByPlayerCount.map(o=>{const t=o.mostCommon;return{playerCount:o.playerCount,totalGames:o.totalGames,mostCommonConfig:t?`${y(t)}/${t.soloCount}S`:"N/A",mostCommonWolfBreakdown:t?y(t):"N/A",mostCommonAppearances:t?t.appearances:0,mostCommonWolfWinRate:t?t.wolfWinRate:0,mostCommonVillageoisWinRate:t?t.villageoisWinRate:0,mostCommonSoloWinRate:t?t.soloWinRate:0,hasEnoughData:t&&t.appearances>=5,mostCommonFullConfig:t}}),c=d!==null?a.compositionsByPlayerCount.find(o=>o.playerCount===d):null,u=c?c.configurations.filter(o=>o.appearances>=5):[],n={wolf:"#dc2626",villageois:"#16a34a",solo:"#f59e0b"};return e.jsxs("div",{className:"lycans-camps-container",children:[e.jsx("h2",{children:"Statistiques des Compositions d'Équipe"}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.totalGamesAnalyzed}),e.jsx("p",{children:"parties analysées"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Configurations Fréquentes"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.configurationsWithMinAppearances}),e.jsx("p",{children:"≥5 parties"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{i("overview"),m(null)},className:`px-4 py-2 rounded ${p==="overview"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700"}`,children:"Vue d'ensemble"}),e.jsx("button",{onClick:()=>i("detailed"),className:`px-4 py-2 rounded ${p==="detailed"?"bg-blue-600 text-white":"bg-gray-200 dark:bg-gray-700"}`,children:"Vue détaillée"})]}),p==="overview"?e.jsx(W,{title:"Compositions les Plus Fréquentes par Nombre de Joueurs",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Configuration la plus jouée pour chaque nombre de joueurs (minimum 5 parties). Format: Loups (L=Loup pur, T=Traître, Lou=Louveteau) / S=Rôles Solo"}),e.jsx(S,{width:"100%",height:400,children:e.jsxs(L,{data:r,children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"playerCount",label:{value:"Nombre de joueurs",position:"insideBottom",offset:-5}}),e.jsx(N,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(R,{content:({active:o,payload:t})=>{if(o&&t&&t.length>0){const s=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:4},children:[s.playerCount," joueurs"]}),e.jsxs("p",{style:{fontSize:"0.875rem"},children:["Total: ",s.totalGames," parties"]}),s.hasEnoughData?e.jsxs(e.Fragment,{children:[e.jsxs("p",{style:{fontSize:"0.875rem",fontWeight:500,marginTop:8},children:["Config la + fréquente: ",s.mostCommonConfig]}),s.mostCommonFullConfig&&e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(",s.mostCommonFullConfig.pureWolfCount," Loup",s.mostCommonFullConfig.traitreCount>0?`, ${s.mostCommonFullConfig.traitreCount} Traître`:"",s.mostCommonFullConfig.louveteuCount>0?`, ${s.mostCommonFullConfig.louveteuCount} Louveteau`:"",")"]}),e.jsxs("p",{style:{fontSize:"0.875rem"},children:["Parties: ",s.mostCommonAppearances]}),e.jsxs("div",{style:{marginTop:8,fontSize:"0.875rem"},children:[e.jsxs("p",{style:{color:n.wolf},children:["Victoires Loups: ",s.mostCommonWolfWinRate.toFixed(1),"%"]}),e.jsxs("p",{style:{color:n.villageois},children:["Victoires Villageois:"," ",s.mostCommonVillageoisWinRate.toFixed(1),"%"]}),e.jsxs("p",{style:{color:n.solo},children:["Victoires Solo: ",s.mostCommonSoloWinRate.toFixed(1),"%"]})]})]}):e.jsx("p",{style:{fontSize:"0.875rem",fontStyle:"italic",marginTop:8,color:"var(--text-secondary)"},children:"Pas assez de données (minimum 5 parties requises)"})]})}return null}}),e.jsx(g,{dataKey:"mostCommonAppearances",fill:"#3b82f6",name:"Parties",children:r.map((o,t)=>e.jsx($,{cursor:"pointer",fill:o.hasEnoughData?"#3b82f6":"#d1d5db",opacity:o.hasEnoughData?1:.3,onClick:()=>{m(o.playerCount),i("detailed")}},`cell-${t}`))})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-center",children:"Joueurs"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"Total Parties"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"Détails"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"Parties"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"% Loups"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"% Villageois"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"% Solo"})]})}),e.jsx("tbody",{children:r.map((o,t)=>e.jsxs("tr",{className:`${t%2===0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-900"} hover:bg-blue-50 dark:hover:bg-blue-900 cursor-pointer`,onClick:()=>{m(o.playerCount),i("detailed")},children:[e.jsx("td",{className:"px-6 py-3 font-medium text-center",children:o.playerCount}),e.jsx("td",{className:"px-6 py-3 text-center",children:o.totalGames}),e.jsx("td",{className:"px-6 py-3 text-center",children:o.hasEnoughData&&o.mostCommonFullConfig?e.jsxs(e.Fragment,{children:[o.mostCommonFullConfig.pureWolfCount>0&&`${o.mostCommonFullConfig.pureWolfCount} Loup${o.mostCommonFullConfig.pureWolfCount>1?"s":""}`,o.mostCommonFullConfig.traitreCount>0&&e.jsxs(e.Fragment,{children:[o.mostCommonFullConfig.pureWolfCount>0?", ":"",o.mostCommonFullConfig.traitreCount," Traître",o.mostCommonFullConfig.traitreCount>1?"s":""]}),o.mostCommonFullConfig.louveteuCount>0&&e.jsxs(e.Fragment,{children:[o.mostCommonFullConfig.pureWolfCount>0||o.mostCommonFullConfig.traitreCount>0?", ":"",o.mostCommonFullConfig.louveteuCount," Louveteau",o.mostCommonFullConfig.louveteuCount>1?"x":""]}),o.mostCommonFullConfig.soloCount>0&&e.jsxs(e.Fragment,{children:[o.mostCommonFullConfig.pureWolfCount>0||o.mostCommonFullConfig.traitreCount>0||o.mostCommonFullConfig.louveteuCount>0?", ":"",o.mostCommonFullConfig.soloCount," Solo"]}),o.mostCommonFullConfig.villageoisCount>0&&e.jsxs(e.Fragment,{children:[", ",o.mostCommonFullConfig.villageoisCount," Villageois"]})]}):"N/A"}),e.jsx("td",{className:"px-6 py-3 text-center",children:o.hasEnoughData?o.mostCommonAppearances:"-"}),e.jsx("td",{className:"px-6 py-3 text-center font-medium",style:{color:o.hasEnoughData?n.wolf:"var(--text-secondary)"},children:o.hasEnoughData?`${o.mostCommonWolfWinRate.toFixed(1)}%`:"-"}),e.jsx("td",{className:"px-6 py-3 text-center font-medium",style:{color:o.hasEnoughData?n.villageois:"var(--text-secondary)"},children:o.hasEnoughData?`${o.mostCommonVillageoisWinRate.toFixed(1)}%`:"-"}),e.jsx("td",{className:"px-6 py-3 text-center font-medium",style:{color:o.hasEnoughData?n.solo:"var(--text-secondary)"},children:o.hasEnoughData?`${o.mostCommonSoloWinRate.toFixed(1)}%`:"-"})]},o.playerCount))})]})})]})}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 p-4 rounded-lg",children:[e.jsx("label",{className:"font-medium mr-2",children:"Sélectionner le nombre de joueurs:"}),e.jsxs("select",{value:d||"",onChange:o=>m(o.target.value?Number(o.target.value):null),className:"px-3 py-2 border rounded bg-white dark:bg-gray-700",children:[e.jsx("option",{value:"",children:"-- Choisir --"}),a.compositionsByPlayerCount.map(o=>e.jsxs("option",{value:o.playerCount,children:[o.playerCount," joueurs (",o.totalGames," parties)"]},o.playerCount))]})]}),d!==null&&c&&e.jsx(W,{title:`Configurations pour ${d} joueurs (${c.totalGames} parties)`,children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Toutes les configurations jouées au moins 5 fois. Format: Loups (L=Loup pur, T=Traître, Lou=Louveteau) / S=Rôles Solo / V=Villageois"}),u.length===0?e.jsxs("div",{className:"text-center py-8 text-gray-500",children:["Aucune configuration jouée au moins 5 fois pour ",d," joueurs"]}):e.jsxs(e.Fragment,{children:[e.jsx(S,{width:"100%",height:400,children:e.jsxs(L,{data:u.map(o=>({name:`${y(o)}/${o.soloCount}S`,config:o,Loups:o.wolfWinRate,Villageois:o.villageoisWinRate,Solo:o.soloWinRate})),children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(F,{dataKey:"name"}),e.jsx(N,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"}}),e.jsx(R,{content:({active:o,payload:t})=>{if(o&&t&&t.length>0){const s=t[0].payload.config;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:4},children:[y(s)," / ",s.soloCount,"S /"," ",s.villageoisCount,"V"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(",s.pureWolfCount," Loup",s.traitreCount>0?`, ${s.traitreCount} Traître`:"",s.louveteuCount>0?`, ${s.louveteuCount} Louveteau`:"",")"]}),e.jsxs("p",{style:{fontSize:"0.875rem"},children:["Parties jouées: ",s.appearances]}),e.jsxs("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:4},children:[e.jsxs("p",{style:{fontSize:"0.875rem",color:n.wolf},children:["Loups: ",s.winsByWolves," victoires (",s.wolfWinRate.toFixed(1),"%)"]}),e.jsxs("p",{style:{fontSize:"0.875rem",color:n.villageois},children:["Villageois: ",s.winsByVillageois," ","victoires (",s.villageoisWinRate.toFixed(1),"%)"]}),e.jsxs("p",{style:{fontSize:"0.875rem",color:n.solo},children:["Solo: ",s.winsBySolo," victoires (",s.soloWinRate.toFixed(1),"%)"]})]})]})}return null}}),e.jsx(T,{}),e.jsx(g,{dataKey:"Loups",fill:n.wolf}),e.jsx(g,{dataKey:"Villageois",fill:n.villageois}),e.jsx(g,{dataKey:"Solo",fill:n.solo})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-center",children:"Détails"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"Parties"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"V. Loups"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"V. Villageois"}),e.jsx("th",{className:"px-6 py-3 text-center",children:"V. Solo"})]})}),e.jsx("tbody",{children:u.map((o,t)=>e.jsxs("tr",{className:t%2===0?"bg-white dark:bg-gray-800":"bg-gray-50 dark:bg-gray-900",children:[e.jsxs("td",{className:"px-6 py-3 text-xs text-center",style:{color:"var(--text-secondary)"},children:[o.pureWolfCount>0&&`${o.pureWolfCount} Loup${o.pureWolfCount>1?"s":""}`,o.traitreCount>0&&e.jsxs(e.Fragment,{children:[o.pureWolfCount>0?", ":"",o.traitreCount," Traître",o.traitreCount>1?"s":""]}),o.louveteuCount>0&&e.jsxs(e.Fragment,{children:[o.pureWolfCount>0||o.traitreCount>0?", ":"",o.louveteuCount," Louveteau",o.louveteuCount>1?"x":""]}),o.soloCount>0&&e.jsxs(e.Fragment,{children:[o.pureWolfCount>0||o.traitreCount>0||o.louveteuCount>0?", ":"",o.soloCount," Solo"]}),o.villageoisCount>0&&e.jsxs(e.Fragment,{children:[", ",o.villageoisCount," Villageois"]})]}),e.jsx("td",{className:"px-6 py-3 text-center font-medium",children:o.appearances}),e.jsxs("td",{className:"px-6 py-3 text-center",children:[e.jsx("span",{style:{color:n.wolf,fontWeight:500},children:o.winsByWolves}),e.jsxs("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginLeft:"0.25rem"},children:["(",o.wolfWinRate.toFixed(1),"%)"]})]}),e.jsxs("td",{className:"px-6 py-3 text-center",children:[e.jsx("span",{style:{color:n.villageois,fontWeight:500},children:o.winsByVillageois}),e.jsxs("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginLeft:"0.25rem"},children:["(",o.villageoisWinRate.toFixed(1),"%)"]})]}),e.jsxs("td",{className:"px-6 py-3 text-center",children:[e.jsx("span",{style:{color:n.solo,fontWeight:500},children:o.winsBySolo}),e.jsxs("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginLeft:"0.25rem"},children:["(",o.soloWinRate.toFixed(1),"%)"]})]})]},o.configKey))})]})})]})]})})]})]})]})}export{O as TeamCompositionChart};
