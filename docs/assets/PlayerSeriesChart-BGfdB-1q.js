import{r as P,u as M,j as e}from"./index-zDsQQI_Z.js";import{u as I,a as J}from"./useRawGameData-CSIfVaCr.js";import{p as K}from"./api-beq3FXpM.js";import{F as O,B as X,C as Y,X as U,Y as H,a as Q,b as Z}from"./FullscreenChart-Dcn5aLJs.js";import{R as _,T as R}from"./CategoricalChart-DklIzZgO.js";function ee(){const{data:l,isLoading:W,error:y}=I(),{data:S,isLoading:t,error:j}=J();return{data:P.useMemo(()=>{if(!l||l.length===0||!S||S.length===0)return null;const c=s=>s?s.split(",").map(r=>r.trim()).filter(Boolean):[],C=(s,r)=>r&&r.trim()!==""?c(r).some(h=>h.toLowerCase()===s.toLowerCase()):!1,p={};S.forEach(s=>{const r=s.Game?.toString();if(!r)return;p[r]||(p[r]={});const o=(n,D)=>{n&&n.toString().trim()&&(p[r][n.toString().trim()]=D)},h=s.Loups;h&&c(h.toString()).forEach(n=>{p[r][n]="Loups"});const g=s.Amoureux;g&&c(g.toString()).forEach(n=>{p[r][n]="Amoureux"});const V=s.Agent;V&&c(V.toString()).forEach(n=>{p[r][n]="Agent"}),o(s.Traître,"Traître"),o(s["Idiot du village"],"Idiot du Village"),o(s.Cannibale,"Cannibale"),o(s.Espion,"Espion"),o(s.Scientifique,"Scientifique"),o(s["La Bête"],"La Bête"),o(s["Chasseur de primes"],"Chasseur de primes"),o(s.Vaudou,"Vaudou")});const b=(s,r,o)=>{const h=s[r]&&s[r][o]||"Villageois";return h==="Loups"||h==="Traître"?"Loups":h==="Villageois"?"Villageois":"Autres"},x=[...l].sort((s,r)=>(s.Game||0)-(r.Game||0)),d=new Set;x.forEach(s=>{const r=s["Liste des joueurs"];r&&c(r.toString()).forEach(o=>{d.add(o.trim())})});const u={};d.forEach(s=>{u[s]={currentVillageoisSeries:0,currentLoupsSeries:0,longestVillageoisSeries:null,longestLoupsSeries:null,currentWinSeries:0,longestWinSeries:null,currentWinCamps:[],lastCamp:null,lastWon:!1,villageoisSeriesStart:null,loupsSeriesStart:null,winSeriesStart:null}}),x.forEach(s=>{const r=s.Game?.toString(),o=s["Liste des joueurs"],h=s["Liste des gagnants"],g=s.Date?.toString()||"";if(!r||!o)return;const V=c(o.toString()),n=parseInt(r);V.forEach(D=>{const m=D.trim();if(!m)return;const i=u[m],L=b(p,r,m),z=C(m,h?.toString()),G=p[r]&&p[r][m]||"Villageois";if(L==="Villageois"||L==="Loups"?(L==="Villageois"&&(i.lastCamp==="Villageois"?i.currentVillageoisSeries++:(i.currentVillageoisSeries=1,i.villageoisSeriesStart={game:n,date:g}),(!i.longestVillageoisSeries||i.currentVillageoisSeries>i.longestVillageoisSeries.seriesLength)&&(i.longestVillageoisSeries={player:m,camp:"Villageois",seriesLength:i.currentVillageoisSeries,startGame:i.villageoisSeriesStart?.game||n,endGame:n,startDate:i.villageoisSeriesStart?.date||g,endDate:g}),i.currentLoupsSeries=0,i.loupsSeriesStart=null),L==="Loups"&&(i.lastCamp==="Loups"?i.currentLoupsSeries++:(i.currentLoupsSeries=1,i.loupsSeriesStart={game:n,date:g}),(!i.longestLoupsSeries||i.currentLoupsSeries>i.longestLoupsSeries.seriesLength)&&(i.longestLoupsSeries={player:m,camp:"Loups",seriesLength:i.currentLoupsSeries,startGame:i.loupsSeriesStart?.game||n,endGame:n,startDate:i.loupsSeriesStart?.date||g,endDate:g}),i.currentVillageoisSeries=0,i.villageoisSeriesStart=null),i.lastCamp=L):(i.currentVillageoisSeries=0,i.currentLoupsSeries=0,i.villageoisSeriesStart=null,i.loupsSeriesStart=null,i.lastCamp="Autres"),z){if(i.lastWon?(i.currentWinSeries++,i.currentWinCamps.push(G)):(i.currentWinSeries=1,i.currentWinCamps=[G],i.winSeriesStart={game:n,date:g}),!i.longestWinSeries||i.currentWinSeries>i.longestWinSeries.seriesLength){const N={};i.currentWinCamps.forEach(E=>{N[E]=(N[E]||0)+1}),i.longestWinSeries={player:m,seriesLength:i.currentWinSeries,startGame:i.winSeriesStart?.game||n,endGame:n,startDate:i.winSeriesStart?.date||g,endDate:g,campCounts:N}}i.lastWon=!0}else i.currentWinSeries=0,i.currentWinCamps=[],i.winSeriesStart=null,i.lastWon=!1})});const a=[],v=[],f=[];Object.values(u).forEach(s=>{s.longestVillageoisSeries&&a.push(s.longestVillageoisSeries),s.longestLoupsSeries&&v.push(s.longestLoupsSeries),s.longestWinSeries&&f.push(s.longestWinSeries)}),a.sort((s,r)=>r.seriesLength-s.seriesLength),v.sort((s,r)=>r.seriesLength-s.seriesLength),f.sort((s,r)=>r.seriesLength-s.seriesLength);const T=d.size,w=a.length>0?a.reduce((s,r)=>s+r.seriesLength,0)/a.length:0,F=v.length>0?v.reduce((s,r)=>s+r.seriesLength,0)/v.length:0,B=f.length>0?f.reduce((s,r)=>s+r.seriesLength,0)/f.length:0,k=a.filter(s=>s.seriesLength>=5).length,$=v.filter(s=>s.seriesLength>=3).length,q=f.filter(s=>s.seriesLength>=5).length;return{longestVillageoisSeries:a.slice(0,10),longestLoupsSeries:v.slice(0,10),longestWinSeries:f.slice(0,10),totalGamesAnalyzed:x.length,averageVillageoisSeries:Math.round(w*10)/10,averageLoupsSeries:Math.round(F*10)/10,averageWinSeries:Math.round(B*10)/10,eliteVillageoisCount:k,eliteLoupsCount:$,eliteWinCount:q,totalPlayersCount:T}},[l,S]),isLoading:W||t,error:y||j}}function ne(){const{data:l,isLoading:W,error:y}=ee(),{navigateToGameDetails:S}=M(),[t,j]=P.useState("villageois");if(W)return e.jsx("div",{className:"donnees-attente",children:"Récupération des séries de joueurs..."});if(y)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",y]});if(!l)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de série disponible"});const c=(()=>{switch(t){case"villageois":return l.longestVillageoisSeries.slice(0,15);case"loups":return l.longestLoupsSeries.slice(0,15);case"wins":return l.longestWinSeries.slice(0,15);default:return[]}})(),C=d=>Object.entries(d).map(([u,a])=>`${u} (${a})`).join(", "),p=()=>{switch(t){case"villageois":return"Plus Longues Séries Villageois Consécutives";case"loups":return"Plus Longues Séries Loups Consécutives";case"wins":return"Plus Longues Séries de Victoires";default:return""}},b=({active:d,payload:u})=>{if(!d||!u||u.length===0)return null;const a=u[0].payload;return t==="wins"?e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.player})}),e.jsxs("div",{children:["Série de victoires : ",a.seriesLength," parties"]}),e.jsxs("div",{children:["Du jeu #",a.startGame," au jeu #",a.endGame]}),e.jsxs("div",{children:["Du ",a.startDate," au ",a.endDate]}),e.jsxs("div",{children:["Camps joués : ",C(a.campCounts)]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]}):e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.player})}),e.jsxs("div",{children:["Série ",a.camp," : ",a.seriesLength," parties consécutives"]}),e.jsxs("div",{children:["Du jeu #",a.startGame," au jeu #",a.endGame]}),e.jsxs("div",{children:["Du ",a.startDate," au ",a.endDate]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})},x=d=>{if(t==="wins")S({selectedPlayer:d.player,fromComponent:"Séries de Victoires"});else{const u=t==="villageois"?"Villageois":"Loups";S({selectedPlayer:d.player,selectedCamp:u,fromComponent:`Séries ${u}`})}};return e.jsxs("div",{className:"lycans-players-series",children:[e.jsx("h2",{children:"Séries des Joueurs"}),e.jsxs("p",{className:"lycans-stats-info",children:["Basé sur ",l.totalGamesAnalyzed," parties analysées"]}),e.jsx("div",{className:"lycans-section-description",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Séries de camps :"})," Parties consécutives dans le même camp principal (Villageois ou Loups). Jouer dans un autre camp (rôles spéciaux) brise la série.",e.jsx("br",{}),e.jsx("strong",{children:"Séries de victoires :"})," Victoires consécutives dans n'importe quel camp. Une défaite brise la série."]})}),e.jsxs("div",{className:"lycans-categories-selection",children:[e.jsx("button",{className:`lycans-categorie-btn ${t==="villageois"?"active":""}`,onClick:()=>j("villageois"),children:"Séries Villageois"}),e.jsx("button",{className:`lycans-categorie-btn ${t==="loups"?"active":""}`,onClick:()=>j("loups"),children:"Séries Loups"}),e.jsx("button",{className:`lycans-categorie-btn ${t==="wins"?"active":""}`,onClick:()=>j("wins"),children:"Séries de Victoires"})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx(O,{title:p(),children:e.jsx("div",{style:{height:500},children:e.jsx(_,{width:"100%",height:"100%",children:e.jsxs(X,{data:c,margin:{top:20,right:30,left:20,bottom:10},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"player",angle:-45,textAnchor:"end",height:120,interval:0}),e.jsx(H,{label:{value:t==="wins"?"Victoires consécutives":"Parties consécutives",angle:-90,position:"insideLeft"}}),e.jsx(R,{content:b}),e.jsx(Q,{dataKey:"seriesLength",name:t==="wins"?"Victoires consécutives":"Parties consécutives",fill:t==="villageois"?"#82ca9d":t==="loups"?"#FF8042":"#8884d8",children:c.map((d,u)=>e.jsx(Z,{fill:K[d.player]||(t==="villageois"?"#82ca9d":t==="loups"?"#FF8042":"#8884d8"),onClick:()=>x(d),style:{cursor:"pointer"}},`cell-${t}-${u}`))})]})})})}),c.length>0&&e.jsxs("div",{className:"lycans-stats-grid",style:{marginTop:"0rem",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))"},children:[e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"🏆 Record Absolu"}),e.jsx("div",{className:"lycans-stat-value",children:c[0].seriesLength}),e.jsxs("p",{children:["par ",e.jsx("strong",{children:c[0].player})]}),t==="wins"?e.jsxs("p",{className:"lycans-h2h-description",children:["Camps : ",C(c[0].campCounts||{})]}):e.jsxs("p",{className:"lycans-h2h-description",children:["Camp : ",c[0].camp]})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"📊 Moyenne (tous les joueurs)"}),e.jsx("div",{className:"lycans-stat-value",children:t==="villageois"?l.averageVillageoisSeries:t==="loups"?l.averageLoupsSeries:l.averageWinSeries}),e.jsx("p",{children:"parties en moyenne"}),e.jsxs("p",{className:"lycans-h2h-description",children:["Basé sur ",l.totalPlayersCount," joueurs"]})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"⭐ Seuil Elite"}),e.jsx("div",{className:"lycans-stat-value",children:t==="villageois"?l.eliteVillageoisCount:t==="loups"?l.eliteLoupsCount:l.eliteWinCount}),e.jsx("p",{children:"joueurs au niveau elite"}),e.jsx("p",{className:"lycans-h2h-description",children:t==="villageois"?"5+ séries Villageois":t==="loups"?"3+ séries Loups":"5+ séries de victoires"})]})]}),c.length===0&&e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune série trouvée"}),e.jsx("p",{children:"Aucune série n'a été trouvée pour ce type avec les filtres actuels."})]})]})]})}export{ne as PlayerSeriesChart};
