import{r as N,u as K,j as e}from"./index-CMiPISYo.js";import{u as X,a as Y}from"./useRawGameData-q8DpLMnu.js";import{l as J,a as T}from"./api-beq3FXpM.js";import{b as D,F as q,B as z,C as W,X as _,Y as B,a as O}from"./FullscreenChart-IX2021Ql.js";import{R as k,T as P}from"./CategoricalChart-Cf74spGm.js";import{P as H,a as Q}from"./PieChart-DKBW6DFV.js";import{L as U}from"./Legend-B-c_fpsb.js";import"./PolarChart-DFm9Yxj7.js";function Z(){const{data:h,isLoading:p,error:E}=X(),{data:j,isLoading:v,error:w}=Y();return{campWinStats:N.useMemo(()=>{if(!h||h.length===0||!j||j.length===0)return null;const x=a=>a?a.split(",").map(r=>r.trim()).filter(Boolean):[],s=(a,r,c)=>a[r]&&a[r][c]||"Villageois",t=(a,r)=>r&&r.trim()!==""?x(r).some(f=>f.toLowerCase()===a.toLowerCase()):!1,i=(a,r)=>a===r||a==="Traître"&&r==="Loups",l={};j.forEach(a=>{const r=a.Game;if(!r)return;l[r]||(l[r]={});const c=(m,d)=>{m&&m.trim()&&(l[r][m.trim()]=d)},f=a.Loups;f&&x(f).forEach(m=>{l[r][m]="Loups"}),c(a.Traître,"Traître"),c(a["Idiot du village"],"Idiot du Village"),c(a.Cannibale,"Cannibale"),c(a.Espion,"Espion"),c(a["La Bête"],"La Bête"),c(a["Chasseur de primes"],"Chasseur de primes"),c(a.Vaudou,"Vaudou");const R=a.Agent;R&&x(R).forEach(m=>{l[r][m]="Agent"});const b=a.Scientifique;b&&x(b).forEach(m=>{l[r][m]="Scientifique"});const y=a.Amoureux;y&&x(y).forEach(m=>{l[r][m]="Amoureux"})});const n={},u={},o={};let F=0;h.forEach(a=>{const r=a.Game,c=a["Rôles solo"],f=a["Camp victorieux"],R=a["Liste des joueurs"],b=a["Liste des gagnants"];if(c&&c.toString().trim()!==""&&x(c.toString()).forEach(m=>{const d=m.trim();d!==""&&(n[d]||(n[d]=0),n[d]++)}),f&&f.trim()!==""&&(F++,u[f]||(u[f]=0),u[f]++),r&&R&&f&&b){const y=x(R),m=new Set;y.forEach(d=>{const g=d.trim();if(g){const C=s(l,r,g);m.add(C)}}),m.forEach(d=>{o[d]||(o[d]={totalGames:0,wins:0,winRate:0,players:{}}),o[d].totalGames++}),m.forEach(d=>{i(d,f)&&o[d].wins++}),y.forEach(d=>{const g=d.trim();if(g){const C=s(l,r,d);o[C].players[g]||(o[C].players[g]={games:0,wins:0,winRate:0}),o[C].players[g].games++,t(g,b)&&o[C].players[g].wins++}})}}),Object.keys(o).forEach(a=>{o[a].totalGames>0&&(o[a].winRate=parseFloat((o[a].wins/o[a].totalGames*100).toFixed(2))),Object.keys(o[a].players).forEach(r=>{const c=o[a].players[r];c.games>0&&(c.winRate=parseFloat((c.wins/c.games*100).toFixed(2)))})});const L=[];Object.keys(u).forEach(a=>{L.push({camp:a,wins:u[a],winRate:(u[a]/F*100).toFixed(2)})}),L.sort((a,r)=>r.wins-a.wins);const $=Object.keys(o).map(a=>({camp:a,totalGames:o[a].totalGames,winRate:o[a].winRate.toFixed(2)})),V=new Set;Object.keys(o).forEach(a=>{Object.keys(o[a].players).forEach(r=>{V.add(r)})});const I=V.size,G=[];return Object.keys(n).forEach(a=>{G.push({soloRole:a,appearances:n[a]})}),G.sort((a,r)=>r.appearances-a.appearances),{totalGames:F,campStats:L,soloCamps:G,campAverages:$,totalPlayersAnalyzed:I}},[h,j]),isLoading:p||v,errorInfo:E||w}}const ee="#607D8B";function me(){const{navigateToGameDetails:h}=K(),{campWinStats:p,isLoading:E,errorInfo:j}=Z(),v=N.useMemo(()=>p?.campAverages?p.campAverages.map(s=>({...s,winRateNum:parseFloat(s.winRate)})).sort((s,t)=>t.winRateNum-s.winRateNum):[],[p]),w=N.useMemo(()=>p?.campStats?.map(s=>({...s,winRateNum:typeof s.winRate=="string"?parseFloat(s.winRate):s.winRate}))||[],[p]),S=N.useMemo(()=>{if(!w.length)return[];const s=5;let t=0;const i=[],l=[];return w.forEach(n=>{n.winRateNum<s?(t+=n.winRateNum,i.push(n)):l.push(n)}),t>0&&l.push({camp:"Autres",wins:i.reduce((n,u)=>n+u.wins,0),winRate:t.toFixed(1),winRateNum:t,_details:i}),l},[w]),A=N.useMemo(()=>v.length?v.slice().filter(s=>s.camp!=="Villageois"&&s.camp!=="Loups").sort((s,t)=>t.totalGames-s.totalGames):[],[v]),M=E,x=j;return M?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques des camps..."}):x?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",x]}):p?e.jsxs("div",{className:"lycans-camps-container",children:[e.jsx("h2",{children:"Statistiques des Camps"}),p&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camps Analysés"}),e.jsx("div",{className:"lycans-valeur-principale",children:p.campAverages?.length||0}),e.jsx("p",{children:"camps différents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Joueurs Évalués"}),e.jsx("div",{className:"lycans-valeur-principale",children:p.totalPlayersAnalyzed||0}),e.jsx("p",{children:"joueurs analysés"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:p?.totalGames||0}),e.jsx("p",{children:"parties analysées"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[p&&S.length>0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Répartition des Victoires par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Distribution des victoires sur ",p.totalGames," parties"]}),e.jsx("div",{style:{height:450},children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(H,{children:[e.jsx(Q,{data:S,cx:"50%",cy:"50%",labelLine:!1,outerRadius:140,fill:"#8884d8",dataKey:"winRateNum",nameKey:"camp",onClick:s=>{if(s&&s.camp)if(s.camp==="Autres"&&s._details){const t=s._details.map(i=>i.camp);h({selectedCamp:"Autres",_smallCamps:t,fromComponent:"Répartition des Victoires par Camp",campFilterMode:"wins-only"})}else h({selectedCamp:s.camp,fromComponent:"Répartition des Victoires par Camp",campFilterMode:"wins-only"})},style:{cursor:"pointer"},label:({camp:s,winRate:t})=>s==="Autres"?`Autres: ${t}%`:`${s}: ${t}%`,children:S.map((s,t)=>e.jsx(D,{fill:s.camp==="Autres"?J:T[s.camp]||ee,onClick:()=>{if(s.camp==="Autres"&&s._details){const i=s._details.map(l=>l.camp);h({selectedCamp:"Autres",_smallCamps:i,fromComponent:"Répartition des Victoires par Camp",campFilterMode:"wins-only"})}else h({selectedCamp:s.camp,fromComponent:"Répartition des Victoires par Camp",campFilterMode:"wins-only"})},style:{cursor:"pointer"}},`cellule-camp-${t}`))}),e.jsx(P,{content:({active:s,payload:t})=>{if(s&&t&&t.length>0){const i=t[0].payload;if(i.camp==="Autres"&&i._details){const l=[...i._details].sort((n,u)=>u.winRateNum-n.winRateNum);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:"Autres"})}),e.jsx("div",{children:l.map((n,u)=>e.jsxs("div",{children:[n.camp,": ",n.wins," victoires (",n.winRate,"%)"]},u))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold"},children:["Total: ",i.wins," victoires (",i.winRate,"%)"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:i.camp}),e.jsxs("div",{children:["Victoires: ",i.wins]}),e.jsxs("div",{children:["Taux de victoire: ",i.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(U,{})]})})})]})}),p?.campAverages&&v.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire Moyen par Camp"}),e.jsx(q,{title:"Taux de Victoire Moyen par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(z,{data:v,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(W,{strokeDasharray:"3 3"}),e.jsx(_,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(B,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(P,{content:({active:s,payload:t})=>{if(s&&t&&t.length>0){const i=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:i.camp})}),e.jsxs("div",{children:["Parties totales: ",i.totalGames]}),e.jsxs("div",{children:["Taux de victoire: ",i.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(O,{dataKey:"winRateNum",onClick:s=>{s&&s.camp&&h({selectedCamp:s.camp,fromComponent:"Taux de Victoire Moyen par Camp",campFilterMode:"all-assignments"})},style:{cursor:"pointer"},children:v.map((s,t)=>e.jsx(D,{fill:T[s.camp]||`var(--chart-color-${t%6+1})`,onClick:()=>{h({selectedCamp:s.camp,fromComponent:"Taux de Victoire Moyen par Camp",campFilterMode:"all-assignments"})},style:{cursor:"pointer"}},`cell-${t}`))})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Parties par Camp (hors villageois et loups)"}),e.jsx(q,{title:"Distribution des Parties par Camp (hors villageois et loups)",children:e.jsx("div",{style:{height:400},children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(z,{data:A,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(W,{strokeDasharray:"3 3"}),e.jsx(_,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(B,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(P,{content:({active:s,payload:t})=>{if(s&&t&&t.length>0){const i=t[0].payload,l=A.reduce((u,o)=>u+o.totalGames,0),n=(i.totalGames/l*100).toFixed(1);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:i.camp})}),e.jsxs("div",{children:["Parties: ",i.totalGames," (",n,"%)"]}),e.jsxs("div",{children:["Taux victoire: ",i.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(O,{dataKey:"totalGames",onClick:s=>{s&&s.camp&&h({selectedCamp:s.camp,fromComponent:"Distribution des Parties par Camp",campFilterMode:"all-assignments"})},style:{cursor:"pointer"},children:A.map((s,t)=>e.jsx(D,{fill:T[s.camp]||`var(--chart-color-${t%6+1})`,onClick:()=>{h({selectedCamp:s.camp,fromComponent:"Distribution des Parties par Camp",campFilterMode:"all-assignments"})},style:{cursor:"pointer"}},`cell-${t}`))})]})})})})]})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de camp disponible"})}export{me as CampsChart};
