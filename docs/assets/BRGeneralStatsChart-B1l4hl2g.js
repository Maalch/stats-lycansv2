import{a as F,r as x,j as e}from"./index-CJo-oQ4f.js";import{F as j,B as b,C as P,X as w,Y as D,a as g,b as B}from"./FullscreenChart-CP4pSwGX.js";import{p as k,g as A}from"./api-beq3FXpM.js";import{R as y,T as v}from"./CategoricalChart-DnuYU1jr.js";import{P as $,a as J}from"./PieChart-DFuTV2Ld.js";import{L as V}from"./Legend-D2olCirb.js";import"./PolarChart-BbvhlDED.js";function G(t){if(!t)return null;const[l,p,d]=t.split("/");return!l||!p||!d?null:new Date(Number(d),Number(p)-1,Number(l))}function C(){const[t,l]=x.useState(null),[p,d]=x.useState(null),[m,f]=x.useState(!0),[u,h]=x.useState(null);return x.useEffect(()=>{(async()=>{try{f(!0),h(null);const r=await fetch("/stats-lycansv2/data/rawBRData.json");if(!r.ok)throw new Error("Failed to fetch rawBRData");const s=await r.json();l(s.BRParties?.data||[]),d(s.BRRefParties?.data||[])}catch(r){console.error("Error fetching raw BR data:",r),h(r instanceof Error?r.message:"Unknown error")}finally{f(!1)}})()},[]),{brPartiesData:t,brRefPartiesData:p,isLoading:m,error:u}}function I(){const{settings:t}=F(),{brPartiesData:l,brRefPartiesData:p,isLoading:d,error:m}=C();return{data:l?.filter(u=>{if(!u.Game||!u.Participants)return!1;const h=p?.find(n=>n.Game===u.Game);if(!h)return N(u,t);if(t.filterMode==="gameType"&&t.gameFilter!=="all"){if(t.gameFilter==="modded"){if(!h["Game Moddée"])return!1}else if(t.gameFilter==="non-modded"&&h["Game Moddée"])return!1}else if(t.filterMode==="dateRange"&&(t.dateRange.start||t.dateRange.end)){const n=G(h.Date);if(!n)return!1;if(t.dateRange.start){const r=new Date(t.dateRange.start);if(n<r)return!1}if(t.dateRange.end){const r=new Date(t.dateRange.end);if(n>r)return!1}}return N(u,t)})||null,isLoading:d,error:m}}function W(){const{settings:t}=F(),{brRefPartiesData:l,isLoading:p,error:d}=C();return{data:l?.filter(f=>{if(!f.Game||!f.Date)return!1;if(t.filterMode==="gameType"&&t.gameFilter!=="all"){if(t.gameFilter==="modded"){if(!f["Game Moddée"])return!1}else if(t.gameFilter==="non-modded"&&f["Game Moddée"])return!1}else if(t.filterMode==="dateRange"&&(t.dateRange.start||t.dateRange.end)){const u=G(f.Date);if(!u)return!1;if(t.dateRange.start){const h=new Date(t.dateRange.start);if(u<h)return!1}if(t.dateRange.end){const h=new Date(t.dateRange.end);if(u>h)return!1}}return!0})||null,isLoading:p,error:d}}function N(t,l){if(l.playerFilter.mode!=="none"&&l.playerFilter.players.length>0){const p=t.Participants.toLowerCase();if(l.playerFilter.mode==="include"){if(!l.playerFilter.players.some(m=>m.toLowerCase()===p))return!1}else if(l.playerFilter.mode==="exclude"&&l.playerFilter.players.some(m=>m.toLowerCase()===p))return!1}return!0}function Z(){const{data:t,isLoading:l,error:p}=I(),{data:d,isLoading:m,error:f}=W(),u=["var(--chart-color-1)","var(--chart-color-2)","var(--chart-color-3)","var(--chart-color-4)","var(--chart-color-5)","var(--chart-color-6)"],h=r=>k[r]||A(r),n=x.useMemo(()=>{if(!t||!d)return null;const r=d.length,s=t.length,c=t.filter(a=>a.Gagnant).length,R=t.reduce((a,i)=>{const o=i.Participants;return a[o]||(a[o]={name:o,participations:0,wins:0,totalScore:0,averageScore:0,winRate:0}),a[o].participations++,a[o].totalScore+=i.Score,i.Gagnant&&a[o].wins++,a},{});Object.values(R).forEach(a=>{a.averageScore=a.totalScore/a.participations,a.winRate=a.wins/a.participations*100});const L=Object.values(R).sort((a,i)=>i.participations-a.participations).slice(0,10),T=Object.values(R).filter(a=>a.participations>=3).sort((a,i)=>i.winRate-a.winRate).slice(0,10),E=Object.values(R).filter(a=>a.participations>=3).sort((a,i)=>i.averageScore-a.averageScore).slice(0,10),M=t.reduce((a,i)=>{const o=i.Score,S=o===0?"0":o===1?"1":o===2?"2":o===3?"3":o===4?"4":o<=6?"5-6":"7+";return a[S]||(a[S]=0),a[S]++,a},{}),O=Object.entries(M).map(([a,i])=>({range:a,count:i,percentage:(i/s*100).toFixed(1)})),q=d.reduce((a,i)=>{const o=i["Nombre de participants"];return a[o]||(a[o]=0),a[o]++,a},{}),K=Object.entries(q).map(([a,i])=>({participants:parseInt(a),games:i,percentage:(i/r*100).toFixed(1)})).sort((a,i)=>a.participants-i.participants);return{totalGames:r,totalParticipations:s,totalWins:c,winRate:(c/s*100).toFixed(1),averageParticipantsPerGame:(s/r).toFixed(1),topPlayersByParticipations:L,topPlayersByWins:T,topPlayersByAverageScore:E,scoreData:O,participantData:K}},[t,d]);return l||m?e.jsx("div",{className:"statistiques-chargement",children:"Chargement des données Battle Royale..."}):p||f?e.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",p||f]}):n?e.jsxs("div",{className:"lycans-chart-container",children:[e.jsx("div",{className:"lycans-chart-header",children:e.jsx("h2",{children:"Statistiques Battle Royale"})}),e.jsxs("div",{className:"lycans-stats-grid",children:[e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Parties totales"}),e.jsx("div",{className:"lycans-stat-value",children:n.totalGames})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Participations"}),e.jsx("div",{className:"lycans-stat-value",children:n.totalParticipations})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Moy. participants/partie"}),e.jsx("div",{className:"lycans-stat-value",children:n.averageParticipantsPerGame})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Participations"}),e.jsx(j,{title:"Top Joueurs par Participations - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(y,{width:"100%",height:400,children:e.jsxs(b,{data:n.topPlayersByParticipations,children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(w,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(D,{}),e.jsx(v,{content:({active:r,payload:s})=>{if(r&&s&&s.length>0){const c=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:c.name})}),e.jsxs("div",{children:["Participations : ",c.participations]}),e.jsxs("div",{children:["Victoires : ",c.wins]})]})}return null}}),e.jsx(g,{dataKey:"participations",name:"Participations",children:n.topPlayersByParticipations.map((r,s)=>e.jsx(B,{fill:h(r.name)},`cell-${s}`))}),e.jsx(g,{dataKey:"wins",fill:"var(--chart-color-2)",name:"Victoires"})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Taux de Victoire (min. 3 parties)"}),e.jsx(j,{title:"Top Joueurs par Taux de Victoire - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(y,{width:"100%",height:400,children:e.jsxs(b,{data:n.topPlayersByWins,children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(w,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(D,{}),e.jsx(v,{content:({active:r,payload:s})=>{if(r&&s&&s.length>0){const c=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:c.name})}),e.jsxs("div",{children:["Taux de victoire : ",c.winRate.toFixed(2),"%"]}),e.jsxs("div",{children:["Victoires : ",c.wins," / ",c.participations]})]})}return null}}),e.jsx(g,{dataKey:"winRate",name:"Taux de victoire (%)",children:n.topPlayersByWins.map((r,s)=>e.jsx(B,{fill:h(r.name)},`cell-${s}`))})]})})})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Score Moyen par Partie (min. 3 parties)"}),e.jsx(j,{title:"Top Joueurs par Score Moyen - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(y,{width:"100%",height:400,children:e.jsxs(b,{data:n.topPlayersByAverageScore,children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(w,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(D,{}),e.jsx(v,{content:({active:r,payload:s})=>{if(r&&s&&s.length>0){const c=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:c.name})}),e.jsxs("div",{children:["Score moyen : ",c.averageScore.toFixed(2)]}),e.jsxs("div",{children:["Score total : ",c.totalScore," / ",c.participations," parties"]})]})}return null}}),e.jsx(g,{dataKey:"averageScore",name:"Score moyen par partie",children:n.topPlayersByAverageScore.map((r,s)=>e.jsx(B,{fill:h(r.name)},`cell-${s}`))})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Scores"}),e.jsx(j,{title:"Distribution des Scores - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(y,{width:"100%",height:400,children:e.jsxs($,{children:[e.jsx(J,{data:n.scoreData,cx:"50%",cy:"50%",labelLine:!1,label:({range:r,percentage:s})=>`${r}: ${s}%`,outerRadius:140,fill:"#8884d8",dataKey:"count",children:n.scoreData.map((r,s)=>e.jsx(B,{fill:u[s%u.length]},`cell-${s}`))}),e.jsx(v,{formatter:r=>[r,"Participations"]})]})})})]})]}),e.jsxs("div",{className:"lycans-chart-section",children:[e.jsx("h3",{children:"Répartition par Nombre de Participants"}),e.jsx(j,{title:"Répartition par Nombre de Participants - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(y,{width:"100%",height:400,children:e.jsxs(b,{data:n.participantData,children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(w,{dataKey:"participants"}),e.jsx(D,{}),e.jsx(v,{formatter:(r,s)=>[r,s==="games"?"Parties":s]}),e.jsx(V,{}),e.jsx(g,{dataKey:"games",fill:"var(--chart-color-4)",name:"Nombre de parties"})]})})})]})]}):e.jsx("div",{className:"statistiques-vide",children:"Aucune donnée Battle Royale disponible"})}export{Z as BRGeneralStatsChart};
