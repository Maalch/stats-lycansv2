import{r as o,j as e}from"./index-C1T0pjGZ.js";import{p as f,l as w,g as N}from"./api-BWHeASPZ.js";import{R as p,B as b,C as P,X as S,Y as C,T as x,a as D,b as g}from"./BarChart-DNiKP9R3.js";import{P as E,a as R}from"./PieChart-Cnuj8BwU.js";import{L as G}from"./Legend-BGzUCura.js";function q(){const[t,m]=o.useState(null),[d,i]=o.useState(!0),[c,h]=o.useState(null);return o.useEffect(()=>{(async()=>{try{i(!0),h(null);const l=await fetch("https://script.google.com/macros/s/AKfycbxrhG1mb7N6q7Mg88ogw0mirXgSihPpNPurZwiEOy9miG24Cc3AlGZCn2uoGnygNhck/exec?action=playerStats");if(!l.ok)throw new Error(`Erreur API: ${l.status}`);const j=await l.json();m(j)}catch(n){console.error("Erreur lors de la récupération des statistiques des joueurs:",n),h(n instanceof Error?n.message:"Erreur inconnue")}finally{i(!1)}})()},[]),{playerStatsData:t,dataLoading:d,fetchError:c}}function K(){const{playerStatsData:t,dataLoading:m,fetchError:d}=q(),[i]=o.useState(null),[c,h]=o.useState(10),y=[5,8,10,15,20,25,30,50,100];if(m)return e.jsx("div",{className:"donnees-attente",children:"Récupération des statistiques des joueurs..."});if(d)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",d]});if(!t)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de joueur disponible"});const n=t.playerStats.filter(a=>a.gamesPlayed>2).sort((a,s)=>s.gamesPlayed-a.gamesPlayed).slice(0,20),l=t.playerStats.filter(a=>a.gamesPlayed>=c).sort((a,s)=>parseFloat(s.winPercent)-parseFloat(a.winPercent)).slice(0,20),v=i?(a=>{const s=t.playerStats.find(r=>r.player===a);return s?Object.entries(s.camps).filter(([r,u])=>u>0).map(([r,u])=>({name:r,value:u,percentage:(u/s.gamesPlayed*100).toFixed(1)})):[]})(i):[];return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques des Joueurs"}),e.jsxs("p",{className:"lycans-stats-info",children:["Total de ",t.totalGames," parties analysées avec ",t.playerStats.length," joueurs"]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Participations"}),e.jsx("div",{style:{height:400},children:e.jsx(p,{width:"100%",height:"100%",children:e.jsxs(b,{data:n,margin:{top:20,right:30,left:20,bottom:70},children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(S,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(C,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(x,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const r=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:r.player})}),e.jsxs("div",{children:["Parties jouées : ",r.gamesPlayed]}),e.jsxs("div",{children:["Pourcentage : ",r.gamesPlayedPercent,"%"]})]})}return null}}),e.jsx(D,{dataKey:"gamesPlayed",name:"Parties jouées",fill:"#00C49F",children:n.map(a=>e.jsx(g,{fill:f[a.player]||"#00C49F"},`cell-participation-${a.player}`))})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[e.jsx("h3",{children:"Meilleurs Taux de Victoire"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"min-games-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select",value:c,onChange:a=>h(Number(a.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:y.map(a=>e.jsx("option",{value:a,children:a},a))})]})]}),e.jsx("div",{style:{height:400},children:e.jsx(p,{width:"100%",height:"100%",children:e.jsxs(b,{data:l,margin:{top:20,right:30,left:20,bottom:70},children:[e.jsx(P,{strokeDasharray:"3 3"}),e.jsx(S,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(C,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(x,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const r=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:r.player})}),e.jsxs("div",{children:["Taux de victoire : ",r.winPercent,"%"]}),e.jsxs("div",{children:["Victoires : ",r.wins," / ",r.gamesPlayed]})]})}return null}}),e.jsx(D,{dataKey:"winPercent",name:"Taux de Victoire",fill:"#8884d8",children:l.map(a=>e.jsx(g,{fill:f[a.player]||"#8884d8"},`cell-winrate-${a.player}`))})]})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:[l.length," joueur(s) avec au moins ",c," partie(s)"]})]})]}),i&&e.jsxs("div",{className:"lycans-graphique-section lycans-joueur-details",children:[e.jsxs("h3",{children:["Distribution des Camps - ",i]}),e.jsx("div",{style:{height:300},children:e.jsx(p,{width:"100%",height:"100%",children:e.jsxs(E,{children:[e.jsx(R,{data:v,cx:"50%",cy:"50%",labelLine:!0,outerRadius:80,fill:"#8884d8",dataKey:"value",nameKey:"name",label:({name:a,percentage:s})=>`${a}: ${s}%`,children:v.map((a,s)=>e.jsx(g,{fill:w[a.name]||N(a.name)},`cell-${s}`))}),e.jsx(x,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const r=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:r.name})}),e.jsxs("div",{children:[r.value," parties (",r.percentage,"%)"]})]})}return null}}),e.jsx(G,{})]})})})]})]})}export{K as PlayersGeneralStatisticsChart};
