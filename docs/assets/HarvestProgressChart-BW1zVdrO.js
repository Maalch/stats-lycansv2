import{u,j as e}from"./index-iPJCRIrI.js";import{a as x,l as g}from"./api-beq3FXpM.js";import{h as f}from"./baseStatsHook--6aOJIne.js";import{b as d,F as p,B as y,C as j,X as H,Y as b,a as N}from"./FullscreenChart-CuGzK3ME.js";import{R as m,T as v}from"./CategoricalChart-tykwOv4n.js";import{P as R,a as C}from"./PieChart-Pryh3vXh.js";import{L as M}from"./Legend-PMED22SS.js";import"./PolarChart-H3lE0Mdp.js";function P(){return{averageHarvest:0,averageHarvestPercent:"0",gamesWithHarvest:0,harvestDistribution:{"0-25%":0,"26-50%":0,"51-75%":0,"76-99%":0,"100%":0},harvestByWinner:{}}}function W(r,t){r<=.25?t["0-25%"]++:r<=.5?t["26-50%"]++:r<=.75?t["51-75%"]++:r<=.99?t["76-99%"]++:t["100%"]++}function D(r,t,a){r&&r.trim()!==""&&(a[r]||(a[r]={totalPercent:0,count:0,average:"0"}),a[r].totalPercent+=t,a[r].count++)}function B(r,t,a){const i=r["Camp victorieux"],o=r.Récolte,l=r["Total récolte"],s=r["Pourcentage de récolte"];o!=null&&!isNaN(o)&&(a.totalHarvest+=o),l!=null&&!isNaN(l)&&(a.totalMaxHarvest+=l),s!=null&&!isNaN(s)&&(t.gamesWithHarvest++,W(s,t.harvestDistribution),D(i,s,t.harvestByWinner))}function F(r,t){r.gamesWithHarvest>0&&(t.totalMaxHarvest>0&&(r.averageHarvestPercent=(t.totalHarvest/t.totalMaxHarvest*100).toFixed(2)),r.averageHarvest=parseFloat((t.totalHarvest/r.gamesWithHarvest).toFixed(2)),Object.keys(r.harvestByWinner).forEach(a=>{const i=r.harvestByWinner[a];i.count>0&&(i.average=(i.totalPercent/i.count*100).toFixed(2))}))}function k(r){if(r.length===0)return null;const t=P(),a={totalHarvest:0,totalMaxHarvest:0};return r.forEach(o=>{B(o,t,a)}),F(t,a),{averageHarvest:t.averageHarvest,averageHarvestPercent:t.averageHarvestPercent,gamesWithHarvest:t.gamesWithHarvest,harvestDistribution:t.harvestDistribution,harvestByWinner:t.harvestByWinner}}function q(){const{data:r,isLoading:t,error:a}=f(k);return{harvestStats:r,isLoading:t,errorInfo:a}}const h=["#d32f2f","#f57c00","#fbc02d","#388e3c","#1976d2"];function E(){const{harvestStats:r,isLoading:t,errorInfo:a}=q(),{navigateToGameDetails:i}=u();if(t)return e.jsx("div",{className:"donnees-chargement",children:"Récupération des données de récolte..."});if(a)return e.jsxs("div",{className:"donnees-erreur",children:["Problème: ",a]});if(!r)return e.jsx("div",{className:"donnees-absentes",children:"Données de récolte non disponibles"});const o=r?[{nom:"0-25%",valeur:r.harvestDistribution["0-25%"]},{nom:"26-50%",valeur:r.harvestDistribution["26-50%"]},{nom:"51-75%",valeur:r.harvestDistribution["51-75%"]},{nom:"76-99%",valeur:r.harvestDistribution["76-99%"]},{nom:"100%",valeur:r.harvestDistribution["100%"]}]:[],l=r?Object.entries(r.harvestByWinner).map(([s,n])=>({camp:s,moyenne:parseFloat(n.average)})).sort((s,n)=>n.moyenne-s.moyenne):[];return e.jsxs("div",{className:"lycans-recolte-stats",children:[e.jsx("h2",{children:"Statistiques de Récolte"}),e.jsxs("div",{className:"lycans-recolte-sommaire",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Moyenne de Récolte"}),e.jsxs("p",{className:"lycans-nombre-grand",children:[r.averageHarvestPercent,"%"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Nombre total de parties"}),e.jsx("p",{className:"lycans-nombre-grand",children:r.gamesWithHarvest})]})]}),e.jsxs("div",{className:"lycans-graphiques-conteneur",children:[e.jsxs("div",{className:"lycans-graphique-moitie",children:[e.jsx("h3",{children:"Distribution des Récoltes"}),e.jsx("div",{style:{height:300},children:e.jsx(m,{width:"100%",height:"100%",children:e.jsxs(R,{children:[e.jsx(C,{data:o,cx:"50%",cy:"50%",labelLine:!0,label:({nom:s,percent:n})=>`${s}: ${((n??0)*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"valeur",nameKey:"nom",onClick:s=>{s&&s.nom&&i({selectedHarvestRange:s.nom,fromComponent:"Distribution des Récoltes"})},style:{cursor:"pointer"},children:o.map((s,n)=>e.jsx(d,{fill:h[n%h.length]},`cellule-${n}`))}),e.jsx(v,{content:({active:s,payload:n})=>{if(s&&n&&n.length>0){const c=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:c.nom})}),e.jsxs("div",{children:["Nombre de parties : ",c.valeur]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(M,{})]})})})]}),e.jsxs("div",{className:"lycans-graphique-moitie",children:[e.jsx("h3",{children:"Moyenne de Récolte au Moment de la Victoire"}),e.jsx(p,{title:"Moyenne de Récolte au Moment de la Victoire",children:e.jsx("div",{style:{height:300},children:e.jsx(m,{width:"100%",height:"100%",children:e.jsxs(y,{data:l,margin:{top:20,right:30,left:20,bottom:70},children:[e.jsx(j,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(b,{label:{value:"Moyenne de Récolte (%)",angle:-90,position:"insideLeft"}}),e.jsx(v,{content:({active:s,payload:n})=>{if(s&&n&&n.length>0){const c=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:c.camp}),e.jsxs("div",{children:["Moyenne de Récolte : ",c.moyenne,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(N,{dataKey:"moyenne",name:"Moyenne de Récolte",onClick:s=>{s&&s.camp&&i({selectedCamp:s.camp,campFilterMode:"wins-only",fromComponent:"Moyenne de Récolte par Camp"})},style:{cursor:"pointer"},children:l.map(s=>e.jsx(d,{fill:x[s.camp]||g},`cell-${s.camp}`))})]})})})})]})]})]})}export{E as HarvestProgressChart};
