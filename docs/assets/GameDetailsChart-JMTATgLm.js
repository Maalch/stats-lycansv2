import{r as y,u as S,j as s}from"./index-CMhG7aNy.js";import{u as P,a as E,b as I}from"./useRawGameData-B19HQYHR.js";import{a as w}from"./api-beq3FXpM.js";function B(a){const{data:u,isLoading:m,error:N}=P(),{data:h,isLoading:x,error:f}=E(),{data:p,isLoading:C,error:j}=I();return{data:y.useMemo(()=>{if(!u||!h||!p)return[];let r=[...u];return a&&(a.selectedPlayer&&(r=r.filter(l=>l["Liste des joueurs"].toLowerCase().includes(a.selectedPlayer.toLowerCase()))),a.selectedGame&&(r=r.filter(l=>l.Game===a.selectedGame)),a.selectedCamp&&(r=r.filter(l=>{if(a.selectedPlayer){const e=h.find(c=>c.Game===l.Game);if(!e)return console.log(`DEBUG: No role data found for game ${l.Game}`),!1;const n=a.selectedPlayer.toLowerCase();return console.log(`DEBUG: Checking game ${l.Game} for player "${n}" in camp "${a.selectedCamp}"`),console.log("DEBUG: Role data:",{Loups:e.Loups,Traître:e.Traître,"Idiot du village":e["Idiot du village"],Cannibale:e.Cannibale,Agent:e.Agent,Espion:e.Espion,Scientifique:e.Scientifique,Amoureux:e.Amoureux,"La Bête":e["La Bête"],"Chasseur de primes":e["Chasseur de primes"],Vaudou:e.Vaudou}),e.Loups&&e.Loups.toLowerCase().includes(n)?(console.log(`DEBUG: Player found in Loups, checking against ${a.selectedCamp}`),a.selectedCamp==="Loups"):e.Traître&&e.Traître.toLowerCase().includes(n)?(console.log(`DEBUG: Player found as Traître, checking against ${a.selectedCamp}`),a.selectedCamp==="Traître"):e["Idiot du village"]&&e["Idiot du village"].toLowerCase().includes(n)?(console.log(`DEBUG: Player found as Idiot du village, checking against ${a.selectedCamp}`),a.selectedCamp==="Idiot du Village"):e.Cannibale&&e.Cannibale.toLowerCase().includes(n)?(console.log(`DEBUG: Player found as Cannibale, checking against ${a.selectedCamp}`),a.selectedCamp==="Cannibale"):e.Agent&&e.Agent.toLowerCase().includes(n)?(console.log(`DEBUG: Player found as Agent, checking against ${a.selectedCamp}`),a.selectedCamp==="Agent"):e.Espion&&e.Espion.toLowerCase().includes(n)?(console.log(`DEBUG: Player found as Espion, checking against ${a.selectedCamp}`),a.selectedCamp==="Espion"):e.Scientifique&&e.Scientifique.toLowerCase().includes(n)?(console.log(`DEBUG: Player found as Scientifique, checking against ${a.selectedCamp}`),a.selectedCamp==="Scientifique"):e.Amoureux&&e.Amoureux.toLowerCase().includes(n)?(console.log(`DEBUG: Player found in Amoureux, checking against ${a.selectedCamp}`),a.selectedCamp==="Amoureux"):e["La Bête"]&&e["La Bête"].toLowerCase().includes(n)?(console.log(`DEBUG: Player found as La Bête, checking against ${a.selectedCamp}`),a.selectedCamp==="La Bête"):e["Chasseur de primes"]&&e["Chasseur de primes"].toLowerCase().includes(n)?(console.log(`DEBUG: Player found as Chasseur de primes, checking against ${a.selectedCamp}`),a.selectedCamp==="Chasseur de primes"):e.Vaudou&&e.Vaudou.toLowerCase().includes(n)?(console.log(`DEBUG: Player found as Vaudou, checking against ${a.selectedCamp}`),a.selectedCamp==="Vaudou"):l["Liste des joueurs"].toLowerCase().includes(n)?(console.log(`DEBUG: Player found as regular Villageois, checking against ${a.selectedCamp}`),a.selectedCamp==="Villageois"):(console.log(`DEBUG: Player "${n}" not found in game ${l.Game}`),!1)}else return l["Camp victorieux"]===a.selectedCamp})),a.selectedVictoryType&&(r=r.filter(l=>l["Type de victoire"]===a.selectedVictoryType)),a.selectedDate&&(r=r.filter(l=>{const e=l.Date;if(a.selectedDate.includes("/")&&a.selectedDate.split("/").length===2){const[n,t]=a.selectedDate.split("/"),c=e.split("/");if(c.length===3){const[,g,b]=c;return g===n&&b===t}}else return e===a.selectedDate;return!1}))),r.map(l=>{const e=h.find(i=>i.Game===l.Game),n=p.filter(i=>i.Game===l.Game),t={};e&&(e.Loups&&(t.wolves=e.Loups.split(", ").filter(Boolean)),e.Traître&&(t.traitor=e.Traître),e["Idiot du village"]&&(t.villageIdiot=e["Idiot du village"]),e.Cannibale&&(t.cannibal=e.Cannibale),e.Agent&&(t.agent=e.Agent),e.Espion&&(t.spy=e.Espion),e.Scientifique&&(t.scientist=e.Scientifique),e.Amoureux&&(t.lovers=e.Amoureux.split(", ").filter(Boolean)),e["La Bête"]&&(t.beast=e["La Bête"]),e["Chasseur de primes"]&&(t.bountyHunter=e["Chasseur de primes"]),e.Vaudou&&(t.voodoo=e.Vaudou));const c=n.map(i=>({player:"Ponce",camp:i.Camp||"Unknown",isTraitor:i.Traître||!1,secondaryRole:i["Rôle secondaire"],wolfPower:i["Pouvoir de loup"],villagerJob:i["Métier villageois"],playersKilled:i["Joueurs tués"],deathDay:i["Jour de mort"],deathType:i["Type de mort"],killers:i["Joueurs tueurs"]})),g=[],b=l["Liste des joueurs"].split(", ").filter(Boolean),T=l["Liste des gagnants"].split(", ").filter(Boolean);return b.forEach(i=>{let o="Villageois",d="Villageois";const G=T.includes(i);e&&(e.Loups&&e.Loups.split(", ").includes(i)?(o="Loup-Garou",d="Loups"):e.Traître&&e.Traître===i?(o="Traître",d="Traître"):e["Idiot du village"]&&e["Idiot du village"]===i?(o="Idiot du village",d="Idiot du Village"):e.Cannibale&&e.Cannibale===i?(o="Cannibale",d="Cannibale"):e.Agent&&e.Agent===i?(o="Agent",d="Agent"):e.Espion&&e.Espion===i?(o="Espion",d="Espion"):e.Scientifique&&e.Scientifique===i?(o="Scientifique",d="Scientifique"):e["La Bête"]&&e["La Bête"]===i?(o="La Bête",d="La Bête"):e["Chasseur de primes"]&&e["Chasseur de primes"]===i?(o="Chasseur de primes",d="Chasseur de primes"):e.Vaudou&&e.Vaudou===i&&(o="Vaudou",d="Vaudou"),e.Amoureux&&e.Amoureux.split(", ").includes(i)&&(o==="Villageois"?o="Amoureux":o=`${o} (Amoureux)`,G&&l["Camp victorieux"]==="Amoureux"&&(d="Amoureux"))),g.push({player:i,role:o,camp:d,isAlive:G})}),{gameId:l.Game,date:l.Date,isModded:l["Game Moddée"],playerCount:l["Nombre de joueurs"],wolfCount:l["Nombre de loups"],hasTraitor:l["Rôle Traître"],hasLovers:l["Rôle Amoureux"],soloRoles:l["Rôles solo"],winningCamp:l["Camp victorieux"],victoryType:l["Type de victoire"],dayCount:l["Nombre de journées"],villagerSurvivors:l["Survivants villageois"],wolfSurvivors:l["Survivants loups (traître inclus)"],loverSurvivors:l["Survivants amoureux"],soloSurvivors:l["Survivants solo"],winners:l["Liste des gagnants"],harvest:l.Récolte,totalHarvest:l["Total récolte"],harvestPercentage:l["Pourcentage de récolte"],playersList:l["Liste des joueurs"],versions:l.Versions,map:l.Map,startTime:l.Début,endTime:l.Fin,roles:t,playerRoles:g,playerDetails:c}})},[u,h,p,a]),isLoading:m||x||C,error:N||f||j}}function U(){const{navigationFilters:a,navigateBack:u}=S(),{data:m,isLoading:N,error:h}=B(a),[x,f]=y.useState("date"),[p,C]=y.useState("desc"),[j,L]=y.useState(null),D=y.useMemo(()=>m?[...m].sort((e,n)=>{let t,c;switch(x){case"date":t=new Date(e.date.split("/").reverse().join("-")).getTime(),c=new Date(n.date.split("/").reverse().join("-")).getTime();break;case"gameId":t=e.gameId,c=n.gameId;break;case"playerCount":t=e.playerCount,c=n.playerCount;break;case"dayCount":t=e.dayCount,c=n.dayCount;break;case"winningCamp":t=e.winningCamp,c=n.winningCamp;break;case"victoryType":t=e.victoryType,c=n.victoryType;break;default:return 0}return p==="asc"?t>c?1:-1:t<c?1:-1}):[],[m,x,p]),v=e=>{x===e?C(p==="asc"?"desc":"asc"):(f(e),C("desc"))},r=e=>x!==e?"↕️":p==="asc"?"↗️":"↘️",l=()=>{const e=[];return a.selectedPlayer&&a.selectedCamp?e.push(`${a.selectedPlayer} jouant ${a.selectedCamp}`):(a.selectedPlayer&&e.push(`Joueur: ${a.selectedPlayer}`),a.selectedCamp&&e.push(`Camp: ${a.selectedCamp}`)),a.selectedVictoryType&&e.push(`Victoire: ${a.selectedVictoryType}`),a.selectedGame&&e.push(`Partie #${a.selectedGame}`),a.selectedDate&&(a.selectedDate.includes("/")&&a.selectedDate.split("/").length===2?e.push(`Mois: ${a.selectedDate}`):e.push(`Date: ${a.selectedDate}`)),e};return N?s.jsx("div",{className:"statistiques-chargement",children:"Chargement des détails des parties..."}):h?s.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",h]}):!m||m.length===0?s.jsxs("div",{className:"lycans-empty-section",children:[s.jsx("h2",{children:"Aucune partie trouvée"}),s.jsx("p",{children:"Aucune partie ne correspond aux critères sélectionnés."}),a.fromComponent&&s.jsxs("button",{onClick:u,className:"lycans-submenu-btn",style:{marginTop:"1rem"},children:["← Retour à ",a.fromComponent]})]}):s.jsxs("div",{className:"lycans-game-details",children:[s.jsxs("div",{className:"lycans-game-details-header",children:[s.jsxs("div",{className:"lycans-game-details-navigation",children:[a.fromComponent&&s.jsxs("button",{onClick:u,className:"lycans-submenu-btn",style:{marginRight:"1rem"},children:["← Retour à ",a.fromComponent]}),s.jsxs("h2",{children:["Détails des Parties (",m.length," partie",m.length>1?"s":"",")"]})]}),l().length>0&&s.jsxs("div",{className:"lycans-active-filters",children:[s.jsx("strong",{children:"Filtres actifs:"})," ",l().join(", ")]})]}),s.jsx("div",{className:"lycans-games-table-container",children:s.jsxs("table",{className:"lycans-games-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsxs("th",{onClick:()=>v("gameId"),className:"sortable",children:["Partie ",r("gameId")]}),s.jsxs("th",{onClick:()=>v("date"),className:"sortable",children:["Date ",r("date")]}),s.jsxs("th",{onClick:()=>v("playerCount"),className:"sortable",children:["Joueurs ",r("playerCount")]}),s.jsxs("th",{onClick:()=>v("dayCount"),className:"sortable",children:["Jours ",r("dayCount")]}),s.jsxs("th",{onClick:()=>v("winningCamp"),className:"sortable",children:["Camp Vainqueur ",r("winningCamp")]}),s.jsxs("th",{onClick:()=>v("victoryType"),className:"sortable",children:["Type de Victoire ",r("victoryType")]}),s.jsx("th",{children:"Détails"})]})}),s.jsx("tbody",{children:D.map(e=>s.jsxs(s.Fragment,{children:[s.jsxs("tr",{className:j===e.gameId?"selected":"",children:[s.jsxs("td",{children:["#",e.gameId]}),s.jsx("td",{children:e.date}),s.jsx("td",{children:e.playerCount}),s.jsx("td",{children:e.dayCount}),s.jsx("td",{style:{color:w[e.winningCamp]||"#fff"},children:e.winningCamp}),s.jsx("td",{children:e.victoryType}),s.jsx("td",{children:s.jsx("button",{onClick:()=>L(j===e.gameId?null:e.gameId),className:"lycans-details-btn",children:j===e.gameId?"Masquer":"Voir"})})]},e.gameId),j===e.gameId&&s.jsx("tr",{className:"game-details-row",children:s.jsx("td",{colSpan:7,children:s.jsx(A,{game:e})})},`${e.gameId}-details`)]}))})]})})]})}function A({game:a}){return s.jsx("div",{className:"lycans-game-detail-view",children:s.jsxs("div",{className:"lycans-game-detail-grid",children:[s.jsxs("div",{className:"lycans-game-detail-section",children:[s.jsx("h4",{children:"Informations Générales"}),s.jsxs("div",{className:"lycans-game-detail-stats",children:[s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Partie moddée:"}),s.jsx("span",{className:"value",children:a.isModded?"Oui":"Non"})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Nombre de loups:"}),s.jsx("span",{className:"value",children:a.wolfCount})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Traître:"}),s.jsx("span",{className:"value",children:a.hasTraitor?"Oui":"Non"})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Amoureux:"}),s.jsx("span",{className:"value",children:a.hasLovers?"Oui":"Non"})]}),a.soloRoles&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Rôles solo:"}),s.jsx("span",{className:"value",children:a.soloRoles})]})]})]}),s.jsxs("div",{className:"lycans-game-detail-section",children:[s.jsx("h4",{children:"Informations Supplémentaires"}),s.jsxs("div",{className:"lycans-game-detail-stats",children:[a.versions&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Version:"}),s.jsx("span",{className:"value",children:a.versions})]}),a.map&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Map:"}),s.jsx("span",{className:"value",children:a.map})]}),a.startTime&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Début:"}),s.jsx("span",{className:"value",children:a.startTime})]}),a.endTime&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Fin:"}),s.jsx("span",{className:"value",children:a.endTime})]})]})]}),s.jsxs("div",{className:"lycans-game-detail-section",children:[s.jsx("h4",{children:"Résultats"}),s.jsxs("div",{className:"lycans-game-detail-stats",children:[s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Survivants villageois:"}),s.jsx("span",{className:"value",children:a.villagerSurvivors})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Survivants loups:"}),s.jsx("span",{className:"value",children:a.wolfSurvivors})]}),a.loverSurvivors!==null&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Survivants amoureux:"}),s.jsx("span",{className:"value",children:a.loverSurvivors})]}),a.soloSurvivors!==null&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Survivants solo:"}),s.jsx("span",{className:"value",children:a.soloSurvivors})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Gagnants:"}),s.jsx("span",{className:"value",children:a.winners})]})]})]}),a.harvest!==null&&s.jsxs("div",{className:"lycans-game-detail-section",children:[s.jsx("h4",{children:"Récolte"}),s.jsxs("div",{className:"lycans-game-detail-stats",children:[s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Récolte:"}),s.jsx("span",{className:"value",children:a.harvest})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Total possible:"}),s.jsx("span",{className:"value",children:a.totalHarvest})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Pourcentage:"}),s.jsx("span",{className:"value",children:typeof a.harvestPercentage=="number"?(a.harvestPercentage*100).toFixed(1)+"%":"N/A"})]})]})]}),s.jsxs("div",{className:"lycans-game-detail-section full-width",children:[s.jsx("h4",{children:"Rôles des Joueurs"}),s.jsx("div",{className:"lycans-player-roles-grid",children:a.playerRoles.map((u,m)=>s.jsxs("div",{className:"lycans-player-role-item",children:[s.jsx("div",{className:"lycans-player-name",style:{color:w[u.camp]||"#fff"},children:u.player}),s.jsx("div",{className:"lycans-player-role",children:u.role}),s.jsx("div",{className:"lycans-player-camp",children:u.camp})]},m))})]})]})})}export{U as GameDetailsChart};
