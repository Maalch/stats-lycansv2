import{r as o,j as e}from"./index-4tou-POj.js";import{g as C}from"./api-CzvsImqf.js";import{R as g,B as j,C as v,X as f,Y as P,T as m,a as b,b as S}from"./BarChart-6QfMPLFR.js";import{P as D,a as E}from"./PieChart-Dv19LXYp.js";import{L as w}from"./Legend-Bffo_Voq.js";function A(){const[t,x]=o.useState(null),[c,i]=o.useState(!0),[d,u]=o.useState(null);return o.useEffect(()=>{(async()=>{try{i(!0),u(null);const l=await fetch("https://script.google.com/macros/s/AKfycbxrhG1mb7N6q7Mg88ogw0mirXgSihPpNPurZwiEOy9miG24Cc3AlGZCn2uoGnygNhck/exec?action=playerStats");if(!l.ok)throw new Error(`Erreur API: ${l.status}`);const h=await l.json();x(h)}catch(n){console.error("Erreur lors de la récupération des statistiques des joueurs:",n),u(n instanceof Error?n.message:"Erreur inconnue")}finally{i(!1)}})()},[]),{playerStatsData:t,dataLoading:c,fetchError:d}}function q(){const{playerStatsData:t,dataLoading:x,fetchError:c}=A(),[i,d]=o.useState(null);if(x)return e.jsx("div",{className:"donnees-attente",children:"Récupération des statistiques des joueurs..."});if(c)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",c]});if(!t)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de joueur disponible"});const u=t.playerStats.filter(a=>a.gamesPlayed>2).sort((a,s)=>s.gamesPlayed-a.gamesPlayed).slice(0,20),y=t.playerStats.filter(a=>a.gamesPlayed>=5).sort((a,s)=>parseFloat(s.winPercent)-parseFloat(a.winPercent)).slice(0,20),n=a=>{const s=t.playerStats.find(r=>r.player===a);return s?Object.entries(s.camps).filter(([r,p])=>p>0).map(([r,p])=>({name:r,value:p,percentage:(p/s.gamesPlayed*100).toFixed(1)})):[]},l={Villageois:"#4CAF50",Loups:"#F44336",Traître:"#9C27B0","Idiot du Village":"#FF9800",Cannibale:"#795548",Agent:"#2196F3",Espion:"#607D8B",Scientifique:"#00BCD4",Amoureux:"#E91E63","La Bête":"#673AB7","Chasseur de primes":"#FFC107",Vaudou:"#3F51B5"},h=i?n(i):[];return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques des Joueurs"}),e.jsxs("p",{className:"lycans-stats-info",children:["Total de ",t.totalGames," parties analysées avec ",t.playerStats.length," joueurs"]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Participations"}),e.jsx("div",{style:{height:400},children:e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(j,{data:u,margin:{top:20,right:30,left:20,bottom:70},children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(f,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(P,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(m,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const r=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:r.player})}),e.jsxs("div",{children:["Parties jouées : ",r.gamesPlayed]}),e.jsxs("div",{children:["Pourcentage : ",r.gamesPlayedPercent,"%"]})]})}return null}}),e.jsx(b,{dataKey:"gamesPlayed",name:"Parties jouées",fill:"var(--chart-color-2)",onClick:a=>d(a?.payload?.player)})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Meilleurs Taux de Victoire (min. 5 parties)"}),e.jsx("div",{style:{height:400},children:e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(j,{data:y,margin:{top:20,right:30,left:20,bottom:70},children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(f,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(P,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(m,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const r=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:r.player})}),e.jsxs("div",{children:["Taux de victoire : ",r.winPercent,"%"]}),e.jsxs("div",{children:["Victoires : ",r.wins," / ",r.gamesPlayed]})]})}return null}}),e.jsx(b,{dataKey:"winPercent",name:"Taux de Victoire",fill:"var(--chart-color-5)",onClick:a=>d(a?.payload?.player)})]})})})]})]}),i&&e.jsxs("div",{className:"lycans-graphique-section lycans-joueur-details",children:[e.jsxs("h3",{children:["Distribution des Camps - ",i]}),e.jsx("div",{style:{height:300},children:e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(D,{children:[e.jsx(E,{data:h,cx:"50%",cy:"50%",labelLine:!0,outerRadius:80,fill:"#8884d8",dataKey:"value",nameKey:"name",label:({name:a,percentage:s})=>`${a}: ${s}%`,children:h.map((a,s)=>e.jsx(S,{fill:l[a.name]||C(a.name)},`cell-${s}`))}),e.jsx(m,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const r=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:r.name})}),e.jsxs("div",{children:[r.value," parties (",r.percentage,"%)"]})]})}return null}}),e.jsx(w,{})]})})})]})]})}export{q as PlayersGeneralStatisticsChart};
