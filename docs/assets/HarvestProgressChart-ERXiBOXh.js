import{u as y,j as e}from"./index-Cbr1N9_I.js";import{b as j,l as H}from"./api-C7OdInaB.js";import{a as b}from"./baseStatsHook-EXX5rNHU.js";import{g as N}from"./gameUtils-rkfcKAVy.js";import{F as R,C,X as W,Y as M}from"./FullscreenChart-C5QfkgM5.js";import{R as v,T as h,a as D}from"./CategoricalChart-PQulR3sc.js";import{P,a as F}from"./PieChart-B6xyEG-h.js";import{B,a as A}from"./BarChart-C8pBLbb-.js";import"./datasyncExport-BirWLS1z.js";import"./PolarChart-D7Ze0W6q.js";function k(){return{averageHarvest:0,averageHarvestPercent:"0",gamesWithHarvest:0,harvestDistribution:{"0-25%":0,"26-50%":0,"51-75%":0,"76-99%":0,"100%":0},harvestByWinner:{}}}function z(t,r){t<=.25?r["0-25%"]++:t<=.5?r["26-50%"]++:t<=.75?r["51-75%"]++:t<=.99?r["76-99%"]++:r["100%"]++}function q(t,r,n){t&&t.trim()!==""&&(n[t]||(n[t]={totalPercent:0,count:0,average:"0"}),n[t].totalPercent+=r,n[t].count++)}function G(t,r,n){const i=t.HarvestDone,o=t.HarvestGoal,c=o>0?i/o:0;let d=N(t);i!=null&&!isNaN(i)&&(n.totalHarvest+=i),o!=null&&!isNaN(o)&&(n.totalMaxHarvest+=o),c!=null&&!isNaN(c)&&(r.gamesWithHarvest++,z(c,r.harvestDistribution),q(d,c,r.harvestByWinner))}function S(t,r){t.gamesWithHarvest>0&&(r.totalMaxHarvest>0&&(t.averageHarvestPercent=(r.totalHarvest/r.totalMaxHarvest*100).toFixed(2)),t.averageHarvest=parseFloat((r.totalHarvest/t.gamesWithHarvest).toFixed(2)),Object.keys(t.harvestByWinner).forEach(n=>{const i=t.harvestByWinner[n];i.count>0&&(i.average=(i.totalPercent/i.count*100).toFixed(2))}))}function T(t){if(t.length===0)return null;const r=k(),n={totalHarvest:0,totalMaxHarvest:0};return t.forEach(o=>{G(o,r,n)}),S(r,n),{averageHarvest:r.averageHarvest,averageHarvestPercent:r.averageHarvestPercent,gamesWithHarvest:r.gamesWithHarvest,harvestDistribution:r.harvestDistribution,harvestByWinner:r.harvestByWinner}}function K(){const{data:t,isLoading:r,error:n}=b(T);return{harvestStats:t,isLoading:r,errorInfo:n}}const u=["#d32f2f","#f57c00","#fbc02d","#388e3c","#1976d2"];function Q(){const{harvestStats:t,isLoading:r,errorInfo:n}=K(),{navigateToGameDetails:i}=y(),o=j();if(r)return e.jsx("div",{className:"donnees-chargement",children:"RÃ©cupÃ©ration des donnÃ©es de rÃ©colte..."});if(n)return e.jsxs("div",{className:"donnees-erreur",children:["ProblÃ¨me: ",n]});if(!t)return e.jsx("div",{className:"donnees-absentes",children:"DonnÃ©es de rÃ©colte non disponibles"});const c=t?[{nom:"0-25%",valeur:t.harvestDistribution["0-25%"]},{nom:"26-50%",valeur:t.harvestDistribution["26-50%"]},{nom:"51-75%",valeur:t.harvestDistribution["51-75%"]},{nom:"76-99%",valeur:t.harvestDistribution["76-99%"]},{nom:"100%",valeur:t.harvestDistribution["100%"]}]:[],d=t?Object.entries(t.harvestByWinner).map(([s,a])=>({camp:s,moyenne:parseFloat(a.average)})).sort((s,a)=>a.moyenne-s.moyenne):[];return e.jsxs("div",{className:"lycans-recolte-stats",children:[e.jsx("h2",{children:"Statistiques de RÃ©colte"}),e.jsxs("div",{className:"lycans-recolte-sommaire",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Moyenne de RÃ©colte"}),e.jsxs("p",{className:"lycans-nombre-grand",children:[t.averageHarvestPercent,"%"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Nombre total de parties"}),e.jsx("p",{className:"lycans-nombre-grand",children:t.gamesWithHarvest})]})]}),e.jsxs("div",{className:"lycans-graphiques-conteneur",children:[e.jsxs("div",{className:"lycans-graphique-moitie",children:[e.jsx("h3",{children:"Distribution des RÃ©coltes"}),e.jsx("div",{style:{height:300},children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(P,{children:[e.jsx(F,{data:c.map((s,a)=>({...s,fill:u[a%u.length]})),cx:"50%",cy:"50%",labelLine:!0,label:s=>`${s.nom}: ${((s.percent??0)*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",onClick:s=>{s&&s.nom&&i({selectedHarvestRange:s.nom,fromComponent:"Distribution des RÃ©coltes"})},style:{cursor:"pointer"},dataKey:"valeur",nameKey:"nom"}),e.jsx(h,{content:({active:s,payload:a})=>{if(s&&a&&a.length>0){const l=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:l.nom})}),e.jsxs("div",{children:["Nombre de parties : ",l.valeur]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-moitie",children:[e.jsx("h3",{children:"Moyenne de RÃ©colte au Moment de la Victoire"}),e.jsx(R,{title:"Moyenne de RÃ©colte au Moment de la Victoire",children:e.jsx("div",{style:{height:400},children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(B,{data:d,margin:{top:20,right:30,left:20,bottom:40},children:[e.jsx(C,{strokeDasharray:"3 3"}),e.jsx(W,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:s,y:a,payload:l})=>e.jsx("text",{x:s,y:a,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,transform:`rotate(-45 ${s} ${a})`,children:l.value})}),e.jsx(M,{label:{value:"Moyenne de RÃ©colte (%)",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(h,{content:({active:s,payload:a})=>{if(s&&a&&a.length>0){const l=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:l.camp}),e.jsxs("div",{children:["Moyenne de RÃ©colte : ",l.moyenne,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(A,{dataKey:"moyenne",name:"Moyenne de RÃ©colte",style:{cursor:"pointer"},shape:s=>{const{x:a,y:l,width:x,height:g,payload:f}=s,m=f,p=o[m.camp]||H;return e.jsx(D,{x:a,y:l,width:x,height:g,fill:p,onClick:()=>{i({campFilter:{selectedCamp:m.camp,campFilterMode:"wins-only"},fromComponent:"Moyenne de RÃ©colte par Camp"})},style:{cursor:"pointer"}})}})]})})})})]})]})]})}export{Q as HarvestProgressChart};
