import{f as G,u as W,r as C,j as e}from"./index-BI7qZdO0.js";import{u as L}from"./baseStatsHook-B9JXGa7Y.js";import{u as V}from"./usePlayerStatsFromRaw-Dg-1FEqb.js";import{l as E,a as F}from"./api-DmJeUsCZ.js";import{F as T,C as M,X as N,Y as k,B as $,a as A,b as P}from"./FullscreenChart-BBgP-E1r.js";import{R as S,T as R}from"./CategoricalChart-NuGy6rbA.js";import{L as B,a as H}from"./LineChart-Q1Rv9wOI.js";import{P as K,a as J}from"./PieChart-BYMCNxvI.js";import"./ActivePoints-DzXrIL-d.js";import"./PolarChart-3KNd2j7o.js";function _(o){const m=o.PlayerStats.find(p=>p.Victorious);return m?m.MainRoleInitial:"Unknown"}function O(o,m){if(o.trim()===""||m.length===0)return null;const p=[];m.forEach(n=>{const i=n.PlayerStats.find(x=>x.Username.toLowerCase()===o.toLowerCase());if(i){const x=i.MainRoleInitial,f=_(n),v=i.Victorious,b=G(new Date(n.StartDate));p.push({gameId:n.Id,date:b,camp:x,won:v,winnerCamp:f,playersInGame:n.PlayerStats.length})}}),p.sort((n,i)=>{const x=f=>{const v=f.split("/");return v.length===3?new Date(parseInt(v[2]),parseInt(v[1])-1,parseInt(v[0])):new Date(f)};return x(i.date).getTime()-x(n.date).getTime()});const s=p.length,c=p.filter(n=>n.won).length,D=s>0?(c/s*100).toFixed(2):"0.00",u={};return p.forEach(n=>{u[n.camp]||(u[n.camp]={appearances:0,wins:0,winRate:"0.00"}),u[n.camp].appearances++,n.won&&u[n.camp].wins++}),Object.keys(u).forEach(n=>{const i=u[n];i.winRate=i.appearances>0?(i.wins/i.appearances*100).toFixed(2):"0.00"}),{playerName:o,totalGames:s,totalWins:c,winRate:D,games:p,campStats:u}}function X(o){const{data:m,isLoading:p,error:s}=L(c=>O(o,c));return{data:m,isLoading:p,error:s}}function oe(){const{navigateToGameDetails:o,navigationState:m,updateNavigationState:p}=W(),s=m.selectedPlayerName||"Ponce",c=m.groupingMethod||"session",D=r=>{p({selectedPlayerName:r})},u=r=>{p({groupingMethod:r})},{data:n}=V(),{data:i,isLoading:x,error:f}=X(s),v=C.useMemo(()=>n?.playerStats?n.playerStats.filter(r=>r.gamesPlayed>0).map(r=>r.player).sort():["Ponce"],[n]),b=C.useMemo(()=>{if(!i?.games)return new Map;const r=new Map;return i.games.forEach(a=>{if(!r.has(a.date)){const t=a.date.split("/");t.length===3?r.set(a.date,new Date(parseInt(t[2]),parseInt(t[1])-1,parseInt(t[0])).getTime()):r.set(a.date,new Date(a.date).getTime())}}),r},[i?.games]),y=C.useMemo(()=>{if(!i?.games)return[];const r={};return i.games.forEach(a=>{let t;if(c==="month"){const l=a.date.split("/");l.length===3?t=`${l[1]}/${l[2]}`:t=a.date}else t=a.date;r[t]||(r[t]={games:[],wins:0,total:0}),r[t].games.push(a),r[t].total++,a.won&&r[t].wins++}),Object.entries(r).map(([a,t])=>({period:a,totalGames:t.total,victories:t.wins,defeats:t.total-t.wins,winRate:t.total>0?(t.wins/t.total*100).toFixed(1):"0.0",winRateNum:t.total>0?t.wins/t.total*100:0})).sort((a,t)=>{if(c==="month"){const[l,d]=a.period.split("/"),[h,w]=t.period.split("/"),q=new Date(parseInt(d),parseInt(l)-1,1),I=new Date(parseInt(w),parseInt(h)-1,1);return q.getTime()-I.getTime()}else{const l=b.get(a.period)||0,d=b.get(t.period)||0;return l-d}})},[i,c,b]),j=C.useMemo(()=>i?.campStats?Object.entries(i.campStats).map(([r,a])=>({name:r,value:a.appearances,winRate:a.winRate,winRateDisplay:Math.max(parseFloat(a.winRate),1),wins:a.wins,percentage:(a.appearances/i.totalGames*100).toFixed(1)})):[],[i]),z=C.useMemo(()=>{if(!j.length)return[];const r=5;let a=0;const t=[],l=[];if(j.forEach(d=>{parseFloat(d.percentage)<r?(a+=Number(d.value),t.push(d)):l.push(d)}),a>0){const d=j.reduce((h,w)=>h+Number(w.value),0);l.push({name:"Autres",value:a,winRate:"0.0",wins:t.reduce((h,w)=>h+w.wins,0),percentage:(a/d*100).toFixed(1),_details:t})}return l},[j]),g=(r=>r<=15?{fontSize:11,angle:-45,height:80,interval:0}:r<=30?{fontSize:10,angle:-45,height:85,interval:1}:r<=50?{fontSize:9,angle:-60,height:95,interval:2}:{fontSize:8,angle:-75,height:105,interval:Math.floor(r/12)})(y.length);return x?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):f?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",f]}):i?e.jsxs("div",{className:"lycans-player-history",children:[e.jsx("h2",{children:"Historique Détaillé d'un Joueur"}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Joueur:"}),e.jsx("select",{id:"player-select",value:s,onChange:r=>D(r.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:v.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:c,onChange:r=>u(r.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"})]})]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{o({selectedPlayer:s,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${s}`,children:i.totalGames}),e.jsx("p",{children:"parties jouées"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{o({selectedPlayer:s,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${s}`,children:i.totalWins}),e.jsx("p",{children:"parties gagnées"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",children:[i.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Évolution des Performances ",c==="month"?"par Mois":"par Session"]}),e.jsx(T,{title:`Évolution des Performances ${c==="month"?"par Mois":"par Session"}`,children:e.jsx("div",{style:{height:400},children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(B,{data:y,margin:{top:20,right:30,left:20,bottom:60},onClick:r=>{if(r&&r.activeLabel){const a=y.find(t=>t.period===r.activeLabel);a&&o({selectedPlayer:s,selectedDate:a.period,fromComponent:`Évolution des Performances ${c==="month"?"par Mois":"par Session"}`})}},style:{cursor:"pointer"},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"period",angle:g.angle,textAnchor:"end",height:g.height,interval:g.interval,fontSize:g.fontSize}),e.jsx(k,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(R,{content:({active:r,payload:a})=>{if(r&&a&&a.length>0){const t=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:t.period})}),e.jsxs("div",{children:["Parties: ",t.totalGames]}),e.jsxs("div",{children:["Victoires: ",t.victories]}),e.jsxs("div",{children:["Taux: ",t.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(H,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Répartition Victoires/Défaites ",c==="month"?"par Mois":"par Session"]}),e.jsx(T,{title:`Répartition Victoires/Défaites ${c==="month"?"par Mois":"par Session"}`,children:e.jsx("div",{style:{height:400},children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs($,{data:y,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"period",angle:g.angle,textAnchor:"end",height:g.height,interval:g.interval,fontSize:g.fontSize}),e.jsx(k,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"},allowDecimals:!1}),e.jsx(R,{content:({active:r,payload:a})=>{if(r&&a&&a.length>0){const t=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:t.period})}),e.jsxs("div",{children:["Total: ",t.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",t.victories]}),e.jsxs("div",{children:["Défaites: ",t.defeats]}),e.jsxs("div",{children:["Taux: ",t.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(A,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:y.map((r,a)=>e.jsx(P,{fill:"var(--accent-tertiary)",onClick:()=>{o({selectedPlayer:s,selectedDate:r.period,fromComponent:`Historique Joueur - Victoires ${c==="month"?"par Mois":"par Session"}`})},style:{cursor:"pointer"}},`cell-victories-${a}`))}),e.jsx(A,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"Défaites",children:y.map((r,a)=>e.jsx(P,{fill:"var(--chart-color-4)",onClick:()=>{o({selectedPlayer:s,selectedDate:r.period,fromComponent:`Historique Joueur - Défaites ${c==="month"?"par Mois":"par Session"}`})},style:{cursor:"pointer"}},`cell-defeats-${a}`))})]})})})})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(K,{children:[e.jsx(J,{data:z,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:({name:r,value:a,percent:t})=>{const l=t!==void 0?t:0;return r==="Autres"?`Autres : ${a} (${(l*100).toFixed(1)}%)`:`${r}: ${a} (${(l*100).toFixed(1)}%)`},children:z.map((r,a)=>e.jsx(P,{fill:r.name==="Autres"?E:F[r.name]||`var(--chart-color-${a%6+1})`,onClick:()=>{if(r.name==="Autres"){const t=r._details?.map(l=>l.name)||[];o({selectedPlayer:s,campFilter:{selectedCamp:"Autres",campFilterMode:"wins-only",_smallCamps:t},fromComponent:"Distribution par Camps"})}else r.name==="Traître"?o({selectedPlayer:s,campFilter:{selectedCamp:"Traître",campFilterMode:"wins-only",excludeTraitor:!0},fromComponent:"Distribution par Camps"}):r.name==="Loup"?o({selectedPlayer:s,campFilter:{selectedCamp:"Loup",campFilterMode:"wins-only",excludeTraitor:!0},fromComponent:"Distribution par Camps"}):o({selectedPlayer:s,campFilter:{selectedCamp:r.name,campFilterMode:"wins-only"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${a}`))}),e.jsx(R,{content:({active:r,payload:a})=>{if(r&&a&&a.length>0){const t=a[0].payload;if(t.name==="Autres"&&t._details){const l=[...t._details].sort((d,h)=>h.value-d.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",t.value," parties (",t.percentage,"%)"]})}),e.jsx("div",{children:l.map((d,h)=>e.jsxs("div",{children:[d.name,": ",d.value," parties (",d.percentage,"%)"]},h))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[t.name," (",t.percentage,"%)"]})}),e.jsxs("div",{children:["Apparitions: ",t.value]}),e.jsxs("div",{children:["Victoires: ",t.wins," (",t.winRate,"%)"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(T,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs($,{data:j,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(k,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(R,{content:({active:r,payload:a})=>{if(r&&a&&a.length>0){const t=a[0].payload,l=parseFloat(t.winRate)>0;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:t.name})}),e.jsxs("div",{children:["Victoires: ",t.wins," / ",t.value]}),e.jsxs("div",{children:["Taux: ",t.winRate,"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:["🖱️ Cliquez pour voir ",l?"les victoires":"toutes les parties"]})]})}return null}}),e.jsx(A,{dataKey:"winRateDisplay",children:j.map((r,a)=>e.jsx(P,{fill:parseFloat(r.winRate)===0?`${F[r.name]||`var(--chart-color-${a%6+1})`}50`:F[r.name]||`var(--chart-color-${a%6+1})`,onClick:()=>{r.name==="Traître"?o({selectedPlayer:s,campFilter:{selectedCamp:r.name,campFilterMode:parseFloat(r.winRate)===0?"all-assignments":"wins-only",excludeTraitor:!0},fromComponent:"Performance par Camp"}):r.name==="Loup"?o({selectedPlayer:s,campFilter:{selectedCamp:r.name,campFilterMode:parseFloat(r.winRate)===0?"all-assignments":"wins-only",excludeTraitor:!0},fromComponent:"Performance par Camp"}):o({selectedPlayer:s,campFilter:{selectedCamp:r.name,campFilterMode:parseFloat(r.winRate)===0?"all-assignments":"wins-only"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${a}`))})]})})})})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée d'historique disponible"})}export{oe as PlayerGameHistoryChart};
