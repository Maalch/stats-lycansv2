import{r as l,j as e}from"./index-rJXQXTnh.js";import{u as E}from"./usePlayerStats-CL6_6YrZ.js";import{l as C}from"./api-CbhEegR2.js";import{F as T}from"./FullscreenChart-C8PapnxP.js";import{R as f,C as R,X as P,Y as N,T as y,B as k,o as D,p as M}from"./statsApi-BxtQXlsH.js";import{L as G,a as z}from"./LineChart-CBFVjuAn.js";import{P as F,a as K}from"./PieChart-CpuTbeQ1.js";function q(u){const[b,o]=l.useState(null),[w,p]=l.useState(!1),[a,v]=l.useState(null);return l.useEffect(()=>{if(!u||u.trim()===""){o(null),v(null),p(!1);return}(async()=>{p(!0),v(null);try{const x="https://script.google.com/macros/s/AKfycbxo92hlxlcCzXtXawsxP4LSspOkNKKI4Yo8OC5aqrAe70EGoIaMcWtFWy7j-RF1iTiu/exec",m=`${x}?action=playerGameHistory&playerName=${encodeURIComponent(u)}`,g=await fetch(m);if(!g.ok)throw new Error(`HTTP error! status: ${g.status}`);const c=await g.json();if(c.error)throw new Error(c.error);o(c)}catch(x){const m=x instanceof Error?x.message:"Unknown error occurred";v(m),o(null)}finally{p(!1)}})()},[u]),{data:b,isLoading:w,error:a}}function U(){const[u,b]=l.useState("Ponce"),[o,w]=l.useState("session"),{playerStatsData:p}=E(),{data:a,isLoading:v,error:S}=q(u),x=l.useMemo(()=>p?.playerStats?p.playerStats.filter(t=>t.gamesPlayed>0).map(t=>t.player).sort():["Ponce"],[p]),m=l.useMemo(()=>{if(!a?.games)return new Map;const t=new Map;return a.games.forEach(s=>{if(!t.has(s.date)){const r=s.date.split("/");r.length===3?t.set(s.date,new Date(parseInt(r[2]),parseInt(r[1])-1,parseInt(r[0])).getTime()):t.set(s.date,new Date(s.date).getTime())}}),t},[a?.games]),g=l.useMemo(()=>{if(!a?.games)return[];const t={};return a.games.forEach(s=>{let r;if(o==="month"){const i=s.date.split("/");i.length===3?r=`${i[1]}/${i[2]}`:r=s.date}else r=s.date;t[r]||(t[r]={games:[],wins:0,total:0}),t[r].games.push(s),t[r].total++,s.won&&t[r].wins++}),Object.entries(t).map(([s,r])=>({period:s,totalGames:r.total,victories:r.wins,defeats:r.total-r.wins,winRate:r.total>0?(r.wins/r.total*100).toFixed(1):"0.0",winRateNum:r.total>0?r.wins/r.total*100:0})).sort((s,r)=>{if(o==="month"){const[i,n]=s.period.split("/"),[d,j]=r.period.split("/"),I=new Date(parseInt(n),parseInt(i)-1,1),$=new Date(parseInt(j),parseInt(d)-1,1);return I.getTime()-$.getTime()}else{const i=m.get(s.period)||0,n=m.get(r.period)||0;return i-n}})},[a,o,m]),c=l.useMemo(()=>a?.campStats?Object.entries(a.campStats).map(([t,s])=>({name:t,value:s.appearances,winRate:s.winRate,wins:s.wins,percentage:(s.appearances/a.totalGames*100).toFixed(1)})):[],[a]),A=l.useMemo(()=>{if(!c.length)return[];const t=5;let s=0;const r=[],i=[];if(c.forEach(n=>{parseFloat(n.percentage)<t?(s+=Number(n.value),r.push(n)):i.push(n)}),s>0){const n=c.reduce((d,j)=>d+Number(j.value),0);i.push({name:"Autres",value:s,winRate:"0.0",wins:r.reduce((d,j)=>d+j.wins,0),percentage:(s/n*100).toFixed(1),_details:r})}return i},[c]),h=(t=>t<=15?{fontSize:11,angle:-45,height:80,interval:0}:t<=30?{fontSize:10,angle:-45,height:85,interval:1}:t<=50?{fontSize:9,angle:-60,height:95,interval:2}:{fontSize:8,angle:-75,height:105,interval:Math.floor(t/12)})(g.length);return v?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):S?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",S]}):a?e.jsxs("div",{className:"lycans-player-history",children:[e.jsx("h2",{children:"Historique Détaillé d'un Joueur"}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Joueur:"}),e.jsx("select",{id:"player-select",value:u,onChange:t=>b(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:x.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:o,onChange:t=>w(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"})]})]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.totalGames}),e.jsx("p",{children:"parties jouées"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.totalWins}),e.jsx("p",{children:"parties gagnées"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",children:[a.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Évolution des Performances ",o==="month"?"par Mois":"par Session"]}),e.jsx(T,{title:`Évolution des Performances ${o==="month"?"par Mois":"par Session"}`,children:e.jsx("div",{style:{height:400},children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(G,{data:g,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"period",angle:h.angle,textAnchor:"end",height:h.height,interval:h.interval,fontSize:h.fontSize}),e.jsx(N,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(y,{content:({active:t,payload:s})=>{if(t&&s&&s.length>0){const r=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.period})}),e.jsxs("div",{children:["Parties: ",r.totalGames]}),e.jsxs("div",{children:["Victoires: ",r.victories]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]})]})}return null}}),e.jsx(z,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Répartition Victoires/Défaites ",o==="month"?"par Mois":"par Session"]}),e.jsx(T,{title:`Répartition Victoires/Défaites ${o==="month"?"par Mois":"par Session"}`,children:e.jsx("div",{style:{height:400},children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(k,{data:g,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"period",angle:h.angle,textAnchor:"end",height:h.height,interval:h.interval,fontSize:h.fontSize}),e.jsx(N,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"},allowDecimals:!1}),e.jsx(y,{content:({active:t,payload:s})=>{if(t&&s&&s.length>0){const r=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.period})}),e.jsxs("div",{children:["Total: ",r.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",r.victories]}),e.jsxs("div",{children:["Défaites: ",r.defeats]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]})]})}return null}}),e.jsx(D,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires"}),e.jsx(D,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"Défaites"})]})})})})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(F,{children:[e.jsx(K,{data:A,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:({name:t,value:s,percent:r})=>{const i=r!==void 0?r:0;return t==="Autres"?`Autres : ${s} (${(i*100).toFixed(1)}%)`:`${t}: ${s} (${(i*100).toFixed(1)}%)`},children:A.map((t,s)=>e.jsx(M,{fill:t.name==="Autres"?"#cccccc":C[t.name]||`var(--chart-color-${s%6+1})`},`cell-${s}`))}),e.jsx(y,{content:({active:t,payload:s})=>{if(t&&s&&s.length>0){const r=s[0].payload;if(r.name==="Autres"&&r._details){const i=[...r._details].sort((n,d)=>d.value-n.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",r.value," parties (",r.percentage,"%)"]})}),e.jsx("div",{children:i.map((n,d)=>e.jsxs("div",{children:[n.name,": ",n.value," parties (",n.percentage,"%)"]},d))})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[r.name," (",r.percentage,"%)"]})}),e.jsxs("div",{children:["Apparitions: ",r.value]}),e.jsxs("div",{children:["Victoires: ",r.wins," (",r.winRate,"%)"]})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx("div",{style:{height:400},children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(k,{data:c,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(N,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(y,{content:({active:t,payload:s})=>{if(t&&s&&s.length>0){const r=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.name})}),e.jsxs("div",{children:["Victoires: ",r.wins," / ",r.value]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]})]})}return null}}),e.jsx(D,{dataKey:"winRate",children:c.map((t,s)=>e.jsx(M,{fill:C[t.name]||`var(--chart-color-${s%6+1})`},`cell-${s}`))})]})})})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée d'historique disponible"})}export{U as PlayerGameHistoryChart};
