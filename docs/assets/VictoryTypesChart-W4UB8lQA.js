import{u as B,r as g,j as e}from"./index-DYmTKEcR.js";import{h as w}from"./baseStatsHook-BSxnYrRY.js";import{a as j}from"./api-beq3FXpM.js";import{F as f,B as T,C,X as b,Y as N,a as V}from"./FullscreenChart-o_Bl217w.js";import{R as S,T as k}from"./CategoricalChart-BNhHoh4M.js";import{L as F}from"./Legend-CwcTfpRb.js";function G(a){if(a.length===0)return null;const l={},d={};let y=0;a.forEach(c=>{const i=c["Type de victoire"],r=c["Camp victorieux"];i&&i.trim()!==""&&r&&r.trim()!==""&&(y++,l[i]||(l[i]=0),l[i]++,d[i]||(d[i]={}),d[i][r]||(d[i][r]=0),d[i][r]++)});const h=new Set;Object.values(d).forEach(c=>{Object.keys(c).forEach(i=>h.add(i))});const u=Object.keys(l).map(c=>{const i={type:c,count:l[c],percentage:(l[c]/y*100).toFixed(1)},r=d[c]||{};return h.forEach(t=>{const o=r[t]||0,n=l[c]>0?(o/l[c]*100).toFixed(1):"0.0";i[t]=o,i[`${t}_percentage`]=n}),i});u.sort((c,i)=>i.count-c.count);const x=Array.from(h).sort();return{totalGames:y,victoryTypes:u,winningCamps:x}}function R(){const{data:a,isLoading:l,error:d}=w(G);return{victoryTypesStats:a,isLoading:l,errorInfo:d}}function P(){const{victoryTypesStats:a,isLoading:l,errorInfo:d}=R(),{navigateToGameDetails:y}=B(),h=g.useMemo(()=>a?.victoryTypes?a.victoryTypes.map(r=>({...r,percentageNum:parseFloat(r.percentage)})):[],[a?.victoryTypes]),{mainVictoryTypes:u,rareVictoryTypes:x}=g.useMemo(()=>{if(!h.length)return{mainVictoryTypes:[],rareVictoryTypes:[]};const r=Math.max(5,Math.ceil(h[0].count*.1)),t=h.filter(n=>n.count>=r),o=h.filter(n=>n.count<r);return{mainVictoryTypes:t,rareVictoryTypes:o}},[h]),c=l,i=d;return c?e.jsx("div",{className:"donnees-attente",children:"Chargement des types de victoire..."}):i?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",i]}):a?e.jsxs("div",{className:"lycans-victory-types-container",children:[e.jsx("h2",{children:"Types de Victoire"}),a&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Types Principaux"}),e.jsx("div",{className:"lycans-valeur-principale",children:u.length}),e.jsx("p",{children:"types fréquents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Types Spéciaux"}),e.jsx("div",{className:"lycans-valeur-principale",children:x.length}),e.jsx("p",{children:"types rares"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:a?.totalGames||0}),e.jsx("p",{children:"parties analysées"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[u.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Victoire Principaux par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Types de victoire les plus fréquents (",u.reduce((r,t)=>r+t.count,0)," parties sur ",a?.totalGames,")"]}),e.jsx(f,{title:"Types de Victoire Principaux par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(T,{data:u,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(C,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"type",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:11}),e.jsx(N,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(k,{content:({active:r,payload:t,label:o})=>{if(r&&t&&t.length>0){const n=t.reduce((s,p)=>s+(p.value||0),0);let m="";return a?.totalGames&&n>0&&(m=(n/a.totalGames*100).toFixed(1)),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:300},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8},children:o}),e.jsxs("div",{style:{marginBottom:4},children:["Total: ",n," parties",m&&` (${m}%)`]}),t.filter(s=>s.value&&s.value>0).sort((s,p)=>(p.value||0)-(s.value||0)).map((s,p)=>{const v=n>0?((s.value||0)/n*100).toFixed(1):"0.0";return e.jsxs("div",{style:{marginBottom:2},children:[e.jsx("span",{style:{display:"inline-block",width:12,height:12,backgroundColor:s.color,marginRight:8,borderRadius:2}}),s.dataKey,": ",s.value," (",v,"%)"]},p)}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(F,{}),a?.winningCamps?.map((r,t)=>e.jsx(V,{dataKey:r,stackId:"victory",fill:j[r]||`var(--chart-color-${t%6+1})`,name:r,onClick:o=>{o&&o.type&&y({selectedVictoryType:o.type,fromComponent:"Types de Victoire Principaux"})},style:{cursor:"pointer"}},r))]})})})})]}),x.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Victoire Spéciaux par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Types de victoire moins fréquents (",x.reduce((r,t)=>r+t.count,0)," parties sur ",a?.totalGames,")"]}),e.jsx(f,{title:"Types de Victoire Spéciaux par Camp",children:e.jsx("div",{style:{height:500},children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(T,{data:x,margin:{top:20,right:30,left:20,bottom:120},children:[e.jsx(C,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"type",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:10}),e.jsx(N,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"},domain:[0,"dataMax"]}),e.jsx(k,{content:({active:r,payload:t,label:o})=>{if(r&&t&&t.length>0){const n=t.reduce((s,p)=>s+(p.value||0),0);let m="";return a?.totalGames&&n>0&&(m=(n/a.totalGames*100).toFixed(1)),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:300},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8},children:o}),e.jsxs("div",{style:{marginBottom:4},children:["Total: ",n," parties",m&&` (${m}%)`]}),t.filter(s=>s.value&&s.value>0).sort((s,p)=>(p.value||0)-(s.value||0)).map((s,p)=>{const v=n>0?((s.value||0)/n*100).toFixed(1):"0.0";return e.jsxs("div",{style:{marginBottom:2},children:[e.jsx("span",{style:{display:"inline-block",width:12,height:12,backgroundColor:s.color,marginRight:8,borderRadius:2}}),s.dataKey,": ",s.value," (",v,"%)"]},p)}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(F,{}),a?.winningCamps?.map((r,t)=>e.jsx(V,{dataKey:r,stackId:"victory",fill:j[r]||`var(--chart-color-${t%6+1})`,name:r,onClick:o=>{o&&o.type&&y({selectedVictoryType:o.type,fromComponent:"Types de Victoire Spéciaux"})},style:{cursor:"pointer"}},r))]})})})})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de victoire disponible"})}export{P as VictoryTypesChart};
