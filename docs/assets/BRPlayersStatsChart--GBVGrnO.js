import{a as K,r as k,j as e}from"./index-CMCfCri6.js";import{F as v,B as u,C as j,X as P,Y as f,a as x,b}from"./FullscreenChart-BoAq09BD.js";import{u as $,a as V}from"./useRawBRData-D53TFJVP.js";import{u as O}from"./useJoueursData-DG18u_KS.js";import{u as J,g as X}from"./api-BMIX7XdM.js";import{R,T as S}from"./CategoricalChart-DTZWZ2xx.js";import{L as Y}from"./Legend-CtUWzJJY.js";function se(){const{data:g,isLoading:F,error:A}=$(),{data:m,isLoading:z,error:w}=V(),{settings:s}=K(),{joueursData:C}=O(),[y,h]=k.useState(null),E=J(C),B=["var(--chart-color-1)","var(--chart-color-2)","var(--chart-color-3)","var(--chart-color-4)","var(--chart-color-5)","var(--chart-color-6)"],L=a=>E[a]||X(a),c=k.useMemo(()=>{if(!g||!m)return null;const a=m.length,r=g.length,t=g.filter(i=>i.Gagnant).length,l=g.reduce((i,o)=>{const d=o.Participants;return i[d]||(i[d]={name:d,participations:0,wins:0,totalScore:0,averageScore:0,winRate:0}),i[d].participations++,i[d].totalScore+=o.Score,o.Gagnant&&i[d].wins++,i},{});Object.values(l).forEach(i=>{i.averageScore=i.totalScore/i.participations,i.winRate=i.wins/i.participations*100});const n=Object.values(l).sort((i,o)=>o.participations-i.participations),p=n.slice(0,15),M=s.highlightedPlayer&&p.some(i=>i.name===s.highlightedPlayer);let H=!1,N=[...p];if(s.highlightedPlayer&&!M){const i=n.find(o=>o.name===s.highlightedPlayer);i&&(N.push({...i,isHighlightedAddition:!0}),H=!0)}const T=Object.values(l).filter(i=>i.participations>=3).sort((i,o)=>o.winRate-i.winRate).slice(0,15),G=s.highlightedPlayer&&T.some(i=>i.name===s.highlightedPlayer);let W=!1,D=[...T];if(s.highlightedPlayer&&!G){const i=n.find(o=>o.name===s.highlightedPlayer);i&&(D.push({...i,isHighlightedAddition:!0}),W=!0)}const q=m.reduce((i,o)=>{const d=o["Nombre de participants"];return i[d]||(i[d]=0),i[d]++,i},{}),I=Object.entries(q).map(([i,o])=>({participants:parseInt(i),games:o,percentage:(o/a*100).toFixed(1)})).sort((i,o)=>i.participants-o.participants);return{totalGames:a,totalParticipations:r,totalWins:t,winRate:(t/r*100).toFixed(1),averageParticipantsPerGame:(r/a).toFixed(1),topPlayersByParticipations:N,topPlayersByWins:D,participantData:I,highlightedPlayerInParticipations:H,highlightedPlayerInWinRate:W}},[g,m,s.highlightedPlayer]);return F||z?e.jsx("div",{className:"statistiques-chargement",children:"Chargement des donnÃ©es Battle Royale..."}):A||w?e.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",A||w]}):c?e.jsxs("div",{className:"lycans-chart-container",children:[e.jsx("div",{className:"lycans-chart-header",children:e.jsx("h2",{children:"Statistiques Joueurs - Battle Royale"})}),e.jsxs("div",{className:"lycans-stats-grid",children:[e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Parties totales"}),e.jsx("div",{className:"lycans-stat-value",children:c.totalGames})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Participations"}),e.jsx("div",{className:"lycans-stat-value",children:c.totalParticipations})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Moy. participants/partie"}),e.jsx("div",{className:"lycans-stat-value",children:c.averageParticipantsPerGame})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Participations"}),c.highlightedPlayerInParticipations&&s.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--accent-primary)",margin:"0.5rem 0"},children:["ðŸŽ¯ ",s.highlightedPlayer," affichÃ© en plus du top 15"]}),e.jsx(v,{title:"Participations - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(R,{width:"100%",height:400,children:e.jsxs(u,{data:c.topPlayersByParticipations,children:[e.jsx(j,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12,interval:0,tick:({x:a,y:r,payload:t})=>e.jsx("text",{x:a,y:r,dy:16,textAnchor:"end",fill:s.highlightedPlayer===t.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:s.highlightedPlayer===t.value?14:12,fontWeight:s.highlightedPlayer===t.value?"bold":"normal",transform:`rotate(-45 ${a} ${r})`,children:t.value})}),e.jsx(f,{}),e.jsx(S,{content:({active:a,payload:r})=>{if(a&&r&&r.length>0){const t=r[0].payload,l=t.isHighlightedAddition,n=s.highlightedPlayer===t.name;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:"12px",borderRadius:"8px",border:"1px solid var(--border-color)",boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem"},children:[t.name,n&&" ðŸŽ¯"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.5"},children:[e.jsxs("div",{children:["Participations: ",e.jsx("strong",{children:t.participations})]}),e.jsxs("div",{children:["Victoires: ",e.jsx("strong",{children:t.wins})]}),e.jsxs("div",{children:["Taux de victoire: ",e.jsxs("strong",{children:[t.winRate.toFixed(1),"%"]})]})]}),l&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"8px",fontStyle:"italic",paddingTop:"8px",borderTop:"1px solid var(--border-color)"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"})]})}return null}}),e.jsx(x,{dataKey:"participations",name:"Participations",children:c.topPlayersByParticipations.map((a,r)=>{const t=s.highlightedPlayer===a.name,l=y===a.name,n=a.isHighlightedAddition;return e.jsx(b,{fill:t?"var(--accent-primary)":n?"var(--accent-secondary)":L(a.name),stroke:t?"var(--accent-primary)":l?"var(--text-primary)":"none",strokeWidth:t?3:l?2:0,strokeDasharray:n?"5,5":"none",opacity:n?.8:1,onMouseEnter:()=>h(a.name),onMouseLeave:()=>h(null),style:{cursor:"pointer"}},`cell-${r}`)})}),e.jsx(x,{dataKey:"wins",fill:"var(--chart-color-2)",name:"Victoires",children:c.topPlayersByParticipations.map((a,r)=>{const t=s.highlightedPlayer===a.name,l=y===a.name,n=a.isHighlightedAddition;return e.jsx(b,{fill:t?"var(--accent-primary)":n?"var(--accent-secondary)":"var(--chart-color-2)",stroke:t?"var(--accent-primary)":l?"var(--text-primary)":"none",strokeWidth:t?3:l?2:0,strokeDasharray:n?"5,5":"none",opacity:n?.8:1,onMouseEnter:()=>h(a.name),onMouseLeave:()=>h(null),style:{cursor:"pointer"}},`cell-${r}`)})})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire (min. 3 parties)"}),c.highlightedPlayerInWinRate&&s.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--accent-primary)",margin:"0.5rem 0"},children:["ðŸŽ¯ ",s.highlightedPlayer," affichÃ© en plus du top 15"]}),e.jsx(v,{title:"Taux de Victoire - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(R,{width:"100%",height:400,children:e.jsxs(u,{data:c.topPlayersByWins,children:[e.jsx(j,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12,interval:0,tick:({x:a,y:r,payload:t})=>e.jsx("text",{x:a,y:r,dy:16,textAnchor:"end",fill:s.highlightedPlayer===t.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:s.highlightedPlayer===t.value?14:12,fontWeight:s.highlightedPlayer===t.value?"bold":"normal",transform:`rotate(-45 ${a} ${r})`,children:t.value})}),e.jsx(f,{}),e.jsx(S,{content:({active:a,payload:r})=>{if(a&&r&&r.length>0){const t=r[0].payload,l=t.isHighlightedAddition,n=s.highlightedPlayer===t.name,p=t.participations>=3;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:"12px",borderRadius:"8px",border:"1px solid var(--border-color)",boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem"},children:[t.name,n&&" ðŸŽ¯"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.5"},children:[e.jsxs("div",{children:["Taux de victoire: ",e.jsxs("strong",{children:[t.winRate.toFixed(1),"%"]})]}),e.jsxs("div",{children:["Victoires: ",e.jsx("strong",{children:t.wins})," / ",t.participations]})]}),l&&!p&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"8px",fontStyle:"italic",paddingTop:"8px",borderTop:"1px solid var(--border-color)"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (< 3 parties)"}),l&&p&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"8px",fontStyle:"italic",paddingTop:"8px",borderTop:"1px solid var(--border-color)"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"})]})}return null}}),e.jsx(x,{dataKey:"winRate",name:"Taux de victoire (%)",children:c.topPlayersByWins.map((a,r)=>{const t=s.highlightedPlayer===a.name,l=y===a.name,n=a.isHighlightedAddition;return e.jsx(b,{fill:t?"var(--accent-primary)":n?"var(--accent-secondary)":B[r%B.length],stroke:t?"var(--accent-primary)":l?"var(--text-primary)":"none",strokeWidth:t?3:l?2:0,strokeDasharray:n?"5,5":"none",opacity:n?.8:1,onMouseEnter:()=>h(a.name),onMouseLeave:()=>h(null),style:{cursor:"pointer"}},`cell-${r}`)})})]})})})]})]}),e.jsxs("div",{className:"lycans-chart-section",children:[e.jsx("h3",{children:"RÃ©partition par Nombre de Participants"}),e.jsx(v,{title:"RÃ©partition par Nombre de Participants - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(R,{width:"100%",height:400,children:e.jsxs(u,{data:c.participantData,children:[e.jsx(j,{strokeDasharray:"3 3"}),e.jsx(P,{dataKey:"participants"}),e.jsx(f,{}),e.jsx(S,{formatter:(a,r)=>[a,r==="games"?"Parties":r]}),e.jsx(Y,{}),e.jsx(x,{dataKey:"games",fill:"var(--chart-color-4)",name:"Nombre de parties"})]})})})]})]}):e.jsx("div",{className:"statistiques-vide",children:"Aucune donnÃ©e Battle Royale disponible"})}export{se as BRPlayersStatsChart};
