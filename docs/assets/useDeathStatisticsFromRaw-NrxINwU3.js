import{u as L}from"./baseStatsHook-DiXcZyn7.js";import{g as I,a as V}from"./datasyncExport-D6_8Fmuy.js";import{i as k,D as l}from"./deathTypes-CGUOTngO.js";import{c as v}from"./api-BSxVEfw9.js";import{g as B}from"./index-BmXnDnW6.js";function K(i,n){if(!i||!n)return!1;const s=i.split(".").map(Number),u=n.split(".").map(Number);for(let e=0;e<Math.max(s.length,u.length);e++){const t=s[e]||0,o=u[e]||0;if(t>o)return!0;if(t<o)return!1}return!0}function P(i){return i===l.SURVIVALIST_NOT_SAVED?l.BY_WOLF:i}function M(i){const n=new Set;i.forEach(e=>{e.PlayerStats.forEach(t=>{const o=I(t.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});n.add(o)})});const s=Array.from(n);return[...v.filter(e=>s.includes(e)),...s.filter(e=>!v.includes(e)).sort()]}function x(i){switch(i){case l.VOTED:return"Mort aux votes";case l.BY_WOLF:case l.SURVIVALIST_NOT_SAVED:return"Kill en Loup";case l.BY_ZOMBIE:return"Kill en Zombie";case l.BY_BEAST:return"Kill en Bête";case l.BY_AVATAR_CHAIN:return"Mort d'Avatar";case l.BULLET:return"Tir de Chasseur";case l.BULLET_HUMAN:return"Kill de Chasseur (sur humain)";case l.BULLET_WOLF:return"Kill de Chasseur (sur loup)";case l.SHERIF_SUCCESS:return"Kill de Shérif";case l.OTHER_AGENT:return"Kill d'Agent";case l.AVENGER:return"Kill de Vengeur";case l.SEER:return"Kill de Devin";case l.HANTED:return"Kill avec Potion hantée";case l.ASSASSIN:return"Kill avec Potion (Assassin)";case l.LOVER_DEATH:return"Kill d'amoureux";case l.BOMB:return"Explosion";case l.CRUSHED:return"Écrasement";case l.STARVATION:return"Famine";case l.STARVATION_AS_BEAST:return"Tuerie bestiale";case l.FALL:return"Chute mortelle";case l.UNKNOWN:return"Kill inconnu";default:return""}}function j(i){const n=new Set;i.forEach(e=>{e.PlayerStats.forEach(t=>{if(t.DeathType&&k(t.DeathType)){const o=P(t.DeathType);o&&n.add(o)}})});const s=Array.from(n),u=[l.BY_WOLF,l.VOTED,l.BULLET,l.BULLET_HUMAN,l.BULLET_WOLF,l.BY_ZOMBIE,l.ASSASSIN,l.AVENGER,l.LOVER_DEATH];return[...u.filter(e=>s.includes(e)),...s.filter(e=>!u.includes(e)).sort()]}function b(i,n){return i.PlayerStats.filter(s=>s.DeathType&&k(s.DeathType)&&(s.DeathTiming||s.DeathType)).map(s=>{let u=null,e=null;if(s.KillerName){const t=i.PlayerStats.find(o=>o.Username===s.KillerName);if(t){e=B(t);const o=V(t.MainRoleInitial,t.MainRoleChanges||[]);u=I(o,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1}),o&&o!==t.MainRoleInitial&&(o==="Loup"?u="Loup":o==="Zombie"&&(u="Vaudou"))}}return{playerId:B(s),playerName:s.Username,deathType:P(s.DeathType),killerId:e,killerName:s.KillerName,killerCamp:u}}).filter(s=>{if(!n||n==="Tous les camps")return!0;const u=i.PlayerStats.find(t=>t.Username===s.playerName);return u?I(u.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===n:!1})}function O(i,n,s){const u=[];i.PlayerStats.forEach(t=>{if(t.KillerName&&t.DeathType){if(t.DeathType===l.VOTED||t.DeathType===l.STARVATION||t.DeathType===l.FALL||t.DeathType===l.BY_AVATAR_CHAIN)return;const o=i.PlayerStats.find(m=>m.Username===t.KillerName);if(!o)return;let D=I(o.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});const N=V(o.MainRoleInitial,o.MainRoleChanges||[]);N&&N!==o.MainRoleInitial&&(N==="Loup"?D="Loup":N==="Zombie"&&(D="Vaudou"));const p=I(t.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0});u.push({killerId:B(o),killerName:o.Username,victimId:B(t),victimName:t.Username,deathType:P(t.DeathType),killerCamp:D,victimCamp:p})}});let e=u;return n&&n!=="Tous les camps"&&(e=e.filter(t=>t.killerCamp===n)),s&&s!=="Tous les camps"&&(e=e.filter(t=>s==="Roles solo"?t.victimCamp!=="Villageois"&&t.victimCamp!=="Loup":t.victimCamp===s)),e}function U(i,n,s){if(i.length===0||i.length===0)return null;const u=[],e={},t={};i.forEach(a=>{b(a,n).forEach(r=>{u.push({...r,gameId:a.Id})}),a.PlayerStats.forEach(r=>{const T=B(r),E=r.Username;t[T]=E,(!n||n==="Tous les camps"||I(r.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===n)&&(e[T]=(e[T]||0)+1)})});const o=u.length,D=i.length,N=D>0?o/D:0,p={};u.forEach(a=>{p[a.deathType]=(p[a.deathType]||0)+1});const m=Object.entries(p).map(([a,c])=>({type:a,count:c||0,percentage:o>0?(c||0)/o*100:0})).sort((a,c)=>c.count-a.count),h={};i.forEach(a=>{O(a,n,s).forEach(r=>{t[r.killerId]=r.killerName,t[r.victimId]=r.victimName,h[r.killerId]||(h[r.killerId]={kills:0,victims:new Set,killsByDeathType:{}}),h[r.killerId].kills++,h[r.killerId].victims.add(r.victimId),h[r.killerId].killsByDeathType[r.deathType]=(h[r.killerId].killsByDeathType[r.deathType]||0)+1})});const g=Object.entries(h).map(([a,c])=>{const r=e[a]||0,T=r>0?c.kills/r:0;return{killerName:t[a]||a,kills:c.kills,victims:Array.from(c.victims).map(E=>t[E]||E),percentage:o>0?c.kills/o*100:0,gamesPlayed:r,averageKillsPerGame:T,killsByDeathType:c.killsByDeathType}}).sort((a,c)=>c.kills-a.kills),d={};u.forEach(a=>{d[a.playerId]||(d[a.playerId]={totalDeaths:0,deathsByType:{},killedById:{},deathDays:[]});const c=d[a.playerId];c.totalDeaths++,c.deathsByType[a.deathType]=(c.deathsByType[a.deathType]||0)+1,a.killerId&&(c.killedById[a.killerId]=(c.killedById[a.killerId]||0)+1)});const f=[];Object.entries(d).forEach(([a,c])=>{const r=t[a]||a,T={};Object.entries(c.killedById).forEach(([E,A])=>{const C=t[E]||E;T[C]=(T[C]||0)+A}),f.push({playerName:r,totalDeaths:c.totalDeaths,deathsByType:c.deathsByType,killedBy:T,deathRate:e[a]>0?c.totalDeaths/e[a]:0,gamesPlayed:e[a]||0})}),Object.entries(e).forEach(([a,c])=>{d[a]||f.push({playerName:t[a]||a,totalDeaths:0,deathsByType:{},killedBy:{},deathRate:0,gamesPlayed:c})});const y=f.sort((a,c)=>c.totalDeaths-a.totalDeaths),S=m.length>0?m[0].type:null,R=g.length>0?g[0].killerName:null;return{totalDeaths:o,totalGames:D,averageDeathsPerGame:N,deathsByType:m,killerStats:g,playerDeathStats:y,mostCommonDeathType:S,mostDeadlyKiller:R}}function _(i,n){const s={},u={},e=i.length,t=[l.BULLET,l.BULLET_HUMAN,l.BULLET_WOLF];i.forEach(p=>{const m=new Set;p.PlayerStats.forEach(h=>{const g=h.MainRoleInitial,d=V(h.MainRoleInitial,h.MainRoleChanges||[]);if(g==="Chasseur"||d==="Chasseur"){const f=B(h);u[f]=h.Username,m.add(f),s[f]||(s[f]={kills:[],gamesPlayed:0,victimsCamps:[],gameVersions:[],gameModded:[]}),s[f].gamesPlayed++}}),p.PlayerStats.forEach(h=>{const g=h.DeathType,d=h.KillerName,f=d?p.PlayerStats.find(S=>S.Username===d):null,y=f?B(f):null;if(y&&f&&(u[y]=f.Username),g&&t.includes(g)&&y&&m.has(y)){const S=I(h.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});s[y].kills.push(g),s[y].victimsCamps.push(S),s[y].gameVersions.push(p.Version),s[y].gameModded.push(p.Modded)}})});const o=Object.entries(s).map(([p,m])=>{const h=m.kills.length,g={};m.kills.forEach(r=>{g[r]=(g[r]||0)+1});const d={};m.victimsCamps.forEach(r=>{d[r]=(d[r]||0)+1});let f=0,y=0;const S={},R={};m.victimsCamps.forEach((r,T)=>{const E=m.gameVersions[T],A=m.gameModded[T];r==="Idiot du Village"?A&&K(E,"0.202")?(y++,R[r]=(R[r]||0)+1):(f++,S[r]=(S[r]||0)+1):r==="Villageois"?(y++,R[r]=(R[r]||0)+1):(f++,S[r]=(S[r]||0)+1)});const a=m.gamesPlayed>0?h/m.gamesPlayed:0,c=m.gamesPlayed>0?f/m.gamesPlayed:0;return{hunterName:u[p]||p,totalKills:h,nonVillageoisKills:f,villageoisKills:y,gamesPlayedAsHunter:m.gamesPlayed,averageKillsPerGame:a,averageNonVillageoisKillsPerGame:c,killsByDeathType:g,victimsByCamp:d,goodVictimsByCamp:S,badVictimsByCamp:R}}).sort((p,m)=>m.totalKills-p.totalKills),D=o.length>0?o[0].hunterName:null,N=o.length>0?o.sort((p,m)=>m.averageNonVillageoisKillsPerGame-p.averageNonVillageoisKillsPerGame)[0].hunterName:null;return{totalHunters:o.length,totalGames:e,hunterStats:o,bestHunter:D,bestAverageHunter:N}}function F(i,n){const s=[];return i.forEach(u=>{u.PlayerStats.filter(e=>e.DeathPosition!==null).filter(e=>!n||n==="Tous les camps"?!0:I(e.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===n).forEach(e=>{if(e.DeathPosition){const t=I(e.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});s.push({x:e.DeathPosition.x,z:e.DeathPosition.z,playerName:e.Username,deathType:P(e.DeathType),mapName:u.MapName,killerName:e.KillerName||null,camp:t,gameId:u.DisplayedId,displayedGameId:u.DisplayedId})}})}),s}function Z(i){const n=new Set;return i.forEach(s=>{s.PlayerStats.some(e=>e.DeathPosition!==null)&&s.MapName&&n.add(s.MapName)}),Array.from(n).sort()}function z(i,n){return L(s=>U(s,i,n))}function q(){return L(i=>M(i))}function J(i){return L(n=>_(n))}export{z as a,J as b,j as c,Z as d,F as e,x as g,q as u};
