import{r as L,u as V,j as t}from"./index-AK6O1dOi.js";import{u as D,a as G,b as P}from"./useRawGameData-DZAl8i4c.js";import{a as I}from"./api-beq3FXpM.js";function R(a){const{data:h,isLoading:v,error:b}=D(),{data:C,isLoading:j,error:g}=G(),{data:x,isLoading:N,error:y}=P();return{data:L.useMemo(()=>{if(!h||!C||!x)return[];let u=[...h];return a&&(a.selectedPlayer&&(u=u.filter(i=>i["Liste des joueurs"].toLowerCase().includes(a.selectedPlayer.toLowerCase()))),a.selectedGame&&(u=u.filter(i=>i.Game===a.selectedGame)),a.selectedCamp&&(u=u.filter(i=>{if(a.selectedPlayer){const e=C.find(d=>d.Game===i.Game);if(!e)return!1;const s=a.selectedPlayer.toLowerCase();if(a.selectedCamp==="Autres"&&a._smallCamps){const d=a._smallCamps;for(const r of d){let c=!1;switch(r){case"Traître":c=!!(e.Traître&&e.Traître.toLowerCase().includes(s));break;case"Idiot du Village":c=!!(e["Idiot du village"]&&e["Idiot du village"].toLowerCase().includes(s));break;case"Cannibale":c=!!(e.Cannibale&&e.Cannibale.toLowerCase().includes(s));break;case"Agent":c=!!(e.Agent&&e.Agent.toLowerCase().includes(s));break;case"Espion":c=!!(e.Espion&&e.Espion.toLowerCase().includes(s));break;case"Scientifique":c=!!(e.Scientifique&&e.Scientifique.toLowerCase().includes(s));break;case"Amoureux":c=!!(e.Amoureux&&e.Amoureux.toLowerCase().includes(s));break;case"La Bête":c=!!(e["La Bête"]&&e["La Bête"].toLowerCase().includes(s));break;case"Chasseur de primes":c=!!(e["Chasseur de primes"]&&e["Chasseur de primes"].toLowerCase().includes(s));break;case"Vaudou":c=!!(e.Vaudou&&e.Vaudou.toLowerCase().includes(s));break;case"Villageois":const n=i["Liste des joueurs"].toLowerCase().includes(s),T=e.Loups&&e.Loups.toLowerCase().includes(s)||e.Traître&&e.Traître.toLowerCase().includes(s)||e["Idiot du village"]&&e["Idiot du village"].toLowerCase().includes(s)||e.Cannibale&&e.Cannibale.toLowerCase().includes(s)||e.Agent&&e.Agent.toLowerCase().includes(s)||e.Espion&&e.Espion.toLowerCase().includes(s)||e.Scientifique&&e.Scientifique.toLowerCase().includes(s)||e.Amoureux&&e.Amoureux.toLowerCase().includes(s)||e["La Bête"]&&e["La Bête"].toLowerCase().includes(s)||e["Chasseur de primes"]&&e["Chasseur de primes"].toLowerCase().includes(s)||e.Vaudou&&e.Vaudou.toLowerCase().includes(s);c=n&&!T;break}if(c)return!0}return!1}return e.Loups&&e.Loups.toLowerCase().includes(s)?a.selectedCamp==="Loups":e.Traître&&e.Traître.toLowerCase().includes(s)?a.selectedCamp==="Traître":e["Idiot du village"]&&e["Idiot du village"].toLowerCase().includes(s)?a.selectedCamp==="Idiot du Village":e.Cannibale&&e.Cannibale.toLowerCase().includes(s)?a.selectedCamp==="Cannibale":e.Agent&&e.Agent.toLowerCase().includes(s)?a.selectedCamp==="Agent":e.Espion&&e.Espion.toLowerCase().includes(s)?a.selectedCamp==="Espion":e.Scientifique&&e.Scientifique.toLowerCase().includes(s)?a.selectedCamp==="Scientifique":e.Amoureux&&e.Amoureux.toLowerCase().includes(s)?a.selectedCamp==="Amoureux":e["La Bête"]&&e["La Bête"].toLowerCase().includes(s)?a.selectedCamp==="La Bête":e["Chasseur de primes"]&&e["Chasseur de primes"].toLowerCase().includes(s)?a.selectedCamp==="Chasseur de primes":e.Vaudou&&e.Vaudou.toLowerCase().includes(s)?a.selectedCamp==="Vaudou":i["Liste des joueurs"].toLowerCase().includes(s)?a.selectedCamp==="Villageois":!1}else{if((a.campFilterMode||"wins-only")==="wins-only")return a.selectedCamp==="Autres"&&a._smallCamps?a._smallCamps.includes(i["Camp victorieux"]):i["Camp victorieux"]===a.selectedCamp;{const s=C.find(l=>l.Game===i.Game);if(!s)return i["Camp victorieux"]===a.selectedCamp;if(a.selectedCamp==="Autres"&&a._smallCamps)return a._smallCamps.some(d=>{switch(d){case"Traître":return!!(s.Traître&&s.Traître.trim());case"Idiot du Village":return!!(s["Idiot du village"]&&s["Idiot du village"].trim());case"Cannibale":return!!(s.Cannibale&&s.Cannibale.trim());case"Agent":return!!(s.Agent&&s.Agent.trim());case"Espion":return!!(s.Espion&&s.Espion.trim());case"Scientifique":return!!(s.Scientifique&&s.Scientifique.trim());case"Amoureux":return!!(s.Amoureux&&s.Amoureux.trim());case"La Bête":return!!(s["La Bête"]&&s["La Bête"].trim());case"Chasseur de primes":return!!(s["Chasseur de primes"]&&s["Chasseur de primes"].trim());case"Vaudou":return!!(s.Vaudou&&s.Vaudou.trim());case"Villageois":const r=i["Liste des joueurs"].split(",").map(n=>n.trim()).filter(n=>n),c=[...s.Loups?s.Loups.split(",").map(n=>n.trim()).filter(n=>n):[],...s.Traître?[s.Traître.trim()].filter(n=>n):[],...s["Idiot du village"]?[s["Idiot du village"].trim()].filter(n=>n):[],...s.Cannibale?[s.Cannibale.trim()].filter(n=>n):[],...s.Agent?[s.Agent.trim()].filter(n=>n):[],...s.Espion?[s.Espion.trim()].filter(n=>n):[],...s.Scientifique?[s.Scientifique.trim()].filter(n=>n):[],...s.Amoureux?s.Amoureux.split(",").map(n=>n.trim()).filter(n=>n):[],...s["La Bête"]?[s["La Bête"].trim()].filter(n=>n):[],...s["Chasseur de primes"]?[s["Chasseur de primes"].trim()].filter(n=>n):[],...s.Vaudou?[s.Vaudou.trim()].filter(n=>n):[]];return r.some(n=>!c.includes(n));default:return!1}});switch(a.selectedCamp){case"Loups":return!!(s.Loups&&s.Loups.trim());case"Traître":return!!(s.Traître&&s.Traître.trim());case"Idiot du Village":return!!(s["Idiot du village"]&&s["Idiot du village"].trim());case"Cannibale":return!!(s.Cannibale&&s.Cannibale.trim());case"Agent":return!!(s.Agent&&s.Agent.trim());case"Espion":return!!(s.Espion&&s.Espion.trim());case"Scientifique":return!!(s.Scientifique&&s.Scientifique.trim());case"Amoureux":return!!(s.Amoureux&&s.Amoureux.trim());case"La Bête":return!!(s["La Bête"]&&s["La Bête"].trim());case"Chasseur de primes":return!!(s["Chasseur de primes"]&&s["Chasseur de primes"].trim());case"Vaudou":return!!(s.Vaudou&&s.Vaudou.trim());case"Villageois":const l=i["Liste des joueurs"].split(",").map(r=>r.trim()).filter(r=>r),d=[...s.Loups?s.Loups.split(",").map(r=>r.trim()).filter(r=>r):[],...s.Traître?[s.Traître.trim()].filter(r=>r):[],...s["Idiot du village"]?[s["Idiot du village"].trim()].filter(r=>r):[],...s.Cannibale?[s.Cannibale.trim()].filter(r=>r):[],...s.Agent?[s.Agent.trim()].filter(r=>r):[],...s.Espion?[s.Espion.trim()].filter(r=>r):[],...s.Scientifique?[s.Scientifique.trim()].filter(r=>r):[],...s.Amoureux?s.Amoureux.split(",").map(r=>r.trim()).filter(r=>r):[],...s["La Bête"]?[s["La Bête"].trim()].filter(r=>r):[],...s["Chasseur de primes"]?[s["Chasseur de primes"].trim()].filter(r=>r):[],...s.Vaudou?[s.Vaudou.trim()].filter(r=>r):[]];return l.some(r=>!d.includes(r));default:return i["Camp victorieux"]===a.selectedCamp}}}})),a.selectedVictoryType&&(u=u.filter(i=>i["Type de victoire"]===a.selectedVictoryType)),a.selectedDate&&(u=u.filter(i=>{const e=i.Date;if(a.selectedDate.includes("/")&&a.selectedDate.split("/").length===2){const[s,l]=a.selectedDate.split("/"),d=e.split("/");if(d.length===3){const[,r,c]=d;return r===s&&c===l}}else return e===a.selectedDate;return!1})),a.selectedPlayerPair&&a.selectedPairRole&&(u=u.filter(i=>{const e=C.find(c=>c.Game===i.Game);if(!e)return!1;const[s,l]=a.selectedPlayerPair,d=s.toLowerCase(),r=l.toLowerCase();if(a.selectedPairRole==="wolves"){if(e.Loups){const c=e.Loups.toLowerCase();return c.includes(d)&&c.includes(r)}}else if(a.selectedPairRole==="lovers"&&e.Amoureux){const c=e.Amoureux.toLowerCase();return c.includes(d)&&c.includes(r)}return!1})),a.selectedHarvestRange&&(u=u.filter(i=>{const e=i["Pourcentage de récolte"];if(e==null)return!1;const s=e*100;switch(a.selectedHarvestRange){case"0-25%":return s>=0&&s<=25;case"26-50%":return s>25&&s<=50;case"51-75%":return s>50&&s<=75;case"76-99%":return s>75&&s<=99;case"100%":return s>=100;default:return!0}})),a.selectedGameDuration&&(u=u.filter(i=>i["Nombre de journées"]===a.selectedGameDuration))),u.map(i=>{const e=C.find(o=>o.Game===i.Game),s=x.filter(o=>o.Game===i.Game),l={};e&&(e.Loups&&(l.wolves=e.Loups.split(", ").filter(Boolean)),e.Traître&&(l.traitor=e.Traître),e["Idiot du village"]&&(l.villageIdiot=e["Idiot du village"]),e.Cannibale&&(l.cannibal=e.Cannibale),e.Agent&&(l.agent=e.Agent),e.Espion&&(l.spy=e.Espion),e.Scientifique&&(l.scientist=e.Scientifique),e.Amoureux&&(l.lovers=e.Amoureux.split(", ").filter(Boolean)),e["La Bête"]&&(l.beast=e["La Bête"]),e["Chasseur de primes"]&&(l.bountyHunter=e["Chasseur de primes"]),e.Vaudou&&(l.voodoo=e.Vaudou));const d=s.map(o=>({player:"Ponce",camp:o.Camp||"Unknown",isTraitor:o.Traître||!1,secondaryRole:o["Rôle secondaire"],wolfPower:o["Pouvoir de loup"],villagerJob:o["Métier villageois"],playersKilled:o["Joueurs tués"],deathDay:o["Jour de mort"],deathType:o["Type de mort"],killers:o["Joueurs tueurs"]})),r=[],c=i["Liste des joueurs"].split(", ").filter(Boolean),n=i["Liste des gagnants"].split(", ").filter(Boolean);return c.forEach(o=>{let m="Villageois",p="Villageois";const S=n.includes(o);e&&(e.Loups&&e.Loups.split(", ").includes(o)?(m="Loup-Garou",p="Loups"):e.Traître&&e.Traître===o?(m="Traître",p="Traître"):e["Idiot du village"]&&e["Idiot du village"]===o?(m="Idiot du village",p="Idiot du Village"):e.Cannibale&&e.Cannibale===o?(m="Cannibale",p="Cannibale"):e.Agent&&e.Agent===o?(m="Agent",p="Agent"):e.Espion&&e.Espion===o?(m="Espion",p="Espion"):e.Scientifique&&e.Scientifique===o?(m="Scientifique",p="Scientifique"):e["La Bête"]&&e["La Bête"]===o?(m="La Bête",p="La Bête"):e["Chasseur de primes"]&&e["Chasseur de primes"]===o?(m="Chasseur de primes",p="Chasseur de primes"):e.Vaudou&&e.Vaudou===o&&(m="Vaudou",p="Vaudou"),e.Amoureux&&e.Amoureux.split(", ").includes(o)&&(m==="Villageois"?m="Amoureux":m=`${m} (Amoureux)`,S&&i["Camp victorieux"]==="Amoureux"&&(p="Amoureux"))),r.push({player:o,role:m,camp:p,isAlive:S})}),{gameId:i.Game,date:i.Date,isModded:i["Game Moddée"],playerCount:i["Nombre de joueurs"],wolfCount:i["Nombre de loups"],hasTraitor:i["Rôle Traître"],hasLovers:i["Rôle Amoureux"],soloRoles:i["Rôles solo"],winningCamp:i["Camp victorieux"],victoryType:i["Type de victoire"],dayCount:i["Nombre de journées"],villagerSurvivors:i["Survivants villageois"],wolfSurvivors:i["Survivants loups (traître inclus)"],loverSurvivors:i["Survivants amoureux"],soloSurvivors:i["Survivants solo"],winners:i["Liste des gagnants"],harvest:i.Récolte,totalHarvest:i["Total récolte"],harvestPercentage:i["Pourcentage de récolte"],playersList:i["Liste des joueurs"],versions:i.Versions,map:i.Map,startTime:i.Début,endTime:i.Fin,roles:l,playerRoles:r,playerDetails:d}})},[h,C,x,a]),isLoading:v||j||N,error:b||g||y}}function F(){const{navigationFilters:a,navigateBack:h}=V(),{data:v,isLoading:b,error:C}=R(a),[j,g]=L.useState("date"),[x,N]=L.useState("desc"),[y,w]=L.useState(null),A=L.useMemo(()=>v?[...v].sort((e,s)=>{let l,d;switch(j){case"date":l=new Date(e.date.split("/").reverse().join("-")).getTime(),d=new Date(s.date.split("/").reverse().join("-")).getTime();break;case"gameId":l=e.gameId,d=s.gameId;break;case"playerCount":l=e.playerCount,d=s.playerCount;break;case"dayCount":l=e.dayCount,d=s.dayCount;break;case"winningCamp":l=e.winningCamp,d=s.winningCamp;break;case"victoryType":l=e.victoryType,d=s.victoryType;break;default:return 0}return x==="asc"?l>d?1:-1:l<d?1:-1}):[],[v,j,x]),f=e=>{j===e?N(x==="asc"?"desc":"asc"):(g(e),N("desc"))},u=e=>j!==e?"↕️":x==="asc"?"↗️":"↘️",i=()=>{const e=[];if(a.selectedPlayer&&a.selectedCamp)e.push(`${a.selectedPlayer} jouant ${a.selectedCamp}`);else if(a.selectedPlayer&&e.push(`Joueur: ${a.selectedPlayer}`),a.selectedCamp){const s=`Camp: ${a.selectedCamp}`,l=a.campFilterMode==="wins-only"?" (victoires uniquement)":a.campFilterMode==="all-assignments"?" (toutes assignations)":"";e.push(s+l)}if(a.selectedPlayerPair&&a.selectedPairRole){const s=a.selectedPlayerPair.join(" & "),l=a.selectedPairRole==="wolves"?"loups":"amoureux";e.push(`Paire ${l}: ${s}`)}return a.selectedVictoryType&&e.push(`Victoire: ${a.selectedVictoryType}`),a.selectedHarvestRange&&e.push(`Récolte: ${a.selectedHarvestRange}`),a.selectedGameDuration&&e.push(`Durée: ${a.selectedGameDuration} jour${a.selectedGameDuration>1?"s":""}`),a.selectedGame&&e.push(`Partie #${a.selectedGame}`),a.selectedDate&&(a.selectedDate.includes("/")&&a.selectedDate.split("/").length===2?e.push(`Mois: ${a.selectedDate}`):e.push(`Date: ${a.selectedDate}`)),e};return b?t.jsx("div",{className:"statistiques-chargement",children:"Chargement des détails des parties..."}):C?t.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",C]}):!v||v.length===0?t.jsxs("div",{className:"lycans-empty-section",children:[t.jsx("h2",{children:"Aucune partie trouvée"}),t.jsx("p",{children:"Aucune partie ne correspond aux critères sélectionnés."}),a.fromComponent&&t.jsxs("button",{onClick:h,className:"lycans-submenu-btn",style:{marginTop:"1rem"},children:["← Retour à ",a.fromComponent]})]}):t.jsxs("div",{className:"lycans-game-details",children:[t.jsxs("div",{className:"lycans-game-details-header",children:[t.jsxs("div",{className:"lycans-game-details-navigation",children:[a.fromComponent&&t.jsxs("button",{onClick:h,className:"lycans-submenu-btn",style:{marginRight:"1rem"},children:["← Retour à ",a.fromComponent]}),t.jsxs("h2",{children:["Détails des Parties (",v.length," partie",v.length>1?"s":"",")"]})]}),i().length>0&&t.jsxs("div",{className:"lycans-active-filters",children:[t.jsx("strong",{children:"Filtres actifs:"})," ",i().join(", ")]})]}),t.jsx("div",{className:"lycans-games-table-container",children:t.jsxs("table",{className:"lycans-games-table",children:[t.jsx("thead",{children:t.jsxs("tr",{children:[t.jsxs("th",{onClick:()=>f("gameId"),className:"sortable",children:["Partie ",u("gameId")]}),t.jsxs("th",{onClick:()=>f("date"),className:"sortable",children:["Date ",u("date")]}),t.jsxs("th",{onClick:()=>f("playerCount"),className:"sortable",children:["Joueurs ",u("playerCount")]}),t.jsxs("th",{onClick:()=>f("dayCount"),className:"sortable",children:["Jours ",u("dayCount")]}),t.jsxs("th",{onClick:()=>f("winningCamp"),className:"sortable",children:["Camp Vainqueur ",u("winningCamp")]}),t.jsxs("th",{onClick:()=>f("victoryType"),className:"sortable",children:["Type de Victoire ",u("victoryType")]}),t.jsx("th",{children:"Détails"})]})}),t.jsx("tbody",{children:A.map(e=>t.jsxs(t.Fragment,{children:[t.jsxs("tr",{className:y===e.gameId?"selected":"",children:[t.jsxs("td",{children:["#",e.gameId]}),t.jsx("td",{children:e.date}),t.jsx("td",{children:e.playerCount}),t.jsx("td",{children:e.dayCount}),t.jsx("td",{style:{color:I[e.winningCamp]||"#fff"},children:e.winningCamp}),t.jsx("td",{children:e.victoryType}),t.jsx("td",{children:t.jsx("button",{onClick:()=>w(y===e.gameId?null:e.gameId),className:"lycans-details-btn",children:y===e.gameId?"Masquer":"Voir"})})]},e.gameId),y===e.gameId&&t.jsx("tr",{className:"game-details-row",children:t.jsx("td",{colSpan:7,children:t.jsx(E,{game:e})})},`${e.gameId}-details`)]}))})]})})]})}function E({game:a}){return t.jsx("div",{className:"lycans-game-detail-view",children:t.jsxs("div",{className:"lycans-game-detail-grid",children:[t.jsxs("div",{className:"lycans-game-detail-section",children:[t.jsx("h4",{children:"Informations Générales"}),t.jsxs("div",{className:"lycans-game-detail-stats",children:[t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Partie moddée:"}),t.jsx("span",{className:"value",children:a.isModded?"Oui":"Non"})]}),t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Nombre de loups:"}),t.jsx("span",{className:"value",children:a.wolfCount})]}),t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Traître:"}),t.jsx("span",{className:"value",children:a.hasTraitor?"Oui":"Non"})]}),t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Amoureux:"}),t.jsx("span",{className:"value",children:a.hasLovers?"Oui":"Non"})]}),a.soloRoles&&t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Rôles solo:"}),t.jsx("span",{className:"value",children:a.soloRoles})]})]})]}),t.jsxs("div",{className:"lycans-game-detail-section",children:[t.jsx("h4",{children:"Informations Supplémentaires"}),t.jsxs("div",{className:"lycans-game-detail-stats",children:[a.versions&&t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Version:"}),t.jsx("span",{className:"value",children:a.versions})]}),a.map&&t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Map:"}),t.jsx("span",{className:"value",children:a.map})]}),a.startTime&&t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Début:"}),t.jsx("span",{className:"value",children:a.startTime})]}),a.endTime&&t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Fin:"}),t.jsx("span",{className:"value",children:a.endTime})]})]})]}),t.jsxs("div",{className:"lycans-game-detail-section",children:[t.jsx("h4",{children:"Résultats"}),t.jsxs("div",{className:"lycans-game-detail-stats",children:[t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Survivants villageois:"}),t.jsx("span",{className:"value",children:a.villagerSurvivors})]}),t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Survivants loups:"}),t.jsx("span",{className:"value",children:a.wolfSurvivors})]}),a.loverSurvivors!==null&&t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Survivants amoureux:"}),t.jsx("span",{className:"value",children:a.loverSurvivors})]}),a.soloSurvivors!==null&&t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Survivants solo:"}),t.jsx("span",{className:"value",children:a.soloSurvivors})]}),t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Gagnants:"}),t.jsx("span",{className:"value",children:a.winners})]})]})]}),a.harvest!==null&&t.jsxs("div",{className:"lycans-game-detail-section",children:[t.jsx("h4",{children:"Récolte"}),t.jsxs("div",{className:"lycans-game-detail-stats",children:[t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Récolte:"}),t.jsx("span",{className:"value",children:a.harvest})]}),t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Total possible:"}),t.jsx("span",{className:"value",children:a.totalHarvest})]}),t.jsxs("div",{className:"lycans-stat-item",children:[t.jsx("span",{className:"label",children:"Pourcentage:"}),t.jsx("span",{className:"value",children:typeof a.harvestPercentage=="number"?(a.harvestPercentage*100).toFixed(1)+"%":"N/A"})]})]})]}),t.jsxs("div",{className:"lycans-game-detail-section full-width",children:[t.jsx("h4",{children:"Rôles des Joueurs"}),t.jsx("div",{className:"lycans-player-roles-grid",children:a.playerRoles.map((h,v)=>t.jsxs("div",{className:"lycans-player-role-item",children:[t.jsx("div",{className:"lycans-player-name",style:{color:I[h.camp]||"#fff"},children:h.player}),t.jsx("div",{className:"lycans-player-role",children:h.role}),t.jsx("div",{className:"lycans-player-camp",children:h.camp})]},v))})]})]})})}export{F as GameDetailsChart};
