import{r as y,u as G,j as e}from"./index-CSjSU2-u.js";import{u as I,a as V,b as P}from"./useRawGameData-CvorIhgh.js";import{a as D}from"./api-beq3FXpM.js";function A(a){const{data:u,isLoading:m,error:C}=I(),{data:p,isLoading:x,error:b}=V(),{data:h,isLoading:N,error:j}=P();return{data:y.useMemo(()=>{if(!u||!p||!h)return[];let r=[...u];return a&&(a.selectedPlayer&&(r=r.filter(l=>l["Liste des joueurs"].toLowerCase().includes(a.selectedPlayer.toLowerCase()))),a.selectedGame&&(r=r.filter(l=>l.Game===a.selectedGame)),a.selectedCamp&&(r=r.filter(l=>{if(a.selectedPlayer){const s=p.find(c=>c.Game===l.Game);if(!s)return!1;const n=a.selectedPlayer.toLowerCase();return s.Loups&&s.Loups.toLowerCase().includes(n)||s.Traître&&s.Traître.toLowerCase().includes(n)?a.selectedCamp==="Loups":s.Amoureux&&s.Amoureux.toLowerCase().includes(n)?a.selectedCamp==="Amoureux":s["La Bête"]&&s["La Bête"].toLowerCase().includes(n)?a.selectedCamp==="La Bête":s["Chasseur de primes"]&&s["Chasseur de primes"].toLowerCase().includes(n)?a.selectedCamp==="Chasseur de primes":s.Vaudou&&s.Vaudou.toLowerCase().includes(n)?a.selectedCamp==="Vaudou":l["Liste des joueurs"].toLowerCase().includes(n)?a.selectedCamp==="Villageois":!1}else return l["Camp victorieux"]===a.selectedCamp})),a.selectedVictoryType&&(r=r.filter(l=>l["Type de victoire"]===a.selectedVictoryType)),a.selectedDate&&(r=r.filter(l=>{const s=l.Date;if(a.selectedDate.includes("/")&&a.selectedDate.split("/").length===2){const[n,t]=a.selectedDate.split("/"),c=s.split("/");if(c.length===3){const[,f,L]=c;return f===n&&L===t}}else return s===a.selectedDate;return!1}))),r.map(l=>{const s=p.find(i=>i.Game===l.Game),n=h.filter(i=>i.Game===l.Game),t={};s&&(s.Loups&&(t.wolves=s.Loups.split(", ").filter(Boolean)),s.Traître&&(t.traitor=s.Traître),s["Idiot du village"]&&(t.villageIdiot=s["Idiot du village"]),s.Cannibale&&(t.cannibal=s.Cannibale),s.Agent&&(t.agent=s.Agent),s.Espion&&(t.spy=s.Espion),s.Scientifique&&(t.scientist=s.Scientifique),s.Amoureux&&(t.lovers=s.Amoureux.split(", ").filter(Boolean)),s["La Bête"]&&(t.beast=s["La Bête"]),s["Chasseur de primes"]&&(t.bountyHunter=s["Chasseur de primes"]),s.Vaudou&&(t.voodoo=s.Vaudou));const c=n.map(i=>({player:"Ponce",camp:i.Camp||"Unknown",isTraitor:i.Traître||!1,secondaryRole:i["Rôle secondaire"],wolfPower:i["Pouvoir de loup"],villagerJob:i["Métier villageois"],playersKilled:i["Joueurs tués"],deathDay:i["Jour de mort"],deathType:i["Type de mort"],killers:i["Joueurs tueurs"]})),f=[],L=l["Liste des joueurs"].split(", ").filter(Boolean),S=l["Liste des gagnants"].split(", ").filter(Boolean);return L.forEach(i=>{let o="Villageois",d="Villageois";const T=S.includes(i);s&&(s.Loups&&s.Loups.split(", ").includes(i)?(o="Loup-Garou",d="Loups"):s.Traître&&s.Traître===i?(o="Traître",d="Loups"):s["Idiot du village"]&&s["Idiot du village"]===i?(o="Idiot du village",d="Idiot du village"):s.Cannibale&&s.Cannibale===i?(o="Cannibale",d="Cannibale"):s.Agent&&s.Agent===i?(o="Agent",d="Agent"):s.Espion&&s.Espion===i?(o="Espion",d="Espion"):s.Scientifique&&s.Scientifique===i?(o="Scientifique",d="Scientifique"):s["La Bête"]&&s["La Bête"]===i?(o="La Bête",d="La Bête"):s["Chasseur de primes"]&&s["Chasseur de primes"]===i?(o="Chasseur de primes",d="Chasseur de primes"):s.Vaudou&&s.Vaudou===i&&(o="Vaudou",d="Vaudou"),s.Amoureux&&s.Amoureux.split(", ").includes(i)&&(o==="Villageois"?o="Amoureux":o=`${o} (Amoureux)`,T&&l["Camp victorieux"]==="Amoureux"&&(d="Amoureux"))),f.push({player:i,role:o,camp:d,isAlive:T})}),{gameId:l.Game,date:l.Date,isModded:l["Game Moddée"],playerCount:l["Nombre de joueurs"],wolfCount:l["Nombre de loups"],hasTraitor:l["Rôle Traître"],hasLovers:l["Rôle Amoureux"],soloRoles:l["Rôles solo"],winningCamp:l["Camp victorieux"],victoryType:l["Type de victoire"],dayCount:l["Nombre de journées"],villagerSurvivors:l["Survivants villageois"],wolfSurvivors:l["Survivants loups (traître inclus)"],loverSurvivors:l["Survivants amoureux"],soloSurvivors:l["Survivants solo"],winners:l["Liste des gagnants"],harvest:l.Récolte,totalHarvest:l["Total récolte"],harvestPercentage:l["Pourcentage de récolte"],playersList:l["Liste des joueurs"],versions:l.Versions,map:l.Map,startTime:l.Début,endTime:l.Fin,roles:t,playerRoles:f,playerDetails:c}})},[u,p,h,a]),isLoading:m||x||N,error:C||b||j}}function M(){const{navigationFilters:a,navigateBack:u}=G(),{data:m,isLoading:C,error:p}=A(a),[x,b]=y.useState("date"),[h,N]=y.useState("desc"),[j,w]=y.useState(null),g=y.useMemo(()=>m?[...m].sort((s,n)=>{let t,c;switch(x){case"date":t=new Date(s.date.split("/").reverse().join("-")).getTime(),c=new Date(n.date.split("/").reverse().join("-")).getTime();break;case"gameId":t=s.gameId,c=n.gameId;break;case"playerCount":t=s.playerCount,c=n.playerCount;break;case"dayCount":t=s.dayCount,c=n.dayCount;break;case"winningCamp":t=s.winningCamp,c=n.winningCamp;break;case"victoryType":t=s.victoryType,c=n.victoryType;break;default:return 0}return h==="asc"?t>c?1:-1:t<c?1:-1}):[],[m,x,h]),v=s=>{x===s?N(h==="asc"?"desc":"asc"):(b(s),N("desc"))},r=s=>x!==s?"↕️":h==="asc"?"↗️":"↘️",l=()=>{const s=[];return a.selectedPlayer&&a.selectedCamp?s.push(`${a.selectedPlayer} jouant ${a.selectedCamp}`):(a.selectedPlayer&&s.push(`Joueur: ${a.selectedPlayer}`),a.selectedCamp&&s.push(`Camp: ${a.selectedCamp}`)),a.selectedVictoryType&&s.push(`Victoire: ${a.selectedVictoryType}`),a.selectedGame&&s.push(`Partie #${a.selectedGame}`),a.selectedDate&&(a.selectedDate.includes("/")&&a.selectedDate.split("/").length===2?s.push(`Mois: ${a.selectedDate}`):s.push(`Date: ${a.selectedDate}`)),s};return C?e.jsx("div",{className:"statistiques-chargement",children:"Chargement des détails des parties..."}):p?e.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",p]}):!m||m.length===0?e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h2",{children:"Aucune partie trouvée"}),e.jsx("p",{children:"Aucune partie ne correspond aux critères sélectionnés."}),a.fromComponent&&e.jsxs("button",{onClick:u,className:"lycans-submenu-btn",style:{marginTop:"1rem"},children:["← Retour à ",a.fromComponent]})]}):e.jsxs("div",{className:"lycans-game-details",children:[e.jsxs("div",{className:"lycans-game-details-header",children:[e.jsxs("div",{className:"lycans-game-details-navigation",children:[a.fromComponent&&e.jsxs("button",{onClick:u,className:"lycans-submenu-btn",style:{marginRight:"1rem"},children:["← Retour à ",a.fromComponent]}),e.jsxs("h2",{children:["Détails des Parties (",m.length," partie",m.length>1?"s":"",")"]})]}),l().length>0&&e.jsxs("div",{className:"lycans-active-filters",children:[e.jsx("strong",{children:"Filtres actifs:"})," ",l().join(", ")]})]}),e.jsx("div",{className:"lycans-games-table-container",children:e.jsxs("table",{className:"lycans-games-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>v("gameId"),className:"sortable",children:["Partie ",r("gameId")]}),e.jsxs("th",{onClick:()=>v("date"),className:"sortable",children:["Date ",r("date")]}),e.jsxs("th",{onClick:()=>v("playerCount"),className:"sortable",children:["Joueurs ",r("playerCount")]}),e.jsxs("th",{onClick:()=>v("dayCount"),className:"sortable",children:["Jours ",r("dayCount")]}),e.jsxs("th",{onClick:()=>v("winningCamp"),className:"sortable",children:["Camp Vainqueur ",r("winningCamp")]}),e.jsxs("th",{onClick:()=>v("victoryType"),className:"sortable",children:["Type de Victoire ",r("victoryType")]}),e.jsx("th",{children:"Détails"})]})}),e.jsx("tbody",{children:g.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:j===s.gameId?"selected":"",children:[e.jsxs("td",{children:["#",s.gameId]}),e.jsx("td",{children:s.date}),e.jsx("td",{children:s.playerCount}),e.jsx("td",{children:s.dayCount}),e.jsx("td",{style:{color:D[s.winningCamp]||"#fff"},children:s.winningCamp}),e.jsx("td",{children:s.victoryType}),e.jsx("td",{children:e.jsx("button",{onClick:()=>w(j===s.gameId?null:s.gameId),className:"lycans-details-btn",children:j===s.gameId?"Masquer":"Voir"})})]},s.gameId),j===s.gameId&&e.jsx("tr",{className:"game-details-row",children:e.jsx("td",{colSpan:7,children:e.jsx(R,{game:s})})},`${s.gameId}-details`)]}))})]})})]})}function R({game:a}){return e.jsx("div",{className:"lycans-game-detail-view",children:e.jsxs("div",{className:"lycans-game-detail-grid",children:[e.jsxs("div",{className:"lycans-game-detail-section",children:[e.jsx("h4",{children:"Informations Générales"}),e.jsxs("div",{className:"lycans-game-detail-stats",children:[e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Partie moddée:"}),e.jsx("span",{className:"value",children:a.isModded?"Oui":"Non"})]}),e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Nombre de loups:"}),e.jsx("span",{className:"value",children:a.wolfCount})]}),e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Traître:"}),e.jsx("span",{className:"value",children:a.hasTraitor?"Oui":"Non"})]}),e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Amoureux:"}),e.jsx("span",{className:"value",children:a.hasLovers?"Oui":"Non"})]}),a.soloRoles&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Rôles solo:"}),e.jsx("span",{className:"value",children:a.soloRoles})]})]})]}),e.jsxs("div",{className:"lycans-game-detail-section",children:[e.jsx("h4",{children:"Informations Supplémentaires"}),e.jsxs("div",{className:"lycans-game-detail-stats",children:[a.versions&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Version:"}),e.jsx("span",{className:"value",children:a.versions})]}),a.map&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Map:"}),e.jsx("span",{className:"value",children:a.map})]}),a.startTime&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Début:"}),e.jsx("span",{className:"value",children:a.startTime})]}),a.endTime&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Fin:"}),e.jsx("span",{className:"value",children:a.endTime})]})]})]}),e.jsxs("div",{className:"lycans-game-detail-section",children:[e.jsx("h4",{children:"Résultats"}),e.jsxs("div",{className:"lycans-game-detail-stats",children:[e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Survivants villageois:"}),e.jsx("span",{className:"value",children:a.villagerSurvivors})]}),e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Survivants loups:"}),e.jsx("span",{className:"value",children:a.wolfSurvivors})]}),a.loverSurvivors!==null&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Survivants amoureux:"}),e.jsx("span",{className:"value",children:a.loverSurvivors})]}),a.soloSurvivors!==null&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Survivants solo:"}),e.jsx("span",{className:"value",children:a.soloSurvivors})]}),e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Gagnants:"}),e.jsx("span",{className:"value",children:a.winners})]})]})]}),a.harvest!==null&&e.jsxs("div",{className:"lycans-game-detail-section",children:[e.jsx("h4",{children:"Récolte"}),e.jsxs("div",{className:"lycans-game-detail-stats",children:[e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Récolte:"}),e.jsx("span",{className:"value",children:a.harvest})]}),e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Total possible:"}),e.jsx("span",{className:"value",children:a.totalHarvest})]}),e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Pourcentage:"}),e.jsx("span",{className:"value",children:typeof a.harvestPercentage=="number"?(a.harvestPercentage*100).toFixed(1)+"%":"N/A"})]})]})]}),e.jsxs("div",{className:"lycans-game-detail-section full-width",children:[e.jsx("h4",{children:"Rôles des Joueurs"}),e.jsx("div",{className:"lycans-player-roles-grid",children:a.playerRoles.map((u,m)=>e.jsxs("div",{className:"lycans-player-role-item",children:[e.jsx("div",{className:"lycans-player-name",style:{color:D[u.camp]||"#fff"},children:u.player}),e.jsx("div",{className:"lycans-player-role",children:u.role}),e.jsx("div",{className:"lycans-player-camp",children:u.camp})]},m))})]})]})})}export{M as GameDetailsChart};
