import{u as w,r as D,j as s}from"./index-BgHXmNuz.js";import{u as I}from"./baseStatsHook-jvItowi9.js";import{p as A}from"./api-DmJeUsCZ.js";import{F as E,B as F,C as z,X as P,Y as R,a as T,b as k}from"./FullscreenChart-B4-ly98a.js";import{R as q,T as M}from"./CategoricalChart-CWY-YEVQ.js";function $(e){return e?["Loup","Tra√Ætre"].includes(e)?"Loup":["Idiot du Village","Cannibale","Agent","Espion","Scientifique","La B√™te","Chasseur de primes","Vaudou","Amoureux"].includes(e)?"Autres":"Villageois":"Villageois"}function B(e){return e||"Villageois"}function N(e){const c=new Set;return e.forEach(u=>{u.PlayerStats.forEach(r=>{c.add(r.Username.trim())})}),c}function U(e){const c={};return e.forEach(u=>{c[u]={currentVillageoisSeries:0,currentLoupsSeries:0,longestVillageoisSeries:null,longestLoupsSeries:null,currentWinSeries:0,longestWinSeries:null,currentWinCamps:[],currentLossSeries:0,longestLossSeries:null,currentLossCamps:[],lastCamp:null,lastWon:!1,villageoisSeriesStart:null,loupsSeriesStart:null,winSeriesStart:null,lossSeriesStart:null,currentVillageoisGameIds:[],currentLoupsGameIds:[],currentWinGameIds:[],currentLossGameIds:[]}}),c}function J(e,c,u,r,i){u==="Villageois"||u==="Loup"?(u==="Villageois"&&(e.lastCamp==="Villageois"?(e.currentVillageoisSeries++,e.currentVillageoisGameIds.push(r)):(e.currentVillageoisSeries=1,e.villageoisSeriesStart={game:r,date:i},e.currentVillageoisGameIds=[r]),(!e.longestVillageoisSeries||e.currentVillageoisSeries>e.longestVillageoisSeries.seriesLength)&&(e.longestVillageoisSeries={player:c,camp:"Villageois",seriesLength:e.currentVillageoisSeries,startGame:e.villageoisSeriesStart?.game||r,endGame:r,startDate:e.villageoisSeriesStart?.date||i,endDate:i,isOngoing:!1,gameIds:[...e.currentVillageoisGameIds]}),e.currentLoupsSeries=0,e.loupsSeriesStart=null,e.currentLoupsGameIds=[]),u==="Loup"&&(e.lastCamp==="Loup"?(e.currentLoupsSeries++,e.currentLoupsGameIds.push(r)):(e.currentLoupsSeries=1,e.loupsSeriesStart={game:r,date:i},e.currentLoupsGameIds=[r]),(!e.longestLoupsSeries||e.currentLoupsSeries>e.longestLoupsSeries.seriesLength)&&(e.longestLoupsSeries={player:c,camp:"Loups",seriesLength:e.currentLoupsSeries,startGame:e.loupsSeriesStart?.game||r,endGame:r,startDate:e.loupsSeriesStart?.date||i,endDate:i,isOngoing:!1,gameIds:[...e.currentLoupsGameIds]}),e.currentVillageoisSeries=0,e.villageoisSeriesStart=null,e.currentVillageoisGameIds=[]),e.lastCamp=u):(e.currentVillageoisSeries=0,e.currentLoupsSeries=0,e.villageoisSeriesStart=null,e.loupsSeriesStart=null,e.currentVillageoisGameIds=[],e.currentLoupsGameIds=[],e.lastCamp="Autres")}function y(e,c,u,r,i,o){if(u){if(e.lastWon?(e.currentWinSeries++,e.currentWinCamps.push(r),e.currentWinGameIds.push(i)):(e.currentWinSeries=1,e.currentWinCamps=[r],e.winSeriesStart={game:i,date:o},e.currentWinGameIds=[i]),!e.longestWinSeries||e.currentWinSeries>e.longestWinSeries.seriesLength){const a={};e.currentWinCamps.forEach(h=>{a[h]=(a[h]||0)+1}),e.longestWinSeries={player:c,seriesLength:e.currentWinSeries,startGame:e.winSeriesStart?.game||i,endGame:i,startDate:e.winSeriesStart?.date||o,endDate:o,campCounts:a,isOngoing:!1,gameIds:[...e.currentWinGameIds]}}e.lastWon=!0}else e.currentWinSeries=0,e.currentWinCamps=[],e.winSeriesStart=null,e.currentWinGameIds=[],e.lastWon=!1}function K(e,c,u,r,i,o){if(u)e.currentLossSeries=0,e.currentLossCamps=[],e.lossSeriesStart=null,e.currentLossGameIds=[];else if(e.currentLossSeries>0?(e.currentLossSeries++,e.currentLossCamps.push(r),e.currentLossGameIds.push(i)):(e.currentLossSeries=1,e.currentLossCamps=[r],e.lossSeriesStart={game:i,date:o},e.currentLossGameIds=[i]),!e.longestLossSeries||e.currentLossSeries>e.longestLossSeries.seriesLength){const a={};e.currentLossCamps.forEach(h=>{a[h]=(a[h]||0)+1}),e.longestLossSeries={player:c,seriesLength:e.currentLossSeries,startGame:e.lossSeriesStart?.game||i,endGame:i,startDate:e.lossSeriesStart?.date||o,endDate:o,campCounts:a,isOngoing:!1,gameIds:[...e.currentLossGameIds]}}}function X(e){const c=[],u=[],r=[],i=[];return Object.values(e).forEach(o=>{o.longestVillageoisSeries&&c.push(o.longestVillageoisSeries),o.longestLoupsSeries&&u.push(o.longestLoupsSeries),o.longestWinSeries&&r.push(o.longestWinSeries),o.longestLossSeries&&i.push(o.longestLossSeries)}),c.sort((o,a)=>a.seriesLength-o.seriesLength),u.sort((o,a)=>a.seriesLength-o.seriesLength),r.sort((o,a)=>a.seriesLength-o.seriesLength),i.sort((o,a)=>a.seriesLength-o.seriesLength),{longestVillageoisSeries:c.slice(0,20),longestLoupsSeries:u.slice(0,20),longestWinSeries:r.slice(0,20),longestLossSeries:i.slice(0,20)}}function Y(e,c){const u=[],r=[],i=[],o=[];Object.values(e).forEach(t=>{u.push(t.longestVillageoisSeries?.seriesLength||0),r.push(t.longestLoupsSeries?.seriesLength||0),i.push(t.longestWinSeries?.seriesLength||0),o.push(t.longestLossSeries?.seriesLength||0)});const a=c>0?u.reduce((t,n)=>t+n,0)/c:0,h=c>0?r.reduce((t,n)=>t+n,0)/c:0,d=c>0?i.reduce((t,n)=>t+n,0)/c:0,m=c>0?o.reduce((t,n)=>t+n,0)/c:0,p=u.filter(t=>t>=5).length,L=r.filter(t=>t>=3).length,f=i.filter(t=>t>=5).length,g=o.filter(t=>t>=5).length;return{averageVillageoisSeries:Math.round(a*10)/10,averageLoupsSeries:Math.round(h*10)/10,averageWinSeries:Math.round(d*10)/10,averageLossSeries:Math.round(m*10)/10,eliteVillageoisCount:p,eliteLoupsCount:L,eliteWinCount:f,eliteLossCount:g}}function H(e){if(e.length===0)return null;const c=[...e].sort((l,x)=>parseInt(l.Id)-parseInt(x.Id)),u=N(c),r=U(u);c.forEach(l=>{const x=l.Id,j=new Date(l.StartDate).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"}),C=parseInt(x);l.PlayerStats.forEach(S=>{const v=S.Username.trim();if(!v)return;const V=r[v],O=$(S.MainRoleInitial),b=S.Victorious,G=B(S.MainRoleInitial);J(V,v,O,C,j),y(V,v,b,G,C,j),K(V,v,b,G,C,j)})});const{longestVillageoisSeries:i,longestLoupsSeries:o,longestWinSeries:a,longestLossSeries:h}=X(r);Object.values(r).forEach(l=>{l.longestVillageoisSeries&&l.currentVillageoisSeries===l.longestVillageoisSeries.seriesLength&&l.currentVillageoisSeries>0&&(l.longestVillageoisSeries.isOngoing=!0),l.longestLoupsSeries&&l.currentLoupsSeries===l.longestLoupsSeries.seriesLength&&l.currentLoupsSeries>0&&(l.longestLoupsSeries.isOngoing=!0),l.longestWinSeries&&l.currentWinSeries===l.longestWinSeries.seriesLength&&l.currentWinSeries>0&&(l.longestWinSeries.isOngoing=!0),l.longestLossSeries&&l.currentLossSeries===l.longestLossSeries.seriesLength&&l.currentLossSeries>0&&(l.longestLossSeries.isOngoing=!0)});const d=Y(r,u.size);let m=0,p=0,L=0,f=0,g=0,t=0,n=0,W=0;return Object.values(r).forEach(l=>{l.currentVillageoisSeries>0&&m++,l.currentLoupsSeries>0&&p++,l.currentWinSeries>0&&L++,l.currentLossSeries>0&&f++,l.longestVillageoisSeries?.isOngoing&&g++,l.longestLoupsSeries?.isOngoing&&t++,l.longestWinSeries?.isOngoing&&n++,l.longestLossSeries?.isOngoing&&W++}),{longestVillageoisSeries:i,longestLoupsSeries:o,longestWinSeries:a,longestLossSeries:h,totalGamesAnalyzed:c.length,totalPlayersCount:u.size,activeVillageoisCount:m,activeLoupsCount:p,activeWinCount:L,activeLossCount:f,ongoingVillageoisCount:g,ongoingLoupsCount:t,ongoingWinCount:n,ongoingLossCount:W,...d}}function Q(){const{data:e,isLoading:c,error:u}=I(r=>H(r));return{data:e,isLoading:c,error:u}}function ne(){const{data:e,isLoading:c,error:u}=Q(),{navigateToGameDetails:r}=w(),[i,o]=D.useState("villageois"),a=D.useRef(null);if(c)return s.jsx("div",{className:"donnees-attente",children:"R√©cup√©ration des s√©ries de joueurs..."});if(u)return s.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",u]});if(!e)return s.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de s√©rie disponible"});const d=(()=>{switch(i){case"villageois":return e.longestVillageoisSeries.slice(0,20);case"loup":return e.longestLoupsSeries.slice(0,20);case"wins":return e.longestWinSeries.slice(0,20);case"losses":return e.longestLossSeries.slice(0,20);default:return[]}})(),m=g=>Object.entries(g).map(([t,n])=>`${t} (${n})`).join(", "),p=()=>{switch(i){case"villageois":return"Plus Longues S√©ries Villageois Cons√©cutives";case"loup":return"Plus Longues S√©ries Loups Cons√©cutives";case"wins":return"Plus Longues S√©ries de Victoires";case"losses":return"Plus Longues S√©ries de D√©faites";default:return""}},L=({active:g,payload:t})=>{if(!g||!t||t.length===0)return null;const n=t[0].payload;return i==="wins"?s.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[s.jsxs("div",{children:[s.jsx("strong",{children:n.player}),n.isOngoing&&s.jsx("span",{style:{marginLeft:"8px",fontSize:"1.2em"},children:"üî•"})]}),s.jsxs("div",{children:["S√©rie de victoires : ",n.seriesLength," parties ",n.isOngoing?"(En cours)":""]}),s.jsxs("div",{children:["Du jeu #",n.startGame," au jeu #",n.endGame]}),s.jsxs("div",{children:["Du ",n.startDate," au ",n.endDate]}),s.jsxs("div",{children:["Camps jou√©s : ",m(n.campCounts)]}),n.isOngoing&&s.jsx("div",{style:{fontSize:"0.8rem",color:"#FF8C00",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center"},children:"üî• S√©rie en cours - Aucun jeu depuis !"}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]}):i==="losses"?s.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[s.jsxs("div",{children:[s.jsx("strong",{children:n.player}),n.isOngoing&&s.jsx("span",{style:{marginLeft:"8px",fontSize:"1.2em"},children:"üî•"})]}),s.jsxs("div",{children:["S√©rie de d√©faites : ",n.seriesLength," parties ",n.isOngoing?"(En cours)":""]}),s.jsxs("div",{children:["Du jeu #",n.startGame," au jeu #",n.endGame]}),s.jsxs("div",{children:["Du ",n.startDate," au ",n.endDate]}),s.jsxs("div",{children:["Camps jou√©s : ",m(n.campCounts)]}),n.isOngoing&&s.jsx("div",{style:{fontSize:"0.8rem",color:"#FF8C00",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center"},children:"üî• S√©rie en cours - Aucun jeu depuis !"}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]}):s.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[s.jsxs("div",{children:[s.jsx("strong",{children:n.player}),n.isOngoing&&s.jsx("span",{style:{marginLeft:"8px",fontSize:"1.2em"},children:"üî•"})]}),s.jsxs("div",{children:["S√©rie ",n.camp," : ",n.seriesLength," parties cons√©cutives ",n.isOngoing?"(En cours)":""]}),s.jsxs("div",{children:["Du jeu #",n.startGame," au jeu #",n.endGame]}),s.jsxs("div",{children:["Du ",n.startDate," au ",n.endDate]}),n.isOngoing&&s.jsx("div",{style:{fontSize:"0.8rem",color:"#FF8C00",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center"},children:"üî• S√©rie en cours - Aucun jeu depuis !"}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})},f=g=>{if(i==="wins")r({selectedPlayer:g.player,selectedGameIds:g.gameIds,fromComponent:"S√©ries de Victoires"});else if(i==="losses")r({selectedPlayer:g.player,selectedGameIds:g.gameIds,fromComponent:"S√©ries de D√©faites"});else{const t=i==="villageois"?"Villageois":"Loup";r({selectedPlayer:g.player,selectedGameIds:g.gameIds,campFilter:{selectedCamp:t,campFilterMode:"wins-only"},fromComponent:`S√©ries ${t}`})}};return s.jsxs("div",{className:"lycans-players-series",children:[s.jsx("h2",{children:"S√©ries des Joueurs"}),s.jsxs("p",{className:"lycans-stats-info",children:["Bas√© sur ",e.totalGamesAnalyzed," parties analys√©es"]}),s.jsx("div",{className:"lycans-section-description",children:s.jsxs("p",{children:[s.jsx("strong",{children:"S√©ries de camps :"})," Parties cons√©cutives dans le m√™me camp principal (Villageois ou Loups). Jouer dans n'importe quel autre camp brise la s√©rie.",s.jsx("br",{}),s.jsx("strong",{children:"S√©ries de victoires :"})," Victoires cons√©cutives dans n'importe quel camp. Une d√©faite brise la s√©rie.",s.jsx("br",{}),s.jsx("strong",{children:"S√©ries de d√©faites :"})," D√©faites cons√©cutives dans n'importe quel camp. Une victoire brise la s√©rie.",s.jsx("br",{}),s.jsx("strong",{children:"üî• S√©ries en cours :"})," Les s√©ries avec l'effet de flamme sont encore actives"]})}),s.jsxs("div",{className:"lycans-categories-selection",children:[s.jsx("button",{className:`lycans-categorie-btn ${i==="villageois"?"active":""}`,onClick:()=>o("villageois"),children:"S√©ries Villageois"}),s.jsx("button",{className:`lycans-categorie-btn ${i==="loup"?"active":""}`,onClick:()=>o("loup"),children:"S√©ries Loups"}),s.jsx("button",{className:`lycans-categorie-btn ${i==="wins"?"active":""}`,onClick:()=>o("wins"),children:"S√©ries de Victoires"}),s.jsx("button",{className:`lycans-categorie-btn ${i==="losses"?"active":""}`,onClick:()=>o("losses"),children:"S√©ries de D√©faites"})]}),s.jsxs("div",{className:"lycans-graphique-section",children:[s.jsx(E,{title:p(),children:s.jsx("div",{ref:a,style:{height:500},children:s.jsx(q,{width:"100%",height:"100%",children:s.jsxs(F,{data:d,margin:{top:20,right:30,left:20,bottom:10},children:[s.jsx(z,{strokeDasharray:"3 3"}),s.jsx(P,{dataKey:"player",angle:-45,textAnchor:"end",height:120,interval:0}),s.jsx(R,{label:{value:i==="wins"?"Victoires cons√©cutives":i==="losses"?"D√©faites cons√©cutives":"Parties cons√©cutives",angle:-90,position:"insideLeft"}}),s.jsx(M,{content:L}),s.jsx(T,{dataKey:"seriesLength",name:i==="wins"?"Victoires cons√©cutives":i==="losses"?"D√©faites cons√©cutives":"Parties cons√©cutives",fill:i==="villageois"?"#82ca9d":i==="loup"?"#FF8042":i==="wins"?"#8884d8":"#dc3545",children:d.map((g,t)=>s.jsx(k,{fill:A[g.player]||(i==="villageois"?"#82ca9d":i==="loup"?"#FF8042":i==="wins"?"#8884d8":"#dc3545"),onClick:()=>f(g),style:{cursor:"pointer"},className:g.isOngoing?"lycans-ongoing-series":""},`cell-${i}-${t}`))})]})})})}),d.length>0&&s.jsxs("div",{className:"lycans-stats-grid",style:{marginTop:"0rem",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))"},children:[s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"üèÜ Record Absolu"}),s.jsxs("div",{className:"lycans-stat-value",children:[d[0].seriesLength,d[0].isOngoing&&s.jsx("span",{style:{fontSize:"0.6em",marginLeft:"5px"},children:"üî•"})]}),s.jsxs("p",{children:["par ",s.jsx("strong",{children:d[0].player}),d[0].isOngoing&&s.jsx("span",{style:{color:"#FF8C00",fontWeight:"bold"},children:" (En cours)"})]}),i==="wins"?s.jsxs("p",{className:"lycans-h2h-description",children:["Camps : ",m(d[0].campCounts||{})]}):s.jsxs("p",{className:"lycans-h2h-description",children:["Camp : ",d[0].camp]})]}),s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"üìä Meilleure s√©rie moyenne (tous les joueurs)"}),s.jsx("div",{className:"lycans-stat-value",children:i==="villageois"?e.averageVillageoisSeries:i==="loup"?e.averageLoupsSeries:i==="wins"?e.averageWinSeries:e.averageLossSeries}),s.jsx("p",{children:"parties en moyenne"}),s.jsxs("p",{className:"lycans-h2h-description",children:["Bas√© sur ",e.totalPlayersCount," joueurs"]})]}),s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"üî• S√©ries En Cours"}),s.jsx("div",{className:"lycans-stat-value",children:i==="villageois"?e.activeVillageoisCount:i==="loup"?e.activeLoupsCount:i==="wins"?e.activeWinCount:e.activeLossCount}),s.jsx("p",{children:"s√©ries encore actives"}),s.jsx("p",{className:"lycans-h2h-description",children:(i==="villageois"?e.activeVillageoisCount:i==="loup"?e.activeLoupsCount:i==="wins"?e.activeWinCount:e.activeLossCount)>0?"Joueurs actuellement dans une s√©rie de ce type":"Aucune s√©rie active de ce type"})]})]}),d.length===0&&s.jsxs("div",{className:"lycans-empty-section",children:[s.jsx("h3",{children:"Aucune s√©rie trouv√©e"}),s.jsx("p",{children:"Aucune s√©rie n'a √©t√© trouv√©e pour ce type avec les filtres actuels."})]})]})]})}export{ne as PlayerSeriesChart};
