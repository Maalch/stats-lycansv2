import{g as Q,r as L,a as X,j as s,u as ae}from"./index-DgkQJN4A.js";import{b as te}from"./baseStatsHook-BonI0wDE.js";import{g as B,a as ne}from"./gameUtils-CCGRmivF.js";import{g as P,a as N}from"./datasyncExport-D6_8Fmuy.js";import{a as J,b as le,c as O}from"./api-D58T1NK3.js";import{g as re}from"./deathTypes-T5wVOxX_.js";import{u as ie,g as oe,a as ce,C as de,f as Y,b as ue}from"./useClips-Dhd1ZnKW.js";import{c as me}from"./durationFormatters-C9UyWcKX.js";function he(e,t){if(!e)return null;try{const n=new URL(e);let r="",a=0;if(n.hostname==="youtu.be"){r=n.pathname.slice(1);const h=n.searchParams.get("t");h&&(a=parseInt(h,10)||0)}else if(n.hostname==="www.youtube.com"||n.hostname==="youtube.com"){r=n.searchParams.get("v")||"";const h=n.searchParams.get("t");h&&(a=parseInt(h,10)||0)}return r?`https://www.youtube.com/embed/${r}?start=${a}`:null}catch{return null}}function pe(e){if(!e||Object.keys(e).length===0)return null;const t={};return Object.entries(e).forEach(([n,r])=>{if(r&&typeof r=="string"&&r.trim()){const a=he(r,null);a&&(t[n]=a)}}),Object.keys(t).length>0?t:null}function ye(e,t){if(!e||!t)return null;try{const n=new Date(e),r=new Date(t);if(isNaN(n.getTime())||isNaN(r.getTime()))return null;const a=r.getTime()-n.getTime();return a>0?Math.round(a/1e3):null}catch{return null}}function fe(e,t,n=!1,r=!1){const a=e.toLowerCase(),l=t.PlayerStats.find(d=>d.Username.toLowerCase()===a);return l?P(N(l.MainRoleInitial,l.MainRoleChanges||[]),{regroupLovers:!0,regroupVillagers:!r,regroupWolfSubRoles:!n}):"Villageois"}function ge(e,t,n){const r=e.toLowerCase(),a=n.PlayerStats.find(h=>h.Username.toLowerCase()===r);return a?P(N(a.MainRoleInitial,a.MainRoleChanges||[]))===t:!1}function _(e,t,n){const r=e.filter(a=>a.PlayerStats.some(l=>l.Username.toLowerCase()===t.toLowerCase()));return!n||n==="all-assignments"?r:n==="wins-only"?r.filter(a=>a.PlayerStats.some(l=>l.Username.toLowerCase()===t.toLowerCase()&&l.Victorious)):r}function Ce(e,t){return e.filter(n=>n.DisplayedId===t)}function xe(e,t){return e.filter(n=>t.includes(n.DisplayedId))}function je(e,t){return e.filter(n=>{const a=new Date(n.StartDate).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});if(t.includes("/")&&t.split("/").length===2){const[l,h]=t.split("/"),d=a.split("/");if(d.length===3){const[,y,f]=d;return y===l&&f===h}}else return a===t;return!1})}function ve(e,t){return e.filter(n=>n.LegacyData?.VictoryType===t)}function Pe(e,t){return e.filter(n=>t==="Village"||t==="Ch√¢teau"?n.MapName===t:t==="Autres"?n.MapName!=="Village"&&n.MapName!=="Ch√¢teau":n.MapName===t)}function we(e,t,n){return e.filter(r=>r.Modded?r.PlayerStats.some(a=>{if(a.MainRoleInitial==="Inconnu"||n&&!(Q(a)===n||a.Username.toLowerCase()===n.toLowerCase()))return!1;const l=P(a.MainRoleInitial),h=l==="Loup"||l==="Tra√Ætre"||l==="Louveteau";return l==="Villageois"&&(a.MainRoleInitial==="Chasseur"||a.MainRoleInitial==="Alchimiste")?a.MainRoleInitial===t:t==="Aucun pouvoir"?(l==="Villageois"||h)&&(!a.Power||a.Power.trim()==="")&&a.Power!=="Inconnu":a.Power===t}):!1)}function Ne(e,t,n){return e.filter(r=>r.Modded?r.PlayerStats.some(a=>a.MainRoleInitial==="Inconnu"||n&&!(Q(a)===n||a.Username.toLowerCase()===n.toLowerCase())?!1:a.SecondaryRole===t):!1)}function be(e,t){return e.filter(n=>{const r=n.HarvestGoal,a=n.HarvestDone;if(r==null||a===null||a===void 0||r===0)return!1;const l=a/r*100;switch(t){case"0-25%":return l>=0&&l<=25;case"26-50%":return l>25&&l<=50;case"51-75%":return l>50&&l<=75;case"76-99%":return l>75&&l<=99;case"100%":return l>=100;default:return!0}})}function Re(e,t){return e.filter(n=>{if(!n.EndTiming)return!1;const r=n.EndTiming.match(/(?:Nuit|Jour)\s+(\d+)/);return r?parseInt(r[1],10)===t:!1})}function Ie(e,t,n){const{selectedCamp:r,campFilterMode:a,_smallCamps:l,excludeWolfSubRoles:h}=t;return e.filter(d=>{if(n){if(r==="Autres"&&l)return l.some(c=>ge(n,c,d))?a==="wins-only"?d.PlayerStats.find(I=>I.Username.toLowerCase()===n.toLowerCase())?.Victorious===!0:!0:!1;const y=fe(n,d,h);let f=!1;return r==="Loup"&&h?f=y==="Loup"&&!d.PlayerStats.some(m=>m.Username.toLowerCase()===n.toLowerCase()&&(N(m.MainRoleInitial,m.MainRoleChanges||[])==="Tra√Ætre"||N(m.MainRoleInitial,m.MainRoleChanges||[])==="Louveteau")):f=y===r,f?a==="wins-only"?d.PlayerStats.find(c=>c.Username.toLowerCase()===n.toLowerCase())?.Victorious===!0:!0:!1}else if(a==="wins-only"){const y=B(d);return r==="Autres"&&l?l.includes(y):y===r}else return r==="Autres"&&l?l.some(y=>d.PlayerStats.some(f=>P(N(f.MainRoleInitial,f.MainRoleChanges||[]))===y)):d.PlayerStats.some(y=>P(N(y.MainRoleInitial,y.MainRoleChanges||[]))===r)})}function De(e,t,n){const{selectedPlayers:r,playersFilterMode:a,winnerPlayer:l}=t;return e.filter(h=>{const d=h.PlayerStats.flatMap(m=>[m.Username.toLowerCase(),(m.ID??m.Username).toLowerCase()]);if(!r.every(m=>d.includes(m.toLowerCase())))return!1;const f=r.map(m=>{const c=m.toLowerCase(),I=h.PlayerStats.find(g=>{const u=(g.ID??g.Username).toLowerCase();return g.Username.toLowerCase()===c||u===c}),o=N(I?.MainRoleInitial||"",I?.MainRoleChanges||[]);return P(o,{regroupWolfSubRoles:n?.excludeWolfSubRoles||!1})});switch(a){case"all-common-games":if(l){const u=l.toLowerCase();return h.PlayerStats.find(j=>{const x=(j.ID??j.Username).toLowerCase();return j.Username.toLowerCase()===u||x===u})?.Victorious===!0}return!0;case"opposing-camps":if(!([...new Set(f)].length>1))return!1;if(l){const u=r.findIndex(C=>C.toLowerCase()===l.toLowerCase());if(u!==-1){const C=f[u],j=B(h);return C==="Agent"&&j==="Agent"?h.PlayerStats.find(b=>b.Username.toLowerCase()===l.toLowerCase())?.Victorious===!0:C===j}}return!0;case"same-camp":if(!([...new Set(f)].length===1))return!1;const g=f[0];if(n&&n.selectedCamp){const u=n.selectedCamp;if(g!==u)return!1}if(l){const u=B(h);return g==="Agent"&&u==="Agent"?r.every(C=>h.PlayerStats.find(x=>x.Username.toLowerCase()===C.toLowerCase())?.Victorious===!0):g===u}return!0;default:return!0}})}function Me(e,t){const{selectedPlayerPair:n,selectedPairRole:r}=t;return n.length!==2?e:e.filter(a=>{const l=a.PlayerStats.flatMap(d=>[d.Username.toLowerCase(),(d.ID??d.Username).toLowerCase()]);if(!n.every(d=>l.includes(d.toLowerCase())))return!1;switch(r){case"wolves":return n.every(d=>{const y=d.toLowerCase(),f=a.PlayerStats.find(m=>{const c=(m.ID??m.Username).toLowerCase();return m.Username.toLowerCase()===y||c===y});return P(N(f?.MainRoleInitial||"",f?.MainRoleChanges||[]))==="Loup"});case"lovers":return n.every(d=>{const y=d.toLowerCase(),f=a.PlayerStats.find(m=>{const c=(m.ID??m.Username).toLowerCase();return m.Username.toLowerCase()===y||c===y});return P(N(f?.MainRoleInitial||"",f?.MainRoleChanges||[]))==="Amoureux"});default:return!0}})}function Le(e,t,n){const r=t&&(t.selectedPlayer||t.selectedGame||t.selectedVictoryType||t.selectedDate||t.selectedHarvestRange||t.selectedGameDuration||t.selectedGameIds&&t.selectedGameIds.length>0||t.selectedMapName||t.selectedPower||t.selectedSecondaryRole||t.campFilter||t.playerPairFilter||t.multiPlayerFilter);if(!r&&n)return _(e,n,"all-assignments");if(!r)return e;let a=[...e];return t.selectedPlayer&&(a=_(a,t.selectedPlayer,t.selectedPlayerWinMode)),t.selectedGame&&(a=Ce(a,t.selectedGame)),t.selectedGameIds&&(a=xe(a,t.selectedGameIds)),t.campFilter&&(a=Ie(a,t.campFilter,t.selectedPlayer)),t.selectedDate&&(a=je(a,t.selectedDate)),t.selectedHarvestRange&&(a=be(a,t.selectedHarvestRange)),t.selectedVictoryType&&(a=ve(a,t.selectedVictoryType)),t.selectedGameDuration&&(a=Re(a,t.selectedGameDuration)),t.selectedMapName&&(a=Pe(a,t.selectedMapName)),t.selectedPower&&(a=we(a,t.selectedPower,t.selectedPlayer)),t.selectedSecondaryRole&&(a=Ne(a,t.selectedSecondaryRole,t.selectedPlayer)),t.multiPlayerFilter&&(a=De(a,t.multiPlayerFilter,t.campFilter)),t.playerPairFilter&&(a=Me(a,t.playerPairFilter)),a}function Se(e,t,n){return e.length===0?null:Le(e,t,n).map(a=>{const l=a.PlayerStats.length,h=a.PlayerStats.filter(p=>P(N(p.MainRoleInitial,p.MainRoleChanges||[]))==="Loup"),d=a.PlayerStats.filter(p=>P(N(p.MainRoleInitial,p.MainRoleChanges||[]))==="Tra√Ætre"),y=a.PlayerStats.filter(p=>P(N(p.MainRoleInitial,p.MainRoleChanges||[]))==="Louveteau"),f=a.PlayerStats.filter(p=>P(N(p.MainRoleInitial,p.MainRoleChanges||[]))==="Amoureux"),m=a.PlayerStats.filter(p=>p.Victorious),c=h.length+d.length+y.length,I=B(a),o=["Loup","Villageois","Tra√Ætre","Louveteau"],g=a.PlayerStats.filter(p=>!o.includes(P(p.MainRoleInitial))),u=[...new Set(g.map(p=>P(p.MainRoleInitial)))],C=u.length>0?u.join(", "):null,x=new Date(a.StartDate).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});let b=0;if(a.EndTiming){const p=a.EndTiming.match(/[UNJMC](\d+)/);p&&(b=parseInt(p[1],10))}let M=null;return a.HarvestGoal&&a.HarvestGoal>0&&(M=a.HarvestDone/a.HarvestGoal),{gameId:a.DisplayedId,date:x,isModded:a.Modded||!1,playerCount:l,wolfCount:c,hasTraitor:d.length>0,traitorsCount:d.length,hasWolfCub:y.length>0,wolfCubsCount:y.length,hasLovers:f.length>0,soloRoles:C,winningCamp:I,dayCount:b,winners:m.map(p=>p.Username).join(", "),harvest:a.HarvestDone,totalHarvest:a.HarvestGoal,harvestPercentage:M,playersList:a.PlayerStats.map(p=>p.Username).join(", "),versions:a.Version||null,map:a.MapName,victoryType:a.LegacyData?.VictoryType||null,playerVODs:pe(a.LegacyData?.PlayerVODs),gameDuration:ye(a.StartDate,a.EndDate),playerData:a.PlayerStats,clips:a.Clips||[]}})}function Fe(e,t){const{data:n,isLoading:r,error:a}=te(l=>Se(l,e,t));return{data:n||[],isLoading:r,error:a}}const Te=({playerData:e})=>{const t=J(),n=le(),r=e.reduce((l,h)=>{const d=P(N(h.MainRoleInitial,h.MainRoleChanges||[]));return l[d]||(l[d]=[]),l[d].push(h),l},{}),a=Object.entries(r).sort(([l,h],[d,y])=>{const f=O.includes(l),m=O.includes(d);return f&&!m?-1:!f&&m?1:y.length-h.length});return s.jsxs("div",{className:"lycans-game-detail-section full-width",children:[s.jsx("h4",{children:"Composition des Camps"}),s.jsx("div",{className:"camps-grid",children:a.map(([l,h])=>{const d=h,y=t[l]||"#666",m=d.filter(c=>c.Victorious).length>0;return s.jsxs("div",{className:`camp-group ${m?"winning-camp":""}`,style:{borderColor:y,backgroundColor:`${y}15`,boxShadow:m?`0 0 10px ${y}40`:"none"},children:[s.jsx("div",{className:"camp-header",style:{backgroundColor:`${y}25`},children:s.jsxs("h5",{style:{color:y},children:[l," (",d.length,")",m&&s.jsx("span",{className:"victory-crown",children:"üëë"})]})}),s.jsx("div",{className:"camp-players",children:d.sort((c,I)=>c.Username.localeCompare(I.Username)).map(c=>{let I=y;c.Color&&n[c.Color]&&(I=n[c.Color]);let o="";return c.DeathTiming&&(o=` (Mort ${ne(c.DeathTiming)}`,c.DeathType&&(o+=` - ${re(c.DeathType)}`),c.KillerName&&(o+=` - Tueur ${c.KillerName}`),o+=")"),s.jsxs("div",{className:`player-badge ${c.Victorious?"winner":""} ${c.DeathTiming?"dead":"alive"}`,style:{borderColor:I},title:`${c.Username} - ${P(c.MainRoleInitial)!==P(N(c.MainRoleInitial,c.MainRoleChanges||[]))?`${P(c.MainRoleInitial)} puis ${P(N(c.MainRoleInitial,c.MainRoleChanges||[]))}`:P(c.MainRoleInitial)}${o}`,children:[s.jsx("span",{className:"gamedetails-player-name",children:c.Username}),c.DeathTiming&&s.jsx("span",{className:"death-indicator",children:"üíÄ"}),c.Victorious&&s.jsx("span",{className:"victory-indicator",children:"‚≠ê"})]},c.Username)})})]},l)})})]})};function Ge(e){if(e===null||e<=0)return"N/A";const t=Math.floor(e/60),n=e%60;return t===0?`${n}s`:n===0?`${t}m`:`${t}m ${n}s`}function Ve({game:e}){const[t,n]=L.useState(!1),[r,a]=L.useState(null),[l,h]=L.useState(null),d=J(),{clips:y}=ie(),{settings:f}=X(),m=L.useMemo(()=>{const o=[];return e.playerVODs&&typeof e.playerVODs=="object"&&Object.entries(e.playerVODs).forEach(([g,u])=>{if(typeof u=="string"&&u.trim()){const C=e.playerData?.find(M=>M.ID===g),j=C?.Username||g;let x="#666",b="#666";if(C){const M=P(N(C.MainRoleInitial,C.MainRoleChanges||[])),p=N(C.MainRoleInitial,C.MainRoleChanges||[]);x=d[M]||"#666",b=d[p]||"#666",b==="#666"&&(b=d[M]||"#666")}o.push({label:`${j}`,url:u,playerId:g,borderColor:x,textColor:b})}}),o},[e.playerVODs,e.playerData,d]);L.useEffect(()=>{if(t&&m.length>0&&!r){if(m.length===1)a(m[0].url);else if(f.highlightedPlayer){const o=m.find(g=>g.label.toLowerCase()===f.highlightedPlayer?.toLowerCase());o&&a(o.url)}}},[t,m,r,f.highlightedPlayer]);const c=m.length>0,I=m.length>1;return s.jsxs("div",{className:"lycans-game-detail-view",children:[s.jsxs("div",{className:"lycans-game-detail-grid",children:[s.jsxs("div",{className:"lycans-game-detail-section",children:[s.jsx("h4",{children:"Informations G√©n√©rales"}),s.jsxs("div",{className:"lycans-game-detail-stats",children:[s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Nombre de joueurs:"}),s.jsx("span",{className:"value",children:e.playerCount})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Nombre de loups:"}),s.jsx("span",{className:"value",children:e.wolfCount})]}),(e.hasTraitor||e.hasWolfCub)&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"R√¥les sp√©ciaux loup:"}),s.jsx("span",{className:"value",children:[e.hasTraitor&&`Tra√Ætre (${e.traitorsCount})`,e.hasWolfCub&&`Louveteau (${e.wolfCubsCount})`].filter(Boolean).join(", ")})]}),e.soloRoles&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"R√¥les solo:"}),s.jsx("span",{className:"value",children:e.soloRoles})]})]})]}),s.jsxs("div",{className:"lycans-game-detail-section",children:[s.jsx("h4",{children:"Informations Suppl√©mentaires"}),s.jsxs("div",{className:"lycans-game-detail-stats",children:[e.victoryType!==null&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Type de victoire:"}),s.jsx("span",{className:"value",children:e.victoryType})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Jours de jeu:"}),s.jsx("span",{className:"value",children:e.dayCount})]}),e.gameDuration!==null&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Dur√©e de la partie:"}),s.jsx("span",{className:"value",children:Ge(e.gameDuration)})]}),e.versions&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Version:"}),s.jsxs("span",{className:"value",children:[e.versions,e.isModded?" (modd√©e)":""]})]}),e.map&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Map:"}),s.jsx("span",{className:"value",children:e.map})]})]})]}),e.harvest!==null&&s.jsxs("div",{className:"lycans-game-detail-section",children:[s.jsx("h4",{children:"R√©colte"}),s.jsxs("div",{className:"lycans-game-detail-stats",children:[s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"R√©colte:"}),s.jsx("span",{className:"value",children:e.harvest})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Total possible:"}),s.jsx("span",{className:"value",children:e.totalHarvest})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Pourcentage:"}),s.jsx("span",{className:"value",children:typeof e.harvestPercentage=="number"?(e.harvestPercentage*100).toFixed(1)+"%":"N/A"})]})]})]}),s.jsx(Te,{playerData:e.playerData}),s.jsxs("div",{className:"lycans-game-detail-section full-width",children:[s.jsx("h4",{children:"R√¥les des Joueurs"}),s.jsx("div",{className:"lycans-player-roles-grid",children:e.playerData.sort((o,g)=>{const u=P(N(o.MainRoleInitial,o.MainRoleChanges||[])),C=P(N(g.MainRoleInitial,g.MainRoleChanges||[])),j=O.indexOf(u),x=O.indexOf(C);return j!==-1&&x!==-1?j-x:j!==-1?-1:x!==-1?1:u!==C?u.localeCompare(C):o.Username.localeCompare(g.Username)}).map(o=>{const g=P(o.MainRoleInitial),u=o.MainRoleInitial,C=P(N(o.MainRoleInitial,o.MainRoleChanges||[])),j=N(o.MainRoleInitial,o.MainRoleChanges||[]),x=o.Power,b=o.SecondaryRole;let M=g;u&&u!==g&&(M+=` - ${u}`),x&&x.trim()&&(M+=` - ${x}`),b&&b.trim()&&(M+=` + ${b}`),j&&j!==u&&(M+=` (devient ${j})`);let p=d[N(o.MainRoleInitial,o.MainRoleChanges||[])]||"#666";p==="#666"&&(p=d[C]||"#666");const V=d[C]||"#666",q=o.DeathTiming,k=o.Victorious;return s.jsxs("div",{className:`lycans-player-role-item ${k?"victorious":""}`,style:{borderColor:V},children:[s.jsxs("div",{className:"lycans-player-name",style:{color:p,textAlign:"left"},children:[o.Username,q&&s.jsx("span",{className:"death-skull",children:"üíÄ"})]}),s.jsx("div",{className:"lycans-player-camp",style:{textAlign:"left"},children:M})]},o.Username)})})]}),c&&s.jsx("div",{className:"lycans-game-detail-section full-width",children:s.jsx("button",{onClick:()=>n(!t),className:"lycans-video-toggle-btn",children:t?"üìπ Masquer la vid√©o":"üé• Voir la vid√©o"})}),c&&t&&s.jsxs("div",{className:"lycans-game-detail-section full-width",children:[s.jsx("h4",{children:"Vid√©o de la Partie"}),I&&s.jsx("nav",{className:"lycans-vod-menu",children:m.map((o,g)=>s.jsx("button",{className:`lycans-vod-btn${r===o.url?" active":""}`,onClick:()=>a(o.url),type:"button",title:o.label,style:{borderColor:o.borderColor,color:r===o.url?"white":o.textColor},children:o.label},g))}),s.jsx("div",{className:"lycans-youtube-container",children:r?s.jsx("iframe",{src:r,title:`Partie Lycans #${e.gameId}`,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"lycans-youtube-iframe"}):s.jsx("div",{className:"lycans-vod-placeholder",children:s.jsx("p",{children:"S√©lectionnez une VOD de joueur pour commencer"})})})]}),f.clipsEnabled&&e.clips&&e.clips.length>0&&s.jsxs("div",{className:"lycans-game-detail-section full-width",children:[s.jsxs("h4",{children:["üé¨ Clips de la Partie (",e.clips.length,")"]}),(()=>{const o=oe(e.clips);return Array.from(o.keys()).sort().map(u=>{const C=o.get(u),j=u!=="Sans cat√©gorie";return s.jsxs("div",{className:"lycans-clips-tag",children:[j&&s.jsx("h5",{className:"lycans-clips-tag-title",children:u}),s.jsx("div",{className:"lycans-clips-grid",children:C.map(x=>s.jsxs("button",{className:"lycans-clip-card",onClick:()=>h(x),children:[s.jsxs("div",{className:"lycans-clip-card-header",children:[s.jsx("span",{className:"lycans-clip-icon",children:"üé¨"}),s.jsx("span",{className:"lycans-clip-name",children:ce(x)})]}),s.jsxs("div",{className:"lycans-clip-card-pov",children:["POV: ",x.POVPlayer]}),x.AdditionalInfo&&s.jsx("div",{className:"lycans-clip-card-info",children:x.AdditionalInfo.length>60?`${x.AdditionalInfo.substring(0,60)}...`:x.AdditionalInfo})]},x.ClipId))})]},u)})})()]})]}),l&&s.jsx(de,{clip:l,onClose:()=>h(null),relatedClips:ue(l,y),nextClip:Y(l,y),onNextClip:()=>{const o=Y(l,y);o&&h(o)},onRelatedClip:o=>{const g=y.find(u=>u.ClipId===o);g&&h(g)}})]})}function He(){const{navigationFilters:e,navigateBack:t}=ae(),{settings:n}=X(),r=!!(e.selectedPlayer||e.selectedGame||e.selectedVictoryType||e.selectedDate||e.selectedHarvestRange||e.selectedGameDuration||e.selectedGameIds&&e.selectedGameIds.length>0||e.selectedMapName||e.selectedPower||e.campFilter||e.playerPairFilter||e.multiPlayerFilter),a=r?null:n.highlightedPlayer,{data:l,isLoading:h,error:d}=Fe(e,a),y=J(),[f,m]=L.useState("date"),[c,I]=L.useState("desc"),[o,g]=L.useState(null),[u,C]=L.useState(1),[j,x]=L.useState(25),b=L.useRef(!1),p=e.selectedPlayer?[e.selectedPlayer]:e.playerPairFilter?.selectedPlayerPair?e.playerPairFilter.selectedPlayerPair:e.multiPlayerFilter?.selectedPlayers?e.multiPlayerFilter.selectedPlayers:n.highlightedPlayer?[n.highlightedPlayer]:[],V=p.length>0,q=()=>p.length===0?"Vainqueur":p.length===1?p[0]+" (victoire)":p.length===2?p.join(" & ")+" (victoires)":`${p.slice(0,2).join(" & ")} (+${p.length-2}) (victoires)`,k=i=>{if(!V)return"";if(!r&&a)return(i.winners?i.winners.split(",").map(E=>E.trim()):[]).filter(E=>p.some(se=>se.toLowerCase()===E.toLowerCase())).length>0?"‚úÖ":"‚ùå";const w=i.playersList?i.playersList.split(",").map(D=>D.trim()):[];return p.filter(D=>w.some(T=>T.toLowerCase()===D.toLowerCase())).length===0?"Pas dans la partie":(i.winners?i.winners.split(",").map(D=>D.trim()):[]).filter(D=>p.some(T=>T.toLowerCase()===D.toLowerCase())).length>0?"‚úÖ":"‚ùå"},$=L.useMemo(()=>l?[...l].sort((i,w)=>{let v,R;switch(f){case"date":v=new Date(i.date.split("/").reverse().join("-")).getTime(),R=new Date(w.date.split("/").reverse().join("-")).getTime();break;case"gameId":v=parseInt(i.gameId,10),R=parseInt(w.gameId,10);break;case"playerCount":v=i.playerCount,R=w.playerCount;break;case"gameDuration":v=i.gameDuration||0,R=w.gameDuration||0;break;case"winningCamp":v=i.winningCamp,R=w.winningCamp;break;case"winner":v=k(i),R=k(w);break;default:return 0}let S;if(c==="asc"?S=v>R?1:v<R?-1:0:S=v<R?1:v>R?-1:0,S===0){const D=parseInt(i.gameId,10),T=parseInt(w.gameId,10);return c==="asc"?D-T:T-D}return S}):[],[l,f,c]),F=Math.ceil($.length/j),W=(u-1)*j,H=W+j,Z=$.slice(W,H);L.useEffect(()=>{if(b.current){b.current=!1;return}C(1),g(null)},[l]),L.useEffect(()=>{C(1),g(null)},[f,c]);const G=i=>{b.current=!0,C(i),g(null)},ee=i=>{b.current=!0,x(i),C(1),g(null)},z=i=>{b.current=!0,g(o===i?null:i)},U=i=>{f===i?I(c==="asc"?"desc":"asc"):(m(i),I("desc"))},A=i=>f!==i?"‚ÜïÔ∏è":c==="asc"?"‚ÜóÔ∏è":"‚ÜòÔ∏è",K=()=>{const i=[];if(e.selectedPlayer&&e.campFilter){const w=e.selectedPlayerWinMode==="wins-only"?" (victoires uniquement)":"";let v=e.campFilter.selectedCamp;e.campFilter.selectedCamp==="Loup"&&e.campFilter.excludeWolfSubRoles?v="Loups sans Tra√Ætre/Louveteau":e.campFilter.selectedCamp==="Villageois"&&e.campFilter.excludeVillagers&&(v="Villageois sans Chasseur/Alchimiste"),i.push(`${e.selectedPlayer} jouant ${v}${w}`)}else{if(e.selectedPlayer){const w=e.selectedPlayerWinMode==="wins-only"?" (victoires uniquement)":e.selectedPlayerWinMode==="all-assignments"?" (toutes parties)":"";i.push(`Joueur: ${e.selectedPlayer}${w}`)}if(e.campFilter){const{campFilterMode:w}=e.campFilter;let v=e.campFilter.selectedCamp;e.campFilter.selectedCamp==="Loup"&&e.campFilter.excludeWolfSubRoles?v="Loups sans Tra√Ætre/Louveteau":e.campFilter.selectedCamp==="Villageois"&&e.campFilter.excludeVillagers&&(v="Villageois sans Chasseur/Alchimiste");const R=`Camp: ${v}`,S=w==="wins-only"?" (victoires uniquement)":w==="all-assignments"?" (toutes assignations)":"";i.push(R+S)}}if(e.selectedMapName){const w=e.selectedMapName==="Autres"?"autres cartes":e.selectedMapName;i.push(`Carte: ${w}`)}if(e.selectedPower&&i.push(`Pouvoir: ${e.selectedPower}`),e.selectedSecondaryRole&&i.push(`R√¥le Secondaire: ${e.selectedSecondaryRole}`),e.playerPairFilter){const{selectedPlayerPair:w,selectedPairRole:v}=e.playerPairFilter,R=w.join(" & "),S=v==="wolves"?"loups":"amoureux";i.push(`Paire ${S}: ${R}`)}if(e.multiPlayerFilter){const{selectedPlayers:w,playersFilterMode:v,winnerPlayer:R}=e.multiPlayerFilter,S=w.join(" & ");let D="";v==="all-common-games"?D="toutes les parties communes":v==="opposing-camps"?D="affrontements uniquement":v==="same-camp"&&(D="parties en √©quipe (m√™me camp)");const T=R?` (victoires de ${R})`:"";i.push(`${S} (${D}${T})`)}return e.selectedVictoryType&&i.push(`Victoire: ${e.selectedVictoryType}`),e.selectedHarvestRange&&i.push(`R√©colte: ${e.selectedHarvestRange}`),e.selectedGameDuration&&i.push(`Dur√©e: ${e.selectedGameDuration} jour${e.selectedGameDuration>1?"s":""}`),e.selectedGame&&i.push(`Partie ${e.selectedGame}`),e.selectedDate&&(e.selectedDate.includes("/")&&e.selectedDate.split("/").length===2?i.push(`Mois: ${e.selectedDate}`):i.push(`Date: ${e.selectedDate}`)),e.selectedGameIds&&e.selectedGameIds.length>0&&i.push(`${e.selectedGameIds.length} parties s√©lectionn√©e${e.selectedGameIds.length>1?"s":""}`),i};return h?s.jsx("div",{className:"statistiques-chargement",children:"Chargement des d√©tails des parties..."}):d?s.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",d]}):!l||l.length===0?s.jsxs("div",{className:"lycans-empty-section",children:[s.jsx("h2",{children:"Aucune partie trouv√©e"}),s.jsx("p",{children:"Aucune partie ne correspond aux crit√®res s√©lectionn√©s."}),e.fromComponent&&s.jsxs("button",{onClick:t,className:"lycans-submenu-btn",style:{marginTop:"1rem"},children:["‚Üê Retour √† ",e.fromComponent]})]}):s.jsxs("div",{className:"lycans-game-details",children:[s.jsxs("div",{className:"lycans-game-details-header",children:[s.jsxs("div",{className:"lycans-game-details-navigation",children:[e.fromComponent&&s.jsxs("button",{onClick:t,className:"lycans-submenu-btn",style:{marginRight:"1rem"},children:["‚Üê Retour √† ",e.fromComponent]}),s.jsxs("h2",{children:["D√©tails des Parties (",l.length," partie",l.length>1?"s":"",")"]})]}),K().length>0&&s.jsxs("div",{className:"lycans-active-filters",children:[s.jsx("strong",{children:"Filtres actifs:"})," ",K().join(", ")]})]}),F>1&&s.jsxs("div",{className:"lycans-pagination-container",children:[s.jsxs("div",{className:"lycans-pagination-info",children:["Affichage de ",W+1," √† ",Math.min(H,$.length)," sur ",$.length," parties"]}),s.jsxs("div",{className:"lycans-pagination-controls",children:[s.jsxs("select",{value:j,onChange:i=>ee(Number(i.target.value)),className:"lycans-pagination-select",children:[s.jsx("option",{value:10,children:"10 par page"}),s.jsx("option",{value:25,children:"25 par page"}),s.jsx("option",{value:50,children:"50 par page"}),s.jsx("option",{value:100,children:"100 par page"})]}),s.jsxs("div",{className:"lycans-pagination-buttons",children:[s.jsx("button",{onClick:()=>G(1),disabled:u===1,className:"lycans-pagination-btn",children:"¬´¬´"}),s.jsx("button",{onClick:()=>G(u-1),disabled:u===1,className:"lycans-pagination-btn",children:"‚Äπ"}),s.jsxs("span",{className:"lycans-pagination-current",children:["Page ",u," sur ",F]}),s.jsx("button",{onClick:()=>G(u+1),disabled:u===F,className:"lycans-pagination-btn",children:"‚Ä∫"}),s.jsx("button",{onClick:()=>G(F),disabled:u===F,className:"lycans-pagination-btn",children:"¬ª¬ª"})]})]})]}),s.jsx("div",{className:"lycans-games-table-container",children:s.jsxs("table",{className:"lycans-games-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsxs("th",{onClick:()=>U("gameId"),className:"sortable",children:["Partie ",A("gameId")]}),s.jsxs("th",{onClick:()=>U("date"),className:"sortable",children:["Date ",A("date")]}),s.jsxs("th",{onClick:()=>U("playerCount"),className:"sortable",children:["Joueurs ",A("playerCount")]}),s.jsxs("th",{onClick:()=>U("gameDuration"),className:"sortable",children:["Dur√©e ",A("gameDuration")]}),s.jsxs("th",{onClick:()=>U("winningCamp"),className:"sortable",children:["Camp Vainqueur ",A("winningCamp")]}),V&&s.jsxs("th",{onClick:()=>U("winner"),className:"sortable",children:[q()," ",A("winner")]}),s.jsx("th",{children:"D√©tails"})]})}),s.jsx("tbody",{children:Z.map(i=>s.jsxs(s.Fragment,{children:[s.jsxs("tr",{className:`${o===i.gameId?"selected":""} clickable-row`,onClick:()=>z(i.gameId),style:{cursor:"pointer"},children:[s.jsxs("td",{children:["#",i.gameId]}),s.jsx("td",{children:i.date}),s.jsx("td",{children:i.playerCount}),s.jsx("td",{children:me(i.gameDuration)}),s.jsx("td",{style:{color:y[i.winningCamp]||"#fff"},children:i.winningCamp}),V&&s.jsx("td",{style:{textAlign:"left",fontSize:"1.2rem",verticalAlign:"middle"},children:k(i)}),s.jsx("td",{children:s.jsx("button",{onClick:w=>{w.stopPropagation(),z(i.gameId)},className:"lycans-details-btn",children:o===i.gameId?"Masquer":"Voir"})})]},i.gameId),o===i.gameId&&s.jsx("tr",{className:"game-details-row",children:s.jsx("td",{colSpan:V?8:7,children:s.jsx(Ve,{game:i})})},`${i.gameId}-details`)]}))})]})}),F>1&&s.jsxs("div",{className:"lycans-pagination-container",children:[s.jsxs("div",{className:"lycans-pagination-info",children:["Affichage de ",W+1," √† ",Math.min(H,$.length)," sur ",$.length," parties"]}),s.jsx("div",{className:"lycans-pagination-controls",children:s.jsxs("div",{className:"lycans-pagination-buttons",children:[s.jsx("button",{onClick:()=>G(1),disabled:u===1,className:"lycans-pagination-btn",children:"¬´¬´"}),s.jsx("button",{onClick:()=>G(u-1),disabled:u===1,className:"lycans-pagination-btn",children:"‚Äπ"}),s.jsxs("span",{className:"lycans-pagination-current",children:["Page ",u," sur ",F]}),s.jsx("button",{onClick:()=>G(u+1),disabled:u===F,className:"lycans-pagination-btn",children:"‚Ä∫"}),s.jsx("button",{onClick:()=>G(F),disabled:u===F,className:"lycans-pagination-btn",children:"¬ª¬ª"})]})})]})]})}export{He as GameDetailsChart};
