import{a as me,r as A,g as te,f as Fe,u as ne,j as e,d as ye,e as $e,q as Le}from"./index-BGmTEP1w.js";import{u as ue}from"./useJoueursData-QF_C3hMC.js";import{u as ve}from"./baseStatsHook-BgvLR_u1.js";import{g as Ie}from"./gameUtils-rkfcKAVy.js";import{a as Re,g as ce,c as ke,b as We}from"./datasyncExport-BirWLS1z.js";import{u as he,g as qe,b as oe,l as Ee,C as ie,f as je}from"./api-BwJrdo4C.js";import{f as re,d as Ge}from"./durationFormatters-C9UyWcKX.js";import{F as Y,C as J,X as Q,Y as X,a as Z}from"./FullscreenChart-DCN70oAf.js";import{R as K,T as H}from"./CategoricalChart-o2KYuhVn.js";import{L as Ve,a as Be}from"./LineChart-DwdlyHoD.js";import{B as ee,a as O}from"./BarChart-Dvbu6GaR.js";import{P as Ne,a as Pe}from"./PieChart-DUrvoyqW.js";import{g as de}from"./deathTypes-gHH1w6_X.js";import{i as be,g as Ce,V as Oe,a as Ke}from"./roleUtils-g252S1-m.js";import{L as De}from"./Legend-BHiAmA_E.js";import{S as He,R as ae,e as Ue,f as _e,h as pe,a as Ye,b as Je,d as Qe}from"./deathLocationUtils-DtAJJzrU.js";import{a as Xe,u as Ze}from"./useClips-G5Ozptr4.js";import{C as et,f as Se,a as tt}from"./ClipViewer-BOd6L5px.js";import"./ActivePoints-Ccq6-39x.js";import"./PolarChart-B4g8cf5W.js";function st(s){const{settings:c}=me(),{joueursData:v}=ue(),[f,w]=A.useState(null),[a,x]=A.useState(!1),[o,r]=A.useState(null);A.useEffect(()=>{let d=!0;return(async()=>{try{x(!0),r(null);const u=c.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",i=await fetch(u);if(!i.ok)throw new Error(`Failed to load achievements: ${i.status} ${i.statusText}`);const m=await i.json();d&&w(m)}catch(u){d&&r(u instanceof Error?u.message:"Failed to load achievements")}finally{d&&x(!1)}})(),()=>{d=!1}},[c.dataSource]);const n=(()=>{if(!s||!f)return null;const l=v?.Players?.find(u=>u.Joueur===s)?.SteamID;return l&&f.achievements[l]||null})();return A.useEffect(()=>{s&&f&&v&&v.Players?.find(u=>u.Joueur===s)?.SteamID},[s,f,v,c.dataSource]),{data:n,isLoading:a,error:o,metadata:{generatedAt:f?.generatedAt||null,totalPlayers:f?.totalPlayers||0,totalGames:f?.totalGames||0,totalModdedGames:f?.totalModdedGames||0}}}function rt(s,c,v){if(!s||s.trim()===""||c.length===0)return null;const f=[];let w=s;c.forEach(l=>{const u=l.PlayerStats.find(i=>te(i)===s||i.Username.toLowerCase()===s.toLowerCase());if(u){w=u.Username;const i=u.MainRoleInitial==="Louveteau"?u.MainRoleInitial:Re(u.MainRoleInitial,u.MainRoleChanges||[]),m=ce(i);if(v&&v!=="Tous les camps"&&m!==v)return;const S=Ie(l),g=u.Victorious,R=Fe(new Date(l.StartDate)),T=ke(l.StartDate,l.EndDate)||0;f.push({gameId:l.Id,date:R,camp:m,won:g,winnerCamp:S,playersInGame:l.PlayerStats.length,mapName:l.MapName,duration:T})}}),f.sort((l,u)=>{const i=m=>{const S=m.split("/");return S.length===3?new Date(parseInt(S[2]),parseInt(S[1])-1,parseInt(S[0])):new Date(m)};return i(u.date).getTime()-i(l.date).getTime()});const a=f.length,x=f.filter(l=>l.won).length,o=a>0?(x/a*100).toFixed(2):"0.00",r={};f.forEach(l=>{r[l.camp]||(r[l.camp]={appearances:0,wins:0,winRate:"0.00"}),r[l.camp].appearances++,l.won&&r[l.camp].wins++}),Object.keys(r).forEach(l=>{const u=r[l];u.winRate=u.appearances>0?(u.wins/u.appearances*100).toFixed(2):"0.00"});const n={};f.forEach(l=>{n[l.mapName]||(n[l.mapName]={appearances:0,wins:0,winRate:"0.00"}),n[l.mapName].appearances++,l.won&&n[l.mapName].wins++}),Object.keys(n).forEach(l=>{const u=n[l];u.winRate=u.appearances>0?(u.wins/u.appearances*100).toFixed(2):"0.00"});const d=f.reduce((l,u)=>l+u.duration,0);return{playerName:w,totalGames:a,totalWins:x,winRate:o,totalPlayTime:d,games:f,campStats:r,mapStats:n}}function ge(s,c){const{data:v,isLoading:f,error:w}=ve(a=>s?rt(s,a,c):null);return{data:v,isLoading:f,error:w}}function at(s){const{settings:c}=me(),[v,f]=A.useState(null),[w,a]=A.useState(null),[x,o]=A.useState(!0),[r,n]=A.useState(null);return A.useEffect(()=>{(async()=>{o(!0),n(null);try{const l=c.dataSource==="discord"?"/data/discord/playerTitles.json":"/data/playerTitles.json",u=await fetch(l);if(!u.ok){if(u.status===404)f(null),a(null),n("Les titres n'ont pas encore √©t√© g√©n√©r√©s. Ils seront disponibles apr√®s la prochaine synchronisation hebdomadaire.");else throw new Error(`HTTP error! status: ${u.status}`);return}const i=await u.json();if(f(i),s&&i.players){const m=Object.entries(i.players).find(([S,g])=>g.playerName===s);a(m?m[1]:null)}else a(null)}catch(l){console.error("Error loading player titles:",l),n(l instanceof Error?l.message:"Erreur inconnue"),f(null),a(null)}finally{o(!1)}})()},[c.dataSource,s]),{data:v,playerData:w,isLoading:x,error:r}}function it({achievements:s,title:c,emptyMessage:v,achievementType:f="all"}){const{navigateToTab:w,updateNavigationState:a,clearNavigation:x}=ne(),{settings:o,updateSettings:r}=me(),{joueursData:n}=ue(),d=he(n),l=(t,P)=>{if(P.stopPropagation(),!t.redirectTo)return;x();const F=o.highlightedPlayer;if(r(f==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:F,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:F,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const b=o.highlightedPlayer||"",p=u(t.description,b);p&&a({playerComparisonState:{selectedPlayer1:b,selectedPlayer2:p,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const b=t.description.toLowerCase().includes("loup");a({selectedPairingTab:b?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const b=t.description.match(/(Villageois|Loups|Autres)/i);b&&a({deathStatsSelectedCamp:b[1]});let p=10;const h=t.description.match(/min\.\s*(\d+)/);h&&(p=parseInt(h[1],10));let C="totalKills",y="killers";const k=t.redirectTo.chartSection;k&&(k==="killers-total"?(C="totalKills",y="killers"):k==="killers-average"?(C="averageKills",y="killers"):k==="deaths-total"?(C="totalDeaths",y="deaths"):k==="survivors-average"?(C="survivalRate",y="deaths"):(k==="hunters-good"||k==="hunters-bad")&&(y="hunter",C="averageKills")),a({deathStatisticsState:{selectedCamp:b?.[1]||"Tous les camps",minGamesForAverage:p,selectedView:y,focusChart:C}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const b=t.redirectTo.mapFilter||"all";let p=10;const h=t.description.match(/min\.\s*(\d+)/);h&&(p=parseInt(h[1])),r(f==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:b,playerFilter:{mode:"none",players:[]},highlightedPlayer:F,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:b,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:b,playerFilter:{mode:"none",players:[]},highlightedPlayer:F,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:b,playerFilter:{mode:"none",players:[]}}}),a({playersGeneralState:{minGamesForWinRate:p,winRateOrder:"best",focusChart:"winRate"}}),w("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&a({selectedPlayerName:o.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let b="wins";const p=t.title.toLowerCase(),h=t.description.toLowerCase();p.includes("d√©faite")||h.includes("d√©faite")?b="losses":p.includes("loup")||h.includes("loup")?b="loup":p.includes("villageois")||h.includes("villageois")?b="villageois":(p.includes("victoire")||h.includes("victoire"))&&(b="wins"),a({selectedSeriesType:b})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let b=10;const p=t.description.match(/min\.\s*(\d+)/);p&&(b=parseInt(p[1],10));let h="winRate",C="best";const y=t.title.toLowerCase(),k=t.description.toLowerCase();y.includes("participation")||k.includes("participation")?h="participation":(y.includes("taux de victoire")||k.includes("taux de victoire"))&&(h="winRate",(y.includes("moins bon")||y.includes("mauvais")||k.includes("moins bon")||k.includes("mauvais"))&&(C="worst")),a({playersGeneralState:{minGamesForWinRate:b,winRateOrder:C,focusChart:h}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const b=t.redirectTo.chartSection;let p="Villageois",h=1;b&&(b==="camp-loup"?p="Loup":b==="camp-villageois"?p="Villageois":b==="camp-idiot"?p="Idiot du Village":b==="camp-amoureux"?p="Amoureux":(b==="solo-roles"||b==="hall-of-fame")&&(p="Villageois"));const C=t.description.match(/min\.\s*(\d+)/);C&&(h=parseInt(C[1],10)),b==="solo-roles"?p="R√¥les sp√©ciaux":b==="hall-of-fame"&&(p="Tous les camps"),a({campPerformanceState:{selectedCampPerformanceCamp:p,selectedCampPerformanceMinGames:h,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const b=t.title.toLowerCase();let p="overview",h="behavior";b.includes("agressivit√©")?(p="overview",h="behavior"):b.includes("taux de vote")?(p="behavior",h="voteRate"):b.includes("pr√©cision")&&(p="overview",h="accuracy"),a({votingStatsState:{selectedCategory:p,selectedView:h}})}if(t.category==="loot"&&t.redirectTo.subTab==="lootStats"){const b=t.redirectTo,p=b.minGames||5,h=b.view||"normalized";a({lootStatsState:{minGames:p,campFilter:"all",view:h}})}w(t.redirectTo.tab,t.redirectTo.subTab)},u=(t,P)=>{const F=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const b of F){const p=t.match(b);if(p&&p[1]){const h=p[1].trim();if(h!==P)return h}}return null},i=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const b=t.description.match(/min\.\s*(\d+)/),p=b?parseInt(b[1],10):10,h=t.title.toLowerCase(),C=f==="modded"?" (Filtre parties modd√©es activ√©)":" (Filtres r√©initialis√©s)";return h.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${p} parties)${C}`:h.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${C}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement g√©n√©ral des joueurs${C}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const b=t.redirectTo.mapFilter,p=b==="village"?"Village":b==="chateau"?"Ch√¢teau":"map",h=f==="modded"?" (Filtres parties modd√©es + map activ√©s)":" (Filtre map activ√©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques g√©n√©rales filtr√©es sur ${p}${h}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique d√©taill√© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${u(t.description,o.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const b=t.description.match(/(Villageois|Loups|Autres)/i),p=t.description.match(/min\.\s*(\d+)/),h=p?parseInt(p[1],10):10,C=b?.[1]||"Tous les camps",y=t.redirectTo.chartSection;let k="kills et morts";return y==="killers-total"?k="total des kills":y==="killers-average"?k=`moyenne des kills (min. ${h} parties)`:y==="deaths-total"?k="total des morts":y==="survivors-average"&&(k=`taux de survie (min. ${h} parties)`),`Cliquez pour voir les statistiques de ${k} ${C!=="Tous les camps"?`en ${C}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const b=t.title.toLowerCase(),p=t.description.toLowerCase();return b.includes("d√©faite")||p.includes("d√©faite")?"Cliquez pour voir les s√©ries de d√©faites":b.includes("loup")||p.includes("loup")?"Cliquez pour voir les s√©ries Loups":b.includes("villageois")||p.includes("villageois")?"Cliquez pour voir les s√©ries Villageois":b.includes("victoire")||p.includes("victoire")?"Cliquez pour voir les s√©ries de victoires":"Cliquez pour voir les s√©ries cons√©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const b=t.redirectTo.chartSection,p=f==="modded"?" (Filtre parties modd√©es activ√©)":" (Filtres r√©initialis√©s)";return b==="camp-loup"?`Cliquez pour voir les performances camp Loup${p}`:b==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${p}`:b==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${p}`:b==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${p}`:b==="solo-roles"?`Cliquez pour voir le classement (r√¥les sp√©ciaux)${p}`:b==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${p}`:`Cliquez pour voir les performances par camp${p}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const b=t.description.match(/min\.\s*(\d+)/),p=b?parseInt(b[1],10):25,h=f==="modded"?" (Filtre parties modd√©es activ√©)":" (Filtres r√©initialis√©s)",C=t.title.toLowerCase();return C.includes("agressivit√©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivit√© (min. ${p} meetings)${h}`:C.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${p} meetings)${h}`:C.includes("pr√©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la pr√©cision des votes${h}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${h}`}break;case"loot":if(t.redirectTo.subTab==="lootStats"){const b=t.description.match(/min\.\s*(\d+)/),p=b?parseInt(b[1],10):25,h=f==="modded"?" (Filtre parties modd√©es activ√©)":" (Filtres r√©initialis√©s)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de r√©colte (min. ${p} parties)${h}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(f==="modded"?" (Filtre parties modd√©es activ√©)":" (Filtres r√©initialis√©s)")},m=t=>d[t]||qe(t),S=t=>{const P=[/avec ([^:]+?):/,/contre ([^:]+?):/];let F=t;return P.forEach(b=>{const p=t.match(b);if(p&&p[1]){const h=p[1].trim(),y=`<span class="player-name-highlight" style="color: ${m(h)};">${h}</span>`;F=F.replace(h,y)}}),F};if(s.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:c}),e.jsx("p",{children:v||"Aucun succ√®s dans cette cat√©gorie"})]});const g=t=>t===1?"ü•á":t===2?"ü•à":t===3?"ü•â":"",R=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",T=(t,P)=>{if(!t||t<=3||!P)return;const F=t-3,b=P-3;return b<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(F-1)/(b-1))}, 70%, 50%)`},W=(t,P)=>{if(!t||!P)return;if(P<=1)return"hsl(0, 70%, 50%)";const F=(t-1)/(P-1),b=F*15,p=50-F*15;return`hsl(${b}, 70%, ${p}%)`},M=t=>{if(!t)return;const P=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(P){const[,F,b]=P;return`hsl(${F}, ${b}%, 40%)`}return t},L=s.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,P)=>(t.rank??999)-(P.rank??999)),$=s.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,P)=>(t.rank??999)-(P.rank??999)),V=s.filter(t=>t.category==="comparison"),z=[...L,...$].sort((t,P)=>(t.rank??999)-(P.rank??999)),N=L.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:c}),N>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"‚ú® Podium d'Excellence ‚ú®"}),e.jsx("div",{className:"top3-grid",children:L.filter(t=>t.rank&&t.rank<=3).map((t,P)=>e.jsxs("div",{className:`top3-card ${R(t.rank)} animate-slide-in`,style:{animationDelay:`${P*.15}s`},onClick:F=>l(t,F),title:i(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:g(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:t.title}),e.jsx("p",{className:"top3-achievement-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"‚ú®"}),e.jsx("span",{className:"sparkle sparkle-2",children:"‚≠ê"}),e.jsx("span",{className:"sparkle sparkle-3",children:"‚ú®"})]})]},t.id))})]}),z.length>0&&e.jsxs("div",{className:"achievements-section unified-rankings",children:[e.jsx("h5",{children:"üèÜ Classements"}),e.jsx("div",{className:"achievements-grid",children:z.filter(t=>t.type==="bad"?!0:!t.rank||t.rank>3).map((t,P)=>{const F=t.type==="bad",b=F?W(t.rank,t.totalRanked):T(t.rank,t.totalRanked),p=M(b),h=F?"":R(t.rank);return e.jsxs("div",{className:`achievement-card ${F?"bad":"good"} ${h}`,onClick:C=>l(t,C),title:i(t),style:{animationDelay:`${P*.05}s`,borderLeftColor:p,borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsxs("span",{className:"achievement-title",children:[F&&"üíÄ ",t.title]}),e.jsxs("span",{className:"achievement-rank",style:b?{backgroundColor:b}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:t.description})]},t.id)})})]}),V.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"üìä Statistiques Co√©quipiers et Face-√†-Face"}),e.jsx("div",{className:"achievements-grid",children:V.map(t=>e.jsxs("div",{className:"achievement-card comparison",onClick:P=>l(t,P),title:i(t),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:t.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:S(t.description)}})]},t.id))})]})]})}function nt({selectedPlayerName:s,groupingMethod:c,campFilter:v="all"}){const{navigateToGameDetails:f}=ne(),{data:w,isLoading:a,error:x}=ge(s),o=A.useMemo(()=>{switch(c){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par Ann√©e";default:return"par Session"}},[c]),r=A.useMemo(()=>{if(!w?.games)return new Map;const u=new Map;return w.games.forEach(i=>{if(!u.has(i.date)){const m=i.date.split("/");m.length===3?u.set(i.date,new Date(parseInt(m[2]),parseInt(m[1])-1,parseInt(m[0])).getTime()):u.set(i.date,new Date(i.date).getTime())}}),u},[w?.games]),n=A.useMemo(()=>{if(!w?.games)return[];const u={};return w.games.forEach(i=>{if(v!=="all"){if(v==="solo"){if(i.camp==="Villageois"||i.camp==="Loup")return}else if(i.camp!==v)return}let m;const S=i.date.split("/");if(c==="month")if(S.length===3)m=`${S[1].padStart(2,"0")}/${S[2]}`;else{const g=new Date(i.date);m=`${String(g.getMonth()+1).padStart(2,"0")}/${g.getFullYear()}`}else if(c==="quarter")if(S.length===3){const g=parseInt(S[1],10);m=`T${Math.floor((g-1)/3)+1}/${S[2]}`}else{const g=new Date(i.date);m=`T${Math.floor(g.getMonth()/3)+1}/${g.getFullYear()}`}else c==="year"?S.length===3?m=`${S[2]}`:m=`${new Date(i.date).getFullYear()}`:m=i.date;u[m]||(u[m]={games:[],wins:0,total:0}),u[m].games.push(i),u[m].total++,i.won&&u[m].wins++}),Object.entries(u).map(([i,m])=>({period:i,totalGames:m.total,victories:m.wins,defeats:m.total-m.wins,winRate:m.total>0?(m.wins/m.total*100).toFixed(1):"0.0",winRateNum:m.total>0?m.wins/m.total*100:0})).sort((i,m)=>{if(c==="month"){const[S,g]=i.period.split("/"),[R,T]=m.period.split("/"),W=new Date(parseInt(g),parseInt(S)-1,1),M=new Date(parseInt(T),parseInt(R)-1,1);return W.getTime()-M.getTime()}else if(c==="quarter"){const[S,g]=i.period.split("/"),[R,T]=m.period.split("/"),W=parseInt(S.replace(/\D/g,""),10)||1,M=parseInt(R.replace(/\D/g,""),10)||1,L=new Date(parseInt(g,10),(W-1)*3,1),$=new Date(parseInt(T,10),(M-1)*3,1);return L.getTime()-$.getTime()}else if(c==="year"){const S=parseInt(i.period,10),g=parseInt(m.period,10);return S-g}else{const S=r.get(i.period)||0,g=r.get(m.period)||0;return S-g}})},[w,c,r,v]),l=(u=>u<=15?{fontSize:12,angle:-45,height:80,interval:0}:u<=30?{fontSize:12,angle:-45,height:85,interval:1}:u<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(u/12)})(n.length);return a?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):x?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",x]}):w?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["√âvolution des Performances ",o]}),e.jsx(Y,{title:`√âvolution des Performances ${o}`,children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:n,margin:{top:20,right:30,left:20,bottom:20},onClick:u=>{if(u&&u.activeLabel){const i=n.find(m=>m.period===u.activeLabel);i&&f({selectedPlayer:s,selectedDate:i.period,fromComponent:`√âvolution des Performances ${o}`})}},style:{cursor:"pointer"},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"period",angle:l.angle,textAnchor:"end",height:l.height,interval:l.interval,fontSize:l.fontSize}),e.jsx(X,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(H,{content:({active:u,payload:i})=>{if(u&&i&&i.length>0){const m=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.period})}),e.jsxs("div",{children:["Parties: ",m.totalGames]}),e.jsxs("div",{children:["Victoires: ",m.victories]}),e.jsxs("div",{children:["Taux: ",m.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(Be,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["R√©partition Victoires/D√©faites ",o]}),e.jsx(Y,{title:`R√©partition Victoires/D√©faites ${o}`,children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"period",angle:l.angle,textAnchor:"end",height:l.height,interval:l.interval,fontSize:l.fontSize}),e.jsx(X,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:u,payload:i})=>{if(u&&i&&i.length>0){const m=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.period})}),e.jsxs("div",{children:["Total: ",m.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",m.victories]}),e.jsxs("div",{children:["D√©faites: ",m.defeats]}),e.jsxs("div",{children:["Taux: ",m.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(O,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:n.map((u,i)=>e.jsx(Z,{fill:"var(--accent-tertiary)",onClick:()=>{f({selectedPlayer:s,selectedDate:u.period,fromComponent:`Historique Joueur - Victoires ${o}`})},style:{cursor:"pointer"}},`cell-victories-${i}`))}),e.jsx(O,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"D√©faites",children:n.map((u,i)=>e.jsx(Z,{fill:"var(--chart-color-4)",onClick:()=>{f({selectedPlayer:s,selectedDate:u.period,fromComponent:`Historique Joueur - D√©faites ${o}`})},style:{cursor:"pointer"}},`cell-defeats-${i}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e d'historique disponible"})}function ot({selectedPlayerName:s}){const{navigateToGameDetails:c}=ne(),{data:v,isLoading:f,error:w}=ge(s),a=oe(),x=A.useMemo(()=>v?.campStats?Object.entries(v.campStats).map(([r,n])=>({name:r,value:n.appearances,winRate:n.winRate,winRateDisplay:Math.max(parseFloat(n.winRate),1),wins:n.wins,percentage:(n.appearances/v.totalGames*100).toFixed(1)})):[],[v]),o=A.useMemo(()=>{if(!x.length)return[];const r=5;let n=0;const d=[],l=[];if(x.forEach(u=>{parseFloat(u.percentage)<r?(n+=Number(u.value),d.push(u)):l.push(u)}),n>0){const u=x.reduce((i,m)=>i+Number(m.value),0);l.push({name:"Autres",value:n,winRate:"0.0",winRateDisplay:1,wins:d.reduce((i,m)=>i+m.wins,0),percentage:(n/u*100).toFixed(1),_details:d})}return l},[x]);return f?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):w?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",w]}):v?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Ne,{children:[e.jsx(Pe,{data:o,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:r=>{const n=r.percent!==void 0?r.percent:0;return r.name==="Autres"?`Autres : ${r.value} (${(n*100).toFixed(1)}%)`:`${r.name}: ${r.value} (${(n*100).toFixed(1)}%)`},children:o.map((r,n)=>e.jsx(Z,{fill:r.name==="Autres"?Ee:a[r.name]||`var(--chart-color-${n%6+1})`,onClick:()=>{if(r.name==="Autres"){const d=r._details?.map(l=>l.name)||[];c({selectedPlayer:s,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:d},fromComponent:"Distribution par Camps"})}else r.name==="Tra√Ætre"||r.name==="Louveteau"?c({selectedPlayer:s,campFilter:{selectedCamp:r.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):r.name==="Loup"?c({selectedPlayer:s,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):c({selectedPlayer:s,campFilter:{selectedCamp:r.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${n}`))}),e.jsx(H,{content:({active:r,payload:n})=>{if(r&&n&&n.length>0){const d=n[0].payload;if(d.name==="Autres"&&d._details){const l=[...d._details].sort((u,i)=>i.value-u.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",d.value," parties (",d.percentage,"%)"]})}),e.jsx("div",{children:l.map((u,i)=>e.jsxs("div",{children:[u.name,": ",u.value," parties (",u.percentage,"%)"]},i))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[d.name," - ",d.value," parties (",d.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(Y,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:x,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(H,{content:({active:r,payload:n})=>{if(r&&n&&n.length>0){const d=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:d.name})}),e.jsxs("div",{children:["Victoires: ",d.wins," / ",d.value]}),e.jsxs("div",{children:["Taux: ",d.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(O,{dataKey:"winRateDisplay",children:x.map((r,n)=>e.jsx(Z,{fill:parseFloat(r.winRate)===0?`${a[r.name]||`var(--chart-color-${n%6+1})`}50`:a[r.name]||`var(--chart-color-${n%6+1})`,onClick:()=>{r.name==="Tra√Ætre"||r.name==="Louveteau"?c({selectedPlayer:s,campFilter:{selectedCamp:r.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):r.name==="Loup"?c({selectedPlayer:s,campFilter:{selectedCamp:r.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):c({selectedPlayer:s,campFilter:{selectedCamp:r.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${n}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e d'historique disponible"})}function lt({selectedPlayerName:s}){const{gameData:c}=ye(),{joueursData:v}=ue(),f=he(v),w=oe(),a=A.useMemo(()=>{if(!c||!s)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const o={},r={},n={},d=new Set;c.forEach(S=>{const g=S.PlayerStats.find(R=>R.Username.toLowerCase()===s.toLowerCase());if(g&&(S.PlayerStats.forEach(R=>{R.KillerName?.toLowerCase()===s.toLowerCase()&&(o[R.Username]=(o[R.Username]||0)+1)}),g.KillerName&&(r[g.KillerName]=(r[g.KillerName]||0)+1),g.DeathType)){const R=g.DeathType,T=de(R);n[T]||(n[T]={count:0,byDeathType:{}}),n[T].count+=1,n[T].byDeathType[R]=(n[T].byDeathType[R]||0)+1,d.add(R)}});const l=Object.entries(o).map(([S,g])=>({player:S,kills:g})).sort((S,g)=>g.kills-S.kills).slice(0,ie.TOP_10),u=Object.entries(r).map(([S,g])=>({player:S,kills:g})).sort((S,g)=>g.kills-S.kills).slice(0,ie.TOP_10),i=Object.entries(n).map(([S,g])=>{const R={deathType:S,count:g.count};return R[S]=g.count,R}).sort((S,g)=>g.count-S.count).slice(0,ie.TOP_10),m=Object.keys(n);return{playersKilled:l,killedBy:u,deathTypes:i,availableDeathTypes:m}},[c,s]),x=A.useMemo(()=>{const o={};a.availableDeathTypes.forEach(d=>{d==="Tu√© par Loup"?o[d]=w.Loup:d==="Mort aux votes"?o[d]="var(--chart-color-1)":d.includes("Chasseur")?o[d]=w.Chasseur:d==="Tu√© par Zombie"?o[d]=w.Vaudou:d==="Tu√© par potion assassin"?o[d]=w.Alchimiste:d==="Tu√© par Vengeur"?o[d]="var(--chart-color-2)":d==="Amoureux mort"?o[d]=w.Amoureux:d==="Tu√© par La B√™te"?o[d]="var(--chart-color-3)":d==="Tu√© par Sh√©rif"&&(o[d]="var(--chart-color-4)")});const r=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let n=0;return a.availableDeathTypes.forEach(d=>{o[d]||(o[d]=r[n%r.length],n++)}),o},[a.availableDeathTypes,w]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[a.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(Y,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:o,payload:r})=>{if(o&&r&&r.length>0){const n=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.player})}),e.jsxs("div",{children:["Tu√© ",n.kills," fois par ",s]})]})}return null}}),e.jsx(O,{dataKey:"kills",children:a.playersKilled.map((o,r)=>e.jsx(Z,{fill:f[o.player]||"var(--chart-color-3)"},`cell-killed-${r}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistr√©"}),e.jsxs("p",{children:[s," n'a tu√© aucun joueur dans les parties enregistr√©es."]})]}),a.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(Y,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:o,payload:r})=>{if(o&&r&&r.length>0){const n=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.player})}),e.jsxs("div",{children:["A tu√© ",s," ",n.kills," fois"]})]})}return null}}),e.jsx(O,{dataKey:"kills",children:a.killedBy.map((o,r)=>e.jsx(Z,{fill:f[o.player]||"var(--chart-color-4)"},`cell-killer-${r}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[s," n'a jamais √©t√© tu√© par un autre joueur dans les parties enregistr√©es."]})]}),a.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus Fr√©quents"}),e.jsx(Y,{title:"Types de Mort les Plus Fr√©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:o,payload:r})=>{if(o&&r&&r.length>0){const n=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.deathType})}),e.jsxs("div",{children:[s," est mort ",n.count," fois ainsi"]})]})}return null}}),a.availableDeathTypes.map(o=>e.jsx(O,{dataKey:o,name:o,stackId:"deaths",fill:x[o]||"var(--chart-color-5)"},o))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donn√©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",s,"."]})]})]})}function ct(s,c){if(!s||s.trim()===""||c.length===0)return null;const v=new Map,f=new Map,w=new Map;c.forEach(n=>{if(!n.Modded)return;const d=n.PlayerStats.find(l=>te(l)===s||l.Username.toLowerCase()===s.toLowerCase());if(d){if(d.MainRoleInitial==="Inconnu")return;const l=d.Victorious,i=Re(d.MainRoleInitial,d.MainRoleChanges||[])!==d.MainRoleInitial,m=ce(d.MainRoleInitial),S=m==="Loup"||m==="Tra√Ætre"||m==="Louveteau";if(m==="Villageois"&&be(d)){const g=Ce(d);if(g&&Oe.includes(g)){const R=v.get(g)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};v.set(g,{appearances:R.appearances+1,wins:R.wins+(l?1:0),winsWithoutRoleChange:R.winsWithoutRoleChange+(!i&&l?1:0),gamesWithoutRoleChange:R.gamesWithoutRoleChange+(i?0:1)})}}else if(d.Power&&d.Power.trim()!==""&&d.Power!=="Inconnu"){if(m==="Villageois"){const g=v.get(d.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};v.set(d.Power,{appearances:g.appearances+1,wins:g.wins+(l?1:0),winsWithoutRoleChange:g.winsWithoutRoleChange+(!i&&l?1:0),gamesWithoutRoleChange:g.gamesWithoutRoleChange+(i?0:1)})}else if(S){const g=f.get(d.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},R=g.roleBreakdown;R.set(d.MainRoleInitial,(R.get(d.MainRoleInitial)||0)+1),f.set(d.Power,{appearances:g.appearances+1,wins:g.wins+(l?1:0),winsWithoutRoleChange:g.winsWithoutRoleChange+(!i&&l?1:0),gamesWithoutRoleChange:g.gamesWithoutRoleChange+(i?0:1),roleBreakdown:R})}}else if((m==="Villageois"||S)&&d.Power!=="Inconnu")if(m==="Villageois"){const g=v.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};v.set("Aucun pouvoir",{appearances:g.appearances+1,wins:g.wins+(l?1:0),winsWithoutRoleChange:g.winsWithoutRoleChange+(!i&&l?1:0),gamesWithoutRoleChange:g.gamesWithoutRoleChange+(i?0:1)})}else{const g=f.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},R=g.roleBreakdown;R.set(d.MainRoleInitial,(R.get(d.MainRoleInitial)||0)+1),f.set("Aucun pouvoir",{appearances:g.appearances+1,wins:g.wins+(l?1:0),winsWithoutRoleChange:g.winsWithoutRoleChange+(!i&&l?1:0),gamesWithoutRoleChange:g.gamesWithoutRoleChange+(i?0:1),roleBreakdown:R})}if(d.SecondaryRole&&d.SecondaryRole.trim()!==""&&d.SecondaryRole!=="Inconnu"){const g=w.get(d.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};w.set(d.SecondaryRole,{appearances:g.appearances+1,wins:g.wins+(l?1:0),winsWithoutRoleChange:g.winsWithoutRoleChange+(!i&&l?1:0),gamesWithoutRoleChange:g.gamesWithoutRoleChange+(i?0:1)})}}});const a=new Map;c.forEach(n=>{const d=n.PlayerStats.find(l=>te(l)===s||l.Username.toLowerCase()===s.toLowerCase());if(d&&be(d)){const l=Ce(d);l&&a.set(l,(a.get(l)||0)+1)}});const x=n=>Array.from(n.entries()).map(([d,l])=>({name:d,appearances:l.appearances,wins:l.wins,winsWithoutRoleChange:l.winsWithoutRoleChange,gamesWithoutRoleChange:l.gamesWithoutRoleChange,winRate:l.gamesWithoutRoleChange>0?(l.winsWithoutRoleChange/l.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...a.has(d)&&{totalGamesAllModes:a.get(d)}})).sort((d,l)=>l.appearances-d.appearances),o=n=>Array.from(n.entries()).map(([d,l])=>({name:d,appearances:l.appearances,wins:l.wins,winsWithoutRoleChange:l.winsWithoutRoleChange,gamesWithoutRoleChange:l.gamesWithoutRoleChange,winRate:l.gamesWithoutRoleChange>0?(l.winsWithoutRoleChange/l.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(l.roleBreakdown.entries()).map(([u,i])=>({role:u,count:i})).sort((u,i)=>i.count-u.count)})).sort((d,l)=>l.appearances-d.appearances),r=n=>Array.from(n.entries()).map(([d,l])=>({name:d,appearances:l.appearances,wins:l.wins,winsWithoutRoleChange:l.winsWithoutRoleChange,gamesWithoutRoleChange:l.gamesWithoutRoleChange,winRate:l.gamesWithoutRoleChange>0?(l.winsWithoutRoleChange/l.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((d,l)=>l.appearances-d.appearances);return{villageoisPowers:x(v),loupPowers:o(f),secondaryRoles:r(w)}}function dt({selectedPlayerName:s}){const{navigateToGameDetails:c,navigationState:v,updateNavigationState:f}=ne(),w=oe(),[a,x]=A.useState(v.playerHistoryRolesState?.chartMode||"appearances"),{data:o,isLoading:r,error:n}=ve(T=>ct(s,T));A.useEffect(()=>{(!v.playerHistoryRolesState||v.playerHistoryRolesState.chartMode!==a)&&f({playerHistoryRolesState:{chartMode:a}})},[a,v.playerHistoryRolesState,f]);const d=T=>{x(T),f({playerHistoryRolesState:{chartMode:T}})},l=A.useCallback(T=>{if(!o)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const W=1,M=1,L=a==="winRate"?(z,N)=>parseFloat(N.winRate)-parseFloat(z.winRate):(z,N)=>N.appearances-z.appearances,$=z=>({...z,winRateDisplay:Math.max(parseFloat(z.winRate),1)}),V=z=>T===null?z:z.slice(0,T);return{villageoisPowers:V(o.villageoisPowers.filter(z=>z.appearances>=W).map($).sort(L)),loupPowers:V(o.loupPowers.filter(z=>z.appearances>=W).map($).sort(L)),secondaryRoles:V(o.secondaryRoles.filter(z=>z.appearances>=M).map($).sort(L))}},[o,a]),u=A.useMemo(()=>l(15),[l]);if(r)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des r√¥les..."});if(n)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",n]});if(!o)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de r√¥le disponible"});const i=u.villageoisPowers.length>0,m=u.loupPowers.length>0,S=u.secondaryRoles.length>0;if(!i&&!m&&!S)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou r√¥le secondaire trouv√©"});const g=({active:T,payload:W})=>{if(T&&W&&W.length>0){const M=W[0].payload,L=M.gamesWithoutRoleChange<M.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:M.name})}),e.jsxs("div",{children:["Apparitions: ",M.appearances]}),L&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",M.appearances-M.gamesWithoutRoleChange," avec changement de r√¥le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",M.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",M.winRate,"%"]})}),M.totalGamesAllModes&&M.totalGamesAllModes!==M.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non modd√©es: ",M.totalGamesAllModes,")"]}),M.roleBreakdown&&M.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"R√©partition par r√¥le:"}),M.roleBreakdown.map(($,V)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["‚Ä¢ ",$.role,": ",$.count]},V))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null},R=(T,W,M,L,$)=>{const V=a==="appearances"?"appearances":"winRateDisplay",z=a==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",N=a==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:W}),e.jsx(Y,{title:W,children:t=>{const F=l(t?null:15)[T];return e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:F,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:z,angle:270,position:"left",style:{textAnchor:"middle"}},domain:N}),e.jsx(H,{content:e.jsx(g,{})}),e.jsx(O,{dataKey:V,label:a==="winRate"?b=>{const{x:p,y:h,width:C,payload:y}=b;if(p===void 0||h===void 0||C===void 0||!y)return null;const k=y.winRate||"0";return e.jsxs("text",{x:p+C/2,y:h-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[k,"%"]})}:void 0,children:F.map((b,p)=>e.jsx(Z,{fill:$?$(b.name,p):M,onClick:()=>L(b.name),style:{cursor:"pointer"}},`cell-${p}`))})]})})})}})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:a,onChange:T=>d(T.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[i&&R("villageoisPowers","Camp Villageois","var(--chart-color-1)",T=>{c({selectedPlayer:s,campFilter:{selectedCamp:"Villageois",campFilterMode:a==="winRate"?"wins-only":"all-assignments"},selectedPower:T,fromComponent:`Historique des R√¥les - Pouvoir: ${T}`})},T=>T==="Chasseur"&&w.Chasseur?w.Chasseur:T==="Alchimiste"&&w.Alchimiste?w.Alchimiste:T==="Protecteur"&&w.Protecteur?w.Protecteur:T==="Disciple"&&w.Disciple?w.Disciple:T==="Inquisiteur"&&w.Inquisiteur?w.Inquisiteur:"var(--chart-color-1)"),m&&R("loupPowers","Camp Loups","var(--chart-color-2)",T=>{c({selectedPlayer:s,campFilter:{selectedCamp:"Loup",campFilterMode:a==="winRate"?"wins-only":"all-assignments"},selectedPower:T,fromComponent:`Historique des R√¥les - Pouvoir: ${T}`})},()=>w.Loup||"var(--chart-color-2)"),S&&R("secondaryRoles","R√¥les Secondaires","var(--chart-color-3)",T=>{c({selectedPlayer:s,selectedSecondaryRole:T,fromComponent:`Historique des R√¥les - R√¥le Secondaire: ${T}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"‚ÑπÔ∏è Les victoires et le taux de victoire excluent les parties o√π le r√¥le principal a chang√© en cours de partie (ex: Garde en Chasseur, r√©ssucit√© en Zombie par un Vaudou, etc...)."})]})]})}const we=["Transform","Untransform","UseGadget","HunterShoot","DrinkPotion"],ut={Transform:"Transformation (Loup)",Untransform:"D√©transformation",UseGadget:"Utilisation Gadget",HunterShoot:"Tir du Chasseur",DrinkPotion:"Potion bue"},pt={Transform:"var(--wolf-color, #8B0000)",Untransform:"var(--wolf-color-light, #CD5C5C)",UseGadget:"var(--chart-color-1, #8884d8)",HunterShoot:"var(--chart-color-2, #82ca9d)",DrinkPotion:"var(--chart-color-3, #ffc658)"};function mt(s){if(!s||typeof s!="string")return null;const c=s.trim().toUpperCase();if(c.length<2)return null;const v=c.charAt(0),f=parseInt(c.slice(1),10);return!["J","N","M","U"].includes(v)||isNaN(f)||f<1?null:{phase:v,number:f}}function ht(s,c){const v=s||c;if(!v)return 0;const f=mt(v);if(!f)return 0;const{phase:w,number:a}=f;return w==="N"?a:w==="J"||w==="M"?a-1:w==="U"?Math.max(0,Math.floor((a-1)/2)):0}function gt(s){return["Loup"].includes(s)}function xt({selectedPlayerName:s}){const{gameData:c}=ye(),{joueursData:v}=ue(),f=oe(),w=he(v),a=A.useMemo(()=>{if(!c||!s)return{actionTypeCounts:[],gadgetDetails:[],potionDetails:[],hunterTargets:[],hunterMissedShots:0,hunterTotalShots:0,transformationsPerGame:0,totalGamesWithActions:0,totalGamesPlayed:0,totalNightsAsWolf:0,transformsPerNight:0};const o={Transform:0,Untransform:0,UseGadget:0,HunterShoot:0,DrinkPotion:0},r={},n={},d={};let l=0,u=0,i=0;c.forEach(N=>{const t=N.PlayerStats.find(p=>p.Username.toLowerCase()===s.toLowerCase());if(!t)return;u++;let P=!1;const F=parseFloat(N.Version||"0");if(gt(t.MainRoleInitial)&&N.Modded&&F>=.217){const p=ht(t.DeathTiming,N.EndTiming);i+=p}(t.Actions||[]).forEach(p=>{if(p.ActionType==="HunterShoot"){o.HunterShoot++,P=!0,p.ActionTarget&&(d[p.ActionTarget]=(d[p.ActionTarget]||0)+1);return}const h=p.ActionType;we.includes(h)&&(o[h]++,P=!0,h==="UseGadget"&&p.ActionName&&p.ActionName!=="Balle"&&(r[p.ActionName]=(r[p.ActionName]||0)+1),h==="DrinkPotion"&&p.ActionName&&(n[p.ActionName]=(n[p.ActionName]||0)+1))}),P&&l++});const m=we.filter(N=>o[N]>0).map(N=>({actionType:N,label:ut[N],count:o[N],color:pt[N]})).sort((N,t)=>t.count-N.count),S=Object.entries(r).map(([N,t])=>({gadgetName:N,count:t})).sort((N,t)=>t.count-N.count).slice(0,ie.TOP_10),g=Object.entries(n).map(([N,t])=>({potionName:N,count:t})).sort((N,t)=>t.count-N.count).slice(0,ie.TOP_10),R=Object.entries(d).map(([N,t])=>({target:N,count:t})).sort((N,t)=>t.count-N.count).slice(0,ie.TOP_10),T=o.HunterShoot,W=Object.values(d).reduce((N,t)=>N+t,0),M=T-W,L=o.Transform,$=L>0?Math.max(1,c.filter(N=>{const t=N.PlayerStats.find(F=>F.Username.toLowerCase()===s.toLowerCase());return t?(t.Actions||[]).some(F=>F.ActionType==="Transform"):!1}).length):0,V=$>0?L/$:0,z=i>0?L/i:0;return{actionTypeCounts:m,gadgetDetails:S,potionDetails:g,hunterTargets:R,hunterMissedShots:M,hunterTotalShots:T,transformationsPerGame:V,totalGamesWithActions:l,totalGamesPlayed:u,totalNightsAsWolf:i,transformsPerNight:z}},[c,s]);return a.actionTypeCounts.length>0?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üéÆ Parties avec actions"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:a.totalGamesWithActions}),e.jsxs("p",{children:["sur ",a.totalGamesPlayed," parties analys√©es"]})]}),a.actionTypeCounts.find(o=>o.actionType==="Transform")&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üåô Nuits v√©cues en loup"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:f.Loup||"var(--wolf-color)"},children:a.totalNightsAsWolf}),e.jsx("p",{children:"nuits totales jou√©es en loup"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üê∫ Transformations / nuit"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:f.Loup||"var(--wolf-color)"},children:a.transformsPerNight.toFixed(2)}),e.jsx("p",{children:"transformations par nuit v√©cue"})]})]}),a.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üîß Gadgets utilis√©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:a.gadgetDetails.reduce((o,r)=>o+r.count,0)}),e.jsxs("p",{children:[a.gadgetDetails.length," types diff√©rents"]})]}),a.potionDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üß™ Potions bues"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:a.potionDetails.reduce((o,r)=>o+r.count,0)}),e.jsxs("p",{children:[a.potionDetails.length," types diff√©rents"]})]})]}),a.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Gadgets Utilis√©s"}),e.jsx(Y,{title:"Gadgets Utilis√©s",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.gadgetDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"gadgetName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Utilisations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:o,payload:r})=>{if(o&&r&&r.length>0){const n=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.gadgetName})}),e.jsxs("div",{children:["Utilis√© ",n.count," fois"]})]})}return null}}),e.jsx(O,{dataKey:"count",fill:"var(--chart-color-1)",children:a.gadgetDetails.map((o,r)=>e.jsx(Z,{fill:`hsl(${200+r*20}, 70%, 50%)`},`cell-gadget-${r}`))})]})})})})]}),a.potionDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Potions Bues"}),e.jsx(Y,{title:"Potions Bues",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.potionDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"potionName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Consommations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:o,payload:r})=>{if(o&&r&&r.length>0){const n=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.potionName})}),e.jsxs("div",{children:["Bue ",n.count," fois"]})]})}return null}}),e.jsx(O,{dataKey:"count",fill:"var(--chart-color-3)",children:a.potionDetails.map((o,r)=>e.jsx(Z,{fill:`hsl(${40+r*15}, 80%, 55%)`},`cell-potion-${r}`))})]})})})})]}),a.hunterTotalShots>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Statistiques du Chasseur"}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üéØ Tirs totaux"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:a.hunterTotalShots}),e.jsx("p",{children:"tirs effectu√©s"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"‚úÖ Tirs r√©ussis"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:f.Chasseur||"var(--chart-color-2)"},children:a.hunterTotalShots-a.hunterMissedShots}),e.jsx("p",{children:"cibles touch√©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"‚ùå Tirs manqu√©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--text-secondary)"},children:a.hunterMissedShots}),e.jsx("p",{children:"tirs sans cible"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üìä Pr√©cision"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:f.Chasseur||"var(--chart-color-2)"},children:[a.hunterTotalShots>0?((a.hunterTotalShots-a.hunterMissedShots)/a.hunterTotalShots*100).toFixed(1):"0","%"]}),e.jsx("p",{children:"taux de r√©ussite"})]})]}),a.hunterTargets.length>0&&e.jsx(Y,{title:"Cibles √âlimin√©es par le Chasseur",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.hunterTargets,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"target",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Nombre de tirs",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:o,payload:r})=>{if(o&&r&&r.length>0){const n=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.target})}),e.jsxs("div",{children:["Tu√© par le chasseur ",n.count," fois"]})]})}return null}}),e.jsx(O,{dataKey:"count",fill:f.Chasseur||"var(--chart-color-2)",children:a.hunterTargets.map((o,r)=>e.jsx(Z,{fill:w[o.target]||f.Chasseur||`hsl(${120+r*15}, 60%, 45%)`},`cell-hunter-${r}`))})]})})})})]}),(a.actionTypeCounts.find(o=>o.actionType==="Transform")||a.actionTypeCounts.find(o=>o.actionType==="Untransform"))&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Habitudes de Transformation (Loup)"}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üê∫ Transformations"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:f.Loup||"var(--wolf-color)"},children:a.actionTypeCounts.find(o=>o.actionType==="Transform")?.count||0}),e.jsx("p",{children:"transformations totales"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üë§ D√©transformations"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-secondary)"},children:a.actionTypeCounts.find(o=>o.actionType==="Untransform")?.count||0}),e.jsx("p",{children:"retours en forme humaine"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üìä Ratio"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:(()=>{const o=a.actionTypeCounts.find(n=>n.actionType==="Transform")?.count||0,r=a.actionTypeCounts.find(n=>n.actionType==="Untransform")?.count||0;return o===0?"0%":`${(r/o*100).toFixed(0)}%`})()}),e.jsx("p",{children:"d√©transformations / transformations"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ÔøΩ Nuits totales"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:a.totalNightsAsWolf}),e.jsx("p",{children:"nuits v√©cues en loup (opportunit√©s)"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üéØ Ratio / nuit"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:f.Loup||"var(--wolf-color)"},children:a.transformsPerNight.toFixed(2)}),e.jsx("p",{children:"transformations par nuit v√©cue"})]})]}),e.jsx(Y,{title:"Statistiques de Transformation",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:[{name:"Statistiques Loup","Nuits v√©cues":a.totalNightsAsWolf,Transformations:a.actionTypeCounts.find(o=>o.actionType==="Transform")?.count||0,D√©transformations:a.actionTypeCounts.find(o=>o.actionType==="Untransform")?.count||0}],margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",fontSize:14}),e.jsx(X,{label:{value:"Compte",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:o,payload:r})=>!o||!r||r.length===0?null:e.jsx("div",{className:"custom-tooltip",style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border-primary)",borderRadius:"4px",padding:"10px"},children:r.map((n,d)=>e.jsxs("div",{style:{color:n.color,marginBottom:"4px"},children:[e.jsxs("strong",{children:[n.name,":"]})," ",n.value]},d))})}),e.jsx(De,{}),e.jsx(O,{dataKey:"Nuits v√©cues",fill:"var(--chart-color-4, #a4de6c)"}),e.jsx(O,{dataKey:"Transformations",fill:f.Loup||"var(--wolf-color)"}),e.jsx(O,{dataKey:"D√©transformations",fill:"var(--accent-secondary)"})]})})})})]})]}):e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune donn√©e d'actions disponible pour ",s,"."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donn√©es d'actions ne sont disponibles que pour les parties r√©centes."})]})}function ft({viewMode:s,setViewMode:c,selectedMap:v,setSelectedMap:f,availableMaps:w,clusterRadius:a,setClusterRadius:x,availableDeathTypes:o,selectedDeathTypes:r,setSelectedDeathTypes:n,deathTypeColors:d,isDeathTypesExpanded:l,setIsDeathTypesExpanded:u}){return e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>c("deaths"),style:{background:s==="deaths"?"var(--accent-primary)":"transparent",color:s==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:s==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"üíÄ Morts"}),e.jsx("button",{type:"button",onClick:()=>c("kills"),style:{background:s==="kills"?"var(--accent-primary)":"transparent",color:s==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:s==="kills"?"bold":"normal",transition:"all 0.2s"},children:"‚öîÔ∏è Kills"}),e.jsx("button",{type:"button",onClick:()=>c("transformations"),style:{background:s==="transformations"?"var(--accent-primary)":"transparent",color:s==="transformations"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:s==="transformations"?"bold":"normal",transition:"all 0.2s"},children:"üê∫ Transfos"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:v,onChange:i=>f(i.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:w.map(i=>e.jsx("option",{value:i,children:i},i))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:a,onChange:i=>x(parseInt(i.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:a===0?"Aucun":`${a} unit√©${a>1?"s":""}`})]}),s!=="transformations"&&e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>u(!l),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:l?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:l?"rotate(90deg)":"rotate(0deg)"},children:"‚ñ∂"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[r.length," / ",o.length," s√©lectionn√©",r.length>1?"s":""]})]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),n(o)},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:i=>{i.stopPropagation(),n([])},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:o.map(i=>{const m=r.includes(i),S=d[i]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",background:m?"var(--bg-tertiary)":"transparent",borderRadius:"4px",border:`1px solid ${m?S:"var(--border-color)"}`,cursor:"pointer",transition:"all 0.2s",fontSize:"0.9rem"},onClick:g=>{g.stopPropagation(),n(m?R=>R.filter(T=>T!==i):R=>[...R,i])},children:[e.jsx("input",{type:"checkbox",checked:m,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:S,flexShrink:0}}),e.jsx("span",{children:de(i)})]},i)})})]})]})]})}function yt({zoneAnalysis:s,selectedMap:c,viewMode:v,selectedPlayerName:f,hoveredZone:w,setHoveredZone:a}){return!s||c!=="Village"||v!=="deaths"?null:e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"0rem",padding:"1.5rem",background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",borderRadius:"12px",border:"2px solid var(--accent-primary)",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",color:"var(--accent-primary)",fontSize:"1.3rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"üìä Analyse par zone (Village)"}),e.jsx("p",{style:{fontSize:"0.95rem",marginBottom:"1rem",color:"var(--text-secondary)",lineHeight:"1.5"},children:"Distribution des morts (selon les types s√©lectionn√©s) compar√©e √† la moyenne de tous les joueurs:"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:s.zoneStats.map(x=>{const o=x.zone===s.dominantZone&&s.maxDeviation>10;return e.jsxs("div",{onMouseEnter:()=>a(x.zone),onMouseLeave:()=>a(null),style:{padding:"1rem",background:"var(--bg-primary)",borderRadius:"8px",border:w===x.zone?"1px solid var(--accent-primary)":"1px solid var(--border-color)",color:"var(--text-primary)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.95rem"},children:x.zone}),e.jsxs("div",{style:{fontSize:"0.85rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[f,": ",e.jsxs("strong",{children:[x.playerPercent.toFixed(1),"%"]})," (",x.playerCount,")"]}),e.jsxs("div",{style:{opacity:.85},children:["Moyenne: ",x.avgPercent.toFixed(1),"%"]}),e.jsxs("div",{style:{marginTop:"0.25rem",color:o?"var(--accent-secondary)":x.deviation>0?"var(--accent-primary)":"var(--text-secondary)",fontWeight:Math.abs(x.deviation)>5?"bold":"normal"},children:[x.deviation>0?"+":"",x.deviation.toFixed(1),"% vs moyenne"]})]})]},x.zone)})}),s.dominantZone&&s.maxDeviation>10&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",fontSize:"0.95rem",color:"var(--accent-primary)",fontWeight:"bold",background:"var(--bg-primary)",borderRadius:"8px",border:"2px solid var(--accent-primary)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"‚ö†Ô∏è"}),e.jsxs("span",{children:[f," meurt significativement plus souvent en zone ",s.dominantZone,"(","+"+s.maxDeviation.toFixed(1),"% par rapport √† la moyenne)"]})]})]})}function vt({locationData:s,clusteredData:c,viewMode:v,selectedPlayerName:f,selectedMap:w,mapConfig:a,xDomain:x,zDomain:o,hoveredZone:r,getDeathColor:n,handleLocationClick:d}){const l=({active:u,payload:i})=>{if(!u||!i||i.length===0)return null;const m=i[0].payload,S=m.allLocations||[m],g=S.length>1,R=v==="transformations";if(g){const W=new Map,M=new Map,L=new Set,$=new Map;S.forEach(t=>{if(W.set(t.victimName,(W.get(t.victimName)||0)+1),R)$.set(t.camp,($.get(t.camp)||0)+1);else{const P=t.deathType?de(t.deathType):"Inconnu";M.set(P,(M.get(P)||0)+1)}L.add(t.gameId)});const V=Array.from(W.entries()).sort((t,P)=>P[1]-t[1]).slice(0,3),z=Array.from(M.entries()).sort((t,P)=>P[1]-t[1]).slice(0,3),N=Array.from($.entries()).sort((t,P)=>P[1]-t[1]);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[R?"üê∫":v==="deaths"?"üíÄ":"‚öîÔ∏è"," ",S.length," ",R?"transformations":v==="deaths"?"morts":"kills"," √† cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[R?e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Camps loup:"}),N.map(([t,P])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["‚Ä¢ ",t," (",P,"√ó)"]},t))]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:v==="deaths"?"Victimes:":"Kills sur:"}),V.map(([t,P])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["‚Ä¢ ",t," (",P,"√ó)"]},t))]}),e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Types de mort:"}),z.map(([t,P])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["‚Ä¢ ",t," (",P,"√ó)"]},t))]})]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["üìç ",L.size," partie",L.size>1?"s":""," diff√©rente",L.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concern√©es"})]})}const T=S[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[R?"üê∫":v==="deaths"?"üíÄ":"‚öîÔ∏è"," ",R?"Transformation de":v==="deaths"?"Mort de":"Kill de"," ",f]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[R?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["üë§ ",e.jsx("strong",{children:"Joueur:"})," ",T.victimName]}),e.jsxs("div",{children:["üèïÔ∏è ",e.jsx("strong",{children:"Camp loup:"})," ",T.camp]}),e.jsxs("div",{children:["üó∫Ô∏è ",e.jsx("strong",{children:"Carte:"})," ",T.mapName]}),e.jsxs("div",{children:["üéÆ ",e.jsx("strong",{children:"Partie:"})," #",T.gameId]})]}):v==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["‚ö∞Ô∏è ",e.jsx("strong",{children:"Victime:"})," ",T.victimName]}),e.jsxs("div",{children:["‚öîÔ∏è ",e.jsx("strong",{children:"Tueur:"})," ",T.killerName||"Inconnu"]}),e.jsxs("div",{children:["üíÄ ",e.jsx("strong",{children:"Type:"})," ",T.deathType?de(T.deathType):"Inconnu"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["üéØ ",e.jsx("strong",{children:"Victime:"})," ",T.victimName]}),e.jsxs("div",{children:["üèïÔ∏è ",e.jsx("strong",{children:"Camp victime:"})," ",T.camp]}),e.jsxs("div",{children:["üíÄ ",e.jsx("strong",{children:"Type:"})," ",T.deathType?de(T.deathType):"Inconnu"]})]}),!R&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["üó∫Ô∏è ",e.jsx("strong",{children:"Carte:"})," ",T.mapName]}),e.jsxs("div",{children:["üéÆ ",e.jsx("strong",{children:"Partie:"})," #",T.gameId]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les d√©tails de la partie"})]})};return e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:s.length>0?e.jsx(Y,{title:v==="deaths"?`Carte des Morts de ${f}`:`Carte des Kills de ${f}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(He,{margin:{top:20,right:30,left:60,bottom:20},children:[a&&e.jsx(ae,{x1:a.zMin,x2:a.zMax,y1:a.xMin,y2:a.xMax,fill:"transparent",stroke:"none",shape:u=>{const{x:i,y:m,width:S,height:g}=u;return e.jsx("image",{x:i,y:m,width:S,height:g,href:a.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),w==="Village"&&r&&e.jsxs(e.Fragment,{children:[r==="Ruines"&&e.jsx(ae,{x1:-220,x2:200,y1:100,y2:450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),r==="Village Principal"&&e.jsx(ae,{x1:-250,x2:100,y1:-120,y2:-450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),r==="Ferme"&&e.jsx(ae,{x1:-550,x2:-250,y1:150,y2:-150,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),r==="Village P√™cheur"&&e.jsx(ae,{x1:150,x2:500,y1:80,y2:-320,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),r==="Reste de la Carte"&&e.jsx(ae,{x1:a?.zMin??-600,x2:a?.zMax??600,y1:a?.xMin??-500,y2:a?.xMax??500,fill:"var(--accent-primary)",fillOpacity:.15,stroke:"var(--accent-primary)",strokeWidth:2,strokeDasharray:"5 5"})]}),e.jsx(J,{strokeDasharray:"3 3",stroke:a?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(Q,{dataKey:"z",type:"number",name:"Position Z",domain:o,hide:!0}),e.jsx(X,{dataKey:"x",type:"number",name:"Position X",domain:x,hide:!0}),e.jsx(H,{content:e.jsx(l,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Ue,{data:c,onClick:u=>d(u),style:{cursor:"pointer"},isAnimationActive:!1,children:c.map((u,i)=>{const m=Math.min(Math.log2(u.count+1)*3+5,18),S=Math.round(m);return e.jsx(Z,{fill:n(u.deathType,u.camp),stroke:u.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:u.count>1?2:1,opacity:.85,r:S},`cell-${i}`)})})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:v==="deaths"?`Aucune mort localis√©e pour ${f} sur cette carte.`:v==="kills"?`Aucun kill localis√© pour ${f} sur cette carte.`:`Aucune transformation en loup localis√©e pour ${f} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donn√©es de position ne sont disponibles que pour les parties r√©centes."})]})})}function Te(s,c){return c>=-250&&c<=100&&s>=-450&&s<=-120?"Village Principal":c>=-550&&c<=-250&&s>=-150&&s<=150?"Ferme":c>=150&&c<=500&&s>=-320&&s<=80?"Village P√™cheur":c>=-220&&c<=200&&s>=100&&s<=450?"Ruines":"Reste de la Carte"}function le(s){return s==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":s}function jt({selectedPlayerName:s}){const{navigateToGameDetails:c}=ne(),{gameData:v,isLoading:f,error:w}=ye(),a=oe(),[x,o]=A.useState("deaths"),[r,n]=A.useState(""),[d,l]=A.useState(0),[u,i]=A.useState(null),[m,S]=A.useState([]),[g,R]=A.useState(!1),{data:T}=ge(s,"Tous les camps"),W=A.useMemo(()=>{if(!v)return[];const C=new Set;return v.forEach(y=>{const k=y.PlayerStats.find(D=>D.Username.toLowerCase()===s.toLowerCase());k&&(k.DeathPosition!==null&&y.MapName&&C.add(y.MapName),y.PlayerStats.forEach(D=>{D.KillerName?.toLowerCase()===s.toLowerCase()&&D.DeathPosition!==null&&y.MapName&&C.add(y.MapName)}),k.Actions&&Array.isArray(k.Actions)&&k.Actions.some(D=>D.ActionType==="Transform")&&y.MapName&&C.add(y.MapName))}),Array.from(C).filter(y=>y==="Village"||y==="Ch√¢teau").sort((y,k)=>y==="Village"?-1:k==="Village"?1:y.localeCompare(k))},[v,s]),M=W.length>0?W[0]:"";r===""&&M!==""&&n(M);const{availableDeathTypes:L,deathTypeColors:$}=A.useMemo(()=>{if(!v||!s)return{availableDeathTypes:[],deathTypeColors:{}};const C=new Set,y={};return v.forEach(k=>{const D=k.PlayerStats.find(I=>I.Username.toLowerCase()===s.toLowerCase());if(D){if(D.DeathPosition&&D.DeathType){const I=le(D.DeathType);I&&C.add(I)}k.PlayerStats.forEach(I=>{if(I.KillerName?.toLowerCase()===s.toLowerCase()&&I.DeathPosition&&I.DeathType){const B=le(I.DeathType);B&&C.add(B)}})}}),C.forEach(k=>{y[k]=_e(k,a)}),{availableDeathTypes:Array.from(C).sort(),deathTypeColors:y}},[v,s,a]),V=(C,y)=>x==="transformations"&&y?a[y]||"var(--text-secondary)":C&&$[C]||"var(--text-secondary)";A.useEffect(()=>{if(m.length===0&&L.length>0){const C=L.filter(y=>y!=="VOTED");S(C)}},[L.length]);const z=A.useMemo(()=>{if(!v||!s)return[];const C=[];return v.forEach(y=>{if(r&&y.MapName!==r)return;const k=y.PlayerStats.find(D=>D.Username.toLowerCase()===s.toLowerCase());if(k)if(x==="deaths"){if(k.DeathPosition){const D=ce(k.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),I=pe(k.DeathPosition.x,k.DeathPosition.z,y.MapName);C.push({x:I.x,z:I.z,victimName:k.Username,killerName:k.KillerName||null,deathType:le(k.DeathType),mapName:y.MapName,camp:D,gameId:y.DisplayedId,displayedGameId:y.DisplayedId})}}else x==="kills"?y.PlayerStats.forEach(D=>{if(D.KillerName?.toLowerCase()===s.toLowerCase()&&D.DeathPosition){const I=ce(D.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),B=pe(D.DeathPosition.x,D.DeathPosition.z,y.MapName);C.push({x:B.x,z:B.z,victimName:D.Username,killerName:s,deathType:le(D.DeathType),mapName:y.MapName,camp:I,gameId:y.DisplayedId,displayedGameId:y.DisplayedId})}}):x==="transformations"&&k.Actions&&Array.isArray(k.Actions)&&k.Actions.forEach(D=>{if(D.ActionType==="Transform"&&D.Position){const I=ce(k.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),B=pe(D.Position.x,D.Position.z,y.MapName);C.push({x:B.x,z:B.z,victimName:k.Username,killerName:null,deathType:null,mapName:y.MapName,camp:I,gameId:y.DisplayedId,displayedGameId:y.DisplayedId})}})}),x!=="transformations"&&m.length>0&&m.length<L.length?C.filter(y=>y.deathType&&m.includes(y.deathType)):C},[v,s,x,r,m,L]),N=A.useMemo(()=>{if(r!=="Village"||x!=="deaths"||z.length===0)return null;const C={"Village Principal":0,Ferme:0,"Village P√™cheur":0,Ruines:0,"Reste de la Carte":0};if(z.forEach(G=>{const E=Te(G.x,G.z);C[E]=(C[E]||0)+1}),!v)return null;const y={"Village Principal":0,Ferme:0,"Village P√™cheur":0,Ruines:0,"Reste de la Carte":0};v.forEach(G=>{G.MapName==="Village"&&G.PlayerStats.forEach(E=>{if(!E.DeathPosition)return;const U=le(E.DeathType);if(m.length>0&&m.length<L.length&&(!U||!m.includes(U)))return;const _=pe(E.DeathPosition.x,E.DeathPosition.z,"Village"),xe=Te(_.x,_.z);y[xe]=(y[xe]||0)+1})});const k=Object.values(y).reduce((G,E)=>G+E,0),D=Object.values(C).reduce((G,E)=>G+E,0);if(k===0||D===0)return null;const I=["Village Principal","Village P√™cheur","Ferme","Ruines","Reste de la Carte"];let B=0,j=null;const q=I.map(G=>{const E=C[G]/D*100,U=y[G]/k*100,_=E-U;return _>B&&C[G]>=2&&(B=_,j=G),{zone:G,playerCount:C[G],playerPercent:E,avgPercent:U,deviation:_}});return{totalPlayerDeaths:D,totalAllDeaths:k,zoneStats:q,dominantZone:j,maxDeviation:B}},[z,r,x,v,m,L]),t=A.useMemo(()=>Ye(z,d).map((y,k)=>{const D=y.items[0],I=Je(y.items);return{x:y.centroidX,z:y.centroidZ,count:y.items.length,allLocations:y.items,victimName:y.items.length===1?D.victimName:null,killerName:y.items.length===1?D.killerName:null,deathType:I,mapName:D.mapName,camp:D.camp,gameId:y.items.length===1?D.gameId:null,displayedGameId:y.items.length===1?D.displayedGameId:null,clusterIndex:k}}),[z,d]),P=A.useMemo(()=>Qe(r),[r]),{xDomain:F,zDomain:b}=A.useMemo(()=>{if(P)return{xDomain:[P.xMin,P.xMax],zDomain:[P.zMin,P.zMax]};if(t.length===0)return{xDomain:[0,100],zDomain:[0,100]};const C=t.map(G=>G.x),y=t.map(G=>G.z),k=Math.min(...C),D=Math.max(...C),I=Math.min(...y),B=Math.max(...y),j=(D-k)*.1||10,q=(B-I)*.1||10;return{xDomain:[k-j,D+j],zDomain:[I-q,B+q]}},[t,P]),p=C=>{if(!C)return;const y=C.allLocations||[C];if(y.length===1)c({selectedGame:y[0].gameId,fromComponent:"Player Death Map"});else{const k=y.map(D=>D.gameId).filter(D=>D);c({selectedGameIds:k,fromComponent:"Player Death Map"})}},h=A.useMemo(()=>{if(!T?.mapStats||!r)return null;const C=T.mapStats[r];return C?{winRate:C.winRate,wins:C.wins,total:C.appearances}:null},[T,r]);return f?e.jsx("div",{className:"donnees-attente",children:"Chargement des donn√©es..."}):w?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",w]}):v?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsx(ft,{viewMode:x,setViewMode:o,selectedMap:r,setSelectedMap:n,availableMaps:W,clusterRadius:d,setClusterRadius:l,availableDeathTypes:L,selectedDeathTypes:m,setSelectedDeathTypes:S,deathTypeColors:$,isDeathTypesExpanded:g,setIsDeathTypesExpanded:R}),e.jsx(vt,{locationData:z,clusteredData:t,viewMode:x,selectedPlayerName:s,selectedMap:r,mapConfig:P,xDomain:F,zDomain:b,hoveredZone:u,getDeathColor:V,handleLocationClick:p}),e.jsx(yt,{zoneAnalysis:N,selectedMap:r,viewMode:x,selectedPlayerName:s,hoveredZone:u,setHoveredZone:i}),h&&e.jsxs("div",{style:{flex:"1 1 100%",textAlign:"center",padding:"0.75rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)",marginTop:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginRight:"1rem"},children:["Taux de victoire sur ",e.jsx("strong",{children:r})," :"]}),e.jsxs("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:parseFloat(h.winRate)>=50?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[h.winRate,"%"]}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["(",h.wins," / ",h.total," victoires)"]})]}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"√Ä propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",x==="deaths"?`les emplacements o√π ${s} est mort`:x==="kills"?`les emplacements o√π ${s} a √©limin√© d'autres joueurs`:`les emplacements o√π ${s} s'est transform√© en loup`," au cours des parties.",x!=="transformations"&&"Les couleurs indiquent le type de mort."," Cliquez sur un point pour voir les d√©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroup√©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"üíÄ Morts:"})," O√π le joueur a √©t√© √©limin√©",e.jsx("br",{}),e.jsx("strong",{children:"‚öîÔ∏è Kills:"})," O√π le joueur a √©limin√© d'autres joueurs",e.jsx("br",{}),e.jsx("strong",{children:"üê∫ Transformations:"})," O√π le joueur s'est transform√© en loup"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e disponible"})}function Ae(s){return s.PlayerStats.some(c=>c.SecondsTalkedOutsideMeeting>0||c.SecondsTalkedDuringMeeting>0)}function fe(s,c){const v=c.DeathDateIrl||s.EndDate,f=ke(s.StartDate,v);return f&&f>0?f:0}function bt(s){const c=s.filter(Ae),v=new Map;return c.forEach(f=>{f.PlayerStats.forEach(w=>{const a=te(w),x=$e(w),o=fe(f,w);if(o<=0)return;v.has(a)||v.set(a,{displayName:x,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const r=v.get(a);r.gamesPlayed++,r.totalSecondsAll+=(w.SecondsTalkedOutsideMeeting||0)+(w.SecondsTalkedDuringMeeting||0),r.totalGameDuration+=o})}),{playerStats:v,gamesWithTalkingData:c.length}}function Ct(s,c){if(!c||c.length===0||!s)return null;const v=bt(c),f=c.filter(Ae);if(f.length===0||v.playerStats.size===0)return null;let w=null;for(const[p,h]of v.playerStats)if(h.displayName===s){w=p;break}if(!w)return null;let a=0,x=0,o=0,r=0;const n={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},d=new Map;let l=0,u=0,i=0,m=0;if(f.forEach(p=>{const h=p.PlayerStats.find(q=>te(q)===w);if(!h)return;const C=fe(p,h);if(C<=0)return;a++;const y=h.SecondsTalkedOutsideMeeting||0,k=h.SecondsTalkedDuringMeeting||0,D=y+k;x+=y,o+=k,r+=C;const I=We(h.MainRoleInitial,h.Power);n[I].gamesPlayed++,n[I].secondsOutside+=y,n[I].secondsDuring+=k,n[I].gameDuration+=C;const B=Ke(h);d.has(B)||d.set(B,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const j=d.get(B);j.gamesPlayed++,j.totalSecondsAll+=D,j.totalGameDuration+=C}),a===0||r<=0)return null;const S=3600/r,g=x*S,R=o*S,T=(x+o)*S,W=x+o>0?o/(x+o)*100:0,M=[];for(const[p,h]of Object.entries(n)){if(h.gamesPlayed===0)continue;const C=h.gameDuration>0?3600/h.gameDuration:0,y=h.secondsOutside+h.secondsDuring;M.push({camp:p,gamesPlayed:h.gamesPlayed,totalSecondsOutside:h.secondsOutside,totalSecondsDuring:h.secondsDuring,totalSecondsAll:y,totalGameDurationSeconds:h.gameDuration,secondsOutsidePer60Min:h.secondsOutside*C,secondsDuringPer60Min:h.secondsDuring*C,secondsAllPer60Min:y*C,meetingRatio:y>0?h.secondsDuring/y*100:0})}M.sort((p,h)=>h.gamesPlayed-p.gamesPlayed);const L=Array.from(d.entries()).filter(([p,h])=>h.gamesPlayed>=1).map(([p,h])=>({role:p,gamesPlayed:h.gamesPlayed,secondsAllPer60Min:h.totalGameDuration>0?h.totalSecondsAll/h.totalGameDuration*3600:0,totalSecondsAll:h.totalSecondsAll})).sort((p,h)=>h.secondsAllPer60Min-p.secondsAllPer60Min),$=[];for(const[p,h]of v.playerStats)h.totalGameDuration>0&&$.push({id:p,name:h.displayName,per60:h.totalSecondsAll/h.totalGameDuration*3600});$.sort((p,h)=>h.per60-p.per60);const V=$.reduce((p,h)=>p+h.per60,0),z=$.length>0?V/$.length:0,N=$.findIndex(p=>p.id===w)+1,t=$.length,P=t>0?Math.round((1-(N-1)/t)*100):0,F=T;f.forEach(p=>{const h=p.PlayerStats.find(D=>te(D)===w);if(!h)return;const C=fe(p,h);if(C<=0)return;((h.SecondsTalkedOutsideMeeting||0)+(h.SecondsTalkedDuringMeeting||0))/C*3600>=F?(l++,h.Victorious&&u++):(i++,h.Victorious&&m++)});const b={gamesAboveAverage:l,winsAboveAverage:u,winRateAboveAverage:l>0?u/l*100:0,gamesBelowAverage:i,winsBelowAverage:m,winRateBelowAverage:i>0?m/i*100:0};return{playerName:s,gamesPlayed:a,gamesWithTalkingData:v.gamesWithTalkingData,totalSecondsOutside:x,totalSecondsDuring:o,totalSecondsAll:x+o,totalGameDurationSeconds:r,secondsOutsidePer60Min:g,secondsDuringPer60Min:R,secondsAllPer60Min:T,meetingRatio:W,campBreakdown:M,globalAverageSecondsAllPer60Min:z,playerRank:N,totalPlayersWithData:t,percentile:P,roleBreakdown:L,winCorrelation:b}}function St(s,c){return s?s.roleBreakdown.slice(0,c):[]}function wt(s){const{data:c,isLoading:v,error:f}=ve(w=>s?Ct(s,w):null);return{data:c,isLoading:v,error:f}}function Tt({selectedPlayerName:s}){const{data:c,isLoading:v,error:f}=wt(s),w=oe(),[a,x]=A.useState("both"),o=A.useMemo(()=>c?.campBreakdown?c.campBreakdown.map(i=>({camp:i.camp,"Hors r√©union":Math.round(i.secondsOutsidePer60Min),"En r√©union":Math.round(i.secondsDuringPer60Min),total:Math.round(i.secondsAllPer60Min),gamesPlayed:i.gamesPlayed,meetingRatio:i.meetingRatio.toFixed(1)})):[],[c]),r=A.useMemo(()=>c?[{name:"En r√©union",value:c.totalSecondsDuring,color:"#2196F3"},{name:"Hors r√©union",value:c.totalSecondsOutside,color:"#FF9800"}]:[],[c]);if(v)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(f)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",f]});if(!c)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donn√©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donn√©es de temps de parole ne sont disponibles que pour les parties r√©centes."})]});const n=c.secondsAllPer60Min-c.globalAverageSecondsAllPer60Min,d=c.globalAverageSecondsAllPer60Min>0?(n/c.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",l=n>0,u=c.winCorrelation.winRateAboveAverage-c.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üé§ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:re(c.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:l?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[l?"+":"",d,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üìä Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",c.playerRank," / ",c.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-c.percentile+1,"% ",c.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üìà Parties analys√©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:c.gamesPlayed}),e.jsxs("p",{children:["sur ",c.gamesWithTalkingData," avec donn√©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"üó£Ô∏è Ratio en r√©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[c.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),o.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(Y,{title:"Temps de parole par camp (par 60min de jeu)",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>x("meeting"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="meeting"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="meeting"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="meeting"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="meeting"?"bold":"normal"},children:"En r√©union"}),e.jsx("button",{onClick:()=>x("outside"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="outside"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="outside"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="outside"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="outside"?"bold":"normal"},children:"Hors r√©union"}),e.jsx("button",{onClick:()=>x("both"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="both"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="both"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="both"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="both"?"bold":"normal"},children:"Les deux"})]}),e.jsx("div",{style:{height:350},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:o,layout:"vertical",children:[e.jsx(J,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(Q,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:i=>`${Math.floor(i/60)}m`}),e.jsx(X,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(H,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(i,m)=>[re(i),m],labelFormatter:i=>{const m=o.find(S=>S.camp===i);return`${i} (${m?.gamesPlayed||0} parties)`}}),e.jsx(De,{}),(a==="both"||a==="outside")&&e.jsx(O,{dataKey:"Hors r√©union",stackId:"talk",fill:"#FF9800"}),(a==="both"||a==="meeting")&&e.jsx(O,{dataKey:"En r√©union",stackId:"talk",fill:"#2196F3"})]})})})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:(()=>{const i=o.find(R=>R.camp==="Villageois"),m=o.find(R=>R.camp==="Loup");if(!i||!m)return e.jsx("p",{children:"üí° Pas assez de donn√©es pour comparer les camps Villageois et Loups."});const S=i.total-m.total,g=m.total>0?(Math.abs(S)/m.total*100).toFixed(0):"0";return S>0?e.jsxs("p",{children:["üí° ",e.jsx("strong",{children:s})," parle"," ",e.jsxs("strong",{style:{color:je("Villageois")},children:[re(S)," de plus (+",g,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Villageois"})," qu'en tant que"," ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]}):S<0?e.jsxs("p",{children:["üí° ",e.jsx("strong",{children:s})," parle"," ",e.jsxs("strong",{style:{color:je("Loup")},children:[re(Math.abs(S))," de plus (+",g,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Loup"})," qu'en tant que"," ",e.jsx("strong",{children:"Villageois"})," (par heure de jeu)."]}):e.jsxs("p",{children:["üí° ",e.jsx("strong",{children:s})," parle exactement autant en tant que"," ",e.jsx("strong",{children:"Villageois"})," qu'en tant que ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(Y,{title:"R√©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Ne,{children:[e.jsx(Pe,{data:r,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:i=>`${i.name}: ${((i.percent||0)*100).toFixed(1)}%`,children:r.map((i,m)=>e.jsx(Z,{fill:i.color},`cell-${m}`))}),e.jsx(H,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:i=>re(i)})]})})})})}),c&&c.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(Y,{title:i=>i?"Top 15 r√¥les les plus bavards (par 60min)":"Top 5 r√¥les les plus bavards (par 60min)",children:i=>{const S=St(c,i?15:5).map(g=>({role:g.role,secondsPer60Min:Math.round(g.secondsAllPer60Min),gamesPlayed:g.gamesPlayed}));return e.jsx("div",{style:{height:i?400:300},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:S,children:[e.jsx(J,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(Q,{dataKey:"role",tick:{fill:"var(--text-primary)",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(X,{tick:{fill:"var(--text-secondary)"},tickFormatter:g=>`${Math.floor(g/60)}m`}),e.jsx(H,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:g=>[re(g),"Temps de parole"],labelFormatter:g=>{const R=S.find(T=>T.role===g);return`${g} (${R?.gamesPlayed||0} parties)`}}),e.jsx(O,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",children:S.map((g,R)=>e.jsx(Z,{fill:w[g.role]||w.Villageois},`cell-${R}`))})]})})})}})}),(c.winCorrelation.gamesAboveAverage>0||c.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"üéØ Corr√©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[c.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",c.winCorrelation.winsAboveAverage,"/",c.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[c.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",c.winCorrelation.winsBelowAverage,"/",c.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(u)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["üí° ",e.jsx("strong",{children:s})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:u>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[u>0?"sup√©rieur":"inf√©rieur"," de ",Math.abs(u).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function Rt({playerTitles:s,titlesLoading:c}){if(c)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des titres..."})]})});if(!s||s.titles.length===0)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-empty",children:[e.jsx("p",{children:"üìú Aucun titre disponible"}),e.jsx("p",{className:"empty-subtitle",children:s?.gamesPlayed?`${s.gamesPlayed} parties jou√©es - minimum 25 parties requises pour obtenir des titres`:"Les titres sont g√©n√©r√©s chaque dimanche pour les joueurs avec 25+ parties en mode modd√©"})]})});const v=[...s.titles].sort((x,o)=>{const r=s.titles.indexOf(x),d=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(x.category||"")?100-(x.percentile||50):x.percentile||50,l=(x.priority||0)*1e3+d*10-r,u=s.titles.indexOf(o),m=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(o.category||"")?100-(o.percentile||50):o.percentile||50;return(o.priority||0)*1e3+m*10-u-l}),f=v.filter(x=>!x.primaryOwner),w=v.filter(x=>x.primaryOwner),a=(x,o)=>{const r=s.primaryTitle?.id===x.id;return e.jsxs("div",{className:`title-card ${x.type} ${r?"primary":""} ${x.primaryOwner?"awarded-elsewhere":""}`,title:`${x.description}${x.percentile!==void 0?`
Meilleur¬∑e que ${x.percentile.toFixed(1)}% des joueurs`:""}`,children:[e.jsx("div",{className:"title-rank",children:o+1}),r&&e.jsx("div",{className:"title-crown",children:"üëë"}),e.jsx("div",{className:"title-emoji",children:x.emoji}),e.jsxs("div",{className:"title-info",children:[e.jsx("div",{className:"title-name",children:x.title}),e.jsx("div",{className:"title-description",children:x.description}),x.percentile!==void 0&&x.type!=="combination"&&e.jsxs("div",{className:"title-percentile",children:["Top ",(100-x.percentile).toFixed(0),"%"]}),e.jsx("div",{className:"title-type-badge",children:x.type==="combination"?"Combo":x.type==="role"?"R√¥le":"Stat"}),!r&&x.primaryOwner&&e.jsxs("div",{className:"title-primary-owner",children:["üë§ Titre principal de: ",e.jsx("strong",{children:x.primaryOwner})]}),x.type==="combination"&&x.conditions&&x.conditions.length>0&&e.jsxs("div",{className:"title-conditions-breakdown",children:[e.jsx("div",{className:"breakdown-header",children:"Conditions:"}),x.conditions.map((n,d)=>e.jsxs("div",{className:"condition-item",children:[e.jsxs("span",{className:"condition-stat",children:[n.stat==="winRate"?"Victoires":n.stat==="loot"?"R√©colte":n.stat==="lootVillageois"?"R√©colte (Villageois)":n.stat==="lootLoup"?"R√©colte (Loup)":n.stat==="survival"?"Survie":n.stat==="killRate"?"Kills":n.stat==="talking"?"Parole":n.stat==="talkingOutsideMeeting"?"Parole (hors d√©bats)":n.stat==="talkingDuringMeeting"?"Parole (meeting)":n.stat==="votingAggressive"?"Vote agressif":n.stat==="votingAccuracy"?"Pr√©cision vote":n.stat==="votingFirst"?"Vote rapide":n.stat==="survivalDay1"?"Survie J1":n.stat==="winRateVillageois"?"Victoires Villageois":n.stat==="winRateLoup"?"Victoires Loup":n.stat==="winRateSolo"?"Victoires Solo":n.stat==="hunterAccuracy"?"Pr√©cision cible chasseur":n.stat==="hunterShotAccuracy"?"Pr√©cision tir chasseur":n.stat==="zoneVillagePrincipal"?"Village Principal":n.stat==="zoneFerme"?"Ferme":n.stat==="zoneVillagePecheur"?"Village P√™cheur":n.stat==="zoneRuines"?"Ruines":n.stat==="zoneResteCarte"?"Reste de la carte":n.stat==="zoneDominantPercentage"?"Dominance zone":n.stat,":"]}),e.jsx("span",{className:`condition-category ${n.category?.toLowerCase()}`,children:n.category}),n.actualPercentile!==void 0&&e.jsxs("span",{className:"condition-percentile",children:["(Top ",(100-n.actualPercentile).toFixed(0),"%)"]})]},d))]})]})]},x.id)};return e.jsxs("div",{className:"titles-section",children:[e.jsxs("div",{className:"titles-header",children:[e.jsx("h3",{children:"üè∑Ô∏è Titres actuels"}),e.jsxs("p",{className:"titles-info",children:[s.titles.length," titre",s.titles.length>1?"s":""," ‚Ä¢ ",s.gamesPlayed," parties jou√©es"]})]}),f.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"titles-subsection-header",children:[e.jsxs("h4",{children:["‚ú® Vos Titres (",f.length,")"]}),e.jsx("p",{children:"Titres que vous poss√©dez ou partagez"})]}),e.jsx("div",{className:"titles-grid",children:f.map((x,o)=>a(x,o))})]}),w.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"titles-subsection-header secondary",children:[e.jsxs("h4",{children:["üèñÔ∏è Titres Qualifi√©s (",w.length,")"]}),e.jsx("p",{children:"Vous remplissez les conditions, mais un autre joueur a une meilleure revendication"})]}),e.jsx("div",{className:"titles-grid awarded-elsewhere-grid",children:w.map((x,o)=>a(x,f.length+o))})]})]})}function Ut(){const{settings:s,updateSettings:c}=me(),{navigateToGameDetails:v,navigationState:f,updateNavigationState:w}=ne(),{data:a,isLoading:x,error:o}=Le(),{joueursData:r,isLoading:n}=ue(),{data:d,isLoading:l,error:u}=st(s.highlightedPlayer),{playerData:i,isLoading:m}=at(s.highlightedPlayer),S=he(r),[g,R]=A.useState(""),[T,W]=A.useState(null),{clips:M}=Xe(s.highlightedPlayer),{clips:L}=Ze(),[$,V]=A.useState(()=>s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled?s.independentFilters.gameFilter==="modded"?"modded":"all":s.gameFilter==="modded"?"modded":"all"),z=A.useMemo(()=>s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled?s.independentFilters.gameFilter==="modded":s.gameFilter==="modded",[s.useIndependentFilters,s.independentFilters?.gameTypeEnabled,s.independentFilters?.gameFilter,s.gameFilter]),[N,t]=A.useState(s.selectedPlayerSelectionView||f.selectedPlayerSelectionView||"achievements"),[P,F]=A.useState("session"),[b,p]=A.useState("all");A.useEffect(()=>{if(s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled){const j=s.independentFilters.gameFilter==="modded"?"modded":"all";V(j)}else if(!s.useIndependentFilters){const j=s.gameFilter==="modded"?"modded":"all";V(j)}},[s.gameFilter,s.useIndependentFilters,s.independentFilters?.gameTypeEnabled,s.independentFilters?.gameFilter]),A.useEffect(()=>{z&&$!=="modded"&&V("modded")},[z,$]),A.useEffect(()=>{const j=s.selectedPlayerSelectionView||f.selectedPlayerSelectionView;j&&j!==N&&t(j)},[s.selectedPlayerSelectionView,f.selectedPlayerSelectionView]);const{data:h}=ge(s.highlightedPlayer||""),C=A.useMemo(()=>{if(!a||!a.GameStats)return[];const j=z?a.GameStats.filter(G=>G.Modded===!0):a.GameStats,q=new Map;return j.forEach(G=>{const E=new Date(G.StartDate);G.PlayerStats.forEach(U=>{const _=te(U),Me=r?.Players?.find(ze=>ze.SteamID===_)?.Joueur||U.Username;q.has(_)||q.set(_,{games:0,wins:0,firstDate:E,lastDate:E,displayName:Me});const se=q.get(_);se.games++,U.Victorious&&se.wins++,E<se.firstDate&&(se.firstDate=E),E>se.lastDate&&(se.lastDate=E)})}),Array.from(q.entries()).map(([G,E])=>{let U=r?.Players?.find(_=>_.SteamID===G);return U||(U=r?.Players?.find(_=>_.Joueur===E.displayName)),{id:G,name:E.displayName,totalGames:E.games,totalWins:E.wins,winRate:E.games>0?E.wins/E.games*100:0,firstGameDate:E.firstDate.toLocaleDateString("fr-FR"),lastGameDate:E.lastDate.toLocaleDateString("fr-FR"),isHighlighted:E.displayName===s.highlightedPlayer,image:U?.Image||null,twitch:U?.Twitch||null,youtube:U?.Youtube||null}})},[a,s.highlightedPlayer,r,z]),y=A.useMemo(()=>{if(!g.trim())return C;const j=g.toLowerCase();return C.filter(q=>q.name.toLowerCase().includes(j))},[C,g]),k=A.useMemo(()=>[...y].sort((j,q)=>q.totalGames-j.totalGames),[y]),D=j=>{c({highlightedPlayer:j}),R("")},I=j=>{t(j),w({selectedPlayerSelectionView:j}),c({selectedPlayerSelectionView:j,tab:"playerSelection"})},B=()=>{if(M.length===0)return;const j=Math.floor(Math.random()*M.length);W(M[j])};return x||n?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):o?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donn√©es des joueurs: ",o]})]}):!a||C.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donn√©e disponible"}),e.jsx("p",{children:"Aucun joueur trouv√© dans les donn√©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!s.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"S√©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en √©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:g,onChange:j=>R(j.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"üîç"})]}),e.jsxs("div",{className:"player-count",children:[y.length," joueur",y.length!==1?"s":"",g&&` (filtr√©${y.length!==1?"s":""} de ${C.length})`]})]})]}),e.jsx("div",{className:"player-display",children:g?y.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"R√©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>R(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:k.map(j=>e.jsxs("button",{type:"button",className:`suggestion-btn ${j.isHighlighted?"highlighted":""}`,onClick:()=>D(j.name),children:[j.image?e.jsx("img",{src:j.image,alt:`Photo de profil de ${j.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":S[j.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[j.name,j.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" ‚òÖ"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[j.totalGames," parties ‚Ä¢ ",j.winRate.toFixed(1),"% victoires"]})]})]},j.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouv√© pour "',g,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>R(""),children:"Effacer la recherche"})]}):s.highlightedPlayer?(()=>{const j=C.find(q=>q.name===s.highlightedPlayer);return j?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:j.name}),e.jsx("span",{className:"highlight-badge",children:"‚òÖ Mis en √©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[j.image?e.jsx("img",{src:j.image,alt:`Photo de profil de ${j.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":S[j.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[j.totalGames," parties ‚Ä¢ ",j.totalWins," victoires ‚Ä¢ ",j.winRate.toFixed(1),"% taux de victoire"]}),i?.primaryTitle?e.jsxs("div",{className:"player-primary-title",title:i.primaryTitle.description,style:{marginTop:"0.5rem",display:"inline-flex",alignItems:"center",gap:"0.3rem",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("span",{className:"title-emoji",children:i.primaryTitle.emoji}),e.jsx("span",{className:"title-text",children:i.primaryTitle.title})]}):e.jsx("div",{className:"player-no-title",style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic"},children:"üìú 25 parties modd√©es minimum pour obtenir un titre"}),(j.twitch||j.youtube||M.length>0)&&e.jsxs("div",{className:"social-links",children:[j.twitch&&e.jsx("a",{href:j.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"üì∫ Twitch"}),j.youtube&&e.jsx("a",{href:j.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"üé¨ YouTube"}),M.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:q=>{q.stopPropagation(),B()},title:`${M.length} clip${M.length>1?"s":""} disponible${M.length>1?"s":""}`,children:["üé¨ Clip al√©atoire (",M.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="achievements"?"active":""}`,onClick:()=>I("achievements"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="titles"?"active":""}`,onClick:()=>I("titles"),children:"Titres"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="evolution"?"active":""}`,onClick:()=>I("evolution"),children:"√âvolution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="camps"?"active":""}`,onClick:()=>I("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="roles"?"active":""}`,onClick:()=>I("roles"),children:"R√¥les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="actions"?"active":""}`,onClick:()=>I("actions"),children:"Actions"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="kills"?"active":""}`,onClick:()=>I("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="deathmap"?"active":""}`,onClick:()=>I("deathmap"),children:"Cartes"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${N==="talkingtime"?"active":""}`,onClick:()=>I("talkingtime"),children:"Parole"})]}),N==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[l?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):u?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["‚ùå Erreur lors du chargement des classements: ",u]})}):d?e.jsx(it,{achievements:$==="all"?d.allGamesAchievements:d.moddedOnlyAchievements,title:$==="all"?"Classements - Toutes les parties":"Classements - Parties modd√©es",emptyMessage:"Aucun classement dans cette cat√©gorie",achievementType:$}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[!z&&e.jsx("button",{type:"button",className:`filter-btn ${$==="all"?"active":""}`,onClick:q=>{q.stopPropagation(),V("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${$==="modded"?"active":""}`,onClick:q=>{q.stopPropagation(),V("modded")},disabled:z,children:"Parties modd√©es"})]})]}),N==="titles"&&e.jsx(Rt,{playerTitles:i,titlesLoading:m}),N==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[h&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{v({selectedPlayer:j.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${j.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:h.totalGames}),e.jsx("p",{children:"parties jou√©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumul√©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:Ge(h.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{v({selectedPlayer:j.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${j.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:h.totalWins}),e.jsx("p",{children:"parties gagn√©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[h.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:P,onChange:q=>F(q.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par ann√©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:b,onChange:q=>p(q.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"R√¥les solo"})]})]})]}),e.jsx(nt,{selectedPlayerName:j.name,groupingMethod:P,campFilter:b})]}),N==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ot,{selectedPlayerName:j.name})}),N==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(dt,{selectedPlayerName:j.name})}),N==="actions"&&e.jsx("div",{className:"player-history-section",children:e.jsx(xt,{selectedPlayerName:j.name})}),N==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(lt,{selectedPlayerName:j.name})}),N==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(jt,{selectedPlayerName:j.name})}),N==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Tt,{selectedPlayerName:j.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:q=>{q.stopPropagation(),c({highlightedPlayer:null})},children:"‚òÖ Retirer la mise en √©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"P√©riode d'activit√©:"}),e.jsxs("span",{className:"period-range",children:[j.firstGameDate," - ",j.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',s.highlightedPlayer,`" n'a pas √©t√© trouv√© dans les donn√©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>c({highlightedPlayer:null}),children:"Effacer la s√©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:k.map(j=>e.jsxs("div",{className:`character-card ${j.isHighlighted?"highlighted":""}`,onClick:()=>D(j.name),title:`${j.name} - ${j.totalGames} parties, ${j.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:j.image?e.jsx("img",{src:j.image,alt:`Photo de profil de ${j.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":S[j.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:j.name}),(j.twitch||j.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[j.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),j.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},j.id))})})}),T&&e.jsx(et,{clip:T,onClose:()=>W(null),relatedClips:tt(T,L),nextClip:Se(T,L),onNextClip:()=>{const j=Se(T,L);j&&W(j)},onRelatedClip:j=>{const q=L.find(G=>G.ClipId===j);q&&W(q)}})]})}export{Ut as PlayerSelectionPage};
