import{r as f,u as I,j as s}from"./index-D03cRt-g.js";import{u as V,a as G,b as P}from"./useRawGameData-FH85pRpG.js";import{a as D}from"./api-beq3FXpM.js";function k(a){const{data:m,isLoading:p,error:L}=V(),{data:v,isLoading:j,error:w}=G(),{data:x,isLoading:N,error:y}=P();return{data:f.useMemo(()=>{if(!m||!v||!x)return[];let o=[...m];return a&&(a.selectedPlayer&&(o=o.filter(l=>l["Liste des joueurs"].toLowerCase().includes(a.selectedPlayer.toLowerCase()))),a.selectedGame&&(o=o.filter(l=>l.Game===a.selectedGame)),a.selectedCamp&&(o=o.filter(l=>{if(a.selectedPlayer){const e=v.find(c=>c.Game===l.Game);if(!e)return!1;const i=a.selectedPlayer.toLowerCase();if(a.selectedCamp==="Autres"&&a._smallCamps){const c=a._smallCamps;for(const h of c){let n=!1;switch(h){case"Traître":n=!!(e.Traître&&e.Traître.toLowerCase().includes(i));break;case"Idiot du Village":n=!!(e["Idiot du village"]&&e["Idiot du village"].toLowerCase().includes(i));break;case"Cannibale":n=!!(e.Cannibale&&e.Cannibale.toLowerCase().includes(i));break;case"Agent":n=!!(e.Agent&&e.Agent.toLowerCase().includes(i));break;case"Espion":n=!!(e.Espion&&e.Espion.toLowerCase().includes(i));break;case"Scientifique":n=!!(e.Scientifique&&e.Scientifique.toLowerCase().includes(i));break;case"Amoureux":n=!!(e.Amoureux&&e.Amoureux.toLowerCase().includes(i));break;case"La Bête":n=!!(e["La Bête"]&&e["La Bête"].toLowerCase().includes(i));break;case"Chasseur de primes":n=!!(e["Chasseur de primes"]&&e["Chasseur de primes"].toLowerCase().includes(i));break;case"Vaudou":n=!!(e.Vaudou&&e.Vaudou.toLowerCase().includes(i));break;case"Villageois":const b=l["Liste des joueurs"].toLowerCase().includes(i),S=e.Loups&&e.Loups.toLowerCase().includes(i)||e.Traître&&e.Traître.toLowerCase().includes(i)||e["Idiot du village"]&&e["Idiot du village"].toLowerCase().includes(i)||e.Cannibale&&e.Cannibale.toLowerCase().includes(i)||e.Agent&&e.Agent.toLowerCase().includes(i)||e.Espion&&e.Espion.toLowerCase().includes(i)||e.Scientifique&&e.Scientifique.toLowerCase().includes(i)||e.Amoureux&&e.Amoureux.toLowerCase().includes(i)||e["La Bête"]&&e["La Bête"].toLowerCase().includes(i)||e["Chasseur de primes"]&&e["Chasseur de primes"].toLowerCase().includes(i)||e.Vaudou&&e.Vaudou.toLowerCase().includes(i);n=b&&!S;break}if(n)return!0}return!1}return e.Loups&&e.Loups.toLowerCase().includes(i)?a.selectedCamp==="Loups":e.Traître&&e.Traître.toLowerCase().includes(i)?a.selectedCamp==="Traître":e["Idiot du village"]&&e["Idiot du village"].toLowerCase().includes(i)?a.selectedCamp==="Idiot du Village":e.Cannibale&&e.Cannibale.toLowerCase().includes(i)?a.selectedCamp==="Cannibale":e.Agent&&e.Agent.toLowerCase().includes(i)?a.selectedCamp==="Agent":e.Espion&&e.Espion.toLowerCase().includes(i)?a.selectedCamp==="Espion":e.Scientifique&&e.Scientifique.toLowerCase().includes(i)?a.selectedCamp==="Scientifique":e.Amoureux&&e.Amoureux.toLowerCase().includes(i)?a.selectedCamp==="Amoureux":e["La Bête"]&&e["La Bête"].toLowerCase().includes(i)?a.selectedCamp==="La Bête":e["Chasseur de primes"]&&e["Chasseur de primes"].toLowerCase().includes(i)?a.selectedCamp==="Chasseur de primes":e.Vaudou&&e.Vaudou.toLowerCase().includes(i)?a.selectedCamp==="Vaudou":l["Liste des joueurs"].toLowerCase().includes(i)?a.selectedCamp==="Villageois":!1}else return l["Camp victorieux"]===a.selectedCamp})),a.selectedVictoryType&&(o=o.filter(l=>l["Type de victoire"]===a.selectedVictoryType)),a.selectedDate&&(o=o.filter(l=>{const e=l.Date;if(a.selectedDate.includes("/")&&a.selectedDate.split("/").length===2){const[i,r]=a.selectedDate.split("/"),c=e.split("/");if(c.length===3){const[,h,n]=c;return h===i&&n===r}}else return e===a.selectedDate;return!1})),a.selectedPlayerPair&&a.selectedPairRole&&(o=o.filter(l=>{const e=v.find(n=>n.Game===l.Game);if(!e)return!1;const[i,r]=a.selectedPlayerPair,c=i.toLowerCase(),h=r.toLowerCase();if(a.selectedPairRole==="wolves"){if(e.Loups){const n=e.Loups.toLowerCase();return n.includes(c)&&n.includes(h)}}else if(a.selectedPairRole==="lovers"&&e.Amoureux){const n=e.Amoureux.toLowerCase();return n.includes(c)&&n.includes(h)}return!1}))),o.map(l=>{const e=v.find(t=>t.Game===l.Game),i=x.filter(t=>t.Game===l.Game),r={};e&&(e.Loups&&(r.wolves=e.Loups.split(", ").filter(Boolean)),e.Traître&&(r.traitor=e.Traître),e["Idiot du village"]&&(r.villageIdiot=e["Idiot du village"]),e.Cannibale&&(r.cannibal=e.Cannibale),e.Agent&&(r.agent=e.Agent),e.Espion&&(r.spy=e.Espion),e.Scientifique&&(r.scientist=e.Scientifique),e.Amoureux&&(r.lovers=e.Amoureux.split(", ").filter(Boolean)),e["La Bête"]&&(r.beast=e["La Bête"]),e["Chasseur de primes"]&&(r.bountyHunter=e["Chasseur de primes"]),e.Vaudou&&(r.voodoo=e.Vaudou));const c=i.map(t=>({player:"Ponce",camp:t.Camp||"Unknown",isTraitor:t.Traître||!1,secondaryRole:t["Rôle secondaire"],wolfPower:t["Pouvoir de loup"],villagerJob:t["Métier villageois"],playersKilled:t["Joueurs tués"],deathDay:t["Jour de mort"],deathType:t["Type de mort"],killers:t["Joueurs tueurs"]})),h=[],n=l["Liste des joueurs"].split(", ").filter(Boolean),b=l["Liste des gagnants"].split(", ").filter(Boolean);return n.forEach(t=>{let d="Villageois",u="Villageois";const A=b.includes(t);e&&(e.Loups&&e.Loups.split(", ").includes(t)?(d="Loup-Garou",u="Loups"):e.Traître&&e.Traître===t?(d="Traître",u="Traître"):e["Idiot du village"]&&e["Idiot du village"]===t?(d="Idiot du village",u="Idiot du Village"):e.Cannibale&&e.Cannibale===t?(d="Cannibale",u="Cannibale"):e.Agent&&e.Agent===t?(d="Agent",u="Agent"):e.Espion&&e.Espion===t?(d="Espion",u="Espion"):e.Scientifique&&e.Scientifique===t?(d="Scientifique",u="Scientifique"):e["La Bête"]&&e["La Bête"]===t?(d="La Bête",u="La Bête"):e["Chasseur de primes"]&&e["Chasseur de primes"]===t?(d="Chasseur de primes",u="Chasseur de primes"):e.Vaudou&&e.Vaudou===t&&(d="Vaudou",u="Vaudou"),e.Amoureux&&e.Amoureux.split(", ").includes(t)&&(d==="Villageois"?d="Amoureux":d=`${d} (Amoureux)`,A&&l["Camp victorieux"]==="Amoureux"&&(u="Amoureux"))),h.push({player:t,role:d,camp:u,isAlive:A})}),{gameId:l.Game,date:l.Date,isModded:l["Game Moddée"],playerCount:l["Nombre de joueurs"],wolfCount:l["Nombre de loups"],hasTraitor:l["Rôle Traître"],hasLovers:l["Rôle Amoureux"],soloRoles:l["Rôles solo"],winningCamp:l["Camp victorieux"],victoryType:l["Type de victoire"],dayCount:l["Nombre de journées"],villagerSurvivors:l["Survivants villageois"],wolfSurvivors:l["Survivants loups (traître inclus)"],loverSurvivors:l["Survivants amoureux"],soloSurvivors:l["Survivants solo"],winners:l["Liste des gagnants"],harvest:l.Récolte,totalHarvest:l["Total récolte"],harvestPercentage:l["Pourcentage de récolte"],playersList:l["Liste des joueurs"],versions:l.Versions,map:l.Map,startTime:l.Début,endTime:l.Fin,roles:r,playerRoles:h,playerDetails:c}})},[m,v,x,a]),isLoading:p||j||N,error:L||w||y}}function F(){const{navigationFilters:a,navigateBack:m}=I(),{data:p,isLoading:L,error:v}=k(a),[j,w]=f.useState("date"),[x,N]=f.useState("desc"),[y,g]=f.useState(null),T=f.useMemo(()=>p?[...p].sort((e,i)=>{let r,c;switch(j){case"date":r=new Date(e.date.split("/").reverse().join("-")).getTime(),c=new Date(i.date.split("/").reverse().join("-")).getTime();break;case"gameId":r=e.gameId,c=i.gameId;break;case"playerCount":r=e.playerCount,c=i.playerCount;break;case"dayCount":r=e.dayCount,c=i.dayCount;break;case"winningCamp":r=e.winningCamp,c=i.winningCamp;break;case"victoryType":r=e.victoryType,c=i.victoryType;break;default:return 0}return x==="asc"?r>c?1:-1:r<c?1:-1}):[],[p,j,x]),C=e=>{j===e?N(x==="asc"?"desc":"asc"):(w(e),N("desc"))},o=e=>j!==e?"↕️":x==="asc"?"↗️":"↘️",l=()=>{const e=[];return a.selectedPlayer&&a.selectedCamp?e.push(`${a.selectedPlayer} jouant ${a.selectedCamp}`):(a.selectedPlayer&&e.push(`Joueur: ${a.selectedPlayer}`),a.selectedCamp&&e.push(`Camp: ${a.selectedCamp}`)),a.selectedVictoryType&&e.push(`Victoire: ${a.selectedVictoryType}`),a.selectedGame&&e.push(`Partie #${a.selectedGame}`),a.selectedDate&&(a.selectedDate.includes("/")&&a.selectedDate.split("/").length===2?e.push(`Mois: ${a.selectedDate}`):e.push(`Date: ${a.selectedDate}`)),e};return L?s.jsx("div",{className:"statistiques-chargement",children:"Chargement des détails des parties..."}):v?s.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",v]}):!p||p.length===0?s.jsxs("div",{className:"lycans-empty-section",children:[s.jsx("h2",{children:"Aucune partie trouvée"}),s.jsx("p",{children:"Aucune partie ne correspond aux critères sélectionnés."}),a.fromComponent&&s.jsxs("button",{onClick:m,className:"lycans-submenu-btn",style:{marginTop:"1rem"},children:["← Retour à ",a.fromComponent]})]}):s.jsxs("div",{className:"lycans-game-details",children:[s.jsxs("div",{className:"lycans-game-details-header",children:[s.jsxs("div",{className:"lycans-game-details-navigation",children:[a.fromComponent&&s.jsxs("button",{onClick:m,className:"lycans-submenu-btn",style:{marginRight:"1rem"},children:["← Retour à ",a.fromComponent]}),s.jsxs("h2",{children:["Détails des Parties (",p.length," partie",p.length>1?"s":"",")"]})]}),l().length>0&&s.jsxs("div",{className:"lycans-active-filters",children:[s.jsx("strong",{children:"Filtres actifs:"})," ",l().join(", ")]})]}),s.jsx("div",{className:"lycans-games-table-container",children:s.jsxs("table",{className:"lycans-games-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsxs("th",{onClick:()=>C("gameId"),className:"sortable",children:["Partie ",o("gameId")]}),s.jsxs("th",{onClick:()=>C("date"),className:"sortable",children:["Date ",o("date")]}),s.jsxs("th",{onClick:()=>C("playerCount"),className:"sortable",children:["Joueurs ",o("playerCount")]}),s.jsxs("th",{onClick:()=>C("dayCount"),className:"sortable",children:["Jours ",o("dayCount")]}),s.jsxs("th",{onClick:()=>C("winningCamp"),className:"sortable",children:["Camp Vainqueur ",o("winningCamp")]}),s.jsxs("th",{onClick:()=>C("victoryType"),className:"sortable",children:["Type de Victoire ",o("victoryType")]}),s.jsx("th",{children:"Détails"})]})}),s.jsx("tbody",{children:T.map(e=>s.jsxs(s.Fragment,{children:[s.jsxs("tr",{className:y===e.gameId?"selected":"",children:[s.jsxs("td",{children:["#",e.gameId]}),s.jsx("td",{children:e.date}),s.jsx("td",{children:e.playerCount}),s.jsx("td",{children:e.dayCount}),s.jsx("td",{style:{color:D[e.winningCamp]||"#fff"},children:e.winningCamp}),s.jsx("td",{children:e.victoryType}),s.jsx("td",{children:s.jsx("button",{onClick:()=>g(y===e.gameId?null:e.gameId),className:"lycans-details-btn",children:y===e.gameId?"Masquer":"Voir"})})]},e.gameId),y===e.gameId&&s.jsx("tr",{className:"game-details-row",children:s.jsx("td",{colSpan:7,children:s.jsx(R,{game:e})})},`${e.gameId}-details`)]}))})]})})]})}function R({game:a}){return s.jsx("div",{className:"lycans-game-detail-view",children:s.jsxs("div",{className:"lycans-game-detail-grid",children:[s.jsxs("div",{className:"lycans-game-detail-section",children:[s.jsx("h4",{children:"Informations Générales"}),s.jsxs("div",{className:"lycans-game-detail-stats",children:[s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Partie moddée:"}),s.jsx("span",{className:"value",children:a.isModded?"Oui":"Non"})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Nombre de loups:"}),s.jsx("span",{className:"value",children:a.wolfCount})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Traître:"}),s.jsx("span",{className:"value",children:a.hasTraitor?"Oui":"Non"})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Amoureux:"}),s.jsx("span",{className:"value",children:a.hasLovers?"Oui":"Non"})]}),a.soloRoles&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Rôles solo:"}),s.jsx("span",{className:"value",children:a.soloRoles})]})]})]}),s.jsxs("div",{className:"lycans-game-detail-section",children:[s.jsx("h4",{children:"Informations Supplémentaires"}),s.jsxs("div",{className:"lycans-game-detail-stats",children:[a.versions&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Version:"}),s.jsx("span",{className:"value",children:a.versions})]}),a.map&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Map:"}),s.jsx("span",{className:"value",children:a.map})]}),a.startTime&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Début:"}),s.jsx("span",{className:"value",children:a.startTime})]}),a.endTime&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Fin:"}),s.jsx("span",{className:"value",children:a.endTime})]})]})]}),s.jsxs("div",{className:"lycans-game-detail-section",children:[s.jsx("h4",{children:"Résultats"}),s.jsxs("div",{className:"lycans-game-detail-stats",children:[s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Survivants villageois:"}),s.jsx("span",{className:"value",children:a.villagerSurvivors})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Survivants loups:"}),s.jsx("span",{className:"value",children:a.wolfSurvivors})]}),a.loverSurvivors!==null&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Survivants amoureux:"}),s.jsx("span",{className:"value",children:a.loverSurvivors})]}),a.soloSurvivors!==null&&s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Survivants solo:"}),s.jsx("span",{className:"value",children:a.soloSurvivors})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Gagnants:"}),s.jsx("span",{className:"value",children:a.winners})]})]})]}),a.harvest!==null&&s.jsxs("div",{className:"lycans-game-detail-section",children:[s.jsx("h4",{children:"Récolte"}),s.jsxs("div",{className:"lycans-game-detail-stats",children:[s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Récolte:"}),s.jsx("span",{className:"value",children:a.harvest})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Total possible:"}),s.jsx("span",{className:"value",children:a.totalHarvest})]}),s.jsxs("div",{className:"lycans-stat-item",children:[s.jsx("span",{className:"label",children:"Pourcentage:"}),s.jsx("span",{className:"value",children:typeof a.harvestPercentage=="number"?(a.harvestPercentage*100).toFixed(1)+"%":"N/A"})]})]})]}),s.jsxs("div",{className:"lycans-game-detail-section full-width",children:[s.jsx("h4",{children:"Rôles des Joueurs"}),s.jsx("div",{className:"lycans-player-roles-grid",children:a.playerRoles.map((m,p)=>s.jsxs("div",{className:"lycans-player-role-item",children:[s.jsx("div",{className:"lycans-player-name",style:{color:D[m.camp]||"#fff"},children:m.player}),s.jsx("div",{className:"lycans-player-role",children:m.role}),s.jsx("div",{className:"lycans-player-camp",children:m.camp})]},p))})]})]})})}export{F as GameDetailsChart};
