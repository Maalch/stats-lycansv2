import{r as x,u as w,j as e}from"./index-DmNOrZoU.js";import{u as T,a as S,b as D}from"./useRawGameData-Daw6HwJk.js";import{a as g}from"./api-beq3FXpM.js";function G(s){const{data:m,isLoading:d,error:y}=T(),{data:h,isLoading:v,error:N}=S(),{data:o,isLoading:j,error:p}=D();return{data:x.useMemo(()=>{if(!m||!h||!o)return[];let i=[...m];return s&&(s.selectedPlayer&&(i=i.filter(l=>l["Liste des joueurs"].toLowerCase().includes(s.selectedPlayer.toLowerCase()))),s.selectedGame&&(i=i.filter(l=>l.Game===s.selectedGame)),s.selectedCamp&&(i=i.filter(l=>l["Camp victorieux"]===s.selectedCamp)),s.selectedVictoryType&&(i=i.filter(l=>l["Type de victoire"]===s.selectedVictoryType)),s.selectedDate&&(i=i.filter(l=>{const a=l.Date;if(s.selectedDate.includes("/")&&s.selectedDate.split("/").length===2){const[c,t]=s.selectedDate.split("/"),n=a.split("/");if(n.length===3){const[,C,r]=n;return C===c&&r===t}}else return a===s.selectedDate;return!1}))),i.map(l=>{const a=h.find(r=>r.Game===l.Game),c=o.filter(r=>r.Game===l.Game),t={};a&&(a.Loups&&(t.wolves=a.Loups.split(", ").filter(Boolean)),a.Traître&&(t.traitor=a.Traître),a["Idiot du village"]&&(t.villageIdiot=a["Idiot du village"]),a.Cannibale&&(t.cannibal=a.Cannibale),a.Agent&&(t.agent=a.Agent),a.Espion&&(t.spy=a.Espion),a.Scientifique&&(t.scientist=a.Scientifique),a.Amoureux&&(t.lovers=a.Amoureux.split(", ").filter(Boolean)),a["La Bête"]&&(t.beast=a["La Bête"]),a["Chasseur de primes"]&&(t.bountyHunter=a["Chasseur de primes"]),a.Vaudou&&(t.voodoo=a.Vaudou));const n=c.map(r=>({player:"Ponce",camp:r.Camp||"Unknown",isTraitor:r.Traître||!1,secondaryRole:r["Rôle secondaire"],wolfPower:r["Pouvoir de loup"],villagerJob:r["Métier villageois"],playersKilled:r["Joueurs tués"],deathDay:r["Jour de mort"],deathType:r["Type de mort"],killers:r["Joueurs tueurs"]}));return{gameId:l.Game,date:l.Date,isModded:l["Game Moddée"],playerCount:l["Nombre de joueurs"],wolfCount:l["Nombre de loups"],hasTraitor:l["Rôle Traître"],hasLovers:l["Rôle Amoureux"],soloRoles:l["Rôles solo"],winningCamp:l["Camp victorieux"],victoryType:l["Type de victoire"],dayCount:l["Nombre de journées"],villagerSurvivors:l["Survivants villageois"],wolfSurvivors:l["Survivants loups (traître inclus)"],loverSurvivors:l["Survivants amoureux"],soloSurvivors:l["Survivants solo"],winners:l["Liste des gagnants"],harvest:l.Récolte,totalHarvest:l["Total récolte"],harvestPercentage:l["Pourcentage de récolte"],playersList:l["Liste des joueurs"],versions:l.Versions,map:l.Map,startTime:l.Début,endTime:l.Fin,roles:t,playerDetails:n}})},[m,h,o,s]),isLoading:d||v||j,error:y||N||p}}function P(){const{navigationFilters:s,navigateBack:m}=w(),{data:d,isLoading:y,error:h}=G(s),[v,N]=x.useState("date"),[o,j]=x.useState("desc"),[p,f]=x.useState(null),b=x.useMemo(()=>d?[...d].sort((a,c)=>{let t,n;switch(v){case"date":t=new Date(a.date.split("/").reverse().join("-")).getTime(),n=new Date(c.date.split("/").reverse().join("-")).getTime();break;case"gameId":t=a.gameId,n=c.gameId;break;case"playerCount":t=a.playerCount,n=c.playerCount;break;case"dayCount":t=a.dayCount,n=c.dayCount;break;case"winningCamp":t=a.winningCamp,n=c.winningCamp;break;case"victoryType":t=a.victoryType,n=c.victoryType;break;default:return 0}return o==="asc"?t>n?1:-1:t<n?1:-1}):[],[d,v,o]),u=a=>{v===a?j(o==="asc"?"desc":"asc"):(N(a),j("desc"))},i=a=>v!==a?"↕️":o==="asc"?"↗️":"↘️",l=()=>{const a=[];return s.selectedPlayer&&a.push(`Joueur: ${s.selectedPlayer}`),s.selectedCamp&&a.push(`Camp: ${s.selectedCamp}`),s.selectedVictoryType&&a.push(`Victoire: ${s.selectedVictoryType}`),s.selectedGame&&a.push(`Partie #${s.selectedGame}`),a};return y?e.jsx("div",{className:"statistiques-chargement",children:"Chargement des détails des parties..."}):h?e.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",h]}):!d||d.length===0?e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h2",{children:"Aucune partie trouvée"}),e.jsx("p",{children:"Aucune partie ne correspond aux critères sélectionnés."}),s.fromComponent&&e.jsxs("button",{onClick:m,className:"lycans-submenu-btn",style:{marginTop:"1rem"},children:["← Retour à ",s.fromComponent]})]}):e.jsxs("div",{className:"lycans-game-details",children:[e.jsxs("div",{className:"lycans-game-details-header",children:[e.jsxs("div",{className:"lycans-game-details-navigation",children:[s.fromComponent&&e.jsxs("button",{onClick:m,className:"lycans-submenu-btn",style:{marginRight:"1rem"},children:["← Retour à ",s.fromComponent]}),e.jsxs("h2",{children:["Détails des Parties (",d.length," partie",d.length>1?"s":"",")"]})]}),l().length>0&&e.jsxs("div",{className:"lycans-active-filters",children:[e.jsx("strong",{children:"Filtres actifs:"})," ",l().join(", ")]})]}),e.jsx("div",{className:"lycans-games-table-container",children:e.jsxs("table",{className:"lycans-games-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>u("gameId"),className:"sortable",children:["Partie ",i("gameId")]}),e.jsxs("th",{onClick:()=>u("date"),className:"sortable",children:["Date ",i("date")]}),e.jsxs("th",{onClick:()=>u("playerCount"),className:"sortable",children:["Joueurs ",i("playerCount")]}),e.jsxs("th",{onClick:()=>u("dayCount"),className:"sortable",children:["Jours ",i("dayCount")]}),e.jsxs("th",{onClick:()=>u("winningCamp"),className:"sortable",children:["Camp Vainqueur ",i("winningCamp")]}),e.jsxs("th",{onClick:()=>u("victoryType"),className:"sortable",children:["Type de Victoire ",i("victoryType")]}),e.jsx("th",{children:"Détails"})]})}),e.jsx("tbody",{children:b.map(a=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:p===a.gameId?"selected":"",children:[e.jsxs("td",{children:["#",a.gameId]}),e.jsx("td",{children:a.date}),e.jsx("td",{children:a.playerCount}),e.jsx("td",{children:a.dayCount}),e.jsx("td",{style:{color:g[a.winningCamp]||"#fff"},children:a.winningCamp}),e.jsx("td",{children:a.victoryType}),e.jsx("td",{children:e.jsx("button",{onClick:()=>f(p===a.gameId?null:a.gameId),className:"lycans-details-btn",children:p===a.gameId?"Masquer":"Voir"})})]},a.gameId),p===a.gameId&&e.jsx("tr",{className:"game-details-row",children:e.jsx("td",{colSpan:7,children:e.jsx(L,{game:a})})},`${a.gameId}-details`)]}))})]})})]})}function L({game:s}){return e.jsx("div",{className:"lycans-game-detail-view",children:e.jsxs("div",{className:"lycans-game-detail-grid",children:[e.jsxs("div",{className:"lycans-game-detail-section",children:[e.jsx("h4",{children:"Informations Générales"}),e.jsxs("div",{className:"lycans-game-detail-stats",children:[e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Partie moddée:"}),e.jsx("span",{className:"value",children:s.isModded?"Oui":"Non"})]}),e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Nombre de loups:"}),e.jsx("span",{className:"value",children:s.wolfCount})]}),e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Traître:"}),e.jsx("span",{className:"value",children:s.hasTraitor?"Oui":"Non"})]}),e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Amoureux:"}),e.jsx("span",{className:"value",children:s.hasLovers?"Oui":"Non"})]}),s.soloRoles&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Rôles solo:"}),e.jsx("span",{className:"value",children:s.soloRoles})]})]})]}),e.jsxs("div",{className:"lycans-game-detail-section",children:[e.jsx("h4",{children:"Résultats"}),e.jsxs("div",{className:"lycans-game-detail-stats",children:[e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Survivants villageois:"}),e.jsx("span",{className:"value",children:s.villagerSurvivors})]}),e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Survivants loups:"}),e.jsx("span",{className:"value",children:s.wolfSurvivors})]}),s.loverSurvivors!==null&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Survivants amoureux:"}),e.jsx("span",{className:"value",children:s.loverSurvivors})]}),s.soloSurvivors!==null&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Survivants solo:"}),e.jsx("span",{className:"value",children:s.soloSurvivors})]}),e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Gagnants:"}),e.jsx("span",{className:"value",children:s.winners})]})]})]}),s.harvest!==null&&e.jsxs("div",{className:"lycans-game-detail-section",children:[e.jsx("h4",{children:"Récolte"}),e.jsxs("div",{className:"lycans-game-detail-stats",children:[e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Récolte:"}),e.jsx("span",{className:"value",children:s.harvest})]}),e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Total possible:"}),e.jsx("span",{className:"value",children:s.totalHarvest})]}),e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Pourcentage:"}),e.jsx("span",{className:"value",children:typeof s.harvestPercentage=="number"?(s.harvestPercentage*100).toFixed(1)+"%":"N/A"})]})]})]}),Object.keys(s.roles).length>0&&e.jsxs("div",{className:"lycans-game-detail-section",children:[e.jsx("h4",{children:"Rôles"}),e.jsxs("div",{className:"lycans-game-detail-stats",children:[s.roles.wolves&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Loups:"}),e.jsx("span",{className:"value",children:s.roles.wolves.join(", ")})]}),s.roles.traitor&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Traître:"}),e.jsx("span",{className:"value",children:s.roles.traitor})]}),s.roles.lovers&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Amoureux:"}),e.jsx("span",{className:"value",children:s.roles.lovers.join(", ")})]})]})]}),e.jsxs("div",{className:"lycans-game-detail-section full-width",children:[e.jsx("h4",{children:"Liste des Joueurs"}),e.jsx("div",{className:"lycans-players-list",children:s.playersList})]}),e.jsxs("div",{className:"lycans-game-detail-section full-width",children:[e.jsx("h4",{children:"Informations Supplémentaires"}),e.jsxs("div",{className:"lycans-game-detail-stats",children:[s.versions&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Version:"}),e.jsx("span",{className:"value",children:s.versions})]}),s.map&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Map:"}),e.jsx("span",{className:"value",children:s.map})]}),s.startTime&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Début:"}),e.jsx("span",{className:"value",children:s.startTime})]}),s.endTime&&e.jsxs("div",{className:"lycans-stat-item",children:[e.jsx("span",{className:"label",children:"Fin:"}),e.jsx("span",{className:"value",children:s.endTime})]})]})]})]})})}export{P as GameDetailsChart};
