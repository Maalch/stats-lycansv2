import{r as k,j as t,u as J,a as te,e as Q}from"./index-BzfCPwlu.js";import{d as re,e as G,u as ne,c as oe}from"./useDeathStatisticsFromRaw-0sI9-SXE.js";import{D as I}from"./datasyncExport-D6_8Fmuy.js";import{a as ae}from"./api-CYFnroV_.js";import{F as se,C as ie,X as le,Y as ce,a as de}from"./FullscreenChart-8NKfVu1B.js";import{g as X}from"./deathTypes-CGUOTngO.js";import{ak as fe,al as _,am as O,an as ue,ao as U,R as he,T as me}from"./CategoricalChart-Blt4q0ig.js";import{S as pe,a as xe}from"./ScatterChart-DahDE4en.js";import"./baseStatsHook-DMdPh28r.js";const ge=ve(ye);function ve(e){return function(i,d,s=d){if(!((d=+d)>=0))throw new RangeError("invalid rx");if(!((s=+s)>=0))throw new RangeError("invalid ry");let{data:r,width:c,height:u}=i;if(!((c=Math.floor(c))>=0))throw new RangeError("invalid width");if(!((u=Math.floor(u!==void 0?u:r.length/c))>=0))throw new RangeError("invalid height");if(!c||!u||!d&&!s)return i;const v=d&&e(d),x=s&&e(s),l=r.slice();return v&&x?(q(v,l,r,c,u),q(v,r,l,c,u),q(v,l,r,c,u),V(x,r,l,c,u),V(x,l,r,c,u),V(x,r,l,c,u)):v?(q(v,r,l,c,u),q(v,l,r,c,u),q(v,r,l,c,u)):x&&(V(x,r,l,c,u),V(x,l,r,c,u),V(x,r,l,c,u)),i}}function q(e,i,d,s,r){for(let c=0,u=s*r;c<u;)e(i,d,c,c+=s,1)}function V(e,i,d,s,r){for(let c=0,u=s*r;c<s;++c)e(i,d,c,c+u,s)}function ye(e){const i=Math.floor(e);if(i===e)return be(e);const d=e-i,s=2*e+1;return(r,c,u,v,x)=>{if(!((v-=x)>=u))return;let l=i*c[u];const a=x*i,y=a+x;for(let h=u,m=u+a;h<m;h+=x)l+=c[Math.min(v,h)];for(let h=u,m=v;h<=m;h+=x)l+=c[Math.min(v,h+a)],r[h]=(l+d*(c[Math.max(u,h-y)]+c[Math.min(v,h+y)]))/s,l-=c[Math.max(u,h-a)]}}function be(e){const i=2*e+1;return(d,s,r,c,u)=>{if(!((c-=u)>=r))return;let v=e*s[r];const x=u*e;for(let l=r,a=r+x;l<a;l+=u)v+=s[Math.min(c,l)];for(let l=r,a=c;l<=a;l+=u)v+=s[Math.min(c,l+x)],d[l]=v/i,v-=s[Math.max(r,l-x)]}}function je(e,i){let d=0;for(let s of e)s!=null&&(s=+s)>=s&&++d;return d}function Me(e,i){let d,s;if(i===void 0)for(const r of e)r!=null&&(d===void 0?r>=r&&(d=s=r):(d>r&&(d=r),s<r&&(s=r)));else{let r=-1;for(let c of e)(c=i(c,++r,e))!=null&&(d===void 0?c>=c&&(d=s=c):(d>c&&(d=c),s<c&&(s=c)))}return[d,s]}function ze(e,i,d){let s;for(;;){const r=fe(e,i,d);if(r===s||r===0||!isFinite(r))return[e,i];r>0?(e=Math.floor(e/r)*r,i=Math.ceil(i/r)*r):r<0&&(e=Math.ceil(e*r)/r,i=Math.floor(i*r)/r),s=r}}function Se(e){return Math.max(1,Math.ceil(Math.log(je(e))/Math.LN2)+1)}var we=Array.prototype,ee=we.slice;function Ce(e,i){return e-i}function Ee(e){for(var i=0,d=e.length,s=e[d-1][1]*e[0][0]-e[d-1][0]*e[0][1];++i<d;)s+=e[i-1][1]*e[i][0]-e[i-1][0]*e[i][1];return s}const W=e=>()=>e;function ke(e,i){for(var d=-1,s=i.length,r;++d<s;)if(r=Le(e,i[d]))return r;return 0}function Le(e,i){for(var d=i[0],s=i[1],r=-1,c=0,u=e.length,v=u-1;c<u;v=c++){var x=e[c],l=x[0],a=x[1],y=e[v],h=y[0],m=y[1];if(Ne(x,y,i))return 0;a>s!=m>s&&d<(h-l)*(s-a)/(m-a)+l&&(r=-r)}return r}function Ne(e,i,d){var s;return De(e,i,d)&&Ae(e[s=+(e[0]===i[0])],d[s],i[s])}function De(e,i,d){return(i[0]-e[0])*(d[1]-e[1])===(d[0]-e[0])*(i[1]-e[1])}function Ae(e,i,d){return e<=i&&i<=d||d<=i&&i<=e}function Re(){}var B=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function Z(){var e=1,i=1,d=Se,s=x;function r(l){var a=d(l);if(Array.isArray(a))a=a.slice().sort(Ce);else{const y=Me(l,Ie);for(a=_(...ze(y[0],y[1],a),a);a[a.length-1]>=y[1];)a.pop();for(;a[1]<y[0];)a.shift()}return a.map(y=>c(l,y))}function c(l,a){const y=a==null?NaN:+a;if(isNaN(y))throw new Error(`invalid value: ${a}`);var h=[],m=[];return u(l,y,function(b){s(b,l,y),Ee(b)>0?h.push([b]):m.push(b)}),m.forEach(function(b){for(var S=0,j=h.length,f;S<j;++S)if(ke((f=h[S])[0],b)!==-1){f.push(b);return}}),{type:"MultiPolygon",value:a,coordinates:h}}function u(l,a,y){var h=new Array,m=new Array,b,S,j,f,o,z;for(b=S=-1,f=F(l[0],a),B[f<<1].forEach(M);++b<e-1;)j=f,f=F(l[b+1],a),B[j|f<<1].forEach(M);for(B[f<<0].forEach(M);++S<i-1;){for(b=-1,f=F(l[S*e+e],a),o=F(l[S*e],a),B[f<<1|o<<2].forEach(M);++b<e-1;)j=f,f=F(l[S*e+e+b+1],a),z=o,o=F(l[S*e+b+1],a),B[j|f<<1|o<<2|z<<3].forEach(M);B[f|o<<3].forEach(M)}for(b=-1,o=l[S*e]>=a,B[o<<2].forEach(M);++b<e-1;)z=o,o=F(l[S*e+b+1],a),B[o<<2|z<<3].forEach(M);B[o<<3].forEach(M);function M(w){var C=[w[0][0]+b,w[0][1]+S],E=[w[1][0]+b,w[1][1]+S],L=v(C),D=v(E),n,p;(n=m[L])?(p=h[D])?(delete m[n.end],delete h[p.start],n===p?(n.ring.push(E),y(n.ring)):h[n.start]=m[p.end]={start:n.start,end:p.end,ring:n.ring.concat(p.ring)}):(delete m[n.end],n.ring.push(E),m[n.end=D]=n):(n=h[D])?(p=m[L])?(delete h[n.start],delete m[p.end],n===p?(n.ring.push(E),y(n.ring)):h[p.start]=m[n.end]={start:p.start,end:n.end,ring:p.ring.concat(n.ring)}):(delete h[n.start],n.ring.unshift(C),h[n.start=L]=n):h[L]=m[D]={start:L,end:D,ring:[C,E]}}}function v(l){return l[0]*2+l[1]*(e+1)*4}function x(l,a,y){l.forEach(function(h){var m=h[0],b=h[1],S=m|0,j=b|0,f=Y(a[j*e+S]);m>0&&m<e&&S===m&&(h[0]=K(m,Y(a[j*e+S-1]),f,y)),b>0&&b<i&&j===b&&(h[1]=K(b,Y(a[(j-1)*e+S]),f,y))})}return r.contour=c,r.size=function(l){if(!arguments.length)return[e,i];var a=Math.floor(l[0]),y=Math.floor(l[1]);if(!(a>=0&&y>=0))throw new Error("invalid size");return e=a,i=y,r},r.thresholds=function(l){return arguments.length?(d=typeof l=="function"?l:Array.isArray(l)?W(ee.call(l)):W(l),r):d},r.smooth=function(l){return arguments.length?(s=l?x:Re,r):s===x},r}function Ie(e){return isFinite(e)?e:NaN}function F(e,i){return e==null?!1:+e>=i}function Y(e){return e==null||isNaN(e=+e)?-1/0:e}function K(e,i,d,s){const r=s-i,c=d-i,u=isFinite(r)||isFinite(c)?r/c:Math.sign(r)/Math.sign(c);return isNaN(u)?e:e+u-.5}function Be(e){return e[0]}function We(e){return e[1]}function Pe(){return 1}function Te(){var e=Be,i=We,d=Pe,s=960,r=500,c=20,u=2,v=c*3,x=s+v*2>>u,l=r+v*2>>u,a=W(20);function y(o){var z=new Float32Array(x*l),M=Math.pow(2,-u),w=-1;for(const N of o){var C=(e(N,++w,o)+v)*M,E=(i(N,w,o)+v)*M,L=+d(N,w,o);if(L&&C>=0&&C<x&&E>=0&&E<l){var D=Math.floor(C),n=Math.floor(E),p=C-D-.5,g=E-n-.5;z[D+n*x]+=(1-p)*(1-g)*L,z[D+1+n*x]+=p*(1-g)*L,z[D+1+(n+1)*x]+=p*g*L,z[D+(n+1)*x]+=(1-p)*g*L}}return ge({data:z,width:x,height:l},c*M),z}function h(o){var z=y(o),M=a(z),w=Math.pow(2,2*u);return Array.isArray(M)||(M=_(Number.MIN_VALUE,O(z)/w,M)),Z().size([x,l]).thresholds(M.map(C=>C*w))(z).map((C,E)=>(C.value=+M[E],m(C)))}h.contours=function(o){var z=y(o),M=Z().size([x,l]),w=Math.pow(2,2*u),C=E=>{E=+E;var L=m(M.contour(z,E*w));return L.value=E,L};return Object.defineProperty(C,"max",{get:()=>O(z)/w}),C};function m(o){return o.coordinates.forEach(b),o}function b(o){o.forEach(S)}function S(o){o.forEach(j)}function j(o){o[0]=o[0]*Math.pow(2,u)-v,o[1]=o[1]*Math.pow(2,u)-v}function f(){return v=c*3,x=s+v*2>>u,l=r+v*2>>u,h}return h.x=function(o){return arguments.length?(e=typeof o=="function"?o:W(+o),h):e},h.y=function(o){return arguments.length?(i=typeof o=="function"?o:W(+o),h):i},h.weight=function(o){return arguments.length?(d=typeof o=="function"?o:W(+o),h):d},h.size=function(o){if(!arguments.length)return[s,r];var z=+o[0],M=+o[1];if(!(z>=0&&M>=0))throw new Error("invalid size");return s=z,r=M,f()},h.cellSize=function(o){if(!arguments.length)return 1<<u;if(!((o=+o)>=1))throw new Error("invalid cell size");return u=Math.floor(Math.log(o)/Math.LN2),f()},h.thresholds=function(o){return arguments.length?(a=typeof o=="function"?o:Array.isArray(o)?W(ee.call(o)):W(o),h):a},h.bandwidth=function(o){if(!arguments.length)return Math.sqrt(c*(c+1));if(!((o=+o)>=0))throw new Error("invalid bandwidth");return c=(Math.sqrt(4*o*o+1)-1)/2,f()},h}function Fe(e){for(var i=e.length/6|0,d=new Array(i),s=0;s<i;)d[s]="#"+e.slice(s*6,++s*6);return d}const qe=e=>ue(e[e.length-1]);var Ve=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Fe);const He=qe(Ve);function Xe({deathLocations:e,xDomain:i,zDomain:d,width:s=800,height:r=600,bandwidth:c=25,onRegionClick:u}){const v=k.useRef(null),x=k.useRef(null),l=k.useRef(null),a=k.useMemo(()=>U().domain(i).range([0,s]),[i,s]),y=k.useMemo(()=>U().domain(d).range([r,0]),[d,r]),h=k.useMemo(()=>e.length===0?[]:Te().x(f=>a(f.x)).y(f=>y(f.z)).size([s,r]).bandwidth(c).thresholds(15)(e),[e,a,y,s,r,c]),m=k.useMemo(()=>{const j=h.length>0?Math.max(...h.map(f=>f.value)):1;return f=>{const o=f/j;return He(o)}},[h]);k.useEffect(()=>{const j=v.current;if(!j||h.length===0)return;const f=j.getContext("2d");f&&(f.clearRect(0,0,s,r),h.forEach(o=>{f.fillStyle=m(o.value),f.globalAlpha=.6,o.coordinates.forEach(z=>{z.forEach(M=>{f.beginPath(),M.forEach((w,C)=>{C===0?f.moveTo(w[0],w[1]):f.lineTo(w[0],w[1])}),f.closePath(),f.fill()})})}),f.globalAlpha=1)},[h,s,r,m]),k.useEffect(()=>{const j=x.current;if(!j||e.length===0)return;const f=j.getContext("2d");f&&(f.clearRect(0,0,s,r),e.forEach(o=>{const z=a(o.x),M=y(o.z);f.beginPath(),f.arc(z,M,2,0,2*Math.PI),f.fillStyle="rgba(0, 0, 0, 0.3)",f.fill(),f.strokeStyle="rgba(255, 255, 255, 0.5)",f.lineWidth=.5,f.stroke()}))},[e,a,y,s,r]);const b=j=>{if(!u||!l.current)return;const f=l.current.getBoundingClientRect(),o=j.clientX-f.left,z=j.clientY-f.top,M=30,w=e.filter(C=>{const E=a(C.x),L=y(C.z);return Math.sqrt(Math.pow(E-o,2)+Math.pow(L-z,2))<=M});w.length>0&&u(w)},S=j=>{if(!l.current)return;const f=l.current.getBoundingClientRect(),o=j.clientX-f.left,z=j.clientY-f.top,M=20,w=e.filter(C=>{const E=a(C.x),L=y(C.z);return Math.sqrt(Math.pow(E-o,2)+Math.pow(L-z,2))<=M});l.current&&(l.current.style.cursor=w.length>0?"pointer":"default")};return t.jsxs("div",{ref:l,style:{position:"relative",width:`${s}px`,height:`${r}px`,margin:"0 auto"},onClick:b,onMouseMove:S,children:[t.jsx("canvas",{ref:v,width:s,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),t.jsx("canvas",{ref:x,width:s,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),t.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),t.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),t.jsxs("svg",{width:s,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(j=>{const f=s*j,o=i[0]+(i[1]-i[0])*j;return t.jsxs("g",{children:[t.jsx("line",{x1:f,y1:r,x2:f,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:f,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(o)})]},`x-${j}`)}),[0,.25,.5,.75,1].map(j=>{const f=r*(1-j),o=d[0]+(d[1]-d[0])*j;return t.jsxs("g",{children:[t.jsx("line",{x1:0,y1:f,x2:5,y2:f,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:10,y:f,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(o)})]},`z-${j}`)})]})]})}function $e({selectedCamp:e,availableDeathTypes:i,deathTypeColors:d}){const{navigateToGameDetails:s}=J(),{settings:r}=te(),{data:c,isLoading:u,error:v}=Q(),[x,l]=k.useState(""),[a,y]=k.useState("all"),[h,m]=k.useState(null),[b,S]=k.useState("scatter"),j=k.useMemo(()=>{if(!c)return[];const n=re(c),p=G(c,e),g=new Map;return p.forEach(N=>{g.set(N.mapName,(g.get(N.mapName)||0)+1)}),n.sort((N,R)=>{const P=g.get(N)||0;return(g.get(R)||0)-P})},[c,e]),f=j.length>0?j[0]:"";x===""&&f!==""&&l(f);const o=k.useMemo(()=>{if(!c)return[];let n=G(c,e);return x&&(n=n.filter(p=>p.mapName===x)),a!=="all"&&(n=n.filter(p=>p.deathType===a)),n},[c,e,x,a]),z=k.useMemo(()=>{const n=new Map;return o.forEach(p=>{const g=`${Math.round(p.x)}_${Math.round(p.z)}`;n.has(g)||n.set(g,[]),n.get(g).push(p)}),n},[o]),M=k.useMemo(()=>Array.from(z.entries()).map(([n,p])=>({...p[0],deathCount:p.length,allDeaths:p,locationKey:n})),[z]),w=({active:n,payload:p})=>{if(!n||!p||p.length===0)return null;const g=p[0].payload,N=`${Math.round(g.x)}_${Math.round(g.z)}`,R=z.get(N)||[g];if(R.length>1){const T=new Map,H=new Set;return R.forEach(A=>{const $=A.deathType?X(A.deathType):"Inconnu";T.set($,(T.get($)||0)+1),H.add(A.gameId)}),t.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[t.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:[R.length," morts Ã  cet endroit"]}),t.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[t.jsxs("div",{style:{marginBottom:"8px"},children:[t.jsx("strong",{children:"Position:"})," (",Math.round(g.x),", ",Math.round(g.z),")"]}),t.jsxs("div",{style:{marginBottom:"8px"},children:[t.jsx("strong",{children:"Types de mort:"}),t.jsx("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:Array.from(T.entries()).map(([A,$])=>t.jsxs("li",{children:[A," (",$,")"]},A))})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Parties:"})," ",Array.from(H).filter(A=>A).map(A=>`#${A}`).join(", ")]})]}),t.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir une des parties"})]})}return t.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[t.jsx("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:g.playerName}),t.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Camp:"})," ",g.camp]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Type de mort:"})," ",g.deathType?X(g.deathType):"Inconnu"]}),g.killerName&&t.jsxs("div",{children:[t.jsx("strong",{children:"TuÃ© par:"})," ",g.killerName]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Carte:"})," ",g.mapName]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Partie:"})," #",g.gameId]}),t.jsxs("div",{style:{marginTop:"4px",fontSize:"0.85rem",color:"var(--text-secondary)"},children:["Position: (",Math.round(g.x),", ",Math.round(g.z),")"]})]}),t.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})},C=n=>{if(!n)return;const p=n.allDeaths||[n];if(p.length===1)s({selectedGame:p[0].gameId,fromComponent:"Death Location View"});else{const g=p.map(N=>N.gameId).filter(N=>N);s({selectedGameIds:g,fromComponent:"Death Location View"})}},E=n=>n&&d[n]||"var(--text-secondary)",{xDomain:L,zDomain:D}=k.useMemo(()=>{if(M.length===0)return{xDomain:[0,100],zDomain:[0,100]};const n=M.map(A=>A.x),p=M.map(A=>A.z),g=Math.min(...n),N=Math.max(...n),R=Math.min(...p),P=Math.max(...p),T=(N-g)*.1||10,H=(P-R)*.1||10;return{xDomain:[g-T,N+T],zDomain:[R-H,P+H]}},[M]);return u?t.jsx("div",{className:"donnees-attente",children:"Chargement des localisations de mort..."}):v?t.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",v]}):c?t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Mode :"}),t.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[t.jsx("button",{onClick:()=>S("scatter"),style:{background:b==="scatter"?"var(--accent-primary)":"transparent",color:b==="scatter"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:b==="scatter"?"bold":"normal",transition:"all 0.2s"},children:"Points"}),t.jsx("button",{onClick:()=>S("heatmap"),style:{background:b==="heatmap"?"var(--accent-primary)":"transparent",color:b==="heatmap"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:b==="heatmap"?"bold":"normal",transition:"all 0.2s"},children:"Carte de chaleur"})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),t.jsx("select",{id:"map-select",value:x,onChange:n=>l(n.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:j.map(n=>t.jsx("option",{value:n,children:n},n))})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"death-type-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Type de mort :"}),t.jsxs("select",{id:"death-type-select",value:a,onChange:n=>y(n.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[t.jsx("option",{value:"all",children:"Tous les types"}),i.map(n=>t.jsx("option",{value:n,children:X(n)},n))]})]})]}),t.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Morts localisÃ©es"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary)"},children:o.length})]}),t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Camp filtrÃ©"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)",fontSize:"1.2rem"},children:e})]}),t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Type de mort"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-2)",fontSize:"1.2rem"},children:a==="all"?"Tous":X(a)})]})]}),o.length>0?t.jsx(se,{title:b==="scatter"?"Carte des Morts":"Carte de Chaleur des Morts",children:b==="scatter"?t.jsx("div",{style:{height:600},children:t.jsx(he,{width:"100%",height:"100%",children:t.jsxs(pe,{margin:{top:20,right:30,left:60,bottom:60},children:[t.jsx(ie,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),t.jsx(le,{dataKey:"x",type:"number",name:"Position X",label:{value:"Position X",position:"bottom",offset:10,style:{fill:"var(--text-secondary)"}},domain:L,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:n=>Math.round(n).toString()}),t.jsx(ce,{dataKey:"z",type:"number",name:"Position Z",label:{value:"Position Z",angle:-90,position:"left",offset:20,style:{fill:"var(--text-secondary)"}},domain:D,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:n=>Math.round(n).toString()}),t.jsx(me,{content:t.jsx(w,{}),cursor:{strokeDasharray:"3 3"}}),t.jsx(xe,{data:M,onClick:n=>C(n),onMouseEnter:n=>m(n),onMouseLeave:()=>m(null),style:{cursor:"pointer"},children:M.map((n,p)=>{const g=r.highlightedPlayer===n.playerName,N=h?.playerName===n.playerName&&h?.gameId===n.gameId,R=n.deathCount>1?7:5,P=R+2;return t.jsx(de,{fill:g?"var(--accent-primary)":E(n.deathType),stroke:g||N?"white":n.deathCount>1?"var(--accent-secondary)":"none",strokeWidth:g?3:N?2:n.deathCount>1?1:0,opacity:g?1:.7,r:g?P:N?R+1:R},`cell-${p}`)})})]})})}):t.jsx("div",{style:{padding:"2rem 0",display:"flex",justifyContent:"center"},children:t.jsx(Xe,{deathLocations:o,xDomain:L,zDomain:D,width:800,height:600,bandwidth:25,onRegionClick:n=>{if(n.length===1)s({selectedGame:n[0].gameId,fromComponent:"Death Location View (Heatmap)"});else{const p=n.map(g=>g.gameId).filter(g=>g);s({selectedGameIds:p,fromComponent:"Death Location View (Heatmap)"})}}})})}):t.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[t.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1rem"},children:"Aucune localisation de mort disponible pour les filtres sÃ©lectionnÃ©s"}),t.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes (non-legacy)."})]}),o.length>0&&t.jsxs("div",{style:{marginTop:"2rem",padding:"1rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[t.jsx("h3",{style:{marginBottom:"1rem",color:"var(--text-primary)"},children:"LÃ©gende des types de mort"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem"},children:i.map(n=>{const p=o.filter(g=>g.deathType===n).length;return p===0?null:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.9rem"},children:[t.jsx("div",{style:{width:"16px",height:"16px",borderRadius:"50%",backgroundColor:d[n],flexShrink:0}}),t.jsxs("span",{style:{color:"var(--text-primary)"},children:[X(n)," (",p,")"]})]},n)})})]}),t.jsxs("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:[t.jsx("p",{children:t.jsx("strong",{children:"Ã€ propos de cette visualisation :"})}),t.jsxs("ul",{style:{marginTop:"0.5rem",paddingLeft:"1.5rem"},children:[t.jsx("li",{children:"Les positions sont basÃ©es sur les coordonnÃ©es X et Z (vue 2D de la carte)"}),b==="scatter"?t.jsxs(t.Fragment,{children:[t.jsx("li",{children:"Chaque point reprÃ©sente la mort d'un joueur Ã  un endroit prÃ©cis"}),t.jsx("li",{children:"La couleur indique le type de mort (voir lÃ©gende ci-dessus)"}),t.jsxs("li",{children:["Les joueurs en surbrillance sont affichÃ©s en "," ",t.jsx("span",{style:{color:"var(--accent-primary)",fontWeight:"bold"},children:"couleur primaire"})]}),t.jsx("li",{children:"Cliquez sur un point pour voir les dÃ©tails de la partie"}),t.jsx("li",{children:"Survolez un point pour voir les informations dÃ©taillÃ©es"})]}):t.jsxs(t.Fragment,{children:[t.jsx("li",{children:"La carte de chaleur montre les zones de forte densitÃ© de morts (du jaune au rouge)"}),t.jsx("li",{children:"Les points noirs indiquent l'emplacement exact de chaque mort"}),t.jsx("li",{children:"Les zones rouges indiquent une concentration Ã©levÃ©e de morts"}),t.jsx("li",{children:"Cliquez sur une zone pour voir les dÃ©tails des parties associÃ©es"}),t.jsx("li",{children:'Utilisez le mode "Points" pour voir les dÃ©tails individuels par type de mort'})]})]}),t.jsx("p",{style:{marginTop:"0.5rem",fontStyle:"italic",color:"var(--text-secondary)"},children:"Note : Seules les parties rÃ©centes contiennent des donnÃ©es de position. Les parties legacy sont exclues."})]})]}):t.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function et(){const{navigationState:e,updateNavigationState:i}=J(),[d,s]=k.useState(e.deathLocationState?.selectedCamp||"Tous les camps"),{data:r}=ne(),{data:c}=Q(),u=ae();k.useEffect(()=>{(!e.deathLocationState||e.deathLocationState.selectedCamp!==d)&&i({deathLocationState:{selectedCamp:d}})},[d,e.deathLocationState,i]);const v=k.useMemo(()=>c?oe(c):[],[c]),x=k.useMemo(()=>{const a={};v.forEach(m=>{m===I.BY_WOLF?a[m]=u.Loup:m===I.VOTED?a[m]="var(--chart-color-1)":m===I.BULLET||m===I.BULLET_HUMAN||m===I.BULLET_WOLF?a[m]=u.Chasseur:m===I.BY_ZOMBIE?a[m]=u.Vaudou:m===I.ASSASSIN?a[m]=u.Alchimiste:m===I.AVENGER?a[m]="var(--chart-color-2)":m===I.LOVER_DEATH?a[m]=u.Amoureux:m===I.BY_BEAST?a[m]="var(--chart-color-3)":m===I.SHERIF_SUCCESS&&(a[m]="var(--chart-color-4)")});const y=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let h=0;return v.forEach(m=>{a[m]||(a[m]=y[h%y.length],h++)}),a},[v,u]),l=a=>{s(a),i({deathLocationState:{selectedCamp:a}})};return t.jsxs("div",{className:"lycans-general-stats",children:[t.jsx("h2",{children:"ðŸ—ºï¸ Carte de Chaleur des Morts"}),t.jsx("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),t.jsx("select",{id:"camp-select",value:d,onChange:a=>l(a.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:r?.map(a=>t.jsx("option",{value:a,children:a},a))})]})}),t.jsx($e,{selectedCamp:d,availableDeathTypes:v,deathTypeColors:x})]})}export{et as DeathLocationHeatmap};
