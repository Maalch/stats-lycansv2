import{a as ue,r as M,g as X,f as Te,u as ee,j as e,d as be,e as Ae,o as Me}from"./index-DXlb78Oo.js";import{u as oe}from"./useJoueursData-D-B1SYZ7.js";import{u as pe}from"./baseStatsHook-CjobfdCd.js";import{g as Fe}from"./gameUtils-DYpUb-C5.js";import{a as Ce,g as ne,c as we,b as ze}from"./datasyncExport-CjB7UYqV.js";import{u as me,g as $e,a as se,l as Se,d as he}from"./api-IH63JAuS.js";import{f as re,d as We}from"./durationFormatters-C9UyWcKX.js";import{F as B,C as K,X as H,Y as _,a as Y}from"./FullscreenChart-CsFxlyQX.js";import{R as V,T as G}from"./CategoricalChart-CFenk9hn.js";import{L as Ie,a as Le}from"./LineChart-D2Z3E7Vv.js";import{B as Z,a as U}from"./BarChart-CavG7m4G.js";import{P as Re,a as ke}from"./PieChart-DMl9zfru.js";import{u as qe}from"./useDeathStatisticsFromRaw-DANhV7fK.js";import{R as ge}from"./ReferenceLine-Be_N2LyT.js";import{g as ie}from"./deathTypes-gHH1w6_X.js";import{i as xe,g as fe,V as Ee,a as Ve}from"./roleUtils-CLjkiQQc.js";import{f as ce,a as Ge,b as Be,d as Oe,S as Ke,R as ae,e as He}from"./deathLocationUtils-DSQmXYQP.js";import{L as _e}from"./Legend-IEK_tukP.js";import{a as Ue,u as Ye}from"./useClips-a8HHc681.js";import{C as Je,f as ye,a as Ze}from"./ClipViewer-DZE1ptEh.js";import"./ActivePoints-Dbnj1zZ9.js";import"./PolarChart-CN2xf2cD.js";function Qe(r){const{settings:u}=ue(),{joueursData:b}=oe(),[C,w]=M.useState(null),[x,k]=M.useState(!1),[y,p]=M.useState(null);M.useEffect(()=>{let l=!0;return(async()=>{try{k(!0),p(null);const i=u.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",a=await fetch(i);if(!a.ok)throw new Error(`Failed to load achievements: ${a.status} ${a.statusText}`);const n=await a.json();l&&w(n)}catch(i){l&&p(i instanceof Error?i.message:"Failed to load achievements")}finally{l&&k(!1)}})(),()=>{l=!1}},[u.dataSource]);const f=(()=>{if(!r||!C)return null;const s=b?.Players?.find(i=>i.Joueur===r)?.SteamID;return s&&C.achievements[s]||null})();return M.useEffect(()=>{r&&C&&b&&b.Players?.find(i=>i.Joueur===r)?.SteamID},[r,C,b,u.dataSource]),{data:f,isLoading:x,error:y,metadata:{generatedAt:C?.generatedAt||null,totalPlayers:C?.totalPlayers||0,totalGames:C?.totalGames||0,totalModdedGames:C?.totalModdedGames||0}}}function Xe(r,u,b){if(!r||r.trim()===""||u.length===0)return null;const C=[];let w=r;u.forEach(s=>{const i=s.PlayerStats.find(a=>X(a)===r||a.Username.toLowerCase()===r.toLowerCase());if(i){w=i.Username;const a=i.MainRoleInitial==="Louveteau"?i.MainRoleInitial:Ce(i.MainRoleInitial,i.MainRoleChanges||[]),n=ne(a);if(b&&b!=="Tous les camps"&&n!==b)return;const v=Fe(s),o=i.Victorious,g=Te(new Date(s.StartDate)),A=we(s.StartDate,s.EndDate)||0;C.push({gameId:s.Id,date:g,camp:n,won:o,winnerCamp:v,playersInGame:s.PlayerStats.length,mapName:s.MapName,duration:A})}}),C.sort((s,i)=>{const a=n=>{const v=n.split("/");return v.length===3?new Date(parseInt(v[2]),parseInt(v[1])-1,parseInt(v[0])):new Date(n)};return a(i.date).getTime()-a(s.date).getTime()});const x=C.length,k=C.filter(s=>s.won).length,y=x>0?(k/x*100).toFixed(2):"0.00",p={};C.forEach(s=>{p[s.camp]||(p[s.camp]={appearances:0,wins:0,winRate:"0.00"}),p[s.camp].appearances++,s.won&&p[s.camp].wins++}),Object.keys(p).forEach(s=>{const i=p[s];i.winRate=i.appearances>0?(i.wins/i.appearances*100).toFixed(2):"0.00"});const f={};C.forEach(s=>{f[s.mapName]||(f[s.mapName]={appearances:0,wins:0,winRate:"0.00"}),f[s.mapName].appearances++,s.won&&f[s.mapName].wins++}),Object.keys(f).forEach(s=>{const i=f[s];i.winRate=i.appearances>0?(i.wins/i.appearances*100).toFixed(2):"0.00"});const l=C.reduce((s,i)=>s+i.duration,0);return{playerName:w,totalGames:x,totalWins:k,winRate:y,totalPlayTime:l,games:C,campStats:p,mapStats:f}}function et(r){const u={};let b=0,C=0;return Object.entries(r).forEach(([w,x])=>{w==="Village"||w==="ChÃ¢teau"?u[w]={...x}:(b+=x.appearances,C+=x.wins)}),b>=10&&(u.Autres={appearances:b,wins:C,winRate:b>0?(C/b*100).toFixed(2):"0.00"}),u}function le(r,u){const{data:b,isLoading:C,error:w}=pe(x=>r?Xe(r,x,u):null);return{data:b,isLoading:C,error:w}}function tt({achievements:r,title:u,emptyMessage:b,achievementType:C="all"}){const{navigateToTab:w,updateNavigationState:x,clearNavigation:k}=ee(),{settings:y,updateSettings:p}=ue(),{joueursData:f}=oe(),l=me(f),s=(t,R)=>{if(R.stopPropagation(),!t.redirectTo)return;k();const S=y.highlightedPlayer;if(p(C==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:S,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:S,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const m=y.highlightedPlayer||"",c=i(t.description,m);c&&x({playerComparisonState:{selectedPlayer1:m,selectedPlayer2:c,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const m=t.description.toLowerCase().includes("loup");x({selectedPairingTab:m?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const m=t.description.match(/(Villageois|Loups|Autres)/i);m&&x({deathStatsSelectedCamp:m[1]});let c=10;const d=t.description.match(/min\.\s*(\d+)/);d&&(c=parseInt(d[1],10));let D="totalKills",F="killers";const P=t.redirectTo.chartSection;P&&(P==="killers-total"?(D="totalKills",F="killers"):P==="killers-average"?(D="averageKills",F="killers"):P==="deaths-total"?(D="totalDeaths",F="deaths"):P==="survivors-average"?(D="survivalRate",F="deaths"):(P==="hunters-good"||P==="hunters-bad")&&(F="hunter",D="averageKills")),x({deathStatisticsState:{selectedCamp:m?.[1]||"Tous les camps",minGamesForAverage:c,selectedView:F,focusChart:D}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const m=t.redirectTo.mapFilter||"all";let c=10;const d=t.description.match(/min\.\s*(\d+)/);d&&(c=parseInt(d[1])),p(C==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:m,playerFilter:{mode:"none",players:[]},highlightedPlayer:S,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:m,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:m,playerFilter:{mode:"none",players:[]},highlightedPlayer:S,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:m,playerFilter:{mode:"none",players:[]}}}),x({playersGeneralState:{minGamesForWinRate:c,winRateOrder:"best",focusChart:"winRate"}}),w("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&x({selectedPlayerName:y.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let m="wins";const c=t.title.toLowerCase(),d=t.description.toLowerCase();c.includes("dÃ©faite")||d.includes("dÃ©faite")?m="losses":c.includes("loup")||d.includes("loup")?m="loup":c.includes("villageois")||d.includes("villageois")?m="villageois":(c.includes("victoire")||d.includes("victoire"))&&(m="wins"),x({selectedSeriesType:m})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let m=10;const c=t.description.match(/min\.\s*(\d+)/);c&&(m=parseInt(c[1],10));let d="winRate",D="best";const F=t.title.toLowerCase(),P=t.description.toLowerCase();F.includes("participation")||P.includes("participation")?d="participation":(F.includes("taux de victoire")||P.includes("taux de victoire"))&&(d="winRate",(F.includes("moins bon")||F.includes("mauvais")||P.includes("moins bon")||P.includes("mauvais"))&&(D="worst")),x({playersGeneralState:{minGamesForWinRate:m,winRateOrder:D,focusChart:d}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const m=t.redirectTo.chartSection;let c="Villageois",d=1;m&&(m==="camp-loup"?c="Loup":m==="camp-villageois"?c="Villageois":m==="camp-idiot"?c="Idiot du Village":m==="camp-amoureux"?c="Amoureux":(m==="solo-roles"||m==="hall-of-fame")&&(c="Villageois"));const D=t.description.match(/min\.\s*(\d+)/);D&&(d=parseInt(D[1],10)),m==="solo-roles"?c="RÃ´les spÃ©ciaux":m==="hall-of-fame"&&(c="Tous les camps"),x({campPerformanceState:{selectedCampPerformanceCamp:c,selectedCampPerformanceMinGames:d,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const m=t.title.toLowerCase();let c="overview",d="behavior";m.includes("agressivitÃ©")?(c="overview",d="behavior"):m.includes("taux de vote")?(c="behavior",d="voteRate"):m.includes("prÃ©cision")&&(c="overview",d="accuracy"),x({votingStatsState:{selectedCategory:c,selectedView:d}})}if(t.category==="loot"&&t.redirectTo.subTab==="lootStats"){const m=t.redirectTo,c=m.minGames||5,d=m.view||"normalized";x({lootStatsState:{minGames:c,campFilter:"all",view:d}})}w(t.redirectTo.tab,t.redirectTo.subTab)},i=(t,R)=>{const S=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const m of S){const c=t.match(m);if(c&&c[1]){const d=c[1].trim();if(d!==R)return d}}return null},a=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const m=t.description.match(/min\.\s*(\d+)/),c=m?parseInt(m[1],10):10,d=t.title.toLowerCase(),D=C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return d.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${c} parties)${D}`:d.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${D}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${D}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const m=t.redirectTo.mapFilter,c=m==="village"?"Village":m==="chateau"?"ChÃ¢teau":"map",d=C==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${c}${d}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${i(t.description,y.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const m=t.description.match(/(Villageois|Loups|Autres)/i),c=t.description.match(/min\.\s*(\d+)/),d=c?parseInt(c[1],10):10,D=m?.[1]||"Tous les camps",F=t.redirectTo.chartSection;let P="kills et morts";return F==="killers-total"?P="total des kills":F==="killers-average"?P=`moyenne des kills (min. ${d} parties)`:F==="deaths-total"?P="total des morts":F==="survivors-average"&&(P=`taux de survie (min. ${d} parties)`),`Cliquez pour voir les statistiques de ${P} ${D!=="Tous les camps"?`en ${D}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const m=t.title.toLowerCase(),c=t.description.toLowerCase();return m.includes("dÃ©faite")||c.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":m.includes("loup")||c.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":m.includes("villageois")||c.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":m.includes("victoire")||c.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const m=t.redirectTo.chartSection,c=C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return m==="camp-loup"?`Cliquez pour voir les performances camp Loup${c}`:m==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${c}`:m==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${c}`:m==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${c}`:m==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${c}`:m==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${c}`:`Cliquez pour voir les performances par camp${c}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const m=t.description.match(/min\.\s*(\d+)/),c=m?parseInt(m[1],10):25,d=C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",D=t.title.toLowerCase();return D.includes("agressivitÃ©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${c} meetings)${d}`:D.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${c} meetings)${d}`:D.includes("prÃ©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${d}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${d}`}break;case"loot":if(t.redirectTo.subTab==="lootStats"){const m=t.description.match(/min\.\s*(\d+)/),c=m?parseInt(m[1],10):25,d=C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de rÃ©colte (min. ${c} parties)${d}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},n=t=>l[t]||$e(t),v=t=>{const R=[/avec ([^:]+?):/,/contre ([^:]+?):/];let S=t;return R.forEach(m=>{const c=t.match(m);if(c&&c[1]){const d=c[1].trim(),F=`<span class="player-name-highlight" style="color: ${n(d)};">${d}</span>`;S=S.replace(d,F)}}),S};if(r.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:u}),e.jsx("p",{children:b||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const o=t=>t===1?"ðŸ¥‡":t===2?"ðŸ¥ˆ":t===3?"ðŸ¥‰":"",g=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",A=(t,R)=>{if(!t||t<=3||!R)return;const S=t-3,m=R-3;return m<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(S-1)/(m-1))}, 70%, 50%)`},N=(t,R)=>{if(!t||!R)return;if(R<=1)return"hsl(0, 70%, 50%)";const S=(t-1)/(R-1),m=S*15,c=50-S*15;return`hsl(${m}, 70%, ${c}%)`},W=t=>{if(!t)return;const R=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(R){const[,S,m]=R;return`hsl(${S}, ${m}%, 40%)`}return t},I=r.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,R)=>(t.rank??999)-(R.rank??999)),z=r.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,R)=>(t.rank??999)-(R.rank??999)),$=r.filter(t=>t.category==="comparison"),O=[...I,...z].sort((t,R)=>(t.rank??999)-(R.rank??999)),j=I.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:u}),j>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:I.filter(t=>t.rank&&t.rank<=3).map((t,R)=>e.jsxs("div",{className:`top3-card ${g(t.rank)} animate-slide-in`,style:{animationDelay:`${R*.15}s`},onClick:S=>s(t,S),title:a(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:o(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:t.title}),e.jsx("p",{className:"top3-achievement-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},t.id))})]}),O.length>0&&e.jsxs("div",{className:"achievements-section unified-rankings",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:O.filter(t=>t.type==="bad"?!0:!t.rank||t.rank>3).map((t,R)=>{const S=t.type==="bad",m=S?N(t.rank,t.totalRanked):A(t.rank,t.totalRanked),c=W(m),d=S?"":g(t.rank);return e.jsxs("div",{className:`achievement-card ${S?"bad":"good"} ${d}`,onClick:D=>s(t,D),title:a(t),style:{animationDelay:`${R*.05}s`,borderLeftColor:c,borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsxs("span",{className:"achievement-title",children:[S&&"ðŸ’€ ",t.title]}),e.jsxs("span",{className:"achievement-rank",style:m?{backgroundColor:m}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:t.description})]},t.id)})})]}),$.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques CoÃ©quipiers et Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:$.map(t=>e.jsxs("div",{className:"achievement-card comparison",onClick:R=>s(t,R),title:a(t),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:t.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:v(t.description)}})]},t.id))})]})]})}function rt({selectedPlayerName:r,groupingMethod:u,campFilter:b="all"}){const{navigateToGameDetails:C}=ee(),{data:w,isLoading:x,error:k}=le(r),y=M.useMemo(()=>{switch(u){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[u]),p=M.useMemo(()=>{if(!w?.games)return new Map;const i=new Map;return w.games.forEach(a=>{if(!i.has(a.date)){const n=a.date.split("/");n.length===3?i.set(a.date,new Date(parseInt(n[2]),parseInt(n[1])-1,parseInt(n[0])).getTime()):i.set(a.date,new Date(a.date).getTime())}}),i},[w?.games]),f=M.useMemo(()=>{if(!w?.games)return[];const i={};return w.games.forEach(a=>{if(b!=="all"){if(b==="solo"){if(a.camp==="Villageois"||a.camp==="Loup")return}else if(a.camp!==b)return}let n;const v=a.date.split("/");if(u==="month")if(v.length===3)n=`${v[1].padStart(2,"0")}/${v[2]}`;else{const o=new Date(a.date);n=`${String(o.getMonth()+1).padStart(2,"0")}/${o.getFullYear()}`}else if(u==="quarter")if(v.length===3){const o=parseInt(v[1],10);n=`T${Math.floor((o-1)/3)+1}/${v[2]}`}else{const o=new Date(a.date);n=`T${Math.floor(o.getMonth()/3)+1}/${o.getFullYear()}`}else u==="year"?v.length===3?n=`${v[2]}`:n=`${new Date(a.date).getFullYear()}`:n=a.date;i[n]||(i[n]={games:[],wins:0,total:0}),i[n].games.push(a),i[n].total++,a.won&&i[n].wins++}),Object.entries(i).map(([a,n])=>({period:a,totalGames:n.total,victories:n.wins,defeats:n.total-n.wins,winRate:n.total>0?(n.wins/n.total*100).toFixed(1):"0.0",winRateNum:n.total>0?n.wins/n.total*100:0})).sort((a,n)=>{if(u==="month"){const[v,o]=a.period.split("/"),[g,A]=n.period.split("/"),N=new Date(parseInt(o),parseInt(v)-1,1),W=new Date(parseInt(A),parseInt(g)-1,1);return N.getTime()-W.getTime()}else if(u==="quarter"){const[v,o]=a.period.split("/"),[g,A]=n.period.split("/"),N=parseInt(v.replace(/\D/g,""),10)||1,W=parseInt(g.replace(/\D/g,""),10)||1,I=new Date(parseInt(o,10),(N-1)*3,1),z=new Date(parseInt(A,10),(W-1)*3,1);return I.getTime()-z.getTime()}else if(u==="year"){const v=parseInt(a.period,10),o=parseInt(n.period,10);return v-o}else{const v=p.get(a.period)||0,o=p.get(n.period)||0;return v-o}})},[w,u,p,b]),s=(i=>i<=15?{fontSize:12,angle:-45,height:80,interval:0}:i<=30?{fontSize:12,angle:-45,height:85,interval:1}:i<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(i/12)})(f.length);return x?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):k?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",k]}):w?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",y]}),e.jsx(B,{title:`Ã‰volution des Performances ${y}`,children:e.jsx("div",{style:{height:400},children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(Ie,{data:f,margin:{top:20,right:30,left:20,bottom:20},onClick:i=>{if(i&&i.activeLabel){const a=f.find(n=>n.period===i.activeLabel);a&&C({selectedPlayer:r,selectedDate:a.period,fromComponent:`Ã‰volution des Performances ${y}`})}},style:{cursor:"pointer"},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:"period",angle:s.angle,textAnchor:"end",height:s.height,interval:s.interval,fontSize:s.fontSize}),e.jsx(_,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(G,{content:({active:i,payload:a})=>{if(i&&a&&a.length>0){const n=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.period})}),e.jsxs("div",{children:["Parties: ",n.totalGames]}),e.jsxs("div",{children:["Victoires: ",n.victories]}),e.jsxs("div",{children:["Taux: ",n.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Le,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",y]}),e.jsx(B,{title:`RÃ©partition Victoires/DÃ©faites ${y}`,children:e.jsx("div",{style:{height:400},children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(Z,{data:f,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:"period",angle:s.angle,textAnchor:"end",height:s.height,interval:s.interval,fontSize:s.fontSize}),e.jsx(_,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(G,{content:({active:i,payload:a})=>{if(i&&a&&a.length>0){const n=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.period})}),e.jsxs("div",{children:["Total: ",n.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",n.victories]}),e.jsxs("div",{children:["DÃ©faites: ",n.defeats]}),e.jsxs("div",{children:["Taux: ",n.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(U,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:f.map((i,a)=>e.jsx(Y,{fill:"var(--accent-tertiary)",onClick:()=>{C({selectedPlayer:r,selectedDate:i.period,fromComponent:`Historique Joueur - Victoires ${y}`})},style:{cursor:"pointer"}},`cell-victories-${a}`))}),e.jsx(U,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:f.map((i,a)=>e.jsx(Y,{fill:"var(--chart-color-4)",onClick:()=>{C({selectedPlayer:r,selectedDate:i.period,fromComponent:`Historique Joueur - DÃ©faites ${y}`})},style:{cursor:"pointer"}},`cell-defeats-${a}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function at({selectedPlayerName:r}){const{navigateToGameDetails:u}=ee(),{data:b,isLoading:C,error:w}=le(r),x=se(),k=M.useMemo(()=>b?.campStats?Object.entries(b.campStats).map(([p,f])=>({name:p,value:f.appearances,winRate:f.winRate,winRateDisplay:Math.max(parseFloat(f.winRate),1),wins:f.wins,percentage:(f.appearances/b.totalGames*100).toFixed(1)})):[],[b]),y=M.useMemo(()=>{if(!k.length)return[];const p=5;let f=0;const l=[],s=[];if(k.forEach(i=>{parseFloat(i.percentage)<p?(f+=Number(i.value),l.push(i)):s.push(i)}),f>0){const i=k.reduce((a,n)=>a+Number(n.value),0);s.push({name:"Autres",value:f,winRate:"0.0",winRateDisplay:1,wins:l.reduce((a,n)=>a+n.wins,0),percentage:(f/i*100).toFixed(1),_details:l})}return s},[k]);return C?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):w?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",w]}):b?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(Re,{children:[e.jsx(ke,{data:y,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:p=>{const f=p.percent!==void 0?p.percent:0;return p.name==="Autres"?`Autres : ${p.value} (${(f*100).toFixed(1)}%)`:`${p.name}: ${p.value} (${(f*100).toFixed(1)}%)`},children:y.map((p,f)=>e.jsx(Y,{fill:p.name==="Autres"?Se:x[p.name]||`var(--chart-color-${f%6+1})`,onClick:()=>{if(p.name==="Autres"){const l=p._details?.map(s=>s.name)||[];u({selectedPlayer:r,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:l},fromComponent:"Distribution par Camps"})}else p.name==="TraÃ®tre"||p.name==="Louveteau"?u({selectedPlayer:r,campFilter:{selectedCamp:p.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):p.name==="Loup"?u({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):u({selectedPlayer:r,campFilter:{selectedCamp:p.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${f}`))}),e.jsx(G,{content:({active:p,payload:f})=>{if(p&&f&&f.length>0){const l=f[0].payload;if(l.name==="Autres"&&l._details){const s=[...l._details].sort((i,a)=>a.value-i.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",l.value," parties (",l.percentage,"%)"]})}),e.jsx("div",{children:s.map((i,a)=>e.jsxs("div",{children:[i.name,": ",i.value," parties (",i.percentage,"%)"]},a))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[l.name," - ",l.value," parties (",l.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(B,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(Z,{data:k,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(_,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(G,{content:({active:p,payload:f})=>{if(p&&f&&f.length>0){const l=f[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:l.name})}),e.jsxs("div",{children:["Victoires: ",l.wins," / ",l.value]}),e.jsxs("div",{children:["Taux: ",l.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(U,{dataKey:"winRateDisplay",children:k.map((p,f)=>e.jsx(Y,{fill:parseFloat(p.winRate)===0?`${x[p.name]||`var(--chart-color-${f%6+1})`}50`:x[p.name]||`var(--chart-color-${f%6+1})`,onClick:()=>{p.name==="TraÃ®tre"||p.name==="Louveteau"?u({selectedPlayer:r,campFilter:{selectedCamp:p.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):p.name==="Loup"?u({selectedPlayer:r,campFilter:{selectedCamp:p.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):u({selectedPlayer:r,campFilter:{selectedCamp:p.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${f}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function st({selectedPlayerName:r}){const{navigateToGameDetails:u,navigationState:b,updateNavigationState:C}=ee(),[w,x]=M.useState(b.playerHistoryMapState?.selectedCamp||"Tous les camps"),{data:k}=qe(),{data:y,isLoading:p,error:f}=le(r,w);M.useEffect(()=>{(!b.playerHistoryMapState||b.playerHistoryMapState.selectedCamp!==w)&&C({playerHistoryMapState:{selectedCamp:w}})},[w,b.playerHistoryMapState,C]);const l=i=>{x(i),C({playerHistoryMapState:{selectedCamp:i}})},s=M.useMemo(()=>{if(!y?.mapStats)return[];const i=et(y.mapStats);return Object.entries(i).map(([a,n])=>({name:a,value:n.appearances,winRate:n.winRate,winRateDisplay:Math.max(parseFloat(n.winRate),.1),wins:n.wins,percentage:(n.appearances/y.totalGames*100).toFixed(1)}))},[y]);return p?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):f?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",f]}):y?e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Performance par Carte",w!=="Tous les camps"?` (${w})`:""]}),e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select-map",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select-map",value:w,onChange:i=>l(i.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),k?.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),s.length===0?e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de carte disponible"}),e.jsx("p",{children:"Aucune statistique de carte n'est disponible pour ce joueur avec le camp sÃ©lectionnÃ©."})]}):e.jsx(B,{title:"Performance par Carte",children:e.jsx("div",{style:{height:400},children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(Z,{data:s,margin:{top:20,right:140,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(_,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(ge,{y:50,stroke:"var(--text-secondary)",strokeDasharray:"5 5",strokeOpacity:.5}),(()=>{if(s.length>0){const i=s.reduce((v,o)=>v+o.value,0),a=s.reduce((v,o)=>v+o.wins,0),n=i>0?a/i*100:0;if(n!==50)return e.jsx(ge,{y:n,stroke:"var(--accent-primary)",strokeDasharray:"3 3",strokeOpacity:.7,label:{value:`Moyenne: ${n.toFixed(1)}%`,position:"right",offset:5,style:{fill:"var(--accent-primary)"}}})}return null})(),e.jsx(G,{content:({active:i,payload:a})=>{if(i&&a&&a.length>0){const n=a[0].payload,v=[];return s.forEach(o=>{if(o.name!==n.name&&o.value>=5){const g=parseFloat(n.winRate)-parseFloat(o.winRate);Math.abs(g)>=2&&v.push({map:o.name,diff:g,better:g>0})}}),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:"250px"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.name})}),e.jsxs("div",{children:["Parties: ",n.value]}),e.jsxs("div",{children:["Victoires: ",n.wins]}),e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("strong",{children:["Taux: ",n.winRate,"%"]})}),v.length>0&&e.jsxs("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"0.8rem",fontWeight:"bold",marginBottom:"0.25rem"},children:"Comparaisons:"}),v.map((o,g)=>e.jsxs("div",{style:{fontSize:"0.75rem",color:o.better?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[o.better?"â†—":"â†˜"," ",Math.abs(o.diff).toFixed(1),"% vs ",o.map]},g))]}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(U,{dataKey:"winRateDisplay",label:i=>{const{x:a,y:n,width:v,payload:o}=i;if(a===void 0||n===void 0||v===void 0||!o)return null;const g=o.winRate||"0";return e.jsxs("text",{x:a+v/2,y:n-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[g,"%"]})},onClick:i=>{if(i&&i.name){const a={selectedPlayer:r,selectedMapName:i.name,fromComponent:"Performance par Carte"};w!=="Tous les camps"&&(a.campFilter={selectedCamp:w,campFilterMode:"all-assignments"}),u(a)}},children:s.map((i,a)=>{let n;i.name==="Village"?n="var(--accent-secondary)":i.name==="ChÃ¢teau"?n="var(--accent-tertiary)":i.name==="Autres"?n=Se:n=`var(--chart-color-${a%6+1})`;const v=Math.max(...s.map(g=>parseFloat(g.winRate))),o=parseFloat(i.winRate)===v&&v>0;return e.jsx(Y,{fill:parseFloat(i.winRate)===0?`${n}30`:n,stroke:"transparent",strokeWidth:o?3:1,style:{cursor:"pointer"}},`cell-map-${a}`)})})]})})})})]})}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function it({selectedPlayerName:r}){const{gameData:u}=be(),{joueursData:b}=oe(),C=me(b),w=se(),x=M.useMemo(()=>{if(!u||!r)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const y={},p={},f={},l=new Set;u.forEach(v=>{const o=v.PlayerStats.find(g=>g.Username.toLowerCase()===r.toLowerCase());if(o&&(v.PlayerStats.forEach(g=>{g.KillerName?.toLowerCase()===r.toLowerCase()&&(y[g.Username]=(y[g.Username]||0)+1)}),o.KillerName&&(p[o.KillerName]=(p[o.KillerName]||0)+1),o.DeathType)){const g=o.DeathType,A=ie(g);f[A]||(f[A]={count:0,byDeathType:{}}),f[A].count+=1,f[A].byDeathType[g]=(f[A].byDeathType[g]||0)+1,l.add(g)}});const s=Object.entries(y).map(([v,o])=>({player:v,kills:o})).sort((v,o)=>o.kills-v.kills).slice(0,10),i=Object.entries(p).map(([v,o])=>({player:v,kills:o})).sort((v,o)=>o.kills-v.kills).slice(0,10),a=Object.entries(f).map(([v,o])=>{const g={deathType:v,count:o.count};return g[v]=o.count,g}).sort((v,o)=>o.count-v.count).slice(0,10),n=Object.keys(f);return{playersKilled:s,killedBy:i,deathTypes:a,availableDeathTypes:n}},[u,r]),k=M.useMemo(()=>{const y={};x.availableDeathTypes.forEach(l=>{l==="TuÃ© par Loup"?y[l]=w.Loup:l==="Mort aux votes"?y[l]="var(--chart-color-1)":l.includes("Chasseur")?y[l]=w.Chasseur:l==="TuÃ© par Zombie"?y[l]=w.Vaudou:l==="TuÃ© par potion assassin"?y[l]=w.Alchimiste:l==="TuÃ© par Vengeur"?y[l]="var(--chart-color-2)":l==="Amoureux mort"?y[l]=w.Amoureux:l==="TuÃ© par La BÃªte"?y[l]="var(--chart-color-3)":l==="TuÃ© par ShÃ©rif"&&(y[l]="var(--chart-color-4)")});const p=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let f=0;return x.availableDeathTypes.forEach(l=>{y[l]||(y[l]=p[f%p.length],f++)}),y},[x.availableDeathTypes,w]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[x.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(B,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(Z,{data:x.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(_,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(G,{content:({active:y,payload:p})=>{if(y&&p&&p.length>0){const f=p[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:f.player})}),e.jsxs("div",{children:["TuÃ© ",f.kills," fois par ",r]})]})}return null}}),e.jsx(U,{dataKey:"kills",children:x.playersKilled.map((y,p)=>e.jsx(Y,{fill:C[y.player]||"var(--chart-color-3)"},`cell-killed-${p}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[r," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),x.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(B,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(Z,{data:x.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(_,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(G,{content:({active:y,payload:p})=>{if(y&&p&&p.length>0){const f=p[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:f.player})}),e.jsxs("div",{children:["A tuÃ© ",r," ",f.kills," fois"]})]})}return null}}),e.jsx(U,{dataKey:"kills",children:x.killedBy.map((y,p)=>e.jsx(Y,{fill:C[y.player]||"var(--chart-color-4)"},`cell-killer-${p}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[r," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),x.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(B,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(Z,{data:x.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(_,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(G,{content:({active:y,payload:p})=>{if(y&&p&&p.length>0){const f=p[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:f.deathType})}),e.jsxs("div",{children:[r," est mort ",f.count," fois ainsi"]})]})}return null}}),x.availableDeathTypes.map(y=>e.jsx(U,{dataKey:y,name:y,stackId:"deaths",fill:k[y]||"var(--chart-color-5)"},y))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",r,"."]})]})]})}function nt(r,u){if(!r||r.trim()===""||u.length===0)return null;const b=new Map,C=new Map,w=new Map;u.forEach(f=>{if(!f.Modded)return;const l=f.PlayerStats.find(s=>X(s)===r||s.Username.toLowerCase()===r.toLowerCase());if(l){if(l.MainRoleInitial==="Inconnu")return;const s=l.Victorious,a=Ce(l.MainRoleInitial,l.MainRoleChanges||[])!==l.MainRoleInitial,n=ne(l.MainRoleInitial),v=n==="Loup"||n==="TraÃ®tre"||n==="Louveteau";if(n==="Villageois"&&xe(l)){const o=fe(l);if(o&&Ee.includes(o)){const g=b.get(o)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};b.set(o,{appearances:g.appearances+1,wins:g.wins+(s?1:0),winsWithoutRoleChange:g.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:g.gamesWithoutRoleChange+(a?0:1)})}}else if(l.Power&&l.Power.trim()!==""&&l.Power!=="Inconnu"){if(n==="Villageois"){const o=b.get(l.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};b.set(l.Power,{appearances:o.appearances+1,wins:o.wins+(s?1:0),winsWithoutRoleChange:o.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:o.gamesWithoutRoleChange+(a?0:1)})}else if(v){const o=C.get(l.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},g=o.roleBreakdown;g.set(l.MainRoleInitial,(g.get(l.MainRoleInitial)||0)+1),C.set(l.Power,{appearances:o.appearances+1,wins:o.wins+(s?1:0),winsWithoutRoleChange:o.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:o.gamesWithoutRoleChange+(a?0:1),roleBreakdown:g})}}else if((n==="Villageois"||v)&&l.Power!=="Inconnu")if(n==="Villageois"){const o=b.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};b.set("Aucun pouvoir",{appearances:o.appearances+1,wins:o.wins+(s?1:0),winsWithoutRoleChange:o.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:o.gamesWithoutRoleChange+(a?0:1)})}else{const o=C.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},g=o.roleBreakdown;g.set(l.MainRoleInitial,(g.get(l.MainRoleInitial)||0)+1),C.set("Aucun pouvoir",{appearances:o.appearances+1,wins:o.wins+(s?1:0),winsWithoutRoleChange:o.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:o.gamesWithoutRoleChange+(a?0:1),roleBreakdown:g})}if(l.SecondaryRole&&l.SecondaryRole.trim()!==""&&l.SecondaryRole!=="Inconnu"){const o=w.get(l.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};w.set(l.SecondaryRole,{appearances:o.appearances+1,wins:o.wins+(s?1:0),winsWithoutRoleChange:o.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:o.gamesWithoutRoleChange+(a?0:1)})}}});const x=new Map;u.forEach(f=>{const l=f.PlayerStats.find(s=>X(s)===r||s.Username.toLowerCase()===r.toLowerCase());if(l&&xe(l)){const s=fe(l);s&&x.set(s,(x.get(s)||0)+1)}});const k=f=>Array.from(f.entries()).map(([l,s])=>({name:l,appearances:s.appearances,wins:s.wins,winsWithoutRoleChange:s.winsWithoutRoleChange,gamesWithoutRoleChange:s.gamesWithoutRoleChange,winRate:s.gamesWithoutRoleChange>0?(s.winsWithoutRoleChange/s.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...x.has(l)&&{totalGamesAllModes:x.get(l)}})).sort((l,s)=>s.appearances-l.appearances),y=f=>Array.from(f.entries()).map(([l,s])=>({name:l,appearances:s.appearances,wins:s.wins,winsWithoutRoleChange:s.winsWithoutRoleChange,gamesWithoutRoleChange:s.gamesWithoutRoleChange,winRate:s.gamesWithoutRoleChange>0?(s.winsWithoutRoleChange/s.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(s.roleBreakdown.entries()).map(([i,a])=>({role:i,count:a})).sort((i,a)=>a.count-i.count)})).sort((l,s)=>s.appearances-l.appearances),p=f=>Array.from(f.entries()).map(([l,s])=>({name:l,appearances:s.appearances,wins:s.wins,winsWithoutRoleChange:s.winsWithoutRoleChange,gamesWithoutRoleChange:s.gamesWithoutRoleChange,winRate:s.gamesWithoutRoleChange>0?(s.winsWithoutRoleChange/s.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((l,s)=>s.appearances-l.appearances);return{villageoisPowers:k(b),loupPowers:y(C),secondaryRoles:p(w)}}function ot({selectedPlayerName:r}){const{navigateToGameDetails:u,navigationState:b,updateNavigationState:C}=ee(),w=se(),[x,k]=M.useState(b.playerHistoryRolesState?.chartMode||"appearances"),{data:y,isLoading:p,error:f}=pe(g=>nt(r,g));M.useEffect(()=>{(!b.playerHistoryRolesState||b.playerHistoryRolesState.chartMode!==x)&&C({playerHistoryRolesState:{chartMode:x}})},[x,b.playerHistoryRolesState,C]);const l=g=>{k(g),C({playerHistoryRolesState:{chartMode:g}})},s=M.useMemo(()=>{if(!y)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const g=1,A=1,N=15,W=x==="winRate"?(z,$)=>parseFloat($.winRate)-parseFloat(z.winRate):(z,$)=>$.appearances-z.appearances,I=z=>({...z,winRateDisplay:Math.max(parseFloat(z.winRate),1)});return{villageoisPowers:y.villageoisPowers.filter(z=>z.appearances>=g).map(I).sort(W).slice(0,N),loupPowers:y.loupPowers.filter(z=>z.appearances>=g).map(I).sort(W).slice(0,N),secondaryRoles:y.secondaryRoles.filter(z=>z.appearances>=A).map(I).sort(W).slice(0,N)}},[y,x]);if(p)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(f)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",f]});if(!y)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const i=s.villageoisPowers.length>0,a=s.loupPowers.length>0,n=s.secondaryRoles.length>0;if(!i&&!a&&!n)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const v=({active:g,payload:A})=>{if(g&&A&&A.length>0){const N=A[0].payload,W=N.gamesWithoutRoleChange<N.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:N.name})}),e.jsxs("div",{children:["Apparitions: ",N.appearances]}),W&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",N.appearances-N.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",N.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",N.winRate,"%"]})}),N.totalGamesAllModes&&N.totalGamesAllModes!==N.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",N.totalGamesAllModes,")"]}),N.roleBreakdown&&N.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),N.roleBreakdown.map((I,z)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",I.role,": ",I.count]},z))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},o=(g,A,N,W,I)=>{const z=x==="appearances"?"appearances":"winRateDisplay",$=x==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",O=x==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:A}),e.jsx(B,{title:A,children:e.jsx("div",{style:{height:400},children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(Z,{data:g,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(_,{label:{value:$,angle:270,position:"left",style:{textAnchor:"middle"}},domain:O}),e.jsx(G,{content:e.jsx(v,{})}),e.jsx(U,{dataKey:z,label:x==="winRate"?j=>{const{x:t,y:R,width:S,payload:m}=j;if(t===void 0||R===void 0||S===void 0||!m)return null;const c=m.winRate||"0";return e.jsxs("text",{x:t+S/2,y:R-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[c,"%"]})}:void 0,children:g.map((j,t)=>e.jsx(Y,{fill:I?I(j.name,t):N,onClick:()=>W(j.name),style:{cursor:"pointer"}},`cell-${t}`))})]})})})})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:x,onChange:g=>l(g.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[i&&o(s.villageoisPowers,"Camp Villageois","var(--chart-color-1)",g=>{u({selectedPlayer:r,campFilter:{selectedCamp:"Villageois",campFilterMode:x==="winRate"?"wins-only":"all-assignments"},selectedPower:g,fromComponent:`Historique des RÃ´les - Pouvoir: ${g}`})},g=>g==="Chasseur"&&w.Chasseur?w.Chasseur:g==="Alchimiste"&&w.Alchimiste?w.Alchimiste:g==="Protecteur"&&w.Protecteur?w.Protecteur:g==="Disciple"&&w.Disciple?w.Disciple:"var(--chart-color-1)"),a&&o(s.loupPowers,"Camp Loups","var(--chart-color-2)",g=>{u({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:x==="winRate"?"wins-only":"all-assignments"},selectedPower:g,fromComponent:`Historique des RÃ´les - Pouvoir: ${g}`})},()=>w.Loup||"var(--chart-color-2)"),n&&o(s.secondaryRoles,"RÃ´les Secondaires","var(--chart-color-3)",g=>{u({selectedPlayer:r,selectedSecondaryRole:g,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${g}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}function ve(r,u){return u>=-250&&u<=100&&r>=-450&&r<=-120?"Village Principal":u>=-550&&u<=-250&&r>=-150&&r<=150?"Ferme":u>=150&&u<=500&&r>=-320&&r<=80?"Village PÃªcheur":u>=-280&&u<=200&&r>=100&&r<=450?"Ruines":null}function je(r){return r==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":r}function lt({selectedPlayerName:r}){const{navigateToGameDetails:u}=ee(),{gameData:b,isLoading:C,error:w}=be(),x=se(),[k,y]=M.useState("deaths"),[p,f]=M.useState(""),[l,s]=M.useState(0),[i,a]=M.useState(null),n=M.useMemo(()=>{if(!b)return[];const j=new Set;return b.forEach(t=>{const R=t.PlayerStats.find(S=>S.Username.toLowerCase()===r.toLowerCase());R&&(R.DeathPosition!==null&&t.MapName&&j.add(t.MapName),t.PlayerStats.forEach(S=>{S.KillerName?.toLowerCase()===r.toLowerCase()&&S.DeathPosition!==null&&t.MapName&&j.add(t.MapName)}))}),Array.from(j).filter(t=>t==="Village"||t==="ChÃ¢teau").sort((t,R)=>t==="Village"?-1:R==="Village"?1:t.localeCompare(R))},[b,r]),v=n.length>0?n[0]:"";p===""&&v!==""&&f(v);const o=M.useMemo(()=>{if(!b||!r)return[];const j=[];return b.forEach(t=>{if(p&&t.MapName!==p)return;const R=t.PlayerStats.find(S=>S.Username.toLowerCase()===r.toLowerCase());if(R)if(k==="deaths"){if(R.DeathPosition){const S=ne(R.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),m=ce(R.DeathPosition.x,R.DeathPosition.z,t.MapName);j.push({x:m.x,z:m.z,victimName:R.Username,killerName:R.KillerName||null,deathType:je(R.DeathType),mapName:t.MapName,camp:S,gameId:t.DisplayedId,displayedGameId:t.DisplayedId})}}else t.PlayerStats.forEach(S=>{if(S.KillerName?.toLowerCase()===r.toLowerCase()&&S.DeathPosition){const m=ne(S.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),c=ce(S.DeathPosition.x,S.DeathPosition.z,t.MapName);j.push({x:c.x,z:c.z,victimName:S.Username,killerName:r,deathType:je(S.DeathType),mapName:t.MapName,camp:m,gameId:t.DisplayedId,displayedGameId:t.DisplayedId})}})}),j},[b,r,k,p]),g=M.useMemo(()=>{if(p!=="Village"||k!=="deaths")return null;const j=o.filter(P=>P.deathType!=="VOTED");if(j.length===0)return null;const t={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,other:0};if(j.forEach(P=>{const L=ve(P.x,P.z);L?t[L]=(t[L]||0)+1:t.other+=1}),!b)return null;const R={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,other:0};b.forEach(P=>{P.MapName==="Village"&&P.PlayerStats.forEach(L=>{if(!L.DeathPosition||L.DeathType==="VOTED")return;const h=ce(L.DeathPosition.x,L.DeathPosition.z,"Village"),T=ve(h.x,h.z);T?R[T]=(R[T]||0)+1:R.other+=1})});const S=Object.values(R).reduce((P,L)=>P+L,0),m=Object.values(t).reduce((P,L)=>P+L,0);if(S===0||m===0)return null;const c=["Village Principal","Village PÃªcheur","Ferme","Ruines"];let d=0,D=null;const F=c.map(P=>{const L=t[P]/m*100,h=R[P]/S*100,T=L-h;return T>d&&t[P]>=2&&(d=T,D=P),{zone:P,playerCount:t[P],playerPercent:L,avgPercent:h,deviation:T}});return{totalPlayerDeaths:m,totalAllDeaths:S,zoneStats:F,dominantZone:D,maxDeviation:d}},[o,p,k,b]),A=M.useMemo(()=>Ge(o,l).map((t,R)=>{const S=t.items[0],m=Be(t.items);return{x:t.centroidX,z:t.centroidZ,count:t.items.length,allLocations:t.items,victimName:t.items.length===1?S.victimName:null,killerName:t.items.length===1?S.killerName:null,deathType:m,mapName:S.mapName,camp:S.camp,gameId:t.items.length===1?S.gameId:null,displayedGameId:t.items.length===1?S.displayedGameId:null,clusterIndex:R}}),[o,l]),N=M.useMemo(()=>Oe(p),[p]),{xDomain:W,zDomain:I}=M.useMemo(()=>{if(N)return{xDomain:[N.xMin,N.xMax],zDomain:[N.zMin,N.zMax]};if(A.length===0)return{xDomain:[0,100],zDomain:[0,100]};const j=A.map(F=>F.x),t=A.map(F=>F.z),R=Math.min(...j),S=Math.max(...j),m=Math.min(...t),c=Math.max(...t),d=(S-R)*.1||10,D=(c-m)*.1||10;return{xDomain:[R-d,S+d],zDomain:[m-D,c+D]}},[A,N]),z=j=>j?j==="BY_WOLF"||j==="SURVIVALIST_NOT_SAVED"?x.Loup:j==="VOTED"?"var(--chart-color-1)":j==="BULLET"||j==="BULLET_HUMAN"||j==="BULLET_WOLF"?x.Chasseur:j==="BY_ZOMBIE"?x.Vaudou:j==="ASSASSIN"?x.Alchimiste:j==="AVENGER"?"var(--chart-color-2)":j==="LOVER_DEATH"?x.Amoureux:j==="BY_BEAST"?"var(--chart-color-3)":j==="SHERIF_SUCCESS"?"var(--chart-color-4)":j==="SMUGGLER_HUNT_KILL"?x.Contrebandier:"var(--accent-primary-text)":"var(--text-secondary)",$=({active:j,payload:t})=>{if(!j||!t||t.length===0)return null;const R=t[0].payload,S=R.allLocations||[R];if(S.length>1){const d=new Map,D=new Map,F=new Set;S.forEach(h=>{d.set(h.victimName,(d.get(h.victimName)||0)+1);const T=h.deathType?ie(h.deathType):"Inconnu";D.set(T,(D.get(T)||0)+1),F.add(h.gameId)});const P=Array.from(d.entries()).sort((h,T)=>T[1]-h[1]).slice(0,3),L=Array.from(D.entries()).sort((h,T)=>T[1]-h[1]).slice(0,3);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[k==="deaths"?"ðŸ’€":"âš”ï¸"," ",S.length," ",k==="deaths"?"morts":"kills"," Ã  cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:k==="deaths"?"Par:":"Victimes:"}),P.map(([h,T])=>e.jsxs("div",{style:{paddingLeft:"0.5rem"},children:["â€¢ ",h," (",T,"x)"]},h)),d.size>3&&e.jsxs("div",{style:{paddingLeft:"0.5rem",color:"var(--text-secondary)"},children:["+",d.size-3," autres..."]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Types de mort:"}),L.map(([h,T])=>e.jsxs("div",{style:{paddingLeft:"0.5rem"},children:["â€¢ ",h," (",T,"x)"]},h))]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["ðŸ“ ",F.size," partie",F.size>1?"s":""," diffÃ©rente",F.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const c=S[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[k==="deaths"?"ðŸ’€":"âš”ï¸"," ",k==="deaths"?"Mort de":"Kill de"," ",r]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[k==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"TuÃ© par:"})," ",c.killerName||"Inconnu"]}),e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Cause:"})," ",c.deathType?ie(c.deathType):"Inconnue"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Victime:"})," ",c.victimName]}),e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Cause:"})," ",c.deathType?ie(c.deathType):"Inconnue"]}),e.jsxs("div",{children:["ðŸ‘¥ ",e.jsx("strong",{children:"Camp victime:"})," ",c.camp]})]}),e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",c.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",c.gameId]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})},O=j=>{if(!j)return;const t=j.allLocations||[j];if(t.length===1)u({selectedGame:t[0].gameId,fromComponent:"Player Death Map"});else{const R=t.map(S=>S.gameId).filter(S=>S);u({selectedGameIds:R,fromComponent:"Player Death Map"})}};return C?e.jsx("div",{className:"donnees-attente",children:"Chargement des donnÃ©es..."}):w?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",w]}):b?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>y("deaths"),style:{background:k==="deaths"?"var(--accent-primary)":"transparent",color:k==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:k==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"ðŸ’€ Morts"}),e.jsx("button",{type:"button",onClick:()=>y("kills"),style:{background:k==="kills"?"var(--accent-primary)":"transparent",color:k==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:k==="kills"?"bold":"normal",transition:"all 0.2s"},children:"âš”ï¸ Kills"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:p,onChange:j=>f(j.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:n.map(j=>e.jsx("option",{value:j,children:j},j))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:l,onChange:j=>s(parseInt(j.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:l===0?"Aucun":`${l} unitÃ©${l>1?"s":""}`})]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{flex:"1 1 100%",marginBottom:"1.5rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:k==="deaths"?"Morts localisÃ©es":"Kills localisÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:k==="deaths"?"var(--accent-secondary)":"var(--accent-primary-text)"},children:o.length}),l>0&&A.length<o.length&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"4px"},children:["â†’ ",A.length," points groupÃ©s"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Carte"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-2)",fontSize:"1.2rem"},children:p||"Aucune"})]})]}),e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:o.length>0?e.jsx(B,{title:k==="deaths"?`Carte des Morts de ${r}`:`Carte des Kills de ${r}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(Ke,{margin:{top:20,right:30,left:60,bottom:60},children:[N&&e.jsx(ae,{x1:N.zMin,x2:N.zMax,y1:N.xMin,y2:N.xMax,fill:"transparent",stroke:"none",shape:j=>{const{x:t,y:R,width:S,height:m}=j;return e.jsx("image",{x:t,y:R,width:S,height:m,href:N.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),p==="Village"&&i&&e.jsxs(e.Fragment,{children:[i==="Ruines"&&e.jsx(ae,{x1:-280,x2:200,y1:100,y2:450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Village Principal"&&e.jsx(ae,{x1:-250,x2:100,y1:-120,y2:-450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Ferme"&&e.jsx(ae,{x1:-550,x2:-250,y1:150,y2:-150,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Village PÃªcheur"&&e.jsx(ae,{x1:150,x2:500,y1:80,y2:-320,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"})]}),e.jsx(K,{strokeDasharray:"3 3",stroke:N?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(H,{dataKey:"z",type:"number",name:"Position Z",domain:I,hide:!0}),e.jsx(_,{dataKey:"x",type:"number",name:"Position X",domain:W,hide:!0}),e.jsx(G,{content:e.jsx($,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(He,{data:A,onClick:j=>O(j),style:{cursor:"pointer"},isAnimationActive:!1,children:A.map((j,t)=>{const R=Math.min(Math.log2(j.count+1)*3+5,18),S=Math.round(R);return e.jsx(Y,{fill:z(j.deathType),stroke:j.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:j.count>1?2:1,opacity:.85,r:S},`cell-${t}`)})})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:k==="deaths"?`Aucune mort localisÃ©e pour ${r} sur cette carte.`:`Aucun kill localisÃ© pour ${r} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes."})]})}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"Ã€ propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",k==="deaths"?`les emplacements oÃ¹ ${r} est mort`:`les emplacements oÃ¹ ${r} a Ã©liminÃ© d'autres joueurs`," au cours des parties. Les couleurs indiquent le type de mort. Cliquez sur un point pour voir les dÃ©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroupÃ©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’€ Morts:"})," OÃ¹ le joueur a Ã©tÃ© Ã©liminÃ©",e.jsx("br",{}),e.jsx("strong",{children:"âš”ï¸ Kills:"})," OÃ¹ le joueur a Ã©liminÃ© d'autres joueurs"]}),g&&p==="Village"&&k==="deaths"&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px",border:"1px solid var(--border-color)"},children:[e.jsx("h4",{style:{marginBottom:"0.75rem",color:"var(--accent-primary)"},children:"ðŸ“Š Analyse par zone (Village)"}),e.jsx("p",{style:{fontSize:"0.9rem",marginBottom:"0.75rem",color:"var(--text-secondary)"},children:"Distribution des morts (hors votes) comparÃ©e Ã  la moyenne de tous les joueurs:"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"0.75rem"},children:g.zoneStats.map(j=>e.jsxs("div",{style:{padding:"0.75rem",backgroundColor:j.zone===g.dominantZone&&g.maxDeviation>10?"var(--accent-primary-bg)":"var(--bg-tertiary)",borderRadius:"6px",border:i===j.zone||j.zone===g.dominantZone&&g.maxDeviation>10?"2px solid var(--accent-primary)":"1px solid var(--border-color)",cursor:"pointer",transition:"all 0.2s",transform:i===j.zone?"scale(1.02)":"scale(1)",boxShadow:i===j.zone?"0 4px 12px rgba(0,0,0,0.2)":"none"},onMouseEnter:()=>a(j.zone),onMouseLeave:()=>a(null),children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.25rem",color:"var(--text-primary)"},children:j.zone}),e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:[j.playerCount," mort",j.playerCount>1?"s":""," (",j.playerPercent.toFixed(1),"%)"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["Moyenne: ",j.avgPercent.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.85rem",fontWeight:"bold",color:j.deviation>5?"var(--accent-primary)":j.deviation<-5?"var(--chart-color-2)":"var(--text-secondary)",marginTop:"0.25rem"},children:[j.deviation>0?"+":"",j.deviation.toFixed(1),"%"]})]},j.zone))}),g.dominantZone&&g.maxDeviation>10&&e.jsxs("div",{style:{marginTop:"0.75rem",fontSize:"0.9rem",color:"var(--accent-primary)",fontWeight:"bold"},children:["âš ï¸ ",r," meurt significativement plus souvent en zone ",e.jsx("strong",{children:g.dominantZone})," (+",g.maxDeviation.toFixed(1),"% par rapport Ã  la moyenne)"]})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function Pe(r){return r.PlayerStats.some(u=>u.SecondsTalkedOutsideMeeting>0||u.SecondsTalkedDuringMeeting>0)}function de(r,u){const b=u.DeathDateIrl||r.EndDate,C=we(r.StartDate,b);return C&&C>0?C:0}function ct(r){const u=r.filter(Pe),b=new Map;return u.forEach(C=>{C.PlayerStats.forEach(w=>{const x=X(w),k=Ae(w),y=de(C,w);if(y<=0)return;b.has(x)||b.set(x,{displayName:k,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const p=b.get(x);p.gamesPlayed++,p.totalSecondsAll+=(w.SecondsTalkedOutsideMeeting||0)+(w.SecondsTalkedDuringMeeting||0),p.totalGameDuration+=y})}),{playerStats:b,gamesWithTalkingData:u.length}}function dt(r,u){if(!u||u.length===0||!r)return null;const b=ct(u),C=u.filter(Pe);if(C.length===0||b.playerStats.size===0)return null;let w=null;for(const[c,d]of b.playerStats)if(d.displayName===r){w=c;break}if(!w)return null;let x=0,k=0,y=0,p=0;const f={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},l=new Map;let s=0,i=0,a=0,n=0;if(C.forEach(c=>{const d=c.PlayerStats.find(q=>X(q)===w);if(!d)return;const D=de(c,d);if(D<=0)return;x++;const F=d.SecondsTalkedOutsideMeeting||0,P=d.SecondsTalkedDuringMeeting||0,L=F+P;k+=F,y+=P,p+=D;const h=ze(d.MainRoleInitial,d.Power);f[h].gamesPlayed++,f[h].secondsOutside+=F,f[h].secondsDuring+=P,f[h].gameDuration+=D;const T=Ve(d);l.has(T)||l.set(T,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const E=l.get(T);E.gamesPlayed++,E.totalSecondsAll+=L,E.totalGameDuration+=D}),x===0||p<=0)return null;const v=3600/p,o=k*v,g=y*v,A=(k+y)*v,N=k+y>0?y/(k+y)*100:0,W=[];for(const[c,d]of Object.entries(f)){if(d.gamesPlayed===0)continue;const D=d.gameDuration>0?3600/d.gameDuration:0,F=d.secondsOutside+d.secondsDuring;W.push({camp:c,gamesPlayed:d.gamesPlayed,totalSecondsOutside:d.secondsOutside,totalSecondsDuring:d.secondsDuring,totalSecondsAll:F,totalGameDurationSeconds:d.gameDuration,secondsOutsidePer60Min:d.secondsOutside*D,secondsDuringPer60Min:d.secondsDuring*D,secondsAllPer60Min:F*D,meetingRatio:F>0?d.secondsDuring/F*100:0})}W.sort((c,d)=>d.gamesPlayed-c.gamesPlayed);const I=Array.from(l.entries()).filter(([c,d])=>d.gamesPlayed>=1).map(([c,d])=>({role:c,gamesPlayed:d.gamesPlayed,secondsAllPer60Min:d.totalGameDuration>0?d.totalSecondsAll/d.totalGameDuration*3600:0,totalSecondsAll:d.totalSecondsAll})).sort((c,d)=>d.secondsAllPer60Min-c.secondsAllPer60Min),z=[];for(const[c,d]of b.playerStats)d.totalGameDuration>0&&z.push({id:c,name:d.displayName,per60:d.totalSecondsAll/d.totalGameDuration*3600});z.sort((c,d)=>d.per60-c.per60);const $=z.reduce((c,d)=>c+d.per60,0),O=z.length>0?$/z.length:0,j=z.findIndex(c=>c.id===w)+1,t=z.length,R=t>0?Math.round((1-(j-1)/t)*100):0,S=A;C.forEach(c=>{const d=c.PlayerStats.find(L=>X(L)===w);if(!d)return;const D=de(c,d);if(D<=0)return;((d.SecondsTalkedOutsideMeeting||0)+(d.SecondsTalkedDuringMeeting||0))/D*3600>=S?(s++,d.Victorious&&i++):(a++,d.Victorious&&n++)});const m={gamesAboveAverage:s,winsAboveAverage:i,winRateAboveAverage:s>0?i/s*100:0,gamesBelowAverage:a,winsBelowAverage:n,winRateBelowAverage:a>0?n/a*100:0};return{playerName:r,gamesPlayed:x,gamesWithTalkingData:b.gamesWithTalkingData,totalSecondsOutside:k,totalSecondsDuring:y,totalSecondsAll:k+y,totalGameDurationSeconds:p,secondsOutsidePer60Min:o,secondsDuringPer60Min:g,secondsAllPer60Min:A,meetingRatio:N,campBreakdown:W,globalAverageSecondsAllPer60Min:O,playerRank:j,totalPlayersWithData:t,percentile:R,roleBreakdown:I,winCorrelation:m}}function ut(r,u){return r?r.roleBreakdown.slice(0,u):[]}function pt(r){const{data:u,isLoading:b,error:C}=pe(w=>r?dt(r,w):null);return{data:u,isLoading:b,error:C}}function mt({selectedPlayerName:r}){const{data:u,isLoading:b,error:C}=pt(r),w=se(),[x,k]=M.useState("both"),y=M.useMemo(()=>u?.campBreakdown?u.campBreakdown.map(a=>({camp:a.camp,"Hors rÃ©union":Math.round(a.secondsOutsidePer60Min),"En rÃ©union":Math.round(a.secondsDuringPer60Min),total:Math.round(a.secondsAllPer60Min),gamesPlayed:a.gamesPlayed,meetingRatio:a.meetingRatio.toFixed(1)})):[],[u]),p=M.useMemo(()=>u?[{name:"En rÃ©union",value:u.totalSecondsDuring,color:"#2196F3"},{name:"Hors rÃ©union",value:u.totalSecondsOutside,color:"#FF9800"}]:[],[u]);if(b)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(C)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",C]});if(!u)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de temps de parole ne sont disponibles que pour les parties rÃ©centes."})]});const f=u.secondsAllPer60Min-u.globalAverageSecondsAllPer60Min,l=u.globalAverageSecondsAllPer60Min>0?(f/u.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",s=f>0,i=u.winCorrelation.winRateAboveAverage-u.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¤ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:re(u.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:s?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[s?"+":"",l,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",u.playerRank," / ",u.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-u.percentile+1,"% ",u.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“ˆ Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:u.gamesPlayed}),e.jsxs("p",{children:["sur ",u.gamesWithTalkingData," avec donnÃ©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ—£ï¸ Ratio en rÃ©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[u.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),y.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(B,{title:"Temps de parole par camp (par 60min de jeu)",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>k("meeting"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:x==="meeting"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:x==="meeting"?"var(--accent-primary)":"var(--bg-secondary)",color:x==="meeting"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:x==="meeting"?"bold":"normal"},children:"En rÃ©union"}),e.jsx("button",{onClick:()=>k("outside"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:x==="outside"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:x==="outside"?"var(--accent-primary)":"var(--bg-secondary)",color:x==="outside"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:x==="outside"?"bold":"normal"},children:"Hors rÃ©union"}),e.jsx("button",{onClick:()=>k("both"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:x==="both"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:x==="both"?"var(--accent-primary)":"var(--bg-secondary)",color:x==="both"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:x==="both"?"bold":"normal"},children:"Les deux"})]}),e.jsx("div",{style:{height:350},children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(Z,{data:y,layout:"vertical",children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(H,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:a=>`${Math.floor(a/60)}m`}),e.jsx(_,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(G,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(a,n)=>[re(a),n],labelFormatter:a=>{const n=y.find(v=>v.camp===a);return`${a} (${n?.gamesPlayed||0} parties)`}}),e.jsx(_e,{}),(x==="both"||x==="outside")&&e.jsx(U,{dataKey:"Hors rÃ©union",stackId:"talk",fill:"#FF9800"}),(x==="both"||x==="meeting")&&e.jsx(U,{dataKey:"En rÃ©union",stackId:"talk",fill:"#2196F3"})]})})})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:(()=>{const a=y.find(g=>g.camp==="Villageois"),n=y.find(g=>g.camp==="Loup");if(!a||!n)return e.jsx("p",{children:"ðŸ’¡ Pas assez de donnÃ©es pour comparer les camps Villageois et Loups."});const v=a.total-n.total,o=n.total>0?(Math.abs(v)/n.total*100).toFixed(0):"0";return v>0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:he("Villageois")},children:[re(v)," de plus (+",o,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Villageois"})," qu'en tant que"," ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]}):v<0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:he("Loup")},children:[re(Math.abs(v))," de plus (+",o,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Loup"})," qu'en tant que"," ",e.jsx("strong",{children:"Villageois"})," (par heure de jeu)."]}):e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle exactement autant en tant que"," ",e.jsx("strong",{children:"Villageois"})," qu'en tant que ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(B,{title:"RÃ©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(Re,{children:[e.jsx(ke,{data:p,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:a=>`${a.name}: ${((a.percent||0)*100).toFixed(1)}%`,children:p.map((a,n)=>e.jsx(Y,{fill:a.color},`cell-${n}`))}),e.jsx(G,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:a=>re(a)})]})})})})}),u&&u.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(B,{title:a=>a?"Top 15 rÃ´les les plus bavards (par 60min)":"Top 5 rÃ´les les plus bavards (par 60min)",children:a=>{const v=ut(u,a?15:5).map(o=>({role:o.role,secondsPer60Min:Math.round(o.secondsAllPer60Min),gamesPlayed:o.gamesPlayed}));return e.jsx("div",{style:{height:a?400:300},children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(Z,{data:v,children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(H,{dataKey:"role",tick:{fill:"var(--text-primary)",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(_,{tick:{fill:"var(--text-secondary)"},tickFormatter:o=>`${Math.floor(o/60)}m`}),e.jsx(G,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:o=>[re(o),"Temps de parole"],labelFormatter:o=>{const g=v.find(A=>A.role===o);return`${o} (${g?.gamesPlayed||0} parties)`}}),e.jsx(U,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",children:v.map((o,g)=>e.jsx(Y,{fill:w[o.role]||w.Villageois},`cell-${g}`))})]})})})}})}),(u.winCorrelation.gamesAboveAverage>0||u.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"ðŸŽ¯ CorrÃ©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[u.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",u.winCorrelation.winsAboveAverage,"/",u.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[u.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",u.winCorrelation.winsBelowAverage,"/",u.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(i)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:i>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[i>0?"supÃ©rieur":"infÃ©rieur"," de ",Math.abs(i).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function It(){const{settings:r,updateSettings:u}=ue(),{navigateToGameDetails:b,navigationState:C,updateNavigationState:w}=ee(),{data:x,isLoading:k,error:y}=Me(),{joueursData:p,isLoading:f}=oe(),{data:l,isLoading:s,error:i}=Qe(r.highlightedPlayer),a=me(p),[n,v]=M.useState(""),[o,g]=M.useState(null),{clips:A}=Ue(r.highlightedPlayer),{clips:N}=Ye(),[W,I]=M.useState(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded"?"modded":"all":r.gameFilter==="modded"?"modded":"all"),z=M.useMemo(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded":r.gameFilter==="modded",[r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter,r.gameFilter]),[$,O]=M.useState(C.selectedPlayerSelectionView||"achievements"),[j,t]=M.useState("session"),[R,S]=M.useState("all");M.useEffect(()=>{if(r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled){const h=r.independentFilters.gameFilter==="modded"?"modded":"all";I(h)}else if(!r.useIndependentFilters){const h=r.gameFilter==="modded"?"modded":"all";I(h)}},[r.gameFilter,r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter]),M.useEffect(()=>{z&&W!=="modded"&&I("modded")},[z,W]),M.useEffect(()=>{C.selectedPlayerSelectionView&&O(C.selectedPlayerSelectionView)},[C.selectedPlayerSelectionView]);const{data:m}=le(r.highlightedPlayer||""),c=M.useMemo(()=>{if(!x||!x.GameStats)return[];const h=z?x.GameStats.filter(E=>E.Modded===!0):x.GameStats,T=new Map;return h.forEach(E=>{const q=new Date(E.StartDate);E.PlayerStats.forEach(J=>{const Q=X(J),De=p?.Players?.find(Ne=>Ne.SteamID===Q)?.Joueur||J.Username;T.has(Q)||T.set(Q,{games:0,wins:0,firstDate:q,lastDate:q,displayName:De});const te=T.get(Q);te.games++,J.Victorious&&te.wins++,q<te.firstDate&&(te.firstDate=q),q>te.lastDate&&(te.lastDate=q)})}),Array.from(T.entries()).map(([E,q])=>{let J=p?.Players?.find(Q=>Q.SteamID===E);return J||(J=p?.Players?.find(Q=>Q.Joueur===q.displayName)),{id:E,name:q.displayName,totalGames:q.games,totalWins:q.wins,winRate:q.games>0?q.wins/q.games*100:0,firstGameDate:q.firstDate.toLocaleDateString("fr-FR"),lastGameDate:q.lastDate.toLocaleDateString("fr-FR"),isHighlighted:q.displayName===r.highlightedPlayer,image:J?.Image||null,twitch:J?.Twitch||null,youtube:J?.Youtube||null}})},[x,r.highlightedPlayer,p,z]),d=M.useMemo(()=>{if(!n.trim())return c;const h=n.toLowerCase();return c.filter(T=>T.name.toLowerCase().includes(h))},[c,n]),D=M.useMemo(()=>[...d].sort((h,T)=>T.totalGames-h.totalGames),[d]),F=h=>{u({highlightedPlayer:h}),v("")},P=h=>{O(h),w({selectedPlayerSelectionView:h})},L=()=>{if(A.length===0)return;const h=Math.floor(Math.random()*A.length);g(A[h])};return k||f?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):y?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",y]})]}):!x||c.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!r.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:n,onChange:h=>v(h.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[d.length," joueur",d.length!==1?"s":"",n&&` (filtrÃ©${d.length!==1?"s":""} de ${c.length})`]})]})]}),e.jsx("div",{className:"player-display",children:n?d.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>v(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:D.map(h=>e.jsxs("button",{type:"button",className:`suggestion-btn ${h.isHighlighted?"highlighted":""}`,onClick:()=>F(h.name),children:[h.image?e.jsx("img",{src:h.image,alt:`Photo de profil de ${h.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":a[h.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[h.name,h.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[h.totalGames," parties â€¢ ",h.winRate.toFixed(1),"% victoires"]})]})]},h.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',n,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>v(""),children:"Effacer la recherche"})]}):r.highlightedPlayer?(()=>{const h=c.find(T=>T.name===r.highlightedPlayer);return h?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:h.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[h.image?e.jsx("img",{src:h.image,alt:`Photo de profil de ${h.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":a[h.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[h.totalGames," parties â€¢ ",h.totalWins," victoires â€¢ ",h.winRate.toFixed(1),"% taux de victoire"]}),(h.twitch||h.youtube||A.length>0)&&e.jsxs("div",{className:"social-links",children:[h.twitch&&e.jsx("a",{href:h.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),h.youtube&&e.jsx("a",{href:h.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"}),A.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:T=>{T.stopPropagation(),L()},title:`${A.length} clip${A.length>1?"s":""} disponible${A.length>1?"s":""}`,children:["ðŸŽ¬ Clip alÃ©atoire (",A.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="achievements"?"active":""}`,onClick:()=>P("achievements"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="evolution"?"active":""}`,onClick:()=>P("evolution"),children:"Ã‰volution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="camps"?"active":""}`,onClick:()=>P("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="roles"?"active":""}`,onClick:()=>P("roles"),children:"RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="maps"?"active":""}`,onClick:()=>P("maps"),children:"Maps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="kills"?"active":""}`,onClick:()=>P("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="deathmap"?"active":""}`,onClick:()=>P("deathmap"),children:"Carte"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${$==="talkingtime"?"active":""}`,onClick:()=>P("talkingtime"),children:"Parole"})]}),$==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[s?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):i?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",i]})}):l?e.jsx(tt,{achievements:W==="all"?l.allGamesAchievements:l.moddedOnlyAchievements,title:W==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:W}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[!z&&e.jsx("button",{type:"button",className:`filter-btn ${W==="all"?"active":""}`,onClick:T=>{T.stopPropagation(),I("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${W==="modded"?"active":""}`,onClick:T=>{T.stopPropagation(),I("modded")},disabled:z,children:"Parties moddÃ©es"})]})]}),$==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[m&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{b({selectedPlayer:h.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${h.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:m.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:We(m.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{b({selectedPlayer:h.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${h.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:m.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[m.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:j,onChange:T=>t(T.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:R,onChange:T=>S(T.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(rt,{selectedPlayerName:h.name,groupingMethod:j,campFilter:R})]}),$==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(at,{selectedPlayerName:h.name})}),$==="maps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(st,{selectedPlayerName:h.name})}),$==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ot,{selectedPlayerName:h.name})}),$==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(it,{selectedPlayerName:h.name})}),$==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(lt,{selectedPlayerName:h.name})}),$==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(mt,{selectedPlayerName:h.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:T=>{T.stopPropagation(),u({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[h.firstGameDate," - ",h.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',r.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>u({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:D.map(h=>e.jsxs("div",{className:`character-card ${h.isHighlighted?"highlighted":""}`,onClick:()=>F(h.name),title:`${h.name} - ${h.totalGames} parties, ${h.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:h.image?e.jsx("img",{src:h.image,alt:`Photo de profil de ${h.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":a[h.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:h.name}),(h.twitch||h.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[h.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),h.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},h.id))})})}),o&&e.jsx(Je,{clip:o,onClose:()=>g(null),relatedClips:Ze(o,N),nextClip:ye(o,N),onNextClip:()=>{const h=ye(o,N);h&&g(h)},onRelatedClip:h=>{const T=N.find(E=>E.ClipId===h);T&&g(T)}})]})}export{It as PlayerSelectionPage};
