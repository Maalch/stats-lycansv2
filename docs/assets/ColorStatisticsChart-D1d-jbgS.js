import{d as W,r as y,j as e}from"./index-Cbr1N9_I.js";import{a as M}from"./baseStatsHook-EXX5rNHU.js";import{F as j,C as p,X as f,Y as C}from"./FullscreenChart-C5QfkgM5.js";import{d as A}from"./api-C7OdInaB.js";import{R as P,T as w,a as R}from"./CategoricalChart-PQulR3sc.js";import{B as G,a as b}from"./BarChart-C8pBLbb-.js";function D(s){const h=s.length,l=new Map;return s.forEach(i=>{const r=new Set;i.PlayerStats.forEach(n=>{const c=n.Color;if(!c)return;l.has(c)||l.set(c,{gamesWithColor:new Set,totalPlayerInstances:0,totalWins:0});const x=l.get(c);r.add(c),x.totalPlayerInstances++,n.Victorious&&x.totalWins++}),r.forEach(n=>{l.get(n).gamesWithColor.add(i.Id)})}),Array.from(l.entries()).map(([i,r])=>{const n=r.gamesWithColor.size,c=r.totalPlayerInstances>0?r.totalWins/r.totalPlayerInstances*100:0,x=h>0?r.totalPlayerInstances/h:0;return{color:i,totalGames:n,totalPlayers:r.totalPlayerInstances,totalWins:r.totalWins,winRate:c,avgPlayersPerGame:x}}).sort((i,r)=>r.winRate-i.winRate)}function F(){const{data:s,isLoading:h,error:l}=M(m=>D(m));return{data:s,isLoading:h,error:l}}function V(){const{data:s,isLoading:h,error:l}=F(),{gameData:m}=W(),i=A(),[r,n]=y.useState(null),c=y.useMemo(()=>m?.length||0,[m]),{winRateChartData:x,usageChartData:S}=y.useMemo(()=>{if(!s||s.length===0)return{winRateChartData:[],usageChartData:[]};const o=[...s].sort((t,u)=>u.winRate-t.winRate).map(t=>({color:t.color,winRate:parseFloat(t.winRate.toFixed(2)),totalGames:t.totalGames,totalWins:t.totalWins,totalPlayers:t.totalPlayers,displayColor:i[t.color]||"#888888"})),a=[...s].sort((t,u)=>u.avgPlayersPerGame-t.avgPlayersPerGame).map(t=>({color:t.color,avgPlayersPerGame:parseFloat(t.avgPlayersPerGame.toFixed(2)),totalGames:t.totalGames,totalPlayers:t.totalPlayers,displayColor:i[t.color]||"#888888"}));return{winRateChartData:o,usageChartData:a}},[s,i]);return h?e.jsx("div",{className:"statistiques-chargement",children:"Chargement des statistiques de couleurs..."}):l?e.jsxs("div",{className:"statistiques-erreur",children:["Erreur lors du chargement : ",l]}):!s||s.length===0?e.jsx("div",{className:"statistiques-vide",children:"Aucune donnée de couleur disponible"}):e.jsxs("div",{className:"color-statistics-container",children:[e.jsx("h2",{children:"Statistiques des Couleurs"}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire par Couleur"}),e.jsx(j,{title:"Taux de Victoire par Couleur",children:e.jsx(P,{width:"100%",height:400,children:e.jsxs(G,{data:x,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(p,{strokeDasharray:"3 3"}),e.jsx(f,{dataKey:"color",angle:-45,textAnchor:"end",height:100,interval:0,tick:({x:o,y:a,payload:t})=>e.jsx("text",{x:o,y:a,dy:16,textAnchor:"end",fill:r===t.value?"var(--text-primary)":"var(--text-secondary)",fontSize:r===t.value?14:12,fontWeight:r===t.value?"bold":"normal",transform:`rotate(-45 ${o} ${a})`,children:t.value})}),e.jsx(C,{label:{value:"Taux de Victoire (%)",angle:270,position:"left",style:{fill:"var(--text-secondary)",textAnchor:"middle"}},domain:[0,100]}),e.jsx(w,{content:({active:o,payload:a})=>{if(o&&a&&a.length){const t=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:t.color})}),e.jsxs("div",{children:["Taux de Victoire: ",e.jsxs("strong",{children:[t.winRate.toFixed(2),"%"]})]}),e.jsxs("div",{children:["Victoires: ",t.totalWins," / ",t.totalPlayers]}),e.jsxs("div",{children:["Parties: ",t.totalGames]})]})}return null}}),e.jsx(b,{dataKey:"winRate",shape:o=>{const{x:a,y:t,width:u,height:g,payload:v}=o,d=v;return e.jsx(R,{x:a,y:t,width:u,height:g,fill:d.displayColor,stroke:r===d.color?"var(--text-primary)":"none",strokeWidth:r===d.color?2:0,onMouseEnter:()=>n(d.color),onMouseLeave:()=>n(null),style:{cursor:"pointer"}})}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Nombre Moyen de Joueurs par Couleur"}),e.jsx(j,{title:"Nombre Moyen de Joueurs par Couleur",children:e.jsx(P,{width:"100%",height:400,children:e.jsxs(G,{data:S,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(p,{strokeDasharray:"3 3"}),e.jsx(f,{dataKey:"color",angle:-45,textAnchor:"end",height:100,interval:0,tick:({x:o,y:a,payload:t})=>e.jsx("text",{x:o,y:a,dy:16,textAnchor:"end",fill:r===t.value?"var(--text-primary)":"var(--text-secondary)",fontSize:r===t.value?14:12,fontWeight:r===t.value?"bold":"normal",transform:`rotate(-45 ${o} ${a})`,children:t.value})}),e.jsx(C,{label:{value:"Joueurs par Partie",angle:270,position:"left",style:{fill:"var(--text-secondary)",textAnchor:"middle"}}}),e.jsx(w,{content:({active:o,payload:a})=>{if(o&&a&&a.length){const t=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:t.color})}),e.jsxs("div",{children:["Moyenne: ",e.jsxs("strong",{children:[t.avgPlayersPerGame.toFixed(2)," joueurs/partie"]})]}),e.jsxs("div",{children:["Calcul: ",t.totalPlayers," joueurs ÷ ",c," parties totales"]}),e.jsxs("div",{children:["Parties avec cette couleur: ",t.totalGames]})]})}return null}}),e.jsx(b,{dataKey:"avgPlayersPerGame",shape:o=>{const{x:a,y:t,width:u,height:g,payload:v}=o,d=v;return e.jsx(R,{x:a,y:t,width:u,height:g,fill:d.displayColor,stroke:r===d.color?"var(--text-primary)":"none",strokeWidth:r===d.color?2:0,onMouseEnter:()=>n(d.color),onMouseLeave:()=>n(null),style:{cursor:"pointer"}})}})]})})})]})]})]})}export{V as ColorStatisticsChart};
