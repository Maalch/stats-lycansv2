import{g as E,d as R,u as q,a as I,r as f,j as e}from"./index-etSjRIH8.js";import{a as K}from"./baseStatsHook-j95V2khF.js";import{c as w}from"./datasyncExport-CjB7UYqV.js";import{u as X}from"./useJoueursData-JJbbFk6y.js";import{u as Y}from"./api-sRGU1gvd.js";import{F as A,C as D,X as C,Y as M,a as z}from"./FullscreenChart-Dk3p1UU7.js";import{R as H,T as k}from"./CategoricalChart-NglvxiPc.js";import{B as N,a as G}from"./BarChart-DlHtQS9l.js";function J(l){return l.PlayerStats.some(p=>p.TotalCollectedLoot!==void 0&&p.TotalCollectedLoot!==null)}function O(l){if(!l||l.length===0)return null;const p=l.filter(J);if(p.length===0)return{playerStats:[],totalGames:l.length,gamesWithLootData:0};const m=new Map;return p.forEach(u=>{u.PlayerStats.forEach(n=>{const r=E(n),s=R(n);if(n.TotalCollectedLoot===void 0||n.TotalCollectedLoot===null)return;const j=n.DeathDateIrl||u.EndDate,x=w(u.StartDate,j);if(!x||x<=0)return;m.has(r)||m.set(r,{displayName:s,gamesPlayed:0,totalLoot:0,totalGameDurationSeconds:0});const y=m.get(r);y.gamesPlayed++,y.totalLoot+=n.TotalCollectedLoot,y.totalGameDurationSeconds+=x})}),{playerStats:Array.from(m.entries()).map(([u,n])=>{const r=n.totalGameDurationSeconds>0?3600/n.totalGameDurationSeconds:0;return{player:n.displayName,gamesPlayed:n.gamesPlayed,totalLoot:n.totalLoot,averageLoot:n.gamesPlayed>0?n.totalLoot/n.gamesPlayed:0,totalGameDurationSeconds:n.totalGameDurationSeconds,lootPer60Min:n.totalLoot*r}}),totalGames:l.length,gamesWithLootData:p.length}}function _(){const{data:l,isLoading:p,error:m}=K(v=>O(v));return{data:l,isLoading:p,error:m}}const Q=[3,5,10,15,25,50];function oe(){const{data:l,isLoading:p,error:m}=_(),{navigateToGameDetails:v,navigationState:u,updateNavigationState:n}=q(),{settings:r}=I(),[s,j]=f.useState(u.lootStatsState?.minGames||5),[x,y]=f.useState(null),{joueursData:W}=X(),P=Y(W);f.useEffect(()=>{const a=u.lootStatsState;(!a||a.minGames!==s)&&n({lootStatsState:{minGames:s}})},[s,n]);const{totalLootChartData:S,highlightedPlayerAddedTotal:F}=f.useMemo(()=>{if(!l?.playerStats)return{totalLootChartData:[],highlightedPlayerAddedTotal:!1};const a=l.playerStats,t=a.filter(o=>o.gamesPlayed>=s).sort((o,g)=>g.totalLoot-o.totalLoot).slice(0,20),d=r.highlightedPlayer&&t.some(o=>o.player===r.highlightedPlayer);let h=[...t],c=!1;if(r.highlightedPlayer&&!d){const o=a.find(g=>g.player===r.highlightedPlayer);o&&(h.push({...o,isHighlightedAddition:!0}),c=!0)}return{totalLootChartData:h,highlightedPlayerAddedTotal:c}},[l,s,r.highlightedPlayer]),{averageLootChartData:L,highlightedPlayerAddedAverage:$}=f.useMemo(()=>{if(!l?.playerStats)return{averageLootChartData:[],highlightedPlayerAddedAverage:!1};const a=l.playerStats,t=a.filter(o=>o.gamesPlayed>=s).sort((o,g)=>g.averageLoot-o.averageLoot).slice(0,20),d=r.highlightedPlayer&&t.some(o=>o.player===r.highlightedPlayer);let h=[...t],c=!1;if(r.highlightedPlayer&&!d){const o=a.find(g=>g.player===r.highlightedPlayer);o&&(h.push({...o,isHighlightedAddition:!0}),c=!0)}return{averageLootChartData:h,highlightedPlayerAddedAverage:c}},[l,s,r.highlightedPlayer]),{normalizedLootChartData:T,highlightedPlayerAddedNormalized:B}=f.useMemo(()=>{if(!l?.playerStats)return{normalizedLootChartData:[],highlightedPlayerAddedNormalized:!1};const a=l.playerStats,t=a.filter(o=>o.gamesPlayed>=s).sort((o,g)=>g.lootPer60Min-o.lootPer60Min).slice(0,20),d=r.highlightedPlayer&&t.some(o=>o.player===r.highlightedPlayer);let h=[...t],c=!1;if(r.highlightedPlayer&&!d){const o=a.find(g=>g.player===r.highlightedPlayer);o&&(h.push({...o,isHighlightedAddition:!0}),c=!0)}return{normalizedLootChartData:h,highlightedPlayerAddedNormalized:c}},[l,s,r.highlightedPlayer]);if(p)return e.jsx("div",{className:"donnees-attente",children:"R√©cup√©ration des statistiques de loot..."});if(m)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",m]});if(!l)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de loot disponible"});const b=l.playerStats.filter(a=>a.gamesPlayed>=s).length;return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques de R√©colte de Loot"}),e.jsxs("p",{className:"lycans-stats-info",children:[l.gamesWithLootData," parties avec donn√©es de loot collect√© ¬∑ 3 vues compl√©mentaires : Total cumul√©, Moyenne par partie, et Taux normalis√© par 60 minutes"]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Total Loot Collect√©"}),F&&r.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',r.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"min-games-select-total",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select-total",value:s,onChange:a=>j(Number(a.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:Q.map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsx(A,{title:"Total Loot Collect√©",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(N,{data:S,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:a,y:i,payload:t})=>e.jsx("text",{x:a,y:i,dy:16,textAnchor:"end",fill:r.highlightedPlayer===t.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:r.highlightedPlayer===t.value?14:13,fontWeight:r.highlightedPlayer===t.value?"bold":"italic",transform:`rotate(-45 ${a} ${i})`,children:t.value})}),e.jsx(M,{label:{value:"Loot total collect√©",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(k,{content:({active:a,payload:i})=>{if(a&&i&&i.length>0){const t=i[0].payload,d=t.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:t.player}),e.jsxs("div",{children:["Parties jou√©es: ",t.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Loot collect√©:"})}),e.jsxs("div",{children:["Total: ",t.totalLoot.toLocaleString()]}),e.jsxs("div",{children:["Moyenne par partie: ",t.averageLoot.toFixed(1)]}),e.jsxs("div",{children:["Taux (par 60 min): ",t.lootPer60Min.toFixed(1)]}),d&&e.jsxs("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:["üéØ Affich√© via s√©lection personnelle",t.gamesPlayed<s&&` (< ${s} parties)`]})]})}return null}}),e.jsx(G,{dataKey:"totalLoot",children:S.map((a,i)=>{const t=r.highlightedPlayer===a.player,d=x===a.player,h=a.isHighlightedAddition,c=P[a.player]||"var(--chart-primary)";return e.jsx(z,{fill:t?"var(--accent-primary)":h?"var(--accent-secondary)":c,stroke:t?"var(--accent-primary)":d?"#000000":"none",strokeWidth:t?3:d?2:0,strokeDasharray:h?"5,5":"none",opacity:h?.8:1,onClick:()=>v({selectedPlayer:a.player}),onMouseEnter:()=>y(a.player),onMouseLeave:()=>y(null),style:{cursor:"pointer"}},`cell-${i}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",S.length," des joueurs (sur ",b," ayant au moins ",s," partie",s>1?"s":"",")"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Calcul√© sur ",l.gamesWithLootData," parties avec donn√©es de loot"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Moyenne de Loot par Partie"}),$&&r.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',r.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsx(A,{title:"Moyenne de Loot par Partie",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(N,{data:L,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:a,y:i,payload:t})=>e.jsx("text",{x:a,y:i,dy:16,textAnchor:"end",fill:r.highlightedPlayer===t.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:r.highlightedPlayer===t.value?14:13,fontWeight:r.highlightedPlayer===t.value?"bold":"italic",transform:`rotate(-45 ${a} ${i})`,children:t.value})}),e.jsx(M,{label:{value:"Loot moyen par partie",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(k,{content:({active:a,payload:i})=>{if(a&&i&&i.length>0){const t=i[0].payload,d=t.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:t.player}),e.jsxs("div",{children:["Parties jou√©es: ",t.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Loot collect√©:"})}),e.jsxs("div",{children:["Moyenne par partie: ",t.averageLoot.toFixed(1)]}),e.jsxs("div",{children:["Total: ",t.totalLoot.toLocaleString()]}),e.jsxs("div",{children:["Taux (par 60 min): ",t.lootPer60Min.toFixed(1)]}),d&&e.jsxs("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:["üéØ Affich√© via s√©lection personnelle",t.gamesPlayed<s&&` (< ${s} parties)`]})]})}return null}}),e.jsx(G,{dataKey:"averageLoot",children:L.map((a,i)=>{const t=r.highlightedPlayer===a.player,d=x===a.player,h=a.isHighlightedAddition,c=P[a.player]||"var(--chart-primary)";return e.jsx(z,{fill:t?"var(--accent-primary)":h?"var(--accent-secondary)":c,stroke:t?"var(--accent-primary)":d?"#000000":"none",strokeWidth:t?3:d?2:0,strokeDasharray:h?"5,5":"none",opacity:h?.8:1,onClick:()=>v({selectedPlayer:a.player}),onMouseEnter:()=>y(a.player),onMouseLeave:()=>y(null),style:{cursor:"pointer"}},`cell-${i}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",L.length," des joueurs (sur ",b," ayant au moins ",s," partie",s>1?"s":"",")"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Calcul√© sur ",l.gamesWithLootData," parties avec donn√©es de loot"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Taux de R√©colte (par 60 min)"}),B&&r.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',r.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsx(A,{title:"Taux de R√©colte (par 60 min)",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(N,{data:T,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:a,y:i,payload:t})=>e.jsx("text",{x:a,y:i,dy:16,textAnchor:"end",fill:r.highlightedPlayer===t.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:r.highlightedPlayer===t.value?14:13,fontWeight:r.highlightedPlayer===t.value?"bold":"italic",transform:`rotate(-45 ${a} ${i})`,children:t.value})}),e.jsx(M,{label:{value:"Loot par 60 minutes",angle:270,position:"left",offset:15,style:{textAnchor:"middle"}}}),e.jsx(k,{content:({active:a,payload:i})=>{if(a&&i&&i.length>0){const t=i[0].payload,d=t.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:t.player}),e.jsxs("div",{children:["Parties jou√©es: ",t.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Taux normalis√© (par 60 min):"})}),e.jsxs("div",{children:[t.lootPer60Min.toFixed(1)," loot/heure"]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Statistiques globales:"})}),e.jsxs("div",{children:["Total: ",t.totalLoot.toLocaleString()]}),e.jsxs("div",{children:["Moyenne par partie: ",t.averageLoot.toFixed(1)]}),d&&e.jsxs("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:["üéØ Affich√© via s√©lection personnelle",t.gamesPlayed<s&&` (< ${s} parties)`]})]})}return null}}),e.jsx(G,{dataKey:"lootPer60Min",children:T.map((a,i)=>{const t=r.highlightedPlayer===a.player,d=x===a.player,h=a.isHighlightedAddition,c=P[a.player]||"var(--chart-primary)";return e.jsx(z,{fill:t?"var(--accent-primary)":h?"var(--accent-secondary)":c,stroke:t?"var(--accent-primary)":d?"#000000":"none",strokeWidth:t?3:d?2:0,strokeDasharray:h?"5,5":"none",opacity:h?.8:1,onClick:()=>v({selectedPlayer:a.player}),onMouseEnter:()=>y(a.player),onMouseLeave:()=>y(null),style:{cursor:"pointer"}},`cell-${i}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",T.length," des joueurs (sur ",b," ayant au moins ",s," partie",s>1?"s":"",")"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Taux normalis√© par 60 minutes de jeu ¬∑ Calcul√© sur ",l.gamesWithLootData," parties avec donn√©es"]})]})]})]})}export{oe as LootStatisticsChart};
