import{r as S,j as e,u as se,a as pe,e as ae}from"./index-CyPd8ruI.js";import{u as xe,c as ge}from"./useDeathStatisticsFromRaw-DSIfNdwa.js";import{D as X}from"./datasyncExport-DnS6X_Zl.js";import{a as ye}from"./api-D1jcorA2.js";import{F as ve,C as be,X as je,Y as Me,a as ze}from"./FullscreenChart-CfkPwXn5.js";import{g as Se,c as te,a as Ce,b as Ee,d as ke,R as we}from"./deathLocationUtils-DaOWdj6Z.js";import{g as J}from"./deathTypes-T5wVOxX_.js";import{ak as De,al as ie,am as re,an as Re,ao as K,R as Ae,T as Ne}from"./CategoricalChart-Bz_039r1.js";import{S as Le,a as Te}from"./ScatterChart-CnO6GDWZ.js";import"./baseStatsHook-DKJo3RIJ.js";const Ie=Pe(We);function Pe(t){return function(o,l,n=l){if(!((l=+l)>=0))throw new RangeError("invalid rx");if(!((n=+n)>=0))throw new RangeError("invalid ry");let{data:r,width:c,height:p}=o;if(!((c=Math.floor(c))>=0))throw new RangeError("invalid width");if(!((p=Math.floor(p!==void 0?p:r.length/c))>=0))throw new RangeError("invalid height");if(!c||!p||!l&&!n)return o;const g=l&&t(l),b=n&&t(n),i=r.slice();return g&&b?(G(g,i,r,c,p),G(g,r,i,c,p),G(g,i,r,c,p),O(b,r,i,c,p),O(b,i,r,c,p),O(b,r,i,c,p)):g?(G(g,r,i,c,p),G(g,i,r,c,p),G(g,r,i,c,p)):b&&(O(b,r,i,c,p),O(b,i,r,c,p),O(b,r,i,c,p)),o}}function G(t,o,l,n,r){for(let c=0,p=n*r;c<p;)t(o,l,c,c+=n,1)}function O(t,o,l,n,r){for(let c=0,p=n*r;c<n;++c)t(o,l,c,c+p,n)}function We(t){const o=Math.floor(t);if(o===t)return Be(t);const l=t-o,n=2*t+1;return(r,c,p,g,b)=>{if(!((g-=b)>=p))return;let i=o*c[p];const m=b*o,u=m+b;for(let d=p,M=p+m;d<M;d+=b)i+=c[Math.min(g,d)];for(let d=p,M=g;d<=M;d+=b)i+=c[Math.min(g,d+m)],r[d]=(i+l*(c[Math.max(p,d-u)]+c[Math.min(g,d+u)]))/n,i-=c[Math.max(p,d-m)]}}function Be(t){const o=2*t+1;return(l,n,r,c,p)=>{if(!((c-=p)>=r))return;let g=t*n[r];const b=p*t;for(let i=r,m=r+b;i<m;i+=p)g+=n[Math.min(c,i)];for(let i=r,m=c;i<=m;i+=p)g+=n[Math.min(c,i+b)],l[i]=g/o,g-=n[Math.max(r,i-b)]}}function Fe(t,o){let l=0;for(let n of t)n!=null&&(n=+n)>=n&&++l;return l}function Xe(t,o){let l,n;if(o===void 0)for(const r of t)r!=null&&(l===void 0?r>=r&&(l=n=r):(l>r&&(l=r),n<r&&(n=r)));else{let r=-1;for(let c of t)(c=o(c,++r,t))!=null&&(l===void 0?c>=c&&(l=n=c):(l>c&&(l=c),n<c&&(n=c)))}return[l,n]}function Ve(t,o,l){let n;for(;;){const r=De(t,o,l);if(r===n||r===0||!isFinite(r))return[t,o];r>0?(t=Math.floor(t/r)*r,o=Math.ceil(o/r)*r):r<0&&(t=Math.ceil(t*r)/r,o=Math.floor(o*r)/r),n=r}}function $e(t){return Math.max(1,Math.ceil(Math.log(Fe(t))/Math.LN2)+1)}var He=Array.prototype,le=He.slice;function qe(t,o){return t-o}function Ye(t){for(var o=0,l=t.length,n=t[l-1][1]*t[0][0]-t[l-1][0]*t[0][1];++o<l;)n+=t[o-1][1]*t[o][0]-t[o-1][0]*t[o][1];return n}const Y=t=>()=>t;function Ze(t,o){for(var l=-1,n=o.length,r;++l<n;)if(r=Ge(t,o[l]))return r;return 0}function Ge(t,o){for(var l=o[0],n=o[1],r=-1,c=0,p=t.length,g=p-1;c<p;g=c++){var b=t[c],i=b[0],m=b[1],u=t[g],d=u[0],M=u[1];if(Oe(b,u,o))return 0;m>n!=M>n&&l<(d-i)*(n-m)/(M-m)+i&&(r=-r)}return r}function Oe(t,o,l){var n;return Ue(t,o,l)&&Ke(t[n=+(t[0]===o[0])],l[n],o[n])}function Ue(t,o,l){return(o[0]-t[0])*(l[1]-t[1])===(l[0]-t[0])*(o[1]-t[1])}function Ke(t,o,l){return t<=o&&o<=l||l<=o&&o<=t}function Je(){}var H=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function ne(){var t=1,o=1,l=$e,n=b;function r(i){var m=l(i);if(Array.isArray(m))m=m.slice().sort(qe);else{const u=Xe(i,Qe);for(m=ie(...Ve(u[0],u[1],m),m);m[m.length-1]>=u[1];)m.pop();for(;m[1]<u[0];)m.shift()}return m.map(u=>c(i,u))}function c(i,m){const u=m==null?NaN:+m;if(isNaN(u))throw new Error(`invalid value: ${m}`);var d=[],M=[];return p(i,u,function(x){n(x,i,u),Ye(x)>0?d.push([x]):M.push(x)}),M.forEach(function(x){for(var w=0,v=d.length,h;w<v;++w)if(Ze((h=d[w])[0],x)!==-1){h.push(x);return}}),{type:"MultiPolygon",value:m,coordinates:d}}function p(i,m,u){var d=new Array,M=new Array,x,w,v,h,s,y;for(x=w=-1,h=Z(i[0],m),H[h<<1].forEach(a);++x<t-1;)v=h,h=Z(i[x+1],m),H[v|h<<1].forEach(a);for(H[h<<0].forEach(a);++w<o-1;){for(x=-1,h=Z(i[w*t+t],m),s=Z(i[w*t],m),H[h<<1|s<<2].forEach(a);++x<t-1;)v=h,h=Z(i[w*t+t+x+1],m),y=s,s=Z(i[w*t+x+1],m),H[v|h<<1|s<<2|y<<3].forEach(a);H[h|s<<3].forEach(a)}for(x=-1,s=i[w*t]>=m,H[s<<2].forEach(a);++x<t-1;)y=s,s=Z(i[w*t+x+1],m),H[s<<2|y<<3].forEach(a);H[s<<3].forEach(a);function a(j){var C=[j[0][0]+x,j[0][1]+w],R=[j[1][0]+x,j[1][1]+w],k=g(C),N=g(R),z,L;(z=M[k])?(L=d[N])?(delete M[z.end],delete d[L.start],z===L?(z.ring.push(R),u(z.ring)):d[z.start]=M[L.end]={start:z.start,end:L.end,ring:z.ring.concat(L.ring)}):(delete M[z.end],z.ring.push(R),M[z.end=N]=z):(z=d[N])?(L=M[k])?(delete d[z.start],delete M[L.end],z===L?(z.ring.push(R),u(z.ring)):d[L.start]=M[z.end]={start:L.start,end:z.end,ring:L.ring.concat(z.ring)}):(delete d[z.start],z.ring.unshift(C),d[z.start=k]=z):d[k]=M[N]={start:k,end:N,ring:[C,R]}}}function g(i){return i[0]*2+i[1]*(t+1)*4}function b(i,m,u){i.forEach(function(d){var M=d[0],x=d[1],w=M|0,v=x|0,h=Q(m[v*t+w]);M>0&&M<t&&w===M&&(d[0]=oe(M,Q(m[v*t+w-1]),h,u)),x>0&&x<o&&v===x&&(d[1]=oe(x,Q(m[(v-1)*t+w]),h,u))})}return r.contour=c,r.size=function(i){if(!arguments.length)return[t,o];var m=Math.floor(i[0]),u=Math.floor(i[1]);if(!(m>=0&&u>=0))throw new Error("invalid size");return t=m,o=u,r},r.thresholds=function(i){return arguments.length?(l=typeof i=="function"?i:Array.isArray(i)?Y(le.call(i)):Y(i),r):l},r.smooth=function(i){return arguments.length?(n=i?b:Je,r):n===b},r}function Qe(t){return isFinite(t)?t:NaN}function Z(t,o){return t==null?!1:+t>=o}function Q(t){return t==null||isNaN(t=+t)?-1/0:t}function oe(t,o,l,n){const r=n-o,c=l-o,p=isFinite(r)||isFinite(c)?r/c:Math.sign(r)/Math.sign(c);return isNaN(p)?t:t+p-.5}function _e(t){return t[0]}function et(t){return t[1]}function tt(){return 1}function ce(){var t=_e,o=et,l=tt,n=960,r=500,c=20,p=2,g=c*3,b=n+g*2>>p,i=r+g*2>>p,m=Y(20);function u(s){var y=new Float32Array(b*i),a=Math.pow(2,-p),j=-1;for(const U of s){var C=(t(U,++j,s)+g)*a,R=(o(U,j,s)+g)*a,k=+l(U,j,s);if(k&&C>=0&&C<b&&R>=0&&R<i){var N=Math.floor(C),z=Math.floor(R),L=C-N-.5,q=R-z-.5;y[N+z*b]+=(1-L)*(1-q)*k,y[N+1+z*b]+=L*(1-q)*k,y[N+1+(z+1)*b]+=L*q*k,y[N+(z+1)*b]+=(1-L)*q*k}}return Ie({data:y,width:b,height:i},c*a),y}function d(s){var y=u(s),a=m(y),j=Math.pow(2,2*p);return Array.isArray(a)||(a=ie(Number.MIN_VALUE,re(y)/j,a)),ne().size([b,i]).thresholds(a.map(C=>C*j))(y).map((C,R)=>(C.value=+a[R],M(C)))}d.contours=function(s){var y=u(s),a=ne().size([b,i]),j=Math.pow(2,2*p),C=R=>{R=+R;var k=M(a.contour(y,R*j));return k.value=R,k};return Object.defineProperty(C,"max",{get:()=>re(y)/j}),C};function M(s){return s.coordinates.forEach(x),s}function x(s){s.forEach(w)}function w(s){s.forEach(v)}function v(s){s[0]=s[0]*Math.pow(2,p)-g,s[1]=s[1]*Math.pow(2,p)-g}function h(){return g=c*3,b=n+g*2>>p,i=r+g*2>>p,d}return d.x=function(s){return arguments.length?(t=typeof s=="function"?s:Y(+s),d):t},d.y=function(s){return arguments.length?(o=typeof s=="function"?s:Y(+s),d):o},d.weight=function(s){return arguments.length?(l=typeof s=="function"?s:Y(+s),d):l},d.size=function(s){if(!arguments.length)return[n,r];var y=+s[0],a=+s[1];if(!(y>=0&&a>=0))throw new Error("invalid size");return n=y,r=a,h()},d.cellSize=function(s){if(!arguments.length)return 1<<p;if(!((s=+s)>=1))throw new Error("invalid cell size");return p=Math.floor(Math.log(s)/Math.LN2),h()},d.thresholds=function(s){return arguments.length?(m=typeof s=="function"?s:Array.isArray(s)?Y(le.call(s)):Y(s),d):m},d.bandwidth=function(s){if(!arguments.length)return Math.sqrt(c*(c+1));if(!((s=+s)>=0))throw new Error("invalid bandwidth");return c=(Math.sqrt(4*s*s+1)-1)/2,h()},d}function rt(t){for(var o=t.length/6|0,l=new Array(o),n=0;n<o;)l[n]="#"+t.slice(n*6,++n*6);return l}const nt=t=>Re(t[t.length-1]);var ot=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(rt);const de=nt(ot);function st({deathLocations:t,xDomain:o,zDomain:l,width:n=800,height:r=600,bandwidth:c=25,onRegionClick:p,mapConfig:g}){const b=S.useRef(null),i=S.useRef(null),m=S.useRef(null),u=S.useRef(null),[,d]=S.useState(!1),M=S.useMemo(()=>K().domain(l).range([0,n]),[l,n]),x=S.useMemo(()=>K().domain(o).range([r,0]),[o,r]),w=S.useMemo(()=>t.length===0?[]:ce().x(a=>M(a.z)).y(a=>x(a.x)).size([n,r]).bandwidth(c).thresholds(15)(t),[t,x,M,n,r,c]),v=S.useMemo(()=>{const y=w.length>0?Math.max(...w.map(a=>a.value)):1;return a=>{const j=a/y;return de(j)}},[w]);S.useEffect(()=>{const y=m.current;if(!y||!g){d(!1);return}const a=y.getContext("2d");if(!a)return;a.clearRect(0,0,n,r);const j=new Image;j.onload=()=>{a.globalAlpha=.85,a.drawImage(j,0,0,n,r),a.globalAlpha=1,d(!0)},j.onerror=()=>{d(!1)},j.src=g.src},[g,n,r]),S.useEffect(()=>{const y=b.current;if(!y||w.length===0)return;const a=y.getContext("2d");a&&(a.clearRect(0,0,n,r),w.forEach(j=>{a.fillStyle=v(j.value),a.globalAlpha=.6,j.coordinates.forEach(C=>{C.forEach(R=>{a.beginPath(),R.forEach((k,N)=>{N===0?a.moveTo(k[0],k[1]):a.lineTo(k[0],k[1])}),a.closePath(),a.fill()})})}),a.globalAlpha=1)},[w,n,r,v]),S.useEffect(()=>{const y=i.current;if(!y||t.length===0)return;const a=y.getContext("2d");a&&(a.clearRect(0,0,n,r),t.forEach(j=>{const C=M(j.z),R=x(j.x);a.beginPath(),a.arc(C,R,2,0,2*Math.PI),a.fillStyle="rgba(0, 0, 0, 0.3)",a.fill(),a.strokeStyle="rgba(255, 255, 255, 0.5)",a.lineWidth=.5,a.stroke()}))},[t,x,M,n,r]);const h=y=>{if(!p||!u.current)return;const a=u.current.getBoundingClientRect(),j=y.clientX-a.left,C=y.clientY-a.top,R=30,k=t.filter(N=>{const z=M(N.z),L=x(N.x);return Math.sqrt(Math.pow(z-j,2)+Math.pow(L-C,2))<=R});k.length>0&&p(k)},s=y=>{if(!u.current)return;const a=u.current.getBoundingClientRect(),j=y.clientX-a.left,C=y.clientY-a.top,R=20,k=t.filter(N=>{const z=M(N.z),L=x(N.x);return Math.sqrt(Math.pow(z-j,2)+Math.pow(L-C,2))<=R});u.current&&(u.current.style.cursor=k.length>0?"pointer":"default")};return e.jsxs("div",{ref:u,style:{position:"relative",width:`${n}px`,height:`${r}px`,margin:"0 auto"},onClick:h,onMouseMove:s,children:[e.jsx("canvas",{ref:m,width:n,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),e.jsx("canvas",{ref:b,width:n,height:r,style:{position:"absolute",top:0,left:0,borderRadius:"4px",pointerEvents:"none"}}),e.jsx("canvas",{ref:i,width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),e.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),e.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),e.jsxs("svg",{width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(y=>{const a=n*y,j=l[0]+(l[1]-l[0])*y;return e.jsxs("g",{children:[e.jsx("line",{x1:a,y1:r,x2:a,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:a,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(j)})]},`z-${y}`)}),[0,.25,.5,.75,1].map(y=>{const a=r*(1-y),j=o[0]+(o[1]-o[0])*y;return e.jsxs("g",{children:[e.jsx("line",{x1:0,y1:a,x2:5,y2:a,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:10,y:a,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(j)})]},`x-${y}`)})]})]})}function at({selectedCamp:t,availableDeathTypes:o,deathTypeColors:l}){const{navigateToGameDetails:n,navigationState:r,updateNavigationState:c}=se(),{settings:p}=pe(),{data:g,isLoading:b,error:i}=ae(),[m,u]=S.useState(""),[d,M]=S.useState(r.deathLocationState?.selectedDeathTypes||[]),[x,w]=S.useState(null),[v,h]=S.useState("heatmap"),[s,y]=S.useState(20),[a,j]=S.useState(!1),C=S.useMemo(()=>{if(!g)return[];const f=Se(g),A=te(g,t),E=new Map;return A.forEach(D=>{E.set(D.mapName,(E.get(D.mapName)||0)+1)}),f.sort((D,W)=>{const T=E.get(D)||0;return(E.get(W)||0)-T})},[g,t]),R=C.length>0?C[0]:"";m===""&&R!==""&&u(R);const k=S.useMemo(()=>{if(!g)return[];let f=te(g,t);return m&&(f=f.filter(A=>A.mapName===m)),d.length>0&&(f=f.filter(A=>d.includes(A.deathType))),f},[g,t,m,d]),N=S.useMemo(()=>Ce(k,s),[k,s]),z=S.useMemo(()=>N.map((f,A)=>{const E=f.items[0],D=Ee(f.items);return{x:f.centroidX,z:f.centroidZ,deathCount:f.items.length,allDeaths:f.items,dominantDeathType:D,playerName:f.items.length===1?E.playerName:null,gameId:f.items.length===1?E.gameId:null,camp:E.camp,mapName:E.mapName,deathType:D,killerName:f.items.length===1?E.killerName:null,clusterIndex:A}}),[N]),L=({active:f,payload:A})=>{if(!f||!A||A.length===0)return null;const E=A[0].payload,D=E.allDeaths||[E];if(D.length>1){const B=new Map,V=new Set,$=new Map;D.forEach(I=>{const F=I.deathType?J(I.deathType):"Inconnu";B.set(F,(B.get(F)||0)+1),V.add(I.gameId),$.set(I.playerName,($.get(I.playerName)||0)+1)});const ue=Array.from($.entries()).sort((I,F)=>F[1]-I[1]).slice(0,3),fe=$.size>3,me=Array.from(B.entries()).sort((I,F)=>F[1]-I[1]).slice(0,3),he=B.size>3;return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:[D.length," morts dans cette zone"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Centre:"})," (",Math.round(E.x),", ",Math.round(E.z),")"]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Joueurs:"}),e.jsxs("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:[ue.map(([I,F])=>e.jsxs("li",{children:[I," ",F>1?`(${F} morts)`:""]},I)),fe&&e.jsxs("li",{style:{color:"var(--text-secondary)"},children:["...et ",$.size-3," autres"]})]})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Types de mort:"}),e.jsxs("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:[me.map(([I,F])=>e.jsxs("li",{children:[I," (",F,")"]},I)),he&&e.jsxs("li",{style:{color:"var(--text-secondary)"},children:["...et ",B.size-3," autres"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Parties:"})," ",V.size," parties",V.size<=5&&e.jsxs("span",{children:[" (",Array.from(V).filter(I=>I).map(I=>`#${I}`).join(", "),")"]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const T=D[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:T.playerName}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Camp:"})," ",T.camp]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type de mort:"})," ",T.deathType?J(T.deathType):"Inconnu"]}),T.killerName&&e.jsxs("div",{children:[e.jsx("strong",{children:"TuÃ© par:"})," ",T.killerName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Carte:"})," ",T.mapName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Partie:"})," #",T.gameId]}),e.jsxs("div",{style:{marginTop:"4px",fontSize:"0.85rem",color:"var(--text-secondary)"},children:["Position: (",Math.round(T.x),", ",Math.round(T.z),")"]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})},q=f=>{if(!f)return;const A=f.allDeaths||[f];if(A.length===1)n({selectedGame:A[0].gameId,fromComponent:"Death Location View"});else{const E=A.map(D=>D.gameId).filter(D=>D);n({selectedGameIds:E,fromComponent:"Death Location View"})}},U=f=>f&&l[f]||"var(--text-secondary)",P=S.useMemo(()=>ke(m),[m]),{xDomain:_,zDomain:ee}=S.useMemo(()=>{if(P)return{xDomain:[P.xMin,P.xMax],zDomain:[P.zMin,P.zMax]};if(z.length===0)return{xDomain:[0,100],zDomain:[0,100]};const f=z.map($=>$.x),A=z.map($=>$.z),E=Math.min(...f),D=Math.max(...f),W=Math.min(...A),T=Math.max(...A),B=(D-E)*.1||10,V=(T-W)*.1||10;return{xDomain:[E-B,D+B],zDomain:[W-V,T+V]}},[z,P]);return b?e.jsx("div",{className:"donnees-attente",children:"Chargement des localisations de mort..."}):i?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",i]}):g?e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Mode :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>h("heatmap"),style:{background:v==="heatmap"?"var(--accent-primary)":"transparent",color:v==="heatmap"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:v==="heatmap"?"bold":"normal",transition:"all 0.2s"},children:"Carte de chaleur"}),e.jsx("button",{type:"button",onClick:()=>h("scatter"),style:{background:v==="scatter"?"var(--accent-primary)":"transparent",color:v==="scatter"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:v==="scatter"?"bold":"normal",transition:"all 0.2s"},children:"Points"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"map-select",value:m,onChange:f=>u(f.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:C.filter(f=>f==="Village"||f==="ChÃ¢teau").map(f=>e.jsx("option",{value:f,children:f},f))})]}),e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>j(!a),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:a?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:a?"rotate(90deg)":"rotate(0deg)"},children:"â–¶"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[d.length," / ",o.length," sÃ©lectionnÃ©",d.length>1?"s":""]})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:f=>{f.stopPropagation(),M(o),c({deathLocationState:{...r.deathLocationState,selectedCamp:t,selectedDeathTypes:o}})},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:f=>{f.stopPropagation(),M([]),c({deathLocationState:{...r.deathLocationState,selectedCamp:t,selectedDeathTypes:[]}})},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:o.map(f=>{const A=d.includes(f),E=l[f]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",borderRadius:"4px",cursor:"pointer",background:A?E:"var(--bg-tertiary)",color:A?"white":"var(--text-primary)",border:`1px solid ${A?E:"var(--border-color)"}`,transition:"all 0.2s",fontSize:"0.85rem",fontWeight:A?"600":"normal"},onMouseEnter:D=>{A||(D.currentTarget.style.background="var(--bg-hover)",D.currentTarget.style.borderColor=E)},onMouseLeave:D=>{A||(D.currentTarget.style.background="var(--bg-tertiary)",D.currentTarget.style.borderColor="var(--border-color)")},children:[e.jsx("input",{type:"checkbox",checked:A,onChange:D=>{const W=D.target.checked?[...d,f]:d.filter(T=>T!==f);M(W),c({deathLocationState:{...r.deathLocationState,selectedCamp:t,selectedDeathTypes:W}})},style:{cursor:"pointer",accentColor:E}}),e.jsx("span",{children:J(f)})]},f)})})]})]}),v==="scatter"&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-radius",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-radius",type:"range",min:"0",max:"60",step:"5",value:s,onChange:f=>y(Number(f.target.value)),style:{width:"100px",cursor:"pointer"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.85rem",minWidth:"70px"},children:s===0?"Aucun":`${s} unitÃ©s`})]})]}),k.length>0?e.jsx(ve,{title:v==="scatter"?"Carte des Morts":"Carte de Chaleur des Morts",children:v==="scatter"?e.jsx("div",{style:{height:700,width:"100%",maxWidth:1e3,margin:"0 auto"},children:e.jsx(Ae,{width:"100%",height:"100%",children:e.jsxs(Le,{margin:{top:20,right:30,left:60,bottom:60},children:[P&&e.jsx(we,{x1:P.zMin,x2:P.zMax,y1:P.xMin,y2:P.xMax,fill:"transparent",stroke:"none",shape:f=>{const{x:A,y:E,width:D,height:W}=f;return e.jsx("image",{x:A,y:E,width:D,height:W,href:P.src,preserveAspectRatio:"none",style:{opacity:.85}})}}),e.jsx(be,{strokeDasharray:"3 3",stroke:P?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(je,{dataKey:"z",type:"number",name:"Position Z",label:{value:"Position Z",position:"bottom",offset:10,style:{fill:"var(--text-secondary)"}},domain:ee,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:f=>Math.round(f).toString()}),e.jsx(Me,{dataKey:"x",type:"number",name:"Position X",label:{value:"Position X",angle:-90,position:"left",offset:20,style:{fill:"var(--text-secondary)"}},domain:_,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:f=>Math.round(f).toString()}),e.jsx(Ne,{content:e.jsx(L,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Te,{data:z,onClick:f=>q(f),onMouseEnter:f=>w(f),onMouseLeave:()=>w(null),style:{cursor:"pointer"},isAnimationActive:!1,children:z.map((f,A)=>{const E=f.allDeaths.some(V=>p.highlightedPlayer===V.playerName),D=x&&f.clusterIndex===x.clusterIndex,W=Math.min(Math.log2(f.deathCount+1)*3+4,18),T=Math.round(W),B=T+2;return e.jsx(ze,{fill:E?"var(--accent-primary)":U(f.deathType),stroke:E||D?"white":f.deathCount>1?"rgba(255,255,255,0.6)":"none",strokeWidth:E?3:D?2:f.deathCount>1?1.5:0,opacity:E?1:.8,r:E?B:D?T+1:T},`cell-${A}`)})})]})})}):e.jsx("div",{style:{padding:"2rem 0",display:"flex",justifyContent:"center"},children:e.jsx(st,{deathLocations:k,xDomain:_,zDomain:ee,width:1e3,height:700,bandwidth:25,mapConfig:P,onRegionClick:f=>{if(f.length===1)n({selectedGame:f[0].gameId,fromComponent:"Death Location View (Heatmap)"});else{const A=f.map(E=>E.gameId).filter(E=>E);n({selectedGameIds:A,fromComponent:"Death Location View (Heatmap)"})}}})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1rem"},children:"Aucune localisation de mort disponible pour les filtres sÃ©lectionnÃ©s"}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes (non-legacy)."})]}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginTop:"2rem",marginBottom:"2rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Morts localisÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary)"},children:k.length}),v==="scatter"&&s>0&&z.length<k.length&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"4px"},children:["â†’ ",z.length," points groupÃ©s"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camp filtrÃ©"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)",fontSize:"1.2rem"},children:t})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Types de mort"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-2)",fontSize:"1.2rem"},children:d.length===0||d.length===o.length?"Tous":`${d.length} type${d.length>1?"s":""}`})]})]}),e.jsxs("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:[e.jsx("p",{children:e.jsx("strong",{children:"Ã€ propos de cette visualisation :"})}),e.jsxs("ul",{style:{marginTop:"0.5rem",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Les positions sont basÃ©es sur les coordonnÃ©es Z (horizontal) et X (vertical) - vue 2D de la carte"}),v==="scatter"?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:'Les morts proches sont regroupÃ©es en un seul point - ajustez le curseur "Regroupement" pour contrÃ´ler la distance'}),e.jsx("li",{children:"Les points regroupÃ©s ont une petite bordure blanche"}),e.jsx("li",{children:"La couleur indique le type de mort dominant dans ce regroupement"}),e.jsx("li",{children:"Survolez un point pour voir tous les joueurs, types de mort et parties concernÃ©s"}),e.jsxs("li",{children:["Le joueur sÃ©lectionnÃ© est affichÃ© en "," ",e.jsx("span",{style:{color:"var(--accent-primary)",fontWeight:"bold"},children:"couleur primaire"})]}),e.jsx("li",{children:"Cliquez sur un point pour voir les dÃ©tails de la ou des parties"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"La carte de chaleur montre les zones de forte densitÃ© de morts (du jaune au rouge)"}),e.jsx("li",{children:"Les points noirs indiquent l'emplacement exact de chaque mort"}),e.jsx("li",{children:"Les zones rouges indiquent une concentration Ã©levÃ©e de morts"}),e.jsx("li",{children:"Cliquez sur une zone pour voir les dÃ©tails des parties associÃ©es"}),e.jsx("li",{children:'Utilisez le mode "Points" pour voir les dÃ©tails individuels par type de mort'})]})]}),e.jsx("p",{style:{marginTop:"0.5rem",fontStyle:"italic",color:"var(--text-secondary)"},children:"Note : Seules les parties rÃ©centes contiennent des donnÃ©es de position."})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function gt({deathLocations:t,xDomain:o,zDomain:l,width:n=800,height:r=600,bandwidth:c=25,onRegionClick:p}){const g=S.useRef(null),b=S.useRef(null),i=S.useRef(null),m=S.useMemo(()=>K().domain(o).range([0,n]),[o,n]),u=S.useMemo(()=>K().domain(l).range([r,0]),[l,r]),d=S.useMemo(()=>t.length===0?[]:ce().x(h=>m(h.x)).y(h=>u(h.z)).size([n,r]).bandwidth(c).thresholds(15)(t),[t,m,u,n,r,c]),M=S.useMemo(()=>{const v=d.length>0?Math.max(...d.map(h=>h.value)):1;return h=>{const s=h/v;return de(s)}},[d]);S.useEffect(()=>{const v=g.current;if(!v||d.length===0)return;const h=v.getContext("2d");h&&(h.clearRect(0,0,n,r),d.forEach(s=>{h.fillStyle=M(s.value),h.globalAlpha=.6,s.coordinates.forEach(y=>{y.forEach(a=>{h.beginPath(),a.forEach((j,C)=>{C===0?h.moveTo(j[0],j[1]):h.lineTo(j[0],j[1])}),h.closePath(),h.fill()})})}),h.globalAlpha=1)},[d,n,r,M]),S.useEffect(()=>{const v=b.current;if(!v||t.length===0)return;const h=v.getContext("2d");h&&(h.clearRect(0,0,n,r),t.forEach(s=>{const y=m(s.x),a=u(s.z);h.beginPath(),h.arc(y,a,2,0,2*Math.PI),h.fillStyle="rgba(0, 0, 0, 0.3)",h.fill(),h.strokeStyle="rgba(255, 255, 255, 0.5)",h.lineWidth=.5,h.stroke()}))},[t,m,u,n,r]);const x=v=>{if(!p||!i.current)return;const h=i.current.getBoundingClientRect(),s=v.clientX-h.left,y=v.clientY-h.top,a=30,j=t.filter(C=>{const R=m(C.x),k=u(C.z);return Math.sqrt(Math.pow(R-s,2)+Math.pow(k-y,2))<=a});j.length>0&&p(j)},w=v=>{if(!i.current)return;const h=i.current.getBoundingClientRect(),s=v.clientX-h.left,y=v.clientY-h.top,a=20,j=t.filter(C=>{const R=m(C.x),k=u(C.z);return Math.sqrt(Math.pow(R-s,2)+Math.pow(k-y,2))<=a});i.current&&(i.current.style.cursor=j.length>0?"pointer":"default")};return e.jsxs("div",{ref:i,style:{position:"relative",width:`${n}px`,height:`${r}px`,margin:"0 auto"},onClick:x,onMouseMove:w,children:[e.jsx("canvas",{ref:g,width:n,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),e.jsx("canvas",{ref:b,width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),e.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),e.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),e.jsxs("svg",{width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(v=>{const h=n*v,s=o[0]+(o[1]-o[0])*v;return e.jsxs("g",{children:[e.jsx("line",{x1:h,y1:r,x2:h,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:h,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(s)})]},`x-${v}`)}),[0,.25,.5,.75,1].map(v=>{const h=r*(1-v),s=l[0]+(l[1]-l[0])*v;return e.jsxs("g",{children:[e.jsx("line",{x1:0,y1:h,x2:5,y2:h,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:10,y:h,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(s)})]},`z-${v}`)})]})]})}function yt(){const{navigationState:t,updateNavigationState:o}=se(),[l,n]=S.useState(t.deathLocationState?.selectedCamp||"Tous les camps"),{data:r}=xe(),{data:c}=ae(),p=ye(),g=S.useMemo(()=>c?ge(c):[],[c]),b=S.useMemo(()=>g.filter(u=>u!=="VOTED"),[g]);S.useEffect(()=>{!t.deathLocationState?.selectedDeathTypes&&g.length>0&&o({deathLocationState:{selectedCamp:l,selectedDeathTypes:b}})},[g,b,t.deathLocationState,l,o]);const i=S.useMemo(()=>{const u={};g.forEach(x=>{x===X.BY_WOLF?u[x]=p.Loup:x===X.VOTED?u[x]="var(--chart-color-1)":x===X.BULLET||x===X.BULLET_HUMAN||x===X.BULLET_WOLF?u[x]=p.Chasseur:x===X.BY_ZOMBIE?u[x]=p.Vaudou:x===X.ASSASSIN?u[x]=p.Alchimiste:x===X.AVENGER?u[x]="var(--chart-color-2)":x===X.LOVER_DEATH?u[x]=p.Amoureux:x===X.BY_BEAST?u[x]="var(--chart-color-3)":x===X.SHERIF_SUCCESS&&(u[x]="var(--chart-color-4)")});const d=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let M=0;return g.forEach(x=>{u[x]||(u[x]=d[M%d.length],M++)}),u},[g,p]),m=u=>{n(u),o({deathLocationState:{selectedCamp:u}})};return e.jsxs("div",{className:"lycans-general-stats",children:[e.jsx("h2",{children:"ðŸ—ºï¸ Carte de Chaleur des Morts"}),e.jsx("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select",value:l,onChange:u=>m(u.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"},"tous"),r?.filter(u=>u!=="Tous les camps").map(u=>e.jsx("option",{value:u,children:u},u))]})]})}),e.jsx(at,{selectedCamp:l,availableDeathTypes:g,deathTypeColors:i})]})}export{yt as DeathLocationHeatmap,gt as DeathLocationHeatmapCanvas};
