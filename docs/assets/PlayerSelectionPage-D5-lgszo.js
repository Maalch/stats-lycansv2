import{a as xe,r as D,g as ie,f as Ie,u as de,j as e,d as fe,h as We,e as qe,v as Ee}from"./index-B6-ZDmny.js";import{u as ue}from"./useJoueursData-Bma9qUaM.js";import{u as Ce}from"./baseStatsHook-BoH0PwNm.js";import{g as Ve}from"./gameUtils-rkfcKAVy.js";import{a as ke,g as pe,c as Ae,b as Ge}from"./datasyncExport-BirWLS1z.js";import{u as ve,g as Be,b as me,l as Oe,C as ce,f as Se}from"./api-ma3lPlZA.js";import{f as oe,d as Ke}from"./durationFormatters-C9UyWcKX.js";import{F as U,C as Y,X as J,Y as Q}from"./FullscreenChart-DU237GTc.js";import{R as H,T as _,a as te}from"./CategoricalChart-CtlM5tN3.js";import{L as He,a as _e}from"./LineChart-aFy48A9O.js";import{B as ee,a as K}from"./BarChart-DhWC9GbS.js";import{P as Re,a as Me}from"./PieChart--SjUlvcg.js";import{g as ge}from"./deathTypes-gHH1w6_X.js";import{i as we,g as Ne,V as Ue,a as Ye}from"./roleUtils-g252S1-m.js";import{i as Je,c as Qe}from"./wolfTransformUtils-DiCKErCz.js";import{L as ze}from"./Legend-BxAVHn1W.js";import{S as Xe,R as le,e as Ze,f as et,h as ye,a as tt,b as st,d as rt}from"./deathLocationUtils-Dcm5i-bv.js";import{a as at,u as it}from"./useClips-DWOzVqRH.js";import{C as nt,f as Pe,a as ot}from"./ClipViewer-DiCLgqCl.js";import"./ActivePoints-BFYiwfah.js";import"./PolarChart-CeeyPTVW.js";import"./CartesianScaleHelper-B5QcuZLv.js";function lt(r){const{settings:h}=xe(),{joueursData:x}=ue(),[v,j]=D.useState(null),[n,p]=D.useState(!1),[u,c]=D.useState(null);D.useEffect(()=>{let l=!0;return(async()=>{try{p(!0),c(null);const o=h.dataSource==="discord"?"/data/discord/playerRankings.json":"/data/playerRankings.json",s=await fetch(o);if(!s.ok)throw new Error(`Failed to load Rankings: ${s.status} ${s.statusText}`);const i=await s.json();l&&j(i)}catch(o){l&&c(o instanceof Error?o.message:"Failed to load Rankings")}finally{l&&p(!1)}})(),()=>{l=!1}},[h.dataSource]);const m=(()=>{if(!r||!v)return null;const a=x?.Players?.find(o=>o.Joueur===r)?.SteamID;return a&&v.Rankings[a]||null})();return D.useEffect(()=>{r&&v&&x&&x.Players?.find(o=>o.Joueur===r)?.SteamID},[r,v,x,h.dataSource]),{data:m,isLoading:n,error:u,metadata:{generatedAt:v?.generatedAt||null,totalPlayers:v?.totalPlayers||0,totalGames:v?.totalGames||0,totalModdedGames:v?.totalModdedGames||0}}}function ct(r,h,x){if(!r||r.trim()===""||h.length===0)return null;const v=[];let j=r;h.forEach(a=>{const o=a.PlayerStats.find(s=>ie(s)===r||s.Username.toLowerCase()===r.toLowerCase());if(o){j=o.Username;const s=o.MainRoleInitial==="Louveteau"?o.MainRoleInitial:ke(o.MainRoleInitial,o.MainRoleChanges||[]),i=pe(s);if(x&&x!=="Tous les camps"&&i!==x)return;const g=Ve(a),d=o.Victorious,b=Ie(new Date(a.StartDate)),w=Ae(a.StartDate,a.EndDate)||0;v.push({gameId:a.Id,date:b,camp:i,won:d,winnerCamp:g,playersInGame:a.PlayerStats.length,mapName:a.MapName,duration:w})}}),v.sort((a,o)=>{const s=i=>{const g=i.split("/");return g.length===3?new Date(parseInt(g[2]),parseInt(g[1])-1,parseInt(g[0])):new Date(i)};return s(o.date).getTime()-s(a.date).getTime()});const n=v.length,p=v.filter(a=>a.won).length,u=n>0?(p/n*100).toFixed(2):"0.00",c={};v.forEach(a=>{c[a.camp]||(c[a.camp]={appearances:0,wins:0,winRate:"0.00"}),c[a.camp].appearances++,a.won&&c[a.camp].wins++}),Object.keys(c).forEach(a=>{const o=c[a];o.winRate=o.appearances>0?(o.wins/o.appearances*100).toFixed(2):"0.00"});const m={};v.forEach(a=>{m[a.mapName]||(m[a.mapName]={appearances:0,wins:0,winRate:"0.00"}),m[a.mapName].appearances++,a.won&&m[a.mapName].wins++}),Object.keys(m).forEach(a=>{const o=m[a];o.winRate=o.appearances>0?(o.wins/o.appearances*100).toFixed(2):"0.00"});const l=v.reduce((a,o)=>a+o.duration,0);return{playerName:j,totalGames:n,totalWins:p,winRate:u,totalPlayTime:l,games:v,campStats:c,mapStats:m}}function je(r,h){const{data:x,isLoading:v,error:j}=Ce(n=>r?ct(r,n,h):null);return{data:x,isLoading:v,error:j}}function dt(r){const{settings:h}=xe(),[x,v]=D.useState(null),[j,n]=D.useState(null),[p,u]=D.useState(!0),[c,m]=D.useState(null);return D.useEffect(()=>{(async()=>{u(!0),m(null);try{const a=h.dataSource==="discord"?"/data/discord/playerTitles.json":"/data/playerTitles.json",o=await fetch(a);if(!o.ok){if(o.status===404)v(null),n(null),m("Les titres n'ont pas encore Ã©tÃ© gÃ©nÃ©rÃ©s. Ils seront disponibles aprÃ¨s la prochaine synchronisation hebdomadaire.");else throw new Error(`HTTP error! status: ${o.status}`);return}const s=await o.json();if(v(s),r&&s.players){const i=Object.entries(s.players).find(([g,d])=>d.playerName===r);n(i?i[1]:null)}else n(null)}catch(a){console.error("Error loading player titles:",a),m(a instanceof Error?a.message:"Erreur inconnue"),v(null),n(null)}finally{u(!1)}})()},[h.dataSource,r]),{data:x,playerData:j,isLoading:p,error:c}}function ut({rankings:r,title:h,emptyMessage:x,rankingType:v="all"}){const{navigateToTab:j,updateNavigationState:n,clearNavigation:p}=de(),{settings:u,updateSettings:c}=xe(),{joueursData:m}=ue(),l=ve(m),a=(t,A)=>{if(A.stopPropagation(),!t.redirectTo)return;p();const L=u.highlightedPlayer;if(c(v==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:L,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:L,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const y=u.highlightedPlayer||"",C=o(t.description,y);C&&n({playerComparisonState:{selectedPlayer1:y,selectedPlayer2:C,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const y=t.description.toLowerCase().includes("loup");n({selectedPairingTab:y?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const y=t.description.match(/(Villageois|Loups|Autres)/i);y&&n({deathStatsSelectedCamp:y[1]});let C=10;const f=t.description.match(/min\.\s*(\d+)/);f&&(C=parseInt(f[1],10));let P="totalKills",S="killers";const T=t.redirectTo.chartSection;T&&(T==="killers-total"?(P="totalKills",S="killers"):T==="killers-average"?(P="averageKills",S="killers"):T==="deaths-total"?(P="totalDeaths",S="deaths"):T==="survivors-average"?(P="survivalRate",S="deaths"):(T==="hunters-good"||T==="hunters-bad")&&(S="hunter",P="averageKills")),n({deathStatisticsState:{selectedCamp:y?.[1]||"Tous les camps",minGamesForAverage:C,selectedView:S,focusChart:P}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const y=t.redirectTo.mapFilter||"all";let C=10;const f=t.description.match(/min\.\s*(\d+)/);f&&(C=parseInt(f[1])),c(v==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:y,playerFilter:{mode:"none",players:[]},highlightedPlayer:L,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:y,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:y,playerFilter:{mode:"none",players:[]},highlightedPlayer:L,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:y,playerFilter:{mode:"none",players:[]}}}),n({playersGeneralState:{minGamesForWinRate:C,winRateOrder:"best",focusChart:"winRate"}}),j("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&n({selectedPlayerName:u.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let y="wins";const C=t.title.toLowerCase(),f=t.description.toLowerCase();C.includes("dÃ©faite")||f.includes("dÃ©faite")?y="losses":C.includes("loup")||f.includes("loup")?y="loup":C.includes("villageois")||f.includes("villageois")?y="villageois":(C.includes("victoire")||f.includes("victoire"))&&(y="wins"),n({selectedSeriesType:y})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let y=10;const C=t.description.match(/min\.\s*(\d+)/);C&&(y=parseInt(C[1],10));let f="winRate",P="best";const S=t.title.toLowerCase(),T=t.description.toLowerCase();S.includes("participation")||T.includes("participation")?f="participation":(S.includes("taux de victoire")||T.includes("taux de victoire"))&&(f="winRate",(S.includes("moins bon")||S.includes("mauvais")||T.includes("moins bon")||T.includes("mauvais"))&&(P="worst")),n({playersGeneralState:{minGamesForWinRate:y,winRateOrder:P,focusChart:f}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const y=t.redirectTo.chartSection;let C="Villageois",f=1;y&&(y==="camp-loup"?C="Loup":y==="camp-villageois"?C="Villageois":y==="camp-idiot"?C="Idiot du Village":y==="camp-amoureux"?C="Amoureux":(y==="solo-roles"||y==="hall-of-fame")&&(C="Villageois"));const P=t.description.match(/min\.\s*(\d+)/);P&&(f=parseInt(P[1],10)),y==="solo-roles"?C="RÃ´les spÃ©ciaux":y==="hall-of-fame"&&(C="Tous les camps"),n({campPerformanceState:{selectedCampPerformanceCamp:C,selectedCampPerformanceMinGames:f,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const y=t.title.toLowerCase();let C="overview",f="behavior";y.includes("agressivitÃ©")?(C="overview",f="behavior"):y.includes("taux de vote")?(C="behavior",f="voteRate"):y.includes("prÃ©cision")&&(C="overview",f="accuracy"),n({votingStatsState:{selectedCategory:C,selectedView:f}})}if(t.category==="loot"&&t.redirectTo.subTab==="lootStats"){const y=t.redirectTo,C=y.minGames||5,f=y.view||"normalized";n({lootStatsState:{minGames:C,campFilter:"all",view:f}})}j(t.redirectTo.tab,t.redirectTo.subTab)},o=(t,A)=>{const L=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const y of L){const C=t.match(y);if(C&&C[1]){const f=C[1].trim();if(f!==A)return f}}return null},s=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const y=t.description.match(/min\.\s*(\d+)/),C=y?parseInt(y[1],10):10,f=t.title.toLowerCase(),P=v==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return f.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${C} parties)${P}`:f.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${P}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${P}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const y=t.redirectTo.mapFilter,C=y==="village"?"Village":y==="chateau"?"ChÃ¢teau":"map",f=v==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${C}${f}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${o(t.description,u.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const y=t.description.match(/(Villageois|Loups|Autres)/i),C=t.description.match(/min\.\s*(\d+)/),f=C?parseInt(C[1],10):10,P=y?.[1]||"Tous les camps",S=t.redirectTo.chartSection;let T="kills et morts";return S==="killers-total"?T="total des kills":S==="killers-average"?T=`moyenne des kills (min. ${f} parties)`:S==="deaths-total"?T="total des morts":S==="survivors-average"&&(T=`taux de survie (min. ${f} parties)`),`Cliquez pour voir les statistiques de ${T} ${P!=="Tous les camps"?`en ${P}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const y=t.title.toLowerCase(),C=t.description.toLowerCase();return y.includes("dÃ©faite")||C.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":y.includes("loup")||C.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":y.includes("villageois")||C.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":y.includes("victoire")||C.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const y=t.redirectTo.chartSection,C=v==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return y==="camp-loup"?`Cliquez pour voir les performances camp Loup${C}`:y==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${C}`:y==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${C}`:y==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${C}`:y==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${C}`:y==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${C}`:`Cliquez pour voir les performances par camp${C}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const y=t.description.match(/min\.\s*(\d+)/),C=y?parseInt(y[1],10):25,f=v==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",P=t.title.toLowerCase();return P.includes("agressivitÃ©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${C} meetings)${f}`:P.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${C} meetings)${f}`:P.includes("prÃ©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${f}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${f}`}break;case"loot":if(t.redirectTo.subTab==="lootStats"){const y=t.description.match(/min\.\s*(\d+)/),C=y?parseInt(y[1],10):25,f=v==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de rÃ©colte (min. ${C} parties)${f}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(v==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},i=t=>l[t]||Be(t),g=t=>{const A=[/avec ([^:]+?):/,/contre ([^:]+?):/];let L=t;return A.forEach(y=>{const C=t.match(y);if(C&&C[1]){const f=C[1].trim(),S=`<span class="player-name-highlight" style="color: ${i(f)};">${f}</span>`;L=L.replace(f,S)}}),L};if(r.length===0)return e.jsxs("div",{className:"rankings-empty",children:[e.jsx("h4",{children:h}),e.jsx("p",{children:x||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const d=t=>t===1?"ðŸ¥‡":t===2?"ðŸ¥ˆ":t===3?"ðŸ¥‰":"",b=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",w=(t,A)=>{if(!t||t<=3||!A)return;const L=t-3,y=A-3;return y<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(L-1)/(y-1))}, 70%, 50%)`},$=(t,A)=>{if(!t||!A)return;if(A<=1)return"hsl(0, 70%, 50%)";const L=(t-1)/(A-1),y=L*15,C=50-L*15;return`hsl(${y}, 70%, ${C}%)`},k=t=>{if(!t)return;const A=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(A){const[,L,y]=A;return`hsl(${L}, ${y}%, 40%)`}return t},M=r.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,A)=>(t.rank??999)-(A.rank??999)),F=r.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,A)=>(t.rank??999)-(A.rank??999)),q=r.filter(t=>t.category==="comparison"),z=[...M,...F].sort((t,A)=>(t.rank??999)-(A.rank??999)),G=M.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"rankings-container",children:[e.jsx("h4",{children:h}),G>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:M.filter(t=>t.rank&&t.rank<=3).map((t,A)=>e.jsxs("div",{className:`top3-card ${b(t.rank)} animate-slide-in`,style:{animationDelay:`${A*.15}s`},onClick:L=>a(t,L),title:s(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:d(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-ranking-title",children:t.title}),e.jsx("p",{className:"top3-ranking-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},t.id))})]}),z.length>0&&e.jsxs("div",{className:"rankings-section unified-rankings",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"rankings-grid",children:z.filter(t=>t.type==="bad"?!0:!t.rank||t.rank>3).map((t,A)=>{const L=t.type==="bad",y=L?$(t.rank,t.totalRanked):w(t.rank,t.totalRanked),C=k(y),f=L?"":b(t.rank);return e.jsxs("div",{className:`ranking-card ${L?"bad":"good"} ${f}`,onClick:P=>a(t,P),title:s(t),style:{animationDelay:`${A*.05}s`,borderLeftColor:C,borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"ranking-header",children:[e.jsxs("span",{className:"ranking-title",children:[L&&"ðŸ’€ ",t.title]}),e.jsxs("span",{className:"ranking-rank",style:y?{backgroundColor:y}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"ranking-description",children:t.description})]},t.id)})})]}),q.length>0&&e.jsxs("div",{className:"rankings-section comparison-rankings",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques CoÃ©quipiers et Face-Ã -Face"}),e.jsx("div",{className:"rankings-grid",children:q.map(t=>e.jsxs("div",{className:"ranking-card comparison",onClick:A=>a(t,A),title:s(t),children:[e.jsx("div",{className:"ranking-header",children:e.jsx("span",{className:"ranking-title",children:t.title})}),e.jsx("p",{className:"ranking-description",dangerouslySetInnerHTML:{__html:g(t.description)}})]},t.id))})]})]})}function mt({selectedPlayerName:r,groupingMethod:h,campFilter:x="all"}){const{navigateToGameDetails:v}=de(),{data:j,isLoading:n,error:p}=je(r),u=D.useMemo(()=>{switch(h){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[h]),c=D.useMemo(()=>{if(!j?.games)return new Map;const o=new Map;return j.games.forEach(s=>{if(!o.has(s.date)){const i=s.date.split("/");i.length===3?o.set(s.date,new Date(parseInt(i[2]),parseInt(i[1])-1,parseInt(i[0])).getTime()):o.set(s.date,new Date(s.date).getTime())}}),o},[j?.games]),m=D.useMemo(()=>{if(!j?.games)return[];const o={};return j.games.forEach(s=>{if(x!=="all"){if(x==="solo"){if(s.camp==="Villageois"||s.camp==="Loup")return}else if(s.camp!==x)return}let i;const g=s.date.split("/");if(h==="month")if(g.length===3)i=`${g[1].padStart(2,"0")}/${g[2]}`;else{const d=new Date(s.date);i=`${String(d.getMonth()+1).padStart(2,"0")}/${d.getFullYear()}`}else if(h==="quarter")if(g.length===3){const d=parseInt(g[1],10);i=`T${Math.floor((d-1)/3)+1}/${g[2]}`}else{const d=new Date(s.date);i=`T${Math.floor(d.getMonth()/3)+1}/${d.getFullYear()}`}else h==="year"?g.length===3?i=`${g[2]}`:i=`${new Date(s.date).getFullYear()}`:i=s.date;o[i]||(o[i]={games:[],wins:0,total:0}),o[i].games.push(s),o[i].total++,s.won&&o[i].wins++}),Object.entries(o).map(([s,i])=>({period:s,totalGames:i.total,victories:i.wins,defeats:i.total-i.wins,winRate:i.total>0?(i.wins/i.total*100).toFixed(1):"0.0",winRateNum:i.total>0?i.wins/i.total*100:0})).sort((s,i)=>{if(h==="month"){const[g,d]=s.period.split("/"),[b,w]=i.period.split("/"),$=new Date(parseInt(d),parseInt(g)-1,1),k=new Date(parseInt(w),parseInt(b)-1,1);return $.getTime()-k.getTime()}else if(h==="quarter"){const[g,d]=s.period.split("/"),[b,w]=i.period.split("/"),$=parseInt(g.replace(/\D/g,""),10)||1,k=parseInt(b.replace(/\D/g,""),10)||1,M=new Date(parseInt(d,10),($-1)*3,1),F=new Date(parseInt(w,10),(k-1)*3,1);return M.getTime()-F.getTime()}else if(h==="year"){const g=parseInt(s.period,10),d=parseInt(i.period,10);return g-d}else{const g=c.get(s.period)||0,d=c.get(i.period)||0;return g-d}})},[j,h,c,x]),a=(o=>o<=15?{fontSize:12,angle:-45,height:80,interval:0}:o<=30?{fontSize:12,angle:-45,height:85,interval:1}:o<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(o/12)})(m.length);return n?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):p?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",p]}):j?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",u]}),e.jsx(U,{title:`Ã‰volution des Performances ${u}`,children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(He,{data:m,margin:{top:20,right:30,left:20,bottom:20},onClick:o=>{if(o&&o.activeLabel){const s=m.find(i=>i.period===o.activeLabel);s&&v({selectedPlayer:r,selectedDate:s.period,fromComponent:`Ã‰volution des Performances ${u}`})}},style:{cursor:"pointer"},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"period",angle:a.angle,textAnchor:"end",height:a.height,interval:a.interval,fontSize:a.fontSize,tick:({x:o,y:s,payload:i})=>e.jsx("text",{x:o,y:s,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:a.fontSize,fontStyle:"italic",transform:`rotate(${a.angle} ${o} ${s})`,children:i.value})}),e.jsx(Q,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(_,{content:({active:o,payload:s})=>{if(o&&s&&s.length>0){const i=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:i.period})}),e.jsxs("div",{children:["Parties: ",i.totalGames]}),e.jsxs("div",{children:["Victoires: ",i.victories]}),e.jsxs("div",{children:["Taux: ",i.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(_e,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",u]}),e.jsx(U,{title:`RÃ©partition Victoires/DÃ©faites ${u}`,children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:m,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"period",angle:a.angle,textAnchor:"end",height:a.height,interval:a.interval,fontSize:a.fontSize,tick:({x:o,y:s,payload:i})=>e.jsx("text",{x:o,y:s,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:a.fontSize,fontStyle:"italic",transform:`rotate(${a.angle} ${o} ${s})`,children:i.value})}),e.jsx(Q,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(_,{content:({active:o,payload:s})=>{if(o&&s&&s.length>0){const i=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:i.period})}),e.jsxs("div",{children:["Total: ",i.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",i.victories]}),e.jsxs("div",{children:["DÃ©faites: ",i.defeats]}),e.jsxs("div",{children:["Taux: ",i.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(K,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",shape:o=>{const{x:s,y:i,width:g,height:d,payload:b}=o,w=b;return e.jsx(te,{x:s,y:i,width:g,height:d,fill:"var(--accent-tertiary)",onClick:()=>{v({selectedPlayer:r,selectedDate:w.period,fromComponent:`Historique Joueur - Victoires ${u}`})},style:{cursor:"pointer"}})}}),e.jsx(K,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",shape:o=>{const{x:s,y:i,width:g,height:d,payload:b}=o,w=b;return e.jsx(te,{x:s,y:i,width:g,height:d,fill:"var(--chart-color-4)",onClick:()=>{v({selectedPlayer:r,selectedDate:w.period,fromComponent:`Historique Joueur - DÃ©faites ${u}`})},style:{cursor:"pointer"}})}})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function ht({selectedPlayerName:r}){const{navigateToGameDetails:h}=de(),{data:x,isLoading:v,error:j}=je(r),n=me(),p=l=>{if(l.name==="Autres"){const a=l._details?.map(o=>o.name)||[];h({selectedPlayer:r,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:a},fromComponent:"Distribution par Camps"})}else l.name==="TraÃ®tre"||l.name==="Louveteau"?h({selectedPlayer:r,campFilter:{selectedCamp:l.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):l.name==="Loup"?h({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):h({selectedPlayer:r,campFilter:{selectedCamp:l.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},u=D.useMemo(()=>x?.campStats?Object.entries(x.campStats).map(([l,a])=>({name:l,value:a.appearances,winRate:a.winRate,winRateDisplay:Math.max(parseFloat(a.winRate),1),wins:a.wins,percentage:(a.appearances/x.totalGames*100).toFixed(1)})):[],[x]),c=D.useMemo(()=>{if(!u.length)return[];const l=5;let a=0;const o=[],s=[];if(u.forEach(i=>{parseFloat(i.percentage)<l?(a+=Number(i.value),o.push(i)):s.push(i)}),a>0){const i=u.reduce((g,d)=>g+Number(d.value),0);s.push({name:"Autres",value:a,winRate:"0.0",winRateDisplay:1,wins:o.reduce((g,d)=>g+d.wins,0),percentage:(a/i*100).toFixed(1),_details:o})}return s},[u]),m=D.useMemo(()=>c.map((l,a)=>({...l,fill:l.name==="Autres"?Oe:n[l.name]||`var(--chart-color-${a%6+1})`})),[c,n]);return v?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):j?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",j]}):x?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(Re,{children:[e.jsx(Me,{data:m,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:l=>{const a=l.percent!==void 0?l.percent:0;return l.name==="Autres"?`Autres : ${l.value} (${(a*100).toFixed(1)}%)`:`${l.name}: ${l.value} (${(a*100).toFixed(1)}%)`},onClick:l=>p(l)}),e.jsx(_,{content:({active:l,payload:a})=>{if(l&&a&&a.length>0){const o=a[0].payload;if(o.name==="Autres"&&o._details){const s=[...o._details].sort((i,g)=>g.value-i.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",o.value," parties (",o.percentage,"%)"]})}),e.jsx("div",{children:s.map((i,g)=>e.jsxs("div",{children:[i.name,": ",i.value," parties (",i.percentage,"%)"]},g))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[o.name," - ",o.value," parties (",o.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(U,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:u,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14,tick:({x:l,y:a,payload:o})=>e.jsx("text",{x:l,y:a,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:14,fontStyle:"italic",transform:`rotate(-45 ${l} ${a})`,children:o.value})}),e.jsx(Q,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(_,{content:({active:l,payload:a})=>{if(l&&a&&a.length>0){const o=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:o.name})}),e.jsxs("div",{children:["Victoires: ",o.wins," / ",o.value]}),e.jsxs("div",{children:["Taux: ",o.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(K,{dataKey:"winRateDisplay",shape:l=>{const{x:a,y:o,width:s,height:i,payload:g,index:d}=l,b=g,w=n[b.name]||`var(--chart-color-${(d??0)%6+1})`,$=parseFloat(b.winRate)===0?`${w}50`:w;return e.jsx(te,{x:a,y:o,width:s,height:i,fill:$,onClick:()=>{b.name==="TraÃ®tre"||b.name==="Louveteau"?h({selectedPlayer:r,campFilter:{selectedCamp:b.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):b.name==="Loup"?h({selectedPlayer:r,campFilter:{selectedCamp:b.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):h({selectedPlayer:r,campFilter:{selectedCamp:b.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}})}})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function pt({selectedPlayerName:r}){const{gameData:h}=fe(),{joueursData:x}=ue(),v=ve(x),j=me(),n=D.useMemo(()=>{if(!h||!r)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const u={},c={},m={},l=new Set;h.forEach(g=>{const d=g.PlayerStats.find(b=>b.Username.toLowerCase()===r.toLowerCase());if(d&&(g.PlayerStats.forEach(b=>{b.KillerName?.toLowerCase()===r.toLowerCase()&&(u[b.Username]=(u[b.Username]||0)+1)}),d.KillerName&&(c[d.KillerName]=(c[d.KillerName]||0)+1),d.DeathType)){const b=d.DeathType,w=ge(b);m[w]||(m[w]={count:0,byDeathType:{}}),m[w].count+=1,m[w].byDeathType[b]=(m[w].byDeathType[b]||0)+1,l.add(b)}});const a=Object.entries(u).map(([g,d])=>({player:g,kills:d})).sort((g,d)=>d.kills-g.kills).slice(0,ce.TOP_10),o=Object.entries(c).map(([g,d])=>({player:g,kills:d})).sort((g,d)=>d.kills-g.kills).slice(0,ce.TOP_10),s=Object.entries(m).map(([g,d])=>{const b={deathType:g,count:d.count};return b[g]=d.count,b}).sort((g,d)=>d.count-g.count).slice(0,ce.TOP_10),i=Object.keys(m);return{playersKilled:a,killedBy:o,deathTypes:s,availableDeathTypes:i}},[h,r]),p=D.useMemo(()=>{const u={};n.availableDeathTypes.forEach(l=>{l==="TuÃ© par Loup"?u[l]=j.Loup:l==="Mort aux votes"?u[l]="var(--chart-color-1)":l.includes("Chasseur")?u[l]=j.Chasseur:l==="TuÃ© par Zombie"?u[l]=j.Vaudou:l==="TuÃ© par potion assassin"?u[l]=j.Alchimiste:l==="TuÃ© par Vengeur"?u[l]="var(--chart-color-2)":l==="Amoureux mort"?u[l]=j.Amoureux:l==="TuÃ© par La BÃªte"?u[l]="var(--chart-color-3)":l==="TuÃ© par ShÃ©rif"&&(u[l]="var(--chart-color-4)")});const c=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let m=0;return n.availableDeathTypes.forEach(l=>{u[l]||(u[l]=c[m%c.length],m++)}),u},[n.availableDeathTypes,j]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[n.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(U,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14,tick:({x:u,y:c,payload:m})=>e.jsx("text",{x:u,y:c,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:14,fontStyle:"italic",transform:`rotate(-45 ${u} ${c})`,children:m.value})}),e.jsx(Q,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(_,{content:({active:u,payload:c})=>{if(u&&c&&c.length>0){const m=c[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.player})}),e.jsxs("div",{children:["TuÃ© ",m.kills," fois par ",r]})]})}return null}}),e.jsx(K,{dataKey:"kills",shape:u=>{const{x:c,y:m,width:l,height:a,payload:o}=u,i=v[o.player]||"var(--chart-color-3)";return e.jsx(te,{x:c,y:m,width:l,height:a,fill:i})}})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[r," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),n.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(U,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14,tick:({x:u,y:c,payload:m})=>e.jsx("text",{x:u,y:c,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:14,fontStyle:"italic",transform:`rotate(-45 ${u} ${c})`,children:m.value})}),e.jsx(Q,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(_,{content:({active:u,payload:c})=>{if(u&&c&&c.length>0){const m=c[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.player})}),e.jsxs("div",{children:["A tuÃ© ",r," ",m.kills," fois"]})]})}return null}}),e.jsx(K,{dataKey:"kills",shape:u=>{const{x:c,y:m,width:l,height:a,payload:o}=u,i=v[o.player]||"var(--chart-color-4)";return e.jsx(te,{x:c,y:m,width:l,height:a,fill:i})}})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[r," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),n.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(U,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12,tick:({x:u,y:c,payload:m})=>e.jsx("text",{x:u,y:c,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,fontStyle:"italic",transform:`rotate(-45 ${u} ${c})`,children:m.value})}),e.jsx(Q,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(_,{content:({active:u,payload:c})=>{if(u&&c&&c.length>0){const m=c[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.deathType})}),e.jsxs("div",{children:[r," est mort ",m.count," fois ainsi"]})]})}return null}}),n.availableDeathTypes.map(u=>e.jsx(K,{dataKey:u,name:u,stackId:"deaths",fill:p[u]||"var(--chart-color-5)"},u))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",r,"."]})]})]})}function gt(r,h){if(!r||r.trim()===""||h.length===0)return null;const x=new Map,v=new Map,j=new Map;h.forEach(m=>{if(!m.Modded)return;const l=m.PlayerStats.find(a=>ie(a)===r||a.Username.toLowerCase()===r.toLowerCase());if(l){if(l.MainRoleInitial==="Inconnu")return;const a=l.Victorious,s=ke(l.MainRoleInitial,l.MainRoleChanges||[])!==l.MainRoleInitial,i=pe(l.MainRoleInitial),g=i==="Loup"||i==="TraÃ®tre"||i==="Louveteau";if(i==="Villageois"&&we(l)){const d=Ne(l);if(d&&Ue.includes(d)){const b=x.get(d)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};x.set(d,{appearances:b.appearances+1,wins:b.wins+(a?1:0),winsWithoutRoleChange:b.winsWithoutRoleChange+(!s&&a?1:0),gamesWithoutRoleChange:b.gamesWithoutRoleChange+(s?0:1)})}}else if(l.Power&&l.Power.trim()!==""&&l.Power!=="Inconnu"){if(i==="Villageois"){const d=x.get(l.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};x.set(l.Power,{appearances:d.appearances+1,wins:d.wins+(a?1:0),winsWithoutRoleChange:d.winsWithoutRoleChange+(!s&&a?1:0),gamesWithoutRoleChange:d.gamesWithoutRoleChange+(s?0:1)})}else if(g){const d=v.get(l.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},b=d.roleBreakdown;b.set(l.MainRoleInitial,(b.get(l.MainRoleInitial)||0)+1),v.set(l.Power,{appearances:d.appearances+1,wins:d.wins+(a?1:0),winsWithoutRoleChange:d.winsWithoutRoleChange+(!s&&a?1:0),gamesWithoutRoleChange:d.gamesWithoutRoleChange+(s?0:1),roleBreakdown:b})}}else if((i==="Villageois"||g)&&l.Power!=="Inconnu")if(i==="Villageois"){const d=x.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};x.set("Aucun pouvoir",{appearances:d.appearances+1,wins:d.wins+(a?1:0),winsWithoutRoleChange:d.winsWithoutRoleChange+(!s&&a?1:0),gamesWithoutRoleChange:d.gamesWithoutRoleChange+(s?0:1)})}else{const d=v.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},b=d.roleBreakdown;b.set(l.MainRoleInitial,(b.get(l.MainRoleInitial)||0)+1),v.set("Aucun pouvoir",{appearances:d.appearances+1,wins:d.wins+(a?1:0),winsWithoutRoleChange:d.winsWithoutRoleChange+(!s&&a?1:0),gamesWithoutRoleChange:d.gamesWithoutRoleChange+(s?0:1),roleBreakdown:b})}if(l.SecondaryRole&&l.SecondaryRole.trim()!==""&&l.SecondaryRole!=="Inconnu"){const d=j.get(l.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};j.set(l.SecondaryRole,{appearances:d.appearances+1,wins:d.wins+(a?1:0),winsWithoutRoleChange:d.winsWithoutRoleChange+(!s&&a?1:0),gamesWithoutRoleChange:d.gamesWithoutRoleChange+(s?0:1)})}}});const n=new Map;h.forEach(m=>{const l=m.PlayerStats.find(a=>ie(a)===r||a.Username.toLowerCase()===r.toLowerCase());if(l&&we(l)){const a=Ne(l);a&&n.set(a,(n.get(a)||0)+1)}});const p=m=>Array.from(m.entries()).map(([l,a])=>({name:l,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...n.has(l)&&{totalGamesAllModes:n.get(l)}})).sort((l,a)=>a.appearances-l.appearances),u=m=>Array.from(m.entries()).map(([l,a])=>({name:l,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(a.roleBreakdown.entries()).map(([o,s])=>({role:o,count:s})).sort((o,s)=>s.count-o.count)})).sort((l,a)=>a.appearances-l.appearances),c=m=>Array.from(m.entries()).map(([l,a])=>({name:l,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((l,a)=>a.appearances-l.appearances);return{villageoisPowers:p(x),loupPowers:u(v),secondaryRoles:c(j)}}function xt({selectedPlayerName:r}){const{navigateToGameDetails:h,navigationState:x,updateNavigationState:v}=de(),j=me(),[n,p]=D.useState(x.playerHistoryRolesState?.chartMode||"appearances"),{data:u,isLoading:c,error:m}=Ce(w=>gt(r,w));D.useEffect(()=>{(!x.playerHistoryRolesState||x.playerHistoryRolesState.chartMode!==n)&&v({playerHistoryRolesState:{chartMode:n}})},[n,x.playerHistoryRolesState,v]);const l=w=>{p(w),v({playerHistoryRolesState:{chartMode:w}})},a=D.useCallback(w=>{if(!u)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const $=1,k=1,M=n==="winRate"?(z,G)=>parseFloat(G.winRate)-parseFloat(z.winRate):(z,G)=>G.appearances-z.appearances,F=z=>({...z,winRateDisplay:Math.max(parseFloat(z.winRate),1)}),q=z=>w===null?z:z.slice(0,w);return{villageoisPowers:q(u.villageoisPowers.filter(z=>z.appearances>=$).map(F).sort(M)),loupPowers:q(u.loupPowers.filter(z=>z.appearances>=$).map(F).sort(M)),secondaryRoles:q(u.secondaryRoles.filter(z=>z.appearances>=k).map(F).sort(M))}},[u,n]),o=D.useMemo(()=>a(15),[a]);if(c)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(m)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",m]});if(!u)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const s=o.villageoisPowers.length>0,i=o.loupPowers.length>0,g=o.secondaryRoles.length>0;if(!s&&!i&&!g)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const d=({active:w,payload:$})=>{if(w&&$&&$.length>0){const k=$[0].payload,M=k.gamesWithoutRoleChange<k.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:k.name})}),e.jsxs("div",{children:["Apparitions: ",k.appearances]}),M&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",k.appearances-k.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",k.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",k.winRate,"%"]})}),k.totalGamesAllModes&&k.totalGamesAllModes!==k.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",k.totalGamesAllModes,")"]}),k.roleBreakdown&&k.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),k.roleBreakdown.map((F,q)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",F.role,": ",F.count]},q))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},b=(w,$,k,M,F)=>{const q=n==="appearances"?"appearances":"winRateDisplay",z=n==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",G=n==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:$}),e.jsx(U,{title:$,children:t=>{const L=a(t?null:15)[w];return e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:L,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14,tick:({x:y,y:C,payload:f})=>e.jsx("text",{x:y,y:C,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:14,fontStyle:"italic",transform:`rotate(-45 ${y} ${C})`,children:f.value})}),e.jsx(Q,{label:{value:z,angle:270,position:"left",style:{textAnchor:"middle"}},domain:G}),e.jsx(_,{content:e.jsx(d,{})}),e.jsx(K,{dataKey:q,label:n==="winRate"?y=>{const{x:C,y:f,width:P,payload:S}=y;if(C===void 0||f===void 0||P===void 0||!S)return null;const T=S.winRate||"0";return e.jsxs("text",{x:C+P/2,y:f-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[T,"%"]})}:void 0,shape:y=>{const{x:C,y:f,width:P,height:S,payload:T,index:R}=y,I=T,V=F?F(I.name,R??0):k;return e.jsx(te,{x:C,y:f,width:P,height:S,fill:V,onClick:()=>M(I.name),style:{cursor:"pointer"}})}})]})})})}})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:n,onChange:w=>l(w.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[s&&b("villageoisPowers","Camp Villageois","var(--chart-color-1)",w=>{h({selectedPlayer:r,campFilter:{selectedCamp:"Villageois",campFilterMode:n==="winRate"?"wins-only":"all-assignments"},selectedPower:w,fromComponent:`Historique des RÃ´les - Pouvoir: ${w}`})},w=>w==="Chasseur"&&j.Chasseur?j.Chasseur:w==="Alchimiste"&&j.Alchimiste?j.Alchimiste:w==="Protecteur"&&j.Protecteur?j.Protecteur:w==="Disciple"&&j.Disciple?j.Disciple:w==="Inquisiteur"&&j.Inquisiteur?j.Inquisiteur:"var(--chart-color-1)"),i&&b("loupPowers","Camp Loups","var(--chart-color-2)",w=>{h({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:n==="winRate"?"wins-only":"all-assignments"},selectedPower:w,fromComponent:`Historique des RÃ´les - Pouvoir: ${w}`})},()=>j.Loup||"var(--chart-color-2)"),g&&b("secondaryRoles","RÃ´les Secondaires","var(--chart-color-3)",w=>{h({selectedPlayer:r,selectedSecondaryRole:w,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${w}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}const Te=["UseGadget","DrinkPotion"],yt={UseGadget:"Utilisation Gadget",DrinkPotion:"Potion bue"},ft={UseGadget:"var(--chart-color-1, #8884d8)",DrinkPotion:"var(--chart-color-3, #ffc658)"};function vt({selectedPlayerName:r}){const{gameData:h}=fe(),x=D.useMemo(()=>{if(!h||!r)return{actionTypeCounts:[],gadgetDetails:[],potionDetails:[],totalGamesWithActions:0,totalGamesPlayed:0};const j={UseGadget:0,DrinkPotion:0},n={},p={};let u=0,c=0;h.forEach(o=>{const s=o.PlayerStats.find(d=>d.Username.toLowerCase()===r.toLowerCase());if(!s)return;c++;let i=!1;(s.Actions||[]).forEach(d=>{const b=d.ActionType;Te.includes(b)&&(j[b]++,i=!0,b==="UseGadget"&&d.ActionName&&d.ActionName!=="Balle"&&(n[d.ActionName]=(n[d.ActionName]||0)+1),b==="DrinkPotion"&&d.ActionName&&(p[d.ActionName]=(p[d.ActionName]||0)+1))}),i&&u++});const m=Te.filter(o=>j[o]>0).map(o=>({actionType:o,label:yt[o],count:j[o],color:ft[o]})).sort((o,s)=>s.count-o.count),l=Object.entries(n).map(([o,s])=>({gadgetName:o,count:s})).sort((o,s)=>s.count-o.count).slice(0,ce.TOP_10),a=Object.entries(p).map(([o,s])=>({potionName:o,count:s})).sort((o,s)=>s.count-o.count).slice(0,ce.TOP_10);return{actionTypeCounts:m,gadgetDetails:l,potionDetails:a,totalGamesWithActions:u,totalGamesPlayed:c}},[h,r]);return x.actionTypeCounts.length>0?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",style:{width:"100%",flexBasis:"100%"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ® Parties avec actions"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:x.totalGamesWithActions}),e.jsxs("p",{children:["sur ",x.totalGamesPlayed," parties analysÃ©es"]})]}),x.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ”§ Gadgets utilisÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:x.gadgetDetails.reduce((j,n)=>j+n.count,0)}),e.jsxs("p",{children:[x.gadgetDetails.length," types diffÃ©rents"]})]}),x.potionDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ§ª Potions bues"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:x.potionDetails.reduce((j,n)=>j+n.count,0)}),e.jsxs("p",{children:[x.potionDetails.length," types diffÃ©rents"]})]})]}),x.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Gadgets UtilisÃ©s"}),e.jsx(U,{title:"Gadgets UtilisÃ©s",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:x.gadgetDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"gadgetName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12,tick:({x:j,y:n,payload:p})=>e.jsx("text",{x:j,y:n,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,fontStyle:"italic",transform:`rotate(-45 ${j} ${n})`,children:p.value})}),e.jsx(Q,{label:{value:"Utilisations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(_,{content:({active:j,payload:n})=>{if(j&&n&&n.length>0){const p=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:p.gadgetName})}),e.jsxs("div",{children:["UtilisÃ© ",p.count," fois"]})]})}return null}}),e.jsx(K,{dataKey:"count",fill:"var(--chart-color-1)",shape:j=>{const{x:n,y:p,width:u,height:c,index:m}=j,l=`hsl(${200+(m??0)*20}, 70%, 50%)`;return e.jsx(te,{x:n,y:p,width:u,height:c,fill:l})}})]})})})})]}),x.potionDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Potions Bues"}),e.jsx(U,{title:"Potions Bues",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:x.potionDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"potionName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12,tick:({x:j,y:n,payload:p})=>e.jsx("text",{x:j,y:n,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,fontStyle:"italic",transform:`rotate(-45 ${j} ${n})`,children:p.value})}),e.jsx(Q,{label:{value:"Consommations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(_,{content:({active:j,payload:n})=>{if(j&&n&&n.length>0){const p=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:p.potionName})}),e.jsxs("div",{children:["Bue ",p.count," fois"]})]})}return null}}),e.jsx(K,{dataKey:"count",fill:"var(--chart-color-3)",shape:j=>{const{x:n,y:p,width:u,height:c,index:m}=j,l=`hsl(${40+(m??0)*15}, 80%, 55%)`;return e.jsx(te,{x:n,y:p,width:u,height:c,fill:l})}})]})})})})]})]}):e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune donnÃ©e d'actions disponible pour ",r,"."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es d'actions (gadgets, potions) ne sont disponibles que pour les parties rÃ©centes."})]})}function jt({selectedPlayerName:r}){const{gameData:h}=fe(),{joueursData:x}=ue(),v=me(),j=ve(x),n=D.useMemo(()=>{if(!h||!r)return{hunterTargets:[],hunterMissedShots:0,hunterTotalShots:0,transformCount:0,untransformCount:0,transformationsPerGame:0,totalGamesWithActions:0,totalGamesPlayed:0,totalNightsAsWolf:0,transformsPerNight:0};const u={};let c=0,m=0,l=0,a=0,o=0,s=0;h.forEach(k=>{const M=k.PlayerStats.find(t=>t.Username.toLowerCase()===r.toLowerCase());if(!M)return;o++;let F=!1;const q=k.Modded&&We(k.Version||"0","0.243");let z=!1;if(q)z=!0;else{const A=(M.Actions||[]).some(y=>y.ActionType==="Transform"||y.ActionType==="Untransform"),L=M.LegacyActionsIncomplete===!0;z=A&&!L}if(Je(M.MainRoleInitial)&&z){const t=Qe(M.DeathTiming,k.EndTiming);s+=t}(M.Actions||[]).forEach(t=>{t.ActionType==="HunterShoot"?(l++,F=!0,t.ActionTarget&&(u[t.ActionTarget]=(u[t.ActionTarget]||0)+1)):t.ActionType==="Transform"?(c++,F=!0):t.ActionType==="Untransform"&&(m++,F=!0)}),F&&a++});const i=Object.entries(u).map(([k,M])=>({target:k,count:M})).sort((k,M)=>M.count-k.count).slice(0,ce.TOP_10),g=Object.values(u).reduce((k,M)=>k+M,0),d=l-g,b=c>0?Math.max(1,h.filter(k=>{const M=k.PlayerStats.find(q=>q.Username.toLowerCase()===r.toLowerCase());return M?(M.Actions||[]).some(q=>q.ActionType==="Transform"):!1}).length):0,w=b>0?c/b:0,$=s>0?c/s:0;return{hunterTargets:i,hunterMissedShots:d,hunterTotalShots:l,transformCount:c,untransformCount:m,transformationsPerGame:w,totalGamesWithActions:a,totalGamesPlayed:o,totalNightsAsWolf:s,transformsPerNight:$}},[h,r]);return n.hunterTotalShots>0||n.transformCount>0||n.untransformCount>0?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[n.hunterTotalShots>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Statistiques du Chasseur"}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"âœ… Tirs rÃ©ussis"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:v.Chasseur||"var(--chart-color-2)"},children:n.hunterTotalShots-n.hunterMissedShots}),e.jsx("p",{children:"cibles touchÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"âŒ Tirs manquÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--text-secondary)"},children:n.hunterMissedShots}),e.jsx("p",{children:"tirs sans cible"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š PrÃ©cision"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:v.Chasseur||"var(--chart-color-2)"},children:[n.hunterTotalShots>0?((n.hunterTotalShots-n.hunterMissedShots)/n.hunterTotalShots*100).toFixed(1):"0","%"]}),e.jsx("p",{children:"taux de rÃ©ussite"})]})]}),n.hunterTargets.length>0&&e.jsx(U,{title:"Cibles Ã‰liminÃ©es par le Chasseur",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n.hunterTargets,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"target",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12,tick:({x:u,y:c,payload:m})=>e.jsx("text",{x:u,y:c,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,fontStyle:"italic",transform:`rotate(-45 ${u} ${c})`,children:m.value})}),e.jsx(Q,{label:{value:"Nombre de tirs",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(_,{content:({active:u,payload:c})=>{if(u&&c&&c.length>0){const m=c[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.target})}),e.jsxs("div",{children:["TuÃ© par le chasseur ",m.count," fois"]})]})}return null}}),e.jsx(K,{dataKey:"count",fill:v.Chasseur||"var(--chart-color-2)",shape:u=>{const{x:c,y:m,width:l,height:a,payload:o,index:s}=u,g=j[o.target]||v.Chasseur||`hsl(${120+(s??0)*15}, 60%, 45%)`;return e.jsx(te,{x:c,y:m,width:l,height:a,fill:g})}})]})})})})]}),(n.transformCount>0||n.untransformCount>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Habitudes de Transformation (Loup)"}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Ratio"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:(()=>{const u=n.transformCount,c=n.untransformCount;return u===0?"0%":`${(c/u*100).toFixed(0)}%`})()}),e.jsx("p",{children:"dÃ©transformations / transformations"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŒ™ Nuits totales"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:n.totalNightsAsWolf}),e.jsx("p",{children:"nuits vÃ©cues en loup (opportunitÃ©s)"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¯ Ratio / nuit"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:v.Loup||"var(--wolf-color)"},children:n.transformsPerNight.toFixed(2)}),e.jsx("p",{children:"transformations par nuit vÃ©cue"})]})]}),e.jsx(U,{title:"Statistiques de Transformation",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:[{name:"Statistiques Loup","Nuits vÃ©cues":n.totalNightsAsWolf,Transformations:n.transformCount,DÃ©transformations:n.untransformCount}],margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(Y,{strokeDasharray:"3 3"}),e.jsx(J,{dataKey:"name",fontSize:14}),e.jsx(Q,{label:{value:"Compte",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(_,{content:({active:u,payload:c})=>!u||!c||c.length===0?null:e.jsx("div",{className:"custom-tooltip",style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border-primary)",borderRadius:"4px",padding:"10px"},children:c.map((m,l)=>e.jsxs("div",{style:{color:m.color,marginBottom:"4px"},children:[e.jsxs("strong",{children:[m.name,":"]})," ",m.value]},l))})}),e.jsx(ze,{}),e.jsx(K,{dataKey:"Nuits vÃ©cues",fill:"var(--chart-color-4, #a4de6c)"}),e.jsx(K,{dataKey:"Transformations",fill:v.Loup||"var(--wolf-color)"}),e.jsx(K,{dataKey:"DÃ©transformations",fill:"var(--accent-secondary)"})]})})})})]})]}):e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune donnÃ©e d'actions de rÃ´le disponible pour ",r,"."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es d'actions de rÃ´le (Chasseur, Loup) ne sont disponibles que pour les parties rÃ©centes."})]})}function bt({viewMode:r,setViewMode:h,selectedMap:x,setSelectedMap:v,availableMaps:j,clusterRadius:n,setClusterRadius:p,availableDeathTypes:u,selectedDeathTypes:c,setSelectedDeathTypes:m,deathTypeColors:l,isDeathTypesExpanded:a,setIsDeathTypesExpanded:o}){return e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>h("deaths"),style:{background:r==="deaths"?"var(--accent-primary)":"transparent",color:r==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"ðŸ’€ Morts"}),e.jsx("button",{type:"button",onClick:()=>h("kills"),style:{background:r==="kills"?"var(--accent-primary)":"transparent",color:r==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="kills"?"bold":"normal",transition:"all 0.2s"},children:"âš”ï¸ Kills"}),e.jsx("button",{type:"button",onClick:()=>h("transformations"),style:{background:r==="transformations"?"var(--accent-primary)":"transparent",color:r==="transformations"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="transformations"?"bold":"normal",transition:"all 0.2s"},children:"ðŸº Transfos"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:x,onChange:s=>v(s.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:j.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:n,onChange:s=>p(parseInt(s.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:n===0?"Aucun":`${n} unitÃ©${n>1?"s":""}`})]}),r!=="transformations"&&e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>o(!a),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:a?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:a?"rotate(90deg)":"rotate(0deg)"},children:"â–¶"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[c.length," / ",u.length," sÃ©lectionnÃ©",c.length>1?"s":""]})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),m(u)},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),m([])},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:u.map(s=>{const i=c.includes(s),g=l[s]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",background:i?"var(--bg-tertiary)":"transparent",borderRadius:"4px",border:`1px solid ${i?g:"var(--border-color)"}`,cursor:"pointer",transition:"all 0.2s",fontSize:"0.9rem"},onClick:d=>{d.stopPropagation(),m(i?b=>b.filter(w=>w!==s):b=>[...b,s])},children:[e.jsx("input",{type:"checkbox",checked:i,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:g,flexShrink:0}}),e.jsx("span",{children:ge(s)})]},s)})})]})]})]})}function Ct({zoneAnalysis:r,selectedMap:h,viewMode:x,selectedPlayerName:v,hoveredZone:j,setHoveredZone:n}){return!r||h!=="Village"||x!=="deaths"?null:e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"0rem",padding:"1.5rem",background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",borderRadius:"12px",border:"2px solid var(--accent-primary)",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",color:"var(--accent-primary)",fontSize:"1.3rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"ðŸ“Š Analyse par zone (Village)"}),e.jsx("p",{style:{fontSize:"0.95rem",marginBottom:"1rem",color:"var(--text-secondary)",lineHeight:"1.5"},children:"Distribution des morts (selon les types sÃ©lectionnÃ©s) comparÃ©e Ã  la moyenne de tous les joueurs:"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:r.zoneStats.map(p=>{const u=p.zone===r.dominantZone&&r.maxDeviation>10;return e.jsxs("div",{onMouseEnter:()=>n(p.zone),onMouseLeave:()=>n(null),style:{padding:"1rem",background:"var(--bg-primary)",borderRadius:"8px",border:j===p.zone?"1px solid var(--accent-primary)":"1px solid var(--border-color)",color:"var(--text-primary)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.95rem"},children:p.zone}),e.jsxs("div",{style:{fontSize:"0.85rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[v,": ",e.jsxs("strong",{children:[p.playerPercent.toFixed(1),"%"]})," (",p.playerCount,")"]}),e.jsxs("div",{style:{opacity:.85},children:["Moyenne: ",p.avgPercent.toFixed(1),"%"]}),e.jsxs("div",{style:{marginTop:"0.25rem",color:u?"var(--accent-secondary)":p.deviation>0?"var(--accent-primary)":"var(--text-secondary)",fontWeight:Math.abs(p.deviation)>5?"bold":"normal"},children:[p.deviation>0?"+":"",p.deviation.toFixed(1),"% vs moyenne"]})]})]},p.zone)})}),r.dominantZone&&r.maxDeviation>10&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",fontSize:"0.95rem",color:"var(--accent-primary)",fontWeight:"bold",background:"var(--bg-primary)",borderRadius:"8px",border:"2px solid var(--accent-primary)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"âš ï¸"}),e.jsxs("span",{children:[v," meurt significativement plus souvent en zone ",r.dominantZone,"(","+"+r.maxDeviation.toFixed(1),"% par rapport Ã  la moyenne)"]})]})]})}function St({locationData:r,clusteredData:h,viewMode:x,selectedPlayerName:v,selectedMap:j,mapConfig:n,xDomain:p,zDomain:u,hoveredZone:c,getDeathColor:m,handleLocationClick:l}){const a=({active:o,payload:s})=>{if(!o||!s||s.length===0)return null;const i=s[0].payload,g=i.allLocations||[i],d=g.length>1,b=x==="transformations";if(d){const $=new Map,k=new Map,M=new Set,F=new Map;g.forEach(t=>{if($.set(t.victimName,($.get(t.victimName)||0)+1),b)F.set(t.camp,(F.get(t.camp)||0)+1);else{const A=t.deathType?ge(t.deathType):"Inconnu";k.set(A,(k.get(A)||0)+1)}M.add(t.gameId)});const q=Array.from($.entries()).sort((t,A)=>A[1]-t[1]).slice(0,3),z=Array.from(k.entries()).sort((t,A)=>A[1]-t[1]).slice(0,3),G=Array.from(F.entries()).sort((t,A)=>A[1]-t[1]);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[b?"ðŸº":x==="deaths"?"ðŸ’€":"âš”ï¸"," ",g.length," ",b?"transformations":x==="deaths"?"morts":"kills"," Ã  cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[b?e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Camps loup:"}),G.map(([t,A])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",A,"Ã—)"]},t))]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:x==="deaths"?"Victimes:":"Kills sur:"}),q.map(([t,A])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",A,"Ã—)"]},t))]}),e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Types de mort:"}),z.map(([t,A])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",A,"Ã—)"]},t))]})]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["ðŸ“ ",M.size," partie",M.size>1?"s":""," diffÃ©rente",M.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const w=g[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[b?"ðŸº":x==="deaths"?"ðŸ’€":"âš”ï¸"," ",b?"Transformation de":x==="deaths"?"Mort de":"Kill de"," ",v]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ‘¤ ",e.jsx("strong",{children:"Joueur:"})," ",w.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp loup:"})," ",w.camp]}),e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",w.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",w.gameId]})]}):x==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Victime:"})," ",w.victimName]}),e.jsxs("div",{children:["âš”ï¸ ",e.jsx("strong",{children:"Tueur:"})," ",w.killerName||"Inconnu"]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",w.deathType?ge(w.deathType):"Inconnu"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Victime:"})," ",w.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp victime:"})," ",w.camp]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",w.deathType?ge(w.deathType):"Inconnu"]})]}),!b&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",w.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",w.gameId]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})};return e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:r.length>0?e.jsx(U,{title:x==="deaths"?`Carte des Morts de ${v}`:`Carte des Kills de ${v}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(Xe,{margin:{top:20,right:30,left:60,bottom:20},children:[n&&e.jsx(le,{x1:n.zMin,x2:n.zMax,y1:n.xMin,y2:n.xMax,fill:"transparent",stroke:"none",shape:o=>{const{x:s,y:i,width:g,height:d}=o;return e.jsx("image",{x:s,y:i,width:g,height:d,href:n.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),j==="Village"&&c&&e.jsxs(e.Fragment,{children:[c==="Ruines"&&e.jsx(le,{x1:-220,x2:200,y1:100,y2:450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),c==="Village Principal"&&e.jsx(le,{x1:-250,x2:100,y1:-120,y2:-450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),c==="Ferme"&&e.jsx(le,{x1:-550,x2:-250,y1:150,y2:-150,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),c==="Village PÃªcheur"&&e.jsx(le,{x1:150,x2:500,y1:80,y2:-320,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),c==="Reste de la Carte"&&e.jsx(le,{x1:n?.zMin??-600,x2:n?.zMax??600,y1:n?.xMin??-500,y2:n?.xMax??500,fill:"var(--accent-primary)",fillOpacity:.15,stroke:"var(--accent-primary)",strokeWidth:2,strokeDasharray:"5 5"})]}),e.jsx(Y,{strokeDasharray:"3 3",stroke:n?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(J,{dataKey:"z",type:"number",name:"Position Z",domain:u,hide:!0}),e.jsx(Q,{dataKey:"x",type:"number",name:"Position X",domain:p,hide:!0}),e.jsx(_,{content:e.jsx(a,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Ze,{data:h,style:{cursor:"pointer"},isAnimationActive:!1,shape:o=>{const{cx:s,cy:i,payload:g}=o,d=g,b=Math.min(Math.log2(d.count+1)*3+5,18),w=Math.round(b);return e.jsx("circle",{cx:s,cy:i,r:w,fill:m(d.deathType,d.camp),stroke:d.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:d.count>1?2:1,opacity:.85,onClick:()=>l(d)})}})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:x==="deaths"?`Aucune mort localisÃ©e pour ${v} sur cette carte.`:x==="kills"?`Aucun kill localisÃ© pour ${v} sur cette carte.`:`Aucune transformation en loup localisÃ©e pour ${v} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes."})]})})}function De(r,h){return h>=-250&&h<=100&&r>=-450&&r<=-120?"Village Principal":h>=-550&&h<=-250&&r>=-150&&r<=150?"Ferme":h>=150&&h<=500&&r>=-320&&r<=80?"Village PÃªcheur":h>=-220&&h<=200&&r>=100&&r<=450?"Ruines":"Reste de la Carte"}function he(r){return r==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":r}function wt({selectedPlayerName:r}){const{navigateToGameDetails:h}=de(),{gameData:x,isLoading:v,error:j}=fe(),n=me(),[p,u]=D.useState("deaths"),[c,m]=D.useState(""),[l,a]=D.useState(0),[o,s]=D.useState(null),[i,g]=D.useState([]),[d,b]=D.useState(!1),{data:w}=je(r,"Tous les camps"),$=D.useMemo(()=>{if(!x)return[];const P=new Set;return x.forEach(S=>{const T=S.PlayerStats.find(R=>R.Username.toLowerCase()===r.toLowerCase());T&&(T.DeathPosition!==null&&S.MapName&&P.add(S.MapName),S.PlayerStats.forEach(R=>{R.KillerName?.toLowerCase()===r.toLowerCase()&&R.DeathPosition!==null&&S.MapName&&P.add(S.MapName)}),T.Actions&&Array.isArray(T.Actions)&&T.Actions.some(R=>R.ActionType==="Transform")&&S.MapName&&P.add(S.MapName))}),Array.from(P).filter(S=>S==="Village"||S==="ChÃ¢teau").sort((S,T)=>S==="Village"?-1:T==="Village"?1:S.localeCompare(T))},[x,r]),k=$.length>0?$[0]:"";c===""&&k!==""&&m(k);const{availableDeathTypes:M,deathTypeColors:F}=D.useMemo(()=>{if(!x||!r)return{availableDeathTypes:[],deathTypeColors:{}};const P=new Set,S={};return x.forEach(T=>{const R=T.PlayerStats.find(I=>I.Username.toLowerCase()===r.toLowerCase());if(R){if(R.DeathPosition&&R.DeathType){const I=he(R.DeathType);I&&P.add(I)}T.PlayerStats.forEach(I=>{if(I.KillerName?.toLowerCase()===r.toLowerCase()&&I.DeathPosition&&I.DeathType){const V=he(I.DeathType);V&&P.add(V)}})}}),P.forEach(T=>{S[T]=et(T,n)}),{availableDeathTypes:Array.from(P).sort(),deathTypeColors:S}},[x,r,n]),q=(P,S)=>p==="transformations"&&S?n[S]||"var(--text-secondary)":P&&F[P]||"var(--text-secondary)";D.useEffect(()=>{if(i.length===0&&M.length>0){const P=M.filter(S=>S!=="VOTED");g(P)}},[M.length]);const z=D.useMemo(()=>{if(!x||!r)return[];const P=[];return x.forEach(S=>{if(c&&S.MapName!==c)return;const T=S.PlayerStats.find(R=>R.Username.toLowerCase()===r.toLowerCase());if(T)if(p==="deaths"){if(T.DeathPosition){const R=pe(T.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),I=ye(T.DeathPosition.x,T.DeathPosition.z,S.MapName);P.push({x:I.x,z:I.z,victimName:T.Username,killerName:T.KillerName||null,deathType:he(T.DeathType),mapName:S.MapName,camp:R,gameId:S.DisplayedId,displayedGameId:S.DisplayedId})}}else p==="kills"?S.PlayerStats.forEach(R=>{if(R.KillerName?.toLowerCase()===r.toLowerCase()&&R.DeathPosition){const I=pe(R.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),V=ye(R.DeathPosition.x,R.DeathPosition.z,S.MapName);P.push({x:V.x,z:V.z,victimName:R.Username,killerName:r,deathType:he(R.DeathType),mapName:S.MapName,camp:I,gameId:S.DisplayedId,displayedGameId:S.DisplayedId})}}):p==="transformations"&&T.Actions&&Array.isArray(T.Actions)&&T.Actions.forEach(R=>{if(R.ActionType==="Transform"&&R.Position){const I=pe(T.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),V=ye(R.Position.x,R.Position.z,S.MapName);P.push({x:V.x,z:V.z,victimName:T.Username,killerName:null,deathType:null,mapName:S.MapName,camp:I,gameId:S.DisplayedId,displayedGameId:S.DisplayedId})}})}),p!=="transformations"&&i.length>0&&i.length<M.length?P.filter(S=>S.deathType&&i.includes(S.deathType)):P},[x,r,p,c,i,M]),G=D.useMemo(()=>{if(c!=="Village"||p!=="deaths"||z.length===0)return null;const P={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};if(z.forEach(E=>{const O=De(E.x,E.z);P[O]=(P[O]||0)+1}),!x)return null;const S={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};x.forEach(E=>{E.MapName==="Village"&&E.PlayerStats.forEach(O=>{if(!O.DeathPosition)return;const N=he(O.DeathType);if(i.length>0&&i.length<M.length&&(!N||!i.includes(N)))return;const W=ye(O.DeathPosition.x,O.DeathPosition.z,"Village"),Z=De(W.x,W.z);S[Z]=(S[Z]||0)+1})});const T=Object.values(S).reduce((E,O)=>E+O,0),R=Object.values(P).reduce((E,O)=>E+O,0);if(T===0||R===0)return null;const I=["Village Principal","Village PÃªcheur","Ferme","Ruines","Reste de la Carte"];let V=0,X=null;const se=I.map(E=>{const O=P[E]/R*100,N=S[E]/T*100,W=O-N;return W>V&&P[E]>=2&&(V=W,X=E),{zone:E,playerCount:P[E],playerPercent:O,avgPercent:N,deviation:W}});return{totalPlayerDeaths:R,totalAllDeaths:T,zoneStats:se,dominantZone:X,maxDeviation:V}},[z,c,p,x,i,M]),t=D.useMemo(()=>tt(z,l).map((S,T)=>{const R=S.items[0],I=st(S.items);return{x:S.centroidX,z:S.centroidZ,count:S.items.length,allLocations:S.items,victimName:S.items.length===1?R.victimName:null,killerName:S.items.length===1?R.killerName:null,deathType:I,mapName:R.mapName,camp:R.camp,gameId:S.items.length===1?R.gameId:null,displayedGameId:S.items.length===1?R.displayedGameId:null,clusterIndex:T}}),[z,l]),A=D.useMemo(()=>rt(c),[c]),{xDomain:L,zDomain:y}=D.useMemo(()=>{if(A)return{xDomain:[A.xMin,A.xMax],zDomain:[A.zMin,A.zMax]};if(t.length===0)return{xDomain:[0,100],zDomain:[0,100]};const P=t.map(E=>E.x),S=t.map(E=>E.z),T=Math.min(...P),R=Math.max(...P),I=Math.min(...S),V=Math.max(...S),X=(R-T)*.1||10,se=(V-I)*.1||10;return{xDomain:[T-X,R+X],zDomain:[I-se,V+se]}},[t,A]),C=P=>{if(!P)return;const S=P.allLocations||[P];if(S.length===1)h({selectedGame:S[0].gameId,fromComponent:"Player Death Map"});else{const T=S.map(R=>R.gameId).filter(R=>R);h({selectedGameIds:T,fromComponent:"Player Death Map"})}},f=D.useMemo(()=>{if(!w?.mapStats||!c)return null;const P=w.mapStats[c];return P?{winRate:P.winRate,wins:P.wins,total:P.appearances}:null},[w,c]);return v?e.jsx("div",{className:"donnees-attente",children:"Chargement des donnÃ©es..."}):j?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",j]}):x?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsx(bt,{viewMode:p,setViewMode:u,selectedMap:c,setSelectedMap:m,availableMaps:$,clusterRadius:l,setClusterRadius:a,availableDeathTypes:M,selectedDeathTypes:i,setSelectedDeathTypes:g,deathTypeColors:F,isDeathTypesExpanded:d,setIsDeathTypesExpanded:b}),e.jsx(St,{locationData:z,clusteredData:t,viewMode:p,selectedPlayerName:r,selectedMap:c,mapConfig:A,xDomain:L,zDomain:y,hoveredZone:o,getDeathColor:q,handleLocationClick:C}),e.jsx(Ct,{zoneAnalysis:G,selectedMap:c,viewMode:p,selectedPlayerName:r,hoveredZone:o,setHoveredZone:s}),f&&e.jsxs("div",{style:{flex:"1 1 100%",textAlign:"center",padding:"0.75rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)",marginTop:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginRight:"1rem"},children:["Taux de victoire sur ",e.jsx("strong",{children:c})," :"]}),e.jsxs("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:parseFloat(f.winRate)>=50?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[f.winRate,"%"]}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["(",f.wins," / ",f.total," victoires)"]})]}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"Ã€ propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",p==="deaths"?`les emplacements oÃ¹ ${r} est mort`:p==="kills"?`les emplacements oÃ¹ ${r} a Ã©liminÃ© d'autres joueurs`:`les emplacements oÃ¹ ${r} s'est transformÃ© en loup`," au cours des parties.",p!=="transformations"&&"Les couleurs indiquent le type de mort."," Cliquez sur un point pour voir les dÃ©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroupÃ©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’€ Morts:"})," OÃ¹ le joueur a Ã©tÃ© Ã©liminÃ©",e.jsx("br",{}),e.jsx("strong",{children:"âš”ï¸ Kills:"})," OÃ¹ le joueur a Ã©liminÃ© d'autres joueurs",e.jsx("br",{}),e.jsx("strong",{children:"ðŸº Transformations:"})," OÃ¹ le joueur s'est transformÃ© en loup"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function Fe(r){return r.PlayerStats.some(h=>h.SecondsTalkedOutsideMeeting>0||h.SecondsTalkedDuringMeeting>0)}function be(r,h){const x=h.DeathDateIrl||r.EndDate,v=Ae(r.StartDate,x);return v&&v>0?v:0}function Nt(r){const h=r.filter(Fe),x=new Map;return h.forEach(v=>{v.PlayerStats.forEach(j=>{const n=ie(j),p=qe(j),u=be(v,j);if(u<=0)return;x.has(n)||x.set(n,{displayName:p,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const c=x.get(n);c.gamesPlayed++,c.totalSecondsAll+=(j.SecondsTalkedOutsideMeeting||0)+(j.SecondsTalkedDuringMeeting||0),c.totalGameDuration+=u})}),{playerStats:x,gamesWithTalkingData:h.length}}function Pt(r,h){if(!h||h.length===0||!r)return null;const x=Nt(h),v=h.filter(Fe);if(v.length===0||x.playerStats.size===0)return null;let j=null;for(const[C,f]of x.playerStats)if(f.displayName===r){j=C;break}if(!j)return null;let n=0,p=0,u=0,c=0;const m={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},l=new Map;let a=0,o=0,s=0,i=0;if(v.forEach(C=>{const f=C.PlayerStats.find(se=>ie(se)===j);if(!f)return;const P=be(C,f);if(P<=0)return;n++;const S=f.SecondsTalkedOutsideMeeting||0,T=f.SecondsTalkedDuringMeeting||0,R=S+T;p+=S,u+=T,c+=P;const I=Ge(f.MainRoleInitial,f.Power);m[I].gamesPlayed++,m[I].secondsOutside+=S,m[I].secondsDuring+=T,m[I].gameDuration+=P;const V=Ye(f);l.has(V)||l.set(V,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const X=l.get(V);X.gamesPlayed++,X.totalSecondsAll+=R,X.totalGameDuration+=P}),n===0||c<=0)return null;const g=3600/c,d=p*g,b=u*g,w=(p+u)*g,$=p+u>0?u/(p+u)*100:0,k=[];for(const[C,f]of Object.entries(m)){if(f.gamesPlayed===0)continue;const P=f.gameDuration>0?3600/f.gameDuration:0,S=f.secondsOutside+f.secondsDuring;k.push({camp:C,gamesPlayed:f.gamesPlayed,totalSecondsOutside:f.secondsOutside,totalSecondsDuring:f.secondsDuring,totalSecondsAll:S,totalGameDurationSeconds:f.gameDuration,secondsOutsidePer60Min:f.secondsOutside*P,secondsDuringPer60Min:f.secondsDuring*P,secondsAllPer60Min:S*P,meetingRatio:S>0?f.secondsDuring/S*100:0})}k.sort((C,f)=>f.gamesPlayed-C.gamesPlayed);const M=Array.from(l.entries()).filter(([C,f])=>f.gamesPlayed>=1).map(([C,f])=>({role:C,gamesPlayed:f.gamesPlayed,secondsAllPer60Min:f.totalGameDuration>0?f.totalSecondsAll/f.totalGameDuration*3600:0,totalSecondsAll:f.totalSecondsAll})).sort((C,f)=>f.secondsAllPer60Min-C.secondsAllPer60Min),F=[];for(const[C,f]of x.playerStats)f.totalGameDuration>0&&F.push({id:C,name:f.displayName,per60:f.totalSecondsAll/f.totalGameDuration*3600});F.sort((C,f)=>f.per60-C.per60);const q=F.reduce((C,f)=>C+f.per60,0),z=F.length>0?q/F.length:0,G=F.findIndex(C=>C.id===j)+1,t=F.length,A=t>0?Math.round((1-(G-1)/t)*100):0,L=w;v.forEach(C=>{const f=C.PlayerStats.find(R=>ie(R)===j);if(!f)return;const P=be(C,f);if(P<=0)return;((f.SecondsTalkedOutsideMeeting||0)+(f.SecondsTalkedDuringMeeting||0))/P*3600>=L?(a++,f.Victorious&&o++):(s++,f.Victorious&&i++)});const y={gamesAboveAverage:a,winsAboveAverage:o,winRateAboveAverage:a>0?o/a*100:0,gamesBelowAverage:s,winsBelowAverage:i,winRateBelowAverage:s>0?i/s*100:0};return{playerName:r,gamesPlayed:n,gamesWithTalkingData:x.gamesWithTalkingData,totalSecondsOutside:p,totalSecondsDuring:u,totalSecondsAll:p+u,totalGameDurationSeconds:c,secondsOutsidePer60Min:d,secondsDuringPer60Min:b,secondsAllPer60Min:w,meetingRatio:$,campBreakdown:k,globalAverageSecondsAllPer60Min:z,playerRank:G,totalPlayersWithData:t,percentile:A,roleBreakdown:M,winCorrelation:y}}function Tt(r,h){return r?r.roleBreakdown.slice(0,h):[]}function Dt(r){const{data:h,isLoading:x,error:v}=Ce(j=>r?Pt(r,j):null);return{data:h,isLoading:x,error:v}}function kt({selectedPlayerName:r}){const{data:h,isLoading:x,error:v}=Dt(r),j=me(),[n,p]=D.useState("both"),u=D.useMemo(()=>h?.campBreakdown?h.campBreakdown.map(s=>({camp:s.camp,"Hors rÃ©union":Math.round(s.secondsOutsidePer60Min),"En rÃ©union":Math.round(s.secondsDuringPer60Min),total:Math.round(s.secondsAllPer60Min),gamesPlayed:s.gamesPlayed,meetingRatio:s.meetingRatio.toFixed(1)})):[],[h]),c=D.useMemo(()=>h?[{name:"En rÃ©union",value:h.totalSecondsDuring,fill:"#2196F3"},{name:"Hors rÃ©union",value:h.totalSecondsOutside,fill:"#FF9800"}]:[],[h]);if(x)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(v)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",v]});if(!h)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de temps de parole ne sont disponibles que pour les parties rÃ©centes."})]});const m=h.secondsAllPer60Min-h.globalAverageSecondsAllPer60Min,l=h.globalAverageSecondsAllPer60Min>0?(m/h.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",a=m>0,o=h.winCorrelation.winRateAboveAverage-h.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¤ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:oe(h.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:a?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[a?"+":"",l,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",h.playerRank," / ",h.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-h.percentile+1,"% ",h.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“ˆ Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:h.gamesPlayed}),e.jsxs("p",{children:["sur ",h.gamesWithTalkingData," avec donnÃ©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ—£ï¸ Ratio en rÃ©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[h.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),u.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(U,{title:"Temps de parole par camp (par 60min de jeu)",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>p("meeting"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:n==="meeting"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:n==="meeting"?"var(--accent-primary)":"var(--bg-secondary)",color:n==="meeting"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:n==="meeting"?"bold":"normal"},children:"En rÃ©union"}),e.jsx("button",{onClick:()=>p("outside"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:n==="outside"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:n==="outside"?"var(--accent-primary)":"var(--bg-secondary)",color:n==="outside"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:n==="outside"?"bold":"normal"},children:"Hors rÃ©union"}),e.jsx("button",{onClick:()=>p("both"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:n==="both"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:n==="both"?"var(--accent-primary)":"var(--bg-secondary)",color:n==="both"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:n==="both"?"bold":"normal"},children:"Les deux"})]}),e.jsx("div",{style:{height:350},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:u,layout:"vertical",children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(J,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:s=>`${Math.floor(s/60)}m`}),e.jsx(Q,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(_,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(s,i)=>{const g=typeof s=="number"?s:Number(s);return[Number.isNaN(g)?`${s}`:oe(g),i]},labelFormatter:s=>{const i=u.find(g=>g.camp===s);return`${s} (${i?.gamesPlayed||0} parties)`}}),e.jsx(ze,{}),(n==="both"||n==="outside")&&e.jsx(K,{dataKey:"Hors rÃ©union",stackId:"talk",fill:"#FF9800"}),(n==="both"||n==="meeting")&&e.jsx(K,{dataKey:"En rÃ©union",stackId:"talk",fill:"#2196F3"})]})})})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:(()=>{const s=u.find(b=>b.camp==="Villageois"),i=u.find(b=>b.camp==="Loup");if(!s||!i)return e.jsx("p",{children:"ðŸ’¡ Pas assez de donnÃ©es pour comparer les camps Villageois et Loups."});const g=s.total-i.total,d=i.total>0?(Math.abs(g)/i.total*100).toFixed(0):"0";return g>0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:Se("Villageois")},children:[oe(g)," de plus (+",d,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Villageois"})," qu'en tant que"," ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]}):g<0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:Se("Loup")},children:[oe(Math.abs(g))," de plus (+",d,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Loup"})," qu'en tant que"," ",e.jsx("strong",{children:"Villageois"})," (par heure de jeu)."]}):e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle exactement autant en tant que"," ",e.jsx("strong",{children:"Villageois"})," qu'en tant que ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(U,{title:"RÃ©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(Re,{children:[e.jsx(Me,{data:c,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:s=>`${s.name}: ${((s.percent||0)*100).toFixed(1)}%`}),e.jsx(_,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:s=>{const i=typeof s=="number"?s:Number(s);return Number.isNaN(i)?`${s}`:oe(i)}})]})})})})}),h&&h.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(U,{title:s=>s?"Top 15 rÃ´les les plus bavards (par 60min)":"Top 5 rÃ´les les plus bavards (par 60min)",children:s=>{const g=Tt(h,s?15:5).map(d=>({role:d.role,secondsPer60Min:Math.round(d.secondsAllPer60Min),gamesPlayed:d.gamesPlayed}));return e.jsx("div",{style:{height:s?400:300},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(ee,{data:g,children:[e.jsx(Y,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(J,{dataKey:"role",tick:({x:d,y:b,payload:w})=>e.jsx("text",{x:d,y:b,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,fontStyle:"italic",transform:`rotate(-20 ${d} ${b})`,children:w.value}),interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(Q,{tick:{fill:"var(--text-secondary)"},tickFormatter:d=>`${Math.floor(d/60)}m`}),e.jsx(_,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:d=>{const b=typeof d=="number"?d:Number(d);return[Number.isNaN(b)?`${d}`:oe(b),"Temps de parole"]},labelFormatter:d=>{const b=g.find(w=>w.role===d);return`${d} (${b?.gamesPlayed||0} parties)`}}),e.jsx(K,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",shape:d=>{const{x:b,y:w,width:$,height:k,payload:M}=d,q=j[M.role]||j.Villageois;return e.jsx(te,{x:b,y:w,width:$,height:k,fill:q})}})]})})})}})}),(h.winCorrelation.gamesAboveAverage>0||h.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"ðŸŽ¯ CorrÃ©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[h.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",h.winCorrelation.winsAboveAverage,"/",h.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[h.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",h.winCorrelation.winsBelowAverage,"/",h.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(o)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:o>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[o>0?"supÃ©rieur":"infÃ©rieur"," de ",Math.abs(o).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function At({playerTitles:r,titlesLoading:h}){if(h)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des titres..."})]})});if(!r||r.titles.length===0)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-empty",children:[e.jsx("p",{children:"ðŸ“œ Aucun titre disponible"}),e.jsx("p",{className:"empty-subtitle",children:r?.gamesPlayed?`${r.gamesPlayed} parties jouÃ©es - minimum 25 parties requises pour obtenir des titres`:"Les titres sont gÃ©nÃ©rÃ©s chaque dimanche pour les joueurs avec 25+ parties en mode moddÃ©"})]})});const x=[...r.titles].sort((p,u)=>{const c=r.titles.indexOf(p),l=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(p.category||"")?100-(p.percentile||50):p.percentile||50,a=(p.priority||0)*1e3+l*10-c,o=r.titles.indexOf(u),i=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(u.category||"")?100-(u.percentile||50):u.percentile||50;return(u.priority||0)*1e3+i*10-o-a}),v=x.filter(p=>!p.primaryOwner),j=x.filter(p=>p.primaryOwner),n=(p,u)=>{const c=r.primaryTitle?.id===p.id;return e.jsxs("div",{className:`title-card ${p.type} ${c?"primary":""} ${p.primaryOwner?"awarded-elsewhere":""}`,title:`${p.description}${p.percentile!==void 0?`
MeilleurÂ·e que ${p.percentile.toFixed(1)}% des joueurs`:""}`,children:[e.jsx("div",{className:"title-rank",children:u+1}),c&&e.jsx("div",{className:"title-crown",children:"ðŸ‘‘"}),e.jsx("div",{className:"title-emoji",children:p.emoji}),e.jsxs("div",{className:"title-info",children:[e.jsx("div",{className:"title-name",children:p.title}),e.jsx("div",{className:"title-description",children:p.description}),p.percentile!==void 0&&p.type!=="combination"&&e.jsxs("div",{className:"title-percentile",children:["Top ",(100-p.percentile).toFixed(0),"%"]}),e.jsx("div",{className:"title-type-badge",children:p.type==="combination"?"Combo":p.type==="role"?"RÃ´le":"Stat"}),!c&&p.primaryOwner&&e.jsxs("div",{className:"title-primary-owner",children:["ðŸ‘¤ Titre principal de: ",e.jsx("strong",{children:p.primaryOwner})]}),p.type==="combination"&&p.conditions&&p.conditions.length>0&&e.jsxs("div",{className:"title-conditions-breakdown",children:[e.jsx("div",{className:"breakdown-header",children:"Conditions:"}),p.conditions.map((m,l)=>e.jsxs("div",{className:"condition-item",children:[e.jsxs("span",{className:"condition-stat",children:[m.stat==="winRate"?"Victoires":m.stat==="loot"?"RÃ©colte":m.stat==="lootVillageois"?"RÃ©colte (Villageois)":m.stat==="lootLoup"?"RÃ©colte (Loup)":m.stat==="survival"?"Survie":m.stat==="killRate"?"Kills":m.stat==="talking"?"Parole":m.stat==="talkingOutsideMeeting"?"Parole (hors dÃ©bats)":m.stat==="talkingDuringMeeting"?"Parole (meeting)":m.stat==="votingAggressive"?"Vote agressif":m.stat==="votingAccuracy"?"PrÃ©cision vote":m.stat==="votingFirst"?"Vote rapide":m.stat==="survivalDay1"?"Survie J1":m.stat==="winRateVillageois"?"Victoires Villageois":m.stat==="winRateLoup"?"Victoires Loup":m.stat==="winRateSolo"?"Victoires Solo":m.stat==="hunterAccuracy"?"PrÃ©cision cible chasseur":m.stat==="hunterShotAccuracy"?"PrÃ©cision tir chasseur":m.stat==="zoneVillagePrincipal"?"Village Principal":m.stat==="zoneFerme"?"Ferme":m.stat==="zoneVillagePecheur"?"Village PÃªcheur":m.stat==="zoneRuines"?"Ruines":m.stat==="zoneResteCarte"?"Reste de la carte":m.stat==="zoneDominantPercentage"?"Dominance zone":m.stat,":"]}),e.jsx("span",{className:`condition-category ${m.category?.toLowerCase()}`,children:m.category}),m.actualPercentile!==void 0&&e.jsxs("span",{className:"condition-percentile",children:["(Top ",(100-m.actualPercentile).toFixed(0),"%)"]})]},l))]})]})]},p.id)};return e.jsxs("div",{className:"titles-section",children:[e.jsxs("div",{className:"titles-header",children:[e.jsx("h3",{children:"ðŸ·ï¸ Titres actuels"}),e.jsxs("p",{className:"titles-info",children:[r.titles.length," titre",r.titles.length>1?"s":""," â€¢ ",r.gamesPlayed," parties jouÃ©es"]})]}),v.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"titles-subsection-header",children:[e.jsxs("h4",{children:["âœ¨ Vos Titres (",v.length,")"]}),e.jsx("p",{children:"Titres que vous possÃ©dez ou partagez"})]}),e.jsx("div",{className:"titles-grid",children:v.map((p,u)=>n(p,u))})]}),j.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"titles-subsection-header secondary",children:[e.jsxs("h4",{children:["ðŸ–ï¸ Titres QualifiÃ©s (",j.length,")"]}),e.jsx("p",{children:"Vous remplissez les conditions, mais un autre joueur a une meilleure revendication"})]}),e.jsx("div",{className:"titles-grid awarded-elsewhere-grid",children:j.map((p,u)=>n(p,v.length+u))})]})]})}function Rt(r,h){return r.map((x,v)=>{const j=v<h,n=x.stars===4;return e.jsx("span",{className:`achievement-star ${j?"unlocked":""} ${n?"lycan":""}`,title:`${n?"ðŸº Lycan":"â­".repeat(x.stars)} â€” ${x.threshold}`,children:n?"ðŸº":"â­"},x.stars)})}function Mt({achievementsWithProgress:r,playerAchievements:h,categories:x,isLoading:v}){const[j,n]=D.useState(null);if(v)return e.jsx("div",{className:"achievements-section",children:e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des succÃ¨s..."})]})});if(!r||r.length===0)return e.jsx("div",{className:"achievements-section",children:e.jsxs("div",{className:"achievements-empty",children:[e.jsx("p",{children:"ðŸ† Aucun succÃ¨s disponible"}),e.jsx("p",{className:"achievements-empty-subtitle",children:"Les succÃ¨s seront disponibles aprÃ¨s la prochaine synchronisation hebdomadaire"})]})});const p=r.reduce((s,i)=>s+i.levels.length,0),u=h?.totalUnlocked||0,c={1:0,2:0,3:0,4:0};if(h)for(const s of h.achievements)for(const i of s.unlockedLevels)c[i.stars]++;const m=D.useMemo(()=>{const s={};for(const i of r)s[i.category]||(s[i.category]={total:0,unlocked:0}),s[i.category].total++,i.playerProgress&&i.playerProgress.unlockedLevels.length>0&&s[i.category].unlocked++;return s},[r]),l=j?r.filter(s=>s.category===j):r,a=Object.entries(x).sort(([,s],[,i])=>s.order-i.order),o=D.useMemo(()=>{const s=[];for(const[i,g]of a){const d=l.filter(b=>b.category===i);d.length!==0&&(d.sort((b,w)=>{const $=b.playerProgress?b.playerProgress.unlockedLevels.length:0,k=w.playerProgress?w.playerProgress.unlockedLevels.length:0,M=$===b.levels.length?1:0,F=k===w.levels.length?1:0;if(M!==F)return F-M;if($!==k)return k-$;const q=b.playerProgress?.progress||0;return(w.playerProgress?.progress||0)-q}),s.push({key:i,label:g.label,emoji:g.emoji,items:d}))}return s},[l,a]);return e.jsxs("div",{className:"achievements-section",children:[e.jsxs("div",{className:"achievements-summary",children:[e.jsxs("div",{className:"achievements-summary-item",children:[e.jsx("span",{className:"achievements-summary-value",children:u}),e.jsxs("span",{className:"achievements-summary-label",children:["/ ",p," niveaux"]})]}),c[1]>0&&e.jsxs("div",{className:"achievements-summary-item",children:[e.jsx("span",{children:"â­"}),e.jsx("span",{className:"achievements-summary-value",children:c[1]})]}),c[2]>0&&e.jsxs("div",{className:"achievements-summary-item",children:[e.jsx("span",{children:"â­â­"}),e.jsx("span",{className:"achievements-summary-value",children:c[2]})]}),c[3]>0&&e.jsxs("div",{className:"achievements-summary-item",children:[e.jsx("span",{children:"â­â­â­"}),e.jsx("span",{className:"achievements-summary-value",children:c[3]})]}),c[4]>0&&e.jsxs("div",{className:"achievements-summary-item",children:[e.jsx("span",{children:"ðŸº"}),e.jsx("span",{className:"achievements-summary-value",children:c[4]})]})]}),e.jsxs("div",{className:"achievements-categories",children:[e.jsxs("button",{type:"button",className:`achievements-category-btn ${j===null?"active":""}`,onClick:()=>n(null),children:["Tous",e.jsxs("span",{className:"achievements-category-count",children:["(",r.length,")"]})]}),a.map(([s,i])=>{const g=m[s];return g?e.jsxs("button",{type:"button",className:`achievements-category-btn ${j===s?"active":""}`,onClick:()=>n(s),children:[i.emoji," ",i.label,e.jsxs("span",{className:"achievements-category-count",children:["(",g.unlocked,"/",g.total,")"]})]},s):null})]}),o.map(s=>e.jsxs("div",{children:[!j&&e.jsxs("div",{className:"achievements-category-header",children:[e.jsx("span",{children:s.emoji}),e.jsx("h4",{children:s.label}),e.jsxs("span",{className:"cat-count",children:["(",m[s.key]?.unlocked||0,"/",m[s.key]?.total||0,")"]})]}),e.jsx("div",{className:"achievements-grid",children:s.items.map(i=>{const g=i.playerProgress,d=g?g.unlockedLevels.length:0,b=d===i.levels.length,w=g!==null&&g.currentValue>0,$=!w;return e.jsxs("div",{className:`achievement-card ${b?"fully-unlocked":w?"has-progress":"locked"}`,title:i.explanation,children:[e.jsx("div",{className:"achievement-emoji",children:i.emoji}),e.jsxs("div",{className:"achievement-content",children:[e.jsx("h5",{className:"achievement-name",children:i.name}),e.jsx("p",{className:"achievement-description",children:i.description}),!$&&e.jsx("p",{className:"achievement-explanation",children:i.explanation}),e.jsx("div",{className:"achievement-stars",children:Rt(i.levels,d)}),w&&!b&&g&&e.jsxs("div",{className:"achievement-progress-container",children:[e.jsx("div",{className:"achievement-progress-bar",children:e.jsx("div",{className:"achievement-progress-fill",style:{width:`${Math.max(g.progress*100,2)}%`}})}),e.jsxs("div",{className:"achievement-progress-text",children:[e.jsx("span",{className:"achievement-progress-value",children:g.currentValue}),g.nextLevel&&e.jsxs("span",{children:["prochain : ",g.nextLevel.threshold]})]})]}),b&&g&&e.jsxs("div",{className:"achievement-progress-container",children:[e.jsx("div",{className:"achievement-progress-bar",children:e.jsx("div",{className:"achievement-progress-fill complete",style:{width:"100%"}})}),e.jsxs("div",{className:"achievement-progress-text",children:[e.jsx("span",{className:"achievement-progress-value",children:g.currentValue}),e.jsx("span",{children:"âœ… ComplÃ©tÃ©"})]})]})]})]},i.id)})})]},s.key))]})}function zt(r){const{settings:h}=xe(),{joueursData:x}=ue(),[v,j]=D.useState(null),[n,p]=D.useState(!0),[u,c]=D.useState(null);D.useEffect(()=>{(async()=>{p(!0),c(null);try{const o=h.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",s=await fetch(o);if(!s.ok){if(s.status===404)j(null),c("Les succÃ¨s n'ont pas encore Ã©tÃ© gÃ©nÃ©rÃ©s. Ils seront disponibles aprÃ¨s la prochaine synchronisation.");else throw new Error(`HTTP error! status: ${s.status}`);return}const i=await s.json();j(i)}catch(o){console.error("Error loading player achievements:",o),c(o instanceof Error?o.message:"Erreur inconnue"),j(null)}finally{p(!1)}})()},[h.dataSource]);const m=D.useMemo(()=>{if(!v||!r)return null;const a=Object.entries(v.players).find(([o,s])=>s.playerName===r);if(a)return a[1];if(x?.Players){const s=x.Players.find(i=>i.Joueur===r)?.SteamID;if(s&&v.players[s])return v.players[s]}return null},[v,r,x]),l=D.useMemo(()=>v?v.achievementDefinitions.map(a=>{const o=m?.achievements.find(s=>s.id===a.id)||null;return{...a,playerProgress:o}}):[],[v,m]);return{data:v,playerData:m,achievementsWithProgress:l,definitions:v?.achievementDefinitions||[],categories:v?.categories||{},isLoading:n,error:u}}function rs(){const{settings:r,updateSettings:h}=xe(),{navigateToGameDetails:x,navigationState:v,updateNavigationState:j}=de(),{data:n,isLoading:p,error:u}=Ee(),{joueursData:c,isLoading:m}=ue(),{data:l,isLoading:a,error:o}=lt(r.highlightedPlayer),{playerData:s,isLoading:i}=dt(r.highlightedPlayer),{playerData:g,achievementsWithProgress:d,categories:b,isLoading:w}=zt(r.highlightedPlayer),$=ve(c),[k,M]=D.useState(""),[F,q]=D.useState(null),{clips:z}=at(r.highlightedPlayer),{clips:G}=it(),[t,A]=D.useState(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded"?"modded":"all":r.gameFilter==="modded"?"modded":"all"),L=D.useMemo(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded":r.gameFilter==="modded",[r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter,r.gameFilter]),[y,C]=D.useState(r.selectedPlayerSelectionView||v.selectedPlayerSelectionView||"rankings"),[f,P]=D.useState("session"),[S,T]=D.useState("all");D.useEffect(()=>{if(r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled){const N=r.independentFilters.gameFilter==="modded"?"modded":"all";A(N)}else if(!r.useIndependentFilters){const N=r.gameFilter==="modded"?"modded":"all";A(N)}},[r.gameFilter,r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter]),D.useEffect(()=>{L&&t!=="modded"&&A("modded")},[L,t]),D.useEffect(()=>{const N=r.selectedPlayerSelectionView||v.selectedPlayerSelectionView;N&&N!==y&&C(N)},[r.selectedPlayerSelectionView,v.selectedPlayerSelectionView]);const{data:R}=je(r.highlightedPlayer||""),I=D.useMemo(()=>{if(!n||!n.GameStats)return[];const N=L?n.GameStats.filter(Z=>Z.Modded===!0):n.GameStats,W=new Map;return N.forEach(Z=>{const B=new Date(Z.StartDate);Z.PlayerStats.forEach(re=>{const ae=ie(re),$e=c?.Players?.find(Le=>Le.SteamID===ae)?.Joueur||re.Username;W.has(ae)||W.set(ae,{games:0,wins:0,firstDate:B,lastDate:B,displayName:$e});const ne=W.get(ae);ne.games++,re.Victorious&&ne.wins++,B<ne.firstDate&&(ne.firstDate=B),B>ne.lastDate&&(ne.lastDate=B)})}),Array.from(W.entries()).map(([Z,B])=>{let re=c?.Players?.find(ae=>ae.SteamID===Z);return re||(re=c?.Players?.find(ae=>ae.Joueur===B.displayName)),{id:Z,name:B.displayName,totalGames:B.games,totalWins:B.wins,winRate:B.games>0?B.wins/B.games*100:0,firstGameDate:B.firstDate.toLocaleDateString("fr-FR"),lastGameDate:B.lastDate.toLocaleDateString("fr-FR"),isHighlighted:B.displayName===r.highlightedPlayer,image:re?.Image||null,twitch:re?.Twitch||null,youtube:re?.Youtube||null}})},[n,r.highlightedPlayer,c,L]),V=D.useMemo(()=>{if(!k.trim())return I;const N=k.toLowerCase();return I.filter(W=>W.name.toLowerCase().includes(N))},[I,k]),X=D.useMemo(()=>[...V].sort((N,W)=>W.totalGames-N.totalGames),[V]),se=N=>{h({highlightedPlayer:N}),M("")},E=N=>{C(N),j({selectedPlayerSelectionView:N}),h({selectedPlayerSelectionView:N,tab:"playerSelection"})},O=()=>{if(z.length===0)return;const N=Math.floor(Math.random()*z.length);q(z[N])};return p||m?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):u?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",u]})]}):!n||I.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!r.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:k,onChange:N=>M(N.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[V.length," joueur",V.length!==1?"s":"",k&&` (filtrÃ©${V.length!==1?"s":""} de ${I.length})`]})]})]}),e.jsx("div",{className:"player-display",children:k?V.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>M(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:X.map(N=>e.jsxs("button",{type:"button",className:`suggestion-btn ${N.isHighlighted?"highlighted":""}`,onClick:()=>se(N.name),children:[N.image?e.jsx("img",{src:N.image,alt:`Photo de profil de ${N.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":$[N.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[N.name,N.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[N.totalGames," parties â€¢ ",N.winRate.toFixed(1),"% victoires"]})]})]},N.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',k,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>M(""),children:"Effacer la recherche"})]}):r.highlightedPlayer?(()=>{const N=I.find(W=>W.name===r.highlightedPlayer);return N?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:N.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[N.image?e.jsx("img",{src:N.image,alt:`Photo de profil de ${N.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":$[N.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[N.totalGames," parties â€¢ ",N.totalWins," victoires â€¢ ",N.winRate.toFixed(1),"% taux de victoire"]}),s?.primaryTitle?e.jsxs("div",{className:"player-primary-title",title:s.primaryTitle.description,style:{marginTop:"0.5rem",display:"inline-flex",alignItems:"center",gap:"0.3rem",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("span",{className:"title-emoji",children:s.primaryTitle.emoji}),e.jsx("span",{className:"title-text",children:s.primaryTitle.title})]}):e.jsx("div",{className:"player-no-title",style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic"},children:"ðŸ“œ 25 parties moddÃ©es minimum pour obtenir un titre"}),(N.twitch||N.youtube||z.length>0)&&e.jsxs("div",{className:"social-links",children:[N.twitch&&e.jsx("a",{href:N.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),N.youtube&&e.jsx("a",{href:N.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"}),z.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:W=>{W.stopPropagation(),O()},title:`${z.length} clip${z.length>1?"s":""} disponible${z.length>1?"s":""}`,children:["ðŸŽ¬ Clip alÃ©atoire (",z.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="rankings"?"active":""}`,onClick:()=>E("rankings"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="titles"?"active":""}`,onClick:()=>E("titles"),children:"Titres"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="evolution"?"active":""}`,onClick:()=>E("evolution"),children:"Ã‰volution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="camps"?"active":""}`,onClick:()=>E("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="roles"?"active":""}`,onClick:()=>E("roles"),children:"RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="actions"?"active":""}`,onClick:()=>E("actions"),children:"Actions"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="roleactions"?"active":""}`,onClick:()=>E("roleactions"),children:"Actions des RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="kills"?"active":""}`,onClick:()=>E("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="deathmap"?"active":""}`,onClick:()=>E("deathmap"),children:"Cartes"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${y==="talkingtime"?"active":""}`,onClick:()=>E("talkingtime"),children:"Parole"})]}),y==="rankings"&&e.jsxs("div",{className:"rankings-section",children:[a?e.jsxs("div",{className:"rankings-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):o?e.jsx("div",{className:"rankings-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",o]})}):l?e.jsx(ut,{rankings:t==="all"?l.allGamesRankings:l.moddedOnlyRankings,title:t==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",rankingType:t}):e.jsx("div",{className:"rankings-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"rankings-filter",children:[!L&&e.jsx("button",{type:"button",className:`filter-btn ${t==="all"?"active":""}`,onClick:W=>{W.stopPropagation(),A("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${t==="modded"?"active":""}`,onClick:W=>{W.stopPropagation(),A("modded")},disabled:L,children:"Parties moddÃ©es"})]})]}),y==="titles"&&e.jsx(At,{playerTitles:s,titlesLoading:i}),y==="achievements"&&e.jsx(Mt,{achievementsWithProgress:d,playerAchievements:g,categories:b,isLoading:w}),y==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[R&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{x({selectedPlayer:N.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${N.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:R.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:Ke(R.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{x({selectedPlayer:N.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${N.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:R.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[R.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:f,onChange:W=>P(W.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:S,onChange:W=>T(W.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(mt,{selectedPlayerName:N.name,groupingMethod:f,campFilter:S})]}),y==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ht,{selectedPlayerName:N.name})}),y==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(xt,{selectedPlayerName:N.name})}),y==="actions"&&e.jsx("div",{className:"player-history-section",children:e.jsx(vt,{selectedPlayerName:N.name})}),y==="roleactions"&&e.jsx("div",{className:"player-history-section",children:e.jsx(jt,{selectedPlayerName:N.name})}),y==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(pt,{selectedPlayerName:N.name})}),y==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(wt,{selectedPlayerName:N.name})}),y==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(kt,{selectedPlayerName:N.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:W=>{W.stopPropagation(),h({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[N.firstGameDate," - ",N.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',r.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>h({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:X.map(N=>e.jsxs("div",{className:`character-card ${N.isHighlighted?"highlighted":""}`,onClick:()=>se(N.name),title:`${N.name} - ${N.totalGames} parties, ${N.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:N.image?e.jsx("img",{src:N.image,alt:`Photo de profil de ${N.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":$[N.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:N.name}),(N.twitch||N.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[N.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),N.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},N.id))})})}),F&&e.jsx(nt,{clip:F,onClose:()=>q(null),relatedClips:ot(F,G),nextClip:Pe(F,G),onNextClip:()=>{const N=Pe(F,G);N&&q(N)},onRelatedClip:N=>{const W=G.find(Z=>Z.ClipId===N);W&&q(W)}})]})}export{rs as PlayerSelectionPage};
