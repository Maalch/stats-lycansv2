import{u as F,r as f,j as e}from"./index-C9Kslrj5.js";import{a as G}from"./baseStatsHook-CnAd7APY.js";import{a as w}from"./gameUtils-C0qLdSzT.js";import{a as L}from"./api-DKAYehnj.js";import{F as j,B as T,C as b,X as C,Y as V,a as N}from"./FullscreenChart-BqUdNWJg.js";import{R as S,T as k}from"./CategoricalChart-OM0ZSguQ.js";import{L as A}from"./Legend-CfEP8BBC.js";function R(r,n,a){const t=r.LegacyData?.VictoryType,o=w(r);return t&&t.trim()!==""&&o&&o.trim()!==""?(n[t]||(n[t]=0),n[t]++,a[t]||(a[t]={}),a[t][o]||(a[t][o]=0),a[t][o]++,!0):!1}function q(r){const n=new Set;return Object.values(r).forEach(a=>{Object.keys(a).forEach(t=>n.add(t))}),Array.from(n).sort()}function W(r,n,a,t,o){const d={type:r,count:n,percentage:(n/a*100).toFixed(1)},m=t[r]||{};return o.forEach(h=>{const x=m[h]||0,g=n>0?(x/n*100).toFixed(1):"0.0";d[h]=x,d[`${h}_percentage`]=g}),d}function B(r,n,a,t){const o=Object.keys(r).map(d=>W(d,r[d],n,a,t));return o.sort((d,m)=>m.count-d.count),o}function D(r){if(r.length===0)return null;const n={},a={};let t=0;r.forEach(m=>{R(m,n,a)&&t++});const o=q(a),d=B(n,t,a,o);return{totalGames:t,victoryTypes:d,winningCamps:o}}function E(){const{data:r,isLoading:n,error:a}=G(D);return{victoryTypesStats:r,isLoading:n,errorInfo:a}}function X(){const{victoryTypesStats:r,isLoading:n,errorInfo:a}=E(),{navigateToGameDetails:t}=F(),o=f.useMemo(()=>r?.victoryTypes?r.victoryTypes.map(s=>({...s,percentageNum:parseFloat(s.percentage)})):[],[r?.victoryTypes]),d=L(),{mainVictoryTypes:m,rareVictoryTypes:h}=f.useMemo(()=>{if(!o.length)return{mainVictoryTypes:[],rareVictoryTypes:[]};const s=Math.max(5,Math.ceil(o[0].count*.1)),c=o.filter(l=>l.count>=s),p=o.filter(l=>l.count<s);return{mainVictoryTypes:c,rareVictoryTypes:p}},[o]),x=n,g=a;return x?e.jsx("div",{className:"donnees-attente",children:"Chargement des types de victoire..."}):g?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]}):r?e.jsxs("div",{className:"lycans-victory-types-container",children:[e.jsx("h2",{children:"Types de Victoire"}),r&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Types Principaux"}),e.jsx("div",{className:"lycans-valeur-principale",children:m.length}),e.jsx("p",{children:"types fr√©quents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Types Sp√©ciaux"}),e.jsx("div",{className:"lycans-valeur-principale",children:h.length}),e.jsx("p",{children:"types rares"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:r?.totalGames||0}),e.jsx("p",{children:"parties analys√©es"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[m.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Victoire Principaux par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Types de victoire les plus fr√©quents (",m.reduce((s,c)=>s+c.count,0)," parties sur ",r?.totalGames,")"]}),e.jsx(j,{title:"Types de Victoire Principaux par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(T,{data:m,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"type",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:11}),e.jsx(V,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(k,{content:({active:s,payload:c,label:p})=>{if(s&&c&&c.length>0){const l=c.reduce((i,u)=>i+(u.value||0),0);let y="";return r?.totalGames&&l>0&&(y=(l/r.totalGames*100).toFixed(1)),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:300},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8},children:p}),e.jsxs("div",{style:{marginBottom:4},children:["Total: ",l," parties",y&&` (${y}%)`]}),c.filter(i=>i.value&&i.value>0).sort((i,u)=>(u.value||0)-(i.value||0)).map((i,u)=>{const v=l>0?((i.value||0)/l*100).toFixed(1):"0.0";return e.jsxs("div",{style:{marginBottom:2},children:[e.jsx("span",{style:{display:"inline-block",width:12,height:12,backgroundColor:i.color,marginRight:8,borderRadius:2}}),i.dataKey,": ",i.value," (",v,"%)"]},u)}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(A,{}),r?.winningCamps?.map((s,c)=>e.jsx(N,{dataKey:s,stackId:"victory",fill:d[s]||`var(--chart-color-${c%6+1})`,name:s,onClick:p=>{p&&p.type&&t({selectedVictoryType:p.type,fromComponent:"Types de Victoire Principaux"})},style:{cursor:"pointer"}},s))]})})})})]}),h.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Victoire Sp√©ciaux par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Types de victoire moins fr√©quents (",h.reduce((s,c)=>s+c.count,0)," parties sur ",r?.totalGames,")"]}),e.jsx(j,{title:"Types de Victoire Sp√©ciaux par Camp",children:e.jsx("div",{style:{height:500},children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(T,{data:h,margin:{top:20,right:30,left:20,bottom:120},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"type",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:10}),e.jsx(V,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"},domain:[0,"dataMax"]}),e.jsx(k,{content:({active:s,payload:c,label:p})=>{if(s&&c&&c.length>0){const l=c.reduce((i,u)=>i+(u.value||0),0);let y="";return r?.totalGames&&l>0&&(y=(l/r.totalGames*100).toFixed(1)),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:300},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8},children:p}),e.jsxs("div",{style:{marginBottom:4},children:["Total: ",l," parties",y&&` (${y}%)`]}),c.filter(i=>i.value&&i.value>0).sort((i,u)=>(u.value||0)-(i.value||0)).map((i,u)=>{const v=l>0?((i.value||0)/l*100).toFixed(1):"0.0";return e.jsxs("div",{style:{marginBottom:2},children:[e.jsx("span",{style:{display:"inline-block",width:12,height:12,backgroundColor:i.color,marginRight:8,borderRadius:2}}),i.dataKey,": ",i.value," (",v,"%)"]},u)}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(A,{}),r?.winningCamps?.map((s,c)=>e.jsx(N,{dataKey:s,stackId:"victory",fill:d[s]||`var(--chart-color-${c%6+1})`,name:s,onClick:p=>{p&&p.type&&t({selectedVictoryType:p.type,fromComponent:"Types de Victoire Sp√©ciaux"})},style:{cursor:"pointer"}},s))]})})})})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de victoire disponible"})}export{X as VictoryTypesChart};
