import{u as G,j as t}from"./index-BI7qZdO0.js";import{a as I}from"./baseStatsHook-B9JXGa7Y.js";import{c as N}from"./gameUtils-CVi7a5bf.js";import{a as C,l as R}from"./api-DmJeUsCZ.js";import{F as p,B as v,C as D,X as x,Y as f,a as j,b as A}from"./FullscreenChart-BBgP-E1r.js";import{R as y,T as g,Q as L}from"./CategoricalChart-NuGy6rbA.js";import{L as B,a as k}from"./LineChart-Q1Rv9wOI.js";import{L as T}from"./Legend-DTucce6J.js";import"./ActivePoints-DzXrIL-d.js";function d(e){const r=Math.floor(e/3600),n=Math.floor(e%3600/60),o=e%60;return r>0?`${r}h${n.toString().padStart(2,"0")}m${o.toString().padStart(2,"0")}s`:n>0?`${n}m${o.toString().padStart(2,"0")}s`:`${o}s`}function W(e,r=10){const n=Math.round(e/60);return Math.round(n/r)*r}function F(){return{averageDuration:"0s",maxDuration:0,minDuration:1/0,maxDurationGameId:null,minDurationGameId:null,durationDistribution:{},durationsByWinnerCamp:{},durationsByPlayerCount:{},durationsByWolfRatio:{}}}function P(e,r,n){e>n.maxDuration&&(n.maxDuration=e,n.maxDurationGameId=r),e<n.minDuration&&(n.minDuration=e,n.minDurationGameId=r)}function S(e,r){const n=W(e,2);r[n]||(r[n]=0),r[n]++}function V(e,r,n){e&&e.trim()!==""&&(n[e]||(n[e]={totalDuration:0,count:0,average:"0s"}),n[e].totalDuration+=r,n[e].count++)}function $(e,r,n){if(e&&!isNaN(e)&&e>0){const o=e.toString();n[o]||(n[o]={totalDuration:0,count:0,average:"0s"}),n[o].totalDuration+=r,n[o].count++}}function w(e,r,n,o){if(e&&r&&!isNaN(e)&&!isNaN(r)&&e>0){const s=e-r;if(s>0){const l=Math.round(r/s*100),a=(Math.round(l/1)*1).toString();o[a]||(o[a]={totalDuration:0,count:0,average:"0s"}),o[a].totalDuration+=n,o[a].count++}}}function q(e,r,n,o){const s=e.PlayerStats.length,l=e.PlayerStats.filter(u=>u.MainRoleInitial==="Loup").length,m=e.PlayerStats.filter(u=>u.Victorious);let a="";if(m.length>0){const u=m.map(c=>c.MainRoleInitial);if(u.includes("Loup")||u.includes("Tra√Ætre"))a="Loup";else if(u.every(c=>c==="Villageois"))a="Villageois";else{const c=u.filter(h=>!["Villageois","Loup","Tra√Ætre"].includes(h));c.length>0?a=c[0]:a="Villageois"}}const i=N(e.StartDate,e.EndDate);i&&!isNaN(i)&&i>0&&(n.gamesWithDuration++,n.totalDuration+=i,P(i,o+1,r),S(i,r.durationDistribution),V(a,i,r.durationsByWinnerCamp),$(s,i,r.durationsByPlayerCount),w(s,l,i,r.durationsByWolfRatio))}function E(e,r){if(r.gamesWithDuration>0){const n=r.totalDuration/r.gamesWithDuration;e.averageDuration=d(Math.round(n)),Object.keys(e.durationsByWinnerCamp).forEach(o=>{const s=e.durationsByWinnerCamp[o];if(s.count>0){const l=s.totalDuration/s.count;s.average=d(Math.round(l))}}),Object.keys(e.durationsByPlayerCount).forEach(o=>{const s=e.durationsByPlayerCount[o];if(s.count>0){const l=s.totalDuration/s.count;s.average=d(Math.round(l))}}),Object.keys(e.durationsByWolfRatio).forEach(o=>{const s=e.durationsByWolfRatio[o];if(s.count>0){const l=s.totalDuration/s.count;s.average=d(Math.round(l))}})}}function z(e){const r=Object.keys(e).map(n=>({duration:parseInt(n),count:e[parseInt(n)]}));return r.sort((n,o)=>n.duration-o.duration),r}function K(e){if(e.length===0)return null;const r=F(),n={totalDuration:0,gamesWithDuration:0};e.forEach((s,l)=>{q(s,r,n,l)}),E(r,n);const o=z(r.durationDistribution);return{averageDuration:r.averageDuration,maxDuration:r.maxDuration,minDuration:r.minDuration===1/0?0:r.minDuration,maxDurationGameId:r.maxDurationGameId,minDurationGameId:r.minDurationGameId,durationDistribution:o,durationsByWinnerCamp:r.durationsByWinnerCamp,durationsByPlayerCount:r.durationsByPlayerCount,durationsByWolfRatio:r.durationsByWolfRatio}}function O(){const{data:e,isLoading:r,error:n}=I(K);return{durationAnalysis:e,fetchingData:r,apiError:n}}function te(){const{durationAnalysis:e,fetchingData:r,apiError:n}=O(),{navigateToGameDetails:o}=G();if(r)return t.jsx("div",{className:"statistiques-attente",children:"Analyse des dur√©es de partie en cours..."});if(n)return t.jsxs("div",{className:"statistiques-echec",children:["Probl√®me rencontr√©: ",n]});if(!e)return t.jsx("div",{className:"statistiques-indisponibles",children:"Donn√©es d'analyse non disponibles"});const s=a=>{const i=a.match(/(\d+)h/),u=a.match(/(\d+)m/),c=a.match(/(\d+)s/),h=i?parseInt(i[1]):0,b=u?parseInt(u[1]):0,M=c?parseInt(c[1]):0;return h*60+b+M/60},l=e?Object.entries(e.durationsByWolfRatio).map(([a,i])=>({ratio:parseFloat(a),moyenne:s(i.average),parties:i.count,dureeFormatee:i.average})).sort((a,i)=>a.ratio-i.ratio):[],m=e?Object.entries(e.durationsByWinnerCamp).map(([a,i])=>({camp:a,moyenne:s(i.average),parties:i.count,dureeFormatee:i.average})).sort((a,i)=>i.moyenne-a.moyenne):[];return t.jsxs("div",{className:"lycans-duree-analyse",children:[t.jsx("h2",{children:"Analyse des Dur√©es de Partie"}),t.jsxs("div",{className:"lycans-resume-conteneur",children:[t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Dur√©e Moyenne"}),t.jsx("p",{className:"lycans-valeur-principale",children:e.averageDuration||"N/A"})]}),t.jsxs("div",{className:"lycans-stat-carte",onClick:()=>{e.minDurationGameId&&o({selectedGame:e.minDurationGameId,fromComponent:"Analyse des Dur√©es de Partie"})},style:{cursor:e.minDurationGameId?"pointer":"default",opacity:e.minDurationGameId?1:.7,transition:"transform 0.2s ease, box-shadow 0.2s ease"},onMouseEnter:a=>{e.minDurationGameId&&(a.currentTarget.style.transform="translateY(-2px)",a.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)")},onMouseLeave:a=>{e.minDurationGameId&&(a.currentTarget.style.transform="translateY(0)",a.currentTarget.style.boxShadow="")},title:e.minDurationGameId?"Cliquez pour voir cette partie":"Aucune partie trouv√©e",children:[t.jsx("h3",{children:"Dur√©e Minimum"}),t.jsxs("p",{className:"lycans-valeur-principale",children:[Math.floor(e.minDuration/60),"min ",e.minDuration%60,"s"]}),e.minDurationGameId&&t.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:["üñ±Ô∏è Partie #",e.minDurationGameId]})]}),t.jsxs("div",{className:"lycans-stat-carte",onClick:()=>{e.maxDurationGameId&&o({selectedGame:e.maxDurationGameId,fromComponent:"Analyse des Dur√©es de Partie"})},style:{cursor:e.maxDurationGameId?"pointer":"default",opacity:e.maxDurationGameId?1:.7,transition:"transform 0.2s ease, box-shadow 0.2s ease"},onMouseEnter:a=>{e.maxDurationGameId&&(a.currentTarget.style.transform="translateY(-2px)",a.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)")},onMouseLeave:a=>{e.maxDurationGameId&&(a.currentTarget.style.transform="translateY(0)",a.currentTarget.style.boxShadow="")},title:e.maxDurationGameId?"Cliquez pour voir cette partie":"Aucune partie trouv√©e",children:[t.jsx("h3",{children:"Dur√©e Maximum"}),t.jsxs("p",{className:"lycans-valeur-principale",children:[Math.floor(e.maxDuration/60),"min ",e.maxDuration%60,"s"]}),e.maxDurationGameId&&t.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:["üñ±Ô∏è Partie #",e.maxDurationGameId]})]})]}),t.jsxs("div",{className:"lycans-graphiques-section",children:[t.jsxs("div",{className:"lycans-graphique-element",children:[t.jsx("h3",{children:"Distribution des Dur√©es de Partie"}),t.jsx(p,{title:"Distribution des Dur√©es de Partie",children:t.jsx("div",{style:{height:300},children:t.jsx(y,{width:"100%",height:"100%",children:t.jsxs(v,{data:e?.durationDistribution||[],margin:{top:20,right:30,left:20,bottom:5},children:[t.jsx(D,{strokeDasharray:"3 3"}),t.jsx(x,{dataKey:"duration",label:{value:"Dur√©e (minutes)",position:"insideBottom",offset:-5},tickFormatter:a=>`${a}min`}),t.jsx(f,{label:{value:"Nombre de Parties",angle:-90,position:"insideLeft"}}),t.jsx(g,{content:({active:a,payload:i})=>{if(a&&i&&i.length>0){const u=i[0].payload;return t.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[t.jsx("div",{children:t.jsxs("strong",{children:["~",u.duration," minutes"]})}),t.jsxs("div",{children:[u.count," parties"]}),t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:"Dur√©es regroup√©es par intervalles de 2 minutes"})]})}return null}}),t.jsx(j,{dataKey:"count",name:"Nombre de Parties",fill:"var(--chart-color-2)"})]})})})})]}),t.jsxs("div",{className:"lycans-graphique-element",children:[t.jsx("h3",{children:"Dur√©e Moyenne par Ratio Loups/Villageois"}),t.jsx(p,{title:"Dur√©e Moyenne par Ratio Loups/Villageois",children:t.jsx("div",{style:{height:300},children:t.jsx(y,{width:"100%",height:"100%",children:t.jsxs(B,{data:l,margin:{top:20,right:30,left:20,bottom:5},children:[t.jsx(D,{strokeDasharray:"3 3"}),t.jsx(x,{dataKey:"ratio",type:"number",domain:["auto","auto"],allowDecimals:!1,tickFormatter:a=>`${a}%`,label:{value:"Ratio Loups/Joueurs (%)",position:"insideBottom",offset:-5}}),t.jsx(f,{label:{value:"Dur√©e Moyenne (minutes)",angle:-90,position:"insideLeft"},tickFormatter:a=>`${Math.round(a)}min`}),t.jsx(g,{content:({active:a,payload:i})=>{if(a&&i&&i.length>0){const u=i[0].payload;return t.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[t.jsx("div",{children:t.jsxs("strong",{children:["Pourcentage de loups : ",u.ratio,"%"]})}),t.jsxs("div",{children:["Dur√©e moyenne : ",u.dureeFormatee]}),t.jsxs("div",{children:["Nombre de parties : ",u.parties]})]})}return null}}),t.jsx(T,{}),t.jsx(k,{type:"monotone",dataKey:"moyenne",name:"Dur√©e Moyenne",stroke:"var(--chart-color-5)",activeDot:{r:8}})]})})})})]}),t.jsxs("div",{className:"lycans-graphique-element",children:[t.jsx("h3",{children:"Dur√©e Moyenne par Camp Victorieux"}),t.jsx(p,{title:"Dur√©e Moyenne par Camp Victorieux",children:t.jsx("div",{style:{height:300},children:t.jsx(y,{width:"100%",height:"100%",children:t.jsxs(v,{data:m,margin:{top:20,right:30,left:20,bottom:60},children:[t.jsx(D,{strokeDasharray:"3 3"}),t.jsx(x,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0}),t.jsx(f,{label:{value:"Dur√©e Moyenne (minutes)",angle:-90,position:"insideLeft"},tickFormatter:a=>`${Math.round(a)}min`}),t.jsx(g,{content:({active:a,payload:i})=>{if(a&&i&&i.length>0){const u=i[0].payload;return t.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[t.jsx("div",{children:t.jsx("strong",{children:u.camp})}),t.jsxs("div",{children:["Dur√©e moyenne : ",u.dureeFormatee]}),t.jsxs("div",{children:["Nombre de parties : ",u.parties]}),t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),t.jsxs(j,{dataKey:"moyenne",name:"moyenne",isAnimationActive:!1,onClick:a=>{a&&a.camp&&o({campFilter:{selectedCamp:a.camp,campFilterMode:"wins-only"},fromComponent:"Dur√©e Moyenne par Camp Victorieux"})},style:{cursor:"pointer"},children:[m.map(a=>t.jsx(A,{fill:C[a.camp]||R},`cell-${a.camp}`)),t.jsx(L,{dataKey:"moyenne",position:"top",formatter:a=>{const i=typeof a=="number"?a:Number(a);return isNaN(i)?"":`${Math.round(i)}min`},fill:"var(--text-primary)",fontSize:12})]})]})})})})]})]})]})}export{te as GameDurationInsights};
