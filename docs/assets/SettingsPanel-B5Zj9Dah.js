import{h as S,r as d,j as e}from"./index-DPotY0EQ.js";function E(){const{settings:s,updateSettings:n,resetSettings:F}=S(),[u,b]=d.useState(null),c=d.useRef({filterMode:s.filterMode,gameFilter:s.gameFilter,dateStart:s.dateRange.start,dateEnd:s.dateRange.end});d.useEffect(()=>{(async()=>{try{const l=await(await fetch("/stats-lycansv2/data/rawGameData.json")).json();b(l.data||[])}catch(t){console.error("Error fetching raw game data:",t)}})()},[]),d.useEffect(()=>{const a={filterMode:s.filterMode,gameFilter:s.gameFilter,dateStart:s.dateRange.start,dateEnd:s.dateRange.end};(c.current.filterMode!==a.filterMode||c.current.gameFilter!==a.gameFilter||c.current.dateStart!==a.dateStart||c.current.dateEnd!==a.dateEnd)&&s.playerFilter.players.length>0&&n({playerFilter:{mode:s.playerFilter.mode,players:[]}}),c.current=a},[s.filterMode,s.gameFilter,s.dateRange.start,s.dateRange.end,s.playerFilter.players.length,n]);const v=a=>{if(!a)return null;const[t,l,i]=a.split("/");return!t||!l||!i?null:new Date(Number(i),Number(l)-1,Number(t))},o=d.useMemo(()=>u?u.filter(a=>{if(s.filterMode==="gameType"&&(s.gameFilter==="modded"&&!a["Game Moddée"]||s.gameFilter==="non-modded"&&a["Game Moddée"]))return!1;if(s.filterMode==="dateRange"&&(s.dateRange.start||s.dateRange.end)){const t=v(a.Date);if(!t)return!1;if(s.dateRange.start){const l=new Date(s.dateRange.start);if(t<l)return!1}if(s.dateRange.end){const l=new Date(s.dateRange.end);if(t>l)return!1}}return!0}):[],[u,s.filterMode,s.gameFilter,s.dateRange]),x=d.useMemo(()=>{const a=new Set;return o.forEach(t=>{const l=t["Liste des joueurs"];l&&l.split(",").map(r=>r.trim()).filter(r=>r.length>0).forEach(r=>a.add(r))}),Array.from(a)},[o]),y=d.useMemo(()=>{const a={};return o.forEach(t=>{const l=t["Liste des joueurs"];if(l){const i=l.split(",").map(r=>r.trim()).filter(r=>r.length>0);i.forEach(r=>{a[r]||(a[r]=new Set),i.forEach(p=>{r!==p&&a[r].add(p)})})}}),a},[o]),{availablePlayers:N,selectablePlayers:m}=d.useMemo(()=>{const a=x.sort();if(s.playerFilter.mode==="none"||s.playerFilter.players.length===0)return{availablePlayers:a,selectablePlayers:new Set(a)};const t=new Set;return s.playerFilter.mode==="include"?a.forEach(l=>{(s.playerFilter.players.includes(l)||s.playerFilter.players.every(r=>y[l]?.has(r)||!1))&&t.add(l)}):s.playerFilter.mode==="exclude"&&a.forEach(l=>{(s.playerFilter.players.includes(l)||o.some(r=>{const p=r["Liste des joueurs"].toLowerCase();return p.includes(l.toLowerCase())?!s.playerFilter.players.some(C=>p.includes(C.toLowerCase())):!1}))&&t.add(l)}),{availablePlayers:a,selectablePlayers:t}},[x,s.playerFilter,y,o]),j=a=>{n({filterMode:a})},g=a=>{n({gameFilter:a})},f=(a,t)=>{n({dateRange:{...s.dateRange,[a]:t||null}})},h=a=>{n({playerFilter:{...s.playerFilter,mode:a}})},R=a=>{const t=s.playerFilter.players;if(t.includes(a)){const i=t.filter(r=>r!==a);n({playerFilter:{...s.playerFilter,players:i}})}else n({playerFilter:{...s.playerFilter,players:[...t,a]}})},k=()=>{n({playerFilter:{...s.playerFilter,players:[...m]}})},M=()=>{n({playerFilter:{...s.playerFilter,players:[]}})};return e.jsxs("div",{className:"settings-panel",children:[e.jsxs("div",{className:"settings-header",children:[e.jsx("h3",{children:"Paramètres de Filtrage"}),e.jsx("button",{onClick:F,className:"settings-reset-btn",type:"button",children:"Réinitialiser"})]}),e.jsxs("div",{className:"settings-sections-container",children:[e.jsxs("div",{className:"settings-section",children:[e.jsx("div",{className:"settings-section-header",children:e.jsx("h3",{children:"1. Filtre Principal"})}),e.jsxs("div",{className:"settings-group",children:[e.jsx("h4",{children:"Mode de Filtrage"}),e.jsx("p",{className:"settings-explanation",children:"Choisissez le type de filtre principal à appliquer aux données :"}),e.jsxs("div",{className:"settings-radio-group",style:{flexDirection:"row",gap:"2rem"},children:[e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"filterMode",value:"gameType",checked:s.filterMode==="gameType",onChange:()=>j("gameType")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Filtrer par type de partie",e.jsx("small",{children:"Sélectionner selon le type de jeu (moddé/standard)"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"filterMode",value:"dateRange",checked:s.filterMode==="dateRange",onChange:()=>j("dateRange")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Filtrer par période",e.jsx("small",{children:"Sélectionner selon une plage de dates"})]})]})]})]}),s.filterMode==="gameType"&&e.jsxs("div",{className:"settings-group",children:[e.jsx("h4",{children:"Filtres de Type de Partie"}),e.jsxs("div",{className:"settings-radio-group",children:[e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"all",checked:s.gameFilter==="all",onChange:()=>g("all")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Tous les types de parties",e.jsx("small",{children:"Inclut toutes les parties, moddées et non-moddées"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"modded",checked:s.gameFilter==="modded",onChange:()=>g("modded")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Parties moddées uniquement",e.jsx("small",{children:"Affiche uniquement les parties avec des rôles modifiés"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"non-modded",checked:s.gameFilter==="non-modded",onChange:()=>g("non-modded")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Parties non-moddées uniquement",e.jsx("small",{children:"Affiche uniquement les parties avec des rôles standards"})]})]})]})]}),s.filterMode==="dateRange"&&e.jsxs("div",{className:"settings-group",children:[e.jsx("h4",{children:"Filtres de Dates"}),e.jsxs("div",{className:"settings-radio-group",children:[e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"dateFilter",value:"all",checked:!s.dateRange.start&&!s.dateRange.end,onChange:()=>{n({dateRange:{start:null,end:null}})}}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Toutes les dates",e.jsx("small",{children:"Affiche toutes les parties sans restriction de date"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"dateFilter",value:"custom",checked:!!(s.dateRange.start||s.dateRange.end),onChange:()=>{if(!s.dateRange.start&&!s.dateRange.end){const a=new Date,t=new Date(a.getFullYear(),a.getMonth()-1,a.getDate());n({dateRange:{start:t.toISOString().split("T")[0],end:a.toISOString().split("T")[0]}})}}}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Plage de dates personnalisée",e.jsx("small",{children:"Définir une période spécifique à analyser"})]})]})]}),(s.dateRange.start||s.dateRange.end)&&e.jsxs("div",{className:"settings-nested-group",children:[e.jsxs("div",{className:"settings-date-inputs",children:[e.jsxs("label",{className:"settings-date-label",children:["Date de début",e.jsx("input",{type:"date",value:s.dateRange.start||"",onChange:a=>f("start",a.target.value),className:"settings-date-input",max:s.dateRange.end||void 0})]}),e.jsx("span",{className:"settings-date-separator",children:"—"}),e.jsxs("label",{className:"settings-date-label",children:["Date de fin",e.jsx("input",{type:"date",value:s.dateRange.end||"",onChange:a=>f("end",a.target.value),className:"settings-date-input",min:s.dateRange.start||void 0})]})]}),e.jsx("small",{style:{color:"var(--text-secondary, #6c757d)",marginTop:8,display:"block"},children:"Laissez vide pour ne pas limiter le début ou la fin de la période."})]})]})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("div",{className:"settings-section-header",children:e.jsx("h3",{children:"2. Filtre Additionnel par Joueurs"})}),e.jsxs("div",{className:"settings-group",children:[e.jsxs("div",{className:"settings-radio-group",children:[e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"playerFilterMode",value:"none",checked:s.playerFilter.mode==="none",onChange:()=>h("none")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Aucun filtre par joueur",e.jsx("small",{children:"Affiche toutes les parties sans restriction par joueur"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"playerFilterMode",value:"include",checked:s.playerFilter.mode==="include",onChange:()=>h("include")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Inclure seulement les parties avec ces joueurs",e.jsx("small",{children:"Affiche uniquement les parties où TOUS les joueurs sélectionnés ont participé ensemble"})]})]}),e.jsxs("label",{className:"settings-radio",children:[e.jsx("input",{type:"radio",name:"playerFilterMode",value:"exclude",checked:s.playerFilter.mode==="exclude",onChange:()=>h("exclude")}),e.jsx("span",{className:"radio-mark"}),e.jsxs("span",{className:"settings-radio-content",children:["Exclure les parties avec ces joueurs",e.jsx("small",{children:"Affiche uniquement les parties où aucun des joueurs listés n'a participé"})]})]})]}),(s.playerFilter.mode==="include"||s.playerFilter.mode==="exclude")&&e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[e.jsxs("label",{style:{fontWeight:500},children:["Sélection des joueurs (",s.playerFilter.players.length," sélectionné",s.playerFilter.players.length!==1?"s":""," sur ",m.size," disponible",m.size!==1?"s":"",")"]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:k,style:{padding:"4px 8px",fontSize:"0.8rem",border:"1px solid var(--border-color, #ccc)",borderRadius:"4px",background:"var(--bg-tertiary, #f0f0f0)",color:"var(--text-primary, #333)",cursor:"pointer"},children:"Tout sélectionner"}),e.jsx("button",{type:"button",onClick:M,style:{padding:"4px 8px",fontSize:"0.8rem",border:"1px solid var(--border-color, #ccc)",borderRadius:"4px",background:"var(--bg-tertiary, #f0f0f0)",color:"var(--text-primary, #333)",cursor:"pointer"},children:"Tout désélectionner"})]})]}),e.jsx("div",{className:"settings-player-grid",children:N.map(a=>{const t=m.has(a),l=s.playerFilter.players.includes(a);return e.jsxs("label",{className:`settings-player-checkbox ${t?"":"disabled"}`,style:{opacity:t?1:.5,cursor:t?"pointer":"not-allowed"},children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>t&&R(a),disabled:!t}),e.jsx("span",{className:"settings-player-checkmark"}),e.jsx("span",{className:"settings-player-name",title:!t&&!l?`${a} n'a ${s.playerFilter.mode==="include"?"pas joué avec tous les joueurs sélectionnés":"que des parties avec les joueurs exclus"}`:a,children:a})]},a)})}),e.jsxs("small",{style:{color:"var(--text-secondary, #6c757d)",marginTop:8,display:"block"},children:["Sélectionnez les joueurs à ",s.playerFilter.mode==="include"?"inclure":"exclure"," dans le filtrage."]})]})]})]})]}),e.jsx("div",{className:"settings-info",children:e.jsxs("p",{children:[e.jsx("strong",{children:"Note:"})," Les changements de paramètres sont sauvegardés automatiquement et s'appliquent à toutes les statistiques affichées."]})})]})}export{E as SettingsPanel};
