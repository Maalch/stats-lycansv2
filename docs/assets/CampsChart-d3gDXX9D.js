import{s as G,d as V,b as E,u as M,r as g,j as e}from"./index-DOV8jD4L.js";import{a as L}from"./baseStatsHook-ClJOw9Ev.js";import{u as k,l as S}from"./api-DBt9LnC0.js";import{b as j,F as b,B as w,C as R,X as A,Y as F,a as N}from"./FullscreenChart-BkG4q6Jw.js";import{R as v,T as C}from"./CategoricalChart-CbhdS8vR.js";import{P as W,a as z}from"./PieChart-CkLC3svi.js";import{L as D}from"./Legend-CLgL4qSm.js";import"./PolarChart-DpviSXzk.js";function _(i){const s={};return i.forEach(t=>{const n=t.Id;s[n]||(s[n]={}),t.PlayerStats.forEach(c=>{const l=c.Username;let d=c.MainRoleInitial;d==="Chasseur"||d==="Alchimiste"?d="Villageois":(d==="Amoureux Villageois"||d==="Amoureux Loup")&&(d="Amoureux"),l&&d&&(s[n][l]=d)})}),s}function P(i,s,t){return i[s]?.[t]||"Villageois"}function q(i){const s=[],t=["Villageois","Loup","Traître"];return i.PlayerStats.forEach(n=>{const c=n.MainRoleInitial;c&&!t.includes(c)&&s.push(c)}),s}function I(i){const s=i.PlayerStats.filter(n=>n.Victorious);if(s.length===0)return null;const t=s[0].MainRoleInitial;return t==="Loup"||t==="Traître"?"Loup":t==="Amoureux Villageois"||t==="Amoureux Loup"?"Amoureux":t}function O(i){return i.PlayerStats.map(s=>s.Username).join(", ")}function $(i){return i.PlayerStats.filter(s=>s.Victorious).map(s=>s.Username).join(", ")}function B(i,s){i.forEach(t=>{const n=t.trim();n!==""&&(s[n]||(s[n]=0),s[n]++)})}function K(i,s){return i&&i.trim()!==""?(s[i]||(s[i]=0),s[i]++,!0):!1}function U(i,s,t,n,c,l){const d=G(s),x=new Set;d.forEach(m=>{const h=m.trim();if(h){const u=P(c,i,h);x.add(u)}}),x.forEach(m=>{l[m]||(l[m]={totalGames:0,wins:0,winRate:0,players:{}}),l[m].totalGames++}),x.forEach(m=>{V(m,t)&&l[m].wins++}),d.forEach(m=>{const h=m.trim();if(h){const u=P(c,i,m);l[u].players[h]||(l[u].players[h]={games:0,wins:0,winRate:0}),l[u].players[h].games++,E(h,n)&&l[u].players[h].wins++}})}function X(i){Object.keys(i).forEach(s=>{i[s].totalGames>0&&(i[s].winRate=parseFloat((i[s].wins/i[s].totalGames*100).toFixed(2))),Object.keys(i[s].players).forEach(t=>{const n=i[s].players[t];n.games>0&&(n.winRate=parseFloat((n.wins/n.games*100).toFixed(2)))})})}function Y(i,s){const t=[];return Object.keys(i).forEach(n=>{t.push({camp:n,wins:i[n],winRate:(i[n]/s*100).toFixed(2)})}),t.sort((n,c)=>c.wins-n.wins),t}function J(i){return Object.keys(i).map(s=>({camp:s,totalGames:i[s].totalGames,wins:i[s].wins,winRate:i[s].winRate.toFixed(2)}))}function H(i){const s=new Set;return Object.keys(i).forEach(t=>{Object.keys(i[t].players).forEach(n=>{s.add(n)})}),s.size}function Q(i){const s=[];return Object.keys(i).forEach(t=>{s.push({soloRole:t,appearances:i[t]})}),s.sort((t,n)=>n.appearances-t.appearances),s}function Z(i){if(i.length===0)return null;const s=_(i),t={},n={},c={};let l=0;i.forEach(u=>{const r=u.Id,a=q(u),o=I(u),f=O(u),p=$(u);B(a,t),K(o||"",n)&&l++,r&&f&&o&&p&&U(r,f,o,p,s,c)}),X(c);const d=Y(n,l),x=J(c),m=H(c),h=Q(t);return{totalGames:l,campStats:d,soloCamps:h,campAverages:x,totalPlayersAnalyzed:m}}function ee(){const{data:i,isLoading:s,error:t}=L(Z);return{campWinStats:i,isLoading:s,errorInfo:t}}const se="#607D8B";function de(){const{navigateToGameDetails:i}=M(),{campWinStats:s,isLoading:t,errorInfo:n}=ee(),c=k(),l=g.useMemo(()=>s?.campAverages?s.campAverages.map(r=>({...r,winRateNum:parseFloat(r.winRate)})).sort((r,a)=>a.winRateNum-r.winRateNum):[],[s]),d=g.useMemo(()=>s?.campStats?.map(r=>({...r,winRateNum:typeof r.winRate=="string"?parseFloat(r.winRate):r.winRate}))||[],[s]),x=g.useMemo(()=>{if(!d.length)return[];const r=5;let a=0;const o=[],f=[];return d.forEach(p=>{p.winRateNum<r?(a+=p.winRateNum,o.push(p)):f.push(p)}),a>0&&f.push({camp:"Autres",wins:o.reduce((p,y)=>p+y.wins,0),winRate:a.toFixed(1),winRateNum:a,_details:o}),f},[d]),m=g.useMemo(()=>l.length?l.slice().filter(r=>r.camp!=="Villageois"&&r.camp!=="Loup").sort((r,a)=>a.totalGames-r.totalGames):[],[l]),h=t,u=n;return h?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques des camps..."}):u?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",u]}):s?e.jsxs("div",{className:"lycans-camps-container",children:[e.jsx("h2",{children:"Statistiques des Camps"}),s&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camps Analysés"}),e.jsx("div",{className:"lycans-valeur-principale",children:s.campAverages?.length||0}),e.jsx("p",{children:"camps différents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Joueurs Évalués"}),e.jsx("div",{className:"lycans-valeur-principale",children:s.totalPlayersAnalyzed||0}),e.jsx("p",{children:"joueurs analysés"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:s?.totalGames||0}),e.jsx("p",{children:"parties analysées"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[s&&x.length>0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Répartition des Victoires par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Distribution des victoires sur ",s.totalGames," parties"]}),e.jsx("div",{style:{height:450},children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(W,{children:[e.jsx(z,{data:x,cx:"50%",cy:"50%",labelLine:!1,outerRadius:140,fill:"#8884d8",dataKey:"winRateNum",nameKey:"camp",onClick:r=>{if(r&&r.camp)if(r.camp==="Autres"&&r._details){const a=r._details.map(o=>o.camp);i({campFilter:{selectedCamp:"Autres",campFilterMode:"wins-only",_smallCamps:a},fromComponent:"Répartition des Victoires par Camp"})}else i({campFilter:{selectedCamp:r.camp,campFilterMode:"wins-only"},fromComponent:"Répartition des Victoires par Camp"})},style:{cursor:"pointer"},label:({camp:r,winRate:a})=>r==="Autres"?`Autres: ${a}%`:`${r}: ${a}%`,children:x.map((r,a)=>e.jsx(j,{fill:r.camp==="Autres"?S:c[r.camp]||se,onClick:()=>{if(r.camp==="Autres"&&r._details){const o=r._details.map(f=>f.camp);i({campFilter:{selectedCamp:"Autres",campFilterMode:"wins-only",_smallCamps:o},fromComponent:"Répartition des Victoires par Camp"})}else i({campFilter:{selectedCamp:r.camp,campFilterMode:"wins-only"},fromComponent:"Répartition des Victoires par Camp"})},style:{cursor:"pointer"}},`cellule-camp-${a}`))}),e.jsx(C,{content:({active:r,payload:a})=>{if(r&&a&&a.length>0){const o=a[0].payload;if(o.camp==="Autres"&&o._details){const f=[...o._details].sort((p,y)=>y.winRateNum-p.winRateNum);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:"Autres"})}),e.jsx("div",{children:f.map((p,y)=>e.jsxs("div",{children:[p.camp,": ",p.wins," victoires (",p.winRate,"%)"]},y))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold"},children:["Total: ",o.wins," victoires (",o.winRate,"%)"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:o.camp}),e.jsxs("div",{children:["Victoires: ",o.wins]}),e.jsxs("div",{children:["Taux de victoire: ",o.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(D,{})]})})})]})}),s?.campAverages&&l.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire Moyen par Camp"}),e.jsx(b,{title:"Taux de Victoire Moyen par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(w,{data:l,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(A,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(F,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(C,{content:({active:r,payload:a})=>{if(r&&a&&a.length>0){const o=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:o.camp})}),e.jsxs("div",{children:["Victoires : ",o.wins," / ",o.totalGames]}),e.jsxs("div",{children:["Taux de victoire: ",o.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(N,{dataKey:"winRateNum",onClick:r=>{r&&r.camp&&i({campFilter:{selectedCamp:r.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Taux de Victoire Moyen par Camp"})},style:{cursor:"pointer"},children:l.map((r,a)=>e.jsx(j,{fill:c[r.camp]||`var(--chart-color-${a%6+1})`,onClick:()=>{i({campFilter:{selectedCamp:r.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Taux de Victoire Moyen par Camp"})},style:{cursor:"pointer"}},`cell-${a}`))})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Parties par Camp (hors villageois et loups)"}),e.jsx(b,{title:"Distribution des Parties par Camp (hors villageois et loups)",children:e.jsx("div",{style:{height:400},children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(w,{data:m,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(A,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(F,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(C,{content:({active:r,payload:a})=>{if(r&&a&&a.length>0){const o=a[0].payload,f=m.reduce((y,T)=>y+T.totalGames,0),p=(o.totalGames/f*100).toFixed(1);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:o.camp})}),e.jsxs("div",{children:["Parties: ",o.totalGames," (",p,"%)"]}),e.jsxs("div",{children:["Taux victoire: ",o.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(N,{dataKey:"totalGames",onClick:r=>{r&&r.camp&&i({campFilter:{selectedCamp:r.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Distribution des Parties par Camp"})},style:{cursor:"pointer"},children:m.map((r,a)=>e.jsx(j,{fill:c[r.camp]||`var(--chart-color-${a%6+1})`,onClick:()=>{i({campFilter:{selectedCamp:r.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Distribution des Parties par Camp"})},style:{cursor:"pointer"}},`cell-${a}`))})]})})})})]})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de camp disponible"})}export{de as CampsChart};
