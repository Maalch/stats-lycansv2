import{j as e,r as $}from"./index-dURATSXZ.js";import{q as B,t as E,R as A,p as T,T as L,B as I,C as J,X as M,Y as V,o as q}from"./useRawGameData-DYsyhQ_S.js";import{a as P}from"./api-DftpR04q.js";import{P as D,a as z}from"./PieChart-CcnNf-XV.js";function S({children:i,className:a=""}){return e.jsx("div",{className:`rounded-lg border bg-card text-card-foreground shadow-sm ${a}`,children:i})}function N({children:i,className:a=""}){return e.jsx("div",{className:`flex flex-col space-y-1.5 p-6 ${a}`,children:i})}function C({children:i,className:a=""}){return e.jsx("h3",{className:`text-2xl font-semibold leading-none tracking-tight ${a}`,children:i})}function R({children:i,className:a=""}){return e.jsx("div",{className:`p-6 pt-0 ${a}`,children:i})}function K({variant:i="default",size:a="md",className:c="",children:m,...r}){const h="inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none ring-offset-background",f={default:"bg-primary text-primary-foreground hover:bg-primary/90",outline:"border border-input hover:bg-accent hover:text-accent-foreground",ghost:"hover:bg-accent hover:text-accent-foreground"},x={sm:"h-9 px-3 text-xs",md:"h-10 py-2 px-4",lg:"h-11 px-8"};return e.jsx("button",{className:`${h} ${f[i]} ${x[a]} ${c}`,...r,children:m})}function k({className:i="",...a}){return e.jsx("input",{className:`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${i}`,...a})}function g({className:i="",children:a,...c}){return e.jsx("label",{className:`text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70 ${i}`,...c,children:a})}function w({checked:i,onCheckedChange:a,id:c,className:m=""}){return e.jsx("input",{type:"checkbox",id:c,checked:i,onChange:r=>a?.(r.target.checked),className:`h-4 w-4 rounded border border-primary text-primary focus:ring-2 focus:ring-primary focus:ring-offset-2 ${m}`})}function G({children:i,variant:a="default",className:c=""}){const m="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",r={default:"bg-primary text-primary-foreground hover:bg-primary/80",outline:"text-foreground border border-input"};return e.jsx("div",{className:`${m} ${r[a]} ${c}`,children:i})}function O(i){const{data:a}=B(),{data:c}=E();return $.useMemo(()=>{if(!a||!c)return{predictions:[],totalSimilarGames:0,mostSimilarGame:null};const m=a.filter(o=>{let s=0,l=0;l+=3,o["Nombre de joueurs"]===i.nombreJoueurs?s+=3:Math.abs(o["Nombre de joueurs"]-i.nombreJoueurs)<=1?s+=2:Math.abs(o["Nombre de joueurs"]-i.nombreJoueurs)<=2&&(s+=1),l+=3,o["Nombre de loups"]===i.nombreLoups?s+=3:Math.abs(o["Nombre de loups"]-i.nombreLoups)<=1&&(s+=1),l+=1,o["RÃ´le TraÃ®tre"]===i.roleTraitre&&(s+=1),l+=1,o["RÃ´le Amoureux"]===i.roleAmoureux&&(s+=1),l+=1;const t=o["RÃ´les solo"]?o["RÃ´les solo"].split(",").map(d=>d.trim()):[];(i.rolesSolo.length===0&&t.length===0||i.rolesSolo.some(d=>t.includes(d)))&&(s+=1);const n=c.find(d=>d.Game===o.Game);if(n){const d=[n["Idiot du village"]?"Idiot du village":null,n.Cannibale?"Cannibale":null,n.Agent?"Agent":null,n.Espion?"Espion":null,n.Scientifique?"Scientifique":null,n["La BÃªte"]?"La BÃªte":null,n["Chasseur de primes"]?"Chasseur de primes":null,n.Vaudou?"Vaudou":null].filter(Boolean);l+=2;const u=i.rolesSpeciaux.filter(v=>d.includes(v)).length,y=Math.max(i.rolesSpeciaux.length,d.length);y===0?s+=2:s+=u/y*2}return s/l>=.5}),r={};m.forEach(o=>{const s=o["Camp victorieux"];r[s]=(r[s]||0)+1});let h=null,f=0;for(const o of a){let s=0,l=10;o["Nombre de joueurs"]===i.nombreJoueurs?s+=3:Math.abs(o["Nombre de joueurs"]-i.nombreJoueurs)<=1?s+=2:Math.abs(o["Nombre de joueurs"]-i.nombreJoueurs)<=2&&(s+=1),o["Nombre de loups"]===i.nombreLoups?s+=3:Math.abs(o["Nombre de loups"]-i.nombreLoups)<=1&&(s+=1),o["RÃ´le TraÃ®tre"]===i.roleTraitre&&(s+=1),o["RÃ´le Amoureux"]===i.roleAmoureux&&(s+=1);const t=o["RÃ´les solo"]?o["RÃ´les solo"].split(",").map(u=>u.trim()):[];(i.rolesSolo.length===0&&t.length===0||i.rolesSolo.some(u=>t.includes(u)))&&(s+=1);const n=c.find(u=>u.Game===o.Game);if(n){const u=[n["Idiot du village"]?"Idiot du village":null,n.Cannibale?"Cannibale":null,n.Agent?"Agent":null,n.Espion?"Espion":null,n.Scientifique?"Scientifique":null,n["La BÃªte"]?"La BÃªte":null,n["Chasseur de primes"]?"Chasseur de primes":null,n.Vaudou?"Vaudou":null].filter(Boolean),y=i.rolesSpeciaux.filter(F=>u.includes(F)).length,v=Math.max(i.rolesSpeciaux.length,u.length);v===0?s+=1:s+=y/v}const d=s/l;d>f&&(f=d,h={gameNumber:o.Game,similarity:d,winner:o["Camp victorieux"]})}const x=m.length,p=[],j=["Villageois","Loups","Amoureux","Solo"];for(const o of j){const s=r[o]||0,l=x>0?s/x*100:0;let t="low";x>=20?t="high":x>=10&&(t="medium"),(l>0||o==="Villageois"||o==="Loups")&&p.push({camp:o,winPercentage:l,gamesAnalyzed:s,confidence:t})}return p.sort((o,s)=>s.winPercentage-o.winPercentage),{predictions:p,totalSimilarGames:x,mostSimilarGame:h}},[a,c,i])}const _=["Idiot du village","Cannibale","Agent","Espion","Scientifique","La BÃªte","Chasseur de primes","Vaudou"],X=["Serial Killer","Zombie","Pyromane","Assassin","Voleur"];function Q(){const[i,a]=$.useState({nombreJoueurs:12,nombreLoups:3,roleTraitre:!1,roleAmoureux:!1,rolesSolo:[],rolesSpeciaux:[]}),[c,m]=$.useState(!1),r=O(i),h=(s,l)=>{a(t=>({...t,rolesSpeciaux:l?[...t.rolesSpeciaux,s]:t.rolesSpeciaux.filter(b=>b!==s)}))},f=(s,l)=>{a(t=>({...t,rolesSolo:l?[...t.rolesSolo,s]:t.rolesSolo.filter(b=>b!==s)}))},x=s=>{switch(s){case"high":return"bg-green-100 text-green-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},p=s=>{switch(s){case"high":return"FiabilitÃ© Ã©levÃ©e";case"medium":return"FiabilitÃ© moyenne";case"low":return"FiabilitÃ© faible";default:return"DonnÃ©es insuffisantes"}},j=r.predictions.map(s=>({name:s.camp,value:s.winPercentage,color:P[s.camp]||"#8884d8"})),o=r.predictions.map(s=>({camp:s.camp,percentage:s.winPercentage,games:s.gamesAnalyzed}));return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsxs(N,{children:[e.jsx(C,{children:"ðŸŽ¯ PrÃ©diction de RÃ©sultats"}),e.jsx("p",{className:"text-sm text-gray-600",children:"PrÃ©disez les chances de victoire de chaque camp en fonction des paramÃ¨tres de la partie"})]}),e.jsxs(R,{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"ParamÃ¨tres de base"}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"players",children:"Nombre de joueurs"}),e.jsx(k,{id:"players",type:"number",min:"8",max:"15",value:i.nombreJoueurs,onChange:s=>a(l=>({...l,nombreJoueurs:parseInt(s.target.value)||8}))})]}),e.jsxs("div",{children:[e.jsx(g,{htmlFor:"wolves",children:"Nombre de loups"}),e.jsx(k,{id:"wolves",type:"number",min:"1",max:"4",value:i.nombreLoups,onChange:s=>a(l=>({...l,nombreLoups:parseInt(s.target.value)||1}))})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{id:"traitor",checked:i.roleTraitre,onCheckedChange:s=>a(l=>({...l,roleTraitre:s}))}),e.jsx(g,{htmlFor:"traitor",children:"RÃ´le TraÃ®tre"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{id:"lovers",checked:i.roleAmoureux,onCheckedChange:s=>a(l=>({...l,roleAmoureux:s}))}),e.jsx(g,{htmlFor:"lovers",children:"RÃ´le Amoureux"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"RÃ´les spÃ©ciaux"}),e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:_.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{id:`special-${s}`,checked:i.rolesSpeciaux.includes(s),onCheckedChange:l=>h(s,l)}),e.jsx(g,{htmlFor:`special-${s}`,className:"text-sm",children:s})]},s))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"RÃ´les solo"}),e.jsx("div",{className:"space-y-2",children:X.map(s=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{id:`solo-${s}`,checked:i.rolesSolo.includes(s),onCheckedChange:l=>f(s,l)}),e.jsx(g,{htmlFor:`solo-${s}`,className:"text-sm",children:s})]},s))})]})]}),e.jsx(K,{onClick:()=>m(!0),className:"w-full",size:"lg",children:"ðŸ”® PrÃ©dire les rÃ©sultats"})]})]}),c&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(S,{children:[e.jsxs(N,{children:[e.jsx(C,{children:"ðŸ“Š RÃ©sultats de la prÃ©diction"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(G,{variant:"outline",children:[r.totalSimilarGames," parties similaires analysÃ©es"]}),r.mostSimilarGame&&e.jsxs(G,{variant:"outline",children:["Partie la plus similaire: #",r.mostSimilarGame.gameNumber,"(",(r.mostSimilarGame.similarity*100).toFixed(1),"% de similaritÃ©)"]})]})]}),e.jsx(R,{children:r.totalSimilarGames===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"Aucune partie similaire trouvÃ©e avec ces paramÃ¨tres. Essayez avec des paramÃ¨tres diffÃ©rents."})}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-4",children:"RÃ©partition des victoires"}),e.jsx(A,{width:"100%",height:300,children:e.jsxs(D,{children:[e.jsx(z,{data:j,cx:"50%",cy:"50%",labelLine:!1,label:({name:s,value:l})=>`${s}: ${typeof l=="number"?l.toFixed(1):"0.0"}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:j.map((s,l)=>e.jsx(T,{fill:s.color},`cell-${l}`))}),e.jsx(L,{formatter:s=>[`${s.toFixed(1)}%`,"ProbabilitÃ©"]})]})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold mb-4",children:"Pourcentages de victoire"}),e.jsx(A,{width:"100%",height:300,children:e.jsxs(I,{data:o,children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(M,{dataKey:"camp"}),e.jsx(V,{}),e.jsx(L,{formatter:(s,l,t)=>[`${typeof s=="number"?s.toFixed(1):s}%`,"ProbabilitÃ©",t&&t.payload?`(${t.payload.games} victoires)`:""]}),e.jsx(q,{dataKey:"percentage",fill:"#8884d8",name:"ProbabilitÃ© de victoire (%)"})]})})]})]})})]}),r.predictions.length>0&&e.jsxs(S,{children:[e.jsx(N,{children:e.jsx(C,{children:"ðŸ“ˆ PrÃ©dictions dÃ©taillÃ©es"})}),e.jsx(R,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:r.predictions.map((s,l)=>e.jsxs("div",{className:`p-4 rounded-lg border-2 ${l===0?"border-yellow-400 bg-yellow-50":"border-gray-200"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h3",{className:"font-semibold",style:{color:P[s.camp]},children:s.camp}),l===0&&e.jsx("span",{className:"text-xl",children:"ðŸ‘‘"})]}),e.jsxs("div",{className:"text-2xl font-bold mb-2",children:[s.winPercentage.toFixed(1),"%"]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[s.gamesAnalyzed," victoires sur ",r.totalSimilarGames," parties"]}),e.jsx(G,{className:x(s.confidence),children:p(s.confidence)})]},s.camp))})})]}),r.mostSimilarGame&&e.jsxs(S,{children:[e.jsx(N,{children:e.jsx(C,{children:"ðŸŽ¯ Partie la plus similaire"})}),e.jsx(R,{children:e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg",children:[e.jsxs("p",{className:"font-semibold",children:["Partie #",r.mostSimilarGame.gameNumber]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["SimilaritÃ©: ",(r.mostSimilarGame.similarity*100).toFixed(1),"%"]}),e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Vainqueur:"})," ",e.jsx("span",{style:{color:P[r.mostSimilarGame.winner]},children:r.mostSimilarGame.winner})]})]})})]})]})]})}export{Q as default};
