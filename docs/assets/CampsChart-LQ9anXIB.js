import{s as G,d as V,b as E,u as M,r as y,j as e}from"./index-Dz0zDe-y.js";import{a as k}from"./baseStatsHook-DMUq_ovw.js";import{l as L,a as g}from"./api-B0oQ7xvq.js";import{b as v,F as b,B as w,C as R,X as A,Y as F,a as N}from"./FullscreenChart-bO3HK4XB.js";import{R as j,T as C}from"./CategoricalChart-BhnIUHnV.js";import{P as S,a as W}from"./PieChart-DlJYXO3P.js";import{L as z}from"./Legend-BMPJhzra.js";import"./PolarChart-UnvxFT1K.js";function D(r){const s={};return r.forEach(a=>{const n=a.Id;s[n]||(s[n]={}),a.PlayerStats.forEach(l=>{const c=l.Username;let d=l.MainRoleInitial;d==="Chasseur"||d==="Alchimiste"?d="Villageois":(d==="Amoureux Villageois"||d==="Amoureux Loup")&&(d="Amoureux"),c&&d&&(s[n][c]=d)})}),s}function P(r,s,a){return r[s]?.[a]||"Villageois"}function _(r){const s=[],a=["Villageois","Loup","Traître"];return r.PlayerStats.forEach(n=>{const l=n.MainRoleInitial;l&&!a.includes(l)&&s.push(l)}),s}function q(r){const s=r.PlayerStats.filter(n=>n.Victorious);if(s.length===0)return null;const a=s[0].MainRoleInitial;return a==="Loup"||a==="Traître"?"Loup":a==="Amoureux Villageois"||a==="Amoureux Loup"?"Amoureux":a}function I(r){return r.PlayerStats.map(s=>s.Username).join(", ")}function O(r){return r.PlayerStats.filter(s=>s.Victorious).map(s=>s.Username).join(", ")}function $(r,s){r.forEach(a=>{const n=a.trim();n!==""&&(s[n]||(s[n]=0),s[n]++)})}function B(r,s){return r&&r.trim()!==""?(s[r]||(s[r]=0),s[r]++,!0):!1}function K(r,s,a,n,l,c){const d=G(s),x=new Set;d.forEach(p=>{const u=p.trim();if(u){const i=P(l,r,u);x.add(i)}}),x.forEach(p=>{c[p]||(c[p]={totalGames:0,wins:0,winRate:0,players:{}}),c[p].totalGames++}),x.forEach(p=>{V(p,a)&&c[p].wins++}),d.forEach(p=>{const u=p.trim();if(u){const i=P(l,r,p);c[i].players[u]||(c[i].players[u]={games:0,wins:0,winRate:0}),c[i].players[u].games++,E(u,n)&&c[i].players[u].wins++}})}function U(r){Object.keys(r).forEach(s=>{r[s].totalGames>0&&(r[s].winRate=parseFloat((r[s].wins/r[s].totalGames*100).toFixed(2))),Object.keys(r[s].players).forEach(a=>{const n=r[s].players[a];n.games>0&&(n.winRate=parseFloat((n.wins/n.games*100).toFixed(2)))})})}function X(r,s){const a=[];return Object.keys(r).forEach(n=>{a.push({camp:n,wins:r[n],winRate:(r[n]/s*100).toFixed(2)})}),a.sort((n,l)=>l.wins-n.wins),a}function Y(r){return Object.keys(r).map(s=>({camp:s,totalGames:r[s].totalGames,wins:r[s].wins,winRate:r[s].winRate.toFixed(2)}))}function J(r){const s=new Set;return Object.keys(r).forEach(a=>{Object.keys(r[a].players).forEach(n=>{s.add(n)})}),s.size}function H(r){const s=[];return Object.keys(r).forEach(a=>{s.push({soloRole:a,appearances:r[a]})}),s.sort((a,n)=>n.appearances-a.appearances),s}function Q(r){if(r.length===0)return null;const s=D(r),a={},n={},l={};let c=0;r.forEach(i=>{const t=i.Id,o=_(i),h=q(i),m=I(i),f=O(i);$(o,a),B(h||"",n)&&c++,t&&m&&h&&f&&K(t,m,h,f,s,l)}),U(l);const d=X(n,c),x=Y(l),p=J(l),u=H(a);return{totalGames:c,campStats:d,soloCamps:u,campAverages:x,totalPlayersAnalyzed:p}}function Z(){const{data:r,isLoading:s,error:a}=k(Q);return{campWinStats:r,isLoading:s,errorInfo:a}}const ee="#607D8B";function ce(){const{navigateToGameDetails:r}=M(),{campWinStats:s,isLoading:a,errorInfo:n}=Z(),l=y.useMemo(()=>s?.campAverages?s.campAverages.map(i=>({...i,winRateNum:parseFloat(i.winRate)})).sort((i,t)=>t.winRateNum-i.winRateNum):[],[s]),c=y.useMemo(()=>s?.campStats?.map(i=>({...i,winRateNum:typeof i.winRate=="string"?parseFloat(i.winRate):i.winRate}))||[],[s]),d=y.useMemo(()=>{if(!c.length)return[];const i=5;let t=0;const o=[],h=[];return c.forEach(m=>{m.winRateNum<i?(t+=m.winRateNum,o.push(m)):h.push(m)}),t>0&&h.push({camp:"Autres",wins:o.reduce((m,f)=>m+f.wins,0),winRate:t.toFixed(1),winRateNum:t,_details:o}),h},[c]),x=y.useMemo(()=>l.length?l.slice().filter(i=>i.camp!=="Villageois"&&i.camp!=="Loup").sort((i,t)=>t.totalGames-i.totalGames):[],[l]),p=a,u=n;return p?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques des camps..."}):u?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",u]}):s?e.jsxs("div",{className:"lycans-camps-container",children:[e.jsx("h2",{children:"Statistiques des Camps"}),s&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camps Analysés"}),e.jsx("div",{className:"lycans-valeur-principale",children:s.campAverages?.length||0}),e.jsx("p",{children:"camps différents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Joueurs Évalués"}),e.jsx("div",{className:"lycans-valeur-principale",children:s.totalPlayersAnalyzed||0}),e.jsx("p",{children:"joueurs analysés"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:s?.totalGames||0}),e.jsx("p",{children:"parties analysées"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[s&&d.length>0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Répartition des Victoires par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Distribution des victoires sur ",s.totalGames," parties"]}),e.jsx("div",{style:{height:450},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(S,{children:[e.jsx(W,{data:d,cx:"50%",cy:"50%",labelLine:!1,outerRadius:140,fill:"#8884d8",dataKey:"winRateNum",nameKey:"camp",onClick:i=>{if(i&&i.camp)if(i.camp==="Autres"&&i._details){const t=i._details.map(o=>o.camp);r({campFilter:{selectedCamp:"Autres",campFilterMode:"wins-only",_smallCamps:t},fromComponent:"Répartition des Victoires par Camp"})}else r({campFilter:{selectedCamp:i.camp,campFilterMode:"wins-only"},fromComponent:"Répartition des Victoires par Camp"})},style:{cursor:"pointer"},label:({camp:i,winRate:t})=>i==="Autres"?`Autres: ${t}%`:`${i}: ${t}%`,children:d.map((i,t)=>e.jsx(v,{fill:i.camp==="Autres"?L:g[i.camp]||ee,onClick:()=>{if(i.camp==="Autres"&&i._details){const o=i._details.map(h=>h.camp);r({campFilter:{selectedCamp:"Autres",campFilterMode:"wins-only",_smallCamps:o},fromComponent:"Répartition des Victoires par Camp"})}else r({campFilter:{selectedCamp:i.camp,campFilterMode:"wins-only"},fromComponent:"Répartition des Victoires par Camp"})},style:{cursor:"pointer"}},`cellule-camp-${t}`))}),e.jsx(C,{content:({active:i,payload:t})=>{if(i&&t&&t.length>0){const o=t[0].payload;if(o.camp==="Autres"&&o._details){const h=[...o._details].sort((m,f)=>f.winRateNum-m.winRateNum);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:"Autres"})}),e.jsx("div",{children:h.map((m,f)=>e.jsxs("div",{children:[m.camp,": ",m.wins," victoires (",m.winRate,"%)"]},f))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold"},children:["Total: ",o.wins," victoires (",o.winRate,"%)"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:o.camp}),e.jsxs("div",{children:["Victoires: ",o.wins]}),e.jsxs("div",{children:["Taux de victoire: ",o.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(z,{})]})})})]})}),s?.campAverages&&l.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire Moyen par Camp"}),e.jsx(b,{title:"Taux de Victoire Moyen par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(w,{data:l,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(A,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(F,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(C,{content:({active:i,payload:t})=>{if(i&&t&&t.length>0){const o=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:o.camp})}),e.jsxs("div",{children:["Victoires : ",o.wins," / ",o.totalGames]}),e.jsxs("div",{children:["Taux de victoire: ",o.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(N,{dataKey:"winRateNum",onClick:i=>{i&&i.camp&&r({campFilter:{selectedCamp:i.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Taux de Victoire Moyen par Camp"})},style:{cursor:"pointer"},children:l.map((i,t)=>e.jsx(v,{fill:g[i.camp]||`var(--chart-color-${t%6+1})`,onClick:()=>{r({campFilter:{selectedCamp:i.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Taux de Victoire Moyen par Camp"})},style:{cursor:"pointer"}},`cell-${t}`))})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Parties par Camp (hors villageois et loups)"}),e.jsx(b,{title:"Distribution des Parties par Camp (hors villageois et loups)",children:e.jsx("div",{style:{height:400},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(w,{data:x,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(A,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(F,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(C,{content:({active:i,payload:t})=>{if(i&&t&&t.length>0){const o=t[0].payload,h=x.reduce((f,T)=>f+T.totalGames,0),m=(o.totalGames/h*100).toFixed(1);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:o.camp})}),e.jsxs("div",{children:["Parties: ",o.totalGames," (",m,"%)"]}),e.jsxs("div",{children:["Taux victoire: ",o.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(N,{dataKey:"totalGames",onClick:i=>{i&&i.camp&&r({campFilter:{selectedCamp:i.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Distribution des Parties par Camp"})},style:{cursor:"pointer"},children:x.map((i,t)=>e.jsx(v,{fill:g[i.camp]||`var(--chart-color-${t%6+1})`,onClick:()=>{r({campFilter:{selectedCamp:i.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Distribution des Parties par Camp"})},style:{cursor:"pointer"}},`cell-${t}`))})]})})})})]})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de camp disponible"})}export{ce as CampsChart};
