import{r as g,j as e}from"./index-CMhG7aNy.js";import{u as R}from"./useRawGameData-B19HQYHR.js";import{a as f}from"./api-beq3FXpM.js";import{F as T,R as b,B as C,C as N,X as V,Y as w,T as F,o as k}from"./FullscreenChart-CzAYjb6U.js";import{L as G}from"./Legend-DkujHqXZ.js";function B(){const{data:i,isLoading:y,error:x}=R();return{victoryTypesStats:g.useMemo(()=>{if(!i||i.length===0)return null;const c={},l={};let t=0;i.forEach(r=>{const s=r["Type de victoire"],o=r["Camp victorieux"];s&&s.trim()!==""&&o&&o.trim()!==""&&(t++,c[s]||(c[s]=0),c[s]++,l[s]||(l[s]={}),l[s][o]||(l[s][o]=0),l[s][o]++)});const a=new Set;Object.values(l).forEach(r=>{Object.keys(r).forEach(s=>a.add(s))});const d=Object.keys(c).map(r=>{const s={type:r,count:c[r],percentage:(c[r]/t*100).toFixed(1)},o=l[r]||{};return a.forEach(v=>{const j=o[v]||0,L=c[r]>0?(j/c[r]*100).toFixed(1):"0.0";s[v]=j,s[`${v}_percentage`]=L}),s});d.sort((r,s)=>s.count-r.count);const n=Array.from(a).sort();return{totalGames:t,victoryTypes:d,winningCamps:n}},[i]),isLoading:y,errorInfo:x}}function K(){const{victoryTypesStats:i,isLoading:y,errorInfo:x}=B(),h=g.useMemo(()=>i?.victoryTypes?i.victoryTypes.map(t=>({...t,percentageNum:parseFloat(t.percentage)})):[],[i?.victoryTypes]),{mainVictoryTypes:u,rareVictoryTypes:m}=g.useMemo(()=>{if(!h.length)return{mainVictoryTypes:[],rareVictoryTypes:[]};const t=Math.max(5,Math.ceil(h[0].count*.1)),a=h.filter(n=>n.count>=t),d=h.filter(n=>n.count<t);return{mainVictoryTypes:a,rareVictoryTypes:d}},[h]),c=y,l=x;return c?e.jsx("div",{className:"donnees-attente",children:"Chargement des types de victoire..."}):l?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",l]}):i?e.jsxs("div",{className:"lycans-victory-types-container",children:[e.jsx("h2",{children:"Types de Victoire"}),i&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Types Principaux"}),e.jsx("div",{className:"lycans-valeur-principale",children:u.length}),e.jsx("p",{children:"types fréquents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Types Spéciaux"}),e.jsx("div",{className:"lycans-valeur-principale",children:m.length}),e.jsx("p",{children:"types rares"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:i?.totalGames||0}),e.jsx("p",{children:"parties analysées"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[u.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Victoire Principaux par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Types de victoire les plus fréquents (",u.reduce((t,a)=>t+a.count,0)," parties sur ",i?.totalGames,")"]}),e.jsx(T,{title:"Types de Victoire Principaux par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(C,{data:u,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(N,{strokeDasharray:"3 3"}),e.jsx(V,{dataKey:"type",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:11}),e.jsx(w,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(F,{content:({active:t,payload:a,label:d})=>{if(t&&a&&a.length>0){const n=a.reduce((r,s)=>r+(s.value||0),0);let p="";return i?.totalGames&&n>0&&(p=(n/i.totalGames*100).toFixed(1)),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:300},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8},children:d}),e.jsxs("div",{style:{marginBottom:4},children:["Total: ",n," parties",p&&` (${p}%)`]}),a.filter(r=>r.value&&r.value>0).sort((r,s)=>(s.value||0)-(r.value||0)).map((r,s)=>{const o=n>0?((r.value||0)/n*100).toFixed(1):"0.0";return e.jsxs("div",{style:{marginBottom:2},children:[e.jsx("span",{style:{display:"inline-block",width:12,height:12,backgroundColor:r.color,marginRight:8,borderRadius:2}}),r.dataKey,": ",r.value," (",o,"%)"]},s)})]})}return null}}),e.jsx(G,{}),i?.winningCamps?.map((t,a)=>e.jsx(k,{dataKey:t,stackId:"victory",fill:f[t]||`var(--chart-color-${a%6+1})`,name:t},t))]})})})})]}),m.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Victoire Spéciaux par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Types de victoire moins fréquents (",m.reduce((t,a)=>t+a.count,0)," parties sur ",i?.totalGames,")"]}),e.jsx(T,{title:"Types de Victoire Spéciaux par Camp",children:e.jsx("div",{style:{height:500},children:e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(C,{data:m,margin:{top:20,right:30,left:20,bottom:120},children:[e.jsx(N,{strokeDasharray:"3 3"}),e.jsx(V,{dataKey:"type",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:10}),e.jsx(w,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"},domain:[0,"dataMax"]}),e.jsx(F,{content:({active:t,payload:a,label:d})=>{if(t&&a&&a.length>0){const n=a.reduce((r,s)=>r+(s.value||0),0);let p="";return i?.totalGames&&n>0&&(p=(n/i.totalGames*100).toFixed(1)),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:300},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8},children:d}),e.jsxs("div",{style:{marginBottom:4},children:["Total: ",n," parties",p&&` (${p}%)`]}),a.filter(r=>r.value&&r.value>0).sort((r,s)=>(s.value||0)-(r.value||0)).map((r,s)=>{const o=n>0?((r.value||0)/n*100).toFixed(1):"0.0";return e.jsxs("div",{style:{marginBottom:2},children:[e.jsx("span",{style:{display:"inline-block",width:12,height:12,backgroundColor:r.color,marginRight:8,borderRadius:2}}),r.dataKey,": ",r.value," (",o,"%)"]},s)})]})}return null}}),e.jsx(G,{}),i?.winningCamps?.map((t,a)=>e.jsx(k,{dataKey:t,stackId:"victory",fill:f[t]||`var(--chart-color-${a%6+1})`,name:t},t))]})})})})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de victoire disponible"})}export{K as VictoryTypesChart};
