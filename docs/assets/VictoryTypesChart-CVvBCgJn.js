import{u as A,r as f,j as e}from"./index-IJBMYy_y.js";import{a as F}from"./baseStatsHook-Cc6ZV3F_.js";import{g as G}from"./gameUtils-rkfcKAVy.js";import{b as w}from"./api-2x3jNjc4.js";import{F as j,C as T,X as b,Y as C}from"./FullscreenChart-RQqCRGfp.js";import{R as V,T as N}from"./CategoricalChart-Cqxd7nSg.js";import{B as S,a as k}from"./BarChart-BAeVaoGQ.js";import"./datasyncExport-BirWLS1z.js";function R(t,a,o){const s=t.LegacyData?.VictoryType,c=G(t);return s&&s.trim()!==""&&c&&c.trim()!==""?(a[s]||(a[s]=0),a[s]++,o[s]||(o[s]={}),o[s][c]||(o[s][c]=0),o[s][c]++,!0):!1}function q(t){const a=new Set;return Object.values(t).forEach(o=>{Object.keys(o).forEach(s=>a.add(s))}),Array.from(a).sort()}function W(t,a,o,s,c){const p={type:t,count:a,percentage:(a/o*100).toFixed(1)},m=s[t]||{};return c.forEach(h=>{const x=m[h]||0,v=a>0?(x/a*100).toFixed(1):"0.0";p[h]=x,p[`${h}_percentage`]=v}),p}function $(t,a,o,s){const c=Object.keys(t).map(p=>W(p,t[p],a,o,s));return c.sort((p,m)=>m.count-p.count),c}function z(t){if(t.length===0)return null;const a={},o={};let s=0;t.forEach(m=>{R(m,a,o)&&s++});const c=q(o),p=$(a,s,o,c);return{totalGames:s,victoryTypes:p,winningCamps:c}}function L(){const{data:t,isLoading:a,error:o}=F(z);return{victoryTypesStats:t,isLoading:a,errorInfo:o}}function X(){const{victoryTypesStats:t,isLoading:a,errorInfo:o}=L(),{navigateToGameDetails:s}=A(),c=f.useMemo(()=>t?.victoryTypes?t.victoryTypes.map(r=>({...r,percentageNum:parseFloat(r.percentage)})):[],[t?.victoryTypes]),p=w(),{mainVictoryTypes:m,rareVictoryTypes:h}=f.useMemo(()=>{if(!c.length)return{mainVictoryTypes:[],rareVictoryTypes:[]};const r=Math.max(5,Math.ceil(c[0].count*.1)),i=c.filter(d=>d.count>=r),l=c.filter(d=>d.count<r);return{mainVictoryTypes:i,rareVictoryTypes:l}},[c]),x=a,v=o;return x?e.jsx("div",{className:"donnees-attente",children:"Chargement des types de victoire..."}):v?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",v]}):t?e.jsxs("div",{className:"lycans-victory-types-container",children:[e.jsx("h2",{children:"Types de Victoire"}),t&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Types Principaux"}),e.jsx("div",{className:"lycans-valeur-principale",children:m.length}),e.jsx("p",{children:"types fr√©quents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Types Sp√©ciaux"}),e.jsx("div",{className:"lycans-valeur-principale",children:h.length}),e.jsx("p",{children:"types rares"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:t?.totalGames||0}),e.jsx("p",{children:"parties analys√©es"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[m.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Victoire Principaux par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Types de victoire les plus fr√©quents (",m.reduce((r,i)=>r+i.count,0)," parties sur ",t?.totalGames,")"]}),e.jsx(j,{title:"Types de Victoire Principaux par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(S,{data:m,margin:{top:50,right:30,left:20,bottom:60},children:[e.jsx(T,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"type",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:11,tick:({x:r,y:i,payload:l})=>e.jsx("text",{x:r,y:i,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:11,transform:`rotate(-45 ${r} ${i})`,children:l.value})}),e.jsx(C,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(N,{content:({active:r,payload:i,label:l})=>{if(r&&i&&i.length>0){const d=i.reduce((n,u)=>n+(u.value||0),0);let y="";return t?.totalGames&&d>0&&(y=(d/t.totalGames*100).toFixed(1)),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:300},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8},children:l}),e.jsxs("div",{style:{marginBottom:4},children:["Total: ",d," parties",y&&` (${y}%)`]}),i.filter(n=>n.value&&n.value>0).sort((n,u)=>(u.value||0)-(n.value||0)).map((n,u)=>{const g=d>0?((n.value||0)/d*100).toFixed(1):"0.0";return e.jsxs("div",{style:{marginBottom:2},children:[e.jsx("span",{style:{display:"inline-block",width:12,height:12,backgroundColor:n.color,marginRight:8,borderRadius:2}}),n.dataKey,": ",n.value," (",g,"%)"]},u)}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),t?.winningCamps?.map((r,i)=>e.jsx(k,{dataKey:r,stackId:"victory",fill:p[r]||`var(--chart-color-${i%6+1})`,name:r,onClick:l=>{l&&l.type&&s({selectedVictoryType:l.type,fromComponent:"Types de Victoire Principaux"})},style:{cursor:"pointer"}},r))]})})})})]}),h.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Victoire Sp√©ciaux par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Types de victoire moins fr√©quents (",h.reduce((r,i)=>r+i.count,0)," parties sur ",t?.totalGames,")"]}),e.jsx(j,{title:"Types de Victoire Sp√©ciaux par Camp",children:e.jsx("div",{style:{height:500},children:e.jsx(V,{width:"100%",height:"100%",children:e.jsxs(S,{data:h,margin:{top:50,right:30,left:20,bottom:120},children:[e.jsx(T,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"type",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:10,tick:({x:r,y:i,payload:l})=>e.jsx("text",{x:r,y:i,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:10,transform:`rotate(-45 ${r} ${i})`,children:l.value})}),e.jsx(C,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"},domain:[0,"dataMax"]}),e.jsx(N,{content:({active:r,payload:i,label:l})=>{if(r&&i&&i.length>0){const d=i.reduce((n,u)=>n+(u.value||0),0);let y="";return t?.totalGames&&d>0&&(y=(d/t.totalGames*100).toFixed(1)),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:300},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:8},children:l}),e.jsxs("div",{style:{marginBottom:4},children:["Total: ",d," parties",y&&` (${y}%)`]}),i.filter(n=>n.value&&n.value>0).sort((n,u)=>(u.value||0)-(n.value||0)).map((n,u)=>{const g=d>0?((n.value||0)/d*100).toFixed(1):"0.0";return e.jsxs("div",{style:{marginBottom:2},children:[e.jsx("span",{style:{display:"inline-block",width:12,height:12,backgroundColor:n.color,marginRight:8,borderRadius:2}}),n.dataKey,": ",n.value," (",g,"%)"]},u)}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),t?.winningCamps?.map((r,i)=>e.jsx(k,{dataKey:r,stackId:"victory",fill:p[r]||`var(--chart-color-${i%6+1})`,name:r,onClick:l=>{l&&l.type&&s({selectedVictoryType:l.type,fromComponent:"Types de Victoire Sp√©ciaux"})},style:{cursor:"pointer"}},r))]})})})})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de victoire disponible"})}export{X as VictoryTypesChart};
