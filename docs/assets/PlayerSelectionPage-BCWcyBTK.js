import{a as pe,r as A,g as te,f as ze,u as ne,j as e,d as fe,e as $e,q as Le}from"./index-CkbIPiAg.js";import{u as me}from"./useJoueursData-B-rWxVSI.js";import{u as ye}from"./baseStatsHook-nlSFBhOL.js";import{g as Ie}from"./gameUtils-DYpUb-C5.js";import{a as Pe,g as ce,c as De,b as We}from"./datasyncExport-CjB7UYqV.js";import{u as ve,g as qe,b as oe,l as Ee,C as ie,f as Ce}from"./api-g4CRZrOd.js";import{f as se,d as Ge}from"./durationFormatters-C9UyWcKX.js";import{F as U,C as J,X as Q,Y as X,a as Y}from"./FullscreenChart-DF6LKLfD.js";import{R as O,T as K}from"./CategoricalChart-BJwnSjsq.js";import{L as Ve,a as Be}from"./LineChart-CFpjG288.js";import{B as ee,a as Z}from"./BarChart-C3K2HH_a.js";import{P as je,a as be}from"./PieChart-DV-CoLol.js";import{g as de}from"./deathTypes-gHH1w6_X.js";import{i as we,g as Se,V as Oe,a as Ke}from"./roleUtils-CLjkiQQc.js";import{L as Ne}from"./Legend-CIDDETmR.js";import{S as He,R as ae,e as _e,f as Ue,h as ue,a as Ye,b as Je,d as Qe}from"./deathLocationUtils-Ddvg7gTJ.js";import{a as Xe,u as Ze}from"./useClips-BC_UZkAo.js";import{C as et,f as Re,a as tt}from"./ClipViewer-CBIdObtX.js";import"./ActivePoints-Dfl9MEqd.js";import"./PolarChart-DiTrXYEd.js";function rt(r){const{settings:c}=pe(),{joueursData:b}=me(),[n,R]=A.useState(null),[a,o]=A.useState(!1),[h,l]=A.useState(null);A.useEffect(()=>{let d=!0;return(async()=>{try{o(!0),l(null);const u=c.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",s=await fetch(u);if(!s.ok)throw new Error(`Failed to load achievements: ${s.status} ${s.statusText}`);const p=await s.json();d&&R(p)}catch(u){d&&l(u instanceof Error?u.message:"Failed to load achievements")}finally{d&&o(!1)}})(),()=>{d=!1}},[c.dataSource]);const x=(()=>{if(!r||!n)return null;const i=b?.Players?.find(u=>u.Joueur===r)?.SteamID;return i&&n.achievements[i]||null})();return A.useEffect(()=>{r&&n&&b&&b.Players?.find(u=>u.Joueur===r)?.SteamID},[r,n,b,c.dataSource]),{data:x,isLoading:a,error:h,metadata:{generatedAt:n?.generatedAt||null,totalPlayers:n?.totalPlayers||0,totalGames:n?.totalGames||0,totalModdedGames:n?.totalModdedGames||0}}}function st(r,c,b){if(!r||r.trim()===""||c.length===0)return null;const n=[];let R=r;c.forEach(i=>{const u=i.PlayerStats.find(s=>te(s)===r||s.Username.toLowerCase()===r.toLowerCase());if(u){R=u.Username;const s=u.MainRoleInitial==="Louveteau"?u.MainRoleInitial:Pe(u.MainRoleInitial,u.MainRoleChanges||[]),p=ce(s);if(b&&b!=="Tous les camps"&&p!==b)return;const S=Ie(i),m=u.Victorious,v=ze(new Date(i.StartDate)),k=De(i.StartDate,i.EndDate)||0;n.push({gameId:i.Id,date:v,camp:p,won:m,winnerCamp:S,playersInGame:i.PlayerStats.length,mapName:i.MapName,duration:k})}}),n.sort((i,u)=>{const s=p=>{const S=p.split("/");return S.length===3?new Date(parseInt(S[2]),parseInt(S[1])-1,parseInt(S[0])):new Date(p)};return s(u.date).getTime()-s(i.date).getTime()});const a=n.length,o=n.filter(i=>i.won).length,h=a>0?(o/a*100).toFixed(2):"0.00",l={};n.forEach(i=>{l[i.camp]||(l[i.camp]={appearances:0,wins:0,winRate:"0.00"}),l[i.camp].appearances++,i.won&&l[i.camp].wins++}),Object.keys(l).forEach(i=>{const u=l[i];u.winRate=u.appearances>0?(u.wins/u.appearances*100).toFixed(2):"0.00"});const x={};n.forEach(i=>{x[i.mapName]||(x[i.mapName]={appearances:0,wins:0,winRate:"0.00"}),x[i.mapName].appearances++,i.won&&x[i.mapName].wins++}),Object.keys(x).forEach(i=>{const u=x[i];u.winRate=u.appearances>0?(u.wins/u.appearances*100).toFixed(2):"0.00"});const d=n.reduce((i,u)=>i+u.duration,0);return{playerName:R,totalGames:a,totalWins:o,winRate:h,totalPlayTime:d,games:n,campStats:l,mapStats:x}}function he(r,c){const{data:b,isLoading:n,error:R}=ye(a=>r?st(r,a,c):null);return{data:b,isLoading:n,error:R}}function at(r){const{settings:c}=pe(),[b,n]=A.useState(null),[R,a]=A.useState(null),[o,h]=A.useState(!0),[l,x]=A.useState(null);return A.useEffect(()=>{(async()=>{h(!0),x(null);try{const i=c.dataSource==="discord"?"/data/discord/playerTitles.json":"/data/playerTitles.json",u=await fetch(i);if(!u.ok){if(u.status===404)n(null),a(null),x("Les titres n'ont pas encore Ã©tÃ© gÃ©nÃ©rÃ©s. Ils seront disponibles aprÃ¨s la prochaine synchronisation hebdomadaire.");else throw new Error(`HTTP error! status: ${u.status}`);return}const s=await u.json();if(n(s),r&&s.players){const p=Object.entries(s.players).find(([S,m])=>m.playerName===r);a(p?p[1]:null)}else a(null)}catch(i){console.error("Error loading player titles:",i),x(i instanceof Error?i.message:"Erreur inconnue"),n(null),a(null)}finally{h(!1)}})()},[c.dataSource,r]),{data:b,playerData:R,isLoading:o,error:l}}function it({achievements:r,title:c,emptyMessage:b,achievementType:n="all"}){const{navigateToTab:R,updateNavigationState:a,clearNavigation:o}=ne(),{settings:h,updateSettings:l}=pe(),{joueursData:x}=me(),d=ve(x),i=(t,D)=>{if(D.stopPropagation(),!t.redirectTo)return;o();const L=h.highlightedPlayer;if(l(n==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:L,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:L,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const C=h.highlightedPlayer||"",f=u(t.description,C);f&&a({playerComparisonState:{selectedPlayer1:C,selectedPlayer2:f,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const C=t.description.toLowerCase().includes("loup");a({selectedPairingTab:C?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const C=t.description.match(/(Villageois|Loups|Autres)/i);C&&a({deathStatsSelectedCamp:C[1]});let f=10;const g=t.description.match(/min\.\s*(\d+)/);g&&(f=parseInt(g[1],10));let w="totalKills",y="killers";const T=t.redirectTo.chartSection;T&&(T==="killers-total"?(w="totalKills",y="killers"):T==="killers-average"?(w="averageKills",y="killers"):T==="deaths-total"?(w="totalDeaths",y="deaths"):T==="survivors-average"?(w="survivalRate",y="deaths"):(T==="hunters-good"||T==="hunters-bad")&&(y="hunter",w="averageKills")),a({deathStatisticsState:{selectedCamp:C?.[1]||"Tous les camps",minGamesForAverage:f,selectedView:y,focusChart:w}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const C=t.redirectTo.mapFilter||"all";let f=10;const g=t.description.match(/min\.\s*(\d+)/);g&&(f=parseInt(g[1])),l(n==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:C,playerFilter:{mode:"none",players:[]},highlightedPlayer:L,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:C,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:C,playerFilter:{mode:"none",players:[]},highlightedPlayer:L,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:C,playerFilter:{mode:"none",players:[]}}}),a({playersGeneralState:{minGamesForWinRate:f,winRateOrder:"best",focusChart:"winRate"}}),R("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&a({selectedPlayerName:h.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let C="wins";const f=t.title.toLowerCase(),g=t.description.toLowerCase();f.includes("dÃ©faite")||g.includes("dÃ©faite")?C="losses":f.includes("loup")||g.includes("loup")?C="loup":f.includes("villageois")||g.includes("villageois")?C="villageois":(f.includes("victoire")||g.includes("victoire"))&&(C="wins"),a({selectedSeriesType:C})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let C=10;const f=t.description.match(/min\.\s*(\d+)/);f&&(C=parseInt(f[1],10));let g="winRate",w="best";const y=t.title.toLowerCase(),T=t.description.toLowerCase();y.includes("participation")||T.includes("participation")?g="participation":(y.includes("taux de victoire")||T.includes("taux de victoire"))&&(g="winRate",(y.includes("moins bon")||y.includes("mauvais")||T.includes("moins bon")||T.includes("mauvais"))&&(w="worst")),a({playersGeneralState:{minGamesForWinRate:C,winRateOrder:w,focusChart:g}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const C=t.redirectTo.chartSection;let f="Villageois",g=1;C&&(C==="camp-loup"?f="Loup":C==="camp-villageois"?f="Villageois":C==="camp-idiot"?f="Idiot du Village":C==="camp-amoureux"?f="Amoureux":(C==="solo-roles"||C==="hall-of-fame")&&(f="Villageois"));const w=t.description.match(/min\.\s*(\d+)/);w&&(g=parseInt(w[1],10)),C==="solo-roles"?f="RÃ´les spÃ©ciaux":C==="hall-of-fame"&&(f="Tous les camps"),a({campPerformanceState:{selectedCampPerformanceCamp:f,selectedCampPerformanceMinGames:g,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const C=t.title.toLowerCase();let f="overview",g="behavior";C.includes("agressivitÃ©")?(f="overview",g="behavior"):C.includes("taux de vote")?(f="behavior",g="voteRate"):C.includes("prÃ©cision")&&(f="overview",g="accuracy"),a({votingStatsState:{selectedCategory:f,selectedView:g}})}if(t.category==="loot"&&t.redirectTo.subTab==="lootStats"){const C=t.redirectTo,f=C.minGames||5,g=C.view||"normalized";a({lootStatsState:{minGames:f,campFilter:"all",view:g}})}R(t.redirectTo.tab,t.redirectTo.subTab)},u=(t,D)=>{const L=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const C of L){const f=t.match(C);if(f&&f[1]){const g=f[1].trim();if(g!==D)return g}}return null},s=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const C=t.description.match(/min\.\s*(\d+)/),f=C?parseInt(C[1],10):10,g=t.title.toLowerCase(),w=n==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return g.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${f} parties)${w}`:g.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${w}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${w}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const C=t.redirectTo.mapFilter,f=C==="village"?"Village":C==="chateau"?"ChÃ¢teau":"map",g=n==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${f}${g}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${u(t.description,h.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const C=t.description.match(/(Villageois|Loups|Autres)/i),f=t.description.match(/min\.\s*(\d+)/),g=f?parseInt(f[1],10):10,w=C?.[1]||"Tous les camps",y=t.redirectTo.chartSection;let T="kills et morts";return y==="killers-total"?T="total des kills":y==="killers-average"?T=`moyenne des kills (min. ${g} parties)`:y==="deaths-total"?T="total des morts":y==="survivors-average"&&(T=`taux de survie (min. ${g} parties)`),`Cliquez pour voir les statistiques de ${T} ${w!=="Tous les camps"?`en ${w}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const C=t.title.toLowerCase(),f=t.description.toLowerCase();return C.includes("dÃ©faite")||f.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":C.includes("loup")||f.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":C.includes("villageois")||f.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":C.includes("victoire")||f.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const C=t.redirectTo.chartSection,f=n==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return C==="camp-loup"?`Cliquez pour voir les performances camp Loup${f}`:C==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${f}`:C==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${f}`:C==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${f}`:C==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${f}`:C==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${f}`:`Cliquez pour voir les performances par camp${f}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const C=t.description.match(/min\.\s*(\d+)/),f=C?parseInt(C[1],10):25,g=n==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",w=t.title.toLowerCase();return w.includes("agressivitÃ©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${f} meetings)${g}`:w.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${f} meetings)${g}`:w.includes("prÃ©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${g}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${g}`}break;case"loot":if(t.redirectTo.subTab==="lootStats"){const C=t.description.match(/min\.\s*(\d+)/),f=C?parseInt(C[1],10):25,g=n==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de rÃ©colte (min. ${f} parties)${g}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(n==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},p=t=>d[t]||qe(t),S=t=>{const D=[/avec ([^:]+?):/,/contre ([^:]+?):/];let L=t;return D.forEach(C=>{const f=t.match(C);if(f&&f[1]){const g=f[1].trim(),y=`<span class="player-name-highlight" style="color: ${p(g)};">${g}</span>`;L=L.replace(g,y)}}),L};if(r.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:c}),e.jsx("p",{children:b||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const m=t=>t===1?"ðŸ¥‡":t===2?"ðŸ¥ˆ":t===3?"ðŸ¥‰":"",v=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",k=(t,D)=>{if(!t||t<=3||!D)return;const L=t-3,C=D-3;return C<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(L-1)/(C-1))}, 70%, 50%)`},P=(t,D)=>{if(!t||!D)return;if(D<=1)return"hsl(0, 70%, 50%)";const L=(t-1)/(D-1),C=L*15,f=50-L*15;return`hsl(${C}, 70%, ${f}%)`},z=t=>{if(!t)return;const D=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(D){const[,L,C]=D;return`hsl(${L}, ${C}%, 40%)`}return t},M=r.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,D)=>(t.rank??999)-(D.rank??999)),F=r.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,D)=>(t.rank??999)-(D.rank??999)),B=r.filter(t=>t.category==="comparison"),G=[...M,...F].sort((t,D)=>(t.rank??999)-(D.rank??999)),I=M.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:c}),I>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:M.filter(t=>t.rank&&t.rank<=3).map((t,D)=>e.jsxs("div",{className:`top3-card ${v(t.rank)} animate-slide-in`,style:{animationDelay:`${D*.15}s`},onClick:L=>i(t,L),title:s(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:m(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:t.title}),e.jsx("p",{className:"top3-achievement-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},t.id))})]}),G.length>0&&e.jsxs("div",{className:"achievements-section unified-rankings",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:G.filter(t=>t.type==="bad"?!0:!t.rank||t.rank>3).map((t,D)=>{const L=t.type==="bad",C=L?P(t.rank,t.totalRanked):k(t.rank,t.totalRanked),f=z(C),g=L?"":v(t.rank);return e.jsxs("div",{className:`achievement-card ${L?"bad":"good"} ${g}`,onClick:w=>i(t,w),title:s(t),style:{animationDelay:`${D*.05}s`,borderLeftColor:f,borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsxs("span",{className:"achievement-title",children:[L&&"ðŸ’€ ",t.title]}),e.jsxs("span",{className:"achievement-rank",style:C?{backgroundColor:C}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:t.description})]},t.id)})})]}),B.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques CoÃ©quipiers et Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:B.map(t=>e.jsxs("div",{className:"achievement-card comparison",onClick:D=>i(t,D),title:s(t),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:t.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:S(t.description)}})]},t.id))})]})]})}function nt({selectedPlayerName:r,groupingMethod:c,campFilter:b="all"}){const{navigateToGameDetails:n}=ne(),{data:R,isLoading:a,error:o}=he(r),h=A.useMemo(()=>{switch(c){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[c]),l=A.useMemo(()=>{if(!R?.games)return new Map;const u=new Map;return R.games.forEach(s=>{if(!u.has(s.date)){const p=s.date.split("/");p.length===3?u.set(s.date,new Date(parseInt(p[2]),parseInt(p[1])-1,parseInt(p[0])).getTime()):u.set(s.date,new Date(s.date).getTime())}}),u},[R?.games]),x=A.useMemo(()=>{if(!R?.games)return[];const u={};return R.games.forEach(s=>{if(b!=="all"){if(b==="solo"){if(s.camp==="Villageois"||s.camp==="Loup")return}else if(s.camp!==b)return}let p;const S=s.date.split("/");if(c==="month")if(S.length===3)p=`${S[1].padStart(2,"0")}/${S[2]}`;else{const m=new Date(s.date);p=`${String(m.getMonth()+1).padStart(2,"0")}/${m.getFullYear()}`}else if(c==="quarter")if(S.length===3){const m=parseInt(S[1],10);p=`T${Math.floor((m-1)/3)+1}/${S[2]}`}else{const m=new Date(s.date);p=`T${Math.floor(m.getMonth()/3)+1}/${m.getFullYear()}`}else c==="year"?S.length===3?p=`${S[2]}`:p=`${new Date(s.date).getFullYear()}`:p=s.date;u[p]||(u[p]={games:[],wins:0,total:0}),u[p].games.push(s),u[p].total++,s.won&&u[p].wins++}),Object.entries(u).map(([s,p])=>({period:s,totalGames:p.total,victories:p.wins,defeats:p.total-p.wins,winRate:p.total>0?(p.wins/p.total*100).toFixed(1):"0.0",winRateNum:p.total>0?p.wins/p.total*100:0})).sort((s,p)=>{if(c==="month"){const[S,m]=s.period.split("/"),[v,k]=p.period.split("/"),P=new Date(parseInt(m),parseInt(S)-1,1),z=new Date(parseInt(k),parseInt(v)-1,1);return P.getTime()-z.getTime()}else if(c==="quarter"){const[S,m]=s.period.split("/"),[v,k]=p.period.split("/"),P=parseInt(S.replace(/\D/g,""),10)||1,z=parseInt(v.replace(/\D/g,""),10)||1,M=new Date(parseInt(m,10),(P-1)*3,1),F=new Date(parseInt(k,10),(z-1)*3,1);return M.getTime()-F.getTime()}else if(c==="year"){const S=parseInt(s.period,10),m=parseInt(p.period,10);return S-m}else{const S=l.get(s.period)||0,m=l.get(p.period)||0;return S-m}})},[R,c,l,b]),i=(u=>u<=15?{fontSize:12,angle:-45,height:80,interval:0}:u<=30?{fontSize:12,angle:-45,height:85,interval:1}:u<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(u/12)})(x.length);return a?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):o?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",o]}):R?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",h]}),e.jsx(U,{title:`Ã‰volution des Performances ${h}`,children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:x,margin:{top:20,right:30,left:20,bottom:20},onClick:u=>{if(u&&u.activeLabel){const s=x.find(p=>p.period===u.activeLabel);s&&n({selectedPlayer:r,selectedDate:s.period,fromComponent:`Ã‰volution des Performances ${h}`})}},style:{cursor:"pointer"},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"period",angle:i.angle,textAnchor:"end",height:i.height,interval:i.interval,fontSize:i.fontSize}),e.jsx(X,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(K,{content:({active:u,payload:s})=>{if(u&&s&&s.length>0){const p=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:p.period})}),e.jsxs("div",{children:["Parties: ",p.totalGames]}),e.jsxs("div",{children:["Victoires: ",p.victories]}),e.jsxs("div",{children:["Taux: ",p.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Be,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",h]}),e.jsx(U,{title:`RÃ©partition Victoires/DÃ©faites ${h}`,children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:x,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"period",angle:i.angle,textAnchor:"end",height:i.height,interval:i.interval,fontSize:i.fontSize}),e.jsx(X,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:u,payload:s})=>{if(u&&s&&s.length>0){const p=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:p.period})}),e.jsxs("div",{children:["Total: ",p.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",p.victories]}),e.jsxs("div",{children:["DÃ©faites: ",p.defeats]}),e.jsxs("div",{children:["Taux: ",p.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Z,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:x.map((u,s)=>e.jsx(Y,{fill:"var(--accent-tertiary)",onClick:()=>{n({selectedPlayer:r,selectedDate:u.period,fromComponent:`Historique Joueur - Victoires ${h}`})},style:{cursor:"pointer"}},`cell-victories-${s}`))}),e.jsx(Z,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:x.map((u,s)=>e.jsx(Y,{fill:"var(--chart-color-4)",onClick:()=>{n({selectedPlayer:r,selectedDate:u.period,fromComponent:`Historique Joueur - DÃ©faites ${h}`})},style:{cursor:"pointer"}},`cell-defeats-${s}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function ot({selectedPlayerName:r}){const{navigateToGameDetails:c}=ne(),{data:b,isLoading:n,error:R}=he(r),a=oe(),o=A.useMemo(()=>b?.campStats?Object.entries(b.campStats).map(([l,x])=>({name:l,value:x.appearances,winRate:x.winRate,winRateDisplay:Math.max(parseFloat(x.winRate),1),wins:x.wins,percentage:(x.appearances/b.totalGames*100).toFixed(1)})):[],[b]),h=A.useMemo(()=>{if(!o.length)return[];const l=5;let x=0;const d=[],i=[];if(o.forEach(u=>{parseFloat(u.percentage)<l?(x+=Number(u.value),d.push(u)):i.push(u)}),x>0){const u=o.reduce((s,p)=>s+Number(p.value),0);i.push({name:"Autres",value:x,winRate:"0.0",winRateDisplay:1,wins:d.reduce((s,p)=>s+p.wins,0),percentage:(x/u*100).toFixed(1),_details:d})}return i},[o]);return n?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):R?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",R]}):b?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(je,{children:[e.jsx(be,{data:h,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:l=>{const x=l.percent!==void 0?l.percent:0;return l.name==="Autres"?`Autres : ${l.value} (${(x*100).toFixed(1)}%)`:`${l.name}: ${l.value} (${(x*100).toFixed(1)}%)`},children:h.map((l,x)=>e.jsx(Y,{fill:l.name==="Autres"?Ee:a[l.name]||`var(--chart-color-${x%6+1})`,onClick:()=>{if(l.name==="Autres"){const d=l._details?.map(i=>i.name)||[];c({selectedPlayer:r,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:d},fromComponent:"Distribution par Camps"})}else l.name==="TraÃ®tre"||l.name==="Louveteau"?c({selectedPlayer:r,campFilter:{selectedCamp:l.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):l.name==="Loup"?c({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):c({selectedPlayer:r,campFilter:{selectedCamp:l.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${x}`))}),e.jsx(K,{content:({active:l,payload:x})=>{if(l&&x&&x.length>0){const d=x[0].payload;if(d.name==="Autres"&&d._details){const i=[...d._details].sort((u,s)=>s.value-u.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",d.value," parties (",d.percentage,"%)"]})}),e.jsx("div",{children:i.map((u,s)=>e.jsxs("div",{children:[u.name,": ",u.value," parties (",u.percentage,"%)"]},s))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[d.name," - ",d.value," parties (",d.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(U,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:o,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(K,{content:({active:l,payload:x})=>{if(l&&x&&x.length>0){const d=x[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:d.name})}),e.jsxs("div",{children:["Victoires: ",d.wins," / ",d.value]}),e.jsxs("div",{children:["Taux: ",d.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Z,{dataKey:"winRateDisplay",children:o.map((l,x)=>e.jsx(Y,{fill:parseFloat(l.winRate)===0?`${a[l.name]||`var(--chart-color-${x%6+1})`}50`:a[l.name]||`var(--chart-color-${x%6+1})`,onClick:()=>{l.name==="TraÃ®tre"||l.name==="Louveteau"?c({selectedPlayer:r,campFilter:{selectedCamp:l.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):l.name==="Loup"?c({selectedPlayer:r,campFilter:{selectedCamp:l.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):c({selectedPlayer:r,campFilter:{selectedCamp:l.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${x}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function lt({selectedPlayerName:r}){const{gameData:c}=fe(),{joueursData:b}=me(),n=ve(b),R=oe(),a=A.useMemo(()=>{if(!c||!r)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const h={},l={},x={},d=new Set;c.forEach(S=>{const m=S.PlayerStats.find(v=>v.Username.toLowerCase()===r.toLowerCase());if(m&&(S.PlayerStats.forEach(v=>{v.KillerName?.toLowerCase()===r.toLowerCase()&&(h[v.Username]=(h[v.Username]||0)+1)}),m.KillerName&&(l[m.KillerName]=(l[m.KillerName]||0)+1),m.DeathType)){const v=m.DeathType,k=de(v);x[k]||(x[k]={count:0,byDeathType:{}}),x[k].count+=1,x[k].byDeathType[v]=(x[k].byDeathType[v]||0)+1,d.add(v)}});const i=Object.entries(h).map(([S,m])=>({player:S,kills:m})).sort((S,m)=>m.kills-S.kills).slice(0,ie.TOP_10),u=Object.entries(l).map(([S,m])=>({player:S,kills:m})).sort((S,m)=>m.kills-S.kills).slice(0,ie.TOP_10),s=Object.entries(x).map(([S,m])=>{const v={deathType:S,count:m.count};return v[S]=m.count,v}).sort((S,m)=>m.count-S.count).slice(0,ie.TOP_10),p=Object.keys(x);return{playersKilled:i,killedBy:u,deathTypes:s,availableDeathTypes:p}},[c,r]),o=A.useMemo(()=>{const h={};a.availableDeathTypes.forEach(d=>{d==="TuÃ© par Loup"?h[d]=R.Loup:d==="Mort aux votes"?h[d]="var(--chart-color-1)":d.includes("Chasseur")?h[d]=R.Chasseur:d==="TuÃ© par Zombie"?h[d]=R.Vaudou:d==="TuÃ© par potion assassin"?h[d]=R.Alchimiste:d==="TuÃ© par Vengeur"?h[d]="var(--chart-color-2)":d==="Amoureux mort"?h[d]=R.Amoureux:d==="TuÃ© par La BÃªte"?h[d]="var(--chart-color-3)":d==="TuÃ© par ShÃ©rif"&&(h[d]="var(--chart-color-4)")});const l=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let x=0;return a.availableDeathTypes.forEach(d=>{h[d]||(h[d]=l[x%l.length],x++)}),h},[a.availableDeathTypes,R]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[a.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(U,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:h,payload:l})=>{if(h&&l&&l.length>0){const x=l[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:x.player})}),e.jsxs("div",{children:["TuÃ© ",x.kills," fois par ",r]})]})}return null}}),e.jsx(Z,{dataKey:"kills",children:a.playersKilled.map((h,l)=>e.jsx(Y,{fill:n[h.player]||"var(--chart-color-3)"},`cell-killed-${l}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[r," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),a.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(U,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:h,payload:l})=>{if(h&&l&&l.length>0){const x=l[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:x.player})}),e.jsxs("div",{children:["A tuÃ© ",r," ",x.kills," fois"]})]})}return null}}),e.jsx(Z,{dataKey:"kills",children:a.killedBy.map((h,l)=>e.jsx(Y,{fill:n[h.player]||"var(--chart-color-4)"},`cell-killer-${l}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[r," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),a.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(U,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:h,payload:l})=>{if(h&&l&&l.length>0){const x=l[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:x.deathType})}),e.jsxs("div",{children:[r," est mort ",x.count," fois ainsi"]})]})}return null}}),a.availableDeathTypes.map(h=>e.jsx(Z,{dataKey:h,name:h,stackId:"deaths",fill:o[h]||"var(--chart-color-5)"},h))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",r,"."]})]})]})}function ct(r,c){if(!r||r.trim()===""||c.length===0)return null;const b=new Map,n=new Map,R=new Map;c.forEach(x=>{if(!x.Modded)return;const d=x.PlayerStats.find(i=>te(i)===r||i.Username.toLowerCase()===r.toLowerCase());if(d){if(d.MainRoleInitial==="Inconnu")return;const i=d.Victorious,s=Pe(d.MainRoleInitial,d.MainRoleChanges||[])!==d.MainRoleInitial,p=ce(d.MainRoleInitial),S=p==="Loup"||p==="TraÃ®tre"||p==="Louveteau";if(p==="Villageois"&&we(d)){const m=Se(d);if(m&&Oe.includes(m)){const v=b.get(m)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};b.set(m,{appearances:v.appearances+1,wins:v.wins+(i?1:0),winsWithoutRoleChange:v.winsWithoutRoleChange+(!s&&i?1:0),gamesWithoutRoleChange:v.gamesWithoutRoleChange+(s?0:1)})}}else if(d.Power&&d.Power.trim()!==""&&d.Power!=="Inconnu"){if(p==="Villageois"){const m=b.get(d.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};b.set(d.Power,{appearances:m.appearances+1,wins:m.wins+(i?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!s&&i?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(s?0:1)})}else if(S){const m=n.get(d.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},v=m.roleBreakdown;v.set(d.MainRoleInitial,(v.get(d.MainRoleInitial)||0)+1),n.set(d.Power,{appearances:m.appearances+1,wins:m.wins+(i?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!s&&i?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(s?0:1),roleBreakdown:v})}}else if((p==="Villageois"||S)&&d.Power!=="Inconnu")if(p==="Villageois"){const m=b.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};b.set("Aucun pouvoir",{appearances:m.appearances+1,wins:m.wins+(i?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!s&&i?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(s?0:1)})}else{const m=n.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},v=m.roleBreakdown;v.set(d.MainRoleInitial,(v.get(d.MainRoleInitial)||0)+1),n.set("Aucun pouvoir",{appearances:m.appearances+1,wins:m.wins+(i?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!s&&i?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(s?0:1),roleBreakdown:v})}if(d.SecondaryRole&&d.SecondaryRole.trim()!==""&&d.SecondaryRole!=="Inconnu"){const m=R.get(d.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};R.set(d.SecondaryRole,{appearances:m.appearances+1,wins:m.wins+(i?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!s&&i?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(s?0:1)})}}});const a=new Map;c.forEach(x=>{const d=x.PlayerStats.find(i=>te(i)===r||i.Username.toLowerCase()===r.toLowerCase());if(d&&we(d)){const i=Se(d);i&&a.set(i,(a.get(i)||0)+1)}});const o=x=>Array.from(x.entries()).map(([d,i])=>({name:d,appearances:i.appearances,wins:i.wins,winsWithoutRoleChange:i.winsWithoutRoleChange,gamesWithoutRoleChange:i.gamesWithoutRoleChange,winRate:i.gamesWithoutRoleChange>0?(i.winsWithoutRoleChange/i.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...a.has(d)&&{totalGamesAllModes:a.get(d)}})).sort((d,i)=>i.appearances-d.appearances),h=x=>Array.from(x.entries()).map(([d,i])=>({name:d,appearances:i.appearances,wins:i.wins,winsWithoutRoleChange:i.winsWithoutRoleChange,gamesWithoutRoleChange:i.gamesWithoutRoleChange,winRate:i.gamesWithoutRoleChange>0?(i.winsWithoutRoleChange/i.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(i.roleBreakdown.entries()).map(([u,s])=>({role:u,count:s})).sort((u,s)=>s.count-u.count)})).sort((d,i)=>i.appearances-d.appearances),l=x=>Array.from(x.entries()).map(([d,i])=>({name:d,appearances:i.appearances,wins:i.wins,winsWithoutRoleChange:i.winsWithoutRoleChange,gamesWithoutRoleChange:i.gamesWithoutRoleChange,winRate:i.gamesWithoutRoleChange>0?(i.winsWithoutRoleChange/i.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((d,i)=>i.appearances-d.appearances);return{villageoisPowers:o(b),loupPowers:h(n),secondaryRoles:l(R)}}function dt({selectedPlayerName:r}){const{navigateToGameDetails:c,navigationState:b,updateNavigationState:n}=ne(),R=oe(),[a,o]=A.useState(b.playerHistoryRolesState?.chartMode||"appearances"),{data:h,isLoading:l,error:x}=ye(v=>ct(r,v));A.useEffect(()=>{(!b.playerHistoryRolesState||b.playerHistoryRolesState.chartMode!==a)&&n({playerHistoryRolesState:{chartMode:a}})},[a,b.playerHistoryRolesState,n]);const d=v=>{o(v),n({playerHistoryRolesState:{chartMode:v}})},i=A.useMemo(()=>{if(!h)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const v=1,k=1,P=15,z=a==="winRate"?(F,B)=>parseFloat(B.winRate)-parseFloat(F.winRate):(F,B)=>B.appearances-F.appearances,M=F=>({...F,winRateDisplay:Math.max(parseFloat(F.winRate),1)});return{villageoisPowers:h.villageoisPowers.filter(F=>F.appearances>=v).map(M).sort(z).slice(0,P),loupPowers:h.loupPowers.filter(F=>F.appearances>=v).map(M).sort(z).slice(0,P),secondaryRoles:h.secondaryRoles.filter(F=>F.appearances>=k).map(M).sort(z).slice(0,P)}},[h,a]);if(l)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(x)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",x]});if(!h)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const u=i.villageoisPowers.length>0,s=i.loupPowers.length>0,p=i.secondaryRoles.length>0;if(!u&&!s&&!p)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const S=({active:v,payload:k})=>{if(v&&k&&k.length>0){const P=k[0].payload,z=P.gamesWithoutRoleChange<P.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:P.name})}),e.jsxs("div",{children:["Apparitions: ",P.appearances]}),z&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",P.appearances-P.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",P.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",P.winRate,"%"]})}),P.totalGamesAllModes&&P.totalGamesAllModes!==P.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",P.totalGamesAllModes,")"]}),P.roleBreakdown&&P.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),P.roleBreakdown.map((M,F)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",M.role,": ",M.count]},F))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},m=(v,k,P,z,M)=>{const F=a==="appearances"?"appearances":"winRateDisplay",B=a==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",G=a==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:k}),e.jsx(U,{title:k,children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:v,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:B,angle:270,position:"left",style:{textAnchor:"middle"}},domain:G}),e.jsx(K,{content:e.jsx(S,{})}),e.jsx(Z,{dataKey:F,label:a==="winRate"?I=>{const{x:t,y:D,width:L,payload:C}=I;if(t===void 0||D===void 0||L===void 0||!C)return null;const f=C.winRate||"0";return e.jsxs("text",{x:t+L/2,y:D-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[f,"%"]})}:void 0,children:v.map((I,t)=>e.jsx(Y,{fill:M?M(I.name,t):P,onClick:()=>z(I.name),style:{cursor:"pointer"}},`cell-${t}`))})]})})})})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:a,onChange:v=>d(v.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[u&&m(i.villageoisPowers,"Camp Villageois","var(--chart-color-1)",v=>{c({selectedPlayer:r,campFilter:{selectedCamp:"Villageois",campFilterMode:a==="winRate"?"wins-only":"all-assignments"},selectedPower:v,fromComponent:`Historique des RÃ´les - Pouvoir: ${v}`})},v=>v==="Chasseur"&&R.Chasseur?R.Chasseur:v==="Alchimiste"&&R.Alchimiste?R.Alchimiste:v==="Protecteur"&&R.Protecteur?R.Protecteur:v==="Disciple"&&R.Disciple?R.Disciple:"var(--chart-color-1)"),s&&m(i.loupPowers,"Camp Loups","var(--chart-color-2)",v=>{c({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:a==="winRate"?"wins-only":"all-assignments"},selectedPower:v,fromComponent:`Historique des RÃ´les - Pouvoir: ${v}`})},()=>R.Loup||"var(--chart-color-2)"),p&&m(i.secondaryRoles,"RÃ´les Secondaires","var(--chart-color-3)",v=>{c({selectedPlayer:r,selectedSecondaryRole:v,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${v}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}const ke=["Transform","Untransform","UseGadget","HunterShoot","DrinkPotion"],ut={Transform:"Transformation (Loup)",Untransform:"DÃ©transformation",UseGadget:"Utilisation Gadget",HunterShoot:"Tir du Chasseur",DrinkPotion:"Potion bue"},pt={Transform:"var(--wolf-color, #8B0000)",Untransform:"var(--wolf-color-light, #CD5C5C)",UseGadget:"var(--chart-color-1, #8884d8)",HunterShoot:"var(--chart-color-2, #82ca9d)",DrinkPotion:"var(--chart-color-3, #ffc658)"};function mt({selectedPlayerName:r}){const{gameData:c}=fe(),b=oe(),n=A.useMemo(()=>{if(!c||!r)return{actionTypeCounts:[],gadgetDetails:[],potionDetails:[],hunterTargets:[],transformationsPerGame:0,totalGamesWithActions:0,totalGamesPlayed:0};const a={Transform:0,Untransform:0,UseGadget:0,HunterShoot:0,DrinkPotion:0},o={},h={},l={};let x=0,d=0;c.forEach(k=>{const P=k.PlayerStats.find(M=>M.Username.toLowerCase()===r.toLowerCase());if(!P)return;d++;let z=!1;P.Actions&&Array.isArray(P.Actions)&&P.Actions.forEach(M=>{const F=M.ActionType;ke.includes(F)&&(a[F]++,z=!0,F==="UseGadget"&&M.ActionName&&M.ActionName!=="Balle"&&(o[M.ActionName]=(o[M.ActionName]||0)+1),F==="DrinkPotion"&&M.ActionName&&(h[M.ActionName]=(h[M.ActionName]||0)+1),F==="HunterShoot"&&M.ActionTarget&&(l[M.ActionTarget]=(l[M.ActionTarget]||0)+1))}),z&&x++});const i=ke.filter(k=>a[k]>0).map(k=>({actionType:k,label:ut[k],count:a[k],color:pt[k]})).sort((k,P)=>P.count-k.count),u=Object.entries(o).map(([k,P])=>({gadgetName:k,count:P})).sort((k,P)=>P.count-k.count).slice(0,ie.TOP_10),s=Object.entries(h).map(([k,P])=>({potionName:k,count:P})).sort((k,P)=>P.count-k.count).slice(0,ie.TOP_10),p=Object.entries(l).map(([k,P])=>({target:k,count:P})).sort((k,P)=>P.count-k.count).slice(0,ie.TOP_10),S=a.Transform,m=S>0?Math.max(1,c.filter(k=>k.PlayerStats.find(z=>z.Username.toLowerCase()===r.toLowerCase())?.Actions?.some(z=>z.ActionType==="Transform")).length):0,v=m>0?S/m:0;return{actionTypeCounts:i,gadgetDetails:u,potionDetails:s,hunterTargets:p,transformationsPerGame:v,totalGamesWithActions:x,totalGamesPlayed:d}},[c,r]);return n.actionTypeCounts.length>0?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ® Parties avec actions"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:n.totalGamesWithActions}),e.jsxs("p",{children:["sur ",n.totalGamesPlayed," parties analysÃ©es"]})]}),n.actionTypeCounts.find(a=>a.actionType==="Transform")&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸº Transformations / partie loup"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:b.Loup||"var(--wolf-color)"},children:n.transformationsPerGame.toFixed(1)}),e.jsx("p",{children:"en moyenne par partie loup"})]}),n.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ”§ Gadgets utilisÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:n.gadgetDetails.reduce((a,o)=>a+o.count,0)}),e.jsxs("p",{children:[n.gadgetDetails.length," types diffÃ©rents"]})]}),n.potionDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ§ª Potions bues"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:n.potionDetails.reduce((a,o)=>a+o.count,0)}),e.jsxs("p",{children:[n.potionDetails.length," types diffÃ©rents"]})]})]}),n.actionTypeCounts.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"RÃ©partition des Types d'Actions"}),e.jsx(U,{title:"RÃ©partition des Types d'Actions",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(je,{children:[e.jsx(be,{data:n.actionTypeCounts,dataKey:"count",nameKey:"label",cx:"50%",cy:"50%",outerRadius:120,label:a=>{const o=a.percent!==void 0?a.percent:0;return`${a.label}: ${a.count} (${(o*100).toFixed(0)}%)`},labelLine:!0,children:n.actionTypeCounts.map((a,o)=>e.jsx(Y,{fill:a.color},`cell-${o}`))}),e.jsx(K,{content:({active:a,payload:o})=>{if(a&&o&&o.length>0){const h=o[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:h.label})}),e.jsxs("div",{children:[h.count," fois"]})]})}return null}}),e.jsx(Ne,{})]})})})})]}),n.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Gadgets UtilisÃ©s"}),e.jsx(U,{title:"Gadgets UtilisÃ©s",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n.gadgetDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"gadgetName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Utilisations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:a,payload:o})=>{if(a&&o&&o.length>0){const h=o[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:h.gadgetName})}),e.jsxs("div",{children:["UtilisÃ© ",h.count," fois"]})]})}return null}}),e.jsx(Z,{dataKey:"count",fill:"var(--chart-color-1)",children:n.gadgetDetails.map((a,o)=>e.jsx(Y,{fill:`hsl(${200+o*20}, 70%, 50%)`},`cell-gadget-${o}`))})]})})})})]}),n.potionDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Potions Bues"}),e.jsx(U,{title:"Potions Bues",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n.potionDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"potionName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Consommations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:a,payload:o})=>{if(a&&o&&o.length>0){const h=o[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:h.potionName})}),e.jsxs("div",{children:["Bue ",h.count," fois"]})]})}return null}}),e.jsx(Z,{dataKey:"count",fill:"var(--chart-color-3)",children:n.potionDetails.map((a,o)=>e.jsx(Y,{fill:`hsl(${40+o*15}, 80%, 55%)`},`cell-potion-${o}`))})]})})})})]}),n.hunterTargets.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Cibles du Chasseur"}),e.jsx(U,{title:"Cibles du Chasseur",children:e.jsx("div",{style:{height:400},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n.hunterTargets,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"target",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Nombre de tirs",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(K,{content:({active:a,payload:o})=>{if(a&&o&&o.length>0){const h=o[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:h.target})}),e.jsxs("div",{children:["TuÃ© par le chasseur ",h.count," fois"]})]})}return null}}),e.jsx(Z,{dataKey:"count",fill:b.Chasseur||"var(--chart-color-2)",children:n.hunterTargets.map((a,o)=>e.jsx(Y,{fill:b.Chasseur||`hsl(${120+o*15}, 60%, 45%)`},`cell-hunter-${o}`))})]})})})})]})]}):e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune donnÃ©e d'actions disponible pour ",r,"."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es d'actions ne sont disponibles que pour les parties rÃ©centes."})]})}function ht({viewMode:r,setViewMode:c,selectedMap:b,setSelectedMap:n,availableMaps:R,clusterRadius:a,setClusterRadius:o,availableDeathTypes:h,selectedDeathTypes:l,setSelectedDeathTypes:x,deathTypeColors:d,isDeathTypesExpanded:i,setIsDeathTypesExpanded:u}){return e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>c("deaths"),style:{background:r==="deaths"?"var(--accent-primary)":"transparent",color:r==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"ðŸ’€ Morts"}),e.jsx("button",{type:"button",onClick:()=>c("kills"),style:{background:r==="kills"?"var(--accent-primary)":"transparent",color:r==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="kills"?"bold":"normal",transition:"all 0.2s"},children:"âš”ï¸ Kills"}),e.jsx("button",{type:"button",onClick:()=>c("transformations"),style:{background:r==="transformations"?"var(--accent-primary)":"transparent",color:r==="transformations"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:r==="transformations"?"bold":"normal",transition:"all 0.2s"},children:"ðŸº Transfos"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:b,onChange:s=>n(s.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:R.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:a,onChange:s=>o(parseInt(s.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:a===0?"Aucun":`${a} unitÃ©${a>1?"s":""}`})]}),r!=="transformations"&&e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>u(!i),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:i?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:i?"rotate(90deg)":"rotate(0deg)"},children:"â–¶"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[l.length," / ",h.length," sÃ©lectionnÃ©",l.length>1?"s":""]})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),x(h)},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),x([])},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:h.map(s=>{const p=l.includes(s),S=d[s]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",background:p?"var(--bg-tertiary)":"transparent",borderRadius:"4px",border:`1px solid ${p?S:"var(--border-color)"}`,cursor:"pointer",transition:"all 0.2s",fontSize:"0.9rem"},onClick:m=>{m.stopPropagation(),x(p?v=>v.filter(k=>k!==s):v=>[...v,s])},children:[e.jsx("input",{type:"checkbox",checked:p,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:S,flexShrink:0}}),e.jsx("span",{children:de(s)})]},s)})})]})]})]})}function gt({zoneAnalysis:r,selectedMap:c,viewMode:b,selectedPlayerName:n,hoveredZone:R,setHoveredZone:a}){return!r||c!=="Village"||b!=="deaths"?null:e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"0rem",padding:"1.5rem",background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",borderRadius:"12px",border:"2px solid var(--accent-primary)",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",color:"var(--accent-primary)",fontSize:"1.3rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"ðŸ“Š Analyse par zone (Village)"}),e.jsx("p",{style:{fontSize:"0.95rem",marginBottom:"1rem",color:"var(--text-secondary)",lineHeight:"1.5"},children:"Distribution des morts (selon les types sÃ©lectionnÃ©s) comparÃ©e Ã  la moyenne de tous les joueurs:"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:r.zoneStats.map(o=>{const h=o.zone===r.dominantZone&&r.maxDeviation>10;return e.jsxs("div",{onMouseEnter:()=>a(o.zone),onMouseLeave:()=>a(null),style:{padding:"1rem",background:"var(--bg-primary)",borderRadius:"8px",border:R===o.zone?"1px solid var(--accent-primary)":"1px solid var(--border-color)",color:"var(--text-primary)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.95rem"},children:o.zone}),e.jsxs("div",{style:{fontSize:"0.85rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[n,": ",e.jsxs("strong",{children:[o.playerPercent.toFixed(1),"%"]})," (",o.playerCount,")"]}),e.jsxs("div",{style:{opacity:.85},children:["Moyenne: ",o.avgPercent.toFixed(1),"%"]}),e.jsxs("div",{style:{marginTop:"0.25rem",color:h?"var(--accent-secondary)":o.deviation>0?"var(--accent-primary)":"var(--text-secondary)",fontWeight:Math.abs(o.deviation)>5?"bold":"normal"},children:[o.deviation>0?"+":"",o.deviation.toFixed(1),"% vs moyenne"]})]})]},o.zone)})}),r.dominantZone&&r.maxDeviation>10&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",fontSize:"0.95rem",color:"var(--accent-primary)",fontWeight:"bold",background:"var(--bg-primary)",borderRadius:"8px",border:"2px solid var(--accent-primary)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"âš ï¸"}),e.jsxs("span",{children:[n," meurt significativement plus souvent en zone ",r.dominantZone,"(","+"+r.maxDeviation.toFixed(1),"% par rapport Ã  la moyenne)"]})]})]})}function xt({locationData:r,clusteredData:c,viewMode:b,selectedPlayerName:n,selectedMap:R,mapConfig:a,xDomain:o,zDomain:h,hoveredZone:l,getDeathColor:x,handleLocationClick:d}){const i=({active:u,payload:s})=>{if(!u||!s||s.length===0)return null;const p=s[0].payload,S=p.allLocations||[p],m=S.length>1,v=b==="transformations";if(m){const P=new Map,z=new Map,M=new Set,F=new Map;S.forEach(t=>{if(P.set(t.victimName,(P.get(t.victimName)||0)+1),v)F.set(t.camp,(F.get(t.camp)||0)+1);else{const D=t.deathType?de(t.deathType):"Inconnu";z.set(D,(z.get(D)||0)+1)}M.add(t.gameId)});const B=Array.from(P.entries()).sort((t,D)=>D[1]-t[1]).slice(0,3),G=Array.from(z.entries()).sort((t,D)=>D[1]-t[1]).slice(0,3),I=Array.from(F.entries()).sort((t,D)=>D[1]-t[1]);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[v?"ðŸº":b==="deaths"?"ðŸ’€":"âš”ï¸"," ",S.length," ",v?"transformations":b==="deaths"?"morts":"kills"," Ã  cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[v?e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Camps loup:"}),I.map(([t,D])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",D,"Ã—)"]},t))]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:b==="deaths"?"Victimes:":"Kills sur:"}),B.map(([t,D])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",D,"Ã—)"]},t))]}),e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Types de mort:"}),G.map(([t,D])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",D,"Ã—)"]},t))]})]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["ðŸ“ ",M.size," partie",M.size>1?"s":""," diffÃ©rente",M.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const k=S[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[v?"ðŸº":b==="deaths"?"ðŸ’€":"âš”ï¸"," ",v?"Transformation de":b==="deaths"?"Mort de":"Kill de"," ",n]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[v?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ‘¤ ",e.jsx("strong",{children:"Joueur:"})," ",k.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp loup:"})," ",k.camp]}),e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",k.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",k.gameId]})]}):b==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Victime:"})," ",k.victimName]}),e.jsxs("div",{children:["âš”ï¸ ",e.jsx("strong",{children:"Tueur:"})," ",k.killerName||"Inconnu"]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",k.deathType?de(k.deathType):"Inconnu"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Victime:"})," ",k.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp victime:"})," ",k.camp]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",k.deathType?de(k.deathType):"Inconnu"]})]}),!v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",k.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",k.gameId]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})};return e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:r.length>0?e.jsx(U,{title:b==="deaths"?`Carte des Morts de ${n}`:`Carte des Kills de ${n}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(He,{margin:{top:20,right:30,left:60,bottom:20},children:[a&&e.jsx(ae,{x1:a.zMin,x2:a.zMax,y1:a.xMin,y2:a.xMax,fill:"transparent",stroke:"none",shape:u=>{const{x:s,y:p,width:S,height:m}=u;return e.jsx("image",{x:s,y:p,width:S,height:m,href:a.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),R==="Village"&&l&&e.jsxs(e.Fragment,{children:[l==="Ruines"&&e.jsx(ae,{x1:-220,x2:200,y1:100,y2:450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),l==="Village Principal"&&e.jsx(ae,{x1:-250,x2:100,y1:-120,y2:-450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),l==="Ferme"&&e.jsx(ae,{x1:-550,x2:-250,y1:150,y2:-150,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),l==="Village PÃªcheur"&&e.jsx(ae,{x1:150,x2:500,y1:80,y2:-320,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),l==="Reste de la Carte"&&e.jsx(ae,{x1:a?.zMin??-600,x2:a?.zMax??600,y1:a?.xMin??-500,y2:a?.xMax??500,fill:"var(--accent-primary)",fillOpacity:.15,stroke:"var(--accent-primary)",strokeWidth:2,strokeDasharray:"5 5"})]}),e.jsx(J,{strokeDasharray:"3 3",stroke:a?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(Q,{dataKey:"z",type:"number",name:"Position Z",domain:h,hide:!0}),e.jsx(X,{dataKey:"x",type:"number",name:"Position X",domain:o,hide:!0}),e.jsx(K,{content:e.jsx(i,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(_e,{data:c,onClick:u=>d(u),style:{cursor:"pointer"},isAnimationActive:!1,children:c.map((u,s)=>{const p=Math.min(Math.log2(u.count+1)*3+5,18),S=Math.round(p);return e.jsx(Y,{fill:x(u.deathType,u.camp),stroke:u.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:u.count>1?2:1,opacity:.85,r:S},`cell-${s}`)})})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:b==="deaths"?`Aucune mort localisÃ©e pour ${n} sur cette carte.`:b==="kills"?`Aucun kill localisÃ© pour ${n} sur cette carte.`:`Aucune transformation en loup localisÃ©e pour ${n} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes."})]})})}function Te(r,c){return c>=-250&&c<=100&&r>=-450&&r<=-120?"Village Principal":c>=-550&&c<=-250&&r>=-150&&r<=150?"Ferme":c>=150&&c<=500&&r>=-320&&r<=80?"Village PÃªcheur":c>=-220&&c<=200&&r>=100&&r<=450?"Ruines":"Reste de la Carte"}function le(r){return r==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":r}function ft({selectedPlayerName:r}){const{navigateToGameDetails:c}=ne(),{gameData:b,isLoading:n,error:R}=fe(),a=oe(),[o,h]=A.useState("deaths"),[l,x]=A.useState(""),[d,i]=A.useState(0),[u,s]=A.useState(null),[p,S]=A.useState([]),[m,v]=A.useState(!1),{data:k}=he(r,"Tous les camps"),P=A.useMemo(()=>{if(!b)return[];const w=new Set;return b.forEach(y=>{const T=y.PlayerStats.find(N=>N.Username.toLowerCase()===r.toLowerCase());T&&(T.DeathPosition!==null&&y.MapName&&w.add(y.MapName),y.PlayerStats.forEach(N=>{N.KillerName?.toLowerCase()===r.toLowerCase()&&N.DeathPosition!==null&&y.MapName&&w.add(y.MapName)}),T.Actions&&Array.isArray(T.Actions)&&T.Actions.some(N=>N.ActionType==="Transform")&&y.MapName&&w.add(y.MapName))}),Array.from(w).filter(y=>y==="Village"||y==="ChÃ¢teau").sort((y,T)=>y==="Village"?-1:T==="Village"?1:y.localeCompare(T))},[b,r]),z=P.length>0?P[0]:"";l===""&&z!==""&&x(z);const{availableDeathTypes:M,deathTypeColors:F}=A.useMemo(()=>{if(!b||!r)return{availableDeathTypes:[],deathTypeColors:{}};const w=new Set,y={};return b.forEach(T=>{const N=T.PlayerStats.find($=>$.Username.toLowerCase()===r.toLowerCase());if(N){if(N.DeathPosition&&N.DeathType){const $=le(N.DeathType);$&&w.add($)}T.PlayerStats.forEach($=>{if($.KillerName?.toLowerCase()===r.toLowerCase()&&$.DeathPosition&&$.DeathType){const V=le($.DeathType);V&&w.add(V)}})}}),w.forEach(T=>{y[T]=Ue(T,a)}),{availableDeathTypes:Array.from(w).sort(),deathTypeColors:y}},[b,r,a]),B=(w,y)=>o==="transformations"&&y?a[y]||"var(--text-secondary)":w&&F[w]||"var(--text-secondary)";A.useEffect(()=>{if(p.length===0&&M.length>0){const w=M.filter(y=>y!=="VOTED");S(w)}},[M.length]);const G=A.useMemo(()=>{if(!b||!r)return[];const w=[];return b.forEach(y=>{if(l&&y.MapName!==l)return;const T=y.PlayerStats.find(N=>N.Username.toLowerCase()===r.toLowerCase());if(T)if(o==="deaths"){if(T.DeathPosition){const N=ce(T.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),$=ue(T.DeathPosition.x,T.DeathPosition.z,y.MapName);w.push({x:$.x,z:$.z,victimName:T.Username,killerName:T.KillerName||null,deathType:le(T.DeathType),mapName:y.MapName,camp:N,gameId:y.DisplayedId,displayedGameId:y.DisplayedId})}}else o==="kills"?y.PlayerStats.forEach(N=>{if(N.KillerName?.toLowerCase()===r.toLowerCase()&&N.DeathPosition){const $=ce(N.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),V=ue(N.DeathPosition.x,N.DeathPosition.z,y.MapName);w.push({x:V.x,z:V.z,victimName:N.Username,killerName:r,deathType:le(N.DeathType),mapName:y.MapName,camp:$,gameId:y.DisplayedId,displayedGameId:y.DisplayedId})}}):o==="transformations"&&T.Actions&&Array.isArray(T.Actions)&&T.Actions.forEach(N=>{if(N.ActionType==="Transform"&&N.Position){const $=ce(T.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),V=ue(N.Position.x,N.Position.z,y.MapName);w.push({x:V.x,z:V.z,victimName:T.Username,killerName:null,deathType:null,mapName:y.MapName,camp:$,gameId:y.DisplayedId,displayedGameId:y.DisplayedId})}})}),o!=="transformations"&&p.length>0&&p.length<M.length?w.filter(y=>y.deathType&&p.includes(y.deathType)):w},[b,r,o,l,p,M]),I=A.useMemo(()=>{if(l!=="Village"||o!=="deaths"||G.length===0)return null;const w={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};if(G.forEach(E=>{const q=Te(E.x,E.z);w[q]=(w[q]||0)+1}),!b)return null;const y={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};b.forEach(E=>{E.MapName==="Village"&&E.PlayerStats.forEach(q=>{if(!q.DeathPosition)return;const H=le(q.DeathType);if(p.length>0&&p.length<M.length&&(!H||!p.includes(H)))return;const _=ue(q.DeathPosition.x,q.DeathPosition.z,"Village"),ge=Te(_.x,_.z);y[ge]=(y[ge]||0)+1})});const T=Object.values(y).reduce((E,q)=>E+q,0),N=Object.values(w).reduce((E,q)=>E+q,0);if(T===0||N===0)return null;const $=["Village Principal","Village PÃªcheur","Ferme","Ruines","Reste de la Carte"];let V=0,j=null;const W=$.map(E=>{const q=w[E]/N*100,H=y[E]/T*100,_=q-H;return _>V&&w[E]>=2&&(V=_,j=E),{zone:E,playerCount:w[E],playerPercent:q,avgPercent:H,deviation:_}});return{totalPlayerDeaths:N,totalAllDeaths:T,zoneStats:W,dominantZone:j,maxDeviation:V}},[G,l,o,b,p,M]),t=A.useMemo(()=>Ye(G,d).map((y,T)=>{const N=y.items[0],$=Je(y.items);return{x:y.centroidX,z:y.centroidZ,count:y.items.length,allLocations:y.items,victimName:y.items.length===1?N.victimName:null,killerName:y.items.length===1?N.killerName:null,deathType:$,mapName:N.mapName,camp:N.camp,gameId:y.items.length===1?N.gameId:null,displayedGameId:y.items.length===1?N.displayedGameId:null,clusterIndex:T}}),[G,d]),D=A.useMemo(()=>Qe(l),[l]),{xDomain:L,zDomain:C}=A.useMemo(()=>{if(D)return{xDomain:[D.xMin,D.xMax],zDomain:[D.zMin,D.zMax]};if(t.length===0)return{xDomain:[0,100],zDomain:[0,100]};const w=t.map(E=>E.x),y=t.map(E=>E.z),T=Math.min(...w),N=Math.max(...w),$=Math.min(...y),V=Math.max(...y),j=(N-T)*.1||10,W=(V-$)*.1||10;return{xDomain:[T-j,N+j],zDomain:[$-W,V+W]}},[t,D]),f=w=>{if(!w)return;const y=w.allLocations||[w];if(y.length===1)c({selectedGame:y[0].gameId,fromComponent:"Player Death Map"});else{const T=y.map(N=>N.gameId).filter(N=>N);c({selectedGameIds:T,fromComponent:"Player Death Map"})}},g=A.useMemo(()=>{if(!k?.mapStats||!l)return null;const w=k.mapStats[l];return w?{winRate:w.winRate,wins:w.wins,total:w.appearances}:null},[k,l]);return n?e.jsx("div",{className:"donnees-attente",children:"Chargement des donnÃ©es..."}):R?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",R]}):b?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsx(ht,{viewMode:o,setViewMode:h,selectedMap:l,setSelectedMap:x,availableMaps:P,clusterRadius:d,setClusterRadius:i,availableDeathTypes:M,selectedDeathTypes:p,setSelectedDeathTypes:S,deathTypeColors:F,isDeathTypesExpanded:m,setIsDeathTypesExpanded:v}),e.jsx(xt,{locationData:G,clusteredData:t,viewMode:o,selectedPlayerName:r,selectedMap:l,mapConfig:D,xDomain:L,zDomain:C,hoveredZone:u,getDeathColor:B,handleLocationClick:f}),e.jsx(gt,{zoneAnalysis:I,selectedMap:l,viewMode:o,selectedPlayerName:r,hoveredZone:u,setHoveredZone:s}),g&&e.jsxs("div",{style:{flex:"1 1 100%",textAlign:"center",padding:"0.75rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)",marginTop:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginRight:"1rem"},children:["Taux de victoire sur ",e.jsx("strong",{children:l})," :"]}),e.jsxs("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:parseFloat(g.winRate)>=50?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[g.winRate,"%"]}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["(",g.wins," / ",g.total," victoires)"]})]}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"Ã€ propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",o==="deaths"?`les emplacements oÃ¹ ${r} est mort`:o==="kills"?`les emplacements oÃ¹ ${r} a Ã©liminÃ© d'autres joueurs`:`les emplacements oÃ¹ ${r} s'est transformÃ© en loup`," au cours des parties.",o!=="transformations"&&"Les couleurs indiquent le type de mort."," Cliquez sur un point pour voir les dÃ©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroupÃ©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’€ Morts:"})," OÃ¹ le joueur a Ã©tÃ© Ã©liminÃ©",e.jsx("br",{}),e.jsx("strong",{children:"âš”ï¸ Kills:"})," OÃ¹ le joueur a Ã©liminÃ© d'autres joueurs",e.jsx("br",{}),e.jsx("strong",{children:"ðŸº Transformations:"})," OÃ¹ le joueur s'est transformÃ© en loup"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function Ae(r){return r.PlayerStats.some(c=>c.SecondsTalkedOutsideMeeting>0||c.SecondsTalkedDuringMeeting>0)}function xe(r,c){const b=c.DeathDateIrl||r.EndDate,n=De(r.StartDate,b);return n&&n>0?n:0}function yt(r){const c=r.filter(Ae),b=new Map;return c.forEach(n=>{n.PlayerStats.forEach(R=>{const a=te(R),o=$e(R),h=xe(n,R);if(h<=0)return;b.has(a)||b.set(a,{displayName:o,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const l=b.get(a);l.gamesPlayed++,l.totalSecondsAll+=(R.SecondsTalkedOutsideMeeting||0)+(R.SecondsTalkedDuringMeeting||0),l.totalGameDuration+=h})}),{playerStats:b,gamesWithTalkingData:c.length}}function vt(r,c){if(!c||c.length===0||!r)return null;const b=yt(c),n=c.filter(Ae);if(n.length===0||b.playerStats.size===0)return null;let R=null;for(const[f,g]of b.playerStats)if(g.displayName===r){R=f;break}if(!R)return null;let a=0,o=0,h=0,l=0;const x={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},d=new Map;let i=0,u=0,s=0,p=0;if(n.forEach(f=>{const g=f.PlayerStats.find(W=>te(W)===R);if(!g)return;const w=xe(f,g);if(w<=0)return;a++;const y=g.SecondsTalkedOutsideMeeting||0,T=g.SecondsTalkedDuringMeeting||0,N=y+T;o+=y,h+=T,l+=w;const $=We(g.MainRoleInitial,g.Power);x[$].gamesPlayed++,x[$].secondsOutside+=y,x[$].secondsDuring+=T,x[$].gameDuration+=w;const V=Ke(g);d.has(V)||d.set(V,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const j=d.get(V);j.gamesPlayed++,j.totalSecondsAll+=N,j.totalGameDuration+=w}),a===0||l<=0)return null;const S=3600/l,m=o*S,v=h*S,k=(o+h)*S,P=o+h>0?h/(o+h)*100:0,z=[];for(const[f,g]of Object.entries(x)){if(g.gamesPlayed===0)continue;const w=g.gameDuration>0?3600/g.gameDuration:0,y=g.secondsOutside+g.secondsDuring;z.push({camp:f,gamesPlayed:g.gamesPlayed,totalSecondsOutside:g.secondsOutside,totalSecondsDuring:g.secondsDuring,totalSecondsAll:y,totalGameDurationSeconds:g.gameDuration,secondsOutsidePer60Min:g.secondsOutside*w,secondsDuringPer60Min:g.secondsDuring*w,secondsAllPer60Min:y*w,meetingRatio:y>0?g.secondsDuring/y*100:0})}z.sort((f,g)=>g.gamesPlayed-f.gamesPlayed);const M=Array.from(d.entries()).filter(([f,g])=>g.gamesPlayed>=1).map(([f,g])=>({role:f,gamesPlayed:g.gamesPlayed,secondsAllPer60Min:g.totalGameDuration>0?g.totalSecondsAll/g.totalGameDuration*3600:0,totalSecondsAll:g.totalSecondsAll})).sort((f,g)=>g.secondsAllPer60Min-f.secondsAllPer60Min),F=[];for(const[f,g]of b.playerStats)g.totalGameDuration>0&&F.push({id:f,name:g.displayName,per60:g.totalSecondsAll/g.totalGameDuration*3600});F.sort((f,g)=>g.per60-f.per60);const B=F.reduce((f,g)=>f+g.per60,0),G=F.length>0?B/F.length:0,I=F.findIndex(f=>f.id===R)+1,t=F.length,D=t>0?Math.round((1-(I-1)/t)*100):0,L=k;n.forEach(f=>{const g=f.PlayerStats.find(N=>te(N)===R);if(!g)return;const w=xe(f,g);if(w<=0)return;((g.SecondsTalkedOutsideMeeting||0)+(g.SecondsTalkedDuringMeeting||0))/w*3600>=L?(i++,g.Victorious&&u++):(s++,g.Victorious&&p++)});const C={gamesAboveAverage:i,winsAboveAverage:u,winRateAboveAverage:i>0?u/i*100:0,gamesBelowAverage:s,winsBelowAverage:p,winRateBelowAverage:s>0?p/s*100:0};return{playerName:r,gamesPlayed:a,gamesWithTalkingData:b.gamesWithTalkingData,totalSecondsOutside:o,totalSecondsDuring:h,totalSecondsAll:o+h,totalGameDurationSeconds:l,secondsOutsidePer60Min:m,secondsDuringPer60Min:v,secondsAllPer60Min:k,meetingRatio:P,campBreakdown:z,globalAverageSecondsAllPer60Min:G,playerRank:I,totalPlayersWithData:t,percentile:D,roleBreakdown:M,winCorrelation:C}}function jt(r,c){return r?r.roleBreakdown.slice(0,c):[]}function bt(r){const{data:c,isLoading:b,error:n}=ye(R=>r?vt(r,R):null);return{data:c,isLoading:b,error:n}}function Ct({selectedPlayerName:r}){const{data:c,isLoading:b,error:n}=bt(r),R=oe(),[a,o]=A.useState("both"),h=A.useMemo(()=>c?.campBreakdown?c.campBreakdown.map(s=>({camp:s.camp,"Hors rÃ©union":Math.round(s.secondsOutsidePer60Min),"En rÃ©union":Math.round(s.secondsDuringPer60Min),total:Math.round(s.secondsAllPer60Min),gamesPlayed:s.gamesPlayed,meetingRatio:s.meetingRatio.toFixed(1)})):[],[c]),l=A.useMemo(()=>c?[{name:"En rÃ©union",value:c.totalSecondsDuring,color:"#2196F3"},{name:"Hors rÃ©union",value:c.totalSecondsOutside,color:"#FF9800"}]:[],[c]);if(b)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(n)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",n]});if(!c)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de temps de parole ne sont disponibles que pour les parties rÃ©centes."})]});const x=c.secondsAllPer60Min-c.globalAverageSecondsAllPer60Min,d=c.globalAverageSecondsAllPer60Min>0?(x/c.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",i=x>0,u=c.winCorrelation.winRateAboveAverage-c.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¤ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:se(c.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:i?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[i?"+":"",d,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",c.playerRank," / ",c.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-c.percentile+1,"% ",c.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“ˆ Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:c.gamesPlayed}),e.jsxs("p",{children:["sur ",c.gamesWithTalkingData," avec donnÃ©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ—£ï¸ Ratio en rÃ©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[c.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),h.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(U,{title:"Temps de parole par camp (par 60min de jeu)",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>o("meeting"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="meeting"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="meeting"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="meeting"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="meeting"?"bold":"normal"},children:"En rÃ©union"}),e.jsx("button",{onClick:()=>o("outside"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="outside"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="outside"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="outside"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="outside"?"bold":"normal"},children:"Hors rÃ©union"}),e.jsx("button",{onClick:()=>o("both"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="both"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="both"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="both"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="both"?"bold":"normal"},children:"Les deux"})]}),e.jsx("div",{style:{height:350},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:h,layout:"vertical",children:[e.jsx(J,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(Q,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:s=>`${Math.floor(s/60)}m`}),e.jsx(X,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(K,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(s,p)=>[se(s),p],labelFormatter:s=>{const p=h.find(S=>S.camp===s);return`${s} (${p?.gamesPlayed||0} parties)`}}),e.jsx(Ne,{}),(a==="both"||a==="outside")&&e.jsx(Z,{dataKey:"Hors rÃ©union",stackId:"talk",fill:"#FF9800"}),(a==="both"||a==="meeting")&&e.jsx(Z,{dataKey:"En rÃ©union",stackId:"talk",fill:"#2196F3"})]})})})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:(()=>{const s=h.find(v=>v.camp==="Villageois"),p=h.find(v=>v.camp==="Loup");if(!s||!p)return e.jsx("p",{children:"ðŸ’¡ Pas assez de donnÃ©es pour comparer les camps Villageois et Loups."});const S=s.total-p.total,m=p.total>0?(Math.abs(S)/p.total*100).toFixed(0):"0";return S>0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:Ce("Villageois")},children:[se(S)," de plus (+",m,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Villageois"})," qu'en tant que"," ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]}):S<0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:Ce("Loup")},children:[se(Math.abs(S))," de plus (+",m,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Loup"})," qu'en tant que"," ",e.jsx("strong",{children:"Villageois"})," (par heure de jeu)."]}):e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle exactement autant en tant que"," ",e.jsx("strong",{children:"Villageois"})," qu'en tant que ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(U,{title:"RÃ©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(je,{children:[e.jsx(be,{data:l,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:s=>`${s.name}: ${((s.percent||0)*100).toFixed(1)}%`,children:l.map((s,p)=>e.jsx(Y,{fill:s.color},`cell-${p}`))}),e.jsx(K,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:s=>se(s)})]})})})})}),c&&c.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(U,{title:s=>s?"Top 15 rÃ´les les plus bavards (par 60min)":"Top 5 rÃ´les les plus bavards (par 60min)",children:s=>{const S=jt(c,s?15:5).map(m=>({role:m.role,secondsPer60Min:Math.round(m.secondsAllPer60Min),gamesPlayed:m.gamesPlayed}));return e.jsx("div",{style:{height:s?400:300},children:e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(ee,{data:S,children:[e.jsx(J,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(Q,{dataKey:"role",tick:{fill:"var(--text-primary)",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(X,{tick:{fill:"var(--text-secondary)"},tickFormatter:m=>`${Math.floor(m/60)}m`}),e.jsx(K,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:m=>[se(m),"Temps de parole"],labelFormatter:m=>{const v=S.find(k=>k.role===m);return`${m} (${v?.gamesPlayed||0} parties)`}}),e.jsx(Z,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",children:S.map((m,v)=>e.jsx(Y,{fill:R[m.role]||R.Villageois},`cell-${v}`))})]})})})}})}),(c.winCorrelation.gamesAboveAverage>0||c.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"ðŸŽ¯ CorrÃ©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[c.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",c.winCorrelation.winsAboveAverage,"/",c.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[c.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",c.winCorrelation.winsBelowAverage,"/",c.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(u)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:u>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[u>0?"supÃ©rieur":"infÃ©rieur"," de ",Math.abs(u).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function wt({playerTitles:r,titlesLoading:c}){if(c)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des titres..."})]})});if(!r||r.titles.length===0)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-empty",children:[e.jsx("p",{children:"ðŸ“œ Aucun titre disponible"}),e.jsx("p",{className:"empty-subtitle",children:r?.gamesPlayed?`${r.gamesPlayed} parties jouÃ©es - minimum 25 parties requises pour obtenir des titres`:"Les titres sont gÃ©nÃ©rÃ©s chaque dimanche pour les joueurs avec 25+ parties en mode moddÃ©"})]})});const b=[...r.titles].sort((n,R)=>{const a=r.titles.indexOf(n),h=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(n.category||"")?100-(n.percentile||50):n.percentile||50,l=(n.priority||0)*1e3+h*10-a,x=r.titles.indexOf(R),i=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(R.category||"")?100-(R.percentile||50):R.percentile||50;return(R.priority||0)*1e3+i*10-x-l});return e.jsxs("div",{className:"titles-section",children:[e.jsxs("div",{className:"titles-header",children:[e.jsx("h3",{children:"ðŸ·ï¸ Titres actuels"}),e.jsxs("p",{className:"titles-info",children:[r.titles.length," titre",r.titles.length>1?"s":""," â€¢",r.gamesPlayed," parties jouÃ©es"]})]}),e.jsx("div",{className:"titles-grid",children:b.map((n,R)=>{const a=r.primaryTitle?.id===n.id;return e.jsxs("div",{className:`title-card ${n.type} ${a?"primary":""}`,title:`${n.description}${n.percentile!==void 0?`
MeilleurÂ·e que ${n.percentile.toFixed(1)}% des joueurs`:""}`,children:[e.jsx("div",{className:"title-rank",children:R+1}),"            ",a&&e.jsx("div",{className:"title-crown",children:"ðŸ‘‘"}),"            ",e.jsx("div",{className:"title-emoji",children:n.emoji}),e.jsxs("div",{className:"title-info",children:[e.jsx("div",{className:"title-name",children:n.title}),e.jsx("div",{className:"title-description",children:n.description}),n.percentile!==void 0&&n.type!=="combination"&&e.jsxs("div",{className:"title-percentile",children:["Top ",(100-n.percentile).toFixed(0),"%"]}),e.jsx("div",{className:"title-type-badge",children:n.type==="combination"?"Combo":n.type==="role"?"RÃ´le":"Stat"}),!a&&n.primaryOwner&&e.jsxs("div",{className:"title-primary-owner",children:["ðŸ‘¤ Titre principal de: ",e.jsx("strong",{children:n.primaryOwner})]}),n.type==="combination"&&n.conditions&&n.conditions.length>0&&e.jsxs("div",{className:"title-conditions-breakdown",children:[e.jsx("div",{className:"breakdown-header",children:"Conditions:"}),n.conditions.map((o,h)=>e.jsxs("div",{className:"condition-item",children:[e.jsxs("span",{className:"condition-stat",children:[o.stat==="winRate"?"Victoires":o.stat==="loot"?"RÃ©colte":o.stat==="lootVillageois"?"RÃ©colte (Villageois)":o.stat==="lootLoup"?"RÃ©colte (Loup)":o.stat==="survival"?"Survie":o.stat==="killRate"?"Kills":o.stat==="talking"?"Parole":o.stat==="talkingOutsideMeeting"?"Parole (hors dÃ©bats)":o.stat==="talkingDuringMeeting"?"Parole (meeting)":o.stat==="votingAggressive"?"Vote agressif":o.stat==="votingAccuracy"?"PrÃ©cision vote":o.stat==="votingFirst"?"Vote rapide":o.stat==="survivalDay1"?"Survie J1":o.stat==="winRateVillageois"?"Victoires Villageois":o.stat==="winRateLoup"?"Victoires Loup":o.stat==="winRateSolo"?"Victoires Solo":o.stat==="hunterAccuracy"?"PrÃ©cision chasseur":o.stat,":"]}),e.jsx("span",{className:`condition-category ${o.category?.toLowerCase()}`,children:o.category}),o.actualPercentile!==void 0&&e.jsxs("span",{className:"condition-percentile",children:["(Top ",(100-o.actualPercentile).toFixed(0),"%)"]})]},h))]})]})]},n.id)})})]})}function Ot(){const{settings:r,updateSettings:c}=pe(),{navigateToGameDetails:b,navigationState:n,updateNavigationState:R}=ne(),{data:a,isLoading:o,error:h}=Le(),{joueursData:l,isLoading:x}=me(),{data:d,isLoading:i,error:u}=rt(r.highlightedPlayer),{playerData:s,isLoading:p}=at(r.highlightedPlayer),S=ve(l),[m,v]=A.useState(""),[k,P]=A.useState(null),{clips:z}=Xe(r.highlightedPlayer),{clips:M}=Ze(),[F,B]=A.useState(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded"?"modded":"all":r.gameFilter==="modded"?"modded":"all"),G=A.useMemo(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded":r.gameFilter==="modded",[r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter,r.gameFilter]),[I,t]=A.useState(r.selectedPlayerSelectionView||n.selectedPlayerSelectionView||"achievements"),[D,L]=A.useState("session"),[C,f]=A.useState("all");A.useEffect(()=>{if(r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled){const j=r.independentFilters.gameFilter==="modded"?"modded":"all";B(j)}else if(!r.useIndependentFilters){const j=r.gameFilter==="modded"?"modded":"all";B(j)}},[r.gameFilter,r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter]),A.useEffect(()=>{G&&F!=="modded"&&B("modded")},[G,F]),A.useEffect(()=>{const j=r.selectedPlayerSelectionView||n.selectedPlayerSelectionView;j&&j!==I&&t(j)},[r.selectedPlayerSelectionView,n.selectedPlayerSelectionView]);const{data:g}=he(r.highlightedPlayer||""),w=A.useMemo(()=>{if(!a||!a.GameStats)return[];const j=G?a.GameStats.filter(E=>E.Modded===!0):a.GameStats,W=new Map;return j.forEach(E=>{const q=new Date(E.StartDate);E.PlayerStats.forEach(H=>{const _=te(H),Me=l?.Players?.find(Fe=>Fe.SteamID===_)?.Joueur||H.Username;W.has(_)||W.set(_,{games:0,wins:0,firstDate:q,lastDate:q,displayName:Me});const re=W.get(_);re.games++,H.Victorious&&re.wins++,q<re.firstDate&&(re.firstDate=q),q>re.lastDate&&(re.lastDate=q)})}),Array.from(W.entries()).map(([E,q])=>{let H=l?.Players?.find(_=>_.SteamID===E);return H||(H=l?.Players?.find(_=>_.Joueur===q.displayName)),{id:E,name:q.displayName,totalGames:q.games,totalWins:q.wins,winRate:q.games>0?q.wins/q.games*100:0,firstGameDate:q.firstDate.toLocaleDateString("fr-FR"),lastGameDate:q.lastDate.toLocaleDateString("fr-FR"),isHighlighted:q.displayName===r.highlightedPlayer,image:H?.Image||null,twitch:H?.Twitch||null,youtube:H?.Youtube||null}})},[a,r.highlightedPlayer,l,G]),y=A.useMemo(()=>{if(!m.trim())return w;const j=m.toLowerCase();return w.filter(W=>W.name.toLowerCase().includes(j))},[w,m]),T=A.useMemo(()=>[...y].sort((j,W)=>W.totalGames-j.totalGames),[y]),N=j=>{c({highlightedPlayer:j}),v("")},$=j=>{t(j),R({selectedPlayerSelectionView:j}),c({selectedPlayerSelectionView:j,tab:"playerSelection"})},V=()=>{if(z.length===0)return;const j=Math.floor(Math.random()*z.length);P(z[j])};return o||x?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):h?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",h]})]}):!a||w.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!r.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:m,onChange:j=>v(j.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[y.length," joueur",y.length!==1?"s":"",m&&` (filtrÃ©${y.length!==1?"s":""} de ${w.length})`]})]})]}),e.jsx("div",{className:"player-display",children:m?y.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>v(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:T.map(j=>e.jsxs("button",{type:"button",className:`suggestion-btn ${j.isHighlighted?"highlighted":""}`,onClick:()=>N(j.name),children:[j.image?e.jsx("img",{src:j.image,alt:`Photo de profil de ${j.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":S[j.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[j.name,j.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[j.totalGames," parties â€¢ ",j.winRate.toFixed(1),"% victoires"]})]})]},j.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',m,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>v(""),children:"Effacer la recherche"})]}):r.highlightedPlayer?(()=>{const j=w.find(W=>W.name===r.highlightedPlayer);return j?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:j.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[j.image?e.jsx("img",{src:j.image,alt:`Photo de profil de ${j.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":S[j.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[j.totalGames," parties â€¢ ",j.totalWins," victoires â€¢ ",j.winRate.toFixed(1),"% taux de victoire"]}),s?.primaryTitle?e.jsxs("div",{className:"player-primary-title",title:s.primaryTitle.description,style:{marginTop:"0.5rem",display:"inline-flex",alignItems:"center",gap:"0.3rem",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("span",{className:"title-emoji",children:s.primaryTitle.emoji}),e.jsx("span",{className:"title-text",children:s.primaryTitle.title})]}):e.jsx("div",{className:"player-no-title",style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic"},children:"ðŸ“œ 25 parties moddÃ©es minimum pour obtenir un titre"}),(j.twitch||j.youtube||z.length>0)&&e.jsxs("div",{className:"social-links",children:[j.twitch&&e.jsx("a",{href:j.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),j.youtube&&e.jsx("a",{href:j.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"}),z.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:W=>{W.stopPropagation(),V()},title:`${z.length} clip${z.length>1?"s":""} disponible${z.length>1?"s":""}`,children:["ðŸŽ¬ Clip alÃ©atoire (",z.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${I==="achievements"?"active":""}`,onClick:()=>$("achievements"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${I==="titles"?"active":""}`,onClick:()=>$("titles"),children:"Titres"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${I==="evolution"?"active":""}`,onClick:()=>$("evolution"),children:"Ã‰volution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${I==="camps"?"active":""}`,onClick:()=>$("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${I==="roles"?"active":""}`,onClick:()=>$("roles"),children:"RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${I==="actions"?"active":""}`,onClick:()=>$("actions"),children:"Actions"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${I==="kills"?"active":""}`,onClick:()=>$("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${I==="deathmap"?"active":""}`,onClick:()=>$("deathmap"),children:"Cartes"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${I==="talkingtime"?"active":""}`,onClick:()=>$("talkingtime"),children:"Parole"})]}),I==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[i?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):u?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",u]})}):d?e.jsx(it,{achievements:F==="all"?d.allGamesAchievements:d.moddedOnlyAchievements,title:F==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:F}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[!G&&e.jsx("button",{type:"button",className:`filter-btn ${F==="all"?"active":""}`,onClick:W=>{W.stopPropagation(),B("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${F==="modded"?"active":""}`,onClick:W=>{W.stopPropagation(),B("modded")},disabled:G,children:"Parties moddÃ©es"})]})]}),I==="titles"&&e.jsx(wt,{playerTitles:s,titlesLoading:p}),I==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[g&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{b({selectedPlayer:j.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${j.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:g.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:Ge(g.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{b({selectedPlayer:j.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${j.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:g.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[g.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:D,onChange:W=>L(W.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:C,onChange:W=>f(W.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(nt,{selectedPlayerName:j.name,groupingMethod:D,campFilter:C})]}),I==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ot,{selectedPlayerName:j.name})}),I==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(dt,{selectedPlayerName:j.name})}),I==="actions"&&e.jsx("div",{className:"player-history-section",children:e.jsx(mt,{selectedPlayerName:j.name})}),I==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(lt,{selectedPlayerName:j.name})}),I==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ft,{selectedPlayerName:j.name})}),I==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Ct,{selectedPlayerName:j.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:W=>{W.stopPropagation(),c({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[j.firstGameDate," - ",j.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',r.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>c({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:T.map(j=>e.jsxs("div",{className:`character-card ${j.isHighlighted?"highlighted":""}`,onClick:()=>N(j.name),title:`${j.name} - ${j.totalGames} parties, ${j.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:j.image?e.jsx("img",{src:j.image,alt:`Photo de profil de ${j.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":S[j.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:j.name}),(j.twitch||j.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[j.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),j.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},j.id))})})}),k&&e.jsx(et,{clip:k,onClose:()=>P(null),relatedClips:tt(k,M),nextClip:Re(k,M),onNextClip:()=>{const j=Re(k,M);j&&P(j)},onRelatedClip:j=>{const W=M.find(E=>E.ClipId===j);W&&P(W)}})]})}export{Ot as PlayerSelectionPage};
