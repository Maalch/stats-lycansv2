import{u as P,a as O,r as y,j as s}from"./index-CcXgzc_S.js";import{u as T}from"./baseStatsHook-CxviQ0VS.js";import{g as D}from"./datasyncExport-DNugpht-.js";import{u as z}from"./api-BG053Rxz.js";import{F as w,B as F,C as N,X as I,Y as E,a as k,b as R}from"./FullscreenChart-CubkA5eL.js";import{R as M,T as $}from"./CategoricalChart-BOIWUr-n.js";function H(e){return e?(e=D(e,{regroupTraitor:!0}),e==="Loup"?"Loup":e==="Villageois"?"Villageois":"Autres"):"Villageois"}function J(e){const c=new Set;return e.forEach(g=>{g.PlayerStats.forEach(n=>{c.add(n.Username.trim())})}),c}function q(e){const c={};return e.forEach(g=>{c[g]={currentVillageoisSeries:0,currentLoupsSeries:0,longestVillageoisSeries:null,longestLoupsSeries:null,currentWinSeries:0,longestWinSeries:null,currentWinCamps:[],currentLossSeries:0,longestLossSeries:null,currentLossCamps:[],lastCamp:null,lastWon:!1,villageoisSeriesStart:null,loupsSeriesStart:null,winSeriesStart:null,lossSeriesStart:null,currentVillageoisGameIds:[],currentLoupsGameIds:[],currentWinGameIds:[],currentLossGameIds:[]}}),c}function B(e,c,g,n,d){g==="Villageois"||g==="Loup"?(g==="Villageois"&&(e.lastCamp==="Villageois"?(e.currentVillageoisSeries++,e.currentVillageoisGameIds.push(n)):(e.currentVillageoisSeries=1,e.villageoisSeriesStart={game:n,date:d},e.currentVillageoisGameIds=[n]),(!e.longestVillageoisSeries||e.currentVillageoisSeries>=e.longestVillageoisSeries.seriesLength)&&(e.longestVillageoisSeries={player:c,camp:"Villageois",seriesLength:e.currentVillageoisSeries,startGame:e.villageoisSeriesStart?.game||n,endGame:n,startDate:e.villageoisSeriesStart?.date||d,endDate:d,isOngoing:!1,gameIds:[...e.currentVillageoisGameIds]}),e.currentLoupsSeries=0,e.loupsSeriesStart=null,e.currentLoupsGameIds=[]),g==="Loup"&&(e.lastCamp==="Loup"?(e.currentLoupsSeries++,e.currentLoupsGameIds.push(n)):(e.currentLoupsSeries=1,e.loupsSeriesStart={game:n,date:d},e.currentLoupsGameIds=[n]),(!e.longestLoupsSeries||e.currentLoupsSeries>=e.longestLoupsSeries.seriesLength)&&(e.longestLoupsSeries={player:c,camp:"Loups",seriesLength:e.currentLoupsSeries,startGame:e.loupsSeriesStart?.game||n,endGame:n,startDate:e.loupsSeriesStart?.date||d,endDate:d,isOngoing:!1,gameIds:[...e.currentLoupsGameIds]}),e.currentVillageoisSeries=0,e.villageoisSeriesStart=null,e.currentVillageoisGameIds=[]),e.lastCamp=g):(e.currentVillageoisSeries=0,e.currentLoupsSeries=0,e.villageoisSeriesStart=null,e.loupsSeriesStart=null,e.currentVillageoisGameIds=[],e.currentLoupsGameIds=[],e.lastCamp="Autres")}function U(e,c,g,n,d,a){if(g){if(e.lastWon?(e.currentWinSeries++,e.currentWinCamps.push(n),e.currentWinGameIds.push(d)):(e.currentWinSeries=1,e.currentWinCamps=[n],e.winSeriesStart={game:d,date:a},e.currentWinGameIds=[d]),!e.longestWinSeries||e.currentWinSeries>=e.longestWinSeries.seriesLength){const u={};e.currentWinCamps.forEach(r=>{u[r]=(u[r]||0)+1}),e.longestWinSeries={player:c,seriesLength:e.currentWinSeries,startGame:e.winSeriesStart?.game||d,endGame:d,startDate:e.winSeriesStart?.date||a,endDate:a,campCounts:u,isOngoing:!1,gameIds:[...e.currentWinGameIds]}}e.lastWon=!0}else e.currentWinSeries=0,e.currentWinCamps=[],e.winSeriesStart=null,e.currentWinGameIds=[],e.lastWon=!1}function K(e,c,g,n,d,a){if(g)e.currentLossSeries=0,e.currentLossCamps=[],e.lossSeriesStart=null,e.currentLossGameIds=[];else if(e.currentLossSeries>0?(e.currentLossSeries++,e.currentLossCamps.push(n),e.currentLossGameIds.push(d)):(e.currentLossSeries=1,e.currentLossCamps=[n],e.lossSeriesStart={game:d,date:a},e.currentLossGameIds=[d]),!e.longestLossSeries||e.currentLossSeries>=e.longestLossSeries.seriesLength){const u={};e.currentLossCamps.forEach(r=>{u[r]=(u[r]||0)+1}),e.longestLossSeries={player:c,seriesLength:e.currentLossSeries,startGame:e.lossSeriesStart?.game||d,endGame:d,startDate:e.lossSeriesStart?.date||a,endDate:a,campCounts:u,isOngoing:!1,gameIds:[...e.currentLossGameIds]}}}function X(e){const c=[],g=[],n=[],d=[];return Object.values(e).forEach(a=>{a.longestVillageoisSeries&&c.push(a.longestVillageoisSeries),a.longestLoupsSeries&&g.push(a.longestLoupsSeries),a.longestWinSeries&&n.push(a.longestWinSeries),a.longestLossSeries&&d.push(a.longestLossSeries)}),c.sort((a,u)=>u.seriesLength-a.seriesLength),g.sort((a,u)=>u.seriesLength-a.seriesLength),n.sort((a,u)=>u.seriesLength-a.seriesLength),d.sort((a,u)=>u.seriesLength-a.seriesLength),{allVillageoisSeries:c,allLoupsSeries:g,allWinSeries:n,allLossSeries:d}}function Y(e,c){const g=[],n=[],d=[],a=[];Object.values(e).forEach(t=>{g.push(t.longestVillageoisSeries?.seriesLength||0),n.push(t.longestLoupsSeries?.seriesLength||0),d.push(t.longestWinSeries?.seriesLength||0),a.push(t.longestLossSeries?.seriesLength||0)});const u=c>0?g.reduce((t,p)=>t+p,0)/c:0,r=c>0?n.reduce((t,p)=>t+p,0)/c:0,b=c>0?d.reduce((t,p)=>t+p,0)/c:0,x=c>0?a.reduce((t,p)=>t+p,0)/c:0,S=g.filter(t=>t>=5).length,j=n.filter(t=>t>=3).length,C=d.filter(t=>t>=5).length,f=a.filter(t=>t>=5).length;return{averageVillageoisSeries:Math.round(u*10)/10,averageLoupsSeries:Math.round(r*10)/10,averageWinSeries:Math.round(b*10)/10,averageLossSeries:Math.round(x*10)/10,eliteVillageoisCount:S,eliteLoupsCount:j,eliteWinCount:C,eliteLossCount:f}}function Q(e){if(e.length===0)return null;const c=[...e].sort((o,L)=>parseInt(o.DisplayedId)-parseInt(L.DisplayedId)),g=J(c),n=q(g);c.forEach(o=>{const L=o.DisplayedId,G=new Date(o.StartDate).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});o.PlayerStats.forEach(l=>{const h=l.Username.trim();if(!h)return;const i=n[h],m=H(l.MainRoleFinal),v=l.Victorious;B(i,h,m,L,G),U(i,h,v,m,L,G),K(i,h,v,m,L,G)})});const{allVillageoisSeries:d,allLoupsSeries:a,allWinSeries:u,allLossSeries:r}=X(n);Object.values(n).forEach(o=>{o.longestVillageoisSeries&&o.currentVillageoisSeries===o.longestVillageoisSeries.seriesLength&&o.currentVillageoisSeries>0&&(o.longestVillageoisSeries.isOngoing=!0),o.longestLoupsSeries&&o.currentLoupsSeries===o.longestLoupsSeries.seriesLength&&o.currentLoupsSeries>0&&(o.longestLoupsSeries.isOngoing=!0),o.longestWinSeries&&o.currentWinSeries===o.longestWinSeries.seriesLength&&o.currentWinSeries>0&&(o.longestWinSeries.isOngoing=!0),o.longestLossSeries&&o.currentLossSeries===o.longestLossSeries.seriesLength&&o.currentLossSeries>0&&(o.longestLossSeries.isOngoing=!0)});const b=Y(n,g.size);let x=0,S=0,j=0,C=0,f=0,t=0,p=0,V=0;return Object.values(n).forEach(o=>{o.currentVillageoisSeries>0&&x++,o.currentLoupsSeries>0&&S++,o.currentWinSeries>0&&j++,o.currentLossSeries>0&&C++,o.longestVillageoisSeries?.isOngoing&&f++,o.longestLoupsSeries?.isOngoing&&t++,o.longestWinSeries?.isOngoing&&p++,o.longestLossSeries?.isOngoing&&V++}),{allVillageoisSeries:d,allLoupsSeries:a,allWinSeries:u,allLossSeries:r,totalGamesAnalyzed:c.length,totalPlayersCount:g.size,activeVillageoisCount:x,activeLoupsCount:S,activeWinCount:j,activeLossCount:C,ongoingVillageoisCount:f,ongoingLoupsCount:t,ongoingWinCount:p,ongoingLossCount:V,...b}}function Z(){const{data:e,isLoading:c,error:g}=T(n=>Q(n));return{data:e,isLoading:c,error:g}}function oe(){const{data:e,isLoading:c,error:g}=Z(),{navigateToGameDetails:n,navigationState:d,updateNavigationState:a}=P(),{settings:u}=O(),[r,b]=y.useState(d.selectedSeriesType||"villageois"),[x,S]=y.useState(null),j=y.useRef(null),C=z(),f=l=>{b(l),a({selectedSeriesType:l})},{currentData:t,highlightedPlayerAdded:p}=y.useMemo(()=>{if(!e)return{currentData:[],highlightedPlayerAdded:!1};let l=[];switch(r){case"villageois":l=e.allVillageoisSeries;break;case"loup":l=e.allLoupsSeries;break;case"wins":l=e.allWinSeries;break;case"losses":l=e.allLossSeries;break;default:l=[]}const h=l.slice(0,20),i=u.highlightedPlayer&&h.some(W=>W.player===u.highlightedPlayer);let m=[...h],v=!1;if(u.highlightedPlayer&&!i){const W=l.find(A=>A.player===u.highlightedPlayer);W&&(m.push({...W,isHighlightedAddition:!0}),v=!0)}return{currentData:m,highlightedPlayerAdded:v}},[e,r,u.highlightedPlayer]);if(c)return s.jsx("div",{className:"donnees-attente",children:"Récupération des séries de joueurs..."});if(g)return s.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]});if(!e)return s.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de série disponible"});const V=l=>Object.entries(l).map(([h,i])=>`${h} (${i})`).join(", "),o=()=>{switch(r){case"villageois":return"Plus Longues Séries Villageois Consécutives";case"loup":return"Plus Longues Séries Loups Consécutives";case"wins":return"Plus Longues Séries de Victoires";case"losses":return"Plus Longues Séries de Défaites";default:return""}},L=({active:l,payload:h})=>{if(!l||!h||h.length===0)return null;const i=h[0].payload,m=i.isHighlightedAddition,v=u.highlightedPlayer===i.player;return r==="wins"?s.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[s.jsxs("div",{children:[s.jsx("strong",{children:i.player}),i.isOngoing&&s.jsx("span",{style:{marginLeft:"8px",fontSize:"1.2em"},children:"🔥"})]}),s.jsxs("div",{children:["Série de victoires : ",i.seriesLength," parties ",i.isOngoing?"(En cours)":""]}),s.jsxs("div",{children:["Du ",i.startGame," au ",i.endGame]}),s.jsxs("div",{children:["Du ",i.startDate," au ",i.endDate]}),s.jsxs("div",{children:["Camps joués : ",V(i.campCounts)]}),m&&s.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontStyle:"italic",textAlign:"center"},children:"🎯 Joueur mis en évidence (hors top 20)"}),v&&!m&&s.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontStyle:"italic",textAlign:"center"},children:"🎯 Joueur mis en évidence"}),i.isOngoing&&s.jsx("div",{style:{fontSize:"0.8rem",color:"#FF8C00",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center"},children:"🔥 Série en cours - Aucun jeu depuis !"}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]}):r==="losses"?s.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[s.jsxs("div",{children:[s.jsx("strong",{children:i.player}),i.isOngoing&&s.jsx("span",{style:{marginLeft:"8px",fontSize:"1.2em"},children:"🔥"})]}),s.jsxs("div",{children:["Série de défaites : ",i.seriesLength," parties ",i.isOngoing?"(En cours)":""]}),s.jsxs("div",{children:["Du ",i.startGame," au ",i.endGame]}),s.jsxs("div",{children:["Du ",i.startDate," au ",i.endDate]}),s.jsxs("div",{children:["Camps joués : ",V(i.campCounts)]}),m&&s.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontStyle:"italic",textAlign:"center"},children:"🎯 Joueur mis en évidence (hors top 20)"}),v&&!m&&s.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontStyle:"italic",textAlign:"center"},children:"🎯 Joueur mis en évidence"}),i.isOngoing&&s.jsx("div",{style:{fontSize:"0.8rem",color:"#FF8C00",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center"},children:"🔥 Série en cours - Aucun jeu depuis !"}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]}):s.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[s.jsxs("div",{children:[s.jsx("strong",{children:i.player}),i.isOngoing&&s.jsx("span",{style:{marginLeft:"8px",fontSize:"1.2em"},children:"🔥"})]}),s.jsxs("div",{children:["Série ",i.camp," : ",i.seriesLength," parties consécutives ",i.isOngoing?"(En cours)":""]}),s.jsxs("div",{children:["Du ",i.startGame," au ",i.endGame]}),s.jsxs("div",{children:["Du ",i.startDate," au ",i.endDate]}),m&&s.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontStyle:"italic",textAlign:"center"},children:"🎯 Joueur mis en évidence (hors top 20)"}),v&&!m&&s.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontStyle:"italic",textAlign:"center"},children:"🎯 Joueur mis en évidence"}),i.isOngoing&&s.jsx("div",{style:{fontSize:"0.8rem",color:"#FF8C00",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center"},children:"🔥 Série en cours - Aucun jeu depuis !"}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})},G=l=>{if(r==="wins")n({selectedPlayer:l.player,selectedGameIds:l.gameIds,fromComponent:"Séries de Victoires"});else if(r==="losses")n({selectedPlayer:l.player,selectedGameIds:l.gameIds,fromComponent:"Séries de Défaites"});else{const h=r==="villageois"?"Villageois":"Loup";n({selectedPlayer:l.player,selectedGameIds:l.gameIds,campFilter:{selectedCamp:h,campFilterMode:"all-assignments"},fromComponent:`Séries ${h}`})}};return s.jsxs("div",{className:"lycans-players-series",children:[s.jsx("h2",{children:"Séries des Joueurs"}),s.jsxs("p",{className:"lycans-stats-info",children:["Basé sur ",e.totalGamesAnalyzed," parties analysées"]}),s.jsx("div",{className:"lycans-section-description",children:s.jsxs("p",{children:[s.jsx("strong",{children:"Séries de camps :"})," Parties consécutives dans le même camp principal (Villageois ou Loups). Jouer dans n'importe quel autre camp brise la série.",s.jsx("br",{}),s.jsx("strong",{children:"Séries de victoires :"})," Victoires consécutives dans n'importe quel camp. Une défaite brise la série.",s.jsx("br",{}),s.jsx("strong",{children:"Séries de défaites :"})," Défaites consécutives dans n'importe quel camp. Une victoire brise la série.",s.jsx("br",{}),s.jsx("strong",{children:"🔥 Séries en cours :"})," Les séries avec l'effet de flamme sont encore actives"]})}),s.jsxs("div",{className:"lycans-categories-selection",children:[s.jsx("button",{className:`lycans-categorie-btn ${r==="villageois"?"active":""}`,onClick:()=>f("villageois"),children:"Séries Villageois"}),s.jsx("button",{className:`lycans-categorie-btn ${r==="loup"?"active":""}`,onClick:()=>f("loup"),children:"Séries Loups"}),s.jsx("button",{className:`lycans-categorie-btn ${r==="wins"?"active":""}`,onClick:()=>f("wins"),children:"Séries de Victoires"}),s.jsx("button",{className:`lycans-categorie-btn ${r==="losses"?"active":""}`,onClick:()=>f("losses"),children:"Séries de Défaites"})]}),s.jsxs("div",{className:"lycans-graphique-section",children:[s.jsxs("div",{children:[s.jsx("h3",{children:o()}),p&&u.highlightedPlayer&&s.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['🎯 "',u.highlightedPlayer,'" affiché en plus du top 20']})]}),s.jsx(w,{title:o(),children:s.jsx("div",{ref:j,style:{height:500},children:s.jsx(M,{width:"100%",height:"100%",children:s.jsxs(F,{data:t,margin:{top:20,right:30,left:20,bottom:10},children:[s.jsx(N,{strokeDasharray:"3 3"}),s.jsx(I,{dataKey:"player",angle:-45,textAnchor:"end",height:120,interval:0,tick:({x:l,y:h,payload:i})=>s.jsx("text",{x:l,y:h,dy:16,textAnchor:"end",fill:u.highlightedPlayer===i.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:u.highlightedPlayer===i.value?14:13,fontWeight:u.highlightedPlayer===i.value?"bold":"italic",transform:`rotate(-45 ${l} ${h})`,children:i.value})}),s.jsx(E,{label:{value:r==="wins"?"Victoires consécutives":r==="losses"?"Défaites consécutives":"Parties consécutives",angle:270,position:"insideLeft",style:{textAnchor:"middle"}}}),s.jsx($,{content:L}),s.jsx(k,{dataKey:"seriesLength",name:r==="wins"?"Victoires consécutives":r==="losses"?"Défaites consécutives":"Parties consécutives",fill:r==="villageois"?"#82ca9d":r==="loup"?"#FF8042":r==="wins"?"#8884d8":"#dc3545",children:t.map((l,h)=>{const i=u.highlightedPlayer===l.player,m=x===l.player,v=l.isHighlightedAddition,W=C[l.player]||(r==="villageois"?"#82ca9d":r==="loup"?"#FF8042":r==="wins"?"#8884d8":"#dc3545");return s.jsx(R,{fill:W,stroke:i?"var(--accent-primary)":m?"var(--text-primary)":"none",strokeWidth:i?3:m?2:0,strokeDasharray:v?"5,5":"none",opacity:v?.8:1,onClick:()=>G(l),onMouseEnter:()=>S(l.player),onMouseLeave:()=>S(null),style:{cursor:"pointer"},className:l.isOngoing?"lycans-ongoing-series":""},`cell-${r}-${h}`)})})]})})})}),t.length>0&&s.jsxs("div",{className:"lycans-stats-grid",style:{marginTop:"0rem",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))"},children:[s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"🏆 Record Absolu"}),s.jsxs("div",{className:"lycans-stat-value",children:[t[0].seriesLength,t[0].isOngoing&&s.jsx("span",{style:{fontSize:"0.6em",marginLeft:"5px"},children:"🔥"})]}),s.jsxs("p",{children:["par ",s.jsx("strong",{children:t[0].player}),t[0].isOngoing&&s.jsx("span",{style:{color:"#FF8C00",fontWeight:"bold"},children:" (En cours)"})]}),r==="wins"||r==="losses"?s.jsxs("p",{className:"lycans-h2h-description",children:["Camps : ",V(t[0].campCounts||{})]}):s.jsxs("p",{className:"lycans-h2h-description",children:["Camp : ",t[0].camp]})]}),s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"📊 Meilleure série moyenne (tous les joueurs)"}),s.jsx("div",{className:"lycans-stat-value",children:r==="villageois"?e.averageVillageoisSeries:r==="loup"?e.averageLoupsSeries:r==="wins"?e.averageWinSeries:e.averageLossSeries}),s.jsx("p",{children:"parties en moyenne"}),s.jsxs("p",{className:"lycans-h2h-description",children:["Basé sur ",e.totalPlayersCount," joueurs"]})]}),s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"🔥 Séries En Cours"}),s.jsx("div",{className:"lycans-stat-value",children:r==="villageois"?e.activeVillageoisCount:r==="loup"?e.activeLoupsCount:r==="wins"?e.activeWinCount:e.activeLossCount}),s.jsx("p",{children:"séries encore actives"}),s.jsx("p",{className:"lycans-h2h-description",children:(r==="villageois"?e.activeVillageoisCount:r==="loup"?e.activeLoupsCount:r==="wins"?e.activeWinCount:e.activeLossCount)>0?"Joueurs actuellement dans une série de ce type":"Aucune série active de ce type"})]})]}),t.length===0&&s.jsxs("div",{className:"lycans-empty-section",children:[s.jsx("h3",{children:"Aucune série trouvée"}),s.jsx("p",{children:"Aucune série n'a été trouvée pour ce type avec les filtres actuels."})]})]})]})}export{oe as PlayerSeriesChart};
