import{r as p,j as l,e as m}from"./index-BN9sn1rr.js";function f(s){if(!s)return null;try{const e=new URL(s);let n=null;if(e.hostname==="clips.twitch.tv")n=e.pathname.split("/")[1];else if(e.hostname.includes("twitch.tv")){const a=e.pathname.split("/"),r=a.indexOf("clip");r!==-1&&a[r+1]&&(n=a[r+1])}if(n)return`https://clips.twitch.tv/embed?clip=${n}&parent=${window.location.hostname}`}catch(e){console.warn("Failed to parse Twitch clip URL:",s,e)}return null}function o(s){return s.NewName?s.NewName:s.ClipName?s.ClipName:`Clip ${s.ClipId}`}function y(s){return s?s.split(",").map(e=>e.trim()).filter(e=>e.length>0):[]}function x(s){return s?s.split(",").map(e=>e.trim()).filter(e=>e.length>0):[]}function v(s){const e=[s.POVPlayer],n=y(s.OthersPlayers);return[...e,...n]}function g(s,e){const n=e.toLowerCase();return s.filter(a=>v(a).map(c=>c.toLowerCase()).includes(n))}function C(s,e){const n=x(s.RelatedClips);return e.filter(a=>n.includes(a.ClipId))}function P(s,e){return s.NextClip&&e.find(n=>n.ClipId===s.NextClip)||null}function j(s){const e=new Map;return s.forEach(n=>{Array.isArray(n.Tags)&&n.Tags.length>0?n.Tags.forEach(a=>{e.has(a)||e.set(a,[]),e.get(a).push(n)}):(e.has("Sans catégorie")||e.set("Sans catégorie",[]),e.get("Sans catégorie").push(n))}),e}function b(s){return j(s)}function A({clip:s,onClose:e,onNextClip:n,onRelatedClip:a,relatedClips:r=[],nextClip:c=null}){p.useEffect(()=>{const i=t=>{t.key==="Escape"&&e()};return window.addEventListener("keydown",i),()=>window.removeEventListener("keydown",i)},[e]);const d=f(s.ClipUrl),u=o(s),h=y(s.OthersPlayers);return l.jsx("div",{className:"lycans-clip-viewer-overlay",onClick:e,children:l.jsxs("div",{className:"lycans-clip-viewer-container",onClick:i=>i.stopPropagation(),children:[l.jsxs("div",{className:"lycans-clip-viewer-header",children:[l.jsxs("div",{className:"lycans-clip-viewer-title",children:[l.jsx("h2",{children:u}),Array.isArray(s.Tags)&&s.Tags.length>0&&l.jsx("div",{className:"lycans-clip-tags",children:s.Tags.map((i,t)=>l.jsx("span",{className:"lycans-clip-tag",children:i},t))})]}),l.jsx("button",{className:"lycans-clip-viewer-close",onClick:e,children:"✕"})]}),l.jsxs("div",{className:"lycans-clip-viewer-content",children:[l.jsx("div",{className:"lycans-clip-player",children:d?l.jsx("iframe",{src:d,frameBorder:"0",allowFullScreen:!0,scrolling:"no",title:u}):l.jsxs("div",{className:"lycans-clip-no-video",children:[l.jsx("p",{children:"Vidéo non disponible"}),s.ClipUrl&&l.jsx("a",{href:s.ClipUrl,target:"_blank",rel:"noopener noreferrer",children:"Voir sur Twitch"})]})}),l.jsxs("div",{className:"lycans-clip-metadata",children:[l.jsxs("div",{className:"lycans-clip-info-section",children:[l.jsx("h3",{children:"Joueurs"}),l.jsxs("div",{className:"lycans-clip-players",children:[l.jsxs("div",{className:"lycans-clip-pov-player",children:[l.jsx("span",{className:"lycans-clip-pov-badge",children:"POV"}),l.jsx("span",{className:"lycans-clip-player-name",children:s.POVPlayer})]}),h.length>0&&l.jsx("div",{className:"lycans-clip-other-players",children:h.map((i,t)=>l.jsx("span",{className:"lycans-clip-player-name",children:i},t))})]})]}),s.AdditionalInfo&&l.jsxs("div",{className:"lycans-clip-info-section",children:[l.jsx("h3",{children:"Description"}),l.jsx("p",{className:"lycans-clip-description",children:s.AdditionalInfo})]}),(c||r.length>0)&&l.jsxs("div",{className:"lycans-clip-info-section",children:[l.jsx("h3",{children:"Clips liés"}),l.jsxs("div",{className:"lycans-clip-navigation",children:[c&&n&&l.jsxs("button",{className:"lycans-clip-nav-btn lycans-clip-next-btn",onClick:n,children:["▶ Suivant: ",o(c)]}),r.length>0&&a&&l.jsxs("div",{className:"lycans-clip-related-clips",children:[l.jsx("p",{className:"lycans-clip-related-label",children:"Autres POV:"}),r.map(i=>l.jsxs("button",{className:"lycans-clip-nav-btn lycans-clip-related-btn",onClick:()=>a(i.ClipId),children:[o(i)," (",i.POVPlayer,")"]},i.ClipId))]})]})]})]})]})]})})}function N(){const{data:s,isLoading:e,error:n}=m();return{clips:p.useMemo(()=>{if(!s)return[];const r=[];return s.forEach(c=>{c.Clips&&Array.isArray(c.Clips)&&r.push(...c.Clips)}),r},[s]),isLoading:e,error:n}}function E(s){const{clips:e,isLoading:n,error:a}=N();return{clips:p.useMemo(()=>s?g(e,s):[],[e,s]),isLoading:n,error:a}}export{A as C,o as a,C as b,E as c,P as f,b as g,N as u};
