import{u as ae,a as Z,b as ee,r as P,g as ne,j as e}from"./index-DJ0WLRT1.js";import{u as se}from"./usePlayerStatsFromRaw-BD-vJFXD.js";import{u as te}from"./useJoueursData-TzC9a1vR.js";import{u as ie,C as V,M as le,m as oe}from"./api-D_uKdgoL.js";import{F as $,C as B,X as O,Y as K}from"./FullscreenChart-XeGgV_IM.js";import{R as _,T as J,a as L}from"./CategoricalChart-DfEzqEEv.js";import{B as Y,a as U}from"./BarChart-QMu0j4ze.js";import{R as re}from"./ReferenceLine-BvBnKe00.js";import"./baseStatsHook-Cv-LeiqH.js";import"./datasyncExport-BirWLS1z.js";import"./CartesianScaleHelper-B5QcuZLv.js";const G=.35,de=["Janvier","FÃ©vrier","Mars","Avril","Mai","Juin","Juillet","AoÃ»t","Septembre","Octobre","Novembre","DÃ©cembre"];function Q(f){const[A,u]=f.split("-"),C=parseInt(u,10)-1;return`${de[C]} ${A}`}function ce({selectedMonth:f,onMonthChange:A}){const{gameData:u}=ae(),{navigateToGameDetails:C}=Z(),{settings:y}=ee(),{joueursData:H}=te(),s=ie(H),[x,z]=P.useState(null),{months:S,monthKeys:p}=P.useMemo(()=>{if(!u||u.length===0)return{months:new Map,monthKeys:[]};const t=new Map;for(const a of u){const d=new Date(a.StartDate),l=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}`;t.has(l)||t.set(l,[]),t.get(l).push(a)}const r=new Map;for(const[a,d]of t){const l=d.length,n=Math.ceil(l*G),g=new Map;for(const o of d)for(const R of o.PlayerStats){const j=ne(R);g.has(j)||g.set(j,{displayName:R.Username,gamesPlayed:0,wins:0});const w=g.get(j);w.gamesPlayed++,R.Victorious&&w.wins++}const h=[];for(const[,o]of g)o.gamesPlayed>=n&&h.push({player:o.displayName,gamesPlayed:o.gamesPlayed,wins:o.wins,winPercent:o.gamesPlayed>0?(o.wins/o.gamesPlayed*100).toFixed(1):"0.0"});h.sort((o,R)=>parseFloat(R.winPercent)-parseFloat(o.winPercent)),r.set(a,{key:a,label:Q(a),totalGames:l,players:h})}const i=[...r.keys()].sort();return{months:r,monthKeys:i}},[u]),v=P.useMemo(()=>f&&p.includes(f)?f:p.length>0?p[p.length-1]:null,[f,p]),m=v?S.get(v):null,{chartData:W,highlightedPlayerAdded:I,averageWinRate:k,minGamesRequired:D}=P.useMemo(()=>{if(!m)return{chartData:[],highlightedPlayerAdded:!1,averageWinRate:"0",minGamesRequired:0};const t=Math.ceil(m.totalGames*G),r=m.players.slice(0,V.TOP_15);let i=0;for(const n of m.players)i+=parseFloat(n.winPercent);const a=m.players.length>0?(i/m.players.length).toFixed(1):"0";let d=[...r],l=!1;if(y.highlightedPlayer&&!r.some(g=>g.player===y.highlightedPlayer)){const g=m.players.find(h=>h.player===y.highlightedPlayer);if(g)d.push({...g,isHighlightedAddition:!0}),l=!0;else if(u){const h=new Date(v+"-01"),o=new Date(h.getFullYear(),h.getMonth(),1),R=new Date(h.getFullYear(),h.getMonth()+1,0,23,59,59);let j=0,w=0;for(const c of u){const b=new Date(c.StartDate);if(b>=o&&b<=R)for(const X of c.PlayerStats)X.Username===y.highlightedPlayer&&(j++,X.Victorious&&w++)}j>0&&(d.push({player:y.highlightedPlayer,gamesPlayed:j,wins:w,winPercent:(w/j*100).toFixed(1),isHighlightedAddition:!0}),l=!0)}}return{chartData:d,highlightedPlayerAdded:l,averageWinRate:a,minGamesRequired:t}},[m,y.highlightedPlayer,u,v]),T=v?p.indexOf(v):-1,M=T>0,F=T<p.length-1,q=P.useCallback(()=>{M&&A(p[T-1])},[M,T,p,A]),E=P.useCallback(()=>{F&&A(p[T+1])},[F,T,p,A]);return!u||u.length===0?e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible pour le classement mensuel"}):p.length===0?e.jsx("div",{className:"donnees-manquantes",children:"Aucun mois avec des parties trouvÃ©"}):e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Classement Mensuel â€” Taux de Victoire"}),I&&y.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',y.highlightedPlayer,'" affichÃ© en plus du classement']})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1rem"},children:[e.jsx("button",{onClick:q,disabled:!M,style:{background:"var(--bg-tertiary)",color:M?"var(--text-primary)":"var(--text-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.4rem 0.8rem",fontSize:"1rem",cursor:M?"pointer":"not-allowed",opacity:M?1:.5},children:"â—€"}),e.jsx("select",{value:v||"",onChange:t=>A(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.95rem",fontWeight:"bold",minWidth:"180px",textAlign:"center"},children:p.map(t=>e.jsx("option",{value:t,children:Q(t)},t))}),e.jsx("button",{onClick:E,disabled:!F,style:{background:"var(--bg-tertiary)",color:F?"var(--text-primary)":"var(--text-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.4rem 0.8rem",fontSize:"1rem",cursor:F?"pointer":"not-allowed",opacity:F?1:.5},children:"â–¶"})]}),e.jsx($,{title:`Classement Mensuel â€” ${m?.label||""}`,children:e.jsx("div",{style:{height:400},children:W.length===0?e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--text-secondary)",fontSize:"1rem"},children:["Aucun joueur n'a jouÃ© au moins ",D," partie",D>1?"s":""," ce mois-ci (",Math.round(G*100),"% de ",m?.totalGames??0," parties)"]}):e.jsx(_,{width:"100%",height:"100%",children:e.jsxs(Y,{data:W,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:r,payload:i})=>e.jsx("text",{x:t,y:r,dy:16,textAnchor:"end",fill:y.highlightedPlayer===i.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:y.highlightedPlayer===i.value?14:13,fontWeight:y.highlightedPlayer===i.value?"bold":"italic",transform:`rotate(-45 ${t} ${r})`,children:i.value})}),e.jsx(K,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(J,{content:({active:t,payload:r})=>{if(t&&r&&r.length>0){const i=r[0].payload,a=i.isHighlightedAddition,d=y.highlightedPlayer===i.player,l=i.gamesPlayed>=D;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:i.player})}),e.jsxs("div",{children:["Taux de victoire : ",i.winPercent,"%"]}),e.jsxs("div",{children:["Victoires : ",i.wins," / ",i.gamesPlayed," parties"]}),a&&!l&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",D," parties requises)"]}),a&&l&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"}),d&&!a&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(U,{dataKey:"winPercent",name:"Taux de Victoire",fill:"#8884d8",shape:t=>{const{x:r,y:i,width:a,height:d,payload:l}=t,n=l,g=y.highlightedPlayer===n.player,h=x===n.player,o=n.isHighlightedAddition;return e.jsx(L,{x:r,y:i,width:a,height:d,fill:s[n.player]||"#8884d8",stroke:g?"var(--accent-primary)":h?"var(--text-primary)":"none",strokeWidth:g?3:h?2:0,strokeDasharray:o?"5,5":"none",opacity:o?.8:1,onClick:()=>{C({selectedPlayer:n.player,selectedPlayerWinMode:"wins-only",fromComponent:`Classement Mensuel â€” ${m?.label||""}`})},onMouseEnter:()=>z(n.player),onMouseLeave:()=>z(null),style:{cursor:"pointer"}})}}),e.jsx(re,{y:parseFloat(k),stroke:"red",strokeDasharray:"3 3",label:{value:`Moyenne: ${k}%`,position:"insideBottomRight",fill:"red",fontSize:12,fontWeight:"bold"}})]})})})}),e.jsx("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:m&&e.jsxs(e.Fragment,{children:[W.filter(t=>!t.isHighlightedAddition).length," joueur",W.filter(t=>!t.isHighlightedAddition).length>1?"s":""," classÃ©",W.filter(t=>!t.isHighlightedAddition).length>1?"s":""," sur"," ",m.totalGames," partie",m.totalGames>1?"s":""," ce mois"," ","(min. ",D," partie",D>1?"s":""," â€” ",Math.round(G*100),"%)"]})})]})}const he=400;function Se(){const{data:f,isLoading:A,error:u}=se(),{navigateToGameDetails:C,navigationState:y,updateNavigationState:H}=Z(),{settings:s}=ee(),[x,z]=P.useState(y.playersGeneralState?.minGamesForWinRate||le.MEDIUM),[S,p]=P.useState(y.playersGeneralState?.winRateOrder||"best"),[N,v]=P.useState(null),[m,W]=P.useState(y.playersGeneralState?.selectedMonth||null),{joueursData:I}=te(),k=ie(I);P.useEffect(()=>{const t=y.playersGeneralState;(!t||t.minGamesForWinRate!==x||t.winRateOrder!==S||t.selectedMonth!==m)&&H({playersGeneralState:{minGamesForWinRate:x,winRateOrder:S,focusChart:t?.focusChart,selectedMonth:m||void 0}})},[x,S,m,H]);const{participationData:D,winRateData:T,averageWinRate:M,totalEligiblePlayers:F,highlightedPlayerInParticipation:q,highlightedPlayerInWinRate:E}=P.useMemo(()=>{if(!f?.playerStats)return{participationData:[],winRateData:[],averageWinRate:"0",totalEligiblePlayers:0,highlightedPlayerInParticipation:!1,highlightedPlayerInWinRate:!1};const t=f.playerStats,r=[],i=[];let a=0;for(const c of t)a+=parseFloat(c.winPercent),c.gamesPlayed>=x&&r.push(c),c.gamesPlayed>2&&i.push(c);const d=t.length>0?(a/t.length).toFixed(1):"0",l=i.sort((c,b)=>b.gamesPlayed-c.gamesPlayed).slice(0,V.TOP_15),n=s.highlightedPlayer&&l.some(c=>c.player===s.highlightedPlayer);let g=[...l],h=!1;if(s.highlightedPlayer&&!n){const c=i.find(b=>b.player===s.highlightedPlayer);c&&(g.push({...c,isHighlightedAddition:!0}),h=!0)}const o=r.sort((c,b)=>S==="best"?parseFloat(b.winPercent)-parseFloat(c.winPercent):parseFloat(c.winPercent)-parseFloat(b.winPercent)).slice(0,V.TOP_15),R=s.highlightedPlayer&&o.some(c=>c.player===s.highlightedPlayer);let j=[...o],w=!1;if(s.highlightedPlayer&&!R){const c=t.find(b=>b.player===s.highlightedPlayer);c&&(j.push({...c,isHighlightedAddition:!0}),w=!0)}return{participationData:g,winRateData:j,averageWinRate:d,totalEligiblePlayers:r.length,highlightedPlayerInParticipation:h,highlightedPlayerInWinRate:w}},[f,x,S,s.highlightedPlayer]);return A?e.jsx("div",{className:"donnees-attente",children:"RÃ©cupÃ©ration des statistiques des joueurs..."}):u?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",u]}):f?e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques des Joueurs"}),e.jsxs("p",{className:"lycans-stats-info",children:["Total de ",f.totalGames," parties analysÃ©es avec ",f.playerStats.length," joueurs"]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Top Participations"}),q&&s.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',s.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx($,{title:"Top Participations",children:e.jsx("div",{style:{height:450},children:e.jsx(_,{width:"100%",height:"100%",children:e.jsxs(Y,{data:D,margin:{top:100,right:30,left:20,bottom:10},children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:r,payload:i})=>e.jsx("text",{x:t,y:r,dy:16,textAnchor:"end",fill:s.highlightedPlayer===i.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:s.highlightedPlayer===i.value?14:13,fontWeight:s.highlightedPlayer===i.value?"bold":"italic",transform:`rotate(-45 ${t} ${r})`,children:i.value})}),e.jsx(K,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(J,{content:({active:t,payload:r})=>{if(t&&r&&r.length>0){const i=r[0].payload,a=i.isHighlightedAddition,d=s.highlightedPlayer===i.player;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:i.player})}),e.jsxs("div",{children:["Parties jouÃ©es : ",i.gamesPlayed]}),e.jsxs("div",{children:["Pourcentage : ",i.gamesPlayedPercent,"%"]}),a&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"}),d&&!a&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(U,{dataKey:"gamesPlayed",name:"Parties jouÃ©es",fill:"#00C49F",shape:t=>{const{x:r,y:i,width:a,height:d,payload:l}=t,n=l,g=s.highlightedPlayer===n.player,h=N===n.player,o=n.isHighlightedAddition;return e.jsx(L,{x:r,y:i,width:a,height:d,fill:k[n.player]||"#00C49F",stroke:g?"var(--accent-primary)":h?"var(--text-primary)":"none",strokeWidth:g?3:h?2:0,strokeDasharray:o?"5,5":"none",opacity:o?.8:1,onClick:()=>{C({selectedPlayer:n.player,fromComponent:"Statistiques Joueurs"})},onMouseEnter:()=>v(n.player),onMouseLeave:()=>v(null),style:{cursor:"pointer"}})}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:S==="best"?"Meilleurs Taux de Victoire":"Moins Bons Taux de Victoire"}),E&&s.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',s.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsxs("select",{value:S,onChange:t=>p(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"best",children:"Meilleurs Taux de Victoire"}),e.jsx("option",{value:"worst",children:"Moins Bons Taux de Victoire"})]}),e.jsx("label",{htmlFor:"min-games-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select",value:x,onChange:t=>z(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:oe.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx($,{title:S==="best"?"Meilleurs Taux de Victoire":"Moins Bons Taux de Victoire",children:e.jsx("div",{style:{height:he},children:e.jsx(_,{width:"100%",height:"100%",children:e.jsxs(Y,{data:T,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:r,payload:i})=>e.jsx("text",{x:t,y:r,dy:16,textAnchor:"end",fill:s.highlightedPlayer===i.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:s.highlightedPlayer===i.value?14:13,fontWeight:s.highlightedPlayer===i.value?"bold":"italic",transform:`rotate(-45 ${t} ${r})`,children:i.value})}),e.jsx(K,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(J,{content:({active:t,payload:r})=>{if(t&&r&&r.length>0){const i=r[0].payload,a=i.isHighlightedAddition,d=s.highlightedPlayer===i.player,l=i.gamesPlayed>=x;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:i.player})}),e.jsxs("div",{children:["Taux de victoire : ",i.winPercent,"%"]}),e.jsxs("div",{children:["Victoires : ",i.wins," / ",i.gamesPlayed]}),a&&!l&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",x," parties)"]}),a&&l&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"}),d&&!a&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(U,{dataKey:"winPercent",name:"Taux de Victoire",fill:"#8884d8",shape:t=>{const{x:r,y:i,width:a,height:d,payload:l}=t,n=l,g=s.highlightedPlayer===n.player,h=N===n.player,o=n.isHighlightedAddition;return e.jsx(L,{x:r,y:i,width:a,height:d,fill:k[n.player]||"#8884d8",stroke:g?"var(--accent-primary)":h?"var(--text-primary)":"none",strokeWidth:g?3:h?2:0,strokeDasharray:o?"5,5":"none",opacity:o?.8:1,onClick:()=>{C({selectedPlayer:n.player,selectedPlayerWinMode:"wins-only",fromComponent:"Taux de Victoire"})},onMouseEnter:()=>v(n.player),onMouseLeave:()=>v(null),style:{cursor:"pointer"}})}}),e.jsx(re,{y:parseFloat(M),stroke:"red",strokeDasharray:"3 3",label:{value:`Moyenne: ${M}%`,position:"insideBottomRight",fill:"red",fontSize:12,fontWeight:"bold"}})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",T.length," des joueurs (sur ",F," ayant au moins ",x," partie",x>1?"s":"",")"]})]}),e.jsx(ce,{selectedMonth:m,onMonthChange:W})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de joueur disponible"})}export{Se as PlayersGeneralStatisticsChart};
