import{c as G,p as C,r as j,j as e}from"./index-W-K9DPJm.js";import{F as g,B as b,C as w,X as D,Y as S,a as y,b as B}from"./FullscreenChart-D5w9CRxd.js";import{u as k,g as $}from"./api-hWIyheC8.js";import{R as v,T as R}from"./CategoricalChart-DQC6IjZi.js";import{P as J,a as V}from"./PieChart-BX5KYYVM.js";import{L as I}from"./Legend-Dd4BtS4A.js";import"./PolarChart-eTVBR0cN.js";function T(){const[t,c]=j.useState(null),[f,p]=j.useState(null),[x,u]=j.useState(!0),[h,d]=j.useState(null);return j.useEffect(()=>{(async()=>{try{u(!0),d(null);const i=await fetch("/data/rawBRData.json");if(!i.ok)throw new Error("Failed to fetch rawBRData");const s=await i.json();c(s.BRParties?.data||[]),p(s.BRRefParties?.data||[])}catch(i){console.error("Error fetching raw BR data:",i),d(i instanceof Error?i.message:"Unknown error")}finally{u(!1)}})()},[]),{brPartiesData:t,brRefPartiesData:f,isLoading:x,error:h}}function W(){const{settings:t}=G(),{brPartiesData:c,brRefPartiesData:f,isLoading:p,error:x}=T();return{data:c?.filter(h=>{if(!h.Game||!h.Participants)return!1;const d=f?.find(m=>m.Game===h.Game);if(!d)return F(h,t);if(t.filterMode==="gameType"&&t.gameFilter!=="all"){if(t.gameFilter==="modded"){if(!d["Game Moddée"])return!1}else if(t.gameFilter==="non-modded"&&d["Game Moddée"])return!1}else if(t.filterMode==="dateRange"&&(t.dateRange.start||t.dateRange.end)){const m=C(d.Date);if(!m)return!1;if(t.dateRange.start){const i=new Date(t.dateRange.start);if(m<i)return!1}if(t.dateRange.end){const i=new Date(t.dateRange.end);if(m>i)return!1}}return F(h,t)})||null,isLoading:p,error:x}}function z(){const{settings:t}=G(),{brRefPartiesData:c,isLoading:f,error:p}=T();return{data:c?.filter(u=>{if(!u.Game||!u.Date)return!1;if(t.filterMode==="gameType"&&t.gameFilter!=="all"){if(t.gameFilter==="modded"){if(!u["Game Moddée"])return!1}else if(t.gameFilter==="non-modded"&&u["Game Moddée"])return!1}else if(t.filterMode==="dateRange"&&(t.dateRange.start||t.dateRange.end)){const h=C(u.Date);if(!h)return!1;if(t.dateRange.start){const d=new Date(t.dateRange.start);if(h<d)return!1}if(t.dateRange.end){const d=new Date(t.dateRange.end);if(h>d)return!1}}return!0})||null,isLoading:f,error:p}}function F(t,c){if(c.playerFilter.mode!=="none"&&c.playerFilter.players.length>0){const f=t.Participants.toLowerCase();if(c.playerFilter.mode==="include"){if(!c.playerFilter.players.some(x=>x.toLowerCase()===f))return!1}else if(c.playerFilter.mode==="exclude"&&c.playerFilter.players.some(x=>x.toLowerCase()===f))return!1}return!0}function ee(){const{data:t,isLoading:c,error:f}=W(),{data:p,isLoading:x,error:u}=z(),h=k(),d=["var(--chart-color-1)","var(--chart-color-2)","var(--chart-color-3)","var(--chart-color-4)","var(--chart-color-5)","var(--chart-color-6)"],m=s=>h[s]||$(s),i=j.useMemo(()=>{if(!t||!p)return null;const s=p.length,r=t.length,o=t.filter(a=>a.Gagnant).length,P=t.reduce((a,n)=>{const l=n.Participants;return a[l]||(a[l]={name:l,participations:0,wins:0,totalScore:0,averageScore:0,winRate:0}),a[l].participations++,a[l].totalScore+=n.Score,n.Gagnant&&a[l].wins++,a},{});Object.values(P).forEach(a=>{a.averageScore=a.totalScore/a.participations,a.winRate=a.wins/a.participations*100});const L=Object.values(P).sort((a,n)=>n.participations-a.participations).slice(0,10),E=Object.values(P).filter(a=>a.participations>=3).sort((a,n)=>n.winRate-a.winRate).slice(0,10),M=Object.values(P).filter(a=>a.participations>=3).sort((a,n)=>n.averageScore-a.averageScore).slice(0,10),O=t.reduce((a,n)=>{const l=n.Score,N=l===0?"0":l===1?"1":l===2?"2":l===3?"3":l===4?"4":l<=6?"5-6":"7+";return a[N]||(a[N]=0),a[N]++,a},{}),q=Object.entries(O).map(([a,n])=>({range:a,count:n,percentage:(n/r*100).toFixed(1)})),A=p.reduce((a,n)=>{const l=n["Nombre de participants"];return a[l]||(a[l]=0),a[l]++,a},{}),K=Object.entries(A).map(([a,n])=>({participants:parseInt(a),games:n,percentage:(n/s*100).toFixed(1)})).sort((a,n)=>a.participants-n.participants);return{totalGames:s,totalParticipations:r,totalWins:o,winRate:(o/r*100).toFixed(1),averageParticipantsPerGame:(r/s).toFixed(1),topPlayersByParticipations:L,topPlayersByWins:E,topPlayersByAverageScore:M,scoreData:q,participantData:K}},[t,p]);return c||x?e.jsx("div",{className:"statistiques-chargement",children:"Chargement des données Battle Royale..."}):f||u?e.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",f||u]}):i?e.jsxs("div",{className:"lycans-chart-container",children:[e.jsx("div",{className:"lycans-chart-header",children:e.jsx("h2",{children:"Statistiques Battle Royale"})}),e.jsxs("div",{className:"lycans-stats-grid",children:[e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Parties totales"}),e.jsx("div",{className:"lycans-stat-value",children:i.totalGames})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Participations"}),e.jsx("div",{className:"lycans-stat-value",children:i.totalParticipations})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Moy. participants/partie"}),e.jsx("div",{className:"lycans-stat-value",children:i.averageParticipantsPerGame})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Participations"}),e.jsx(g,{title:"Top Joueurs par Participations - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(v,{width:"100%",height:400,children:e.jsxs(b,{data:i.topPlayersByParticipations,children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(D,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(S,{}),e.jsx(R,{content:({active:s,payload:r})=>{if(s&&r&&r.length>0){const o=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:o.name})}),e.jsxs("div",{children:["Participations : ",o.participations]}),e.jsxs("div",{children:["Victoires : ",o.wins]})]})}return null}}),e.jsx(y,{dataKey:"participations",name:"Participations",children:i.topPlayersByParticipations.map((s,r)=>e.jsx(B,{fill:m(s.name)},`cell-${r}`))}),e.jsx(y,{dataKey:"wins",fill:"var(--chart-color-2)",name:"Victoires"})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Taux de Victoire (min. 3 parties)"}),e.jsx(g,{title:"Top Joueurs par Taux de Victoire - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(v,{width:"100%",height:400,children:e.jsxs(b,{data:i.topPlayersByWins,children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(D,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(S,{}),e.jsx(R,{content:({active:s,payload:r})=>{if(s&&r&&r.length>0){const o=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:o.name})}),e.jsxs("div",{children:["Taux de victoire : ",o.winRate.toFixed(2),"%"]}),e.jsxs("div",{children:["Victoires : ",o.wins," / ",o.participations]})]})}return null}}),e.jsx(y,{dataKey:"winRate",name:"Taux de victoire (%)",children:i.topPlayersByWins.map((s,r)=>e.jsx(B,{fill:m(s.name)},`cell-${r}`))})]})})})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Score Moyen par Partie (min. 3 parties)"}),e.jsx(g,{title:"Top Joueurs par Score Moyen - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(v,{width:"100%",height:400,children:e.jsxs(b,{data:i.topPlayersByAverageScore,children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(D,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(S,{}),e.jsx(R,{content:({active:s,payload:r})=>{if(s&&r&&r.length>0){const o=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:o.name})}),e.jsxs("div",{children:["Score moyen : ",o.averageScore.toFixed(2)]}),e.jsxs("div",{children:["Score total : ",o.totalScore," / ",o.participations," parties"]})]})}return null}}),e.jsx(y,{dataKey:"averageScore",name:"Score moyen par partie",children:i.topPlayersByAverageScore.map((s,r)=>e.jsx(B,{fill:m(s.name)},`cell-${r}`))})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Scores"}),e.jsx(g,{title:"Distribution des Scores - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(v,{width:"100%",height:400,children:e.jsxs(J,{children:[e.jsx(V,{data:i.scoreData,cx:"50%",cy:"50%",labelLine:!1,label:({range:s,percentage:r})=>`${s}: ${r}%`,outerRadius:140,fill:"#8884d8",dataKey:"count",children:i.scoreData.map((s,r)=>e.jsx(B,{fill:d[r%d.length]},`cell-${r}`))}),e.jsx(R,{formatter:s=>[s,"Participations"]})]})})})]})]}),e.jsxs("div",{className:"lycans-chart-section",children:[e.jsx("h3",{children:"Répartition par Nombre de Participants"}),e.jsx(g,{title:"Répartition par Nombre de Participants - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(v,{width:"100%",height:400,children:e.jsxs(b,{data:i.participantData,children:[e.jsx(w,{strokeDasharray:"3 3"}),e.jsx(D,{dataKey:"participants"}),e.jsx(S,{}),e.jsx(R,{formatter:(s,r)=>[s,r==="games"?"Parties":r]}),e.jsx(I,{}),e.jsx(y,{dataKey:"games",fill:"var(--chart-color-4)",name:"Nombre de parties"})]})})})]})]}):e.jsx("div",{className:"statistiques-vide",children:"Aucune donnée Battle Royale disponible"})}export{ee as BRGeneralStatsChart};
