import{u as K,a as U,r as x,j as e}from"./index-Dd8Pml7G.js";import{u as X}from"./usePlayerStatsFromRaw-C5sg5gWY.js";import{u as Y}from"./useJoueursData-Is1Gejrt.js";import{M as Q,u as Z,C,m as ee}from"./api-fsKymoBf.js";import{F as w,C as D,X as M,Y as H}from"./FullscreenChart-HoVsB2Ek.js";import{R as k,T as z,a as G}from"./CategoricalChart-BFYM6zTs.js";import{B as N,a as E}from"./BarChart-D0n-bDbJ.js";import{R as te}from"./ReferenceLine-CG8Ds32Y.js";import"./baseStatsHook-BilknrI2.js";import"./datasyncExport-BirWLS1z.js";import"./CartesianScaleHelper-B5QcuZLv.js";const ie=400;function me(){const{data:u,isLoading:I,error:P}=X(),{navigateToGameDetails:j,navigationState:f,updateNavigationState:S}=K(),{settings:r}=U(),[o,B]=x.useState(f.playersGeneralState?.minGamesForWinRate||Q.MEDIUM),[c,q]=x.useState(f.playersGeneralState?.winRateOrder||"best"),[b,v]=x.useState(null),{joueursData:V}=Y(),T=Z(V);x.useEffect(()=>{const t=f.playersGeneralState;(!t||t.minGamesForWinRate!==o||t.winRateOrder!==c)&&S({playersGeneralState:{minGamesForWinRate:o,winRateOrder:c,focusChart:t?.focusChart}})},[o,c,S]);const{participationData:L,winRateData:R,averageWinRate:A,totalEligiblePlayers:O,highlightedPlayerInParticipation:_,highlightedPlayerInWinRate:J}=x.useMemo(()=>{if(!u?.playerStats)return{participationData:[],winRateData:[],averageWinRate:"0",totalEligiblePlayers:0,highlightedPlayerInParticipation:!1,highlightedPlayerInWinRate:!1};const t=u.playerStats,a=[],i=[];let l=0;for(const s of t)l+=parseFloat(s.winPercent),s.gamesPlayed>=o&&a.push(s),s.gamesPlayed>2&&i.push(s);const d=t.length>0?(l/t.length).toFixed(1):"0",h=i.sort((s,p)=>p.gamesPlayed-s.gamesPlayed).slice(0,C.TOP_15),n=r.highlightedPlayer&&h.some(s=>s.player===r.highlightedPlayer);let g=[...h],y=!1;if(r.highlightedPlayer&&!n){const s=i.find(p=>p.player===r.highlightedPlayer);s&&(g.push({...s,isHighlightedAddition:!0}),y=!0)}const m=a.sort((s,p)=>c==="best"?parseFloat(p.winPercent)-parseFloat(s.winPercent):parseFloat(s.winPercent)-parseFloat(p.winPercent)).slice(0,C.TOP_15),$=r.highlightedPlayer&&m.some(s=>s.player===r.highlightedPlayer);let W=[...m],F=!1;if(r.highlightedPlayer&&!$){const s=t.find(p=>p.player===r.highlightedPlayer);s&&(W.push({...s,isHighlightedAddition:!0}),F=!0)}return{participationData:g,winRateData:W,averageWinRate:d,totalEligiblePlayers:a.length,highlightedPlayerInParticipation:y,highlightedPlayerInWinRate:F}},[u,o,c,r.highlightedPlayer]);return I?e.jsx("div",{className:"donnees-attente",children:"RÃ©cupÃ©ration des statistiques des joueurs..."}):P?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",P]}):u?e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques des Joueurs"}),e.jsxs("p",{className:"lycans-stats-info",children:["Total de ",u.totalGames," parties analysÃ©es avec ",u.playerStats.length," joueurs"]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Top Participations"}),_&&r.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',r.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(w,{title:"Top Participations",children:e.jsx("div",{style:{height:450},children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(N,{data:L,margin:{top:100,right:30,left:20,bottom:10},children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(M,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:a,payload:i})=>e.jsx("text",{x:t,y:a,dy:16,textAnchor:"end",fill:r.highlightedPlayer===i.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:r.highlightedPlayer===i.value?14:13,fontWeight:r.highlightedPlayer===i.value?"bold":"italic",transform:`rotate(-45 ${t} ${a})`,children:i.value})}),e.jsx(H,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(z,{content:({active:t,payload:a})=>{if(t&&a&&a.length>0){const i=a[0].payload,l=i.isHighlightedAddition,d=r.highlightedPlayer===i.player;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:i.player})}),e.jsxs("div",{children:["Parties jouÃ©es : ",i.gamesPlayed]}),e.jsxs("div",{children:["Pourcentage : ",i.gamesPlayedPercent,"%"]}),l&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"}),d&&!l&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(E,{dataKey:"gamesPlayed",name:"Parties jouÃ©es",fill:"#00C49F",shape:t=>{const{x:a,y:i,width:l,height:d,payload:h}=t,n=h,g=r.highlightedPlayer===n.player,y=b===n.player,m=n.isHighlightedAddition;return e.jsx(G,{x:a,y:i,width:l,height:d,fill:T[n.player]||"#00C49F",stroke:g?"var(--accent-primary)":y?"var(--text-primary)":"none",strokeWidth:g?3:y?2:0,strokeDasharray:m?"5,5":"none",opacity:m?.8:1,onClick:()=>{j({selectedPlayer:n.player,fromComponent:"Statistiques Joueurs"})},onMouseEnter:()=>v(n.player),onMouseLeave:()=>v(null),style:{cursor:"pointer"}})}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:c==="best"?"Meilleurs Taux de Victoire":"Moins Bons Taux de Victoire"}),J&&r.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',r.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsxs("select",{value:c,onChange:t=>q(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"best",children:"Meilleurs Taux de Victoire"}),e.jsx("option",{value:"worst",children:"Moins Bons Taux de Victoire"})]}),e.jsx("label",{htmlFor:"min-games-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select",value:o,onChange:t=>B(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:ee.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx(w,{title:c==="best"?"Meilleurs Taux de Victoire":"Moins Bons Taux de Victoire",children:e.jsx("div",{style:{height:ie},children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(N,{data:R,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(M,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:a,payload:i})=>e.jsx("text",{x:t,y:a,dy:16,textAnchor:"end",fill:r.highlightedPlayer===i.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:r.highlightedPlayer===i.value?14:13,fontWeight:r.highlightedPlayer===i.value?"bold":"italic",transform:`rotate(-45 ${t} ${a})`,children:i.value})}),e.jsx(H,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(z,{content:({active:t,payload:a})=>{if(t&&a&&a.length>0){const i=a[0].payload,l=i.isHighlightedAddition,d=r.highlightedPlayer===i.player,h=i.gamesPlayed>=o;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:i.player})}),e.jsxs("div",{children:["Taux de victoire : ",i.winPercent,"%"]}),e.jsxs("div",{children:["Victoires : ",i.wins," / ",i.gamesPlayed]}),l&&!h&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",o," parties)"]}),l&&h&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"}),d&&!l&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(E,{dataKey:"winPercent",name:"Taux de Victoire",fill:"#8884d8",shape:t=>{const{x:a,y:i,width:l,height:d,payload:h}=t,n=h,g=r.highlightedPlayer===n.player,y=b===n.player,m=n.isHighlightedAddition;return e.jsx(G,{x:a,y:i,width:l,height:d,fill:T[n.player]||"#8884d8",stroke:g?"var(--accent-primary)":y?"var(--text-primary)":"none",strokeWidth:g?3:y?2:0,strokeDasharray:m?"5,5":"none",opacity:m?.8:1,onClick:()=>{j({selectedPlayer:n.player,selectedPlayerWinMode:"wins-only",fromComponent:"Taux de Victoire"})},onMouseEnter:()=>v(n.player),onMouseLeave:()=>v(null),style:{cursor:"pointer"}})}}),e.jsx(te,{y:parseFloat(A),stroke:"red",strokeDasharray:"3 3",label:{value:`Moyenne: ${A}%`,position:"insideBottomRight",fill:"red",fontSize:12,fontWeight:"bold"}})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",R.length," des joueurs (sur ",O," ayant au moins ",o," partie",o>1?"s":"",")"]})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de joueur disponible"})}export{me as PlayersGeneralStatisticsChart};
