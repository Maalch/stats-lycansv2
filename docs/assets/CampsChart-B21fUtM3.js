import{r as m,j as e}from"./index-rJXQXTnh.js";import{ae as T,R as g,p as f,T as y,B as E,C as D,X as G,Y as S,o as $}from"./statsApi-BxtQXlsH.js";import{u as F}from"./usePlayerCampPerformance-DPQPH2up.js";import{l as b}from"./api-CbhEegR2.js";import{P as N,a as C}from"./PieChart-CpuTbeQ1.js";import{L}from"./Legend-CPVvSFmT.js";function W(){const[o,p]=m.useState(null),[x,l]=m.useState(!0),[j,u]=m.useState(null);return m.useEffect(()=>{(async()=>{l(!0),u(null);try{const c=await T();p(c)}catch(c){u(c instanceof Error?c.message:"Une erreur est survenue"),console.error("Error fetching camp win stats:",c)}finally{l(!1)}})()},[]),{campWinStats:o,isLoading:x,errorInfo:j}}const _="#607D8B";function K(){const{campWinStats:o,isLoading:p,errorInfo:x}=W(),{playerCampPerformance:l,isLoading:j,error:u}=F(),d=m.useMemo(()=>l?.campAverages?l.campAverages.map(a=>({...a,winRateNum:parseFloat(a.winRate)})).sort((a,s)=>s.winRateNum-a.winRateNum):[],[l]),c=m.useMemo(()=>o?.campStats?.map(a=>({...a,winRateNum:typeof a.winRate=="string"?parseFloat(a.winRate):a.winRate}))||[],[o]),v=m.useMemo(()=>{if(!c.length)return[];const a=5;let s=0;const r=[],n=[];return c.forEach(t=>{t.winRateNum<a?(s+=t.winRateNum,r.push(t)):n.push(t)}),s>0&&n.push({camp:"Autres",wins:r.reduce((t,i)=>t+i.wins,0),winRate:s.toFixed(1),winRateNum:s,_details:r}),n},[c]),R=m.useMemo(()=>{if(!d.length)return[];const a=5,s=d.reduce((i,h)=>i+h.totalGames,0);let r=0;const n=[],t=[];if(d.forEach(i=>{const h=i.totalGames/s*100;h<a?(r+=i.totalGames,n.push({...i,winRate:h.toFixed(1)})):t.push(i)}),r>0){const i=n.length>0?(n.reduce((h,P)=>h+P.winRateNum,0)/n.length).toFixed(1):"0.0";t.push({camp:"Autres",totalGames:r,winRate:i,winRateNum:parseFloat(i),_details:n})}return t},[d]),A=p||j,w=x||u;return A?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques des camps..."}):w?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",w]}):!o&&!l?e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de camp disponible"}):e.jsxs("div",{className:"lycans-camps-container",children:[e.jsx("h2",{children:"Statistiques des Camps"}),l&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camps Analysés"}),e.jsx("div",{className:"lycans-valeur-principale",children:l.campAverages.length}),e.jsx("p",{children:"camps différents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Joueurs Évalués"}),e.jsx("div",{className:"lycans-valeur-principale",children:l.playerPerformance.length}),e.jsx("p",{children:"joueurs analysés"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:o?.totalGames||0}),e.jsx("p",{children:"parties analysées"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[o&&v.length>0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Répartition des Victoires par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Distribution des victoires sur ",o.totalGames," parties"]}),e.jsx("div",{style:{height:450},children:e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(N,{children:[e.jsx(C,{data:v,cx:"50%",cy:"50%",labelLine:!1,outerRadius:140,fill:"#8884d8",dataKey:"winRateNum",nameKey:"camp",label:({camp:a,winRate:s})=>a==="Autres"?`Autres: ${s}%`:`${a}: ${s}%`,children:v.map((a,s)=>e.jsx(f,{fill:a.camp==="Autres"?"#cccccc":b[a.camp]||_},`cellule-camp-${s}`))}),e.jsx(y,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const r=s[0].payload;if(r.camp==="Autres"&&r._details){const n=[...r._details].sort((t,i)=>i.winRateNum-t.winRateNum);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:"Autres"})}),e.jsx("div",{children:n.map((t,i)=>e.jsxs("div",{children:[t.camp,": ",t.wins," victoires (",t.winRate,"%)"]},i))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold"},children:["Total: ",r.wins," victoires (",r.winRate,"%)"]})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:r.camp}),e.jsxs("div",{children:["Victoires: ",r.wins]}),e.jsxs("div",{children:["Taux de victoire: ",r.winRate,"%"]})]})}return null}}),e.jsx(L,{})]})})})]})}),l&&d.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire Moyen par Camp"}),e.jsx("div",{style:{height:400},children:e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(E,{data:d,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(D,{strokeDasharray:"3 3"}),e.jsx(G,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(S,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(y,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const r=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.camp})}),e.jsxs("div",{children:["Parties totales: ",r.totalGames]}),e.jsxs("div",{children:["Taux de victoire: ",r.winRate,"%"]})]})}return null}}),e.jsx($,{dataKey:"winRateNum",children:d.map((a,s)=>e.jsx(f,{fill:b[a.camp]||`var(--chart-color-${s%6+1})`},`cell-${s}`))})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Parties par Camp"}),e.jsx("div",{style:{height:400},children:e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(N,{children:[e.jsx(C,{data:R,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"totalGames",label:({camp:a,totalGames:s,percent:r})=>{const n=r!==void 0?r:0;return a==="Autres"?`Autres: ${s} (${(n*100).toFixed(1)}%)`:`${a}: ${s} (${(n*100).toFixed(1)}%)`},children:R.map((a,s)=>e.jsx(f,{fill:a.camp==="Autres"?"#cccccc":b[a.camp]||`var(--chart-color-${s%6+1})`},`cell-${s}`))}),e.jsx(y,{content:({active:a,payload:s})=>{if(a&&s&&s.length>0){const r=s[0].payload;if(r.camp==="Autres"&&r._details){const n=[...r._details].sort((t,i)=>i.totalGames-t.totalGames);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:"Autres"})}),e.jsx("div",{children:n.map((t,i)=>e.jsxs("div",{children:[t.camp,": ",t.totalGames," parties"]},i))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold"},children:["Total: ",r.totalGames," parties"]})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.camp})}),e.jsxs("div",{children:["Parties: ",r.totalGames]}),e.jsxs("div",{children:["Taux victoire: ",r.winRate,"%"]})]})}return null}})]})})})]})]})]})]})}export{K as CampsChart};
