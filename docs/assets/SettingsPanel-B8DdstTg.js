import{a as R,r as d,j as e,f as P,l as L,D as $}from"./index-DdOLdhng.js";function I(){const{generateUrlWithSettings:n}=R(),[i,o]=d.useState(!1),h=async()=>{const g=n();try{await navigator.clipboard.writeText(g),o(!0),setTimeout(()=>o(!1),2e3)}catch{const r=document.createElement("textarea");r.value=g,document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r),o(!0),setTimeout(()=>o(!1),2e3)}};return e.jsx("div",{className:"shareable-url-container",children:e.jsx("button",{onClick:h,className:"shareable-url-btn",type:"button",title:"Copier le lien avec les filtres actuels",children:i?"‚úÖ Copi√©!":"üîó Copier le lien"})})}function q(){const{settings:n,updateSettings:i,resetSettings:o}=R(),[h,g]=d.useState(null);d.useEffect(()=>{n.independentFilters||i({useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}})},[n,i]),d.useEffect(()=>{(async()=>{try{const s=n.dataSource,l=L(s,$.GAME_LOG),p=await(await fetch(l)).json();g(p.GameStats||[])}catch(s){console.error("Error fetching game log data:",s)}})()},[n.dataSource]);const f=t=>{if(!t)return null;try{return new Date(t)}catch{return null}},r=d.useMemo(()=>!h||!n.independentFilters?[]:h.filter(t=>{const s=n.independentFilters;if(s.gameTypeEnabled&&s.gameFilter!=="all"&&(s.gameFilter==="modded"&&!t.Modded||s.gameFilter==="non-modded"&&t.Modded))return!1;if(s.dateRangeEnabled&&(s.dateRange.start||s.dateRange.end)){const l=f(t.StartDate);if(!l)return!1;if(s.dateRange.start){const a=new Date(s.dateRange.start);if(l<a)return!1}if(s.dateRange.end){const a=new Date(s.dateRange.end);if(l>a)return!1}}if(s.mapNameEnabled&&s.mapNameFilter!=="all"){const l=t.MapName||"";if(s.mapNameFilter==="village"&&l!=="Village"||s.mapNameFilter==="chateau"&&l!=="Ch√¢teau"||s.mapNameFilter==="others"&&(l==="Village"||l==="Ch√¢teau"))return!1}return!0}),[h,n.independentFilters]),N=d.useMemo(()=>{const t=new Set;return r.forEach(s=>{s.PlayerStats.forEach(l=>{t.add(P(l.Username))})}),Array.from(t).sort()},[r]),b=d.useMemo(()=>{const t={};return r.forEach(s=>{const l=s.PlayerStats.map(a=>P(a.Username));l.forEach(a=>{t[a]||(t[a]=new Set),l.forEach(p=>{a!==p&&t[a].add(p)})})}),t},[r]),{availablePlayers:v,selectablePlayers:F}=d.useMemo(()=>{const t=N;if(!n.independentFilters?.playerFilter||n.independentFilters.playerFilter.mode==="none"||n.independentFilters.playerFilter.players.length===0)return{availablePlayers:t,selectablePlayers:new Set(t)};const s=new Set,l=n.independentFilters.playerFilter;return l.mode==="include"?t.forEach(a=>{(l.players.includes(a)||l.players.every(y=>b[a]?.has(y)||!1))&&s.add(a)}):l.mode==="exclude"&&t.forEach(a=>{(l.players.includes(a)||r.some(y=>{const E=y.PlayerStats.flatMap(m=>[m.Username.toLowerCase(),(m.ID??m.Username).toLowerCase()]);return E.includes(a.toLowerCase())?!l.players.some(m=>E.includes(m.toLowerCase())):!1}))&&s.add(a)}),{availablePlayers:t,selectablePlayers:s}},[N,n.independentFilters?.playerFilter,b,r]),S=t=>{n.independentFilters&&i({independentFilters:{...n.independentFilters,gameTypeEnabled:t}})},x=t=>{n.independentFilters&&i({independentFilters:{...n.independentFilters,gameFilter:t}})},k=t=>{n.independentFilters&&i({independentFilters:{...n.independentFilters,dateRangeEnabled:t}})},C=(t,s)=>{n.independentFilters&&i({independentFilters:{...n.independentFilters,dateRange:{...n.independentFilters.dateRange,[t]:s||null}}})},T=t=>{n.independentFilters&&i({independentFilters:{...n.independentFilters,mapNameEnabled:t}})},u=t=>{n.independentFilters&&i({independentFilters:{...n.independentFilters,mapNameFilter:t}})},j=t=>{n.independentFilters&&i({independentFilters:{...n.independentFilters,playerFilter:{...n.independentFilters.playerFilter,mode:t}}})},D=t=>{if(!n.independentFilters)return;const s=n.independentFilters.playerFilter.players;if(s.includes(t)){const a=s.filter(p=>p!==t);i({independentFilters:{...n.independentFilters,playerFilter:{...n.independentFilters.playerFilter,players:a}}})}else i({independentFilters:{...n.independentFilters,playerFilter:{...n.independentFilters.playerFilter,players:[...s,t]}}})},M=()=>{n.independentFilters&&i({independentFilters:{...n.independentFilters,playerFilter:{...n.independentFilters.playerFilter,players:[...F]}}})},w=()=>{n.independentFilters&&i({independentFilters:{...n.independentFilters,playerFilter:{...n.independentFilters.playerFilter,players:[]}}})},A=t=>{i({highlightedPlayer:t||null})},G=()=>{o()},c=d.useMemo(()=>{if(!n.independentFilters)return 0;let t=0;return n.independentFilters.gameTypeEnabled&&n.independentFilters.gameFilter!=="all"&&t++,n.independentFilters.dateRangeEnabled&&(n.independentFilters.dateRange.start||n.independentFilters.dateRange.end)&&t++,n.independentFilters.mapNameEnabled&&n.independentFilters.mapNameFilter!=="all"&&t++,n.independentFilters.playerFilter.mode!=="none"&&n.independentFilters.playerFilter.players.length>0&&t++,t},[n.independentFilters]);return n.independentFilters?e.jsxs("div",{className:"settings-panel",children:[e.jsxs("div",{className:"settings-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Param√®tres de Filtrage"}),c>0&&e.jsxs("p",{style:{margin:"0.5rem 0 0 0",color:"var(--accent-primary)",fontSize:"0.9rem",fontWeight:"500"},children:[c," filtre",c>1?"s":""," actif",c>1?"s":""]})]}),e.jsx("div",{children:e.jsx("button",{onClick:G,className:"settings-reset-btn",type:"button",children:"R√©initialiser"})})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("div",{className:"settings-section-header",children:e.jsx("h3",{children:"üéØ Joueur √† Mettre en √âvidence"})}),e.jsxs("div",{className:"settings-group",children:[e.jsx("p",{className:"settings-explanation",children:"S√©lectionnez un joueur qui sera toujours affich√© et mis en √©vidence dans tous les graphiques g√©n√©raux, m√™me s'il n'est pas dans le top classement."}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("label",{htmlFor:"highlighted-player-select",className:"settings-label",children:"Joueur √† mettre en √©vidence :"}),e.jsxs("select",{id:"highlighted-player-select",value:n.highlightedPlayer||"",onChange:t=>A(t.target.value),className:"settings-select",children:[e.jsx("option",{value:"",children:"Aucun joueur s√©lectionn√©"}),v.map(t=>e.jsx("option",{value:t,children:t},t))]}),n.highlightedPlayer&&e.jsxs("p",{className:"settings-info-text",children:['Le joueur "',n.highlightedPlayer,'" sera mis en √©vidence dans tous les graphiques.']})]})]})]}),e.jsxs("div",{className:"settings-filters-container",children:[e.jsxs("div",{className:`settings-filter-card ${n.independentFilters.gameTypeEnabled?"active":""}`,children:[e.jsxs("div",{className:"settings-filter-header",children:[e.jsxs("label",{className:"settings-toggle",children:[e.jsx("input",{type:"checkbox",checked:n.independentFilters.gameTypeEnabled,onChange:t=>S(t.target.checked)}),e.jsx("span",{className:"toggle-slider"})]}),e.jsx("h4",{children:"üéÆ Filtrer par Type de Partie"}),e.jsx("div",{className:"settings-filter-status",children:n.independentFilters.gameTypeEnabled&&n.independentFilters.gameFilter!=="all"&&e.jsx("span",{className:"filter-active-badge",children:n.independentFilters.gameFilter==="modded"?"Modd√©es":"Non-modd√©es"})})]}),n.independentFilters.gameTypeEnabled&&e.jsx("div",{className:"settings-filter-content",children:e.jsxs("div",{className:"settings-radio-group-inline",children:[e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"all",checked:n.independentFilters.gameFilter==="all",onChange:()=>x("all")}),e.jsx("span",{children:"Toutes"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"modded",checked:n.independentFilters.gameFilter==="modded",onChange:()=>x("modded")}),e.jsx("span",{children:"Modd√©es"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"non-modded",checked:n.independentFilters.gameFilter==="non-modded",onChange:()=>x("non-modded")}),e.jsx("span",{children:"Non-modd√©es"})]})]})})]}),e.jsxs("div",{className:`settings-filter-card ${n.independentFilters.dateRangeEnabled?"active":""}`,children:[e.jsxs("div",{className:"settings-filter-header",children:[e.jsxs("label",{className:"settings-toggle",children:[e.jsx("input",{type:"checkbox",checked:n.independentFilters.dateRangeEnabled,onChange:t=>k(t.target.checked)}),e.jsx("span",{className:"toggle-slider"})]}),e.jsx("h4",{children:"üìÖ Filtrer par P√©riode"}),e.jsx("div",{className:"settings-filter-status",children:n.independentFilters.dateRangeEnabled&&(n.independentFilters.dateRange.start||n.independentFilters.dateRange.end)&&e.jsxs("span",{className:"filter-active-badge",children:[n.independentFilters.dateRange.start||"D√©but"," - ",n.independentFilters.dateRange.end||"Fin"]})})]}),n.independentFilters.dateRangeEnabled&&e.jsxs("div",{className:"settings-filter-content",children:[e.jsxs("div",{className:"settings-date-inputs",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-start",className:"settings-label",children:"Du :"}),e.jsx("input",{id:"date-start",type:"date",value:n.independentFilters.dateRange.start||"",onChange:t=>C("start",t.target.value),className:"settings-input"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-end",className:"settings-label",children:"Au :"}),e.jsx("input",{id:"date-end",type:"date",value:n.independentFilters.dateRange.end||"",onChange:t=>C("end",t.target.value),className:"settings-input"})]})]}),e.jsx("small",{className:"settings-hint",children:"Laissez vide pour ne pas limiter le d√©but ou la fin de la p√©riode."})]})]}),e.jsxs("div",{className:`settings-filter-card ${n.independentFilters.mapNameEnabled?"active":""}`,children:[e.jsxs("div",{className:"settings-filter-header",children:[e.jsxs("label",{className:"settings-toggle",children:[e.jsx("input",{type:"checkbox",checked:n.independentFilters.mapNameEnabled,onChange:t=>T(t.target.checked)}),e.jsx("span",{className:"toggle-slider"})]}),e.jsx("h4",{children:"üó∫Ô∏è Filtrer par Carte"}),e.jsx("div",{className:"settings-filter-status",children:n.independentFilters.mapNameEnabled&&n.independentFilters.mapNameFilter!=="all"&&e.jsx("span",{className:"filter-active-badge",children:n.independentFilters.mapNameFilter==="village"?"Village":n.independentFilters.mapNameFilter==="chateau"?"Ch√¢teau":"Autres"})})]}),n.independentFilters.mapNameEnabled&&e.jsx("div",{className:"settings-filter-content",children:e.jsxs("div",{className:"settings-radio-group-inline",children:[e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"mapNameFilter",value:"all",checked:n.independentFilters.mapNameFilter==="all",onChange:()=>u("all")}),e.jsx("span",{children:"Toutes"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"mapNameFilter",value:"village",checked:n.independentFilters.mapNameFilter==="village",onChange:()=>u("village")}),e.jsx("span",{children:"Village"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"mapNameFilter",value:"chateau",checked:n.independentFilters.mapNameFilter==="chateau",onChange:()=>u("chateau")}),e.jsx("span",{children:"Ch√¢teau"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"mapNameFilter",value:"others",checked:n.independentFilters.mapNameFilter==="others",onChange:()=>u("others")}),e.jsx("span",{children:"Autres"})]})]})})]}),e.jsxs("div",{className:`settings-filter-card ${n.independentFilters.playerFilter.mode!=="none"?"active":""}`,children:[e.jsxs("div",{className:"settings-filter-header",children:[e.jsxs("label",{className:"settings-toggle",children:[e.jsx("input",{type:"checkbox",checked:n.independentFilters.playerFilter.mode!=="none",onChange:t=>j(t.target.checked?"include":"none")}),e.jsx("span",{className:"toggle-slider"})]}),e.jsx("h4",{children:"üë• Filtrer par Joueurs"}),e.jsx("div",{className:"settings-filter-status",children:n.independentFilters.playerFilter.mode!=="none"&&n.independentFilters.playerFilter.players.length>0&&e.jsxs("span",{className:"filter-active-badge",children:[n.independentFilters.playerFilter.players.length," joueur",n.independentFilters.playerFilter.players.length>1?"s":""]})})]}),n.independentFilters.playerFilter.mode!=="none"&&e.jsxs("div",{className:"settings-filter-content",children:[e.jsxs("div",{className:"settings-radio-group-inline",style:{marginBottom:"1rem"},children:[e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"playerFilterMode",value:"include",checked:n.independentFilters.playerFilter.mode==="include",onChange:()=>j("include")}),e.jsx("span",{children:"Inclure"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"playerFilterMode",value:"exclude",checked:n.independentFilters.playerFilter.mode==="exclude",onChange:()=>j("exclude")}),e.jsx("span",{children:"Exclure"})]})]}),e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{className:"settings-label",children:["Joueurs (",n.independentFilters.playerFilter.players.length," s√©lectionn√©",n.independentFilters.playerFilter.players.length>1?"s":"",") :"]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:M,className:"settings-btn-small",disabled:F.size===0,children:"Tous"}),e.jsx("button",{type:"button",onClick:w,className:"settings-btn-small",disabled:n.independentFilters.playerFilter.players.length===0,children:"Aucun"})]})]})}),e.jsx("div",{className:"settings-player-grid",children:v.map(t=>{const s=n.independentFilters.playerFilter.players.includes(t),l=F.has(t);return e.jsxs("label",{className:`settings-player-option ${s?"selected":""} ${l?"":"disabled"}`,children:[e.jsx("input",{type:"checkbox",checked:s,disabled:!l,onChange:()=>D(t)}),e.jsx("span",{children:t})]},t)})}),e.jsxs("small",{className:"settings-hint",children:["S√©lectionnez les joueurs √† ",n.independentFilters.playerFilter.mode==="include"?"inclure dans":"exclure du"," le filtrage."]})]})]})]}),e.jsx("div",{className:"settings-info",children:e.jsxs("p",{children:[e.jsx("strong",{children:"R√©sum√©:"})," ",r.length," partie",r.length>1?"s":"",c>0?` (avec ${c} filtre${c>1?"s":""} actif${c>1?"s":""})`:" (aucun filtre actif)",n.highlightedPlayer&&` ‚Ä¢ "${n.highlightedPlayer}" mis en √©vidence`,n.dataSource==="discord"&&" ‚Ä¢ üìä √âquipe Discord"]})}),e.jsxs("div",{className:"settings-section",children:[e.jsx("div",{className:"settings-section-header",children:e.jsx("h3",{children:"üîó Partage des Filtres"})}),e.jsxs("div",{className:"settings-group",children:[e.jsx("p",{className:"settings-explanation",children:"Copiez le lien ci-dessous pour partager les filtres actuels avec d'autres personnes. Ils pourront ouvrir le site avec ces m√™mes filtres appliqu√©s."}),e.jsx(I,{})]})]})]}):e.jsx("div",{children:"Chargement des param√®tres..."})}export{q as SettingsPanel};
