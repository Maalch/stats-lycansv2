import{a as me,r as v,j as e}from"./index-DsxT0PBg.js";import{F as f,C as b,X as S,Y as w,a as R}from"./FullscreenChart-Dql6xaJE.js";import{b as ye,c as xe}from"./useRawBRData-Doi4sS4y.js";import{u as ve}from"./useJoueursData-DIEPCDiH.js";import{u as ue,g as je}from"./api-RtSimuNp.js";import{R as A,T}from"./CategoricalChart-BG5KWtLi.js";import{B,a as W}from"./BarChart-CeGkXwPS.js";const ee=[1,2,3,5,10];function We(){const{data:u,isLoading:ie,error:F}=ye(),{data:j,isLoading:re,error:H}=xe(),{settings:a}=me(),{joueursData:te}=ve(),[k,x]=v.useState(null),[d,M]=v.useState("wins"),[h,N]=v.useState("total"),[p,ae]=v.useState(1),[m,se]=v.useState(1),ne=ue(te),P=["var(--chart-color-1)","var(--chart-color-2)","var(--chart-color-3)","var(--chart-color-4)","var(--chart-color-5)","var(--chart-color-6)"],z=t=>ne[t]||je(t),o=v.useMemo(()=>{if(!u||!j)return null;const t=j.length,s=u.length,r=u.filter(i=>i.Gagnant).length,l=u.reduce((i,n)=>{const g=n.Participants;return i[g]||(i[g]={name:g,participations:0,wins:0,totalScore:0,averageScore:0,winRate:0}),i[g].participations++,i[g].totalScore+=n.Score,n.Gagnant&&i[g].wins++,i},{});Object.values(l).forEach(i=>{i.averageScore=i.totalScore/i.participations,i.winRate=i.wins/i.participations*100});const c=Object.values(l).sort((i,n)=>n.participations-i.participations),y=c.slice(0,15),oe=a.highlightedPlayer&&y.some(i=>i.name===a.highlightedPlayer);let C=!1,K=[...y];if(a.highlightedPlayer&&!oe){const i=c.find(n=>n.name===a.highlightedPlayer);i&&(K.push({...i,isHighlightedAddition:!0}),C=!0)}const D=Object.values(l).sort((i,n)=>n.wins-i.wins),I=D.slice(0,15),le=a.highlightedPlayer&&I.some(i=>i.name===a.highlightedPlayer);let G=!1,E=[...I];if(a.highlightedPlayer&&!le){const i=D.find(n=>n.name===a.highlightedPlayer);i&&(E.push({...i,isHighlightedAddition:!0}),G=!0)}const V=Object.values(l).filter(i=>i.participations>=p),$=V.sort((i,n)=>n.winRate-i.winRate).slice(0,15),ce=a.highlightedPlayer&&$.some(i=>i.name===a.highlightedPlayer);let q=!1,O=[...$];if(a.highlightedPlayer&&!ce){const i=c.find(n=>n.name===a.highlightedPlayer);i&&(O.push({...i,isHighlightedAddition:!0}),q=!0)}const L=Object.values(l).sort((i,n)=>n.totalScore-i.totalScore),X=L.slice(0,15),de=a.highlightedPlayer&&X.some(i=>i.name===a.highlightedPlayer);let Y=!1,J=[...X];if(a.highlightedPlayer&&!de){const i=L.find(n=>n.name===a.highlightedPlayer);i&&(J.push({...i,isHighlightedAddition:!0}),Y=!0)}const _=Object.values(l).filter(i=>i.participations>=m),Q=_.sort((i,n)=>n.averageScore-i.averageScore).slice(0,15),he=a.highlightedPlayer&&Q.some(i=>i.name===a.highlightedPlayer);let U=!1,Z=[...Q];if(a.highlightedPlayer&&!he){const i=c.find(n=>n.name===a.highlightedPlayer);i&&(Z.push({...i,isHighlightedAddition:!0}),U=!0)}const ge=j.reduce((i,n)=>{const g=n["Nombre de participants"];return i[g]||(i[g]=0),i[g]++,i},{}),pe=Object.entries(ge).map(([i,n])=>({participants:parseInt(i),games:n,percentage:(n/t*100).toFixed(1)})).sort((i,n)=>i.participants-n.participants);return{totalGames:t,totalParticipations:s,totalWins:r,averageParticipantsPerGame:(s/t).toFixed(1),topPlayersByParticipations:K,highlightedPlayerInParticipations:C,topPlayersByWins:E,highlightedPlayerInWins:G,topPlayersByWinRate:O,highlightedPlayerInWinRate:q,totalEligiblePlayersForWinRate:V.length,topPlayersByTotalScore:J,highlightedPlayerInTotalScore:Y,topPlayersByAverageScore:Z,highlightedPlayerInAverageScore:U,totalEligiblePlayersForKills:_.length,participantData:pe}},[u,j,a.highlightedPlayer,p,m]);return ie||re?e.jsx("div",{className:"statistiques-chargement",children:"Chargement des donnÃ©es Mini Battle Royale..."}):F||H?e.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",F||H]}):!o||o.totalGames===0?e.jsx("div",{className:"statistiques-vide",children:"Aucune donnÃ©e Mini Battle Royale disponible (2-5 joueurs)"}):e.jsxs("div",{className:"lycans-chart-container",children:[e.jsx("div",{className:"lycans-chart-header",children:e.jsx("h2",{children:"Mini Battle Royale (2-5 joueurs)"})}),e.jsxs("div",{className:"lycans-stats-grid",children:[e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Parties totales"}),e.jsx("div",{className:"lycans-stat-value",children:o.totalGames})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Participations"}),e.jsx("div",{className:"lycans-stat-value",children:o.totalParticipations})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Moy. participants/partie"}),e.jsx("div",{className:"lycans-stat-value",children:o.averageParticipantsPerGame})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Participations"}),o.highlightedPlayerInParticipations&&a.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--accent-primary)",margin:"0.5rem 0"},children:["ðŸŽ¯ ",a.highlightedPlayer," affichÃ© en plus du top 15"]}),e.jsx(f,{title:"Participations - Mini Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(A,{width:"100%",height:400,children:e.jsxs(B,{data:o.topPlayersByParticipations,children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(S,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12,interval:0,tick:({x:t,y:s,payload:r})=>e.jsx("text",{x:t,y:s,dy:16,textAnchor:"end",fill:a.highlightedPlayer===r.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:a.highlightedPlayer===r.value?14:12,fontWeight:a.highlightedPlayer===r.value?"bold":"normal",transform:`rotate(-45 ${t} ${s})`,children:r.value})}),e.jsx(w,{}),e.jsx(T,{content:({active:t,payload:s})=>{if(t&&s&&s.length>0){const r=s[0].payload,l=r.isHighlightedAddition,c=a.highlightedPlayer===r.name;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:"12px",borderRadius:"8px",border:"1px solid var(--border-color)",boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem"},children:[r.name,c&&" ðŸŽ¯"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.5"},children:[e.jsxs("div",{children:["Participations: ",e.jsx("strong",{children:r.participations})]}),e.jsxs("div",{children:["Victoires: ",e.jsx("strong",{children:r.wins})]})]}),l&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"8px",fontStyle:"italic",paddingTop:"8px",borderTop:"1px solid var(--border-color)"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"})]})}return null}}),e.jsx(W,{dataKey:"participations",name:"Participations",children:o.topPlayersByParticipations.map((t,s)=>{const r=a.highlightedPlayer===t.name,l=k===t.name,c=t.isHighlightedAddition;return e.jsx(R,{fill:r?"var(--accent-primary)":c?"var(--accent-secondary)":z(t.name),stroke:r?"var(--accent-primary)":l?"var(--text-primary)":"none",strokeWidth:r?3:l?2:0,strokeDasharray:c?"5,5":"none",opacity:c?.8:1,onMouseEnter:()=>x(t.name),onMouseLeave:()=>x(null),style:{cursor:"pointer"}},`cell-${s}`)})})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"RÃ©partition par Nombre de Participants"}),e.jsx(f,{title:"RÃ©partition par Nombre de Participants - Mini BR",className:"lycans-chart-wrapper",children:e.jsx(A,{width:"100%",height:400,children:e.jsxs(B,{data:o.participantData,margin:{bottom:15},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(S,{dataKey:"participants",label:{value:"Nombre de participants",position:"insideBottom",offset:-5}}),e.jsx(w,{}),e.jsx(T,{content:({active:t,payload:s})=>{if(t&&s&&s.length>0){const r=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:"12px",borderRadius:"8px",border:"1px solid var(--border-color)",boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem"},children:[r.participants," joueur",r.participants>1?"s":""]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.5"},children:[e.jsxs("div",{children:["Parties: ",e.jsx("strong",{children:r.games})]}),e.jsxs("div",{children:["Pourcentage: ",e.jsxs("strong",{children:[r.percentage,"%"]})]})]})]})}return null}}),e.jsx(W,{dataKey:"games",name:"Nombre de parties",children:o.participantData.map((t,s)=>e.jsx(R,{fill:P[s%P.length]},`cell-${s}`))})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("h3",{children:d==="wins"?"Victoires":"Taux de Victoire"}),(d==="wins"&&o.highlightedPlayerInWins||d==="winRate"&&o.highlightedPlayerInWinRate)&&a.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--accent-primary)",margin:"0.5rem 0"},children:["ðŸŽ¯ ",a.highlightedPlayer," affichÃ© en plus du top 15"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",minWidth:"350px",justifyContent:"flex-end"},children:[d==="winRate"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"min-games-winrate-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-winrate-select",value:p,onChange:t=>ae(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:ee.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx("button",{onClick:()=>M("wins"),style:{background:d==="wins"?"var(--accent-primary)":"var(--bg-tertiary)",color:d==="wins"?"var(--bg-primary)":"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem",cursor:"pointer"},children:"Victoires"}),e.jsx("button",{onClick:()=>M("winRate"),style:{background:d==="winRate"?"var(--accent-primary)":"var(--bg-tertiary)",color:d==="winRate"?"var(--bg-primary)":"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem",cursor:"pointer"},children:"Taux de victoire"})]})]}),e.jsx(f,{title:`${d==="wins"?"Victoires":"Taux de Victoire"} - Mini Battle Royale`,className:"lycans-chart-wrapper",children:e.jsx(A,{width:"100%",height:400,children:e.jsxs(B,{data:d==="wins"?o.topPlayersByWins:o.topPlayersByWinRate,children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(S,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12,interval:0,tick:({x:t,y:s,payload:r})=>e.jsx("text",{x:t,y:s,dy:16,textAnchor:"end",fill:a.highlightedPlayer===r.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:a.highlightedPlayer===r.value?14:12,fontWeight:a.highlightedPlayer===r.value?"bold":"normal",transform:`rotate(-45 ${t} ${s})`,children:r.value})}),e.jsx(w,{}),e.jsx(T,{content:({active:t,payload:s})=>{if(t&&s&&s.length>0){const r=s[0].payload,l=r.isHighlightedAddition,c=a.highlightedPlayer===r.name,y=r.participations>=p;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:"12px",borderRadius:"8px",border:"1px solid var(--border-color)",boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem"},children:[r.name,c&&" ðŸŽ¯"]}),e.jsx("div",{style:{fontSize:"0.9rem",lineHeight:"1.5"},children:d==="wins"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Victoires: ",e.jsx("strong",{children:r.wins})]}),e.jsxs("div",{children:["Participations: ",e.jsx("strong",{children:r.participations})]}),e.jsxs("div",{children:["Taux de victoire: ",e.jsxs("strong",{children:[r.winRate.toFixed(1),"%"]})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["Taux de victoire: ",e.jsxs("strong",{children:[r.winRate.toFixed(1),"%"]})]}),e.jsxs("div",{children:["Victoires: ",e.jsx("strong",{children:r.wins})," / ",r.participations]})]})}),l&&d==="winRate"&&!y&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"8px",fontStyle:"italic",paddingTop:"8px",borderTop:"1px solid var(--border-color)"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",p," partie",p>1?"s":"",")"]}),l&&(d==="winRate"&&y||d==="wins")&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"8px",fontStyle:"italic",paddingTop:"8px",borderTop:"1px solid var(--border-color)"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"})]})}return null}}),e.jsx(W,{dataKey:d==="wins"?"wins":"winRate",name:d==="wins"?"Victoires":"Taux de victoire (%)",children:(d==="wins"?o.topPlayersByWins:o.topPlayersByWinRate).map((t,s)=>{const r=a.highlightedPlayer===t.name,l=k===t.name,c=t.isHighlightedAddition;return e.jsx(R,{fill:r?"var(--accent-primary)":c?"var(--accent-secondary)":d==="wins"?z(t.name):P[s%P.length],stroke:r?"var(--accent-primary)":l?"var(--text-primary)":"none",strokeWidth:r?3:l?2:0,strokeDasharray:c?"5,5":"none",opacity:c?.8:1,onMouseEnter:()=>x(t.name),onMouseLeave:()=>x(null),style:{cursor:"pointer"}},`cell-winrate-${s}`)})})]})})}),d==="winRate"&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",o.topPlayersByWinRate.length," des joueurs (sur ",o.totalEligiblePlayersForWinRate," ayant au moins ",p," partie",p>1?"s":"",")"]})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:"1rem"},children:[e.jsxs("div",{children:[e.jsx("h3",{children:h==="total"?"Kills Totaux":"Kills Moyen par Partie"}),(h==="total"&&o.highlightedPlayerInTotalScore||h==="average"&&o.highlightedPlayerInAverageScore)&&a.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.9rem",color:"var(--accent-primary)",margin:"0.5rem 0"},children:["ðŸŽ¯ ",a.highlightedPlayer," affichÃ© en plus du top 15"]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",minWidth:"350px",justifyContent:"flex-end"},children:[h==="average"&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"min-games-kills-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-kills-select",value:m,onChange:t=>se(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:ee.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx("button",{onClick:()=>N("total"),style:{background:h==="total"?"var(--accent-primary)":"var(--bg-tertiary)",color:h==="total"?"var(--bg-primary)":"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem",cursor:"pointer"},children:"Kills Totaux"}),e.jsx("button",{onClick:()=>N("average"),style:{background:h==="average"?"var(--accent-primary)":"var(--bg-tertiary)",color:h==="average"?"var(--bg-primary)":"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem",cursor:"pointer"},children:"Kills Moyen"})]})]}),e.jsx(f,{title:`${h==="total"?"Kills Totaux":"Kills Moyen par Partie"} - Mini Battle Royale`,className:"lycans-chart-wrapper",children:e.jsx(A,{width:"100%",height:400,children:e.jsxs(B,{data:h==="total"?o.topPlayersByTotalScore:o.topPlayersByAverageScore,children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(S,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12,interval:0,tick:({x:t,y:s,payload:r})=>e.jsx("text",{x:t,y:s,dy:16,textAnchor:"end",fill:a.highlightedPlayer===r.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:a.highlightedPlayer===r.value?14:12,fontWeight:a.highlightedPlayer===r.value?"bold":"normal",transform:`rotate(-45 ${t} ${s})`,children:r.value})}),e.jsx(w,{}),e.jsx(T,{content:({active:t,payload:s})=>{if(t&&s&&s.length>0){const r=s[0].payload,l=r.isHighlightedAddition,c=a.highlightedPlayer===r.name,y=r.participations>=m;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:"12px",borderRadius:"8px",border:"1px solid var(--border-color)",boxShadow:"0 2px 8px rgba(0,0,0,0.15)"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem"},children:[r.name,c&&" ðŸŽ¯"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.5"},children:[e.jsxs("div",{children:["Participations: ",e.jsx("strong",{children:r.participations})]}),e.jsxs("div",{children:["Kills total: ",e.jsx("strong",{children:r.totalScore})]}),e.jsxs("div",{children:["Kills moyen: ",e.jsx("strong",{children:r.averageScore.toFixed(2)})]})]}),l&&h==="average"&&!y&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"8px",fontStyle:"italic",paddingTop:"8px",borderTop:"1px solid var(--border-color)"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",m," partie",m>1?"s":"",")"]}),l&&(h==="average"&&y||h==="total")&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"8px",fontStyle:"italic",paddingTop:"8px",borderTop:"1px solid var(--border-color)"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"})]})}return null}}),e.jsx(W,{dataKey:h==="total"?"totalScore":"averageScore",name:h==="total"?"Kills totaux":"Kills moyen par partie",children:(h==="total"?o.topPlayersByTotalScore:o.topPlayersByAverageScore).map((t,s)=>{const r=a.highlightedPlayer===t.name,l=k===t.name,c=t.isHighlightedAddition;return e.jsx(R,{fill:r?"var(--accent-primary)":c?"var(--accent-secondary)":z(t.name),stroke:r?"var(--accent-primary)":l?"var(--text-primary)":"none",strokeWidth:r?3:l?2:0,strokeDasharray:c?"5,5":"none",opacity:c?.8:1,onMouseEnter:()=>x(t.name),onMouseLeave:()=>x(null),style:{cursor:"pointer"}},`cell-kills-${s}`)})})]})})}),h==="average"&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",o.topPlayersByAverageScore.length," des joueurs (sur ",o.totalEligiblePlayersForKills," ayant au moins ",m," partie",m>1?"s":"",")"]})]})]})]})}export{We as BRMiniChart};
