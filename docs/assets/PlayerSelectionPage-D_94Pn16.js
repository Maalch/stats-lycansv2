import{a as ne,r as T,g as Z,f as Pe,u as Q,j as e,c as ye,d as Ne,m as Ae}from"./index-BhKkxvXa.js";import{u as oe}from"./useJoueursData-CHady7c3.js";import{u as de}from"./baseStatsHook-zENnkTeL.js";import{g as De}from"./gameUtils-DYpUb-C5.js";import{a as ve,g as ie,c as je,b as Me}from"./datasyncExport-CjB7UYqV.js";import{u as ue,g as Te,a as ae,l as be}from"./api-D7KvDSwI.js";import{f as se,d as Fe}from"./durationFormatters-C9UyWcKX.js";import{F as B,C as K,X as O,Y as H,a as U}from"./FullscreenChart-DnKeudRp.js";import{R as G,T as V}from"./CategoricalChart-CA4tSTck.js";import{L as $e,a as ze}from"./LineChart-1Oh9dcCp.js";import{B as J,a as _}from"./BarChart-BQgx5c7h.js";import{P as Ce,a as we}from"./PieChart-RUPcbsFm.js";import{u as Ie}from"./useDeathStatisticsFromRaw-BOuKKyaN.js";import{R as pe}from"./ReferenceLine-DiQaHbiv.js";import{g as re}from"./deathTypes-gHH1w6_X.js";import{i as me,g as he,V as Le,a as We}from"./roleUtils-CLjkiQQc.js";import{e as ge,a as qe,b as Ee,d as Ge,R as Ve}from"./deathLocationUtils-BnscHUb-.js";import{S as Be,a as Ke}from"./ScatterChart-CFRjtZuY.js";import{L as Oe}from"./Legend-BoPwSErm.js";import{a as He,u as _e}from"./useClips-CEL28OXG.js";import{C as Ue,f as xe,a as Ye}from"./ClipViewer-tVsQ0xAI.js";import"./ActivePoints-DnI8pel7.js";import"./PolarChart-BPwk3XPA.js";function Je(r){const{settings:d}=ne(),{joueursData:w}=oe(),[C,j]=T.useState(null),[g,R]=T.useState(!1),[f,c]=T.useState(null);T.useEffect(()=>{let n=!0;return(async()=>{try{R(!0),c(null);const i=d.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",l=await fetch(i);if(!l.ok)throw new Error(`Failed to load achievements: ${l.status} ${l.statusText}`);const s=await l.json();n&&j(s)}catch(i){n&&c(i instanceof Error?i.message:"Failed to load achievements")}finally{n&&R(!1)}})(),()=>{n=!1}},[d.dataSource]);const m=(()=>{if(!r||!C)return null;const a=w?.Players?.find(i=>i.Joueur===r)?.SteamID;return a?C.achievements[a]||null:(console.warn(`âš ï¸ No Steam ID found for player: ${r}`),null)})();return T.useEffect(()=>{r&&C&&w&&w.Players?.find(i=>i.Joueur===r)?.SteamID},[r,C,w,d.dataSource]),{data:m,isLoading:g,error:f,metadata:{generatedAt:C?.generatedAt||null,totalPlayers:C?.totalPlayers||0,totalGames:C?.totalGames||0,totalModdedGames:C?.totalModdedGames||0}}}function Xe(r,d,w){if(!r||r.trim()===""||d.length===0)return null;const C=[];let j=r;d.forEach(a=>{const i=a.PlayerStats.find(l=>Z(l)===r||l.Username.toLowerCase()===r.toLowerCase());if(i){j=i.Username;const l=i.MainRoleInitial==="Louveteau"?i.MainRoleInitial:ve(i.MainRoleInitial,i.MainRoleChanges||[]),s=ie(l);if(w&&w!=="Tous les camps"&&s!==w)return;const p=De(a),o=i.Victorious,P=Pe(new Date(a.StartDate)),A=je(a.StartDate,a.EndDate)||0;C.push({gameId:a.Id,date:P,camp:s,won:o,winnerCamp:p,playersInGame:a.PlayerStats.length,mapName:a.MapName,duration:A})}}),C.sort((a,i)=>{const l=s=>{const p=s.split("/");return p.length===3?new Date(parseInt(p[2]),parseInt(p[1])-1,parseInt(p[0])):new Date(s)};return l(i.date).getTime()-l(a.date).getTime()});const g=C.length,R=C.filter(a=>a.won).length,f=g>0?(R/g*100).toFixed(2):"0.00",c={};C.forEach(a=>{c[a.camp]||(c[a.camp]={appearances:0,wins:0,winRate:"0.00"}),c[a.camp].appearances++,a.won&&c[a.camp].wins++}),Object.keys(c).forEach(a=>{const i=c[a];i.winRate=i.appearances>0?(i.wins/i.appearances*100).toFixed(2):"0.00"});const m={};C.forEach(a=>{m[a.mapName]||(m[a.mapName]={appearances:0,wins:0,winRate:"0.00"}),m[a.mapName].appearances++,a.won&&m[a.mapName].wins++}),Object.keys(m).forEach(a=>{const i=m[a];i.winRate=i.appearances>0?(i.wins/i.appearances*100).toFixed(2):"0.00"});const n=C.reduce((a,i)=>a+i.duration,0);return{playerName:j,totalGames:g,totalWins:R,winRate:f,totalPlayTime:n,games:C,campStats:c,mapStats:m}}function Ze(r){const d={};let w=0,C=0;return Object.entries(r).forEach(([j,g])=>{j==="Village"||j==="ChÃ¢teau"?d[j]={...g}:(w+=g.appearances,C+=g.wins)}),w>=10&&(d.Autres={appearances:w,wins:C,winRate:w>0?(C/w*100).toFixed(2):"0.00"}),d}function le(r,d){const{data:w,isLoading:C,error:j}=de(g=>r?Xe(r,g,d):null);return{data:w,isLoading:C,error:j}}function Qe({achievements:r,title:d,emptyMessage:w,achievementType:C="all"}){const{navigateToTab:j,updateNavigationState:g,clearNavigation:R}=Q(),{settings:f,updateSettings:c}=ne(),{joueursData:m}=oe(),n=ue(m),a=(t,S)=>{if(S.stopPropagation(),!t.redirectTo)return;R();const D=f.highlightedPlayer;if(c(C==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:D,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:D,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const u=f.highlightedPlayer||"",v=i(t.description,u);v&&g({playerComparisonState:{selectedPlayer1:u,selectedPlayer2:v,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const u=t.description.toLowerCase().includes("loup");g({selectedPairingTab:u?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const u=t.description.match(/(Villageois|Loups|Autres)/i);u&&g({deathStatsSelectedCamp:u[1]});let v=10;const N=t.description.match(/min\.\s*(\d+)/);N&&(v=parseInt(N[1],10));let k="totalKills",b="killers";const F=t.redirectTo.chartSection;F&&(F==="killers-total"?(k="totalKills",b="killers"):F==="killers-average"?(k="averageKills",b="killers"):F==="deaths-total"?(k="totalDeaths",b="deaths"):F==="survivors-average"?(k="survivalRate",b="deaths"):(F==="hunters-good"||F==="hunters-bad")&&(b="hunter",k="averageKills")),g({deathStatisticsState:{selectedCamp:u?.[1]||"Tous les camps",minGamesForAverage:v,selectedView:b,focusChart:k}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const u=t.redirectTo.mapFilter||"all";let v=10;const N=t.description.match(/min\.\s*(\d+)/);N&&(v=parseInt(N[1])),c(C==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:u,playerFilter:{mode:"none",players:[]},highlightedPlayer:D,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:u,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:u,playerFilter:{mode:"none",players:[]},highlightedPlayer:D,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:u,playerFilter:{mode:"none",players:[]}}}),g({playersGeneralState:{minGamesForWinRate:v,winRateOrder:"best",focusChart:"winRate"}}),j("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&g({selectedPlayerName:f.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let u="wins";const v=t.title.toLowerCase(),N=t.description.toLowerCase();v.includes("dÃ©faite")||N.includes("dÃ©faite")?u="losses":v.includes("loup")||N.includes("loup")?u="loup":v.includes("villageois")||N.includes("villageois")?u="villageois":(v.includes("victoire")||N.includes("victoire"))&&(u="wins"),g({selectedSeriesType:u})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let u=10;const v=t.description.match(/min\.\s*(\d+)/);v&&(u=parseInt(v[1],10));let N="winRate",k="best";const b=t.title.toLowerCase(),F=t.description.toLowerCase();b.includes("participation")||F.includes("participation")?N="participation":(b.includes("taux de victoire")||F.includes("taux de victoire"))&&(N="winRate",(b.includes("moins bon")||b.includes("mauvais")||F.includes("moins bon")||F.includes("mauvais"))&&(k="worst")),g({playersGeneralState:{minGamesForWinRate:u,winRateOrder:k,focusChart:N}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const u=t.redirectTo.chartSection;let v="Villageois",N=1;u&&(u==="camp-loup"?v="Loup":u==="camp-villageois"?v="Villageois":u==="camp-idiot"?v="Idiot du Village":u==="camp-amoureux"?v="Amoureux":(u==="solo-roles"||u==="hall-of-fame")&&(v="Villageois"));const k=t.description.match(/min\.\s*(\d+)/);k&&(N=parseInt(k[1],10)),u==="solo-roles"?v="RÃ´les spÃ©ciaux":u==="hall-of-fame"&&(v="Tous les camps"),g({campPerformanceState:{selectedCampPerformanceCamp:v,selectedCampPerformanceMinGames:N,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const u=t.title.toLowerCase();let v="overview",N="behavior";u.includes("agressivitÃ©")?(v="overview",N="behavior"):u.includes("taux de vote")?(v="behavior",N="voteRate"):u.includes("prÃ©cision")&&(v="overview",N="accuracy"),g({votingStatsState:{selectedCategory:v,selectedView:N}})}j(t.redirectTo.tab,t.redirectTo.subTab)},i=(t,S)=>{const D=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const u of D){const v=t.match(u);if(v&&v[1]){const N=v[1].trim();if(N!==S)return N}}return null},l=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const u=t.description.match(/min\.\s*(\d+)/),v=u?parseInt(u[1],10):10,N=t.title.toLowerCase(),k=C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return N.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${v} parties)${k}`:N.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${k}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${k}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const u=t.redirectTo.mapFilter,v=u==="village"?"Village":u==="chateau"?"ChÃ¢teau":"map",N=C==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${v}${N}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${i(t.description,f.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const u=t.description.match(/(Villageois|Loups|Autres)/i),v=t.description.match(/min\.\s*(\d+)/),N=v?parseInt(v[1],10):10,k=u?.[1]||"Tous les camps",b=t.redirectTo.chartSection;let F="kills et morts";return b==="killers-total"?F="total des kills":b==="killers-average"?F=`moyenne des kills (min. ${N} parties)`:b==="deaths-total"?F="total des morts":b==="survivors-average"&&(F=`taux de survie (min. ${N} parties)`),`Cliquez pour voir les statistiques de ${F} ${k!=="Tous les camps"?`en ${k}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const u=t.title.toLowerCase(),v=t.description.toLowerCase();return u.includes("dÃ©faite")||v.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":u.includes("loup")||v.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":u.includes("villageois")||v.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":u.includes("victoire")||v.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const u=t.redirectTo.chartSection,v=C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return u==="camp-loup"?`Cliquez pour voir les performances camp Loup${v}`:u==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${v}`:u==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${v}`:u==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${v}`:u==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${v}`:u==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${v}`:`Cliquez pour voir les performances par camp${v}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const u=t.description.match(/min\.\s*(\d+)/),v=u?parseInt(u[1],10):25,N=C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",k=t.title.toLowerCase();return k.includes("agressivitÃ©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${v} meetings)${N}`:k.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${v} meetings)${N}`:k.includes("prÃ©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${N}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${N}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},s=t=>n[t]||Te(t),p=t=>{const S=[/avec ([^:]+?):/,/contre ([^:]+?):/];let D=t;return S.forEach(u=>{const v=t.match(u);if(v&&v[1]){const N=v[1].trim(),b=`<span class="player-name-highlight" style="color: ${s(N)};">${N}</span>`;D=D.replace(N,b)}}),D};if(r.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:d}),e.jsx("p",{children:w||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const o=t=>t===1?"ðŸ¥‡":t===2?"ðŸ¥ˆ":t===3?"ðŸ¥‰":"",P=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",A=(t,S)=>{if(!t||t<=3||!S)return;const D=t-3,u=S-3;return u<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(D-1)/(u-1))}, 70%, 50%)`},I=t=>{if(!t)return;const S=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(S){const[,D,u]=S;return`hsl(${D}, ${u}%, 40%)`}return t},M=r.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,S)=>(t.rank??999)-(S.rank??999)),W=r.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,S)=>(t.rank??999)-(S.rank??999)),y=r.filter(t=>t.category==="comparison"),h=M.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:d}),h>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:M.filter(t=>t.rank&&t.rank<=3).map((t,S)=>e.jsxs("div",{className:`top3-card ${P(t.rank)} animate-slide-in`,style:{animationDelay:`${S*.15}s`},onClick:D=>a(t,D),title:l(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:o(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:t.title}),e.jsx("p",{className:"top3-achievement-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},t.id))})]}),M.length>0&&e.jsxs("div",{className:"achievements-section good-achievements",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:M.filter(t=>!t.rank||t.rank>3).map((t,S)=>{const D=A(t.rank,t.totalRanked),u=I(D);return e.jsxs("div",{className:`achievement-card good ${P(t.rank)}`,onClick:v=>a(t,v),title:l(t),style:{animationDelay:`${S*.05}s`,borderLeftColor:u,...D&&{borderLeftWidth:"4px"}},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:t.title}),e.jsxs("span",{className:"achievement-rank",style:D?{backgroundColor:D}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:t.description})]},t.id)})})]}),W.length>0&&e.jsxs("div",{className:"achievements-section bad-achievements",children:[e.jsx("h5",{children:"ðŸ’€ Classements (InversÃ©s)"}),e.jsx("div",{className:"achievements-grid",children:W.map(t=>{const S=A(t.rank,t.totalRanked),D=I(S);return e.jsxs("div",{className:`achievement-card bad rank-${t.rank}`,onClick:u=>a(t,u),title:l(t),style:{borderLeftColor:D,...S&&{borderLeftWidth:"4px"}},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:t.title}),e.jsxs("span",{className:"achievement-rank",style:S?{backgroundColor:S}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:t.description})]},t.id)})})]}),y.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:y.map(t=>e.jsxs("div",{className:"achievement-card comparison",onClick:S=>a(t,S),title:l(t),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:t.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:p(t.description)}})]},t.id))})]})]})}function et({selectedPlayerName:r,groupingMethod:d,campFilter:w="all"}){const{navigateToGameDetails:C}=Q(),{data:j,isLoading:g,error:R}=le(r),f=T.useMemo(()=>{switch(d){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[d]),c=T.useMemo(()=>{if(!j?.games)return new Map;const i=new Map;return j.games.forEach(l=>{if(!i.has(l.date)){const s=l.date.split("/");s.length===3?i.set(l.date,new Date(parseInt(s[2]),parseInt(s[1])-1,parseInt(s[0])).getTime()):i.set(l.date,new Date(l.date).getTime())}}),i},[j?.games]),m=T.useMemo(()=>{if(!j?.games)return[];const i={};return j.games.forEach(l=>{if(w!=="all"){if(w==="solo"){if(l.camp==="Villageois"||l.camp==="Loup")return}else if(l.camp!==w)return}let s;const p=l.date.split("/");if(d==="month")if(p.length===3)s=`${p[1].padStart(2,"0")}/${p[2]}`;else{const o=new Date(l.date);s=`${String(o.getMonth()+1).padStart(2,"0")}/${o.getFullYear()}`}else if(d==="quarter")if(p.length===3){const o=parseInt(p[1],10);s=`T${Math.floor((o-1)/3)+1}/${p[2]}`}else{const o=new Date(l.date);s=`T${Math.floor(o.getMonth()/3)+1}/${o.getFullYear()}`}else d==="year"?p.length===3?s=`${p[2]}`:s=`${new Date(l.date).getFullYear()}`:s=l.date;i[s]||(i[s]={games:[],wins:0,total:0}),i[s].games.push(l),i[s].total++,l.won&&i[s].wins++}),Object.entries(i).map(([l,s])=>({period:l,totalGames:s.total,victories:s.wins,defeats:s.total-s.wins,winRate:s.total>0?(s.wins/s.total*100).toFixed(1):"0.0",winRateNum:s.total>0?s.wins/s.total*100:0})).sort((l,s)=>{if(d==="month"){const[p,o]=l.period.split("/"),[P,A]=s.period.split("/"),I=new Date(parseInt(o),parseInt(p)-1,1),M=new Date(parseInt(A),parseInt(P)-1,1);return I.getTime()-M.getTime()}else if(d==="quarter"){const[p,o]=l.period.split("/"),[P,A]=s.period.split("/"),I=parseInt(p.replace(/\D/g,""),10)||1,M=parseInt(P.replace(/\D/g,""),10)||1,W=new Date(parseInt(o,10),(I-1)*3,1),y=new Date(parseInt(A,10),(M-1)*3,1);return W.getTime()-y.getTime()}else if(d==="year"){const p=parseInt(l.period,10),o=parseInt(s.period,10);return p-o}else{const p=c.get(l.period)||0,o=c.get(s.period)||0;return p-o}})},[j,d,c,w]),a=(i=>i<=15?{fontSize:12,angle:-45,height:80,interval:0}:i<=30?{fontSize:12,angle:-45,height:85,interval:1}:i<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(i/12)})(m.length);return g?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):R?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",R]}):j?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",f]}),e.jsx(B,{title:`Ã‰volution des Performances ${f}`,children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs($e,{data:m,margin:{top:20,right:30,left:20,bottom:20},onClick:i=>{if(i&&i.activeLabel){const l=m.find(s=>s.period===i.activeLabel);l&&C({selectedPlayer:r,selectedDate:l.period,fromComponent:`Ã‰volution des Performances ${f}`})}},style:{cursor:"pointer"},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"period",angle:a.angle,textAnchor:"end",height:a.height,interval:a.interval,fontSize:a.fontSize}),e.jsx(H,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(V,{content:({active:i,payload:l})=>{if(i&&l&&l.length>0){const s=l[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:s.period})}),e.jsxs("div",{children:["Parties: ",s.totalGames]}),e.jsxs("div",{children:["Victoires: ",s.victories]}),e.jsxs("div",{children:["Taux: ",s.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(ze,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",f]}),e.jsx(B,{title:`RÃ©partition Victoires/DÃ©faites ${f}`,children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:m,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"period",angle:a.angle,textAnchor:"end",height:a.height,interval:a.interval,fontSize:a.fontSize}),e.jsx(H,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(V,{content:({active:i,payload:l})=>{if(i&&l&&l.length>0){const s=l[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:s.period})}),e.jsxs("div",{children:["Total: ",s.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",s.victories]}),e.jsxs("div",{children:["DÃ©faites: ",s.defeats]}),e.jsxs("div",{children:["Taux: ",s.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(_,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:m.map((i,l)=>e.jsx(U,{fill:"var(--accent-tertiary)",onClick:()=>{C({selectedPlayer:r,selectedDate:i.period,fromComponent:`Historique Joueur - Victoires ${f}`})},style:{cursor:"pointer"}},`cell-victories-${l}`))}),e.jsx(_,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:m.map((i,l)=>e.jsx(U,{fill:"var(--chart-color-4)",onClick:()=>{C({selectedPlayer:r,selectedDate:i.period,fromComponent:`Historique Joueur - DÃ©faites ${f}`})},style:{cursor:"pointer"}},`cell-defeats-${l}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function tt({selectedPlayerName:r}){const{navigateToGameDetails:d}=Q(),{data:w,isLoading:C,error:j}=le(r),g=ae(),R=T.useMemo(()=>w?.campStats?Object.entries(w.campStats).map(([c,m])=>({name:c,value:m.appearances,winRate:m.winRate,winRateDisplay:Math.max(parseFloat(m.winRate),1),wins:m.wins,percentage:(m.appearances/w.totalGames*100).toFixed(1)})):[],[w]),f=T.useMemo(()=>{if(!R.length)return[];const c=5;let m=0;const n=[],a=[];if(R.forEach(i=>{parseFloat(i.percentage)<c?(m+=Number(i.value),n.push(i)):a.push(i)}),m>0){const i=R.reduce((l,s)=>l+Number(s.value),0);a.push({name:"Autres",value:m,winRate:"0.0",winRateDisplay:1,wins:n.reduce((l,s)=>l+s.wins,0),percentage:(m/i*100).toFixed(1),_details:n})}return a},[R]);return C?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):j?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",j]}):w?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(Ce,{children:[e.jsx(we,{data:f,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:c=>{const m=c.percent!==void 0?c.percent:0;return c.name==="Autres"?`Autres : ${c.value} (${(m*100).toFixed(1)}%)`:`${c.name}: ${c.value} (${(m*100).toFixed(1)}%)`},children:f.map((c,m)=>e.jsx(U,{fill:c.name==="Autres"?be:g[c.name]||`var(--chart-color-${m%6+1})`,onClick:()=>{if(c.name==="Autres"){const n=c._details?.map(a=>a.name)||[];d({selectedPlayer:r,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:n},fromComponent:"Distribution par Camps"})}else c.name==="TraÃ®tre"||c.name==="Louveteau"?d({selectedPlayer:r,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):c.name==="Loup"?d({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):d({selectedPlayer:r,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${m}`))}),e.jsx(V,{content:({active:c,payload:m})=>{if(c&&m&&m.length>0){const n=m[0].payload;if(n.name==="Autres"&&n._details){const a=[...n._details].sort((i,l)=>l.value-i.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",n.value," parties (",n.percentage,"%)"]})}),e.jsx("div",{children:a.map((i,l)=>e.jsxs("div",{children:[i.name,": ",i.value," parties (",i.percentage,"%)"]},l))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[n.name," - ",n.value," parties (",n.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(B,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:R,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(V,{content:({active:c,payload:m})=>{if(c&&m&&m.length>0){const n=m[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.name})}),e.jsxs("div",{children:["Victoires: ",n.wins," / ",n.value]}),e.jsxs("div",{children:["Taux: ",n.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(_,{dataKey:"winRateDisplay",children:R.map((c,m)=>e.jsx(U,{fill:parseFloat(c.winRate)===0?`${g[c.name]||`var(--chart-color-${m%6+1})`}50`:g[c.name]||`var(--chart-color-${m%6+1})`,onClick:()=>{c.name==="TraÃ®tre"||c.name==="Louveteau"?d({selectedPlayer:r,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):c.name==="Loup"?d({selectedPlayer:r,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):d({selectedPlayer:r,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${m}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function st({selectedPlayerName:r}){const{navigateToGameDetails:d,navigationState:w,updateNavigationState:C}=Q(),[j,g]=T.useState(w.playerHistoryMapState?.selectedCamp||"Tous les camps"),{data:R}=Ie(),{data:f,isLoading:c,error:m}=le(r,j);T.useEffect(()=>{(!w.playerHistoryMapState||w.playerHistoryMapState.selectedCamp!==j)&&C({playerHistoryMapState:{selectedCamp:j}})},[j,w.playerHistoryMapState,C]);const n=i=>{g(i),C({playerHistoryMapState:{selectedCamp:i}})},a=T.useMemo(()=>{if(!f?.mapStats)return[];const i=Ze(f.mapStats);return Object.entries(i).map(([l,s])=>({name:l,value:s.appearances,winRate:s.winRate,winRateDisplay:Math.max(parseFloat(s.winRate),.1),wins:s.wins,percentage:(s.appearances/f.totalGames*100).toFixed(1)}))},[f]);return c?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):m?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",m]}):f?e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Performance par Carte",j!=="Tous les camps"?` (${j})`:""]}),e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select-map",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select-map",value:j,onChange:i=>n(i.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),R?.map(i=>e.jsx("option",{value:i,children:i},i))]})]}),a.length===0?e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de carte disponible"}),e.jsx("p",{children:"Aucune statistique de carte n'est disponible pour ce joueur avec le camp sÃ©lectionnÃ©."})]}):e.jsx(B,{title:"Performance par Carte",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:a,margin:{top:20,right:140,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(pe,{y:50,stroke:"var(--text-secondary)",strokeDasharray:"5 5",strokeOpacity:.5}),(()=>{if(a.length>0){const i=a.reduce((p,o)=>p+o.value,0),l=a.reduce((p,o)=>p+o.wins,0),s=i>0?l/i*100:0;if(s!==50)return e.jsx(pe,{y:s,stroke:"var(--accent-primary)",strokeDasharray:"3 3",strokeOpacity:.7,label:{value:`Moyenne: ${s.toFixed(1)}%`,position:"right",offset:5,style:{fill:"var(--accent-primary)"}}})}return null})(),e.jsx(V,{content:({active:i,payload:l})=>{if(i&&l&&l.length>0){const s=l[0].payload,p=[];return a.forEach(o=>{if(o.name!==s.name&&o.value>=5){const P=parseFloat(s.winRate)-parseFloat(o.winRate);Math.abs(P)>=2&&p.push({map:o.name,diff:P,better:P>0})}}),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:"250px"},children:[e.jsx("div",{children:e.jsx("strong",{children:s.name})}),e.jsxs("div",{children:["Parties: ",s.value]}),e.jsxs("div",{children:["Victoires: ",s.wins]}),e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("strong",{children:["Taux: ",s.winRate,"%"]})}),p.length>0&&e.jsxs("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"0.8rem",fontWeight:"bold",marginBottom:"0.25rem"},children:"Comparaisons:"}),p.map((o,P)=>e.jsxs("div",{style:{fontSize:"0.75rem",color:o.better?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[o.better?"â†—":"â†˜"," ",Math.abs(o.diff).toFixed(1),"% vs ",o.map]},P))]}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(_,{dataKey:"winRateDisplay",label:i=>{const{x:l,y:s,width:p,payload:o}=i;if(l===void 0||s===void 0||p===void 0||!o)return null;const P=o.winRate||"0";return e.jsxs("text",{x:l+p/2,y:s-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[P,"%"]})},onClick:i=>{if(i&&i.name){const l={selectedPlayer:r,selectedMapName:i.name,fromComponent:"Performance par Carte"};j!=="Tous les camps"&&(l.campFilter={selectedCamp:j,campFilterMode:"all-assignments"}),d(l)}},children:a.map((i,l)=>{let s;i.name==="Village"?s="var(--accent-secondary)":i.name==="ChÃ¢teau"?s="var(--accent-tertiary)":i.name==="Autres"?s=be:s=`var(--chart-color-${l%6+1})`;const p=Math.max(...a.map(P=>parseFloat(P.winRate))),o=parseFloat(i.winRate)===p&&p>0;return e.jsx(U,{fill:parseFloat(i.winRate)===0?`${s}30`:s,stroke:"transparent",strokeWidth:o?3:1,style:{cursor:"pointer"}},`cell-map-${l}`)})})]})})})})]})}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function at({selectedPlayerName:r}){const{gameData:d}=ye(),{joueursData:w}=oe(),C=ue(w),j=ae(),g=T.useMemo(()=>{if(!d||!r)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const f={},c={},m={},n=new Set;d.forEach(p=>{const o=p.PlayerStats.find(P=>P.Username.toLowerCase()===r.toLowerCase());if(o&&(p.PlayerStats.forEach(P=>{P.KillerName?.toLowerCase()===r.toLowerCase()&&(f[P.Username]=(f[P.Username]||0)+1)}),o.KillerName&&(c[o.KillerName]=(c[o.KillerName]||0)+1),o.DeathType)){const P=o.DeathType,A=re(P);m[A]||(m[A]={count:0,byDeathType:{}}),m[A].count+=1,m[A].byDeathType[P]=(m[A].byDeathType[P]||0)+1,n.add(P)}});const a=Object.entries(f).map(([p,o])=>({player:p,kills:o})).sort((p,o)=>o.kills-p.kills).slice(0,10),i=Object.entries(c).map(([p,o])=>({player:p,kills:o})).sort((p,o)=>o.kills-p.kills).slice(0,10),l=Object.entries(m).map(([p,o])=>{const P={deathType:p,count:o.count};return P[p]=o.count,P}).sort((p,o)=>o.count-p.count).slice(0,10),s=Object.keys(m);return{playersKilled:a,killedBy:i,deathTypes:l,availableDeathTypes:s}},[d,r]),R=T.useMemo(()=>{const f={};g.availableDeathTypes.forEach(n=>{n==="TuÃ© par Loup"?f[n]=j.Loup:n==="Mort aux votes"?f[n]="var(--chart-color-1)":n.includes("Chasseur")?f[n]=j.Chasseur:n==="TuÃ© par Zombie"?f[n]=j.Vaudou:n==="TuÃ© par potion assassin"?f[n]=j.Alchimiste:n==="TuÃ© par Vengeur"?f[n]="var(--chart-color-2)":n==="Amoureux mort"?f[n]=j.Amoureux:n==="TuÃ© par La BÃªte"?f[n]="var(--chart-color-3)":n==="TuÃ© par ShÃ©rif"&&(f[n]="var(--chart-color-4)")});const c=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let m=0;return g.availableDeathTypes.forEach(n=>{f[n]||(f[n]=c[m%c.length],m++)}),f},[g.availableDeathTypes,j]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[g.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(B,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:g.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(V,{content:({active:f,payload:c})=>{if(f&&c&&c.length>0){const m=c[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.player})}),e.jsxs("div",{children:["TuÃ© ",m.kills," fois par ",r]})]})}return null}}),e.jsx(_,{dataKey:"kills",children:g.playersKilled.map((f,c)=>e.jsx(U,{fill:C[f.player]||"var(--chart-color-3)"},`cell-killed-${c}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[r," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),g.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(B,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:g.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(V,{content:({active:f,payload:c})=>{if(f&&c&&c.length>0){const m=c[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.player})}),e.jsxs("div",{children:["A tuÃ© ",r," ",m.kills," fois"]})]})}return null}}),e.jsx(_,{dataKey:"kills",children:g.killedBy.map((f,c)=>e.jsx(U,{fill:C[f.player]||"var(--chart-color-4)"},`cell-killer-${c}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[r," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),g.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(B,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:g.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(H,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(V,{content:({active:f,payload:c})=>{if(f&&c&&c.length>0){const m=c[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.deathType})}),e.jsxs("div",{children:[r," est mort ",m.count," fois ainsi"]})]})}return null}}),g.availableDeathTypes.map(f=>e.jsx(_,{dataKey:f,name:f,stackId:"deaths",fill:R[f]||"var(--chart-color-5)"},f))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",r,"."]})]})]})}function rt(r,d){if(!r||r.trim()===""||d.length===0)return null;const w=new Map,C=new Map,j=new Map;d.forEach(m=>{if(!m.Modded)return;const n=m.PlayerStats.find(a=>Z(a)===r||a.Username.toLowerCase()===r.toLowerCase());if(n){if(n.MainRoleInitial==="Inconnu")return;const a=n.Victorious,l=ve(n.MainRoleInitial,n.MainRoleChanges||[])!==n.MainRoleInitial,s=ie(n.MainRoleInitial),p=s==="Loup"||s==="TraÃ®tre"||s==="Louveteau";if(s==="Villageois"&&me(n)){const o=he(n);if(o&&Le.includes(o)){const P=w.get(o)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};w.set(o,{appearances:P.appearances+1,wins:P.wins+(a?1:0),winsWithoutRoleChange:P.winsWithoutRoleChange+(!l&&a?1:0),gamesWithoutRoleChange:P.gamesWithoutRoleChange+(l?0:1)})}}else if(n.Power&&n.Power.trim()!==""&&n.Power!=="Inconnu"){if(s==="Villageois"){const o=w.get(n.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};w.set(n.Power,{appearances:o.appearances+1,wins:o.wins+(a?1:0),winsWithoutRoleChange:o.winsWithoutRoleChange+(!l&&a?1:0),gamesWithoutRoleChange:o.gamesWithoutRoleChange+(l?0:1)})}else if(p){const o=C.get(n.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},P=o.roleBreakdown;P.set(n.MainRoleInitial,(P.get(n.MainRoleInitial)||0)+1),C.set(n.Power,{appearances:o.appearances+1,wins:o.wins+(a?1:0),winsWithoutRoleChange:o.winsWithoutRoleChange+(!l&&a?1:0),gamesWithoutRoleChange:o.gamesWithoutRoleChange+(l?0:1),roleBreakdown:P})}}else if((s==="Villageois"||p)&&n.Power!=="Inconnu")if(s==="Villageois"){const o=w.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};w.set("Aucun pouvoir",{appearances:o.appearances+1,wins:o.wins+(a?1:0),winsWithoutRoleChange:o.winsWithoutRoleChange+(!l&&a?1:0),gamesWithoutRoleChange:o.gamesWithoutRoleChange+(l?0:1)})}else{const o=C.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},P=o.roleBreakdown;P.set(n.MainRoleInitial,(P.get(n.MainRoleInitial)||0)+1),C.set("Aucun pouvoir",{appearances:o.appearances+1,wins:o.wins+(a?1:0),winsWithoutRoleChange:o.winsWithoutRoleChange+(!l&&a?1:0),gamesWithoutRoleChange:o.gamesWithoutRoleChange+(l?0:1),roleBreakdown:P})}if(n.SecondaryRole&&n.SecondaryRole.trim()!==""&&n.SecondaryRole!=="Inconnu"){const o=j.get(n.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};j.set(n.SecondaryRole,{appearances:o.appearances+1,wins:o.wins+(a?1:0),winsWithoutRoleChange:o.winsWithoutRoleChange+(!l&&a?1:0),gamesWithoutRoleChange:o.gamesWithoutRoleChange+(l?0:1)})}}});const g=new Map;d.forEach(m=>{const n=m.PlayerStats.find(a=>Z(a)===r||a.Username.toLowerCase()===r.toLowerCase());if(n&&me(n)){const a=he(n);a&&g.set(a,(g.get(a)||0)+1)}});const R=m=>Array.from(m.entries()).map(([n,a])=>({name:n,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...g.has(n)&&{totalGamesAllModes:g.get(n)}})).sort((n,a)=>a.appearances-n.appearances),f=m=>Array.from(m.entries()).map(([n,a])=>({name:n,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(a.roleBreakdown.entries()).map(([i,l])=>({role:i,count:l})).sort((i,l)=>l.count-i.count)})).sort((n,a)=>a.appearances-n.appearances),c=m=>Array.from(m.entries()).map(([n,a])=>({name:n,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((n,a)=>a.appearances-n.appearances);return{villageoisPowers:R(w),loupPowers:f(C),secondaryRoles:c(j)}}function it({selectedPlayerName:r}){const{navigateToGameDetails:d,navigationState:w,updateNavigationState:C}=Q(),{settings:j}=ne(),g=ae(),[R,f]=T.useState(w.playerHistoryRolesState?.chartMode||"appearances"),{data:c,isLoading:m,error:n}=de(A=>rt(r,A));T.useEffect(()=>{(!w.playerHistoryRolesState||w.playerHistoryRolesState.chartMode!==R)&&C({playerHistoryRolesState:{chartMode:R}})},[R,w.playerHistoryRolesState,C]);const a=A=>{f(A),C({playerHistoryRolesState:{chartMode:A}})},i=T.useMemo(()=>{if(!c)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const A=1,I=1,M=15,W=R==="winRate"?(h,t)=>parseFloat(t.winRate)-parseFloat(h.winRate):(h,t)=>t.appearances-h.appearances,y=h=>({...h,winRateDisplay:Math.max(parseFloat(h.winRate),1)});return{villageoisPowers:c.villageoisPowers.filter(h=>h.appearances>=A).map(y).sort(W).slice(0,M),loupPowers:c.loupPowers.filter(h=>h.appearances>=A).map(y).sort(W).slice(0,M),secondaryRoles:c.secondaryRoles.filter(h=>h.appearances>=I).map(y).sort(W).slice(0,M)}},[c,R]);if(m)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(n)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",n]});if(!c)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const l=i.villageoisPowers.length>0,s=i.loupPowers.length>0,p=i.secondaryRoles.length>0;if(!l&&!s&&!p)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const o=({active:A,payload:I})=>{if(A&&I&&I.length>0){const M=I[0].payload,W=M.gamesWithoutRoleChange<M.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:M.name})}),e.jsxs("div",{children:["Apparitions: ",M.appearances]}),W&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",M.appearances-M.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",M.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",M.winRate,"%"]})}),M.totalGamesAllModes&&M.totalGamesAllModes!==M.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",M.totalGamesAllModes,")"]}),M.roleBreakdown&&M.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),M.roleBreakdown.map((y,h)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",y.role,": ",y.count]},h))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},P=(A,I,M,W,y)=>{const h=R==="appearances"?"appearances":"winRateDisplay",t=R==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",S=R==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:I}),e.jsx(B,{title:I,children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:A,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:12,tick:({x:D,y:u,payload:v})=>e.jsx("text",{x:D,y:u,textAnchor:"end",transform:`rotate(-45, ${D}, ${u})`,fill:j.highlightedPlayer===r?"var(--text-primary)":"var(--text-secondary)",fontSize:12,children:v.value})}),e.jsx(H,{label:{value:t,angle:270,position:"left",style:{textAnchor:"middle"}},domain:S}),e.jsx(V,{content:e.jsx(o,{})}),e.jsx(_,{dataKey:h,label:R==="winRate"?D=>{const{x:u,y:v,width:N,payload:k}=D;if(u===void 0||v===void 0||N===void 0||!k)return null;const b=k.winRate||"0";return e.jsxs("text",{x:u+N/2,y:v-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[b,"%"]})}:void 0,children:A.map((D,u)=>e.jsx(U,{fill:y?y(D.name,u):M,onClick:()=>W(D.name),style:{cursor:"pointer"}},`cell-${u}`))})]})})})})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:R,onChange:A=>a(A.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[l&&P(i.villageoisPowers,"Camp Villageois","var(--chart-color-1)",A=>{d({selectedPlayer:r,campFilter:{selectedCamp:"Villageois",campFilterMode:R==="winRate"?"wins-only":"all-assignments"},selectedPower:A,fromComponent:`Historique des RÃ´les - Pouvoir: ${A}`})},A=>A==="Chasseur"&&g.Chasseur?g.Chasseur:A==="Alchimiste"&&g.Alchimiste?g.Alchimiste:A==="Protecteur"&&g.Protecteur?g.Protecteur:A==="Disciple"&&g.Disciple?g.Disciple:"var(--chart-color-1)"),s&&P(i.loupPowers,"Camp Loups","var(--chart-color-2)",A=>{d({selectedPlayer:r,campFilter:{selectedCamp:"Loup",campFilterMode:R==="winRate"?"wins-only":"all-assignments"},selectedPower:A,fromComponent:`Historique des RÃ´les - Pouvoir: ${A}`})},()=>g.Loup||"var(--chart-color-2)"),p&&P(i.secondaryRoles,"RÃ´les Secondaires","var(--chart-color-3)",A=>{d({selectedPlayer:r,selectedSecondaryRole:A,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${A}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}function fe(r){return r==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":r}function nt({selectedPlayerName:r}){const{navigateToGameDetails:d}=Q(),{gameData:w,isLoading:C,error:j}=ye(),g=ae(),[R,f]=T.useState("deaths"),[c,m]=T.useState(""),[n,a]=T.useState(0),i=T.useMemo(()=>{if(!w)return[];const y=new Set;return w.forEach(h=>{const t=h.PlayerStats.find(S=>S.Username.toLowerCase()===r.toLowerCase());t&&(t.DeathPosition!==null&&h.MapName&&y.add(h.MapName),h.PlayerStats.forEach(S=>{S.KillerName?.toLowerCase()===r.toLowerCase()&&S.DeathPosition!==null&&h.MapName&&y.add(h.MapName)}))}),Array.from(y).filter(h=>h==="Village"||h==="ChÃ¢teau").sort((h,t)=>h==="Village"?-1:t==="Village"?1:h.localeCompare(t))},[w,r]),l=i.length>0?i[0]:"";c===""&&l!==""&&m(l);const s=T.useMemo(()=>{if(!w||!r)return[];const y=[];return w.forEach(h=>{if(c&&h.MapName!==c)return;const t=h.PlayerStats.find(S=>S.Username.toLowerCase()===r.toLowerCase());if(t)if(R==="deaths"){if(t.DeathPosition){const S=ie(t.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),D=ge(t.DeathPosition.x,t.DeathPosition.z,h.MapName);y.push({x:D.x,z:D.z,victimName:t.Username,killerName:t.KillerName||null,deathType:fe(t.DeathType),mapName:h.MapName,camp:S,gameId:h.DisplayedId,displayedGameId:h.DisplayedId})}}else h.PlayerStats.forEach(S=>{if(S.KillerName?.toLowerCase()===r.toLowerCase()&&S.DeathPosition){const D=ie(S.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),u=ge(S.DeathPosition.x,S.DeathPosition.z,h.MapName);y.push({x:u.x,z:u.z,victimName:S.Username,killerName:r,deathType:fe(S.DeathType),mapName:h.MapName,camp:D,gameId:h.DisplayedId,displayedGameId:h.DisplayedId})}})}),y},[w,r,R,c]),p=T.useMemo(()=>qe(s,n).map((h,t)=>{const S=h.items[0],D=Ee(h.items);return{x:h.centroidX,z:h.centroidZ,count:h.items.length,allLocations:h.items,victimName:h.items.length===1?S.victimName:null,killerName:h.items.length===1?S.killerName:null,deathType:D,mapName:S.mapName,camp:S.camp,gameId:h.items.length===1?S.gameId:null,displayedGameId:h.items.length===1?S.displayedGameId:null,clusterIndex:t}}),[s,n]),o=T.useMemo(()=>Ge(c),[c]),{xDomain:P,zDomain:A}=T.useMemo(()=>{if(o)return{xDomain:[o.xMin,o.xMax],zDomain:[o.zMin,o.zMax]};if(p.length===0)return{xDomain:[0,100],zDomain:[0,100]};const y=p.map(k=>k.x),h=p.map(k=>k.z),t=Math.min(...y),S=Math.max(...y),D=Math.min(...h),u=Math.max(...h),v=(S-t)*.1||10,N=(u-D)*.1||10;return{xDomain:[t-v,S+v],zDomain:[D-N,u+N]}},[p,o]),I=y=>y?y==="BY_WOLF"||y==="SURVIVALIST_NOT_SAVED"?g.Loup:y==="VOTED"?"var(--chart-color-1)":y==="BULLET"||y==="BULLET_HUMAN"||y==="BULLET_WOLF"?g.Chasseur:y==="BY_ZOMBIE"?g.Vaudou:y==="ASSASSIN"?g.Alchimiste:y==="AVENGER"?"var(--chart-color-2)":y==="LOVER_DEATH"?g.Amoureux:y==="BY_BEAST"?"var(--chart-color-3)":y==="SHERIF_SUCCESS"?"var(--chart-color-4)":y==="SMUGGLER_HUNT_KILL"?g.Contrebandier:"var(--accent-primary)":"var(--text-secondary)",M=({active:y,payload:h})=>{if(!y||!h||h.length===0)return null;const t=h[0].payload,S=t.allLocations||[t];if(S.length>1){const v=new Map,N=new Map,k=new Set;S.forEach($=>{v.set($.victimName,(v.get($.victimName)||0)+1);const L=$.deathType?re($.deathType):"Inconnu";N.set(L,(N.get(L)||0)+1),k.add($.gameId)});const b=Array.from(v.entries()).sort(($,L)=>L[1]-$[1]).slice(0,3),F=Array.from(N.entries()).sort(($,L)=>L[1]-$[1]).slice(0,3);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:[R==="deaths"?"ðŸ’€":"âš”ï¸"," ",S.length," ",R==="deaths"?"morts":"kills"," Ã  cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:R==="deaths"?"Par:":"Victimes:"}),b.map(([$,L])=>e.jsxs("div",{style:{paddingLeft:"0.5rem"},children:["â€¢ ",$," (",L,"x)"]},$)),v.size>3&&e.jsxs("div",{style:{paddingLeft:"0.5rem",color:"var(--text-secondary)"},children:["+",v.size-3," autres..."]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Types de mort:"}),F.map(([$,L])=>e.jsxs("div",{style:{paddingLeft:"0.5rem"},children:["â€¢ ",$," (",L,"x)"]},$))]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["ðŸ“ ",k.size," partie",k.size>1?"s":""," diffÃ©rente",k.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const u=S[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:[R==="deaths"?"ðŸ’€":"âš”ï¸"," ",R==="deaths"?"Mort de":"Kill de"," ",r]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[R==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"TuÃ© par:"})," ",u.killerName||"Inconnu"]}),e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Cause:"})," ",u.deathType?re(u.deathType):"Inconnue"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Victime:"})," ",u.victimName]}),e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Cause:"})," ",u.deathType?re(u.deathType):"Inconnue"]}),e.jsxs("div",{children:["ðŸ‘¥ ",e.jsx("strong",{children:"Camp victime:"})," ",u.camp]})]}),e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",u.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",u.gameId]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})},W=y=>{if(!y)return;const h=y.allLocations||[y];if(h.length===1)d({selectedGame:h[0].gameId,fromComponent:"Player Death Map"});else{const t=h.map(S=>S.gameId).filter(S=>S);d({selectedGameIds:t,fromComponent:"Player Death Map"})}};return C?e.jsx("div",{className:"donnees-attente",children:"Chargement des donnÃ©es..."}):j?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",j]}):w?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>f("deaths"),style:{background:R==="deaths"?"var(--accent-primary)":"transparent",color:R==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:R==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"ðŸ’€ Morts"}),e.jsx("button",{type:"button",onClick:()=>f("kills"),style:{background:R==="kills"?"var(--accent-primary)":"transparent",color:R==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:R==="kills"?"bold":"normal",transition:"all 0.2s"},children:"âš”ï¸ Kills"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:c,onChange:y=>m(y.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:i.map(y=>e.jsx("option",{value:y,children:y},y))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:n,onChange:y=>a(parseInt(y.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:n===0?"Aucun":`${n} unitÃ©${n>1?"s":""}`})]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{flex:"1 1 100%",marginBottom:"1.5rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:R==="deaths"?"Morts localisÃ©es":"Kills localisÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:R==="deaths"?"var(--accent-secondary)":"var(--accent-primary)"},children:s.length}),n>0&&p.length<s.length&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"4px"},children:["â†’ ",p.length," points groupÃ©s"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Carte"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-2)",fontSize:"1.2rem"},children:c||"Aucune"})]})]}),e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:s.length>0?e.jsx(B,{title:R==="deaths"?`Carte des Morts de ${r}`:`Carte des Kills de ${r}`,children:e.jsx("div",{style:{width:"100%",maxWidth:900,margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(Be,{margin:{top:20,right:30,left:60,bottom:60},children:[o&&e.jsx(Ve,{x1:o.zMin,x2:o.zMax,y1:o.xMin,y2:o.xMax,fill:"transparent",stroke:"none",shape:y=>{const{x:h,y:t,width:S,height:D}=y;return e.jsx("image",{x:h,y:t,width:S,height:D,href:o.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),e.jsx(K,{strokeDasharray:"3 3",stroke:o?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(O,{dataKey:"z",type:"number",name:"Position Z",label:{value:"Position Z",position:"bottom",offset:10,style:{fill:"var(--text-secondary)"}},domain:A,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:y=>Math.round(y).toString()}),e.jsx(H,{dataKey:"x",type:"number",name:"Position X",label:{value:"Position X",angle:-90,position:"left",offset:20,style:{fill:"var(--text-secondary)"}},domain:P,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:y=>Math.round(y).toString()}),e.jsx(V,{content:e.jsx(M,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Ke,{data:p,onClick:y=>W(y),style:{cursor:"pointer"},isAnimationActive:!1,children:p.map((y,h)=>{const t=Math.min(Math.log2(y.count+1)*3+5,18),S=Math.round(t);return e.jsx(U,{fill:I(y.deathType),stroke:y.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:y.count>1?2:1,opacity:.85,r:S},`cell-${h}`)})})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:R==="deaths"?`Aucune mort localisÃ©e pour ${r} sur cette carte.`:`Aucun kill localisÃ© pour ${r} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes."})]})}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"Ã€ propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",R==="deaths"?`les emplacements oÃ¹ ${r} est mort`:`les emplacements oÃ¹ ${r} a Ã©liminÃ© d'autres joueurs`," au cours des parties. Les couleurs indiquent le type de mort. Cliquez sur un point pour voir les dÃ©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroupÃ©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’€ Morts:"})," OÃ¹ le joueur a Ã©tÃ© Ã©liminÃ©",e.jsx("br",{}),e.jsx("strong",{children:"âš”ï¸ Kills:"})," OÃ¹ le joueur a Ã©liminÃ© d'autres joueurs"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function Se(r){return r.PlayerStats.some(d=>d.SecondsTalkedOutsideMeeting>0||d.SecondsTalkedDuringMeeting>0)}function ce(r,d){const w=d.DeathDateIrl||r.EndDate,C=je(r.StartDate,w);return C&&C>0?C:0}function ot(r){const d=r.filter(Se),w=new Map;return d.forEach(C=>{C.PlayerStats.forEach(j=>{const g=Z(j),R=Ne(j),f=ce(C,j);if(f<=0)return;w.has(g)||w.set(g,{displayName:R,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const c=w.get(g);c.gamesPlayed++,c.totalSecondsAll+=(j.SecondsTalkedOutsideMeeting||0)+(j.SecondsTalkedDuringMeeting||0),c.totalGameDuration+=f})}),{playerStats:w,gamesWithTalkingData:d.length}}function lt(r,d){if(!d||d.length===0||!r)return null;const w=ot(d),C=d.filter(Se);if(C.length===0||w.playerStats.size===0)return null;let j=null;for(const[k,b]of w.playerStats)if(b.displayName===r){j=k;break}if(!j)return null;let g=0,R=0,f=0,c=0;const m={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},n=new Map;let a=0,i=0,l=0,s=0;if(C.forEach(k=>{const b=k.PlayerStats.find(q=>Z(q)===j);if(!b)return;const F=ce(k,b);if(F<=0)return;g++;const $=b.SecondsTalkedOutsideMeeting||0,L=b.SecondsTalkedDuringMeeting||0,te=$+L;R+=$,f+=L,c+=F;const x=Me(b.MainRoleInitial,b.Power);m[x].gamesPlayed++,m[x].secondsOutside+=$,m[x].secondsDuring+=L,m[x].gameDuration+=F;const z=We(b);n.has(z)||n.set(z,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const E=n.get(z);E.gamesPlayed++,E.totalSecondsAll+=te,E.totalGameDuration+=F}),g===0||c<=0)return null;const p=3600/c,o=R*p,P=f*p,A=(R+f)*p,I=R+f>0?f/(R+f)*100:0,M=[];for(const[k,b]of Object.entries(m)){if(b.gamesPlayed===0)continue;const F=b.gameDuration>0?3600/b.gameDuration:0,$=b.secondsOutside+b.secondsDuring;M.push({camp:k,gamesPlayed:b.gamesPlayed,totalSecondsOutside:b.secondsOutside,totalSecondsDuring:b.secondsDuring,totalSecondsAll:$,totalGameDurationSeconds:b.gameDuration,secondsOutsidePer60Min:b.secondsOutside*F,secondsDuringPer60Min:b.secondsDuring*F,secondsAllPer60Min:$*F,meetingRatio:$>0?b.secondsDuring/$*100:0})}M.sort((k,b)=>b.gamesPlayed-k.gamesPlayed);const W=Array.from(n.entries()).filter(([k,b])=>b.gamesPlayed>=1).map(([k,b])=>({role:k,gamesPlayed:b.gamesPlayed,secondsAllPer60Min:b.totalGameDuration>0?b.totalSecondsAll/b.totalGameDuration*3600:0,totalSecondsAll:b.totalSecondsAll})).sort((k,b)=>b.secondsAllPer60Min-k.secondsAllPer60Min).slice(0,5),y=[];for(const[k,b]of w.playerStats)b.totalGameDuration>0&&y.push({id:k,name:b.displayName,per60:b.totalSecondsAll/b.totalGameDuration*3600});y.sort((k,b)=>b.per60-k.per60);const h=y.reduce((k,b)=>k+b.per60,0),t=y.length>0?h/y.length:0,S=y.findIndex(k=>k.id===j)+1,D=y.length,u=D>0?Math.round((1-(S-1)/D)*100):0,v=A;C.forEach(k=>{const b=k.PlayerStats.find(te=>Z(te)===j);if(!b)return;const F=ce(k,b);if(F<=0)return;((b.SecondsTalkedOutsideMeeting||0)+(b.SecondsTalkedDuringMeeting||0))/F*3600>=v?(a++,b.Victorious&&i++):(l++,b.Victorious&&s++)});const N={gamesAboveAverage:a,winsAboveAverage:i,winRateAboveAverage:a>0?i/a*100:0,gamesBelowAverage:l,winsBelowAverage:s,winRateBelowAverage:l>0?s/l*100:0};return{playerName:r,gamesPlayed:g,gamesWithTalkingData:w.gamesWithTalkingData,totalSecondsOutside:R,totalSecondsDuring:f,totalSecondsAll:R+f,totalGameDurationSeconds:c,secondsOutsidePer60Min:o,secondsDuringPer60Min:P,secondsAllPer60Min:A,meetingRatio:I,campBreakdown:M,globalAverageSecondsAllPer60Min:t,playerRank:S,totalPlayersWithData:D,percentile:u,roleBreakdown:W,winCorrelation:N}}function ct(r){const{data:d,isLoading:w,error:C}=de(j=>r?lt(r,j):null);return{data:d,isLoading:w,error:C}}const dt={Villageois:"var(--camp-villageois)",Loup:"var(--camp-loup)",Autres:"var(--camp-autres)"},ut={Villageois:"#4CAF50",Loup:"#F44336",Autres:"#9C27B0"};function pt({selectedPlayerName:r}){const{data:d,isLoading:w,error:C}=ct(r),j=ae(),g=T.useMemo(()=>d?.campBreakdown?d.campBreakdown.map(s=>({camp:s.camp,"Hors rÃ©union":Math.round(s.secondsOutsidePer60Min),"En rÃ©union":Math.round(s.secondsDuringPer60Min),total:Math.round(s.secondsAllPer60Min),gamesPlayed:s.gamesPlayed,meetingRatio:s.meetingRatio.toFixed(1)})):[],[d]),R=T.useMemo(()=>d?[{name:"En rÃ©union",value:d.totalSecondsDuring,color:"#2196F3"},{name:"Hors rÃ©union",value:d.totalSecondsOutside,color:"#FF9800"}]:[],[d]),f=T.useMemo(()=>d?.roleBreakdown?d.roleBreakdown.map(s=>({role:s.role,secondsPer60Min:Math.round(s.secondsAllPer60Min),gamesPlayed:s.gamesPlayed})):[],[d]),c=s=>{const p=s;return j[s]||dt[p]||ut[p]||"#888888"},m=s=>{const p={Chasseur:j.Chasseur||"#FF5722",Alchimiste:j.Alchimiste||"#9C27B0",Protecteur:j.Protecteur||"#4CAF50",Disciple:j.Disciple||"#2196F3","Aucun pouvoir":j.Villageois||"#8BC34A",Villageois:j.Villageois||"#4CAF50",Loup:j.Loup||"#F44336","Idiot du Village":j["Idiot du Village"]||"#FFC107",TraÃ®tre:j.TraÃ®tre||"#E91E63",Louveteau:j.Louveteau||"#FF5722"};return s in j?j[s]||p[s]||j.Villageois||"#4CAF50":p[s]||j.Villageois||"#4CAF50"};if(w)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(C)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",C]});if(!d)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de temps de parole ne sont disponibles que pour les parties rÃ©centes."})]});const n=d.secondsAllPer60Min-d.globalAverageSecondsAllPer60Min,a=d.globalAverageSecondsAllPer60Min>0?(n/d.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",i=n>0,l=d.winCorrelation.winRateAboveAverage-d.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¤ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem"},children:se(d.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:i?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[i?"+":"",a,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem"},children:["#",d.playerRank," / ",d.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-d.percentile+1,"% ",d.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“ˆ Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem"},children:d.gamesPlayed}),e.jsxs("p",{children:["sur ",d.gamesWithTalkingData," avec donnÃ©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ—£ï¸ Ratio en rÃ©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem"},children:[d.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),g.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx(B,{title:"Temps de parole par camp (par 60min de jeu)",children:e.jsx("div",{style:{height:350},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:g,layout:"vertical",children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(O,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:s=>`${Math.floor(s/60)}m`}),e.jsx(H,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(V,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(s,p)=>[se(s),p],labelFormatter:s=>{const p=g.find(o=>o.camp===s);return`${s} (${p?.gamesPlayed||0} parties)`}}),e.jsx(Oe,{}),e.jsx(_,{dataKey:"Hors rÃ©union",stackId:"talk",fill:"#FF9800"}),e.jsx(_,{dataKey:"En rÃ©union",stackId:"talk",fill:"#2196F3"})]})})})}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:g.length>=2&&(()=>{const s=[...g].sort((A,I)=>I.total-A.total),p=s[0],o=s[s.length-1],P=p.total-o.total;return e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," parle"," ",e.jsxs("strong",{style:{color:c(p.camp)},children:[se(P)," de plus"]})," ","en tant que ",e.jsx("strong",{children:p.camp})," qu'en tant que"," ",e.jsx("strong",{children:o.camp})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(B,{title:"RÃ©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(Ce,{children:[e.jsx(we,{data:R,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:s=>`${s.name}: ${((s.percent||0)*100).toFixed(1)}%`,children:R.map((s,p)=>e.jsx(U,{fill:s.color},`cell-${p}`))}),e.jsx(V,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:s=>se(s)})]})})})})}),f.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(B,{title:"Top 5 rÃ´les les plus bavards (par 60min)",children:e.jsx("div",{style:{height:300},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:f,children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(O,{dataKey:"role",tick:{fill:"var(--text-primary)",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(H,{tick:{fill:"var(--text-secondary)"},tickFormatter:s=>`${Math.floor(s/60)}m`}),e.jsx(V,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:s=>[se(s),"Temps de parole"],labelFormatter:s=>{const p=f.find(o=>o.role===s);return`${s} (${p?.gamesPlayed||0} parties)`}}),e.jsx(_,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",children:f.map((s,p)=>e.jsx(U,{fill:m(s.role)},`cell-${p}`))})]})})})})}),(d.winCorrelation.gamesAboveAverage>0||d.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"ðŸŽ¯ CorrÃ©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[d.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",d.winCorrelation.winsAboveAverage,"/",d.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[d.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",d.winCorrelation.winsBelowAverage,"/",d.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(l)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:r})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:l>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[l>0?"supÃ©rieur":"infÃ©rieur"," de ",Math.abs(l).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function Lt(){const{settings:r,updateSettings:d}=ne(),{navigateToGameDetails:w,navigationState:C,updateNavigationState:j}=Q(),{data:g,isLoading:R,error:f}=Ae(),{joueursData:c,isLoading:m}=oe(),{data:n,isLoading:a,error:i}=Je(r.highlightedPlayer),l=ue(c),[s,p]=T.useState(""),[o,P]=T.useState(null),{clips:A}=He(r.highlightedPlayer),{clips:I}=_e(),[M,W]=T.useState(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded"?"modded":"all":r.gameFilter==="modded"?"modded":"all"),y=T.useMemo(()=>r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled?r.independentFilters.gameFilter==="modded":r.gameFilter==="modded",[r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter,r.gameFilter]),[h,t]=T.useState(C.selectedPlayerSelectionView||"achievements"),[S,D]=T.useState("session"),[u,v]=T.useState("all");T.useEffect(()=>{if(r.useIndependentFilters&&r.independentFilters?.gameTypeEnabled){const x=r.independentFilters.gameFilter==="modded"?"modded":"all";W(x)}else if(!r.useIndependentFilters){const x=r.gameFilter==="modded"?"modded":"all";W(x)}},[r.gameFilter,r.useIndependentFilters,r.independentFilters?.gameTypeEnabled,r.independentFilters?.gameFilter]),T.useEffect(()=>{y&&M!=="modded"&&W("modded")},[y,M]),T.useEffect(()=>{C.selectedPlayerSelectionView&&t(C.selectedPlayerSelectionView)},[C.selectedPlayerSelectionView]);const{data:N}=le(r.highlightedPlayer||""),k=T.useMemo(()=>{if(!g||!g.GameStats)return[];const x=y?g.GameStats.filter(E=>E.Modded===!0):g.GameStats,z=new Map;return x.forEach(E=>{const q=new Date(E.StartDate);E.PlayerStats.forEach(Y=>{const X=Z(Y),Re=c?.Players?.find(ke=>ke.SteamID===X)?.Joueur||Y.Username;z.has(X)||z.set(X,{games:0,wins:0,firstDate:q,lastDate:q,displayName:Re});const ee=z.get(X);ee.games++,Y.Victorious&&ee.wins++,q<ee.firstDate&&(ee.firstDate=q),q>ee.lastDate&&(ee.lastDate=q)})}),Array.from(z.entries()).map(([E,q])=>{let Y=c?.Players?.find(X=>X.SteamID===E);return Y||(Y=c?.Players?.find(X=>X.Joueur===q.displayName)),{id:E,name:q.displayName,totalGames:q.games,totalWins:q.wins,winRate:q.games>0?q.wins/q.games*100:0,firstGameDate:q.firstDate.toLocaleDateString("fr-FR"),lastGameDate:q.lastDate.toLocaleDateString("fr-FR"),isHighlighted:q.displayName===r.highlightedPlayer,image:Y?.Image||null,twitch:Y?.Twitch||null,youtube:Y?.Youtube||null}})},[g,r.highlightedPlayer,c,y]),b=T.useMemo(()=>{if(!s.trim())return k;const x=s.toLowerCase();return k.filter(z=>z.name.toLowerCase().includes(x))},[k,s]),F=T.useMemo(()=>[...b].sort((x,z)=>z.totalGames-x.totalGames),[b]),$=x=>{d({highlightedPlayer:x}),p("")},L=x=>{t(x),j({selectedPlayerSelectionView:x})},te=()=>{if(A.length===0)return;const x=Math.floor(Math.random()*A.length);P(A[x])};return R||m?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):f?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",f]})]}):!g||k.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!r.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:s,onChange:x=>p(x.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[b.length," joueur",b.length!==1?"s":"",s&&` (filtrÃ©${b.length!==1?"s":""} de ${k.length})`]})]})]}),e.jsx("div",{className:"player-display",children:s?b.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>p(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:F.map(x=>e.jsxs("button",{type:"button",className:`suggestion-btn ${x.isHighlighted?"highlighted":""}`,onClick:()=>$(x.name),children:[x.image?e.jsx("img",{src:x.image,alt:`Photo de profil de ${x.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":l[x.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[x.name,x.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[x.totalGames," parties â€¢ ",x.winRate.toFixed(1),"% victoires"]})]})]},x.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',s,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>p(""),children:"Effacer la recherche"})]}):r.highlightedPlayer?(()=>{const x=k.find(z=>z.name===r.highlightedPlayer);return x?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:x.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[x.image?e.jsx("img",{src:x.image,alt:`Photo de profil de ${x.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":l[x.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[x.totalGames," parties â€¢ ",x.totalWins," victoires â€¢ ",x.winRate.toFixed(1),"% taux de victoire"]}),(x.twitch||x.youtube||A.length>0)&&e.jsxs("div",{className:"social-links",children:[x.twitch&&e.jsx("a",{href:x.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),x.youtube&&e.jsx("a",{href:x.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"}),A.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:z=>{z.stopPropagation(),te()},title:`${A.length} clip${A.length>1?"s":""} disponible${A.length>1?"s":""}`,children:["ðŸŽ¬ Clip alÃ©atoire (",A.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${h==="achievements"?"active":""}`,onClick:()=>L("achievements"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${h==="evolution"?"active":""}`,onClick:()=>L("evolution"),children:"Ã‰volution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${h==="camps"?"active":""}`,onClick:()=>L("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${h==="roles"?"active":""}`,onClick:()=>L("roles"),children:"RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${h==="maps"?"active":""}`,onClick:()=>L("maps"),children:"Maps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${h==="kills"?"active":""}`,onClick:()=>L("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${h==="deathmap"?"active":""}`,onClick:()=>L("deathmap"),children:"Carte"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${h==="talkingtime"?"active":""}`,onClick:()=>L("talkingtime"),children:"Parole"})]}),h==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[a?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):i?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",i]})}):n?e.jsx(Qe,{achievements:M==="all"?n.allGamesAchievements:n.moddedOnlyAchievements,title:M==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:M}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[!y&&e.jsx("button",{type:"button",className:`filter-btn ${M==="all"?"active":""}`,onClick:z=>{z.stopPropagation(),W("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${M==="modded"?"active":""}`,onClick:z=>{z.stopPropagation(),W("modded")},disabled:y,children:"Parties moddÃ©es"})]})]}),h==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[N&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{w({selectedPlayer:x.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${x.name}`,style:{fontSize:"1.3rem"},children:N.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem"},children:Fe(N.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{w({selectedPlayer:x.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${x.name}`,style:{fontSize:"1.3rem"},children:N.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem"},children:[N.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:S,onChange:z=>D(z.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:u,onChange:z=>v(z.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(et,{selectedPlayerName:x.name,groupingMethod:S,campFilter:u})]}),h==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(tt,{selectedPlayerName:x.name})}),h==="maps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(st,{selectedPlayerName:x.name})}),h==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(it,{selectedPlayerName:x.name})}),h==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(at,{selectedPlayerName:x.name})}),h==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(nt,{selectedPlayerName:x.name})}),h==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(pt,{selectedPlayerName:x.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:z=>{z.stopPropagation(),d({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[x.firstGameDate," - ",x.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',r.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>d({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:F.map(x=>e.jsxs("div",{className:`character-card ${x.isHighlighted?"highlighted":""}`,onClick:()=>$(x.name),title:`${x.name} - ${x.totalGames} parties, ${x.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:x.image?e.jsx("img",{src:x.image,alt:`Photo de profil de ${x.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":l[x.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:x.name}),(x.twitch||x.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[x.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),x.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},x.id))})})}),o&&e.jsx(Ue,{clip:o,onClose:()=>P(null),relatedClips:Ye(o,I),nextClip:xe(o,I),onNextClip:()=>{const x=xe(o,I);x&&P(x)},onRelatedClip:x=>{const z=I.find(E=>E.ClipId===x);z&&P(z)}})]})}export{Lt as PlayerSelectionPage};
