import{u as K,a as O,r as m,j as e}from"./index-CAtuan37.js";import{u as X}from"./baseStatsHook-BLfWpVJc.js";import{c as Y}from"./playerStatsUtils-QYCi_Tjz.js";import{u as Q,m as U}from"./api-CTHk4bcp.js";import{F,B as C,C as k,X as z,Y as M,a as w,b as D}from"./FullscreenChart-DXyROMLK.js";import{R as H,T as B}from"./CategoricalChart-ETDhE4bH.js";import{R as Z}from"./ReferenceLine-Cicnc7Lp.js";function _(p){return X(r=>Y(r,p))}function ne(){const{navigateToGameDetails:p}=K(),{settings:r}=O(),[o,N]=m.useState(10),[c,V]=m.useState("best"),[x,I]=m.useState("Toutes les cartes"),[v,y]=m.useState(null),{data:d,isLoading:q,error:f}=_(x),j=Q(),{participationData:P,winRateData:u,averageWinRate:b,totalEligiblePlayers:E,highlightedPlayerInParticipation:G,highlightedPlayerInWinRate:$}=m.useMemo(()=>{if(!d?.playerStats)return{participationData:[],winRateData:[],averageWinRate:"0",totalEligiblePlayers:0,highlightedPlayerInParticipation:!1,highlightedPlayerInWinRate:!1};const i=d.playerStats,a=[],t=[];let s=0;for(const l of i)s+=parseFloat(l.winPercent),l.gamesPlayed>=o&&a.push(l),l.gamesPlayed>2&&t.push(l);const h=i.length>0?(s/i.length).toFixed(1):"0",g=t.sort((l,n)=>n.gamesPlayed-l.gamesPlayed).slice(0,20),L=r.highlightedPlayer&&g.some(l=>l.player===r.highlightedPlayer);let S=[...g],T=!1;if(r.highlightedPlayer&&!L){const l=t.find(n=>n.player===r.highlightedPlayer);l&&(S.push({...l,isHighlightedAddition:!0}),T=!0)}const R=a.sort((l,n)=>c==="best"?parseFloat(n.winPercent)-parseFloat(l.winPercent):parseFloat(l.winPercent)-parseFloat(n.winPercent)).slice(0,20),J=r.highlightedPlayer&&R.some(l=>l.player===r.highlightedPlayer);let A=[...R],W=!1;if(r.highlightedPlayer&&!J){const l=i.find(n=>n.player===r.highlightedPlayer);l&&(A.push({...l,isHighlightedAddition:!0}),W=!0)}return{participationData:S,winRateData:A,averageWinRate:h,totalEligiblePlayers:a.length,highlightedPlayerInParticipation:T,highlightedPlayerInWinRate:W}},[d,o,c,r.highlightedPlayer]);return q?e.jsx("div",{className:"donnees-attente",children:"Récupération des statistiques des joueurs..."}):f?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",f]}):d?e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques des Joueurs"}),e.jsxs("p",{className:"lycans-stats-info",children:["Total de ",d.totalGames," parties analysées avec ",d.playerStats.length," joueurs"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1.5rem",padding:"1rem",background:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("label",{htmlFor:"global-map-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Type de carte:"}),e.jsxs("select",{id:"global-map-filter-select",value:x,onChange:i=>I(i.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"Toutes les cartes",children:"Toutes les cartes"}),e.jsx("option",{value:"Village",children:"Village"}),e.jsx("option",{value:"Château",children:"Château"}),e.jsx("option",{value:"Autres",children:"Autres"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Top Participations"}),G&&r.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['🎯 "',r.highlightedPlayer,'" affiché en plus du top 20']})]}),e.jsx(F,{title:"Top Participations",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(C,{data:P,margin:{top:20,right:30,left:20,bottom:10},children:[e.jsx(k,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:i,y:a,payload:t})=>e.jsx("text",{x:i,y:a,dy:16,textAnchor:"end",fill:r.highlightedPlayer===t.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:r.highlightedPlayer===t.value?14:13,fontWeight:r.highlightedPlayer===t.value?"bold":"italic",transform:`rotate(-45 ${i} ${a})`,children:t.value})}),e.jsx(M,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(B,{content:({active:i,payload:a})=>{if(i&&a&&a.length>0){const t=a[0].payload,s=t.isHighlightedAddition,h=r.highlightedPlayer===t.player;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:t.player})}),e.jsxs("div",{children:["Parties jouées : ",t.gamesPlayed]}),e.jsxs("div",{children:["Pourcentage : ",t.gamesPlayedPercent,"%"]}),s&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection personnelle"}),h&&!s&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(w,{dataKey:"gamesPlayed",name:"Parties jouées",fill:"#00C49F",children:P.map(i=>{const a=r.highlightedPlayer===i.player,t=v===i.player,s=i.isHighlightedAddition;return e.jsx(D,{fill:j[i.player]||"#00C49F",stroke:a?"var(--accent-primary)":t?"var(--text-primary)":"none",strokeWidth:a?3:t?2:0,strokeDasharray:s?"5,5":"none",opacity:s?.8:1,onClick:()=>{p({selectedPlayer:i.player,fromComponent:"Statistiques Joueurs"})},onMouseEnter:()=>y(i.player),onMouseLeave:()=>y(null),style:{cursor:"pointer"}},`cell-participation-${i.player}`)})})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{style:{marginBottom:"0.5rem"},children:c==="best"?"Meilleurs Taux de Victoire":"Moins Bon Taux de Victoire"}),$&&r.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['🎯 "',r.highlightedPlayer,'" affiché en plus du top 20']}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsxs("select",{value:c,onChange:i=>V(i.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"best",children:"Meilleurs Taux de Victoire"}),e.jsx("option",{value:"worst",children:"Moins Bon Taux de Victoire"})]}),e.jsx("label",{htmlFor:"min-games-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select",value:o,onChange:i=>N(Number(i.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:U.map(i=>e.jsx("option",{value:i,children:i},i))})]})]}),e.jsx(F,{title:c==="best"?"Meilleurs Taux de Victoire":"Moins Bon Taux de Victoire",children:e.jsx("div",{style:{height:400},children:e.jsx(H,{width:"100%",height:"100%",children:e.jsxs(C,{data:u,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(k,{strokeDasharray:"3 3"}),e.jsx(z,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:i,y:a,payload:t})=>e.jsx("text",{x:i,y:a,dy:16,textAnchor:"end",fill:r.highlightedPlayer===t.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:r.highlightedPlayer===t.value?14:13,fontWeight:r.highlightedPlayer===t.value?"bold":"italic",transform:`rotate(-45 ${i} ${a})`,children:t.value})}),e.jsx(M,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(B,{content:({active:i,payload:a})=>{if(i&&a&&a.length>0){const t=a[0].payload,s=t.isHighlightedAddition,h=r.highlightedPlayer===t.player,g=t.gamesPlayed>=o;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:t.player})}),e.jsxs("div",{children:["Taux de victoire : ",t.winPercent,"%"]}),e.jsxs("div",{children:["Victoires : ",t.wins," / ",t.gamesPlayed]}),s&&!g&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["🎯 Affiché via sélection (< ",o," parties)"]}),s&&g&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Affiché via sélection (hors top 20)"}),h&&!s&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"🎯 Joueur sélectionné"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(w,{dataKey:"winPercent",name:"Taux de Victoire",fill:"#8884d8",children:u.map(i=>{const a=r.highlightedPlayer===i.player,t=v===i.player,s=i.isHighlightedAddition;return e.jsx(D,{fill:j[i.player]||"#8884d8",stroke:a?"var(--accent-primary)":t?"var(--text-primary)":"none",strokeWidth:a?3:t?2:0,strokeDasharray:s?"5,5":"none",opacity:s?.8:1,onClick:()=>{p({selectedPlayer:i.player,selectedPlayerWinMode:"wins-only",fromComponent:"Taux de Victoire"})},onMouseEnter:()=>y(i.player),onMouseLeave:()=>y(null),style:{cursor:"pointer"}},`cell-winrate-${i.player}`)})}),e.jsx(Z,{y:parseFloat(b),stroke:"red",strokeDasharray:"3 3",label:{value:`Moyenne: ${b}%`,position:"insideBottomRight",fill:"red",fontSize:12,fontWeight:"bold"}})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",u.length," des joueurs (sur ",E," ayant au moins ",o," partie",o>1?"s":"",")"]})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de joueur disponible"})}export{ne as PlayersGeneralStatisticsChart};
