import{f as G,u as W,r as w,j as e}from"./index-qcnvDDF3.js";import{u as E}from"./baseStatsHook-br_xh1LJ.js";import{g as L,a as V}from"./gameUtils-BuNbDi0M.js";import{u as B}from"./usePlayerStatsFromRaw-C58nPoWF.js";import{a as H,l as K}from"./api-B4NWc1Vf.js";import{F as T,C as A,X as M,Y as N,B as $,a as k,b as P}from"./FullscreenChart-CoXXN0Ez.js";import{R as S,T as D}from"./CategoricalChart-28ZHlkGy.js";import{L as J,a as _}from"./LineChart-DbllFbbB.js";import{P as O,a as X}from"./PieChart-CvBdIX5C.js";import"./ActivePoints-5a0-AGuk.js";import"./PolarChart-B6qEGiSi.js";function Y(l,f){if(l.trim()===""||f.length===0)return null;const m=[];f.forEach(o=>{const d=o.PlayerStats.find(i=>i.Username.toLowerCase()===l.toLowerCase());if(d){const i=L(d.MainRoleInitial),y=V(o),x=d.Victorious,R=G(new Date(o.StartDate));m.push({gameId:o.Id,date:R,camp:i,won:x,winnerCamp:y,playersInGame:o.PlayerStats.length})}}),m.sort((o,d)=>{const i=y=>{const x=y.split("/");return x.length===3?new Date(parseInt(x[2]),parseInt(x[1])-1,parseInt(x[0])):new Date(y)};return i(d.date).getTime()-i(o.date).getTime()});const h=m.length,s=m.filter(o=>o.won).length,p=h>0?(s/h*100).toFixed(2):"0.00",u={};return m.forEach(o=>{u[o.camp]||(u[o.camp]={appearances:0,wins:0,winRate:"0.00"}),u[o.camp].appearances++,o.won&&u[o.camp].wins++}),Object.keys(u).forEach(o=>{const d=u[o];d.winRate=d.appearances>0?(d.wins/d.appearances*100).toFixed(2):"0.00"}),{playerName:l,totalGames:h,totalWins:s,winRate:p,games:m,campStats:u}}function U(l){const{data:f,isLoading:m,error:h}=E(s=>Y(l,s));return{data:f,isLoading:m,error:h}}function de(){const{navigateToGameDetails:l,navigationState:f,updateNavigationState:m}=W(),h=H(),s=f.selectedPlayerName||"Ponce",p=f.groupingMethod||"session",u=t=>{m({selectedPlayerName:t})},o=t=>{m({groupingMethod:t})},{data:d}=B(),{data:i,isLoading:y,error:x}=U(s),R=w.useMemo(()=>d?.playerStats?d.playerStats.filter(t=>t.gamesPlayed>0).map(t=>t.player).sort():["Ponce"],[d]),F=w.useMemo(()=>{if(!i?.games)return new Map;const t=new Map;return i.games.forEach(a=>{if(!t.has(a.date)){const r=a.date.split("/");r.length===3?t.set(a.date,new Date(parseInt(r[2]),parseInt(r[1])-1,parseInt(r[0])).getTime()):t.set(a.date,new Date(a.date).getTime())}}),t},[i?.games]),j=w.useMemo(()=>{if(!i?.games)return[];const t={};return i.games.forEach(a=>{let r;if(p==="month"){const n=a.date.split("/");n.length===3?r=`${n[1]}/${n[2]}`:r=a.date}else r=a.date;t[r]||(t[r]={games:[],wins:0,total:0}),t[r].games.push(a),t[r].total++,a.won&&t[r].wins++}),Object.entries(t).map(([a,r])=>({period:a,totalGames:r.total,victories:r.wins,defeats:r.total-r.wins,winRate:r.total>0?(r.wins/r.total*100).toFixed(1):"0.0",winRateNum:r.total>0?r.wins/r.total*100:0})).sort((a,r)=>{if(p==="month"){const[n,c]=a.period.split("/"),[g,b]=r.period.split("/"),q=new Date(parseInt(c),parseInt(n)-1,1),I=new Date(parseInt(b),parseInt(g)-1,1);return q.getTime()-I.getTime()}else{const n=F.get(a.period)||0,c=F.get(r.period)||0;return n-c}})},[i,p,F]),C=w.useMemo(()=>i?.campStats?Object.entries(i.campStats).map(([t,a])=>({name:t,value:a.appearances,winRate:a.winRate,winRateDisplay:Math.max(parseFloat(a.winRate),1),wins:a.wins,percentage:(a.appearances/i.totalGames*100).toFixed(1)})):[],[i]),z=w.useMemo(()=>{if(!C.length)return[];const t=5;let a=0;const r=[],n=[];if(C.forEach(c=>{parseFloat(c.percentage)<t?(a+=Number(c.value),r.push(c)):n.push(c)}),a>0){const c=C.reduce((g,b)=>g+Number(b.value),0);n.push({name:"Autres",value:a,winRate:"0.0",wins:r.reduce((g,b)=>g+b.wins,0),percentage:(a/c*100).toFixed(1),_details:r})}return n},[C]),v=(t=>t<=15?{fontSize:12,angle:-45,height:80,interval:0}:t<=30?{fontSize:12,angle:-45,height:85,interval:1}:t<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(t/12)})(j.length);return y?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):x?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",x]}):i?e.jsxs("div",{className:"lycans-player-history",children:[e.jsx("h2",{children:"Historique Détaillé d'un Joueur"}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Joueur:"}),e.jsx("select",{id:"player-select",value:s,onChange:t=>u(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:R.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:p,onChange:t=>o(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"})]})]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{l({selectedPlayer:s,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${s}`,children:i.totalGames}),e.jsx("p",{children:"parties jouées"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{l({selectedPlayer:s,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${s}`,children:i.totalWins}),e.jsx("p",{children:"parties gagnées"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",children:[i.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Évolution des Performances ",p==="month"?"par Mois":"par Session"]}),e.jsx(T,{title:`Évolution des Performances ${p==="month"?"par Mois":"par Session"}`,children:e.jsx("div",{style:{height:400},children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(J,{data:j,margin:{top:20,right:30,left:20,bottom:20},onClick:t=>{if(t&&t.activeLabel){const a=j.find(r=>r.period===t.activeLabel);a&&l({selectedPlayer:s,selectedDate:a.period,fromComponent:`Évolution des Performances ${p==="month"?"par Mois":"par Session"}`})}},style:{cursor:"pointer"},children:[e.jsx(A,{strokeDasharray:"3 3"}),e.jsx(M,{dataKey:"period",angle:v.angle,textAnchor:"end",height:v.height,interval:v.interval,fontSize:v.fontSize}),e.jsx(N,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(D,{content:({active:t,payload:a})=>{if(t&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.period})}),e.jsxs("div",{children:["Parties: ",r.totalGames]}),e.jsxs("div",{children:["Victoires: ",r.victories]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(_,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Répartition Victoires/Défaites ",p==="month"?"par Mois":"par Session"]}),e.jsx(T,{title:`Répartition Victoires/Défaites ${p==="month"?"par Mois":"par Session"}`,children:e.jsx("div",{style:{height:400},children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs($,{data:j,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(A,{strokeDasharray:"3 3"}),e.jsx(M,{dataKey:"period",angle:v.angle,textAnchor:"end",height:v.height,interval:v.interval,fontSize:v.fontSize}),e.jsx(N,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(D,{content:({active:t,payload:a})=>{if(t&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.period})}),e.jsxs("div",{children:["Total: ",r.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",r.victories]}),e.jsxs("div",{children:["Défaites: ",r.defeats]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(k,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:j.map((t,a)=>e.jsx(P,{fill:"var(--accent-tertiary)",onClick:()=>{l({selectedPlayer:s,selectedDate:t.period,fromComponent:`Historique Joueur - Victoires ${p==="month"?"par Mois":"par Session"}`})},style:{cursor:"pointer"}},`cell-victories-${a}`))}),e.jsx(k,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"Défaites",children:j.map((t,a)=>e.jsx(P,{fill:"var(--chart-color-4)",onClick:()=>{l({selectedPlayer:s,selectedDate:t.period,fromComponent:`Historique Joueur - Défaites ${p==="month"?"par Mois":"par Session"}`})},style:{cursor:"pointer"}},`cell-defeats-${a}`))})]})})})})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(O,{children:[e.jsx(X,{data:z,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:({name:t,value:a,percent:r})=>{const n=r!==void 0?r:0;return t==="Autres"?`Autres : ${a} (${(n*100).toFixed(1)}%)`:`${t}: ${a} (${(n*100).toFixed(1)}%)`},children:z.map((t,a)=>e.jsx(P,{fill:t.name==="Autres"?K:h[t.name]||`var(--chart-color-${a%6+1})`,onClick:()=>{if(t.name==="Autres"){const r=t._details?.map(n=>n.name)||[];l({selectedPlayer:s,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:r},fromComponent:"Distribution par Camps"})}else t.name==="Traître"?l({selectedPlayer:s,campFilter:{selectedCamp:"Traître",campFilterMode:"all-assignments",excludeTraitor:!0},fromComponent:"Distribution par Camps"}):t.name==="Loup"?l({selectedPlayer:s,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeTraitor:!0},fromComponent:"Distribution par Camps"}):l({selectedPlayer:s,campFilter:{selectedCamp:t.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${a}`))}),e.jsx(D,{content:({active:t,payload:a})=>{if(t&&a&&a.length>0){const r=a[0].payload;if(r.name==="Autres"&&r._details){const n=[...r._details].sort((c,g)=>g.value-c.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",r.value," parties (",r.percentage,"%)"]})}),e.jsx("div",{children:n.map((c,g)=>e.jsxs("div",{children:[c.name,": ",c.value," parties (",c.percentage,"%)"]},g))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[r.name," (",r.percentage,"%)"]})}),e.jsxs("div",{children:["Apparitions: ",r.value]}),e.jsxs("div",{children:["Victoires: ",r.wins," (",r.winRate,"%)"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(T,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs($,{data:C,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(A,{strokeDasharray:"3 3"}),e.jsx(M,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(N,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(D,{content:({active:t,payload:a})=>{if(t&&a&&a.length>0){const r=a[0].payload,n=parseFloat(r.winRate)>0;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.name})}),e.jsxs("div",{children:["Victoires: ",r.wins," / ",r.value]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:["🖱️ Cliquez pour voir ",n?"les victoires":"toutes les parties"]})]})}return null}}),e.jsx(k,{dataKey:"winRateDisplay",children:C.map((t,a)=>e.jsx(P,{fill:parseFloat(t.winRate)===0?`${h[t.name]||`var(--chart-color-${a%6+1})`}50`:h[t.name]||`var(--chart-color-${a%6+1})`,onClick:()=>{t.name==="Traître"?l({selectedPlayer:s,campFilter:{selectedCamp:t.name,campFilterMode:"all-assignments",excludeTraitor:!0},fromComponent:"Performance par Camp"}):t.name==="Loup"?l({selectedPlayer:s,campFilter:{selectedCamp:t.name,campFilterMode:"all-assignments",excludeTraitor:!0},fromComponent:"Performance par Camp"}):l({selectedPlayer:s,campFilter:{selectedCamp:t.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${a}`))})]})})})})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée d'historique disponible"})}export{de as PlayerGameHistoryChart};
