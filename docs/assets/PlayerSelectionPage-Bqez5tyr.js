import{a as pe,r as D,g as te,f as ze,u as ne,j as e,d as he,h as $e,e as Le,v as Ie}from"./index-NjdY3qqX.js";import{u as ue}from"./useJoueursData-DjwqJ7QZ.js";import{u as ve}from"./baseStatsHook-3QPITAeK.js";import{g as We}from"./gameUtils-rkfcKAVy.js";import{a as ke,g as ce,c as Te,b as qe}from"./datasyncExport-BirWLS1z.js";import{u as ge,g as Ge,b as oe,l as Ee,C as ie,f as je}from"./api-CPaHourn.js";import{f as re,d as Ve}from"./durationFormatters-C9UyWcKX.js";import{F as Y,C as J,X as Q,Y as X,a as Z}from"./FullscreenChart-Dw1eDDeg.js";import{R as K,T as H}from"./CategoricalChart-DO7bK87d.js";import{L as Be,a as Oe}from"./LineChart-BBwZHqiX.js";import{B as ee,a as O}from"./BarChart-CmTZrd02.js";import{P as Pe,a as Ne}from"./PieChart-D_Z9bRT1.js";import{g as de}from"./deathTypes-gHH1w6_X.js";import{i as be,g as Ce,V as Ke,a as He}from"./roleUtils-g252S1-m.js";import{i as _e,c as Ue}from"./wolfTransformUtils-DiCKErCz.js";import{L as De}from"./Legend-BJgGsOKC.js";import{S as Ye,R as ae,e as Je,f as Qe,h as me,a as Xe,b as Ze,d as et}from"./deathLocationUtils-DnyUae1E.js";import{a as tt,u as st}from"./useClips-wQ27ZH0z.js";import{C as rt,f as Se,a as at}from"./ClipViewer-DaMhIRs7.js";import"./ActivePoints--fYjJ3vs.js";import"./PolarChart-6bvri9AB.js";function it(s){const{settings:d}=pe(),{joueursData:x}=ue(),[v,C]=D.useState(null),[a,h]=D.useState(!1),[p,i]=D.useState(null);D.useEffect(()=>{let c=!0;return(async()=>{try{h(!0),i(null);const l=d.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",r=await fetch(l);if(!r.ok)throw new Error(`Failed to load achievements: ${r.status} ${r.statusText}`);const u=await r.json();c&&C(u)}catch(l){c&&i(l instanceof Error?l.message:"Failed to load achievements")}finally{c&&h(!1)}})(),()=>{c=!1}},[d.dataSource]);const n=(()=>{if(!s||!v)return null;const o=x?.Players?.find(l=>l.Joueur===s)?.SteamID;return o&&v.achievements[o]||null})();return D.useEffect(()=>{s&&v&&x&&x.Players?.find(l=>l.Joueur===s)?.SteamID},[s,v,x,d.dataSource]),{data:n,isLoading:a,error:p,metadata:{generatedAt:v?.generatedAt||null,totalPlayers:v?.totalPlayers||0,totalGames:v?.totalGames||0,totalModdedGames:v?.totalModdedGames||0}}}function nt(s,d,x){if(!s||s.trim()===""||d.length===0)return null;const v=[];let C=s;d.forEach(o=>{const l=o.PlayerStats.find(r=>te(r)===s||r.Username.toLowerCase()===s.toLowerCase());if(l){C=l.Username;const r=l.MainRoleInitial==="Louveteau"?l.MainRoleInitial:ke(l.MainRoleInitial,l.MainRoleChanges||[]),u=ce(r);if(x&&x!=="Tous les camps"&&u!==x)return;const w=We(o),m=l.Victorious,R=ze(new Date(o.StartDate)),k=Te(o.StartDate,o.EndDate)||0;v.push({gameId:o.Id,date:R,camp:u,won:m,winnerCamp:w,playersInGame:o.PlayerStats.length,mapName:o.MapName,duration:k})}}),v.sort((o,l)=>{const r=u=>{const w=u.split("/");return w.length===3?new Date(parseInt(w[2]),parseInt(w[1])-1,parseInt(w[0])):new Date(u)};return r(l.date).getTime()-r(o.date).getTime()});const a=v.length,h=v.filter(o=>o.won).length,p=a>0?(h/a*100).toFixed(2):"0.00",i={};v.forEach(o=>{i[o.camp]||(i[o.camp]={appearances:0,wins:0,winRate:"0.00"}),i[o.camp].appearances++,o.won&&i[o.camp].wins++}),Object.keys(i).forEach(o=>{const l=i[o];l.winRate=l.appearances>0?(l.wins/l.appearances*100).toFixed(2):"0.00"});const n={};v.forEach(o=>{n[o.mapName]||(n[o.mapName]={appearances:0,wins:0,winRate:"0.00"}),n[o.mapName].appearances++,o.won&&n[o.mapName].wins++}),Object.keys(n).forEach(o=>{const l=n[o];l.winRate=l.appearances>0?(l.wins/l.appearances*100).toFixed(2):"0.00"});const c=v.reduce((o,l)=>o+l.duration,0);return{playerName:C,totalGames:a,totalWins:h,winRate:p,totalPlayTime:c,games:v,campStats:i,mapStats:n}}function xe(s,d){const{data:x,isLoading:v,error:C}=ve(a=>s?nt(s,a,d):null);return{data:x,isLoading:v,error:C}}function ot(s){const{settings:d}=pe(),[x,v]=D.useState(null),[C,a]=D.useState(null),[h,p]=D.useState(!0),[i,n]=D.useState(null);return D.useEffect(()=>{(async()=>{p(!0),n(null);try{const o=d.dataSource==="discord"?"/data/discord/playerTitles.json":"/data/playerTitles.json",l=await fetch(o);if(!l.ok){if(l.status===404)v(null),a(null),n("Les titres n'ont pas encore Ã©tÃ© gÃ©nÃ©rÃ©s. Ils seront disponibles aprÃ¨s la prochaine synchronisation hebdomadaire.");else throw new Error(`HTTP error! status: ${l.status}`);return}const r=await l.json();if(v(r),s&&r.players){const u=Object.entries(r.players).find(([w,m])=>m.playerName===s);a(u?u[1]:null)}else a(null)}catch(o){console.error("Error loading player titles:",o),n(o instanceof Error?o.message:"Erreur inconnue"),v(null),a(null)}finally{p(!1)}})()},[d.dataSource,s]),{data:x,playerData:C,isLoading:h,error:i}}function lt({achievements:s,title:d,emptyMessage:x,achievementType:v="all"}){const{navigateToTab:C,updateNavigationState:a,clearNavigation:h}=ne(),{settings:p,updateSettings:i}=pe(),{joueursData:n}=ue(),c=ge(n),o=(t,N)=>{if(N.stopPropagation(),!t.redirectTo)return;h();const I=p.highlightedPlayer;if(i(v==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:I,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:I,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const j=p.highlightedPlayer||"",f=l(t.description,j);f&&a({playerComparisonState:{selectedPlayer1:j,selectedPlayer2:f,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const j=t.description.toLowerCase().includes("loup");a({selectedPairingTab:j?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const j=t.description.match(/(Villageois|Loups|Autres)/i);j&&a({deathStatsSelectedCamp:j[1]});let f=10;const g=t.description.match(/min\.\s*(\d+)/);g&&(f=parseInt(g[1],10));let S="totalKills",y="killers";const T=t.redirectTo.chartSection;T&&(T==="killers-total"?(S="totalKills",y="killers"):T==="killers-average"?(S="averageKills",y="killers"):T==="deaths-total"?(S="totalDeaths",y="deaths"):T==="survivors-average"?(S="survivalRate",y="deaths"):(T==="hunters-good"||T==="hunters-bad")&&(y="hunter",S="averageKills")),a({deathStatisticsState:{selectedCamp:j?.[1]||"Tous les camps",minGamesForAverage:f,selectedView:y,focusChart:S}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const j=t.redirectTo.mapFilter||"all";let f=10;const g=t.description.match(/min\.\s*(\d+)/);g&&(f=parseInt(g[1])),i(v==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:j,playerFilter:{mode:"none",players:[]},highlightedPlayer:I,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:j,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:j,playerFilter:{mode:"none",players:[]},highlightedPlayer:I,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:j,playerFilter:{mode:"none",players:[]}}}),a({playersGeneralState:{minGamesForWinRate:f,winRateOrder:"best",focusChart:"winRate"}}),C("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&a({selectedPlayerName:p.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let j="wins";const f=t.title.toLowerCase(),g=t.description.toLowerCase();f.includes("dÃ©faite")||g.includes("dÃ©faite")?j="losses":f.includes("loup")||g.includes("loup")?j="loup":f.includes("villageois")||g.includes("villageois")?j="villageois":(f.includes("victoire")||g.includes("victoire"))&&(j="wins"),a({selectedSeriesType:j})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let j=10;const f=t.description.match(/min\.\s*(\d+)/);f&&(j=parseInt(f[1],10));let g="winRate",S="best";const y=t.title.toLowerCase(),T=t.description.toLowerCase();y.includes("participation")||T.includes("participation")?g="participation":(y.includes("taux de victoire")||T.includes("taux de victoire"))&&(g="winRate",(y.includes("moins bon")||y.includes("mauvais")||T.includes("moins bon")||T.includes("mauvais"))&&(S="worst")),a({playersGeneralState:{minGamesForWinRate:j,winRateOrder:S,focusChart:g}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const j=t.redirectTo.chartSection;let f="Villageois",g=1;j&&(j==="camp-loup"?f="Loup":j==="camp-villageois"?f="Villageois":j==="camp-idiot"?f="Idiot du Village":j==="camp-amoureux"?f="Amoureux":(j==="solo-roles"||j==="hall-of-fame")&&(f="Villageois"));const S=t.description.match(/min\.\s*(\d+)/);S&&(g=parseInt(S[1],10)),j==="solo-roles"?f="RÃ´les spÃ©ciaux":j==="hall-of-fame"&&(f="Tous les camps"),a({campPerformanceState:{selectedCampPerformanceCamp:f,selectedCampPerformanceMinGames:g,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const j=t.title.toLowerCase();let f="overview",g="behavior";j.includes("agressivitÃ©")?(f="overview",g="behavior"):j.includes("taux de vote")?(f="behavior",g="voteRate"):j.includes("prÃ©cision")&&(f="overview",g="accuracy"),a({votingStatsState:{selectedCategory:f,selectedView:g}})}if(t.category==="loot"&&t.redirectTo.subTab==="lootStats"){const j=t.redirectTo,f=j.minGames||5,g=j.view||"normalized";a({lootStatsState:{minGames:f,campFilter:"all",view:g}})}C(t.redirectTo.tab,t.redirectTo.subTab)},l=(t,N)=>{const I=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const j of I){const f=t.match(j);if(f&&f[1]){const g=f[1].trim();if(g!==N)return g}}return null},r=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const j=t.description.match(/min\.\s*(\d+)/),f=j?parseInt(j[1],10):10,g=t.title.toLowerCase(),S=v==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return g.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${f} parties)${S}`:g.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${S}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${S}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const j=t.redirectTo.mapFilter,f=j==="village"?"Village":j==="chateau"?"ChÃ¢teau":"map",g=v==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${f}${g}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${l(t.description,p.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const j=t.description.match(/(Villageois|Loups|Autres)/i),f=t.description.match(/min\.\s*(\d+)/),g=f?parseInt(f[1],10):10,S=j?.[1]||"Tous les camps",y=t.redirectTo.chartSection;let T="kills et morts";return y==="killers-total"?T="total des kills":y==="killers-average"?T=`moyenne des kills (min. ${g} parties)`:y==="deaths-total"?T="total des morts":y==="survivors-average"&&(T=`taux de survie (min. ${g} parties)`),`Cliquez pour voir les statistiques de ${T} ${S!=="Tous les camps"?`en ${S}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const j=t.title.toLowerCase(),f=t.description.toLowerCase();return j.includes("dÃ©faite")||f.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":j.includes("loup")||f.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":j.includes("villageois")||f.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":j.includes("victoire")||f.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const j=t.redirectTo.chartSection,f=v==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return j==="camp-loup"?`Cliquez pour voir les performances camp Loup${f}`:j==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${f}`:j==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${f}`:j==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${f}`:j==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${f}`:j==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${f}`:`Cliquez pour voir les performances par camp${f}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const j=t.description.match(/min\.\s*(\d+)/),f=j?parseInt(j[1],10):25,g=v==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",S=t.title.toLowerCase();return S.includes("agressivitÃ©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${f} meetings)${g}`:S.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${f} meetings)${g}`:S.includes("prÃ©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${g}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${g}`}break;case"loot":if(t.redirectTo.subTab==="lootStats"){const j=t.description.match(/min\.\s*(\d+)/),f=j?parseInt(j[1],10):25,g=v==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de rÃ©colte (min. ${f} parties)${g}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(v==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},u=t=>c[t]||Ge(t),w=t=>{const N=[/avec ([^:]+?):/,/contre ([^:]+?):/];let I=t;return N.forEach(j=>{const f=t.match(j);if(f&&f[1]){const g=f[1].trim(),y=`<span class="player-name-highlight" style="color: ${u(g)};">${g}</span>`;I=I.replace(g,y)}}),I};if(s.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:d}),e.jsx("p",{children:x||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const m=t=>t===1?"ðŸ¥‡":t===2?"ðŸ¥ˆ":t===3?"ðŸ¥‰":"",R=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",k=(t,N)=>{if(!t||t<=3||!N)return;const I=t-3,j=N-3;return j<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(I-1)/(j-1))}, 70%, 50%)`},W=(t,N)=>{if(!t||!N)return;if(N<=1)return"hsl(0, 70%, 50%)";const I=(t-1)/(N-1),j=I*15,f=50-I*15;return`hsl(${j}, 70%, ${f}%)`},P=t=>{if(!t)return;const N=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(N){const[,I,j]=N;return`hsl(${I}, ${j}%, 40%)`}return t},M=s.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,N)=>(t.rank??999)-(N.rank??999)),F=s.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,N)=>(t.rank??999)-(N.rank??999)),V=s.filter(t=>t.category==="comparison"),z=[...M,...F].sort((t,N)=>(t.rank??999)-(N.rank??999)),L=M.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:d}),L>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:M.filter(t=>t.rank&&t.rank<=3).map((t,N)=>e.jsxs("div",{className:`top3-card ${R(t.rank)} animate-slide-in`,style:{animationDelay:`${N*.15}s`},onClick:I=>o(t,I),title:r(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:m(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:t.title}),e.jsx("p",{className:"top3-achievement-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},t.id))})]}),z.length>0&&e.jsxs("div",{className:"achievements-section unified-rankings",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:z.filter(t=>t.type==="bad"?!0:!t.rank||t.rank>3).map((t,N)=>{const I=t.type==="bad",j=I?W(t.rank,t.totalRanked):k(t.rank,t.totalRanked),f=P(j),g=I?"":R(t.rank);return e.jsxs("div",{className:`achievement-card ${I?"bad":"good"} ${g}`,onClick:S=>o(t,S),title:r(t),style:{animationDelay:`${N*.05}s`,borderLeftColor:f,borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsxs("span",{className:"achievement-title",children:[I&&"ðŸ’€ ",t.title]}),e.jsxs("span",{className:"achievement-rank",style:j?{backgroundColor:j}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:t.description})]},t.id)})})]}),V.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques CoÃ©quipiers et Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:V.map(t=>e.jsxs("div",{className:"achievement-card comparison",onClick:N=>o(t,N),title:r(t),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:t.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:w(t.description)}})]},t.id))})]})]})}function ct({selectedPlayerName:s,groupingMethod:d,campFilter:x="all"}){const{navigateToGameDetails:v}=ne(),{data:C,isLoading:a,error:h}=xe(s),p=D.useMemo(()=>{switch(d){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[d]),i=D.useMemo(()=>{if(!C?.games)return new Map;const l=new Map;return C.games.forEach(r=>{if(!l.has(r.date)){const u=r.date.split("/");u.length===3?l.set(r.date,new Date(parseInt(u[2]),parseInt(u[1])-1,parseInt(u[0])).getTime()):l.set(r.date,new Date(r.date).getTime())}}),l},[C?.games]),n=D.useMemo(()=>{if(!C?.games)return[];const l={};return C.games.forEach(r=>{if(x!=="all"){if(x==="solo"){if(r.camp==="Villageois"||r.camp==="Loup")return}else if(r.camp!==x)return}let u;const w=r.date.split("/");if(d==="month")if(w.length===3)u=`${w[1].padStart(2,"0")}/${w[2]}`;else{const m=new Date(r.date);u=`${String(m.getMonth()+1).padStart(2,"0")}/${m.getFullYear()}`}else if(d==="quarter")if(w.length===3){const m=parseInt(w[1],10);u=`T${Math.floor((m-1)/3)+1}/${w[2]}`}else{const m=new Date(r.date);u=`T${Math.floor(m.getMonth()/3)+1}/${m.getFullYear()}`}else d==="year"?w.length===3?u=`${w[2]}`:u=`${new Date(r.date).getFullYear()}`:u=r.date;l[u]||(l[u]={games:[],wins:0,total:0}),l[u].games.push(r),l[u].total++,r.won&&l[u].wins++}),Object.entries(l).map(([r,u])=>({period:r,totalGames:u.total,victories:u.wins,defeats:u.total-u.wins,winRate:u.total>0?(u.wins/u.total*100).toFixed(1):"0.0",winRateNum:u.total>0?u.wins/u.total*100:0})).sort((r,u)=>{if(d==="month"){const[w,m]=r.period.split("/"),[R,k]=u.period.split("/"),W=new Date(parseInt(m),parseInt(w)-1,1),P=new Date(parseInt(k),parseInt(R)-1,1);return W.getTime()-P.getTime()}else if(d==="quarter"){const[w,m]=r.period.split("/"),[R,k]=u.period.split("/"),W=parseInt(w.replace(/\D/g,""),10)||1,P=parseInt(R.replace(/\D/g,""),10)||1,M=new Date(parseInt(m,10),(W-1)*3,1),F=new Date(parseInt(k,10),(P-1)*3,1);return M.getTime()-F.getTime()}else if(d==="year"){const w=parseInt(r.period,10),m=parseInt(u.period,10);return w-m}else{const w=i.get(r.period)||0,m=i.get(u.period)||0;return w-m}})},[C,d,i,x]),o=(l=>l<=15?{fontSize:12,angle:-45,height:80,interval:0}:l<=30?{fontSize:12,angle:-45,height:85,interval:1}:l<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(l/12)})(n.length);return a?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):h?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",h]}):C?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",p]}),e.jsx(Y,{title:`Ã‰volution des Performances ${p}`,children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Be,{data:n,margin:{top:20,right:30,left:20,bottom:20},onClick:l=>{if(l&&l.activeLabel){const r=n.find(u=>u.period===l.activeLabel);r&&v({selectedPlayer:s,selectedDate:r.period,fromComponent:`Ã‰volution des Performances ${p}`})}},style:{cursor:"pointer"},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"period",angle:o.angle,textAnchor:"end",height:o.height,interval:o.interval,fontSize:o.fontSize}),e.jsx(X,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(H,{content:({active:l,payload:r})=>{if(l&&r&&r.length>0){const u=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:u.period})}),e.jsxs("div",{children:["Parties: ",u.totalGames]}),e.jsxs("div",{children:["Victoires: ",u.victories]}),e.jsxs("div",{children:["Taux: ",u.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Oe,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",p]}),e.jsx(Y,{title:`RÃ©partition Victoires/DÃ©faites ${p}`,children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"period",angle:o.angle,textAnchor:"end",height:o.height,interval:o.interval,fontSize:o.fontSize}),e.jsx(X,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:l,payload:r})=>{if(l&&r&&r.length>0){const u=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:u.period})}),e.jsxs("div",{children:["Total: ",u.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",u.victories]}),e.jsxs("div",{children:["DÃ©faites: ",u.defeats]}),e.jsxs("div",{children:["Taux: ",u.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(O,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:n.map((l,r)=>e.jsx(Z,{fill:"var(--accent-tertiary)",onClick:()=>{v({selectedPlayer:s,selectedDate:l.period,fromComponent:`Historique Joueur - Victoires ${p}`})},style:{cursor:"pointer"}},`cell-victories-${r}`))}),e.jsx(O,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:n.map((l,r)=>e.jsx(Z,{fill:"var(--chart-color-4)",onClick:()=>{v({selectedPlayer:s,selectedDate:l.period,fromComponent:`Historique Joueur - DÃ©faites ${p}`})},style:{cursor:"pointer"}},`cell-defeats-${r}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function dt({selectedPlayerName:s}){const{navigateToGameDetails:d}=ne(),{data:x,isLoading:v,error:C}=xe(s),a=oe(),h=D.useMemo(()=>x?.campStats?Object.entries(x.campStats).map(([i,n])=>({name:i,value:n.appearances,winRate:n.winRate,winRateDisplay:Math.max(parseFloat(n.winRate),1),wins:n.wins,percentage:(n.appearances/x.totalGames*100).toFixed(1)})):[],[x]),p=D.useMemo(()=>{if(!h.length)return[];const i=5;let n=0;const c=[],o=[];if(h.forEach(l=>{parseFloat(l.percentage)<i?(n+=Number(l.value),c.push(l)):o.push(l)}),n>0){const l=h.reduce((r,u)=>r+Number(u.value),0);o.push({name:"Autres",value:n,winRate:"0.0",winRateDisplay:1,wins:c.reduce((r,u)=>r+u.wins,0),percentage:(n/l*100).toFixed(1),_details:c})}return o},[h]);return v?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):C?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",C]}):x?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Pe,{children:[e.jsx(Ne,{data:p,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:i=>{const n=i.percent!==void 0?i.percent:0;return i.name==="Autres"?`Autres : ${i.value} (${(n*100).toFixed(1)}%)`:`${i.name}: ${i.value} (${(n*100).toFixed(1)}%)`},children:p.map((i,n)=>e.jsx(Z,{fill:i.name==="Autres"?Ee:a[i.name]||`var(--chart-color-${n%6+1})`,onClick:()=>{if(i.name==="Autres"){const c=i._details?.map(o=>o.name)||[];d({selectedPlayer:s,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:c},fromComponent:"Distribution par Camps"})}else i.name==="TraÃ®tre"||i.name==="Louveteau"?d({selectedPlayer:s,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):i.name==="Loup"?d({selectedPlayer:s,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):d({selectedPlayer:s,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${n}`))}),e.jsx(H,{content:({active:i,payload:n})=>{if(i&&n&&n.length>0){const c=n[0].payload;if(c.name==="Autres"&&c._details){const o=[...c._details].sort((l,r)=>r.value-l.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",c.value," parties (",c.percentage,"%)"]})}),e.jsx("div",{children:o.map((l,r)=>e.jsxs("div",{children:[l.name,": ",l.value," parties (",l.percentage,"%)"]},r))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[c.name," - ",c.value," parties (",c.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(Y,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:h,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(H,{content:({active:i,payload:n})=>{if(i&&n&&n.length>0){const c=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:c.name})}),e.jsxs("div",{children:["Victoires: ",c.wins," / ",c.value]}),e.jsxs("div",{children:["Taux: ",c.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(O,{dataKey:"winRateDisplay",children:h.map((i,n)=>e.jsx(Z,{fill:parseFloat(i.winRate)===0?`${a[i.name]||`var(--chart-color-${n%6+1})`}50`:a[i.name]||`var(--chart-color-${n%6+1})`,onClick:()=>{i.name==="TraÃ®tre"||i.name==="Louveteau"?d({selectedPlayer:s,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):i.name==="Loup"?d({selectedPlayer:s,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):d({selectedPlayer:s,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${n}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function ut({selectedPlayerName:s}){const{gameData:d}=he(),{joueursData:x}=ue(),v=ge(x),C=oe(),a=D.useMemo(()=>{if(!d||!s)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const p={},i={},n={},c=new Set;d.forEach(w=>{const m=w.PlayerStats.find(R=>R.Username.toLowerCase()===s.toLowerCase());if(m&&(w.PlayerStats.forEach(R=>{R.KillerName?.toLowerCase()===s.toLowerCase()&&(p[R.Username]=(p[R.Username]||0)+1)}),m.KillerName&&(i[m.KillerName]=(i[m.KillerName]||0)+1),m.DeathType)){const R=m.DeathType,k=de(R);n[k]||(n[k]={count:0,byDeathType:{}}),n[k].count+=1,n[k].byDeathType[R]=(n[k].byDeathType[R]||0)+1,c.add(R)}});const o=Object.entries(p).map(([w,m])=>({player:w,kills:m})).sort((w,m)=>m.kills-w.kills).slice(0,ie.TOP_10),l=Object.entries(i).map(([w,m])=>({player:w,kills:m})).sort((w,m)=>m.kills-w.kills).slice(0,ie.TOP_10),r=Object.entries(n).map(([w,m])=>{const R={deathType:w,count:m.count};return R[w]=m.count,R}).sort((w,m)=>m.count-w.count).slice(0,ie.TOP_10),u=Object.keys(n);return{playersKilled:o,killedBy:l,deathTypes:r,availableDeathTypes:u}},[d,s]),h=D.useMemo(()=>{const p={};a.availableDeathTypes.forEach(c=>{c==="TuÃ© par Loup"?p[c]=C.Loup:c==="Mort aux votes"?p[c]="var(--chart-color-1)":c.includes("Chasseur")?p[c]=C.Chasseur:c==="TuÃ© par Zombie"?p[c]=C.Vaudou:c==="TuÃ© par potion assassin"?p[c]=C.Alchimiste:c==="TuÃ© par Vengeur"?p[c]="var(--chart-color-2)":c==="Amoureux mort"?p[c]=C.Amoureux:c==="TuÃ© par La BÃªte"?p[c]="var(--chart-color-3)":c==="TuÃ© par ShÃ©rif"&&(p[c]="var(--chart-color-4)")});const i=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let n=0;return a.availableDeathTypes.forEach(c=>{p[c]||(p[c]=i[n%i.length],n++)}),p},[a.availableDeathTypes,C]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[a.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(Y,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:p,payload:i})=>{if(p&&i&&i.length>0){const n=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.player})}),e.jsxs("div",{children:["TuÃ© ",n.kills," fois par ",s]})]})}return null}}),e.jsx(O,{dataKey:"kills",children:a.playersKilled.map((p,i)=>e.jsx(Z,{fill:v[p.player]||"var(--chart-color-3)"},`cell-killed-${i}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[s," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),a.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(Y,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:p,payload:i})=>{if(p&&i&&i.length>0){const n=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.player})}),e.jsxs("div",{children:["A tuÃ© ",s," ",n.kills," fois"]})]})}return null}}),e.jsx(O,{dataKey:"kills",children:a.killedBy.map((p,i)=>e.jsx(Z,{fill:v[p.player]||"var(--chart-color-4)"},`cell-killer-${i}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[s," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),a.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(Y,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:p,payload:i})=>{if(p&&i&&i.length>0){const n=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.deathType})}),e.jsxs("div",{children:[s," est mort ",n.count," fois ainsi"]})]})}return null}}),a.availableDeathTypes.map(p=>e.jsx(O,{dataKey:p,name:p,stackId:"deaths",fill:h[p]||"var(--chart-color-5)"},p))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",s,"."]})]})]})}function mt(s,d){if(!s||s.trim()===""||d.length===0)return null;const x=new Map,v=new Map,C=new Map;d.forEach(n=>{if(!n.Modded)return;const c=n.PlayerStats.find(o=>te(o)===s||o.Username.toLowerCase()===s.toLowerCase());if(c){if(c.MainRoleInitial==="Inconnu")return;const o=c.Victorious,r=ke(c.MainRoleInitial,c.MainRoleChanges||[])!==c.MainRoleInitial,u=ce(c.MainRoleInitial),w=u==="Loup"||u==="TraÃ®tre"||u==="Louveteau";if(u==="Villageois"&&be(c)){const m=Ce(c);if(m&&Ke.includes(m)){const R=x.get(m)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};x.set(m,{appearances:R.appearances+1,wins:R.wins+(o?1:0),winsWithoutRoleChange:R.winsWithoutRoleChange+(!r&&o?1:0),gamesWithoutRoleChange:R.gamesWithoutRoleChange+(r?0:1)})}}else if(c.Power&&c.Power.trim()!==""&&c.Power!=="Inconnu"){if(u==="Villageois"){const m=x.get(c.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};x.set(c.Power,{appearances:m.appearances+1,wins:m.wins+(o?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!r&&o?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(r?0:1)})}else if(w){const m=v.get(c.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},R=m.roleBreakdown;R.set(c.MainRoleInitial,(R.get(c.MainRoleInitial)||0)+1),v.set(c.Power,{appearances:m.appearances+1,wins:m.wins+(o?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!r&&o?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(r?0:1),roleBreakdown:R})}}else if((u==="Villageois"||w)&&c.Power!=="Inconnu")if(u==="Villageois"){const m=x.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};x.set("Aucun pouvoir",{appearances:m.appearances+1,wins:m.wins+(o?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!r&&o?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(r?0:1)})}else{const m=v.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},R=m.roleBreakdown;R.set(c.MainRoleInitial,(R.get(c.MainRoleInitial)||0)+1),v.set("Aucun pouvoir",{appearances:m.appearances+1,wins:m.wins+(o?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!r&&o?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(r?0:1),roleBreakdown:R})}if(c.SecondaryRole&&c.SecondaryRole.trim()!==""&&c.SecondaryRole!=="Inconnu"){const m=C.get(c.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};C.set(c.SecondaryRole,{appearances:m.appearances+1,wins:m.wins+(o?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!r&&o?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(r?0:1)})}}});const a=new Map;d.forEach(n=>{const c=n.PlayerStats.find(o=>te(o)===s||o.Username.toLowerCase()===s.toLowerCase());if(c&&be(c)){const o=Ce(c);o&&a.set(o,(a.get(o)||0)+1)}});const h=n=>Array.from(n.entries()).map(([c,o])=>({name:c,appearances:o.appearances,wins:o.wins,winsWithoutRoleChange:o.winsWithoutRoleChange,gamesWithoutRoleChange:o.gamesWithoutRoleChange,winRate:o.gamesWithoutRoleChange>0?(o.winsWithoutRoleChange/o.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...a.has(c)&&{totalGamesAllModes:a.get(c)}})).sort((c,o)=>o.appearances-c.appearances),p=n=>Array.from(n.entries()).map(([c,o])=>({name:c,appearances:o.appearances,wins:o.wins,winsWithoutRoleChange:o.winsWithoutRoleChange,gamesWithoutRoleChange:o.gamesWithoutRoleChange,winRate:o.gamesWithoutRoleChange>0?(o.winsWithoutRoleChange/o.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(o.roleBreakdown.entries()).map(([l,r])=>({role:l,count:r})).sort((l,r)=>r.count-l.count)})).sort((c,o)=>o.appearances-c.appearances),i=n=>Array.from(n.entries()).map(([c,o])=>({name:c,appearances:o.appearances,wins:o.wins,winsWithoutRoleChange:o.winsWithoutRoleChange,gamesWithoutRoleChange:o.gamesWithoutRoleChange,winRate:o.gamesWithoutRoleChange>0?(o.winsWithoutRoleChange/o.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((c,o)=>o.appearances-c.appearances);return{villageoisPowers:h(x),loupPowers:p(v),secondaryRoles:i(C)}}function pt({selectedPlayerName:s}){const{navigateToGameDetails:d,navigationState:x,updateNavigationState:v}=ne(),C=oe(),[a,h]=D.useState(x.playerHistoryRolesState?.chartMode||"appearances"),{data:p,isLoading:i,error:n}=ve(k=>mt(s,k));D.useEffect(()=>{(!x.playerHistoryRolesState||x.playerHistoryRolesState.chartMode!==a)&&v({playerHistoryRolesState:{chartMode:a}})},[a,x.playerHistoryRolesState,v]);const c=k=>{h(k),v({playerHistoryRolesState:{chartMode:k}})},o=D.useCallback(k=>{if(!p)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const W=1,P=1,M=a==="winRate"?(z,L)=>parseFloat(L.winRate)-parseFloat(z.winRate):(z,L)=>L.appearances-z.appearances,F=z=>({...z,winRateDisplay:Math.max(parseFloat(z.winRate),1)}),V=z=>k===null?z:z.slice(0,k);return{villageoisPowers:V(p.villageoisPowers.filter(z=>z.appearances>=W).map(F).sort(M)),loupPowers:V(p.loupPowers.filter(z=>z.appearances>=W).map(F).sort(M)),secondaryRoles:V(p.secondaryRoles.filter(z=>z.appearances>=P).map(F).sort(M))}},[p,a]),l=D.useMemo(()=>o(15),[o]);if(i)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(n)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",n]});if(!p)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const r=l.villageoisPowers.length>0,u=l.loupPowers.length>0,w=l.secondaryRoles.length>0;if(!r&&!u&&!w)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const m=({active:k,payload:W})=>{if(k&&W&&W.length>0){const P=W[0].payload,M=P.gamesWithoutRoleChange<P.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:P.name})}),e.jsxs("div",{children:["Apparitions: ",P.appearances]}),M&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",P.appearances-P.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",P.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",P.winRate,"%"]})}),P.totalGamesAllModes&&P.totalGamesAllModes!==P.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",P.totalGamesAllModes,")"]}),P.roleBreakdown&&P.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),P.roleBreakdown.map((F,V)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",F.role,": ",F.count]},V))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},R=(k,W,P,M,F)=>{const V=a==="appearances"?"appearances":"winRateDisplay",z=a==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",L=a==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:W}),e.jsx(Y,{title:W,children:t=>{const I=o(t?null:15)[k];return e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:I,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:z,angle:270,position:"left",style:{textAnchor:"middle"}},domain:L}),e.jsx(H,{content:e.jsx(m,{})}),e.jsx(O,{dataKey:V,label:a==="winRate"?j=>{const{x:f,y:g,width:S,payload:y}=j;if(f===void 0||g===void 0||S===void 0||!y)return null;const T=y.winRate||"0";return e.jsxs("text",{x:f+S/2,y:g-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[T,"%"]})}:void 0,children:I.map((j,f)=>e.jsx(Z,{fill:F?F(j.name,f):P,onClick:()=>M(j.name),style:{cursor:"pointer"}},`cell-${f}`))})]})})})}})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:a,onChange:k=>c(k.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[r&&R("villageoisPowers","Camp Villageois","var(--chart-color-1)",k=>{d({selectedPlayer:s,campFilter:{selectedCamp:"Villageois",campFilterMode:a==="winRate"?"wins-only":"all-assignments"},selectedPower:k,fromComponent:`Historique des RÃ´les - Pouvoir: ${k}`})},k=>k==="Chasseur"&&C.Chasseur?C.Chasseur:k==="Alchimiste"&&C.Alchimiste?C.Alchimiste:k==="Protecteur"&&C.Protecteur?C.Protecteur:k==="Disciple"&&C.Disciple?C.Disciple:k==="Inquisiteur"&&C.Inquisiteur?C.Inquisiteur:"var(--chart-color-1)"),u&&R("loupPowers","Camp Loups","var(--chart-color-2)",k=>{d({selectedPlayer:s,campFilter:{selectedCamp:"Loup",campFilterMode:a==="winRate"?"wins-only":"all-assignments"},selectedPower:k,fromComponent:`Historique des RÃ´les - Pouvoir: ${k}`})},()=>C.Loup||"var(--chart-color-2)"),w&&R("secondaryRoles","RÃ´les Secondaires","var(--chart-color-3)",k=>{d({selectedPlayer:s,selectedSecondaryRole:k,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${k}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}const we=["UseGadget","DrinkPotion"],ht={UseGadget:"Utilisation Gadget",DrinkPotion:"Potion bue"},gt={UseGadget:"var(--chart-color-1, #8884d8)",DrinkPotion:"var(--chart-color-3, #ffc658)"};function xt({selectedPlayerName:s}){const{gameData:d}=he(),x=D.useMemo(()=>{if(!d||!s)return{actionTypeCounts:[],gadgetDetails:[],potionDetails:[],totalGamesWithActions:0,totalGamesPlayed:0};const C={UseGadget:0,DrinkPotion:0},a={},h={};let p=0,i=0;d.forEach(l=>{const r=l.PlayerStats.find(m=>m.Username.toLowerCase()===s.toLowerCase());if(!r)return;i++;let u=!1;(r.Actions||[]).forEach(m=>{const R=m.ActionType;we.includes(R)&&(C[R]++,u=!0,R==="UseGadget"&&m.ActionName&&m.ActionName!=="Balle"&&(a[m.ActionName]=(a[m.ActionName]||0)+1),R==="DrinkPotion"&&m.ActionName&&(h[m.ActionName]=(h[m.ActionName]||0)+1))}),u&&p++});const n=we.filter(l=>C[l]>0).map(l=>({actionType:l,label:ht[l],count:C[l],color:gt[l]})).sort((l,r)=>r.count-l.count),c=Object.entries(a).map(([l,r])=>({gadgetName:l,count:r})).sort((l,r)=>r.count-l.count).slice(0,ie.TOP_10),o=Object.entries(h).map(([l,r])=>({potionName:l,count:r})).sort((l,r)=>r.count-l.count).slice(0,ie.TOP_10);return{actionTypeCounts:n,gadgetDetails:c,potionDetails:o,totalGamesWithActions:p,totalGamesPlayed:i}},[d,s]);return x.actionTypeCounts.length>0?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",style:{width:"100%",flexBasis:"100%"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ® Parties avec actions"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:x.totalGamesWithActions}),e.jsxs("p",{children:["sur ",x.totalGamesPlayed," parties analysÃ©es"]})]}),x.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ”§ Gadgets utilisÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:x.gadgetDetails.reduce((C,a)=>C+a.count,0)}),e.jsxs("p",{children:[x.gadgetDetails.length," types diffÃ©rents"]})]}),x.potionDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ§ª Potions bues"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:x.potionDetails.reduce((C,a)=>C+a.count,0)}),e.jsxs("p",{children:[x.potionDetails.length," types diffÃ©rents"]})]})]}),x.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Gadgets UtilisÃ©s"}),e.jsx(Y,{title:"Gadgets UtilisÃ©s",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:x.gadgetDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"gadgetName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Utilisations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:C,payload:a})=>{if(C&&a&&a.length>0){const h=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:h.gadgetName})}),e.jsxs("div",{children:["UtilisÃ© ",h.count," fois"]})]})}return null}}),e.jsx(O,{dataKey:"count",fill:"var(--chart-color-1)",children:x.gadgetDetails.map((C,a)=>e.jsx(Z,{fill:`hsl(${200+a*20}, 70%, 50%)`},`cell-gadget-${a}`))})]})})})})]}),x.potionDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Potions Bues"}),e.jsx(Y,{title:"Potions Bues",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:x.potionDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"potionName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Consommations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:C,payload:a})=>{if(C&&a&&a.length>0){const h=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:h.potionName})}),e.jsxs("div",{children:["Bue ",h.count," fois"]})]})}return null}}),e.jsx(O,{dataKey:"count",fill:"var(--chart-color-3)",children:x.potionDetails.map((C,a)=>e.jsx(Z,{fill:`hsl(${40+a*15}, 80%, 55%)`},`cell-potion-${a}`))})]})})})})]})]}):e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune donnÃ©e d'actions disponible pour ",s,"."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es d'actions (gadgets, potions) ne sont disponibles que pour les parties rÃ©centes."})]})}function ft({selectedPlayerName:s}){const{gameData:d}=he(),{joueursData:x}=ue(),v=oe(),C=ge(x),a=D.useMemo(()=>{if(!d||!s)return{hunterTargets:[],hunterMissedShots:0,hunterTotalShots:0,transformCount:0,untransformCount:0,transformationsPerGame:0,totalGamesWithActions:0,totalGamesPlayed:0,totalNightsAsWolf:0,transformsPerNight:0};const p={};let i=0,n=0,c=0,o=0,l=0,r=0;d.forEach(P=>{const M=P.PlayerStats.find(t=>t.Username.toLowerCase()===s.toLowerCase());if(!M)return;l++;let F=!1;const V=P.Modded&&$e(P.Version||"0","0.243");let z=!1;if(V)z=!0;else{const N=(M.Actions||[]).some(j=>j.ActionType==="Transform"||j.ActionType==="Untransform"),I=M.LegacyActionsIncomplete===!0;z=N&&!I}if(_e(M.MainRoleInitial)&&z){const t=Ue(M.DeathTiming,P.EndTiming);r+=t}(M.Actions||[]).forEach(t=>{t.ActionType==="HunterShoot"?(c++,F=!0,t.ActionTarget&&(p[t.ActionTarget]=(p[t.ActionTarget]||0)+1)):t.ActionType==="Transform"?(i++,F=!0):t.ActionType==="Untransform"&&(n++,F=!0)}),F&&o++});const u=Object.entries(p).map(([P,M])=>({target:P,count:M})).sort((P,M)=>M.count-P.count).slice(0,ie.TOP_10),w=Object.values(p).reduce((P,M)=>P+M,0),m=c-w,R=i>0?Math.max(1,d.filter(P=>{const M=P.PlayerStats.find(V=>V.Username.toLowerCase()===s.toLowerCase());return M?(M.Actions||[]).some(V=>V.ActionType==="Transform"):!1}).length):0,k=R>0?i/R:0,W=r>0?i/r:0;return{hunterTargets:u,hunterMissedShots:m,hunterTotalShots:c,transformCount:i,untransformCount:n,transformationsPerGame:k,totalGamesWithActions:o,totalGamesPlayed:l,totalNightsAsWolf:r,transformsPerNight:W}},[d,s]);return a.hunterTotalShots>0||a.transformCount>0||a.untransformCount>0?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[a.hunterTotalShots>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Statistiques du Chasseur"}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"âœ… Tirs rÃ©ussis"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:v.Chasseur||"var(--chart-color-2)"},children:a.hunterTotalShots-a.hunterMissedShots}),e.jsx("p",{children:"cibles touchÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"âŒ Tirs manquÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--text-secondary)"},children:a.hunterMissedShots}),e.jsx("p",{children:"tirs sans cible"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š PrÃ©cision"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:v.Chasseur||"var(--chart-color-2)"},children:[a.hunterTotalShots>0?((a.hunterTotalShots-a.hunterMissedShots)/a.hunterTotalShots*100).toFixed(1):"0","%"]}),e.jsx("p",{children:"taux de rÃ©ussite"})]})]}),a.hunterTargets.length>0&&e.jsx(Y,{title:"Cibles Ã‰liminÃ©es par le Chasseur",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.hunterTargets,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"target",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Nombre de tirs",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:p,payload:i})=>{if(p&&i&&i.length>0){const n=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.target})}),e.jsxs("div",{children:["TuÃ© par le chasseur ",n.count," fois"]})]})}return null}}),e.jsx(O,{dataKey:"count",fill:v.Chasseur||"var(--chart-color-2)",children:a.hunterTargets.map((p,i)=>e.jsx(Z,{fill:C[p.target]||v.Chasseur||`hsl(${120+i*15}, 60%, 45%)`},`cell-hunter-${i}`))})]})})})})]}),(a.transformCount>0||a.untransformCount>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Habitudes de Transformation (Loup)"}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Ratio"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:(()=>{const p=a.transformCount,i=a.untransformCount;return p===0?"0%":`${(i/p*100).toFixed(0)}%`})()}),e.jsx("p",{children:"dÃ©transformations / transformations"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŒ™ Nuits totales"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:a.totalNightsAsWolf}),e.jsx("p",{children:"nuits vÃ©cues en loup (opportunitÃ©s)"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¯ Ratio / nuit"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:v.Loup||"var(--wolf-color)"},children:a.transformsPerNight.toFixed(2)}),e.jsx("p",{children:"transformations par nuit vÃ©cue"})]})]}),e.jsx(Y,{title:"Statistiques de Transformation",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:[{name:"Statistiques Loup","Nuits vÃ©cues":a.totalNightsAsWolf,Transformations:a.transformCount,DÃ©transformations:a.untransformCount}],margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",fontSize:14}),e.jsx(X,{label:{value:"Compte",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:p,payload:i})=>!p||!i||i.length===0?null:e.jsx("div",{className:"custom-tooltip",style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border-primary)",borderRadius:"4px",padding:"10px"},children:i.map((n,c)=>e.jsxs("div",{style:{color:n.color,marginBottom:"4px"},children:[e.jsxs("strong",{children:[n.name,":"]})," ",n.value]},c))})}),e.jsx(De,{}),e.jsx(O,{dataKey:"Nuits vÃ©cues",fill:"var(--chart-color-4, #a4de6c)"}),e.jsx(O,{dataKey:"Transformations",fill:v.Loup||"var(--wolf-color)"}),e.jsx(O,{dataKey:"DÃ©transformations",fill:"var(--accent-secondary)"})]})})})})]})]}):e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune donnÃ©e d'actions de rÃ´le disponible pour ",s,"."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es d'actions de rÃ´le (Chasseur, Loup) ne sont disponibles que pour les parties rÃ©centes."})]})}function yt({viewMode:s,setViewMode:d,selectedMap:x,setSelectedMap:v,availableMaps:C,clusterRadius:a,setClusterRadius:h,availableDeathTypes:p,selectedDeathTypes:i,setSelectedDeathTypes:n,deathTypeColors:c,isDeathTypesExpanded:o,setIsDeathTypesExpanded:l}){return e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>d("deaths"),style:{background:s==="deaths"?"var(--accent-primary)":"transparent",color:s==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:s==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"ðŸ’€ Morts"}),e.jsx("button",{type:"button",onClick:()=>d("kills"),style:{background:s==="kills"?"var(--accent-primary)":"transparent",color:s==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:s==="kills"?"bold":"normal",transition:"all 0.2s"},children:"âš”ï¸ Kills"}),e.jsx("button",{type:"button",onClick:()=>d("transformations"),style:{background:s==="transformations"?"var(--accent-primary)":"transparent",color:s==="transformations"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:s==="transformations"?"bold":"normal",transition:"all 0.2s"},children:"ðŸº Transfos"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:x,onChange:r=>v(r.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:C.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:a,onChange:r=>h(parseInt(r.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:a===0?"Aucun":`${a} unitÃ©${a>1?"s":""}`})]}),s!=="transformations"&&e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>l(!o),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:o?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:o?"rotate(90deg)":"rotate(0deg)"},children:"â–¶"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[i.length," / ",p.length," sÃ©lectionnÃ©",i.length>1?"s":""]})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),n(p)},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),n([])},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:p.map(r=>{const u=i.includes(r),w=c[r]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",background:u?"var(--bg-tertiary)":"transparent",borderRadius:"4px",border:`1px solid ${u?w:"var(--border-color)"}`,cursor:"pointer",transition:"all 0.2s",fontSize:"0.9rem"},onClick:m=>{m.stopPropagation(),n(u?R=>R.filter(k=>k!==r):R=>[...R,r])},children:[e.jsx("input",{type:"checkbox",checked:u,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:w,flexShrink:0}}),e.jsx("span",{children:de(r)})]},r)})})]})]})]})}function vt({zoneAnalysis:s,selectedMap:d,viewMode:x,selectedPlayerName:v,hoveredZone:C,setHoveredZone:a}){return!s||d!=="Village"||x!=="deaths"?null:e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"0rem",padding:"1.5rem",background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",borderRadius:"12px",border:"2px solid var(--accent-primary)",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",color:"var(--accent-primary)",fontSize:"1.3rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"ðŸ“Š Analyse par zone (Village)"}),e.jsx("p",{style:{fontSize:"0.95rem",marginBottom:"1rem",color:"var(--text-secondary)",lineHeight:"1.5"},children:"Distribution des morts (selon les types sÃ©lectionnÃ©s) comparÃ©e Ã  la moyenne de tous les joueurs:"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:s.zoneStats.map(h=>{const p=h.zone===s.dominantZone&&s.maxDeviation>10;return e.jsxs("div",{onMouseEnter:()=>a(h.zone),onMouseLeave:()=>a(null),style:{padding:"1rem",background:"var(--bg-primary)",borderRadius:"8px",border:C===h.zone?"1px solid var(--accent-primary)":"1px solid var(--border-color)",color:"var(--text-primary)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.95rem"},children:h.zone}),e.jsxs("div",{style:{fontSize:"0.85rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[v,": ",e.jsxs("strong",{children:[h.playerPercent.toFixed(1),"%"]})," (",h.playerCount,")"]}),e.jsxs("div",{style:{opacity:.85},children:["Moyenne: ",h.avgPercent.toFixed(1),"%"]}),e.jsxs("div",{style:{marginTop:"0.25rem",color:p?"var(--accent-secondary)":h.deviation>0?"var(--accent-primary)":"var(--text-secondary)",fontWeight:Math.abs(h.deviation)>5?"bold":"normal"},children:[h.deviation>0?"+":"",h.deviation.toFixed(1),"% vs moyenne"]})]})]},h.zone)})}),s.dominantZone&&s.maxDeviation>10&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",fontSize:"0.95rem",color:"var(--accent-primary)",fontWeight:"bold",background:"var(--bg-primary)",borderRadius:"8px",border:"2px solid var(--accent-primary)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"âš ï¸"}),e.jsxs("span",{children:[v," meurt significativement plus souvent en zone ",s.dominantZone,"(","+"+s.maxDeviation.toFixed(1),"% par rapport Ã  la moyenne)"]})]})]})}function jt({locationData:s,clusteredData:d,viewMode:x,selectedPlayerName:v,selectedMap:C,mapConfig:a,xDomain:h,zDomain:p,hoveredZone:i,getDeathColor:n,handleLocationClick:c}){const o=({active:l,payload:r})=>{if(!l||!r||r.length===0)return null;const u=r[0].payload,w=u.allLocations||[u],m=w.length>1,R=x==="transformations";if(m){const W=new Map,P=new Map,M=new Set,F=new Map;w.forEach(t=>{if(W.set(t.victimName,(W.get(t.victimName)||0)+1),R)F.set(t.camp,(F.get(t.camp)||0)+1);else{const N=t.deathType?de(t.deathType):"Inconnu";P.set(N,(P.get(N)||0)+1)}M.add(t.gameId)});const V=Array.from(W.entries()).sort((t,N)=>N[1]-t[1]).slice(0,3),z=Array.from(P.entries()).sort((t,N)=>N[1]-t[1]).slice(0,3),L=Array.from(F.entries()).sort((t,N)=>N[1]-t[1]);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[R?"ðŸº":x==="deaths"?"ðŸ’€":"âš”ï¸"," ",w.length," ",R?"transformations":x==="deaths"?"morts":"kills"," Ã  cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[R?e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Camps loup:"}),L.map(([t,N])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",N,"Ã—)"]},t))]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:x==="deaths"?"Victimes:":"Kills sur:"}),V.map(([t,N])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",N,"Ã—)"]},t))]}),e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Types de mort:"}),z.map(([t,N])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",N,"Ã—)"]},t))]})]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["ðŸ“ ",M.size," partie",M.size>1?"s":""," diffÃ©rente",M.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const k=w[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[R?"ðŸº":x==="deaths"?"ðŸ’€":"âš”ï¸"," ",R?"Transformation de":x==="deaths"?"Mort de":"Kill de"," ",v]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[R?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ‘¤ ",e.jsx("strong",{children:"Joueur:"})," ",k.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp loup:"})," ",k.camp]}),e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",k.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",k.gameId]})]}):x==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Victime:"})," ",k.victimName]}),e.jsxs("div",{children:["âš”ï¸ ",e.jsx("strong",{children:"Tueur:"})," ",k.killerName||"Inconnu"]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",k.deathType?de(k.deathType):"Inconnu"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Victime:"})," ",k.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp victime:"})," ",k.camp]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",k.deathType?de(k.deathType):"Inconnu"]})]}),!R&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",k.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",k.gameId]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})};return e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:s.length>0?e.jsx(Y,{title:x==="deaths"?`Carte des Morts de ${v}`:`Carte des Kills de ${v}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Ye,{margin:{top:20,right:30,left:60,bottom:20},children:[a&&e.jsx(ae,{x1:a.zMin,x2:a.zMax,y1:a.xMin,y2:a.xMax,fill:"transparent",stroke:"none",shape:l=>{const{x:r,y:u,width:w,height:m}=l;return e.jsx("image",{x:r,y:u,width:w,height:m,href:a.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),C==="Village"&&i&&e.jsxs(e.Fragment,{children:[i==="Ruines"&&e.jsx(ae,{x1:-220,x2:200,y1:100,y2:450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Village Principal"&&e.jsx(ae,{x1:-250,x2:100,y1:-120,y2:-450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Ferme"&&e.jsx(ae,{x1:-550,x2:-250,y1:150,y2:-150,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Village PÃªcheur"&&e.jsx(ae,{x1:150,x2:500,y1:80,y2:-320,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Reste de la Carte"&&e.jsx(ae,{x1:a?.zMin??-600,x2:a?.zMax??600,y1:a?.xMin??-500,y2:a?.xMax??500,fill:"var(--accent-primary)",fillOpacity:.15,stroke:"var(--accent-primary)",strokeWidth:2,strokeDasharray:"5 5"})]}),e.jsx(J,{strokeDasharray:"3 3",stroke:a?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(Q,{dataKey:"z",type:"number",name:"Position Z",domain:p,hide:!0}),e.jsx(X,{dataKey:"x",type:"number",name:"Position X",domain:h,hide:!0}),e.jsx(H,{content:e.jsx(o,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Je,{data:d,onClick:l=>c(l),style:{cursor:"pointer"},isAnimationActive:!1,children:d.map((l,r)=>{const u=Math.min(Math.log2(l.count+1)*3+5,18),w=Math.round(u);return e.jsx(Z,{fill:n(l.deathType,l.camp),stroke:l.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:l.count>1?2:1,opacity:.85,r:w},`cell-${r}`)})})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:x==="deaths"?`Aucune mort localisÃ©e pour ${v} sur cette carte.`:x==="kills"?`Aucun kill localisÃ© pour ${v} sur cette carte.`:`Aucune transformation en loup localisÃ©e pour ${v} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes."})]})})}function Re(s,d){return d>=-250&&d<=100&&s>=-450&&s<=-120?"Village Principal":d>=-550&&d<=-250&&s>=-150&&s<=150?"Ferme":d>=150&&d<=500&&s>=-320&&s<=80?"Village PÃªcheur":d>=-220&&d<=200&&s>=100&&s<=450?"Ruines":"Reste de la Carte"}function le(s){return s==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":s}function bt({selectedPlayerName:s}){const{navigateToGameDetails:d}=ne(),{gameData:x,isLoading:v,error:C}=he(),a=oe(),[h,p]=D.useState("deaths"),[i,n]=D.useState(""),[c,o]=D.useState(0),[l,r]=D.useState(null),[u,w]=D.useState([]),[m,R]=D.useState(!1),{data:k}=xe(s,"Tous les camps"),W=D.useMemo(()=>{if(!x)return[];const S=new Set;return x.forEach(y=>{const T=y.PlayerStats.find(A=>A.Username.toLowerCase()===s.toLowerCase());T&&(T.DeathPosition!==null&&y.MapName&&S.add(y.MapName),y.PlayerStats.forEach(A=>{A.KillerName?.toLowerCase()===s.toLowerCase()&&A.DeathPosition!==null&&y.MapName&&S.add(y.MapName)}),T.Actions&&Array.isArray(T.Actions)&&T.Actions.some(A=>A.ActionType==="Transform")&&y.MapName&&S.add(y.MapName))}),Array.from(S).filter(y=>y==="Village"||y==="ChÃ¢teau").sort((y,T)=>y==="Village"?-1:T==="Village"?1:y.localeCompare(T))},[x,s]),P=W.length>0?W[0]:"";i===""&&P!==""&&n(P);const{availableDeathTypes:M,deathTypeColors:F}=D.useMemo(()=>{if(!x||!s)return{availableDeathTypes:[],deathTypeColors:{}};const S=new Set,y={};return x.forEach(T=>{const A=T.PlayerStats.find($=>$.Username.toLowerCase()===s.toLowerCase());if(A){if(A.DeathPosition&&A.DeathType){const $=le(A.DeathType);$&&S.add($)}T.PlayerStats.forEach($=>{if($.KillerName?.toLowerCase()===s.toLowerCase()&&$.DeathPosition&&$.DeathType){const B=le($.DeathType);B&&S.add(B)}})}}),S.forEach(T=>{y[T]=Qe(T,a)}),{availableDeathTypes:Array.from(S).sort(),deathTypeColors:y}},[x,s,a]),V=(S,y)=>h==="transformations"&&y?a[y]||"var(--text-secondary)":S&&F[S]||"var(--text-secondary)";D.useEffect(()=>{if(u.length===0&&M.length>0){const S=M.filter(y=>y!=="VOTED");w(S)}},[M.length]);const z=D.useMemo(()=>{if(!x||!s)return[];const S=[];return x.forEach(y=>{if(i&&y.MapName!==i)return;const T=y.PlayerStats.find(A=>A.Username.toLowerCase()===s.toLowerCase());if(T)if(h==="deaths"){if(T.DeathPosition){const A=ce(T.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),$=me(T.DeathPosition.x,T.DeathPosition.z,y.MapName);S.push({x:$.x,z:$.z,victimName:T.Username,killerName:T.KillerName||null,deathType:le(T.DeathType),mapName:y.MapName,camp:A,gameId:y.DisplayedId,displayedGameId:y.DisplayedId})}}else h==="kills"?y.PlayerStats.forEach(A=>{if(A.KillerName?.toLowerCase()===s.toLowerCase()&&A.DeathPosition){const $=ce(A.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),B=me(A.DeathPosition.x,A.DeathPosition.z,y.MapName);S.push({x:B.x,z:B.z,victimName:A.Username,killerName:s,deathType:le(A.DeathType),mapName:y.MapName,camp:$,gameId:y.DisplayedId,displayedGameId:y.DisplayedId})}}):h==="transformations"&&T.Actions&&Array.isArray(T.Actions)&&T.Actions.forEach(A=>{if(A.ActionType==="Transform"&&A.Position){const $=ce(T.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),B=me(A.Position.x,A.Position.z,y.MapName);S.push({x:B.x,z:B.z,victimName:T.Username,killerName:null,deathType:null,mapName:y.MapName,camp:$,gameId:y.DisplayedId,displayedGameId:y.DisplayedId})}})}),h!=="transformations"&&u.length>0&&u.length<M.length?S.filter(y=>y.deathType&&u.includes(y.deathType)):S},[x,s,h,i,u,M]),L=D.useMemo(()=>{if(i!=="Village"||h!=="deaths"||z.length===0)return null;const S={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};if(z.forEach(E=>{const G=Re(E.x,E.z);S[G]=(S[G]||0)+1}),!x)return null;const y={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};x.forEach(E=>{E.MapName==="Village"&&E.PlayerStats.forEach(G=>{if(!G.DeathPosition)return;const _=le(G.DeathType);if(u.length>0&&u.length<M.length&&(!_||!u.includes(_)))return;const U=me(G.DeathPosition.x,G.DeathPosition.z,"Village"),fe=Re(U.x,U.z);y[fe]=(y[fe]||0)+1})});const T=Object.values(y).reduce((E,G)=>E+G,0),A=Object.values(S).reduce((E,G)=>E+G,0);if(T===0||A===0)return null;const $=["Village Principal","Village PÃªcheur","Ferme","Ruines","Reste de la Carte"];let B=0,b=null;const q=$.map(E=>{const G=S[E]/A*100,_=y[E]/T*100,U=G-_;return U>B&&S[E]>=2&&(B=U,b=E),{zone:E,playerCount:S[E],playerPercent:G,avgPercent:_,deviation:U}});return{totalPlayerDeaths:A,totalAllDeaths:T,zoneStats:q,dominantZone:b,maxDeviation:B}},[z,i,h,x,u,M]),t=D.useMemo(()=>Xe(z,c).map((y,T)=>{const A=y.items[0],$=Ze(y.items);return{x:y.centroidX,z:y.centroidZ,count:y.items.length,allLocations:y.items,victimName:y.items.length===1?A.victimName:null,killerName:y.items.length===1?A.killerName:null,deathType:$,mapName:A.mapName,camp:A.camp,gameId:y.items.length===1?A.gameId:null,displayedGameId:y.items.length===1?A.displayedGameId:null,clusterIndex:T}}),[z,c]),N=D.useMemo(()=>et(i),[i]),{xDomain:I,zDomain:j}=D.useMemo(()=>{if(N)return{xDomain:[N.xMin,N.xMax],zDomain:[N.zMin,N.zMax]};if(t.length===0)return{xDomain:[0,100],zDomain:[0,100]};const S=t.map(E=>E.x),y=t.map(E=>E.z),T=Math.min(...S),A=Math.max(...S),$=Math.min(...y),B=Math.max(...y),b=(A-T)*.1||10,q=(B-$)*.1||10;return{xDomain:[T-b,A+b],zDomain:[$-q,B+q]}},[t,N]),f=S=>{if(!S)return;const y=S.allLocations||[S];if(y.length===1)d({selectedGame:y[0].gameId,fromComponent:"Player Death Map"});else{const T=y.map(A=>A.gameId).filter(A=>A);d({selectedGameIds:T,fromComponent:"Player Death Map"})}},g=D.useMemo(()=>{if(!k?.mapStats||!i)return null;const S=k.mapStats[i];return S?{winRate:S.winRate,wins:S.wins,total:S.appearances}:null},[k,i]);return v?e.jsx("div",{className:"donnees-attente",children:"Chargement des donnÃ©es..."}):C?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",C]}):x?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsx(yt,{viewMode:h,setViewMode:p,selectedMap:i,setSelectedMap:n,availableMaps:W,clusterRadius:c,setClusterRadius:o,availableDeathTypes:M,selectedDeathTypes:u,setSelectedDeathTypes:w,deathTypeColors:F,isDeathTypesExpanded:m,setIsDeathTypesExpanded:R}),e.jsx(jt,{locationData:z,clusteredData:t,viewMode:h,selectedPlayerName:s,selectedMap:i,mapConfig:N,xDomain:I,zDomain:j,hoveredZone:l,getDeathColor:V,handleLocationClick:f}),e.jsx(vt,{zoneAnalysis:L,selectedMap:i,viewMode:h,selectedPlayerName:s,hoveredZone:l,setHoveredZone:r}),g&&e.jsxs("div",{style:{flex:"1 1 100%",textAlign:"center",padding:"0.75rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)",marginTop:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginRight:"1rem"},children:["Taux de victoire sur ",e.jsx("strong",{children:i})," :"]}),e.jsxs("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:parseFloat(g.winRate)>=50?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[g.winRate,"%"]}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["(",g.wins," / ",g.total," victoires)"]})]}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"Ã€ propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",h==="deaths"?`les emplacements oÃ¹ ${s} est mort`:h==="kills"?`les emplacements oÃ¹ ${s} a Ã©liminÃ© d'autres joueurs`:`les emplacements oÃ¹ ${s} s'est transformÃ© en loup`," au cours des parties.",h!=="transformations"&&"Les couleurs indiquent le type de mort."," Cliquez sur un point pour voir les dÃ©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroupÃ©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’€ Morts:"})," OÃ¹ le joueur a Ã©tÃ© Ã©liminÃ©",e.jsx("br",{}),e.jsx("strong",{children:"âš”ï¸ Kills:"})," OÃ¹ le joueur a Ã©liminÃ© d'autres joueurs",e.jsx("br",{}),e.jsx("strong",{children:"ðŸº Transformations:"})," OÃ¹ le joueur s'est transformÃ© en loup"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function Ae(s){return s.PlayerStats.some(d=>d.SecondsTalkedOutsideMeeting>0||d.SecondsTalkedDuringMeeting>0)}function ye(s,d){const x=d.DeathDateIrl||s.EndDate,v=Te(s.StartDate,x);return v&&v>0?v:0}function Ct(s){const d=s.filter(Ae),x=new Map;return d.forEach(v=>{v.PlayerStats.forEach(C=>{const a=te(C),h=Le(C),p=ye(v,C);if(p<=0)return;x.has(a)||x.set(a,{displayName:h,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const i=x.get(a);i.gamesPlayed++,i.totalSecondsAll+=(C.SecondsTalkedOutsideMeeting||0)+(C.SecondsTalkedDuringMeeting||0),i.totalGameDuration+=p})}),{playerStats:x,gamesWithTalkingData:d.length}}function St(s,d){if(!d||d.length===0||!s)return null;const x=Ct(d),v=d.filter(Ae);if(v.length===0||x.playerStats.size===0)return null;let C=null;for(const[f,g]of x.playerStats)if(g.displayName===s){C=f;break}if(!C)return null;let a=0,h=0,p=0,i=0;const n={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},c=new Map;let o=0,l=0,r=0,u=0;if(v.forEach(f=>{const g=f.PlayerStats.find(q=>te(q)===C);if(!g)return;const S=ye(f,g);if(S<=0)return;a++;const y=g.SecondsTalkedOutsideMeeting||0,T=g.SecondsTalkedDuringMeeting||0,A=y+T;h+=y,p+=T,i+=S;const $=qe(g.MainRoleInitial,g.Power);n[$].gamesPlayed++,n[$].secondsOutside+=y,n[$].secondsDuring+=T,n[$].gameDuration+=S;const B=He(g);c.has(B)||c.set(B,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const b=c.get(B);b.gamesPlayed++,b.totalSecondsAll+=A,b.totalGameDuration+=S}),a===0||i<=0)return null;const w=3600/i,m=h*w,R=p*w,k=(h+p)*w,W=h+p>0?p/(h+p)*100:0,P=[];for(const[f,g]of Object.entries(n)){if(g.gamesPlayed===0)continue;const S=g.gameDuration>0?3600/g.gameDuration:0,y=g.secondsOutside+g.secondsDuring;P.push({camp:f,gamesPlayed:g.gamesPlayed,totalSecondsOutside:g.secondsOutside,totalSecondsDuring:g.secondsDuring,totalSecondsAll:y,totalGameDurationSeconds:g.gameDuration,secondsOutsidePer60Min:g.secondsOutside*S,secondsDuringPer60Min:g.secondsDuring*S,secondsAllPer60Min:y*S,meetingRatio:y>0?g.secondsDuring/y*100:0})}P.sort((f,g)=>g.gamesPlayed-f.gamesPlayed);const M=Array.from(c.entries()).filter(([f,g])=>g.gamesPlayed>=1).map(([f,g])=>({role:f,gamesPlayed:g.gamesPlayed,secondsAllPer60Min:g.totalGameDuration>0?g.totalSecondsAll/g.totalGameDuration*3600:0,totalSecondsAll:g.totalSecondsAll})).sort((f,g)=>g.secondsAllPer60Min-f.secondsAllPer60Min),F=[];for(const[f,g]of x.playerStats)g.totalGameDuration>0&&F.push({id:f,name:g.displayName,per60:g.totalSecondsAll/g.totalGameDuration*3600});F.sort((f,g)=>g.per60-f.per60);const V=F.reduce((f,g)=>f+g.per60,0),z=F.length>0?V/F.length:0,L=F.findIndex(f=>f.id===C)+1,t=F.length,N=t>0?Math.round((1-(L-1)/t)*100):0,I=k;v.forEach(f=>{const g=f.PlayerStats.find(A=>te(A)===C);if(!g)return;const S=ye(f,g);if(S<=0)return;((g.SecondsTalkedOutsideMeeting||0)+(g.SecondsTalkedDuringMeeting||0))/S*3600>=I?(o++,g.Victorious&&l++):(r++,g.Victorious&&u++)});const j={gamesAboveAverage:o,winsAboveAverage:l,winRateAboveAverage:o>0?l/o*100:0,gamesBelowAverage:r,winsBelowAverage:u,winRateBelowAverage:r>0?u/r*100:0};return{playerName:s,gamesPlayed:a,gamesWithTalkingData:x.gamesWithTalkingData,totalSecondsOutside:h,totalSecondsDuring:p,totalSecondsAll:h+p,totalGameDurationSeconds:i,secondsOutsidePer60Min:m,secondsDuringPer60Min:R,secondsAllPer60Min:k,meetingRatio:W,campBreakdown:P,globalAverageSecondsAllPer60Min:z,playerRank:L,totalPlayersWithData:t,percentile:N,roleBreakdown:M,winCorrelation:j}}function wt(s,d){return s?s.roleBreakdown.slice(0,d):[]}function Rt(s){const{data:d,isLoading:x,error:v}=ve(C=>s?St(s,C):null);return{data:d,isLoading:x,error:v}}function kt({selectedPlayerName:s}){const{data:d,isLoading:x,error:v}=Rt(s),C=oe(),[a,h]=D.useState("both"),p=D.useMemo(()=>d?.campBreakdown?d.campBreakdown.map(r=>({camp:r.camp,"Hors rÃ©union":Math.round(r.secondsOutsidePer60Min),"En rÃ©union":Math.round(r.secondsDuringPer60Min),total:Math.round(r.secondsAllPer60Min),gamesPlayed:r.gamesPlayed,meetingRatio:r.meetingRatio.toFixed(1)})):[],[d]),i=D.useMemo(()=>d?[{name:"En rÃ©union",value:d.totalSecondsDuring,color:"#2196F3"},{name:"Hors rÃ©union",value:d.totalSecondsOutside,color:"#FF9800"}]:[],[d]);if(x)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(v)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",v]});if(!d)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de temps de parole ne sont disponibles que pour les parties rÃ©centes."})]});const n=d.secondsAllPer60Min-d.globalAverageSecondsAllPer60Min,c=d.globalAverageSecondsAllPer60Min>0?(n/d.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",o=n>0,l=d.winCorrelation.winRateAboveAverage-d.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¤ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:re(d.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:o?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[o?"+":"",c,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",d.playerRank," / ",d.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-d.percentile+1,"% ",d.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“ˆ Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:d.gamesPlayed}),e.jsxs("p",{children:["sur ",d.gamesWithTalkingData," avec donnÃ©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ—£ï¸ Ratio en rÃ©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[d.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),p.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(Y,{title:"Temps de parole par camp (par 60min de jeu)",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>h("meeting"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="meeting"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="meeting"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="meeting"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="meeting"?"bold":"normal"},children:"En rÃ©union"}),e.jsx("button",{onClick:()=>h("outside"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="outside"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="outside"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="outside"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="outside"?"bold":"normal"},children:"Hors rÃ©union"}),e.jsx("button",{onClick:()=>h("both"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="both"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="both"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="both"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="both"?"bold":"normal"},children:"Les deux"})]}),e.jsx("div",{style:{height:350},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:p,layout:"vertical",children:[e.jsx(J,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(Q,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:r=>`${Math.floor(r/60)}m`}),e.jsx(X,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(H,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(r,u)=>[re(r),u],labelFormatter:r=>{const u=p.find(w=>w.camp===r);return`${r} (${u?.gamesPlayed||0} parties)`}}),e.jsx(De,{}),(a==="both"||a==="outside")&&e.jsx(O,{dataKey:"Hors rÃ©union",stackId:"talk",fill:"#FF9800"}),(a==="both"||a==="meeting")&&e.jsx(O,{dataKey:"En rÃ©union",stackId:"talk",fill:"#2196F3"})]})})})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:(()=>{const r=p.find(R=>R.camp==="Villageois"),u=p.find(R=>R.camp==="Loup");if(!r||!u)return e.jsx("p",{children:"ðŸ’¡ Pas assez de donnÃ©es pour comparer les camps Villageois et Loups."});const w=r.total-u.total,m=u.total>0?(Math.abs(w)/u.total*100).toFixed(0):"0";return w>0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:s})," parle"," ",e.jsxs("strong",{style:{color:je("Villageois")},children:[re(w)," de plus (+",m,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Villageois"})," qu'en tant que"," ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]}):w<0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:s})," parle"," ",e.jsxs("strong",{style:{color:je("Loup")},children:[re(Math.abs(w))," de plus (+",m,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Loup"})," qu'en tant que"," ",e.jsx("strong",{children:"Villageois"})," (par heure de jeu)."]}):e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:s})," parle exactement autant en tant que"," ",e.jsx("strong",{children:"Villageois"})," qu'en tant que ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(Y,{title:"RÃ©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Pe,{children:[e.jsx(Ne,{data:i,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:r=>`${r.name}: ${((r.percent||0)*100).toFixed(1)}%`,children:i.map((r,u)=>e.jsx(Z,{fill:r.color},`cell-${u}`))}),e.jsx(H,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:r=>re(r)})]})})})})}),d&&d.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(Y,{title:r=>r?"Top 15 rÃ´les les plus bavards (par 60min)":"Top 5 rÃ´les les plus bavards (par 60min)",children:r=>{const w=wt(d,r?15:5).map(m=>({role:m.role,secondsPer60Min:Math.round(m.secondsAllPer60Min),gamesPlayed:m.gamesPlayed}));return e.jsx("div",{style:{height:r?400:300},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:w,children:[e.jsx(J,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(Q,{dataKey:"role",tick:{fill:"var(--text-primary)",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(X,{tick:{fill:"var(--text-secondary)"},tickFormatter:m=>`${Math.floor(m/60)}m`}),e.jsx(H,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:m=>[re(m),"Temps de parole"],labelFormatter:m=>{const R=w.find(k=>k.role===m);return`${m} (${R?.gamesPlayed||0} parties)`}}),e.jsx(O,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",children:w.map((m,R)=>e.jsx(Z,{fill:C[m.role]||C.Villageois},`cell-${R}`))})]})})})}})}),(d.winCorrelation.gamesAboveAverage>0||d.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"ðŸŽ¯ CorrÃ©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[d.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",d.winCorrelation.winsAboveAverage,"/",d.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[d.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",d.winCorrelation.winsBelowAverage,"/",d.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(l)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:s})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:l>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[l>0?"supÃ©rieur":"infÃ©rieur"," de ",Math.abs(l).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function Tt({playerTitles:s,titlesLoading:d}){if(d)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des titres..."})]})});if(!s||s.titles.length===0)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-empty",children:[e.jsx("p",{children:"ðŸ“œ Aucun titre disponible"}),e.jsx("p",{className:"empty-subtitle",children:s?.gamesPlayed?`${s.gamesPlayed} parties jouÃ©es - minimum 25 parties requises pour obtenir des titres`:"Les titres sont gÃ©nÃ©rÃ©s chaque dimanche pour les joueurs avec 25+ parties en mode moddÃ©"})]})});const x=[...s.titles].sort((h,p)=>{const i=s.titles.indexOf(h),c=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(h.category||"")?100-(h.percentile||50):h.percentile||50,o=(h.priority||0)*1e3+c*10-i,l=s.titles.indexOf(p),u=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(p.category||"")?100-(p.percentile||50):p.percentile||50;return(p.priority||0)*1e3+u*10-l-o}),v=x.filter(h=>!h.primaryOwner),C=x.filter(h=>h.primaryOwner),a=(h,p)=>{const i=s.primaryTitle?.id===h.id;return e.jsxs("div",{className:`title-card ${h.type} ${i?"primary":""} ${h.primaryOwner?"awarded-elsewhere":""}`,title:`${h.description}${h.percentile!==void 0?`
MeilleurÂ·e que ${h.percentile.toFixed(1)}% des joueurs`:""}`,children:[e.jsx("div",{className:"title-rank",children:p+1}),i&&e.jsx("div",{className:"title-crown",children:"ðŸ‘‘"}),e.jsx("div",{className:"title-emoji",children:h.emoji}),e.jsxs("div",{className:"title-info",children:[e.jsx("div",{className:"title-name",children:h.title}),e.jsx("div",{className:"title-description",children:h.description}),h.percentile!==void 0&&h.type!=="combination"&&e.jsxs("div",{className:"title-percentile",children:["Top ",(100-h.percentile).toFixed(0),"%"]}),e.jsx("div",{className:"title-type-badge",children:h.type==="combination"?"Combo":h.type==="role"?"RÃ´le":"Stat"}),!i&&h.primaryOwner&&e.jsxs("div",{className:"title-primary-owner",children:["ðŸ‘¤ Titre principal de: ",e.jsx("strong",{children:h.primaryOwner})]}),h.type==="combination"&&h.conditions&&h.conditions.length>0&&e.jsxs("div",{className:"title-conditions-breakdown",children:[e.jsx("div",{className:"breakdown-header",children:"Conditions:"}),h.conditions.map((n,c)=>e.jsxs("div",{className:"condition-item",children:[e.jsxs("span",{className:"condition-stat",children:[n.stat==="winRate"?"Victoires":n.stat==="loot"?"RÃ©colte":n.stat==="lootVillageois"?"RÃ©colte (Villageois)":n.stat==="lootLoup"?"RÃ©colte (Loup)":n.stat==="survival"?"Survie":n.stat==="killRate"?"Kills":n.stat==="talking"?"Parole":n.stat==="talkingOutsideMeeting"?"Parole (hors dÃ©bats)":n.stat==="talkingDuringMeeting"?"Parole (meeting)":n.stat==="votingAggressive"?"Vote agressif":n.stat==="votingAccuracy"?"PrÃ©cision vote":n.stat==="votingFirst"?"Vote rapide":n.stat==="survivalDay1"?"Survie J1":n.stat==="winRateVillageois"?"Victoires Villageois":n.stat==="winRateLoup"?"Victoires Loup":n.stat==="winRateSolo"?"Victoires Solo":n.stat==="hunterAccuracy"?"PrÃ©cision cible chasseur":n.stat==="hunterShotAccuracy"?"PrÃ©cision tir chasseur":n.stat==="zoneVillagePrincipal"?"Village Principal":n.stat==="zoneFerme"?"Ferme":n.stat==="zoneVillagePecheur"?"Village PÃªcheur":n.stat==="zoneRuines"?"Ruines":n.stat==="zoneResteCarte"?"Reste de la carte":n.stat==="zoneDominantPercentage"?"Dominance zone":n.stat,":"]}),e.jsx("span",{className:`condition-category ${n.category?.toLowerCase()}`,children:n.category}),n.actualPercentile!==void 0&&e.jsxs("span",{className:"condition-percentile",children:["(Top ",(100-n.actualPercentile).toFixed(0),"%)"]})]},c))]})]})]},h.id)};return e.jsxs("div",{className:"titles-section",children:[e.jsxs("div",{className:"titles-header",children:[e.jsx("h3",{children:"ðŸ·ï¸ Titres actuels"}),e.jsxs("p",{className:"titles-info",children:[s.titles.length," titre",s.titles.length>1?"s":""," â€¢ ",s.gamesPlayed," parties jouÃ©es"]})]}),v.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"titles-subsection-header",children:[e.jsxs("h4",{children:["âœ¨ Vos Titres (",v.length,")"]}),e.jsx("p",{children:"Titres que vous possÃ©dez ou partagez"})]}),e.jsx("div",{className:"titles-grid",children:v.map((h,p)=>a(h,p))})]}),C.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"titles-subsection-header secondary",children:[e.jsxs("h4",{children:["ðŸ–ï¸ Titres QualifiÃ©s (",C.length,")"]}),e.jsx("p",{children:"Vous remplissez les conditions, mais un autre joueur a une meilleure revendication"})]}),e.jsx("div",{className:"titles-grid awarded-elsewhere-grid",children:C.map((h,p)=>a(h,v.length+p))})]})]})}function Yt(){const{settings:s,updateSettings:d}=pe(),{navigateToGameDetails:x,navigationState:v,updateNavigationState:C}=ne(),{data:a,isLoading:h,error:p}=Ie(),{joueursData:i,isLoading:n}=ue(),{data:c,isLoading:o,error:l}=it(s.highlightedPlayer),{playerData:r,isLoading:u}=ot(s.highlightedPlayer),w=ge(i),[m,R]=D.useState(""),[k,W]=D.useState(null),{clips:P}=tt(s.highlightedPlayer),{clips:M}=st(),[F,V]=D.useState(()=>s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled?s.independentFilters.gameFilter==="modded"?"modded":"all":s.gameFilter==="modded"?"modded":"all"),z=D.useMemo(()=>s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled?s.independentFilters.gameFilter==="modded":s.gameFilter==="modded",[s.useIndependentFilters,s.independentFilters?.gameTypeEnabled,s.independentFilters?.gameFilter,s.gameFilter]),[L,t]=D.useState(s.selectedPlayerSelectionView||v.selectedPlayerSelectionView||"achievements"),[N,I]=D.useState("session"),[j,f]=D.useState("all");D.useEffect(()=>{if(s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled){const b=s.independentFilters.gameFilter==="modded"?"modded":"all";V(b)}else if(!s.useIndependentFilters){const b=s.gameFilter==="modded"?"modded":"all";V(b)}},[s.gameFilter,s.useIndependentFilters,s.independentFilters?.gameTypeEnabled,s.independentFilters?.gameFilter]),D.useEffect(()=>{z&&F!=="modded"&&V("modded")},[z,F]),D.useEffect(()=>{const b=s.selectedPlayerSelectionView||v.selectedPlayerSelectionView;b&&b!==L&&t(b)},[s.selectedPlayerSelectionView,v.selectedPlayerSelectionView]);const{data:g}=xe(s.highlightedPlayer||""),S=D.useMemo(()=>{if(!a||!a.GameStats)return[];const b=z?a.GameStats.filter(E=>E.Modded===!0):a.GameStats,q=new Map;return b.forEach(E=>{const G=new Date(E.StartDate);E.PlayerStats.forEach(_=>{const U=te(_),Me=i?.Players?.find(Fe=>Fe.SteamID===U)?.Joueur||_.Username;q.has(U)||q.set(U,{games:0,wins:0,firstDate:G,lastDate:G,displayName:Me});const se=q.get(U);se.games++,_.Victorious&&se.wins++,G<se.firstDate&&(se.firstDate=G),G>se.lastDate&&(se.lastDate=G)})}),Array.from(q.entries()).map(([E,G])=>{let _=i?.Players?.find(U=>U.SteamID===E);return _||(_=i?.Players?.find(U=>U.Joueur===G.displayName)),{id:E,name:G.displayName,totalGames:G.games,totalWins:G.wins,winRate:G.games>0?G.wins/G.games*100:0,firstGameDate:G.firstDate.toLocaleDateString("fr-FR"),lastGameDate:G.lastDate.toLocaleDateString("fr-FR"),isHighlighted:G.displayName===s.highlightedPlayer,image:_?.Image||null,twitch:_?.Twitch||null,youtube:_?.Youtube||null}})},[a,s.highlightedPlayer,i,z]),y=D.useMemo(()=>{if(!m.trim())return S;const b=m.toLowerCase();return S.filter(q=>q.name.toLowerCase().includes(b))},[S,m]),T=D.useMemo(()=>[...y].sort((b,q)=>q.totalGames-b.totalGames),[y]),A=b=>{d({highlightedPlayer:b}),R("")},$=b=>{t(b),C({selectedPlayerSelectionView:b}),d({selectedPlayerSelectionView:b,tab:"playerSelection"})},B=()=>{if(P.length===0)return;const b=Math.floor(Math.random()*P.length);W(P[b])};return h||n?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):p?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",p]})]}):!a||S.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!s.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:m,onChange:b=>R(b.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[y.length," joueur",y.length!==1?"s":"",m&&` (filtrÃ©${y.length!==1?"s":""} de ${S.length})`]})]})]}),e.jsx("div",{className:"player-display",children:m?y.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>R(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:T.map(b=>e.jsxs("button",{type:"button",className:`suggestion-btn ${b.isHighlighted?"highlighted":""}`,onClick:()=>A(b.name),children:[b.image?e.jsx("img",{src:b.image,alt:`Photo de profil de ${b.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":w[b.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[b.name,b.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[b.totalGames," parties â€¢ ",b.winRate.toFixed(1),"% victoires"]})]})]},b.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',m,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>R(""),children:"Effacer la recherche"})]}):s.highlightedPlayer?(()=>{const b=S.find(q=>q.name===s.highlightedPlayer);return b?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:b.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[b.image?e.jsx("img",{src:b.image,alt:`Photo de profil de ${b.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":w[b.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[b.totalGames," parties â€¢ ",b.totalWins," victoires â€¢ ",b.winRate.toFixed(1),"% taux de victoire"]}),r?.primaryTitle?e.jsxs("div",{className:"player-primary-title",title:r.primaryTitle.description,style:{marginTop:"0.5rem",display:"inline-flex",alignItems:"center",gap:"0.3rem",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("span",{className:"title-emoji",children:r.primaryTitle.emoji}),e.jsx("span",{className:"title-text",children:r.primaryTitle.title})]}):e.jsx("div",{className:"player-no-title",style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic"},children:"ðŸ“œ 25 parties moddÃ©es minimum pour obtenir un titre"}),(b.twitch||b.youtube||P.length>0)&&e.jsxs("div",{className:"social-links",children:[b.twitch&&e.jsx("a",{href:b.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),b.youtube&&e.jsx("a",{href:b.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"}),P.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:q=>{q.stopPropagation(),B()},title:`${P.length} clip${P.length>1?"s":""} disponible${P.length>1?"s":""}`,children:["ðŸŽ¬ Clip alÃ©atoire (",P.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="achievements"?"active":""}`,onClick:()=>$("achievements"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="titles"?"active":""}`,onClick:()=>$("titles"),children:"Titres"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="evolution"?"active":""}`,onClick:()=>$("evolution"),children:"Ã‰volution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="camps"?"active":""}`,onClick:()=>$("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="roles"?"active":""}`,onClick:()=>$("roles"),children:"RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="actions"?"active":""}`,onClick:()=>$("actions"),children:"Actions"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="roleactions"?"active":""}`,onClick:()=>$("roleactions"),children:"Actions des RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="kills"?"active":""}`,onClick:()=>$("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="deathmap"?"active":""}`,onClick:()=>$("deathmap"),children:"Cartes"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="talkingtime"?"active":""}`,onClick:()=>$("talkingtime"),children:"Parole"})]}),L==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[o?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):l?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",l]})}):c?e.jsx(lt,{achievements:F==="all"?c.allGamesAchievements:c.moddedOnlyAchievements,title:F==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:F}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[!z&&e.jsx("button",{type:"button",className:`filter-btn ${F==="all"?"active":""}`,onClick:q=>{q.stopPropagation(),V("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${F==="modded"?"active":""}`,onClick:q=>{q.stopPropagation(),V("modded")},disabled:z,children:"Parties moddÃ©es"})]})]}),L==="titles"&&e.jsx(Tt,{playerTitles:r,titlesLoading:u}),L==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[g&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{x({selectedPlayer:b.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${b.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:g.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:Ve(g.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{x({selectedPlayer:b.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${b.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:g.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[g.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:N,onChange:q=>I(q.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:j,onChange:q=>f(q.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(ct,{selectedPlayerName:b.name,groupingMethod:N,campFilter:j})]}),L==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(dt,{selectedPlayerName:b.name})}),L==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(pt,{selectedPlayerName:b.name})}),L==="actions"&&e.jsx("div",{className:"player-history-section",children:e.jsx(xt,{selectedPlayerName:b.name})}),L==="roleactions"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ft,{selectedPlayerName:b.name})}),L==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ut,{selectedPlayerName:b.name})}),L==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(bt,{selectedPlayerName:b.name})}),L==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(kt,{selectedPlayerName:b.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:q=>{q.stopPropagation(),d({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[b.firstGameDate," - ",b.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',s.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>d({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:T.map(b=>e.jsxs("div",{className:`character-card ${b.isHighlighted?"highlighted":""}`,onClick:()=>A(b.name),title:`${b.name} - ${b.totalGames} parties, ${b.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:b.image?e.jsx("img",{src:b.image,alt:`Photo de profil de ${b.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":w[b.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:b.name}),(b.twitch||b.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[b.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),b.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},b.id))})})}),k&&e.jsx(rt,{clip:k,onClose:()=>W(null),relatedClips:at(k,M),nextClip:Se(k,M),onNextClip:()=>{const b=Se(k,M);b&&W(b)},onRelatedClip:b=>{const q=M.find(E=>E.ClipId===b);q&&W(q)}})]})}export{Yt as PlayerSelectionPage};
