import{g as E,d as H,u as z,a as W,r as y,j as e}from"./index-B08DpCEn.js";import{a as w}from"./baseStatsHook-Bvn1Oty5.js";import{c as B}from"./datasyncExport-D6_8Fmuy.js";import{u as F}from"./useJoueursData-DVIBW_8f.js";import{u as R}from"./api-Cx8lpfqj.js";import{F as q,B as L,C as I,X as $,Y,a as K,b as V}from"./FullscreenChart-16fbJLBN.js";import{f as m}from"./durationFormatters-C9UyWcKX.js";import{R as X,T as J}from"./CategoricalChart-C6soroQv.js";function _(n){return n.PlayerStats.some(d=>d.SecondsTalkedOutsideMeeting>0||d.SecondsTalkedDuringMeeting>0)}function Q(n){if(!n||n.length===0)return null;const d=n.filter(_);if(d.length===0)return{playerStats:[],totalGames:n.length,gamesWithTalkingData:0};const g=new Map;return d.forEach(h=>{const i=B(h.StartDate,h.EndDate);!i||i<=0||h.PlayerStats.forEach(r=>{const s=E(r),v=H(r);g.has(s)||g.set(s,{displayName:v,gamesPlayed:0,totalSecondsOutside:0,totalSecondsDuring:0,totalGameDurationSeconds:0});const o=g.get(s);o.gamesPlayed++,o.totalSecondsOutside+=r.SecondsTalkedOutsideMeeting||0,o.totalSecondsDuring+=r.SecondsTalkedDuringMeeting||0,o.totalGameDurationSeconds+=i})}),{playerStats:Array.from(g.entries()).map(([h,i])=>{const r=i.totalSecondsOutside+i.totalSecondsDuring,s=i.totalGameDurationSeconds>0?3600/i.totalGameDurationSeconds:0;return{player:i.displayName,gamesPlayed:i.gamesPlayed,totalSecondsOutside:i.totalSecondsOutside,totalSecondsDuring:i.totalSecondsDuring,totalSecondsAll:r,totalGameDurationSeconds:i.totalGameDurationSeconds,secondsOutsidePer60Min:i.totalSecondsOutside*s,secondsDuringPer60Min:i.totalSecondsDuring*s,secondsAllPer60Min:r*s}}),totalGames:n.length,gamesWithTalkingData:d.length}}function U(){const{data:n,isLoading:d,error:g}=w(x=>Q(x));return{data:n,isLoading:d,error:g}}const Z=[3,5,15,25,50,100];function le(){const{data:n,isLoading:d,error:g}=U(),{navigateToGameDetails:x,navigationState:h,updateNavigationState:i}=z(),{settings:r}=W(),[s,v]=y.useState(h.talkingTimeState?.minGames||5),[o,b]=y.useState(h.talkingTimeState?.displayMode||"total"),[M,T]=y.useState(null),{joueursData:k}=F(),A=R(k);y.useEffect(()=>{const t=h.talkingTimeState;(!t||t.minGames!==s||t.displayMode!==o)&&i({talkingTimeState:{minGames:s,displayMode:o,focusChart:t?.focusChart}})},[s,o,i]);const{chartData:S,highlightedPlayerAdded:C}=y.useMemo(()=>{if(!n?.playerStats)return{chartData:[],highlightedPlayerAdded:!1};const t=n.playerStats,c=t.filter(l=>l.gamesPlayed>=s),a=l=>{switch(o){case"outside":return l.secondsOutsidePer60Min;case"during":return l.secondsDuringPer60Min;case"total":default:return l.secondsAllPer60Min}},u=c.sort((l,j)=>a(j)-a(l)).slice(0,20),p=r.highlightedPlayer&&u.some(l=>l.player===r.highlightedPlayer);let f=[...u],D=!1;if(r.highlightedPlayer&&!p){const l=t.find(j=>j.player===r.highlightedPlayer);l&&(f.push({...l,isHighlightedAddition:!0}),D=!0)}return{chartData:f,highlightedPlayerAdded:D}},[n,s,o,r.highlightedPlayer]);if(d)return e.jsx("div",{className:"donnees-attente",children:"R√©cup√©ration des statistiques de temps de parole..."});if(g)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]});if(!n)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de temps de parole disponible"});const G=t=>{switch(o){case"outside":return t.secondsOutsidePer60Min;case"during":return t.secondsDuringPer60Min;case"total":default:return t.secondsAllPer60Min}},P=()=>{switch(o){case"outside":return"Temps de Parole Hors Meeting (par 60 min)";case"during":return"Temps de Parole En Meeting (par 60 min)";case"total":default:return"Temps de Parole Total (par 60 min)"}},N=()=>{switch(o){case"outside":return"Temps hors meeting (par 60 min)";case"during":return"Temps en meeting (par 60 min)";case"total":default:return"Temps de parole (par 60 min)"}},O=n.playerStats.filter(t=>t.gamesPlayed>=s).length;return e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques de Temps de Parole"}),e.jsxs("p",{className:"lycans-stats-info",children:[n.gamesWithTalkingData," parties avec donn√©es de temps de parole (depuis la version 0.215 uniquement)"]}),e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:P()}),C&&r.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['üéØ "',r.highlightedPlayer,'" affich√© en plus du top 20']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsx("label",{htmlFor:"display-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Mode d'affichage:"}),e.jsxs("select",{id:"display-mode-select",value:o,onChange:t=>b(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"total",children:"Temps Total"}),e.jsx("option",{value:"outside",children:"Hors Meeting"}),e.jsx("option",{value:"during",children:"En Meeting"})]}),e.jsx("label",{htmlFor:"min-games-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",marginLeft:"1rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select",value:s,onChange:t=>v(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:Z.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx(q,{title:P(),children:e.jsx("div",{style:{height:400},children:e.jsx(X,{width:"100%",height:"100%",children:e.jsxs(L,{data:S,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(I,{strokeDasharray:"3 3"}),e.jsx($,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:c,payload:a})=>e.jsx("text",{x:t,y:c,dy:16,textAnchor:"end",fill:r.highlightedPlayer===a.value?"var(--accent-primary)":"var(--text-secondary)",fontSize:r.highlightedPlayer===a.value?14:13,fontWeight:r.highlightedPlayer===a.value?"bold":"italic",transform:`rotate(-45 ${t} ${c})`,children:a.value})}),e.jsx(Y,{label:{value:N(),angle:270,position:"left",offset:15,style:{textAnchor:"middle"}},tickFormatter:t=>m(t)}),e.jsx(J,{content:({active:t,payload:c})=>{if(t&&c&&c.length>0){const a=c[0].payload,u=a.isHighlightedAddition;return e.jsxs("div",{style:{background:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"8px",fontSize:"0.85rem"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"4px"},children:a.player}),e.jsxs("div",{children:["Parties jou√©es: ",a.gamesPlayed]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Par 60 minutes:"})}),e.jsxs("div",{children:["Total: ",m(a.secondsAllPer60Min)]}),e.jsxs("div",{children:["Hors meeting: ",m(a.secondsOutsidePer60Min)]}),e.jsxs("div",{children:["En meeting: ",m(a.secondsDuringPer60Min)]}),e.jsx("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--border-color)"},children:e.jsx("strong",{children:"Temps cumul√©s:"})}),e.jsxs("div",{children:["Total: ",m(a.totalSecondsAll)]}),e.jsxs("div",{children:["Hors meeting: ",m(a.totalSecondsOutside)]}),e.jsxs("div",{children:["En meeting: ",m(a.totalSecondsDuring)]}),u&&e.jsxs("div",{style:{marginTop:"4px",paddingTop:"4px",borderTop:"1px solid var(--accent-primary)",color:"var(--accent-primary)",fontStyle:"italic"},children:["üéØ Affich√© via s√©lection personnelle",a.gamesPlayed<s&&` (< ${s} parties)`]})]})}return null}}),e.jsx(K,{dataKey:t=>G(t),children:S.map((t,c)=>{const a=r.highlightedPlayer===t.player,u=M===t.player,p=t.isHighlightedAddition,f=A[t.player]||"var(--chart-primary)";return e.jsx(V,{fill:a?"var(--accent-primary)":p?"var(--accent-secondary)":f,stroke:a?"var(--accent-primary)":u?"#000000":"none",strokeWidth:a?3:u?2:0,strokeDasharray:p?"5,5":"none",opacity:p?.8:1,onClick:()=>x({selectedPlayer:t.player}),onMouseEnter:()=>T(t.player),onMouseLeave:()=>T(null),style:{cursor:"pointer"}},`cell-${c}`)})})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",S.length," des joueurs (sur ",O," ayant au moins ",s," partie",s>1?"s":"",")"]}),e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center",fontStyle:"italic",marginTop:"0.25rem"},children:["Temps normalis√© par 60 minutes de jeu ¬∑ Calcul√© sur ",n.gamesWithTalkingData," parties avec donn√©es"]})]})})]})}export{le as TalkingTimeChart};
