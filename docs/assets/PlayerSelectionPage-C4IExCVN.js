import{a as X,r as T,g as U,f as ce,u as J,j as e,c as de,m as ue}from"./index-Cfzfcorz.js";import{u as Q}from"./useJoueursData-Ckjpw8Va.js";import{u as te}from"./baseStatsHook-C4ktb9fY.js";import{g as pe}from"./gameUtils-CCGRmivF.js";import{a as re,g as ie,c as me}from"./datasyncExport-D6_8Fmuy.js";import{u as ee,g as he,a as ae,l as ne}from"./api-DTCaUVcf.js";import{d as ge}from"./durationFormatters-C9UyWcKX.js";import{F as L,C as E,X as V,Y as H,B as _,a as K,b as B}from"./FullscreenChart-DilW2pxG.js";import{R as q,T as z}from"./CategoricalChart-BiIkuSnD.js";import{L as fe,a as xe}from"./LineChart-D5rrWyGE.js";import{P as ve,a as ye}from"./PieChart-BTNyAzJG.js";import{u as je}from"./useDeathStatisticsFromRaw-CtAKiTqk.js";import{R as se}from"./ReferenceLine-3jXYpP97.js";import{g as Ce}from"./deathTypes-CGUOTngO.js";import"./ActivePoints-C8sg37gO.js";import"./PolarChart-lBaY8znj.js";function be(o){const{settings:y}=X(),{joueursData:C}=Q(),[x,w]=T.useState(null),[f,R]=T.useState(!1),[g,c]=T.useState(null);T.useEffect(()=>{let i=!0;return(async()=>{try{R(!0),c(null);const t=y.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",r=await fetch(t);if(!r.ok)throw new Error(`Failed to load achievements: ${r.status} ${r.statusText}`);const n=await r.json();i&&w(n)}catch(t){i&&c(t instanceof Error?t.message:"Failed to load achievements")}finally{i&&R(!1)}})(),()=>{i=!1}},[y.dataSource]);const d=(()=>{if(!o||!x)return null;const s=C?.Players?.find(t=>t.Joueur===o)?.SteamID;return s?x.achievements[s]||null:(console.warn(`âš ï¸ No Steam ID found for player: ${o}`),null)})();return T.useEffect(()=>{if(o&&x&&C){const s=C.Players?.find(r=>r.Joueur===o)?.SteamID;if(!s){console.log(`âŒ No Steam ID found for player: ${o}`);return}const t=x.achievements[s];t?console.log(`ðŸ† Achievements for ${o} [ID: ${s}] (${y.dataSource}):`,{allGames:t.allGamesAchievements.length,moddedOnly:t.moddedOnlyAchievements.length,categories:[...new Set([...t.allGamesAchievements.map(r=>r.category),...t.moddedOnlyAchievements.map(r=>r.category)])]}):console.log(`âŒ No achievements found for ${o} [ID: ${s}] in ${y.dataSource} data source`)}},[o,x,C,y.dataSource]),{data:d,isLoading:f,error:g,metadata:{generatedAt:x?.generatedAt||null,totalPlayers:x?.totalPlayers||0,totalGames:x?.totalGames||0,totalModdedGames:x?.totalModdedGames||0}}}function we(o,y,C){if(!o||o.trim()===""||y.length===0)return null;const x=[];let w=o;y.forEach(s=>{const t=s.PlayerStats.find(r=>U(r)===o||r.Username.toLowerCase()===o.toLowerCase());if(t){w=t.Username;const r=t.MainRoleInitial==="Louveteau"?t.MainRoleInitial:re(t.MainRoleInitial,t.MainRoleChanges||[]),n=ie(r);if(C&&C!=="Tous les camps"&&n!==C)return;const h=pe(s),l=t.Victorious,j=ce(new Date(s.StartDate)),b=me(s.StartDate,s.EndDate)||0;x.push({gameId:s.Id,date:j,camp:n,won:l,winnerCamp:h,playersInGame:s.PlayerStats.length,mapName:s.MapName,duration:b})}}),x.sort((s,t)=>{const r=n=>{const h=n.split("/");return h.length===3?new Date(parseInt(h[2]),parseInt(h[1])-1,parseInt(h[0])):new Date(n)};return r(t.date).getTime()-r(s.date).getTime()});const f=x.length,R=x.filter(s=>s.won).length,g=f>0?(R/f*100).toFixed(2):"0.00",c={};x.forEach(s=>{c[s.camp]||(c[s.camp]={appearances:0,wins:0,winRate:"0.00"}),c[s.camp].appearances++,s.won&&c[s.camp].wins++}),Object.keys(c).forEach(s=>{const t=c[s];t.winRate=t.appearances>0?(t.wins/t.appearances*100).toFixed(2):"0.00"});const d={};x.forEach(s=>{d[s.mapName]||(d[s.mapName]={appearances:0,wins:0,winRate:"0.00"}),d[s.mapName].appearances++,s.won&&d[s.mapName].wins++}),Object.keys(d).forEach(s=>{const t=d[s];t.winRate=t.appearances>0?(t.wins/t.appearances*100).toFixed(2):"0.00"});const i=x.reduce((s,t)=>s+t.duration,0);return{playerName:w,totalGames:f,totalWins:R,winRate:g,totalPlayTime:i,games:x,campStats:c,mapStats:d}}function Re(o){const y={};let C=0,x=0;return Object.entries(o).forEach(([w,f])=>{w==="Village"||w==="ChÃ¢teau"?y[w]={...f}:(C+=f.appearances,x+=f.wins)}),C>=10&&(y.Autres={appearances:C,wins:x,winRate:C>0?(x/C*100).toFixed(2):"0.00"}),y}function Z(o,y){const{data:C,isLoading:x,error:w}=te(f=>o?we(o,f,y):null);return{data:C,isLoading:x,error:w}}function Se({achievements:o,title:y,emptyMessage:C,achievementType:x="all"}){const{navigateToTab:w,updateNavigationState:f,clearNavigation:R}=J(),{settings:g,updateSettings:c}=X(),{joueursData:d}=Q(),i=ee(d),s=(a,S)=>{if(S.stopPropagation(),!a.redirectTo)return;R();const D=g.highlightedPlayer;if(c(x==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:D,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:D,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),a.category==="comparison"&&a.redirectTo.subTab==="comparison"){const m=g.highlightedPlayer||"",u=t(a.description,m);u&&f({playerComparisonState:{selectedPlayer1:m,selectedPlayer2:u,showDetailedStats:!0}})}if(a.category==="comparison"&&a.redirectTo.subTab==="pairing"){const m=a.description.toLowerCase().includes("loup");f({selectedPairingTab:m?"wolves":"lovers"})}if(a.category==="kills"&&a.redirectTo.subTab==="deathStats"){const m=a.description.match(/(Villageois|Loups|Autres)/i);m&&f({deathStatsSelectedCamp:m[1]});let u=10;const v=a.description.match(/min\.\s*(\d+)/);v&&(u=parseInt(v[1],10));let k="totalKills",A="killers";const P=a.redirectTo.chartSection;P&&(P==="killers-total"?(k="totalKills",A="killers"):P==="killers-average"?(k="averageKills",A="killers"):P==="deaths-total"?(k="totalDeaths",A="deaths"):P==="survivors-average"?(k="survivalRate",A="deaths"):(P==="hunters-good"||P==="hunters-bad")&&(A="hunter",k="averageKills")),f({deathStatisticsState:{selectedCamp:m?.[1]||"Tous les camps",minGamesForAverage:u,selectedView:A,focusChart:k}})}if(a.category==="map"&&a.redirectTo.subTab==="playersGeneral"){const m=a.redirectTo.mapFilter||"all";let u=10;const v=a.description.match(/min\.\s*(\d+)/);v&&(u=parseInt(v[1])),c(x==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:m,playerFilter:{mode:"none",players:[]},highlightedPlayer:D,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:m,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:m,playerFilter:{mode:"none",players:[]},highlightedPlayer:D,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:m,playerFilter:{mode:"none",players:[]}}}),f({playersGeneralState:{minGamesForWinRate:u,winRateOrder:"best",focusChart:"winRate"}}),w("players","playersGeneral");return}if(a.category==="history"&&a.redirectTo.subTab==="history"&&f({selectedPlayerName:g.highlightedPlayer||"",groupingMethod:"session"}),a.category==="series"&&a.redirectTo.subTab==="series"){let m="wins";const u=a.title.toLowerCase(),v=a.description.toLowerCase();u.includes("dÃ©faite")||v.includes("dÃ©faite")?m="losses":u.includes("loup")||v.includes("loup")?m="loup":u.includes("villageois")||v.includes("villageois")?m="villageois":(u.includes("victoire")||v.includes("victoire"))&&(m="wins"),f({selectedSeriesType:m})}if(a.category==="general"&&a.redirectTo.subTab==="playersGeneral"){let m=10;const u=a.description.match(/min\.\s*(\d+)/);u&&(m=parseInt(u[1],10));let v="winRate",k="best";const A=a.title.toLowerCase(),P=a.description.toLowerCase();A.includes("participation")||P.includes("participation")?v="participation":(A.includes("taux de victoire")||P.includes("taux de victoire"))&&(v="winRate",(A.includes("moins bon")||A.includes("mauvais")||P.includes("moins bon")||P.includes("mauvais"))&&(k="worst")),f({playersGeneralState:{minGamesForWinRate:m,winRateOrder:k,focusChart:v}})}if(a.category==="performance"&&a.redirectTo.subTab==="campPerformance"){const m=a.redirectTo.chartSection;let u="Villageois",v=1;m&&(m==="camp-loup"?u="Loup":m==="camp-villageois"?u="Villageois":m==="camp-idiot"?u="Idiot du Village":m==="camp-amoureux"?u="Amoureux":(m==="solo-roles"||m==="hall-of-fame")&&(u="Villageois"));const k=a.description.match(/min\.\s*(\d+)/);k&&(v=parseInt(k[1],10)),m==="solo-roles"?u="RÃ´les spÃ©ciaux":m==="hall-of-fame"&&(u="Tous les camps"),f({campPerformanceState:{selectedCampPerformanceCamp:u,selectedCampPerformanceMinGames:v}})}if(a.category==="voting"&&a.redirectTo.subTab==="votingStats"){const m=a.title.toLowerCase();let u="overview",v="behavior";m.includes("agressivitÃ©")?(u="overview",v="behavior"):m.includes("taux de vote")?(u="behavior",v="voteRate"):m.includes("prÃ©cision")&&(u="overview",v="accuracy"),f({votingStatsState:{selectedCategory:u,selectedView:v}})}w(a.redirectTo.tab,a.redirectTo.subTab)},t=(a,S)=>{const D=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const m of D){const u=a.match(m);if(u&&u[1]){const v=u[1].trim();if(v!==S)return v}}return null},r=a=>{if(!a.redirectTo)return"Aucune navigation disponible";switch(a.category){case"general":if(a.redirectTo.subTab==="playersGeneral"){const m=a.description.match(/min\.\s*(\d+)/),u=m?parseInt(m[1],10):10,v=a.title.toLowerCase(),k=x==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return v.includes("taux de victoire")?`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${u} parties)${k}`:v.includes("participation")?`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir les participations${k}`:`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${k}`}break;case"map":if(a.redirectTo.subTab==="playersGeneral"){const m=a.redirectTo.mapFilter,u=m==="village"?"Village":m==="chateau"?"ChÃ¢teau":"map",v=x==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${u}${v}`}break;case"history":if(a.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(a.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${t(a.description,g.highlightedPlayer||"")||"ce joueur"}`;if(a.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(a.redirectTo.subTab==="deathStats"){const m=a.description.match(/(Villageois|Loups|Autres)/i),u=a.description.match(/min\.\s*(\d+)/),v=u?parseInt(u[1],10):10,k=m?.[1]||"Tous les camps",A=a.redirectTo.chartSection;let P="kills et morts";return A==="killers-total"?P="total des kills":A==="killers-average"?P=`moyenne des kills (min. ${v} parties)`:A==="deaths-total"?P="total des morts":A==="survivors-average"&&(P=`taux de survie (min. ${v} parties)`),`Cliquez pour voir les statistiques de ${P} ${k!=="Tous les camps"?`en ${k}`:""}`}break;case"series":if(a.redirectTo.subTab==="series"){const m=a.title.toLowerCase(),u=a.description.toLowerCase();return m.includes("dÃ©faite")||u.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":m.includes("loup")||u.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":m.includes("villageois")||u.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":m.includes("victoire")||u.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(a.redirectTo.subTab==="campPerformance"){const m=a.redirectTo.chartSection,u=x==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return m==="camp-loup"?`Cliquez pour voir les performances camp Loup${u}`:m==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${u}`:m==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${u}`:m==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${u}`:m==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${u}`:m==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${u}`:`Cliquez pour voir les performances par camp${u}`}break;case"voting":if(a.redirectTo.subTab==="votingStats"){const m=a.description.match(/min\.\s*(\d+)/),u=m?parseInt(m[1],10):25,v=x==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",k=a.title.toLowerCase();return k.includes("agressivitÃ©")?`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${u} meetings)${v}`:k.includes("taux de vote")?`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${u} meetings)${v}`:k.includes("prÃ©cision")?`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${v}`:`Classement: ${a.rank}${a.totalRanked?`/${a.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${v}`}break}return`Cliquez pour voir ${a.redirectTo.subTab}`+(x==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},n=a=>i[a]||he(a),h=a=>{const S=[/avec ([^:]+?):/,/contre ([^:]+?):/];let D=a;return S.forEach(m=>{const u=a.match(m);if(u&&u[1]){const v=u[1].trim(),A=`<span class="player-name-highlight" style="color: ${n(v)};">${v}</span>`;D=D.replace(v,A)}}),D};if(o.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:y}),e.jsx("p",{children:C||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const l=a=>a===1?"ðŸ¥‡":a===2?"ðŸ¥ˆ":a===3?"ðŸ¥‰":"",j=a=>a===1?"rank-1":a===2?"rank-2":a===3?"rank-3":a&&a<=10?"rank-top-10":"",b=o.filter(a=>a.category!=="comparison"&&(a.type==="good"||a.type==="neutral")).sort((a,S)=>(a.rank??999)-(S.rank??999)),F=o.filter(a=>a.category!=="comparison"&&a.type==="bad").sort((a,S)=>(a.rank??999)-(S.rank??999)),N=o.filter(a=>a.category==="comparison"),W=b.filter(a=>a.rank&&a.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:y}),W>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:b.filter(a=>a.rank&&a.rank<=3).map((a,S)=>e.jsxs("div",{className:`top3-card ${j(a.rank)} animate-slide-in`,style:{animationDelay:`${S*.15}s`},onClick:D=>s(a,D),title:r(a),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:l(a.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",a.rank,a.totalRanked?`/${a.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:a.title}),e.jsx("p",{className:"top3-achievement-description",children:a.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},a.id))})]}),b.length>0&&e.jsxs("div",{className:"achievements-section good-achievements",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:b.filter(a=>!a.rank||a.rank>3).map((a,S)=>e.jsxs("div",{className:`achievement-card good ${j(a.rank)}`,onClick:D=>s(a,D),title:r(a),style:{animationDelay:`${S*.05}s`},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:a.title}),e.jsxs("span",{className:"achievement-rank",children:["#",a.rank,a.totalRanked?`/${a.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:a.description})]},a.id))})]}),F.length>0&&e.jsxs("div",{className:"achievements-section bad-achievements",children:[e.jsx("h5",{children:"ðŸ’€ Classements (InversÃ©s)"}),e.jsx("div",{className:"achievements-grid",children:F.map(a=>e.jsxs("div",{className:`achievement-card bad rank-${a.rank}`,onClick:S=>s(a,S),title:r(a),children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:a.title}),e.jsxs("span",{className:"achievement-rank",children:["#",a.rank,a.totalRanked?`/${a.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:a.description})]},a.id))})]}),N.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:N.map(a=>e.jsxs("div",{className:"achievement-card comparison",onClick:S=>s(a,S),title:r(a),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:a.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:h(a.description)}})]},a.id))})]})]})}function ke({selectedPlayerName:o,groupingMethod:y,campFilter:C="all"}){const{navigateToGameDetails:x}=J(),{data:w,isLoading:f,error:R}=Z(o),g=T.useMemo(()=>{switch(y){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[y]),c=T.useMemo(()=>{if(!w?.games)return new Map;const t=new Map;return w.games.forEach(r=>{if(!t.has(r.date)){const n=r.date.split("/");n.length===3?t.set(r.date,new Date(parseInt(n[2]),parseInt(n[1])-1,parseInt(n[0])).getTime()):t.set(r.date,new Date(r.date).getTime())}}),t},[w?.games]),d=T.useMemo(()=>{if(!w?.games)return[];const t={};return w.games.forEach(r=>{if(C!=="all"){if(C==="solo"){if(r.camp==="Villageois"||r.camp==="Loup")return}else if(r.camp!==C)return}let n;const h=r.date.split("/");if(y==="month")if(h.length===3)n=`${h[1].padStart(2,"0")}/${h[2]}`;else{const l=new Date(r.date);n=`${String(l.getMonth()+1).padStart(2,"0")}/${l.getFullYear()}`}else if(y==="quarter")if(h.length===3){const l=parseInt(h[1],10);n=`T${Math.floor((l-1)/3)+1}/${h[2]}`}else{const l=new Date(r.date);n=`T${Math.floor(l.getMonth()/3)+1}/${l.getFullYear()}`}else y==="year"?h.length===3?n=`${h[2]}`:n=`${new Date(r.date).getFullYear()}`:n=r.date;t[n]||(t[n]={games:[],wins:0,total:0}),t[n].games.push(r),t[n].total++,r.won&&t[n].wins++}),Object.entries(t).map(([r,n])=>({period:r,totalGames:n.total,victories:n.wins,defeats:n.total-n.wins,winRate:n.total>0?(n.wins/n.total*100).toFixed(1):"0.0",winRateNum:n.total>0?n.wins/n.total*100:0})).sort((r,n)=>{if(y==="month"){const[h,l]=r.period.split("/"),[j,b]=n.period.split("/"),F=new Date(parseInt(l),parseInt(h)-1,1),N=new Date(parseInt(b),parseInt(j)-1,1);return F.getTime()-N.getTime()}else if(y==="quarter"){const[h,l]=r.period.split("/"),[j,b]=n.period.split("/"),F=parseInt(h.replace(/\D/g,""),10)||1,N=parseInt(j.replace(/\D/g,""),10)||1,W=new Date(parseInt(l,10),(F-1)*3,1),a=new Date(parseInt(b,10),(N-1)*3,1);return W.getTime()-a.getTime()}else if(y==="year"){const h=parseInt(r.period,10),l=parseInt(n.period,10);return h-l}else{const h=c.get(r.period)||0,l=c.get(n.period)||0;return h-l}})},[w,y,c,C]),s=(t=>t<=15?{fontSize:12,angle:-45,height:80,interval:0}:t<=30?{fontSize:12,angle:-45,height:85,interval:1}:t<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(t/12)})(d.length);return f?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):R?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",R]}):w?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",g]}),e.jsx(L,{title:`Ã‰volution des Performances ${g}`,children:e.jsx("div",{style:{height:400},children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(fe,{data:d,margin:{top:20,right:30,left:20,bottom:20},onClick:t=>{if(t&&t.activeLabel){const r=d.find(n=>n.period===t.activeLabel);r&&x({selectedPlayer:o,selectedDate:r.period,fromComponent:`Ã‰volution des Performances ${g}`})}},style:{cursor:"pointer"},children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(V,{dataKey:"period",angle:s.angle,textAnchor:"end",height:s.height,interval:s.interval,fontSize:s.fontSize}),e.jsx(H,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(z,{content:({active:t,payload:r})=>{if(t&&r&&r.length>0){const n=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.period})}),e.jsxs("div",{children:["Parties: ",n.totalGames]}),e.jsxs("div",{children:["Victoires: ",n.victories]}),e.jsxs("div",{children:["Taux: ",n.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(xe,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",g]}),e.jsx(L,{title:`RÃ©partition Victoires/DÃ©faites ${g}`,children:e.jsx("div",{style:{height:400},children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(_,{data:d,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(V,{dataKey:"period",angle:s.angle,textAnchor:"end",height:s.height,interval:s.interval,fontSize:s.fontSize}),e.jsx(H,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(z,{content:({active:t,payload:r})=>{if(t&&r&&r.length>0){const n=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.period})}),e.jsxs("div",{children:["Total: ",n.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",n.victories]}),e.jsxs("div",{children:["DÃ©faites: ",n.defeats]}),e.jsxs("div",{children:["Taux: ",n.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(K,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:d.map((t,r)=>e.jsx(B,{fill:"var(--accent-tertiary)",onClick:()=>{x({selectedPlayer:o,selectedDate:t.period,fromComponent:`Historique Joueur - Victoires ${g}`})},style:{cursor:"pointer"}},`cell-victories-${r}`))}),e.jsx(K,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:d.map((t,r)=>e.jsx(B,{fill:"var(--chart-color-4)",onClick:()=>{x({selectedPlayer:o,selectedDate:t.period,fromComponent:`Historique Joueur - DÃ©faites ${g}`})},style:{cursor:"pointer"}},`cell-defeats-${r}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function Ne({selectedPlayerName:o}){const{navigateToGameDetails:y}=J(),{data:C,isLoading:x,error:w}=Z(o),f=ae(),R=T.useMemo(()=>C?.campStats?Object.entries(C.campStats).map(([c,d])=>({name:c,value:d.appearances,winRate:d.winRate,winRateDisplay:Math.max(parseFloat(d.winRate),1),wins:d.wins,percentage:(d.appearances/C.totalGames*100).toFixed(1)})):[],[C]),g=T.useMemo(()=>{if(!R.length)return[];const c=5;let d=0;const i=[],s=[];if(R.forEach(t=>{parseFloat(t.percentage)<c?(d+=Number(t.value),i.push(t)):s.push(t)}),d>0){const t=R.reduce((r,n)=>r+Number(n.value),0);s.push({name:"Autres",value:d,winRate:"0.0",winRateDisplay:1,wins:i.reduce((r,n)=>r+n.wins,0),percentage:(d/t*100).toFixed(1),_details:i})}return s},[R]);return x?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):w?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",w]}):C?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(ve,{children:[e.jsx(ye,{data:g,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:c=>{const d=c.percent!==void 0?c.percent:0;return c.name==="Autres"?`Autres : ${c.value} (${(d*100).toFixed(1)}%)`:`${c.name}: ${c.value} (${(d*100).toFixed(1)}%)`},children:g.map((c,d)=>e.jsx(B,{fill:c.name==="Autres"?ne:f[c.name]||`var(--chart-color-${d%6+1})`,onClick:()=>{if(c.name==="Autres"){const i=c._details?.map(s=>s.name)||[];y({selectedPlayer:o,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:i},fromComponent:"Distribution par Camps"})}else c.name==="TraÃ®tre"||c.name==="Louveteau"?y({selectedPlayer:o,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):c.name==="Loup"?y({selectedPlayer:o,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):y({selectedPlayer:o,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${d}`))}),e.jsx(z,{content:({active:c,payload:d})=>{if(c&&d&&d.length>0){const i=d[0].payload;if(i.name==="Autres"&&i._details){const s=[...i._details].sort((t,r)=>r.value-t.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",i.value," parties (",i.percentage,"%)"]})}),e.jsx("div",{children:s.map((t,r)=>e.jsxs("div",{children:[t.name,": ",t.value," parties (",t.percentage,"%)"]},r))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[i.name," - ",i.value," parties (",i.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(L,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(_,{data:R,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(V,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(z,{content:({active:c,payload:d})=>{if(c&&d&&d.length>0){const i=d[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:i.name})}),e.jsxs("div",{children:["Victoires: ",i.wins," / ",i.value]}),e.jsxs("div",{children:["Taux: ",i.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(K,{dataKey:"winRateDisplay",children:R.map((c,d)=>e.jsx(B,{fill:parseFloat(c.winRate)===0?`${f[c.name]||`var(--chart-color-${d%6+1})`}50`:f[c.name]||`var(--chart-color-${d%6+1})`,onClick:()=>{c.name==="TraÃ®tre"||c.name==="Louveteau"?y({selectedPlayer:o,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):c.name==="Loup"?y({selectedPlayer:o,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):y({selectedPlayer:o,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${d}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function Te({selectedPlayerName:o}){const{navigateToGameDetails:y,navigationState:C,updateNavigationState:x}=J(),[w,f]=T.useState(C.playerHistoryMapState?.selectedCamp||"Tous les camps"),{data:R}=je(),{data:g,isLoading:c,error:d}=Z(o,w);T.useEffect(()=>{(!C.playerHistoryMapState||C.playerHistoryMapState.selectedCamp!==w)&&x({playerHistoryMapState:{selectedCamp:w}})},[w,C.playerHistoryMapState,x]);const i=t=>{f(t),x({playerHistoryMapState:{selectedCamp:t}})},s=T.useMemo(()=>{if(!g?.mapStats)return[];const t=Re(g.mapStats);return Object.entries(t).map(([r,n])=>({name:r,value:n.appearances,winRate:n.winRate,winRateDisplay:Math.max(parseFloat(n.winRate),.1),wins:n.wins,percentage:(n.appearances/g.totalGames*100).toFixed(1)}))},[g]);return c?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):d?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",d]}):g?s.length===0?e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de carte disponible"}),e.jsx("p",{children:"Aucune statistique de carte n'est disponible pour ce joueur."})]}):e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Performance par Carte",w!=="Tous les camps"?` (${w})`:""]}),e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select-map",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select-map",value:w,onChange:t=>i(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),R?.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx(L,{title:"Performance par Carte",children:e.jsx("div",{style:{height:400},children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(_,{data:s,margin:{top:20,right:140,left:20,bottom:20},children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(V,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(se,{y:50,stroke:"var(--text-secondary)",strokeDasharray:"5 5",strokeOpacity:.5}),(()=>{if(s.length>0){const t=s.reduce((h,l)=>h+l.value,0),r=s.reduce((h,l)=>h+l.wins,0),n=t>0?r/t*100:0;if(n!==50)return e.jsx(se,{y:n,stroke:"var(--accent-primary)",strokeDasharray:"3 3",strokeOpacity:.7,label:{value:`Moyenne: ${n.toFixed(1)}%`,position:"right",offset:5,style:{fill:"var(--accent-primary)"}}})}return null})(),e.jsx(z,{content:({active:t,payload:r})=>{if(t&&r&&r.length>0){const n=r[0].payload,h=[];return s.forEach(l=>{if(l.name!==n.name&&l.value>=5){const j=parseFloat(n.winRate)-parseFloat(l.winRate);Math.abs(j)>=2&&h.push({map:l.name,diff:j,better:j>0})}}),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:"250px"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.name})}),e.jsxs("div",{children:["Parties: ",n.value]}),e.jsxs("div",{children:["Victoires: ",n.wins]}),e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("strong",{children:["Taux: ",n.winRate,"%"]})}),h.length>0&&e.jsxs("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"0.8rem",fontWeight:"bold",marginBottom:"0.25rem"},children:"Comparaisons:"}),h.map((l,j)=>e.jsxs("div",{style:{fontSize:"0.75rem",color:l.better?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[l.better?"â†—":"â†˜"," ",Math.abs(l.diff).toFixed(1),"% vs ",l.map]},j))]}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(K,{dataKey:"winRateDisplay",label:t=>{const{x:r,y:n,width:h,payload:l}=t;if(r===void 0||n===void 0||h===void 0||!l)return null;const j=l.winRate||"0";return e.jsxs("text",{x:r+h/2,y:n-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[j,"%"]})},onClick:t=>{if(t&&t.name){const r={selectedPlayer:o,selectedMapName:t.name,fromComponent:"Performance par Carte"};w!=="Tous les camps"&&(r.campFilter={selectedCamp:w,campFilterMode:"all-assignments"}),y(r)}},children:s.map((t,r)=>{let n;t.name==="Village"?n="var(--accent-secondary)":t.name==="ChÃ¢teau"?n="var(--accent-tertiary)":t.name==="Autres"?n=ne:n=`var(--chart-color-${r%6+1})`;const h=Math.max(...s.map(j=>parseFloat(j.winRate))),l=parseFloat(t.winRate)===h&&h>0;return e.jsx(B,{fill:parseFloat(t.winRate)===0?`${n}30`:n,stroke:"transparent",strokeWidth:l?3:1,style:{cursor:"pointer"}},`cell-map-${r}`)})})]})})})})]})}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function Fe({selectedPlayerName:o}){const{gameData:y}=de(),{joueursData:C}=Q(),x=ee(C),w=ae(),f=T.useMemo(()=>{if(!y||!o)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const g={},c={},d={},i=new Set;y.forEach(h=>{const l=h.PlayerStats.find(j=>j.Username.toLowerCase()===o.toLowerCase());if(l&&(h.PlayerStats.forEach(j=>{j.KillerName?.toLowerCase()===o.toLowerCase()&&(g[j.Username]=(g[j.Username]||0)+1)}),l.KillerName&&(c[l.KillerName]=(c[l.KillerName]||0)+1),l.DeathType)){const j=l.DeathType,b=Ce(j);d[b]||(d[b]={count:0,byDeathType:{}}),d[b].count+=1,d[b].byDeathType[j]=(d[b].byDeathType[j]||0)+1,i.add(j)}});const s=Object.entries(g).map(([h,l])=>({player:h,kills:l})).sort((h,l)=>l.kills-h.kills).slice(0,10),t=Object.entries(c).map(([h,l])=>({player:h,kills:l})).sort((h,l)=>l.kills-h.kills).slice(0,10),r=Object.entries(d).map(([h,l])=>{const j={deathType:h,count:l.count};return j[h]=l.count,j}).sort((h,l)=>l.count-h.count).slice(0,10),n=Object.keys(d);return{playersKilled:s,killedBy:t,deathTypes:r,availableDeathTypes:n}},[y,o]),R=T.useMemo(()=>{const g={};f.availableDeathTypes.forEach(i=>{i==="TuÃ© par Loup"?g[i]=w.Loup:i==="Mort aux votes"?g[i]="var(--chart-color-1)":i.includes("Chasseur")?g[i]=w.Chasseur:i==="TuÃ© par Zombie"?g[i]=w.Vaudou:i==="TuÃ© par potion assassin"?g[i]=w.Alchimiste:i==="TuÃ© par Vengeur"?g[i]="var(--chart-color-2)":i==="Amoureux mort"?g[i]=w.Amoureux:i==="TuÃ© par La BÃªte"?g[i]="var(--chart-color-3)":i==="TuÃ© par ShÃ©rif"&&(g[i]="var(--chart-color-4)")});const c=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let d=0;return f.availableDeathTypes.forEach(i=>{g[i]||(g[i]=c[d%c.length],d++)}),g},[f.availableDeathTypes,w]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[f.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(L,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(_,{data:f.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(V,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(z,{content:({active:g,payload:c})=>{if(g&&c&&c.length>0){const d=c[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:d.player})}),e.jsxs("div",{children:["TuÃ© ",d.kills," fois par ",o]})]})}return null}}),e.jsx(K,{dataKey:"kills",children:f.playersKilled.map((g,c)=>e.jsx(B,{fill:x[g.player]||"var(--chart-color-3)"},`cell-killed-${c}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[o," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),f.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(L,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(_,{data:f.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(V,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(z,{content:({active:g,payload:c})=>{if(g&&c&&c.length>0){const d=c[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:d.player})}),e.jsxs("div",{children:["A tuÃ© ",o," ",d.kills," fois"]})]})}return null}}),e.jsx(K,{dataKey:"kills",children:f.killedBy.map((g,c)=>e.jsx(B,{fill:x[g.player]||"var(--chart-color-4)"},`cell-killer-${c}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[o," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),f.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(L,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(_,{data:f.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(V,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(H,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(z,{content:({active:g,payload:c})=>{if(g&&c&&c.length>0){const d=c[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:d.deathType})}),e.jsxs("div",{children:[o," est mort ",d.count," fois ainsi"]})]})}return null}}),f.availableDeathTypes.map(g=>e.jsx(K,{dataKey:g,name:g,stackId:"deaths",fill:R[g]||"var(--chart-color-5)"},g))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",o,"."]})]})]})}function Pe(o,y){if(!o||o.trim()===""||y.length===0)return null;const C=new Map,x=new Map,w=new Map;y.forEach(d=>{if(!d.Modded||d.LegacyData&&d.LegacyData.deathInformationFilled!==!0)return;const i=d.PlayerStats.find(s=>U(s)===o||s.Username.toLowerCase()===o.toLowerCase());if(i){if(i.MainRoleInitial==="Inconnu")return;const s=i.Victorious,r=re(i.MainRoleInitial,i.MainRoleChanges||[])!==i.MainRoleInitial,n=ie(i.MainRoleInitial),h=n==="Loup"||n==="TraÃ®tre"||n==="Louveteau";if(n==="Villageois"&&(i.MainRoleInitial==="Chasseur"||i.MainRoleInitial==="Alchimiste")){const l=C.get(i.MainRoleInitial)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};C.set(i.MainRoleInitial,{appearances:l.appearances+1,wins:l.wins+(s?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!r&&s?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(r?0:1)})}else if(i.Power&&i.Power.trim()!==""&&i.Power!=="Inconnu"){if(n==="Villageois"){const l=C.get(i.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};C.set(i.Power,{appearances:l.appearances+1,wins:l.wins+(s?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!r&&s?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(r?0:1)})}else if(h){const l=x.get(i.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},j=l.roleBreakdown;j.set(i.MainRoleInitial,(j.get(i.MainRoleInitial)||0)+1),x.set(i.Power,{appearances:l.appearances+1,wins:l.wins+(s?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!r&&s?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(r?0:1),roleBreakdown:j})}}else if((n==="Villageois"||h)&&i.Power!=="Inconnu")if(n==="Villageois"){const l=C.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};C.set("Aucun pouvoir",{appearances:l.appearances+1,wins:l.wins+(s?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!r&&s?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(r?0:1)})}else{const l=x.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},j=l.roleBreakdown;j.set(i.MainRoleInitial,(j.get(i.MainRoleInitial)||0)+1),x.set("Aucun pouvoir",{appearances:l.appearances+1,wins:l.wins+(s?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!r&&s?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(r?0:1),roleBreakdown:j})}if(i.SecondaryRole&&i.SecondaryRole.trim()!==""&&i.SecondaryRole!=="Inconnu"){const l=w.get(i.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};w.set(i.SecondaryRole,{appearances:l.appearances+1,wins:l.wins+(s?1:0),winsWithoutRoleChange:l.winsWithoutRoleChange+(!r&&s?1:0),gamesWithoutRoleChange:l.gamesWithoutRoleChange+(r?0:1)})}}});const f=new Map;y.forEach(d=>{if(d.LegacyData&&d.LegacyData.deathInformationFilled!==!0)return;const i=d.PlayerStats.find(s=>U(s)===o||s.Username.toLowerCase()===o.toLowerCase());if(i&&(i.MainRoleInitial==="Chasseur"||i.MainRoleInitial==="Alchimiste")){const s=i.MainRoleInitial;f.set(s,(f.get(s)||0)+1)}});const R=d=>Array.from(d.entries()).map(([i,s])=>({name:i,appearances:s.appearances,wins:s.wins,winsWithoutRoleChange:s.winsWithoutRoleChange,gamesWithoutRoleChange:s.gamesWithoutRoleChange,winRate:s.gamesWithoutRoleChange>0?(s.winsWithoutRoleChange/s.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...f.has(i)&&{totalGamesAllModes:f.get(i)}})).sort((i,s)=>s.appearances-i.appearances),g=d=>Array.from(d.entries()).map(([i,s])=>({name:i,appearances:s.appearances,wins:s.wins,winsWithoutRoleChange:s.winsWithoutRoleChange,gamesWithoutRoleChange:s.gamesWithoutRoleChange,winRate:s.gamesWithoutRoleChange>0?(s.winsWithoutRoleChange/s.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(s.roleBreakdown.entries()).map(([t,r])=>({role:t,count:r})).sort((t,r)=>r.count-t.count)})).sort((i,s)=>s.appearances-i.appearances),c=d=>Array.from(d.entries()).map(([i,s])=>({name:i,appearances:s.appearances,wins:s.wins,winsWithoutRoleChange:s.winsWithoutRoleChange,gamesWithoutRoleChange:s.gamesWithoutRoleChange,winRate:s.gamesWithoutRoleChange>0?(s.winsWithoutRoleChange/s.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((i,s)=>s.appearances-i.appearances);return{villageoisPowers:R(C),loupPowers:g(x),secondaryRoles:c(w)}}function Ae({selectedPlayerName:o}){const{navigateToGameDetails:y,navigationState:C,updateNavigationState:x}=J(),{settings:w}=X(),f=ae(),[R,g]=T.useState(C.playerHistoryRolesState?.chartMode||"appearances"),{data:c,isLoading:d,error:i}=te(b=>Pe(o,b));T.useEffect(()=>{(!C.playerHistoryRolesState||C.playerHistoryRolesState.chartMode!==R)&&x({playerHistoryRolesState:{chartMode:R}})},[R,C.playerHistoryRolesState,x]);const s=b=>{g(b),x({playerHistoryRolesState:{chartMode:b}})},t=T.useMemo(()=>{if(!c)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const b=1,F=1,N=15,W=R==="winRate"?(S,D)=>parseFloat(D.winRate)-parseFloat(S.winRate):(S,D)=>D.appearances-S.appearances,a=S=>({...S,winRateDisplay:Math.max(parseFloat(S.winRate),1)});return{villageoisPowers:c.villageoisPowers.filter(S=>S.appearances>=b).map(a).sort(W).slice(0,N),loupPowers:c.loupPowers.filter(S=>S.appearances>=b).map(a).sort(W).slice(0,N),secondaryRoles:c.secondaryRoles.filter(S=>S.appearances>=F).map(a).sort(W).slice(0,N)}},[c,R]);if(d)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(i)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",i]});if(!c)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const r=t.villageoisPowers.length>0,n=t.loupPowers.length>0,h=t.secondaryRoles.length>0;if(!r&&!n&&!h)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const l=({active:b,payload:F})=>{if(b&&F&&F.length>0){const N=F[0].payload,W=N.gamesWithoutRoleChange<N.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:N.name})}),e.jsxs("div",{children:["Apparitions: ",N.appearances]}),W&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",N.appearances-N.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",N.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",N.winRate,"%"]})}),N.totalGamesAllModes&&N.totalGamesAllModes!==N.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",N.totalGamesAllModes,")"]}),N.roleBreakdown&&N.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),N.roleBreakdown.map((a,S)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",a.role,": ",a.count]},S))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},j=(b,F,N,W,a)=>{const S=R==="appearances"?"appearances":"winRateDisplay",D=R==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",m=R==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:F}),e.jsx(L,{title:F,children:e.jsx("div",{style:{height:400},children:e.jsx(q,{width:"100%",height:"100%",children:e.jsxs(_,{data:b,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(V,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:12,tick:({x:u,y:v,payload:k})=>e.jsx("text",{x:u,y:v,textAnchor:"end",transform:`rotate(-45, ${u}, ${v})`,fill:w.highlightedPlayer===o?"var(--text-primary)":"var(--text-secondary)",fontSize:12,children:k.value})}),e.jsx(H,{label:{value:D,angle:270,position:"left",style:{textAnchor:"middle"}},domain:m}),e.jsx(z,{content:e.jsx(l,{})}),e.jsx(K,{dataKey:S,label:R==="winRate"?u=>{const{x:v,y:k,width:A,payload:P}=u;if(v===void 0||k===void 0||A===void 0||!P)return null;const p=P.winRate||"0";return e.jsxs("text",{x:v+A/2,y:k-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[p,"%"]})}:void 0,children:b.map((u,v)=>e.jsx(B,{fill:a?a(u.name,v):N,onClick:()=>W(u.name),style:{cursor:"pointer"}},`cell-${v}`))})]})})})})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:R,onChange:b=>s(b.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[r&&j(t.villageoisPowers,"Camp Villageois","var(--chart-color-1)",b=>{y({selectedPlayer:o,campFilter:{selectedCamp:"Villageois",campFilterMode:R==="winRate"?"wins-only":"all-assignments"},selectedPower:b,fromComponent:`Historique des RÃ´les - Pouvoir: ${b}`})},b=>b==="Chasseur"&&f.Chasseur?f.Chasseur:b==="Alchimiste"&&f.Alchimiste?f.Alchimiste:"var(--chart-color-1)"),n&&j(t.loupPowers,"Camp Loups","var(--chart-color-2)",b=>{y({selectedPlayer:o,campFilter:{selectedCamp:"Loup",campFilterMode:R==="winRate"?"wins-only":"all-assignments"},selectedPower:b,fromComponent:`Historique des RÃ´les - Pouvoir: ${b}`})},()=>f.Loup||"var(--chart-color-2)"),h&&j(t.secondaryRoles,"RÃ´les Secondaires","var(--chart-color-3)",b=>{y({selectedPlayer:o,selectedSecondaryRole:b,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${b}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}function Je(){const{settings:o,updateSettings:y}=X(),{navigateToGameDetails:C,navigationState:x,updateNavigationState:w}=J(),{data:f,isLoading:R,error:g}=ue(),{joueursData:c,isLoading:d}=Q(),{data:i,isLoading:s,error:t}=be(o.highlightedPlayer),r=ee(c),[n,h]=T.useState(""),[l,j]=T.useState(()=>o.useIndependentFilters&&o.independentFilters?.gameTypeEnabled?o.independentFilters.gameFilter==="modded"?"modded":"all":o.gameFilter==="modded"?"modded":"all"),b=T.useMemo(()=>o.useIndependentFilters&&o.independentFilters?.gameTypeEnabled?o.independentFilters.gameFilter==="modded":o.gameFilter==="modded",[o.useIndependentFilters,o.independentFilters?.gameTypeEnabled,o.independentFilters?.gameFilter,o.gameFilter]),[F,N]=T.useState(x.selectedPlayerSelectionView||"achievements"),[W,a]=T.useState("session"),[S,D]=T.useState("all");T.useEffect(()=>{if(o.useIndependentFilters&&o.independentFilters?.gameTypeEnabled){const p=o.independentFilters.gameFilter==="modded"?"modded":"all";j(p)}else if(!o.useIndependentFilters){const p=o.gameFilter==="modded"?"modded":"all";j(p)}},[o.gameFilter,o.useIndependentFilters,o.independentFilters?.gameTypeEnabled,o.independentFilters?.gameFilter]),T.useEffect(()=>{b&&l!=="modded"&&j("modded")},[b,l]),T.useEffect(()=>{x.selectedPlayerSelectionView&&N(x.selectedPlayerSelectionView)},[x.selectedPlayerSelectionView]);const{data:m}=Z(o.highlightedPlayer||""),u=T.useMemo(()=>{if(!f||!f.GameStats)return[];const p=b?f.GameStats.filter(O=>O.Modded===!0):f.GameStats,$=new Map;return p.forEach(O=>{const M=new Date(O.StartDate);O.PlayerStats.forEach(I=>{const G=U(I),le=c?.Players?.find(oe=>oe.SteamID===G)?.Joueur||I.Username;$.has(G)||$.set(G,{games:0,wins:0,firstDate:M,lastDate:M,displayName:le});const Y=$.get(G);Y.games++,I.Victorious&&Y.wins++,M<Y.firstDate&&(Y.firstDate=M),M>Y.lastDate&&(Y.lastDate=M)})}),Array.from($.entries()).map(([O,M])=>{let I=c?.Players?.find(G=>G.SteamID===O);return I||(I=c?.Players?.find(G=>G.Joueur===M.displayName)),{id:O,name:M.displayName,totalGames:M.games,totalWins:M.wins,winRate:M.games>0?M.wins/M.games*100:0,firstGameDate:M.firstDate.toLocaleDateString("fr-FR"),lastGameDate:M.lastDate.toLocaleDateString("fr-FR"),isHighlighted:M.displayName===o.highlightedPlayer,image:I?.Image||null,twitch:I?.Twitch||null,youtube:I?.Youtube||null}})},[f,o.highlightedPlayer,c,b]),v=T.useMemo(()=>{if(!n.trim())return u;const p=n.toLowerCase();return u.filter($=>$.name.toLowerCase().includes(p))},[u,n]),k=T.useMemo(()=>[...v].sort((p,$)=>$.totalGames-p.totalGames),[v]),A=p=>{y({highlightedPlayer:p}),h("")},P=p=>{N(p),w({selectedPlayerSelectionView:p})};return R||d?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):g?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",g]})]}):!f||u.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!o.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:n,onChange:p=>h(p.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[v.length," joueur",v.length!==1?"s":"",n&&` (filtrÃ©${v.length!==1?"s":""} de ${u.length})`]})]})]}),e.jsx("div",{className:"player-display",children:n?v.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{className:"clear-search-btn",onClick:()=>h(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:k.map(p=>e.jsxs("button",{className:`suggestion-btn ${p.isHighlighted?"highlighted":""}`,onClick:()=>A(p.name),children:[p.image?e.jsx("img",{src:p.image,alt:p.name,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":r[p.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[p.name,p.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[p.totalGames," parties â€¢ ",p.winRate.toFixed(1),"% victoires"]})]})]},p.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',n,'"']}),e.jsx("button",{className:"clear-search-btn",onClick:()=>h(""),children:"Effacer la recherche"})]}):o.highlightedPlayer?(()=>{const p=u.find($=>$.name===o.highlightedPlayer);return p?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:p.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[p.image?e.jsx("img",{src:p.image,alt:p.name,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":r[p.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[p.totalGames," parties â€¢ ",p.totalWins," victoires â€¢ ",p.winRate.toFixed(1),"% taux de victoire"]}),(p.twitch||p.youtube)&&e.jsxs("div",{className:"social-links",children:[p.twitch&&e.jsx("a",{href:p.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),p.youtube&&e.jsx("a",{href:p.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{className:`lycans-categorie-btn ${F==="achievements"?"active":""}`,onClick:()=>P("achievements"),children:"Classement"}),e.jsx("button",{className:`lycans-categorie-btn ${F==="evolution"?"active":""}`,onClick:()=>P("evolution"),children:"Ã‰volution"}),e.jsx("button",{className:`lycans-categorie-btn ${F==="camps"?"active":""}`,onClick:()=>P("camps"),children:"Camps"}),e.jsx("button",{className:`lycans-categorie-btn ${F==="roles"?"active":""}`,onClick:()=>P("roles"),children:"RÃ´les"}),e.jsx("button",{className:`lycans-categorie-btn ${F==="maps"?"active":""}`,onClick:()=>P("maps"),children:"Maps"}),e.jsx("button",{className:`lycans-categorie-btn ${F==="kills"?"active":""}`,onClick:()=>P("kills"),children:"Kills"})]}),F==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[s?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):t?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",t]})}):i?e.jsx(Se,{achievements:l==="all"?i.allGamesAchievements:i.moddedOnlyAchievements,title:l==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:l}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[!b&&e.jsx("button",{className:`filter-btn ${l==="all"?"active":""}`,onClick:$=>{$.stopPropagation(),j("all")},children:"Toutes les parties"}),e.jsx("button",{className:`filter-btn ${l==="modded"?"active":""}`,onClick:$=>{$.stopPropagation(),j("modded")},disabled:b,children:"Parties moddÃ©es"})]})]}),F==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[m&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{C({selectedPlayer:p.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${p.name}`,style:{fontSize:"1.3rem"},children:m.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem"},children:ge(m.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{C({selectedPlayer:p.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${p.name}`,style:{fontSize:"1.3rem"},children:m.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem"},children:[m.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:W,onChange:$=>a($.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:S,onChange:$=>D($.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(ke,{selectedPlayerName:p.name,groupingMethod:W,campFilter:S})]}),F==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Ne,{selectedPlayerName:p.name})}),F==="maps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Te,{selectedPlayerName:p.name})}),F==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Ae,{selectedPlayerName:p.name})}),F==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Fe,{selectedPlayerName:p.name})}),e.jsx("button",{className:"highlight-btn active",onClick:$=>{$.stopPropagation(),y({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[p.firstGameDate," - ",p.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',o.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{className:"clear-selection-btn",onClick:()=>y({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:k.map(p=>e.jsxs("div",{className:`character-card ${p.isHighlighted?"highlighted":""}`,onClick:()=>A(p.name),title:`${p.name} - ${p.totalGames} parties, ${p.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:p.image?e.jsx("img",{src:p.image,alt:p.name,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":r[p.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:p.name}),(p.twitch||p.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[p.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),p.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},p.id))})})})]})}export{Je as PlayerSelectionPage};
