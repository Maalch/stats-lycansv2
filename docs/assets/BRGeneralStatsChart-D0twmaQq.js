import{u as G,r as v,j as e}from"./index-CNPNIKLs.js";import{F as g,R as j,B as w,C as b,X as D,Y as P,T as f,o as y,p as S,q as K,x as $}from"./FullscreenChart-Ck9_lLWY.js";import{P as k,a as A}from"./PieChart-XmXxwUeI.js";import{L as V}from"./Legend-DcIFhPCm.js";function B(a){if(!a)return null;const[m,p,h]=a.split("/");return!m||!p||!h?null:new Date(Number(h),Number(p)-1,Number(m))}function F(a){const[m,p]=v.useState(null),[h,x]=v.useState(!0),[n,l]=v.useState(null);return v.useEffect(()=>{(async()=>{try{x(!0),l(null);const s=await fetch(`/stats-lycansv2/data/${a}.json`);if(!s.ok)throw new Error(`Failed to fetch ${a}`);const r=await s.json();p(r.data||[])}catch(s){console.error(`Error fetching raw ${a}:`,s),l(s instanceof Error?s.message:"Unknown error")}finally{x(!1)}})()},[a]),{data:m,isLoading:h,error:n}}function J(){const{settings:a}=G(),{data:m,isLoading:p,error:h}=F("rawBRData");return{data:m?.filter(n=>{if(!n.Game||!n.Participants)return!1;if(a.filterMode==="gameType"&&a.gameFilter!=="all"){if(a.gameFilter==="modded"){if(!n["Game Moddée"])return!1}else if(a.gameFilter==="non-modded"&&n["Game Moddée"])return!1}else if(a.filterMode==="dateRange"&&(a.dateRange.start||a.dateRange.end)){const l=B(n.Date);if(!l)return!1;if(a.dateRange.start){const u=new Date(a.dateRange.start);if(l<u)return!1}if(a.dateRange.end){const u=new Date(a.dateRange.end);if(l>u)return!1}}if(a.playerFilter.mode!=="none"&&a.playerFilter.players.length>0){const l=n.Participants.toLowerCase();if(a.playerFilter.mode==="include"){if(!a.playerFilter.players.some(s=>s.toLowerCase()===l))return!1}else if(a.playerFilter.mode==="exclude"&&a.playerFilter.players.some(s=>s.toLowerCase()===l))return!1}return!0})?.map(n=>({Game:n.Game,Participants:n.Participants,Score:n.Score,Gagnant:n.Gagnant}))||null,isLoading:p,error:h}}function I(){const{settings:a}=G(),{data:m,isLoading:p,error:h}=F("rawBRData");return{data:m?.reduce((n,l)=>{if(!l.Game2||!l.Date||n.find(s=>s.Game===l.Game2))return n;if(a.filterMode==="gameType"&&a.gameFilter!=="all"){if(a.gameFilter==="modded"){if(!l["Game Moddée"])return n}else if(a.gameFilter==="non-modded"&&l["Game Moddée"])return n}else if(a.filterMode==="dateRange"&&(a.dateRange.start||a.dateRange.end)){const s=B(l.Date);if(!s)return n;if(a.dateRange.start){const r=new Date(a.dateRange.start);if(s<r)return n}if(a.dateRange.end){const r=new Date(a.dateRange.end);if(s>r)return n}}return n.push({Game:l.Game2,"Nombre de participants":l["Nombre de participants"],Date:l.Date,VOD:l.VOD,"Game Moddée":l["Game Moddée"]}),n},[])||null,isLoading:p,error:h}}function U(){const{data:a,isLoading:m,error:p}=J(),{data:h,isLoading:x,error:n}=I(),l=["var(--chart-color-1)","var(--chart-color-2)","var(--chart-color-3)","var(--chart-color-4)","var(--chart-color-5)","var(--chart-color-6)"],u=r=>K[r]||$(r),s=v.useMemo(()=>{if(!a||!h)return null;const r=h.length,i=a.length,c=a.filter(t=>t.Gagnant).length,R=a.reduce((t,o)=>{const d=o.Participants;return t[d]||(t[d]={name:d,participations:0,wins:0,totalScore:0,averageScore:0,winRate:0}),t[d].participations++,t[d].totalScore+=o.Score,o.Gagnant&&t[d].wins++,t},{});Object.values(R).forEach(t=>{t.averageScore=t.totalScore/t.participations,t.winRate=t.wins/t.participations*100});const C=Object.values(R).sort((t,o)=>o.participations-t.participations).slice(0,10),L=Object.values(R).filter(t=>t.participations>=3).sort((t,o)=>o.winRate-t.winRate).slice(0,10),M=Object.values(R).filter(t=>t.participations>=3).sort((t,o)=>o.averageScore-t.averageScore).slice(0,10),O=a.reduce((t,o)=>{const d=o.Score,N=d===0?"0":d<=2?"1-2":d<=4?"3-4":d<=6?"5-6":"7+";return t[N]||(t[N]=0),t[N]++,t},{}),T=Object.entries(O).map(([t,o])=>({range:t,count:o,percentage:(o/i*100).toFixed(1)})),E=h.reduce((t,o)=>{const d=o["Nombre de participants"];return t[d]||(t[d]=0),t[d]++,t},{}),q=Object.entries(E).map(([t,o])=>({participants:parseInt(t),games:o,percentage:(o/r*100).toFixed(1)})).sort((t,o)=>t.participants-o.participants);return{totalGames:r,totalParticipations:i,totalWins:c,winRate:(c/i*100).toFixed(1),averageParticipantsPerGame:(i/r).toFixed(1),topPlayersByParticipations:C,topPlayersByWins:L,topPlayersByAverageScore:M,scoreData:T,participantData:q}},[a,h]);return m||x?e.jsx("div",{className:"statistiques-chargement",children:"Chargement des données Battle Royale..."}):p||n?e.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",p||n]}):s?e.jsxs("div",{className:"lycans-chart-container",children:[e.jsx("div",{className:"lycans-chart-header",children:e.jsx("h2",{children:"Statistiques Battle Royale"})}),e.jsxs("div",{className:"lycans-stats-grid",children:[e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Parties totales"}),e.jsx("div",{className:"lycans-stat-value",children:s.totalGames})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Participations"}),e.jsx("div",{className:"lycans-stat-value",children:s.totalParticipations})]}),e.jsxs("div",{className:"lycans-stat-card",children:[e.jsx("h3",{children:"Moy. participants/partie"}),e.jsx("div",{className:"lycans-stat-value",children:s.averageParticipantsPerGame})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Participations"}),e.jsx(g,{title:"Top Joueurs par Participations - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(j,{width:"100%",height:400,children:e.jsxs(w,{data:s.topPlayersByParticipations,children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(D,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(P,{}),e.jsx(f,{content:({active:r,payload:i})=>{if(r&&i&&i.length>0){const c=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:c.name})}),e.jsxs("div",{children:["Participations : ",c.participations]}),e.jsxs("div",{children:["Victoires : ",c.wins]})]})}return null}}),e.jsx(y,{dataKey:"participations",name:"Participations",children:s.topPlayersByParticipations.map((r,i)=>e.jsx(S,{fill:u(r.name)},`cell-${i}`))}),e.jsx(y,{dataKey:"wins",fill:"var(--chart-color-2)",name:"Victoires"})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Taux de Victoire (min. 3 parties)"}),e.jsx(g,{title:"Top Joueurs par Taux de Victoire - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(j,{width:"100%",height:400,children:e.jsxs(w,{data:s.topPlayersByWins,children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(D,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(P,{}),e.jsx(f,{content:({active:r,payload:i})=>{if(r&&i&&i.length>0){const c=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:c.name})}),e.jsxs("div",{children:["Taux de victoire : ",c.winRate.toFixed(2),"%"]}),e.jsxs("div",{children:["Victoires : ",c.wins," / ",c.participations]})]})}return null}}),e.jsx(y,{dataKey:"winRate",name:"Taux de victoire (%)",children:s.topPlayersByWins.map((r,i)=>e.jsx(S,{fill:u(r.name)},`cell-${i}`))})]})})})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Top Joueurs - Score Moyen par Partie (min. 3 parties)"}),e.jsx(g,{title:"Top Joueurs par Score Moyen - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(j,{width:"100%",height:400,children:e.jsxs(w,{data:s.topPlayersByAverageScore,children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(D,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),e.jsx(P,{}),e.jsx(f,{content:({active:r,payload:i})=>{if(r&&i&&i.length>0){const c=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:c.name})}),e.jsxs("div",{children:["Score moyen : ",c.averageScore.toFixed(2)]}),e.jsxs("div",{children:["Score total : ",c.totalScore," / ",c.participations," parties"]})]})}return null}}),e.jsx(y,{dataKey:"averageScore",name:"Score moyen par partie",children:s.topPlayersByAverageScore.map((r,i)=>e.jsx(S,{fill:u(r.name)},`cell-${i}`))})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Scores"}),e.jsx(g,{title:"Distribution des Scores - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(j,{width:"100%",height:400,children:e.jsxs(k,{children:[e.jsx(A,{data:s.scoreData,cx:"50%",cy:"50%",labelLine:!1,label:({range:r,percentage:i})=>`${r}: ${i}%`,outerRadius:140,fill:"#8884d8",dataKey:"count",children:s.scoreData.map((r,i)=>e.jsx(S,{fill:l[i%l.length]},`cell-${i}`))}),e.jsx(f,{formatter:r=>[r,"Participations"]})]})})})]})]}),e.jsxs("div",{className:"lycans-chart-section",children:[e.jsx("h3",{children:"Répartition par Nombre de Participants"}),e.jsx(g,{title:"Répartition par Nombre de Participants - Battle Royale",className:"lycans-chart-wrapper",children:e.jsx(j,{width:"100%",height:400,children:e.jsxs(w,{data:s.participantData,children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(D,{dataKey:"participants"}),e.jsx(P,{}),e.jsx(f,{formatter:(r,i)=>[r,i==="games"?"Parties":i]}),e.jsx(V,{}),e.jsx(y,{dataKey:"games",fill:"var(--chart-color-4)",name:"Nombre de parties"})]})})})]})]}):e.jsx("div",{className:"statistiques-vide",children:"Aucune donnée Battle Royale disponible"})}export{U as BRGeneralStatsChart};
