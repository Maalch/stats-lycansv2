import{a as me,r as D,g as X,f as Me,u as ee,j as e,d as Ce,e as Ae,o as Fe}from"./index-CQ08CL5z.js";import{u as le}from"./useJoueursData-Df_3RvXB.js";import{u as he}from"./baseStatsHook-CM9lvUpw.js";import{g as ze}from"./gameUtils-DYpUb-C5.js";import{a as we,g as oe,c as Se,b as $e}from"./datasyncExport-CjB7UYqV.js";import{u as ge,g as We,a as ne,l as Re,d as xe}from"./api-D1wcWgFO.js";import{f as re,d as Ie}from"./durationFormatters-C9UyWcKX.js";import{F as H,C as _,X as U,Y,a as Q}from"./FullscreenChart-CRduOYgt.js";import{R as K,T as O}from"./CategoricalChart-B-ennQEb.js";import{L as qe,a as Le}from"./LineChart-BDT1eHNE.js";import{B as Z,a as J}from"./BarChart-BU9E-BCo.js";import{P as ke,a as Pe}from"./PieChart-CWsE1OCO.js";import{u as Ge}from"./useDeathStatisticsFromRaw-vYK8MQd5.js";import{R as fe}from"./ReferenceLine-CwbbarFQ.js";import{g as ie}from"./deathTypes-gHH1w6_X.js";import{i as ye,g as ve,V as Ee,a as Ve}from"./roleUtils-CLjkiQQc.js";import{S as Be,R as ae,e as Ke,f as Oe,h as ue,a as He,b as _e,d as Ue}from"./deathLocationUtils-2nUiwhoI.js";import{L as Ye}from"./Legend-BcM4cJrJ.js";import{a as Je,u as Qe}from"./useClips-BbmCFAZh.js";import{C as Ze,f as je,a as Xe}from"./ClipViewer-nIE1vB4G.js";import"./ActivePoints-ijIjvf_B.js";import"./PolarChart-C43BaIpq.js";function et(a){const{settings:u}=me(),{joueursData:v}=le(),[b,C]=D.useState(null),[m,R]=D.useState(!1),[x,d]=D.useState(null);D.useEffect(()=>{let p=!0;return(async()=>{try{R(!0),d(null);const o=u.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",r=await fetch(o);if(!r.ok)throw new Error(`Failed to load achievements: ${r.status} ${r.statusText}`);const n=await r.json();p&&C(n)}catch(o){p&&d(o instanceof Error?o.message:"Failed to load achievements")}finally{p&&R(!1)}})(),()=>{p=!1}},[u.dataSource]);const g=(()=>{if(!a||!b)return null;const i=v?.Players?.find(o=>o.Joueur===a)?.SteamID;return i&&b.achievements[i]||null})();return D.useEffect(()=>{a&&b&&v&&v.Players?.find(o=>o.Joueur===a)?.SteamID},[a,b,v,u.dataSource]),{data:g,isLoading:m,error:x,metadata:{generatedAt:b?.generatedAt||null,totalPlayers:b?.totalPlayers||0,totalGames:b?.totalGames||0,totalModdedGames:b?.totalModdedGames||0}}}function tt(a,u,v){if(!a||a.trim()===""||u.length===0)return null;const b=[];let C=a;u.forEach(i=>{const o=i.PlayerStats.find(r=>X(r)===a||r.Username.toLowerCase()===a.toLowerCase());if(o){C=o.Username;const r=o.MainRoleInitial==="Louveteau"?o.MainRoleInitial:we(o.MainRoleInitial,o.MainRoleChanges||[]),n=oe(r);if(v&&v!=="Tous les camps"&&n!==v)return;const f=ze(i),c=o.Victorious,h=Me(new Date(i.StartDate)),T=Se(i.StartDate,i.EndDate)||0;b.push({gameId:i.Id,date:h,camp:n,won:c,winnerCamp:f,playersInGame:i.PlayerStats.length,mapName:i.MapName,duration:T})}}),b.sort((i,o)=>{const r=n=>{const f=n.split("/");return f.length===3?new Date(parseInt(f[2]),parseInt(f[1])-1,parseInt(f[0])):new Date(n)};return r(o.date).getTime()-r(i.date).getTime()});const m=b.length,R=b.filter(i=>i.won).length,x=m>0?(R/m*100).toFixed(2):"0.00",d={};b.forEach(i=>{d[i.camp]||(d[i.camp]={appearances:0,wins:0,winRate:"0.00"}),d[i.camp].appearances++,i.won&&d[i.camp].wins++}),Object.keys(d).forEach(i=>{const o=d[i];o.winRate=o.appearances>0?(o.wins/o.appearances*100).toFixed(2):"0.00"});const g={};b.forEach(i=>{g[i.mapName]||(g[i.mapName]={appearances:0,wins:0,winRate:"0.00"}),g[i.mapName].appearances++,i.won&&g[i.mapName].wins++}),Object.keys(g).forEach(i=>{const o=g[i];o.winRate=o.appearances>0?(o.wins/o.appearances*100).toFixed(2):"0.00"});const p=b.reduce((i,o)=>i+o.duration,0);return{playerName:C,totalGames:m,totalWins:R,winRate:x,totalPlayTime:p,games:b,campStats:d,mapStats:g}}function rt(a){const u={};let v=0,b=0;return Object.entries(a).forEach(([C,m])=>{C==="Village"||C==="ChÃ¢teau"?u[C]={...m}:(v+=m.appearances,b+=m.wins)}),v>=10&&(u.Autres={appearances:v,wins:b,winRate:v>0?(b/v*100).toFixed(2):"0.00"}),u}function ce(a,u){const{data:v,isLoading:b,error:C}=he(m=>a?tt(a,m,u):null);return{data:v,isLoading:b,error:C}}function at({achievements:a,title:u,emptyMessage:v,achievementType:b="all"}){const{navigateToTab:C,updateNavigationState:m,clearNavigation:R}=ee(),{settings:x,updateSettings:d}=me(),{joueursData:g}=le(),p=ge(g),i=(t,F)=>{if(F.stopPropagation(),!t.redirectTo)return;R();const z=x.highlightedPlayer;if(d(b==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:z,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:z,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const j=x.highlightedPlayer||"",l=o(t.description,j);l&&m({playerComparisonState:{selectedPlayer1:j,selectedPlayer2:l,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const j=t.description.toLowerCase().includes("loup");m({selectedPairingTab:j?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const j=t.description.match(/(Villageois|Loups|Autres)/i);j&&m({deathStatsSelectedCamp:j[1]});let l=10;const s=t.description.match(/min\.\s*(\d+)/);s&&(l=parseInt(s[1],10));let w="totalKills",S="killers";const k=t.redirectTo.chartSection;k&&(k==="killers-total"?(w="totalKills",S="killers"):k==="killers-average"?(w="averageKills",S="killers"):k==="deaths-total"?(w="totalDeaths",S="deaths"):k==="survivors-average"?(w="survivalRate",S="deaths"):(k==="hunters-good"||k==="hunters-bad")&&(S="hunter",w="averageKills")),m({deathStatisticsState:{selectedCamp:j?.[1]||"Tous les camps",minGamesForAverage:l,selectedView:S,focusChart:w}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const j=t.redirectTo.mapFilter||"all";let l=10;const s=t.description.match(/min\.\s*(\d+)/);s&&(l=parseInt(s[1])),d(b==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:j,playerFilter:{mode:"none",players:[]},highlightedPlayer:z,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:j,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:j,playerFilter:{mode:"none",players:[]},highlightedPlayer:z,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:j,playerFilter:{mode:"none",players:[]}}}),m({playersGeneralState:{minGamesForWinRate:l,winRateOrder:"best",focusChart:"winRate"}}),C("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&m({selectedPlayerName:x.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let j="wins";const l=t.title.toLowerCase(),s=t.description.toLowerCase();l.includes("dÃ©faite")||s.includes("dÃ©faite")?j="losses":l.includes("loup")||s.includes("loup")?j="loup":l.includes("villageois")||s.includes("villageois")?j="villageois":(l.includes("victoire")||s.includes("victoire"))&&(j="wins"),m({selectedSeriesType:j})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let j=10;const l=t.description.match(/min\.\s*(\d+)/);l&&(j=parseInt(l[1],10));let s="winRate",w="best";const S=t.title.toLowerCase(),k=t.description.toLowerCase();S.includes("participation")||k.includes("participation")?s="participation":(S.includes("taux de victoire")||k.includes("taux de victoire"))&&(s="winRate",(S.includes("moins bon")||S.includes("mauvais")||k.includes("moins bon")||k.includes("mauvais"))&&(w="worst")),m({playersGeneralState:{minGamesForWinRate:j,winRateOrder:w,focusChart:s}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const j=t.redirectTo.chartSection;let l="Villageois",s=1;j&&(j==="camp-loup"?l="Loup":j==="camp-villageois"?l="Villageois":j==="camp-idiot"?l="Idiot du Village":j==="camp-amoureux"?l="Amoureux":(j==="solo-roles"||j==="hall-of-fame")&&(l="Villageois"));const w=t.description.match(/min\.\s*(\d+)/);w&&(s=parseInt(w[1],10)),j==="solo-roles"?l="RÃ´les spÃ©ciaux":j==="hall-of-fame"&&(l="Tous les camps"),m({campPerformanceState:{selectedCampPerformanceCamp:l,selectedCampPerformanceMinGames:s,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const j=t.title.toLowerCase();let l="overview",s="behavior";j.includes("agressivitÃ©")?(l="overview",s="behavior"):j.includes("taux de vote")?(l="behavior",s="voteRate"):j.includes("prÃ©cision")&&(l="overview",s="accuracy"),m({votingStatsState:{selectedCategory:l,selectedView:s}})}if(t.category==="loot"&&t.redirectTo.subTab==="lootStats"){const j=t.redirectTo,l=j.minGames||5,s=j.view||"normalized";m({lootStatsState:{minGames:l,campFilter:"all",view:s}})}C(t.redirectTo.tab,t.redirectTo.subTab)},o=(t,F)=>{const z=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const j of z){const l=t.match(j);if(l&&l[1]){const s=l[1].trim();if(s!==F)return s}}return null},r=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const j=t.description.match(/min\.\s*(\d+)/),l=j?parseInt(j[1],10):10,s=t.title.toLowerCase(),w=b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return s.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${l} parties)${w}`:s.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${w}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${w}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const j=t.redirectTo.mapFilter,l=j==="village"?"Village":j==="chateau"?"ChÃ¢teau":"map",s=b==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${l}${s}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${o(t.description,x.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const j=t.description.match(/(Villageois|Loups|Autres)/i),l=t.description.match(/min\.\s*(\d+)/),s=l?parseInt(l[1],10):10,w=j?.[1]||"Tous les camps",S=t.redirectTo.chartSection;let k="kills et morts";return S==="killers-total"?k="total des kills":S==="killers-average"?k=`moyenne des kills (min. ${s} parties)`:S==="deaths-total"?k="total des morts":S==="survivors-average"&&(k=`taux de survie (min. ${s} parties)`),`Cliquez pour voir les statistiques de ${k} ${w!=="Tous les camps"?`en ${w}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const j=t.title.toLowerCase(),l=t.description.toLowerCase();return j.includes("dÃ©faite")||l.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":j.includes("loup")||l.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":j.includes("villageois")||l.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":j.includes("victoire")||l.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const j=t.redirectTo.chartSection,l=b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return j==="camp-loup"?`Cliquez pour voir les performances camp Loup${l}`:j==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${l}`:j==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${l}`:j==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${l}`:j==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${l}`:j==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${l}`:`Cliquez pour voir les performances par camp${l}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const j=t.description.match(/min\.\s*(\d+)/),l=j?parseInt(j[1],10):25,s=b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",w=t.title.toLowerCase();return w.includes("agressivitÃ©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${l} meetings)${s}`:w.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${l} meetings)${s}`:w.includes("prÃ©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${s}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${s}`}break;case"loot":if(t.redirectTo.subTab==="lootStats"){const j=t.description.match(/min\.\s*(\d+)/),l=j?parseInt(j[1],10):25,s=b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de rÃ©colte (min. ${l} parties)${s}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},n=t=>p[t]||We(t),f=t=>{const F=[/avec ([^:]+?):/,/contre ([^:]+?):/];let z=t;return F.forEach(j=>{const l=t.match(j);if(l&&l[1]){const s=l[1].trim(),S=`<span class="player-name-highlight" style="color: ${n(s)};">${s}</span>`;z=z.replace(s,S)}}),z};if(a.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:u}),e.jsx("p",{children:v||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const c=t=>t===1?"ðŸ¥‡":t===2?"ðŸ¥ˆ":t===3?"ðŸ¥‰":"",h=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",T=(t,F)=>{if(!t||t<=3||!F)return;const z=t-3,j=F-3;return j<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(z-1)/(j-1))}, 70%, 50%)`},N=(t,F)=>{if(!t||!F)return;if(F<=1)return"hsl(0, 70%, 50%)";const z=(t-1)/(F-1),j=z*15,l=50-z*15;return`hsl(${j}, 70%, ${l}%)`},M=t=>{if(!t)return;const F=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(F){const[,z,j]=F;return`hsl(${z}, ${j}%, 40%)`}return t},q=a.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,F)=>(t.rank??999)-(F.rank??999)),A=a.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,F)=>(t.rank??999)-(F.rank??999)),P=a.filter(t=>t.category==="comparison"),L=[...q,...A].sort((t,F)=>(t.rank??999)-(F.rank??999)),G=q.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:u}),G>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:q.filter(t=>t.rank&&t.rank<=3).map((t,F)=>e.jsxs("div",{className:`top3-card ${h(t.rank)} animate-slide-in`,style:{animationDelay:`${F*.15}s`},onClick:z=>i(t,z),title:r(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:c(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:t.title}),e.jsx("p",{className:"top3-achievement-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},t.id))})]}),L.length>0&&e.jsxs("div",{className:"achievements-section unified-rankings",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:L.filter(t=>t.type==="bad"?!0:!t.rank||t.rank>3).map((t,F)=>{const z=t.type==="bad",j=z?N(t.rank,t.totalRanked):T(t.rank,t.totalRanked),l=M(j),s=z?"":h(t.rank);return e.jsxs("div",{className:`achievement-card ${z?"bad":"good"} ${s}`,onClick:w=>i(t,w),title:r(t),style:{animationDelay:`${F*.05}s`,borderLeftColor:l,borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsxs("span",{className:"achievement-title",children:[z&&"ðŸ’€ ",t.title]}),e.jsxs("span",{className:"achievement-rank",style:j?{backgroundColor:j}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:t.description})]},t.id)})})]}),P.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques CoÃ©quipiers et Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:P.map(t=>e.jsxs("div",{className:"achievement-card comparison",onClick:F=>i(t,F),title:r(t),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:t.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:f(t.description)}})]},t.id))})]})]})}function st({selectedPlayerName:a,groupingMethod:u,campFilter:v="all"}){const{navigateToGameDetails:b}=ee(),{data:C,isLoading:m,error:R}=ce(a),x=D.useMemo(()=>{switch(u){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[u]),d=D.useMemo(()=>{if(!C?.games)return new Map;const o=new Map;return C.games.forEach(r=>{if(!o.has(r.date)){const n=r.date.split("/");n.length===3?o.set(r.date,new Date(parseInt(n[2]),parseInt(n[1])-1,parseInt(n[0])).getTime()):o.set(r.date,new Date(r.date).getTime())}}),o},[C?.games]),g=D.useMemo(()=>{if(!C?.games)return[];const o={};return C.games.forEach(r=>{if(v!=="all"){if(v==="solo"){if(r.camp==="Villageois"||r.camp==="Loup")return}else if(r.camp!==v)return}let n;const f=r.date.split("/");if(u==="month")if(f.length===3)n=`${f[1].padStart(2,"0")}/${f[2]}`;else{const c=new Date(r.date);n=`${String(c.getMonth()+1).padStart(2,"0")}/${c.getFullYear()}`}else if(u==="quarter")if(f.length===3){const c=parseInt(f[1],10);n=`T${Math.floor((c-1)/3)+1}/${f[2]}`}else{const c=new Date(r.date);n=`T${Math.floor(c.getMonth()/3)+1}/${c.getFullYear()}`}else u==="year"?f.length===3?n=`${f[2]}`:n=`${new Date(r.date).getFullYear()}`:n=r.date;o[n]||(o[n]={games:[],wins:0,total:0}),o[n].games.push(r),o[n].total++,r.won&&o[n].wins++}),Object.entries(o).map(([r,n])=>({period:r,totalGames:n.total,victories:n.wins,defeats:n.total-n.wins,winRate:n.total>0?(n.wins/n.total*100).toFixed(1):"0.0",winRateNum:n.total>0?n.wins/n.total*100:0})).sort((r,n)=>{if(u==="month"){const[f,c]=r.period.split("/"),[h,T]=n.period.split("/"),N=new Date(parseInt(c),parseInt(f)-1,1),M=new Date(parseInt(T),parseInt(h)-1,1);return N.getTime()-M.getTime()}else if(u==="quarter"){const[f,c]=r.period.split("/"),[h,T]=n.period.split("/"),N=parseInt(f.replace(/\D/g,""),10)||1,M=parseInt(h.replace(/\D/g,""),10)||1,q=new Date(parseInt(c,10),(N-1)*3,1),A=new Date(parseInt(T,10),(M-1)*3,1);return q.getTime()-A.getTime()}else if(u==="year"){const f=parseInt(r.period,10),c=parseInt(n.period,10);return f-c}else{const f=d.get(r.period)||0,c=d.get(n.period)||0;return f-c}})},[C,u,d,v]),i=(o=>o<=15?{fontSize:12,angle:-45,height:80,interval:0}:o<=30?{fontSize:12,angle:-45,height:85,interval:1}:o<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(o/12)})(g.length);return m?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):R?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",R]}):C?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",x]}),e.jsx(H,{title:`Ã‰volution des Performances ${x}`,children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(qe,{data:g,margin:{top:20,right:30,left:20,bottom:20},onClick:o=>{if(o&&o.activeLabel){const r=g.find(n=>n.period===o.activeLabel);r&&b({selectedPlayer:a,selectedDate:r.period,fromComponent:`Ã‰volution des Performances ${x}`})}},style:{cursor:"pointer"},children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"period",angle:i.angle,textAnchor:"end",height:i.height,interval:i.interval,fontSize:i.fontSize}),e.jsx(Y,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(O,{content:({active:o,payload:r})=>{if(o&&r&&r.length>0){const n=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.period})}),e.jsxs("div",{children:["Parties: ",n.totalGames]}),e.jsxs("div",{children:["Victoires: ",n.victories]}),e.jsxs("div",{children:["Taux: ",n.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Le,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",x]}),e.jsx(H,{title:`RÃ©partition Victoires/DÃ©faites ${x}`,children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:g,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"period",angle:i.angle,textAnchor:"end",height:i.height,interval:i.interval,fontSize:i.fontSize}),e.jsx(Y,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(O,{content:({active:o,payload:r})=>{if(o&&r&&r.length>0){const n=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.period})}),e.jsxs("div",{children:["Total: ",n.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",n.victories]}),e.jsxs("div",{children:["DÃ©faites: ",n.defeats]}),e.jsxs("div",{children:["Taux: ",n.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(J,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:g.map((o,r)=>e.jsx(Q,{fill:"var(--accent-tertiary)",onClick:()=>{b({selectedPlayer:a,selectedDate:o.period,fromComponent:`Historique Joueur - Victoires ${x}`})},style:{cursor:"pointer"}},`cell-victories-${r}`))}),e.jsx(J,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:g.map((o,r)=>e.jsx(Q,{fill:"var(--chart-color-4)",onClick:()=>{b({selectedPlayer:a,selectedDate:o.period,fromComponent:`Historique Joueur - DÃ©faites ${x}`})},style:{cursor:"pointer"}},`cell-defeats-${r}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function it({selectedPlayerName:a}){const{navigateToGameDetails:u}=ee(),{data:v,isLoading:b,error:C}=ce(a),m=ne(),R=D.useMemo(()=>v?.campStats?Object.entries(v.campStats).map(([d,g])=>({name:d,value:g.appearances,winRate:g.winRate,winRateDisplay:Math.max(parseFloat(g.winRate),1),wins:g.wins,percentage:(g.appearances/v.totalGames*100).toFixed(1)})):[],[v]),x=D.useMemo(()=>{if(!R.length)return[];const d=5;let g=0;const p=[],i=[];if(R.forEach(o=>{parseFloat(o.percentage)<d?(g+=Number(o.value),p.push(o)):i.push(o)}),g>0){const o=R.reduce((r,n)=>r+Number(n.value),0);i.push({name:"Autres",value:g,winRate:"0.0",winRateDisplay:1,wins:p.reduce((r,n)=>r+n.wins,0),percentage:(g/o*100).toFixed(1),_details:p})}return i},[R]);return b?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):C?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",C]}):v?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ke,{children:[e.jsx(Pe,{data:x,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:d=>{const g=d.percent!==void 0?d.percent:0;return d.name==="Autres"?`Autres : ${d.value} (${(g*100).toFixed(1)}%)`:`${d.name}: ${d.value} (${(g*100).toFixed(1)}%)`},children:x.map((d,g)=>e.jsx(Q,{fill:d.name==="Autres"?Re:m[d.name]||`var(--chart-color-${g%6+1})`,onClick:()=>{if(d.name==="Autres"){const p=d._details?.map(i=>i.name)||[];u({selectedPlayer:a,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:p},fromComponent:"Distribution par Camps"})}else d.name==="TraÃ®tre"||d.name==="Louveteau"?u({selectedPlayer:a,campFilter:{selectedCamp:d.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):d.name==="Loup"?u({selectedPlayer:a,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):u({selectedPlayer:a,campFilter:{selectedCamp:d.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${g}`))}),e.jsx(O,{content:({active:d,payload:g})=>{if(d&&g&&g.length>0){const p=g[0].payload;if(p.name==="Autres"&&p._details){const i=[...p._details].sort((o,r)=>r.value-o.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",p.value," parties (",p.percentage,"%)"]})}),e.jsx("div",{children:i.map((o,r)=>e.jsxs("div",{children:[o.name,": ",o.value," parties (",o.percentage,"%)"]},r))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[p.name," - ",p.value," parties (",p.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(H,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:R,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Y,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(O,{content:({active:d,payload:g})=>{if(d&&g&&g.length>0){const p=g[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:p.name})}),e.jsxs("div",{children:["Victoires: ",p.wins," / ",p.value]}),e.jsxs("div",{children:["Taux: ",p.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(J,{dataKey:"winRateDisplay",children:R.map((d,g)=>e.jsx(Q,{fill:parseFloat(d.winRate)===0?`${m[d.name]||`var(--chart-color-${g%6+1})`}50`:m[d.name]||`var(--chart-color-${g%6+1})`,onClick:()=>{d.name==="TraÃ®tre"||d.name==="Louveteau"?u({selectedPlayer:a,campFilter:{selectedCamp:d.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):d.name==="Loup"?u({selectedPlayer:a,campFilter:{selectedCamp:d.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):u({selectedPlayer:a,campFilter:{selectedCamp:d.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${g}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function nt({selectedPlayerName:a}){const{navigateToGameDetails:u,navigationState:v,updateNavigationState:b}=ee(),[C,m]=D.useState(v.playerHistoryMapState?.selectedCamp||"Tous les camps"),{data:R}=Ge(),{data:x,isLoading:d,error:g}=ce(a,C);D.useEffect(()=>{(!v.playerHistoryMapState||v.playerHistoryMapState.selectedCamp!==C)&&b({playerHistoryMapState:{selectedCamp:C}})},[C,v.playerHistoryMapState,b]);const p=o=>{m(o),b({playerHistoryMapState:{selectedCamp:o}})},i=D.useMemo(()=>{if(!x?.mapStats)return[];const o=rt(x.mapStats);return Object.entries(o).map(([r,n])=>({name:r,value:n.appearances,winRate:n.winRate,winRateDisplay:Math.max(parseFloat(n.winRate),.1),wins:n.wins,percentage:(n.appearances/x.totalGames*100).toFixed(1)}))},[x]);return d?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):g?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]}):x?e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Performance par Carte",C!=="Tous les camps"?` (${C})`:""]}),e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select-map",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select-map",value:C,onChange:o=>p(o.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),R?.map(o=>e.jsx("option",{value:o,children:o},o))]})]}),i.length===0?e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de carte disponible"}),e.jsx("p",{children:"Aucune statistique de carte n'est disponible pour ce joueur avec le camp sÃ©lectionnÃ©."})]}):e.jsx(H,{title:"Performance par Carte",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:i,margin:{top:20,right:140,left:20,bottom:20},children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Y,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(fe,{y:50,stroke:"var(--text-secondary)",strokeDasharray:"5 5",strokeOpacity:.5}),(()=>{if(i.length>0){const o=i.reduce((f,c)=>f+c.value,0),r=i.reduce((f,c)=>f+c.wins,0),n=o>0?r/o*100:0;if(n!==50)return e.jsx(fe,{y:n,stroke:"var(--accent-primary)",strokeDasharray:"3 3",strokeOpacity:.7,label:{value:`Moyenne: ${n.toFixed(1)}%`,position:"right",offset:5,style:{fill:"var(--accent-primary)"}}})}return null})(),e.jsx(O,{content:({active:o,payload:r})=>{if(o&&r&&r.length>0){const n=r[0].payload,f=[];return i.forEach(c=>{if(c.name!==n.name&&c.value>=5){const h=parseFloat(n.winRate)-parseFloat(c.winRate);Math.abs(h)>=2&&f.push({map:c.name,diff:h,better:h>0})}}),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:"250px"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.name})}),e.jsxs("div",{children:["Parties: ",n.value]}),e.jsxs("div",{children:["Victoires: ",n.wins]}),e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("strong",{children:["Taux: ",n.winRate,"%"]})}),f.length>0&&e.jsxs("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"0.8rem",fontWeight:"bold",marginBottom:"0.25rem"},children:"Comparaisons:"}),f.map((c,h)=>e.jsxs("div",{style:{fontSize:"0.75rem",color:c.better?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[c.better?"â†—":"â†˜"," ",Math.abs(c.diff).toFixed(1),"% vs ",c.map]},h))]}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(J,{dataKey:"winRateDisplay",label:o=>{const{x:r,y:n,width:f,payload:c}=o;if(r===void 0||n===void 0||f===void 0||!c)return null;const h=c.winRate||"0";return e.jsxs("text",{x:r+f/2,y:n-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[h,"%"]})},onClick:o=>{if(o&&o.name){const r={selectedPlayer:a,selectedMapName:o.name,fromComponent:"Performance par Carte"};C!=="Tous les camps"&&(r.campFilter={selectedCamp:C,campFilterMode:"all-assignments"}),u(r)}},children:i.map((o,r)=>{let n;o.name==="Village"?n="var(--accent-tertiary)":o.name==="ChÃ¢teau"?n="var(--accent-secondary)":o.name==="Autres"?n=Re:n=`var(--chart-color-${r%6+1})`;const f=Math.max(...i.map(h=>parseFloat(h.winRate))),c=parseFloat(o.winRate)===f&&f>0;return e.jsx(Q,{fill:parseFloat(o.winRate)===0?`${n}30`:n,stroke:"transparent",strokeWidth:c?3:1,style:{cursor:"pointer"}},`cell-map-${r}`)})})]})})})})]})}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function ot({selectedPlayerName:a}){const{gameData:u}=Ce(),{joueursData:v}=le(),b=ge(v),C=ne(),m=D.useMemo(()=>{if(!u||!a)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const x={},d={},g={},p=new Set;u.forEach(f=>{const c=f.PlayerStats.find(h=>h.Username.toLowerCase()===a.toLowerCase());if(c&&(f.PlayerStats.forEach(h=>{h.KillerName?.toLowerCase()===a.toLowerCase()&&(x[h.Username]=(x[h.Username]||0)+1)}),c.KillerName&&(d[c.KillerName]=(d[c.KillerName]||0)+1),c.DeathType)){const h=c.DeathType,T=ie(h);g[T]||(g[T]={count:0,byDeathType:{}}),g[T].count+=1,g[T].byDeathType[h]=(g[T].byDeathType[h]||0)+1,p.add(h)}});const i=Object.entries(x).map(([f,c])=>({player:f,kills:c})).sort((f,c)=>c.kills-f.kills).slice(0,10),o=Object.entries(d).map(([f,c])=>({player:f,kills:c})).sort((f,c)=>c.kills-f.kills).slice(0,10),r=Object.entries(g).map(([f,c])=>{const h={deathType:f,count:c.count};return h[f]=c.count,h}).sort((f,c)=>c.count-f.count).slice(0,10),n=Object.keys(g);return{playersKilled:i,killedBy:o,deathTypes:r,availableDeathTypes:n}},[u,a]),R=D.useMemo(()=>{const x={};m.availableDeathTypes.forEach(p=>{p==="TuÃ© par Loup"?x[p]=C.Loup:p==="Mort aux votes"?x[p]="var(--chart-color-1)":p.includes("Chasseur")?x[p]=C.Chasseur:p==="TuÃ© par Zombie"?x[p]=C.Vaudou:p==="TuÃ© par potion assassin"?x[p]=C.Alchimiste:p==="TuÃ© par Vengeur"?x[p]="var(--chart-color-2)":p==="Amoureux mort"?x[p]=C.Amoureux:p==="TuÃ© par La BÃªte"?x[p]="var(--chart-color-3)":p==="TuÃ© par ShÃ©rif"&&(x[p]="var(--chart-color-4)")});const d=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let g=0;return m.availableDeathTypes.forEach(p=>{x[p]||(x[p]=d[g%d.length],g++)}),x},[m.availableDeathTypes,C]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[m.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(H,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:m.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Y,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(O,{content:({active:x,payload:d})=>{if(x&&d&&d.length>0){const g=d[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:g.player})}),e.jsxs("div",{children:["TuÃ© ",g.kills," fois par ",a]})]})}return null}}),e.jsx(J,{dataKey:"kills",children:m.playersKilled.map((x,d)=>e.jsx(Q,{fill:b[x.player]||"var(--chart-color-3)"},`cell-killed-${d}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[a," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),m.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(H,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:m.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Y,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(O,{content:({active:x,payload:d})=>{if(x&&d&&d.length>0){const g=d[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:g.player})}),e.jsxs("div",{children:["A tuÃ© ",a," ",g.kills," fois"]})]})}return null}}),e.jsx(J,{dataKey:"kills",children:m.killedBy.map((x,d)=>e.jsx(Q,{fill:b[x.player]||"var(--chart-color-4)"},`cell-killer-${d}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[a," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),m.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(H,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:m.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(Y,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(O,{content:({active:x,payload:d})=>{if(x&&d&&d.length>0){const g=d[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:g.deathType})}),e.jsxs("div",{children:[a," est mort ",g.count," fois ainsi"]})]})}return null}}),m.availableDeathTypes.map(x=>e.jsx(J,{dataKey:x,name:x,stackId:"deaths",fill:R[x]||"var(--chart-color-5)"},x))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",a,"."]})]})]})}function lt(a,u){if(!a||a.trim()===""||u.length===0)return null;const v=new Map,b=new Map,C=new Map;u.forEach(g=>{if(!g.Modded)return;const p=g.PlayerStats.find(i=>X(i)===a||i.Username.toLowerCase()===a.toLowerCase());if(p){if(p.MainRoleInitial==="Inconnu")return;const i=p.Victorious,r=we(p.MainRoleInitial,p.MainRoleChanges||[])!==p.MainRoleInitial,n=oe(p.MainRoleInitial),f=n==="Loup"||n==="TraÃ®tre"||n==="Louveteau";if(n==="Villageois"&&ye(p)){const c=ve(p);if(c&&Ee.includes(c)){const h=v.get(c)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};v.set(c,{appearances:h.appearances+1,wins:h.wins+(i?1:0),winsWithoutRoleChange:h.winsWithoutRoleChange+(!r&&i?1:0),gamesWithoutRoleChange:h.gamesWithoutRoleChange+(r?0:1)})}}else if(p.Power&&p.Power.trim()!==""&&p.Power!=="Inconnu"){if(n==="Villageois"){const c=v.get(p.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};v.set(p.Power,{appearances:c.appearances+1,wins:c.wins+(i?1:0),winsWithoutRoleChange:c.winsWithoutRoleChange+(!r&&i?1:0),gamesWithoutRoleChange:c.gamesWithoutRoleChange+(r?0:1)})}else if(f){const c=b.get(p.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},h=c.roleBreakdown;h.set(p.MainRoleInitial,(h.get(p.MainRoleInitial)||0)+1),b.set(p.Power,{appearances:c.appearances+1,wins:c.wins+(i?1:0),winsWithoutRoleChange:c.winsWithoutRoleChange+(!r&&i?1:0),gamesWithoutRoleChange:c.gamesWithoutRoleChange+(r?0:1),roleBreakdown:h})}}else if((n==="Villageois"||f)&&p.Power!=="Inconnu")if(n==="Villageois"){const c=v.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};v.set("Aucun pouvoir",{appearances:c.appearances+1,wins:c.wins+(i?1:0),winsWithoutRoleChange:c.winsWithoutRoleChange+(!r&&i?1:0),gamesWithoutRoleChange:c.gamesWithoutRoleChange+(r?0:1)})}else{const c=b.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},h=c.roleBreakdown;h.set(p.MainRoleInitial,(h.get(p.MainRoleInitial)||0)+1),b.set("Aucun pouvoir",{appearances:c.appearances+1,wins:c.wins+(i?1:0),winsWithoutRoleChange:c.winsWithoutRoleChange+(!r&&i?1:0),gamesWithoutRoleChange:c.gamesWithoutRoleChange+(r?0:1),roleBreakdown:h})}if(p.SecondaryRole&&p.SecondaryRole.trim()!==""&&p.SecondaryRole!=="Inconnu"){const c=C.get(p.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};C.set(p.SecondaryRole,{appearances:c.appearances+1,wins:c.wins+(i?1:0),winsWithoutRoleChange:c.winsWithoutRoleChange+(!r&&i?1:0),gamesWithoutRoleChange:c.gamesWithoutRoleChange+(r?0:1)})}}});const m=new Map;u.forEach(g=>{const p=g.PlayerStats.find(i=>X(i)===a||i.Username.toLowerCase()===a.toLowerCase());if(p&&ye(p)){const i=ve(p);i&&m.set(i,(m.get(i)||0)+1)}});const R=g=>Array.from(g.entries()).map(([p,i])=>({name:p,appearances:i.appearances,wins:i.wins,winsWithoutRoleChange:i.winsWithoutRoleChange,gamesWithoutRoleChange:i.gamesWithoutRoleChange,winRate:i.gamesWithoutRoleChange>0?(i.winsWithoutRoleChange/i.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...m.has(p)&&{totalGamesAllModes:m.get(p)}})).sort((p,i)=>i.appearances-p.appearances),x=g=>Array.from(g.entries()).map(([p,i])=>({name:p,appearances:i.appearances,wins:i.wins,winsWithoutRoleChange:i.winsWithoutRoleChange,gamesWithoutRoleChange:i.gamesWithoutRoleChange,winRate:i.gamesWithoutRoleChange>0?(i.winsWithoutRoleChange/i.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(i.roleBreakdown.entries()).map(([o,r])=>({role:o,count:r})).sort((o,r)=>r.count-o.count)})).sort((p,i)=>i.appearances-p.appearances),d=g=>Array.from(g.entries()).map(([p,i])=>({name:p,appearances:i.appearances,wins:i.wins,winsWithoutRoleChange:i.winsWithoutRoleChange,gamesWithoutRoleChange:i.gamesWithoutRoleChange,winRate:i.gamesWithoutRoleChange>0?(i.winsWithoutRoleChange/i.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((p,i)=>i.appearances-p.appearances);return{villageoisPowers:R(v),loupPowers:x(b),secondaryRoles:d(C)}}function ct({selectedPlayerName:a}){const{navigateToGameDetails:u,navigationState:v,updateNavigationState:b}=ee(),C=ne(),[m,R]=D.useState(v.playerHistoryRolesState?.chartMode||"appearances"),{data:x,isLoading:d,error:g}=he(h=>lt(a,h));D.useEffect(()=>{(!v.playerHistoryRolesState||v.playerHistoryRolesState.chartMode!==m)&&b({playerHistoryRolesState:{chartMode:m}})},[m,v.playerHistoryRolesState,b]);const p=h=>{R(h),b({playerHistoryRolesState:{chartMode:h}})},i=D.useMemo(()=>{if(!x)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const h=1,T=1,N=15,M=m==="winRate"?(A,P)=>parseFloat(P.winRate)-parseFloat(A.winRate):(A,P)=>P.appearances-A.appearances,q=A=>({...A,winRateDisplay:Math.max(parseFloat(A.winRate),1)});return{villageoisPowers:x.villageoisPowers.filter(A=>A.appearances>=h).map(q).sort(M).slice(0,N),loupPowers:x.loupPowers.filter(A=>A.appearances>=h).map(q).sort(M).slice(0,N),secondaryRoles:x.secondaryRoles.filter(A=>A.appearances>=T).map(q).sort(M).slice(0,N)}},[x,m]);if(d)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(g)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]});if(!x)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const o=i.villageoisPowers.length>0,r=i.loupPowers.length>0,n=i.secondaryRoles.length>0;if(!o&&!r&&!n)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const f=({active:h,payload:T})=>{if(h&&T&&T.length>0){const N=T[0].payload,M=N.gamesWithoutRoleChange<N.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:N.name})}),e.jsxs("div",{children:["Apparitions: ",N.appearances]}),M&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",N.appearances-N.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",N.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",N.winRate,"%"]})}),N.totalGamesAllModes&&N.totalGamesAllModes!==N.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",N.totalGamesAllModes,")"]}),N.roleBreakdown&&N.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),N.roleBreakdown.map((q,A)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",q.role,": ",q.count]},A))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},c=(h,T,N,M,q)=>{const A=m==="appearances"?"appearances":"winRateDisplay",P=m==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",L=m==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:T}),e.jsx(H,{title:T,children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:h,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(_,{strokeDasharray:"3 3"}),e.jsx(U,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(Y,{label:{value:P,angle:270,position:"left",style:{textAnchor:"middle"}},domain:L}),e.jsx(O,{content:e.jsx(f,{})}),e.jsx(J,{dataKey:A,label:m==="winRate"?G=>{const{x:t,y:F,width:z,payload:j}=G;if(t===void 0||F===void 0||z===void 0||!j)return null;const l=j.winRate||"0";return e.jsxs("text",{x:t+z/2,y:F-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[l,"%"]})}:void 0,children:h.map((G,t)=>e.jsx(Q,{fill:q?q(G.name,t):N,onClick:()=>M(G.name),style:{cursor:"pointer"}},`cell-${t}`))})]})})})})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:m,onChange:h=>p(h.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[o&&c(i.villageoisPowers,"Camp Villageois","var(--chart-color-1)",h=>{u({selectedPlayer:a,campFilter:{selectedCamp:"Villageois",campFilterMode:m==="winRate"?"wins-only":"all-assignments"},selectedPower:h,fromComponent:`Historique des RÃ´les - Pouvoir: ${h}`})},h=>h==="Chasseur"&&C.Chasseur?C.Chasseur:h==="Alchimiste"&&C.Alchimiste?C.Alchimiste:h==="Protecteur"&&C.Protecteur?C.Protecteur:h==="Disciple"&&C.Disciple?C.Disciple:"var(--chart-color-1)"),r&&c(i.loupPowers,"Camp Loups","var(--chart-color-2)",h=>{u({selectedPlayer:a,campFilter:{selectedCamp:"Loup",campFilterMode:m==="winRate"?"wins-only":"all-assignments"},selectedPower:h,fromComponent:`Historique des RÃ´les - Pouvoir: ${h}`})},()=>C.Loup||"var(--chart-color-2)"),n&&c(i.secondaryRoles,"RÃ´les Secondaires","var(--chart-color-3)",h=>{u({selectedPlayer:a,selectedSecondaryRole:h,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${h}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}function dt({viewMode:a,setViewMode:u,selectedMap:v,setSelectedMap:b,availableMaps:C,clusterRadius:m,setClusterRadius:R,availableDeathTypes:x,selectedDeathTypes:d,setSelectedDeathTypes:g,deathTypeColors:p,isDeathTypesExpanded:i,setIsDeathTypesExpanded:o}){return e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>u("deaths"),style:{background:a==="deaths"?"var(--accent-primary)":"transparent",color:a==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:a==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"ðŸ’€ Morts"}),e.jsx("button",{type:"button",onClick:()=>u("kills"),style:{background:a==="kills"?"var(--accent-primary)":"transparent",color:a==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:a==="kills"?"bold":"normal",transition:"all 0.2s"},children:"âš”ï¸ Kills"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:v,onChange:r=>b(r.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:C.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:m,onChange:r=>R(parseInt(r.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:m===0?"Aucun":`${m} unitÃ©${m>1?"s":""}`})]}),e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>o(!i),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:i?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:i?"rotate(90deg)":"rotate(0deg)"},children:"â–¶"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[d.length," / ",x.length," sÃ©lectionnÃ©",d.length>1?"s":""]})]}),i&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),g(x)},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),g([])},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:x.map(r=>{const n=d.includes(r),f=p[r]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",background:n?"var(--bg-tertiary)":"transparent",borderRadius:"4px",border:`1px solid ${n?f:"var(--border-color)"}`,cursor:"pointer",transition:"all 0.2s",fontSize:"0.9rem"},onClick:c=>{c.stopPropagation(),g(n?h=>h.filter(T=>T!==r):h=>[...h,r])},children:[e.jsx("input",{type:"checkbox",checked:n,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:f,flexShrink:0}}),e.jsx("span",{children:ie(r)})]},r)})})]})]})]})}function ut({zoneAnalysis:a,selectedMap:u,viewMode:v,selectedPlayerName:b,hoveredZone:C,setHoveredZone:m}){return!a||u!=="Village"||v!=="deaths"?null:e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"0rem",padding:"1.5rem",background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",borderRadius:"12px",border:"2px solid var(--accent-primary)",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",color:"var(--accent-primary)",fontSize:"1.3rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"ðŸ“Š Analyse par zone (Village)"}),e.jsx("p",{style:{fontSize:"0.95rem",marginBottom:"1rem",color:"var(--text-secondary)",lineHeight:"1.5"},children:"Distribution des morts (selon les types sÃ©lectionnÃ©s) comparÃ©e Ã  la moyenne de tous les joueurs:"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:a.zoneStats.map(R=>{const x=R.zone===a.dominantZone&&a.maxDeviation>10;return e.jsxs("div",{onMouseEnter:()=>m(R.zone),onMouseLeave:()=>m(null),style:{padding:"1rem",background:"var(--bg-primary)",borderRadius:"8px",border:C===R.zone?"1px solid var(--accent-primary)":"1px solid var(--border-color)",color:"var(--text-primary)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.95rem"},children:R.zone}),e.jsxs("div",{style:{fontSize:"0.85rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[b,": ",e.jsxs("strong",{children:[R.playerPercent.toFixed(1),"%"]})," (",R.playerCount,")"]}),e.jsxs("div",{style:{opacity:.85},children:["Moyenne: ",R.avgPercent.toFixed(1),"%"]}),e.jsxs("div",{style:{marginTop:"0.25rem",color:x?"var(--accent-secondary)":R.deviation>0?"var(--accent-primary)":"var(--text-secondary)",fontWeight:Math.abs(R.deviation)>5?"bold":"normal"},children:[R.deviation>0?"+":"",R.deviation.toFixed(1),"% vs moyenne"]})]})]},R.zone)})}),a.dominantZone&&a.maxDeviation>10&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",fontSize:"0.95rem",color:"var(--accent-primary)",fontWeight:"bold",background:"var(--bg-primary)",borderRadius:"8px",border:"2px solid var(--accent-primary)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"âš ï¸"}),e.jsxs("span",{children:[b," meurt significativement plus souvent en zone ",a.dominantZone,"(","+"+a.maxDeviation.toFixed(1),"% par rapport Ã  la moyenne)"]})]})]})}function pt({locationData:a,clusteredData:u,viewMode:v,selectedPlayerName:b,selectedMap:C,mapConfig:m,xDomain:R,zDomain:x,hoveredZone:d,getDeathColor:g,handleLocationClick:p}){const i=({active:o,payload:r})=>{if(!o||!r||r.length===0)return null;const n=r[0].payload,f=n.allLocations||[n];if(f.length>1){const T=new Map,N=new Map,M=new Set;f.forEach(P=>{T.set(P.victimName,(T.get(P.victimName)||0)+1);const L=P.deathType?ie(P.deathType):"Inconnu";N.set(L,(N.get(L)||0)+1),M.add(P.gameId)});const q=Array.from(T.entries()).sort((P,L)=>L[1]-P[1]).slice(0,3),A=Array.from(N.entries()).sort((P,L)=>L[1]-P[1]).slice(0,3);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[v==="deaths"?"ðŸ’€":"âš”ï¸"," ",f.length," ",v==="deaths"?"morts":"kills"," Ã  cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:v==="deaths"?"Victimes:":"Kills sur:"}),q.map(([P,L])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",P," (",L,"Ã—)"]},P))]}),e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Types de mort:"}),A.map(([P,L])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",P," (",L,"Ã—)"]},P))]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["ðŸ“ ",M.size," partie",M.size>1?"s":""," diffÃ©rente",M.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const h=f[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[v==="deaths"?"ðŸ’€":"âš”ï¸"," ",v==="deaths"?"Mort de":"Kill de"," ",b]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[v==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Victime:"})," ",h.victimName]}),e.jsxs("div",{children:["âš”ï¸ ",e.jsx("strong",{children:"Tueur:"})," ",h.killerName||"Inconnu"]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",h.deathType?ie(h.deathType):"Inconnu"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Victime:"})," ",h.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp victime:"})," ",h.camp]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",h.deathType?ie(h.deathType):"Inconnu"]})]}),e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",h.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",h.gameId]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})};return e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:a.length>0?e.jsx(H,{title:v==="deaths"?`Carte des Morts de ${b}`:`Carte des Kills de ${b}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Be,{margin:{top:20,right:30,left:60,bottom:20},children:[m&&e.jsx(ae,{x1:m.zMin,x2:m.zMax,y1:m.xMin,y2:m.xMax,fill:"transparent",stroke:"none",shape:o=>{const{x:r,y:n,width:f,height:c}=o;return e.jsx("image",{x:r,y:n,width:f,height:c,href:m.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),C==="Village"&&d&&e.jsxs(e.Fragment,{children:[d==="Ruines"&&e.jsx(ae,{x1:-220,x2:200,y1:100,y2:450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),d==="Village Principal"&&e.jsx(ae,{x1:-250,x2:100,y1:-120,y2:-450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),d==="Ferme"&&e.jsx(ae,{x1:-550,x2:-250,y1:150,y2:-150,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),d==="Village PÃªcheur"&&e.jsx(ae,{x1:150,x2:500,y1:80,y2:-320,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),d==="Reste de la Carte"&&e.jsx(ae,{x1:m?.zMin??-600,x2:m?.zMax??600,y1:m?.xMin??-500,y2:m?.xMax??500,fill:"var(--accent-primary)",fillOpacity:.15,stroke:"var(--accent-primary)",strokeWidth:2,strokeDasharray:"5 5"})]}),e.jsx(_,{strokeDasharray:"3 3",stroke:m?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(U,{dataKey:"z",type:"number",name:"Position Z",domain:x,hide:!0}),e.jsx(Y,{dataKey:"x",type:"number",name:"Position X",domain:R,hide:!0}),e.jsx(O,{content:e.jsx(i,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Ke,{data:u,onClick:o=>p(o),style:{cursor:"pointer"},isAnimationActive:!1,children:u.map((o,r)=>{const n=Math.min(Math.log2(o.count+1)*3+5,18),f=Math.round(n);return e.jsx(Q,{fill:g(o.deathType),stroke:o.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:o.count>1?2:1,opacity:.85,r:f},`cell-${r}`)})})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:v==="deaths"?`Aucune mort localisÃ©e pour ${b} sur cette carte.`:`Aucun kill localisÃ© pour ${b} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes."})]})})}function be(a,u){return u>=-250&&u<=100&&a>=-450&&a<=-120?"Village Principal":u>=-550&&u<=-250&&a>=-150&&a<=150?"Ferme":u>=150&&u<=500&&a>=-320&&a<=80?"Village PÃªcheur":u>=-220&&u<=200&&a>=100&&a<=450?"Ruines":"Reste de la Carte"}function se(a){return a==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":a}function mt({selectedPlayerName:a}){const{navigateToGameDetails:u}=ee(),{gameData:v,isLoading:b,error:C}=Ce(),m=ne(),[R,x]=D.useState("deaths"),[d,g]=D.useState(""),[p,i]=D.useState(0),[o,r]=D.useState(null),[n,f]=D.useState([]),[c,h]=D.useState(!1),T=D.useMemo(()=>{if(!v)return[];const l=new Set;return v.forEach(s=>{const w=s.PlayerStats.find(S=>S.Username.toLowerCase()===a.toLowerCase());w&&(w.DeathPosition!==null&&s.MapName&&l.add(s.MapName),s.PlayerStats.forEach(S=>{S.KillerName?.toLowerCase()===a.toLowerCase()&&S.DeathPosition!==null&&s.MapName&&l.add(s.MapName)}))}),Array.from(l).filter(s=>s==="Village"||s==="ChÃ¢teau").sort((s,w)=>s==="Village"?-1:w==="Village"?1:s.localeCompare(w))},[v,a]),N=T.length>0?T[0]:"";d===""&&N!==""&&g(N);const{availableDeathTypes:M,deathTypeColors:q}=D.useMemo(()=>{if(!v||!a)return{availableDeathTypes:[],deathTypeColors:{}};const l=new Set,s={};return v.forEach(w=>{const S=w.PlayerStats.find(k=>k.Username.toLowerCase()===a.toLowerCase());if(S){if(S.DeathPosition&&S.DeathType){const k=se(S.DeathType);k&&l.add(k)}w.PlayerStats.forEach(k=>{if(k.KillerName?.toLowerCase()===a.toLowerCase()&&k.DeathPosition&&k.DeathType){const E=se(k.DeathType);E&&l.add(E)}})}}),l.forEach(w=>{s[w]=Oe(w,m)}),{availableDeathTypes:Array.from(l).sort(),deathTypeColors:s}},[v,a,m]),A=l=>l&&q[l]||"var(--text-secondary)";D.useEffect(()=>{if(n.length===0&&M.length>0){const l=M.filter(s=>s!=="VOTED");f(l)}},[M.length]);const P=D.useMemo(()=>{if(!v||!a)return[];const l=[];return v.forEach(s=>{if(d&&s.MapName!==d)return;const w=s.PlayerStats.find(S=>S.Username.toLowerCase()===a.toLowerCase());if(w)if(R==="deaths"){if(w.DeathPosition){const S=oe(w.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),k=ue(w.DeathPosition.x,w.DeathPosition.z,s.MapName);l.push({x:k.x,z:k.z,victimName:w.Username,killerName:w.KillerName||null,deathType:se(w.DeathType),mapName:s.MapName,camp:S,gameId:s.DisplayedId,displayedGameId:s.DisplayedId})}}else s.PlayerStats.forEach(S=>{if(S.KillerName?.toLowerCase()===a.toLowerCase()&&S.DeathPosition){const k=oe(S.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),E=ue(S.DeathPosition.x,S.DeathPosition.z,s.MapName);l.push({x:E.x,z:E.z,victimName:S.Username,killerName:a,deathType:se(S.DeathType),mapName:s.MapName,camp:k,gameId:s.DisplayedId,displayedGameId:s.DisplayedId})}})}),n.length>0&&n.length<M.length?l.filter(s=>s.deathType&&n.includes(s.deathType)):l},[v,a,R,d,n,M]),L=D.useMemo(()=>{if(d!=="Village"||R!=="deaths"||P.length===0)return null;const l={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};if(P.forEach(W=>{const I=be(W.x,W.z);l[I]=(l[I]||0)+1}),!v)return null;const s={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};v.forEach(W=>{W.MapName==="Village"&&W.PlayerStats.forEach(I=>{if(!I.DeathPosition)return;const V=se(I.DeathType);if(n.length>0&&n.length<M.length&&(!V||!n.includes(V)))return;const B=ue(I.DeathPosition.x,I.DeathPosition.z,"Village"),de=be(B.x,B.z);s[de]=(s[de]||0)+1})});const w=Object.values(s).reduce((W,I)=>W+I,0),S=Object.values(l).reduce((W,I)=>W+I,0);if(w===0||S===0)return null;const k=["Village Principal","Village PÃªcheur","Ferme","Ruines","Reste de la Carte"];let E=0,y=null;const $=k.map(W=>{const I=l[W]/S*100,V=s[W]/w*100,B=I-V;return B>E&&l[W]>=2&&(E=B,y=W),{zone:W,playerCount:l[W],playerPercent:I,avgPercent:V,deviation:B}});return{totalPlayerDeaths:S,totalAllDeaths:w,zoneStats:$,dominantZone:y,maxDeviation:E}},[P,d,R,v,n,M]),G=D.useMemo(()=>He(P,p).map((s,w)=>{const S=s.items[0],k=_e(s.items);return{x:s.centroidX,z:s.centroidZ,count:s.items.length,allLocations:s.items,victimName:s.items.length===1?S.victimName:null,killerName:s.items.length===1?S.killerName:null,deathType:k,mapName:S.mapName,camp:S.camp,gameId:s.items.length===1?S.gameId:null,displayedGameId:s.items.length===1?S.displayedGameId:null,clusterIndex:w}}),[P,p]),t=D.useMemo(()=>Ue(d),[d]),{xDomain:F,zDomain:z}=D.useMemo(()=>{if(t)return{xDomain:[t.xMin,t.xMax],zDomain:[t.zMin,t.zMax]};if(G.length===0)return{xDomain:[0,100],zDomain:[0,100]};const l=G.map(W=>W.x),s=G.map(W=>W.z),w=Math.min(...l),S=Math.max(...l),k=Math.min(...s),E=Math.max(...s),y=(S-w)*.1||10,$=(E-k)*.1||10;return{xDomain:[w-y,S+y],zDomain:[k-$,E+$]}},[G,t]),j=l=>{if(!l)return;const s=l.allLocations||[l];if(s.length===1)u({selectedGame:s[0].gameId,fromComponent:"Player Death Map"});else{const w=s.map(S=>S.gameId).filter(S=>S);u({selectedGameIds:w,fromComponent:"Player Death Map"})}};return b?e.jsx("div",{className:"donnees-attente",children:"Chargement des donnÃ©es..."}):C?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",C]}):v?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsx(dt,{viewMode:R,setViewMode:x,selectedMap:d,setSelectedMap:g,availableMaps:T,clusterRadius:p,setClusterRadius:i,availableDeathTypes:M,selectedDeathTypes:n,setSelectedDeathTypes:f,deathTypeColors:q,isDeathTypesExpanded:c,setIsDeathTypesExpanded:h}),e.jsx(pt,{locationData:P,clusteredData:G,viewMode:R,selectedPlayerName:a,selectedMap:d,mapConfig:t,xDomain:F,zDomain:z,hoveredZone:o,getDeathColor:A,handleLocationClick:j}),e.jsx(ut,{zoneAnalysis:L,selectedMap:d,viewMode:R,selectedPlayerName:a,hoveredZone:o,setHoveredZone:r}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"Ã€ propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",R==="deaths"?`les emplacements oÃ¹ ${a} est mort`:`les emplacements oÃ¹ ${a} a Ã©liminÃ© d'autres joueurs`," au cours des parties. Les couleurs indiquent le type de mort. Cliquez sur un point pour voir les dÃ©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroupÃ©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’€ Morts:"})," OÃ¹ le joueur a Ã©tÃ© Ã©liminÃ©",e.jsx("br",{}),e.jsx("strong",{children:"âš”ï¸ Kills:"})," OÃ¹ le joueur a Ã©liminÃ© d'autres joueurs"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function De(a){return a.PlayerStats.some(u=>u.SecondsTalkedOutsideMeeting>0||u.SecondsTalkedDuringMeeting>0)}function pe(a,u){const v=u.DeathDateIrl||a.EndDate,b=Se(a.StartDate,v);return b&&b>0?b:0}function ht(a){const u=a.filter(De),v=new Map;return u.forEach(b=>{b.PlayerStats.forEach(C=>{const m=X(C),R=Ae(C),x=pe(b,C);if(x<=0)return;v.has(m)||v.set(m,{displayName:R,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const d=v.get(m);d.gamesPlayed++,d.totalSecondsAll+=(C.SecondsTalkedOutsideMeeting||0)+(C.SecondsTalkedDuringMeeting||0),d.totalGameDuration+=x})}),{playerStats:v,gamesWithTalkingData:u.length}}function gt(a,u){if(!u||u.length===0||!a)return null;const v=ht(u),b=u.filter(De);if(b.length===0||v.playerStats.size===0)return null;let C=null;for(const[l,s]of v.playerStats)if(s.displayName===a){C=l;break}if(!C)return null;let m=0,R=0,x=0,d=0;const g={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},p=new Map;let i=0,o=0,r=0,n=0;if(b.forEach(l=>{const s=l.PlayerStats.find(I=>X(I)===C);if(!s)return;const w=pe(l,s);if(w<=0)return;m++;const S=s.SecondsTalkedOutsideMeeting||0,k=s.SecondsTalkedDuringMeeting||0,E=S+k;R+=S,x+=k,d+=w;const y=$e(s.MainRoleInitial,s.Power);g[y].gamesPlayed++,g[y].secondsOutside+=S,g[y].secondsDuring+=k,g[y].gameDuration+=w;const $=Ve(s);p.has($)||p.set($,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const W=p.get($);W.gamesPlayed++,W.totalSecondsAll+=E,W.totalGameDuration+=w}),m===0||d<=0)return null;const f=3600/d,c=R*f,h=x*f,T=(R+x)*f,N=R+x>0?x/(R+x)*100:0,M=[];for(const[l,s]of Object.entries(g)){if(s.gamesPlayed===0)continue;const w=s.gameDuration>0?3600/s.gameDuration:0,S=s.secondsOutside+s.secondsDuring;M.push({camp:l,gamesPlayed:s.gamesPlayed,totalSecondsOutside:s.secondsOutside,totalSecondsDuring:s.secondsDuring,totalSecondsAll:S,totalGameDurationSeconds:s.gameDuration,secondsOutsidePer60Min:s.secondsOutside*w,secondsDuringPer60Min:s.secondsDuring*w,secondsAllPer60Min:S*w,meetingRatio:S>0?s.secondsDuring/S*100:0})}M.sort((l,s)=>s.gamesPlayed-l.gamesPlayed);const q=Array.from(p.entries()).filter(([l,s])=>s.gamesPlayed>=1).map(([l,s])=>({role:l,gamesPlayed:s.gamesPlayed,secondsAllPer60Min:s.totalGameDuration>0?s.totalSecondsAll/s.totalGameDuration*3600:0,totalSecondsAll:s.totalSecondsAll})).sort((l,s)=>s.secondsAllPer60Min-l.secondsAllPer60Min),A=[];for(const[l,s]of v.playerStats)s.totalGameDuration>0&&A.push({id:l,name:s.displayName,per60:s.totalSecondsAll/s.totalGameDuration*3600});A.sort((l,s)=>s.per60-l.per60);const P=A.reduce((l,s)=>l+s.per60,0),L=A.length>0?P/A.length:0,G=A.findIndex(l=>l.id===C)+1,t=A.length,F=t>0?Math.round((1-(G-1)/t)*100):0,z=T;b.forEach(l=>{const s=l.PlayerStats.find(E=>X(E)===C);if(!s)return;const w=pe(l,s);if(w<=0)return;((s.SecondsTalkedOutsideMeeting||0)+(s.SecondsTalkedDuringMeeting||0))/w*3600>=z?(i++,s.Victorious&&o++):(r++,s.Victorious&&n++)});const j={gamesAboveAverage:i,winsAboveAverage:o,winRateAboveAverage:i>0?o/i*100:0,gamesBelowAverage:r,winsBelowAverage:n,winRateBelowAverage:r>0?n/r*100:0};return{playerName:a,gamesPlayed:m,gamesWithTalkingData:v.gamesWithTalkingData,totalSecondsOutside:R,totalSecondsDuring:x,totalSecondsAll:R+x,totalGameDurationSeconds:d,secondsOutsidePer60Min:c,secondsDuringPer60Min:h,secondsAllPer60Min:T,meetingRatio:N,campBreakdown:M,globalAverageSecondsAllPer60Min:L,playerRank:G,totalPlayersWithData:t,percentile:F,roleBreakdown:q,winCorrelation:j}}function xt(a,u){return a?a.roleBreakdown.slice(0,u):[]}function ft(a){const{data:u,isLoading:v,error:b}=he(C=>a?gt(a,C):null);return{data:u,isLoading:v,error:b}}function yt({selectedPlayerName:a}){const{data:u,isLoading:v,error:b}=ft(a),C=ne(),[m,R]=D.useState("both"),x=D.useMemo(()=>u?.campBreakdown?u.campBreakdown.map(r=>({camp:r.camp,"Hors rÃ©union":Math.round(r.secondsOutsidePer60Min),"En rÃ©union":Math.round(r.secondsDuringPer60Min),total:Math.round(r.secondsAllPer60Min),gamesPlayed:r.gamesPlayed,meetingRatio:r.meetingRatio.toFixed(1)})):[],[u]),d=D.useMemo(()=>u?[{name:"En rÃ©union",value:u.totalSecondsDuring,color:"#2196F3"},{name:"Hors rÃ©union",value:u.totalSecondsOutside,color:"#FF9800"}]:[],[u]);if(v)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(b)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",b]});if(!u)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de temps de parole ne sont disponibles que pour les parties rÃ©centes."})]});const g=u.secondsAllPer60Min-u.globalAverageSecondsAllPer60Min,p=u.globalAverageSecondsAllPer60Min>0?(g/u.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",i=g>0,o=u.winCorrelation.winRateAboveAverage-u.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¤ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:re(u.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:i?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[i?"+":"",p,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",u.playerRank," / ",u.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-u.percentile+1,"% ",u.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“ˆ Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:u.gamesPlayed}),e.jsxs("p",{children:["sur ",u.gamesWithTalkingData," avec donnÃ©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ—£ï¸ Ratio en rÃ©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[u.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),x.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(H,{title:"Temps de parole par camp (par 60min de jeu)",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>R("meeting"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:m==="meeting"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:m==="meeting"?"var(--accent-primary)":"var(--bg-secondary)",color:m==="meeting"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:m==="meeting"?"bold":"normal"},children:"En rÃ©union"}),e.jsx("button",{onClick:()=>R("outside"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:m==="outside"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:m==="outside"?"var(--accent-primary)":"var(--bg-secondary)",color:m==="outside"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:m==="outside"?"bold":"normal"},children:"Hors rÃ©union"}),e.jsx("button",{onClick:()=>R("both"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:m==="both"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:m==="both"?"var(--accent-primary)":"var(--bg-secondary)",color:m==="both"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:m==="both"?"bold":"normal"},children:"Les deux"})]}),e.jsx("div",{style:{height:350},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:x,layout:"vertical",children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(U,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:r=>`${Math.floor(r/60)}m`}),e.jsx(Y,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(O,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(r,n)=>[re(r),n],labelFormatter:r=>{const n=x.find(f=>f.camp===r);return`${r} (${n?.gamesPlayed||0} parties)`}}),e.jsx(Ye,{}),(m==="both"||m==="outside")&&e.jsx(J,{dataKey:"Hors rÃ©union",stackId:"talk",fill:"#FF9800"}),(m==="both"||m==="meeting")&&e.jsx(J,{dataKey:"En rÃ©union",stackId:"talk",fill:"#2196F3"})]})})})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:(()=>{const r=x.find(h=>h.camp==="Villageois"),n=x.find(h=>h.camp==="Loup");if(!r||!n)return e.jsx("p",{children:"ðŸ’¡ Pas assez de donnÃ©es pour comparer les camps Villageois et Loups."});const f=r.total-n.total,c=n.total>0?(Math.abs(f)/n.total*100).toFixed(0):"0";return f>0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:a})," parle"," ",e.jsxs("strong",{style:{color:xe("Villageois")},children:[re(f)," de plus (+",c,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Villageois"})," qu'en tant que"," ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]}):f<0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:a})," parle"," ",e.jsxs("strong",{style:{color:xe("Loup")},children:[re(Math.abs(f))," de plus (+",c,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Loup"})," qu'en tant que"," ",e.jsx("strong",{children:"Villageois"})," (par heure de jeu)."]}):e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:a})," parle exactement autant en tant que"," ",e.jsx("strong",{children:"Villageois"})," qu'en tant que ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(H,{title:"RÃ©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ke,{children:[e.jsx(Pe,{data:d,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:r=>`${r.name}: ${((r.percent||0)*100).toFixed(1)}%`,children:d.map((r,n)=>e.jsx(Q,{fill:r.color},`cell-${n}`))}),e.jsx(O,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:r=>re(r)})]})})})})}),u&&u.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(H,{title:r=>r?"Top 15 rÃ´les les plus bavards (par 60min)":"Top 5 rÃ´les les plus bavards (par 60min)",children:r=>{const f=xt(u,r?15:5).map(c=>({role:c.role,secondsPer60Min:Math.round(c.secondsAllPer60Min),gamesPlayed:c.gamesPlayed}));return e.jsx("div",{style:{height:r?400:300},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:f,children:[e.jsx(_,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(U,{dataKey:"role",tick:{fill:"var(--text-primary)",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(Y,{tick:{fill:"var(--text-secondary)"},tickFormatter:c=>`${Math.floor(c/60)}m`}),e.jsx(O,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:c=>[re(c),"Temps de parole"],labelFormatter:c=>{const h=f.find(T=>T.role===c);return`${c} (${h?.gamesPlayed||0} parties)`}}),e.jsx(J,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",children:f.map((c,h)=>e.jsx(Q,{fill:C[c.role]||C.Villageois},`cell-${h}`))})]})})})}})}),(u.winCorrelation.gamesAboveAverage>0||u.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"ðŸŽ¯ CorrÃ©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[u.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",u.winCorrelation.winsAboveAverage,"/",u.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[u.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",u.winCorrelation.winsBelowAverage,"/",u.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(o)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:a})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:o>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[o>0?"supÃ©rieur":"infÃ©rieur"," de ",Math.abs(o).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function Et(){const{settings:a,updateSettings:u}=me(),{navigateToGameDetails:v,navigationState:b,updateNavigationState:C}=ee(),{data:m,isLoading:R,error:x}=Fe(),{joueursData:d,isLoading:g}=le(),{data:p,isLoading:i,error:o}=et(a.highlightedPlayer),r=ge(d),[n,f]=D.useState(""),[c,h]=D.useState(null),{clips:T}=Je(a.highlightedPlayer),{clips:N}=Qe(),[M,q]=D.useState(()=>a.useIndependentFilters&&a.independentFilters?.gameTypeEnabled?a.independentFilters.gameFilter==="modded"?"modded":"all":a.gameFilter==="modded"?"modded":"all"),A=D.useMemo(()=>a.useIndependentFilters&&a.independentFilters?.gameTypeEnabled?a.independentFilters.gameFilter==="modded":a.gameFilter==="modded",[a.useIndependentFilters,a.independentFilters?.gameTypeEnabled,a.independentFilters?.gameFilter,a.gameFilter]),[P,L]=D.useState(a.selectedPlayerSelectionView||b.selectedPlayerSelectionView||"achievements"),[G,t]=D.useState("session"),[F,z]=D.useState("all");D.useEffect(()=>{if(a.useIndependentFilters&&a.independentFilters?.gameTypeEnabled){const y=a.independentFilters.gameFilter==="modded"?"modded":"all";q(y)}else if(!a.useIndependentFilters){const y=a.gameFilter==="modded"?"modded":"all";q(y)}},[a.gameFilter,a.useIndependentFilters,a.independentFilters?.gameTypeEnabled,a.independentFilters?.gameFilter]),D.useEffect(()=>{A&&M!=="modded"&&q("modded")},[A,M]),D.useEffect(()=>{const y=a.selectedPlayerSelectionView||b.selectedPlayerSelectionView;y&&y!==P&&L(y)},[a.selectedPlayerSelectionView,b.selectedPlayerSelectionView]);const{data:j}=ce(a.highlightedPlayer||""),l=D.useMemo(()=>{if(!m||!m.GameStats)return[];const y=A?m.GameStats.filter(W=>W.Modded===!0):m.GameStats,$=new Map;return y.forEach(W=>{const I=new Date(W.StartDate);W.PlayerStats.forEach(V=>{const B=X(V),Te=d?.Players?.find(Ne=>Ne.SteamID===B)?.Joueur||V.Username;$.has(B)||$.set(B,{games:0,wins:0,firstDate:I,lastDate:I,displayName:Te});const te=$.get(B);te.games++,V.Victorious&&te.wins++,I<te.firstDate&&(te.firstDate=I),I>te.lastDate&&(te.lastDate=I)})}),Array.from($.entries()).map(([W,I])=>{let V=d?.Players?.find(B=>B.SteamID===W);return V||(V=d?.Players?.find(B=>B.Joueur===I.displayName)),{id:W,name:I.displayName,totalGames:I.games,totalWins:I.wins,winRate:I.games>0?I.wins/I.games*100:0,firstGameDate:I.firstDate.toLocaleDateString("fr-FR"),lastGameDate:I.lastDate.toLocaleDateString("fr-FR"),isHighlighted:I.displayName===a.highlightedPlayer,image:V?.Image||null,twitch:V?.Twitch||null,youtube:V?.Youtube||null}})},[m,a.highlightedPlayer,d,A]),s=D.useMemo(()=>{if(!n.trim())return l;const y=n.toLowerCase();return l.filter($=>$.name.toLowerCase().includes(y))},[l,n]),w=D.useMemo(()=>[...s].sort((y,$)=>$.totalGames-y.totalGames),[s]),S=y=>{u({highlightedPlayer:y}),f("")},k=y=>{L(y),C({selectedPlayerSelectionView:y}),u({selectedPlayerSelectionView:y,tab:"playerSelection"})},E=()=>{if(T.length===0)return;const y=Math.floor(Math.random()*T.length);h(T[y])};return R||g?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):x?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",x]})]}):!m||l.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!a.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:n,onChange:y=>f(y.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[s.length," joueur",s.length!==1?"s":"",n&&` (filtrÃ©${s.length!==1?"s":""} de ${l.length})`]})]})]}),e.jsx("div",{className:"player-display",children:n?s.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>f(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:w.map(y=>e.jsxs("button",{type:"button",className:`suggestion-btn ${y.isHighlighted?"highlighted":""}`,onClick:()=>S(y.name),children:[y.image?e.jsx("img",{src:y.image,alt:`Photo de profil de ${y.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":r[y.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[y.name,y.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[y.totalGames," parties â€¢ ",y.winRate.toFixed(1),"% victoires"]})]})]},y.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',n,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>f(""),children:"Effacer la recherche"})]}):a.highlightedPlayer?(()=>{const y=l.find($=>$.name===a.highlightedPlayer);return y?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:y.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[y.image?e.jsx("img",{src:y.image,alt:`Photo de profil de ${y.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":r[y.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[y.totalGames," parties â€¢ ",y.totalWins," victoires â€¢ ",y.winRate.toFixed(1),"% taux de victoire"]}),(y.twitch||y.youtube||T.length>0)&&e.jsxs("div",{className:"social-links",children:[y.twitch&&e.jsx("a",{href:y.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),y.youtube&&e.jsx("a",{href:y.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"}),T.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:$=>{$.stopPropagation(),E()},title:`${T.length} clip${T.length>1?"s":""} disponible${T.length>1?"s":""}`,children:["ðŸŽ¬ Clip alÃ©atoire (",T.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${P==="achievements"?"active":""}`,onClick:()=>k("achievements"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${P==="evolution"?"active":""}`,onClick:()=>k("evolution"),children:"Ã‰volution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${P==="camps"?"active":""}`,onClick:()=>k("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${P==="roles"?"active":""}`,onClick:()=>k("roles"),children:"RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${P==="maptypes"?"active":""}`,onClick:()=>k("maptypes"),children:"Types de cartes"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${P==="kills"?"active":""}`,onClick:()=>k("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${P==="deathmap"?"active":""}`,onClick:()=>k("deathmap"),children:"Cartes"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${P==="talkingtime"?"active":""}`,onClick:()=>k("talkingtime"),children:"Parole"})]}),P==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[i?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):o?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",o]})}):p?e.jsx(at,{achievements:M==="all"?p.allGamesAchievements:p.moddedOnlyAchievements,title:M==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:M}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[!A&&e.jsx("button",{type:"button",className:`filter-btn ${M==="all"?"active":""}`,onClick:$=>{$.stopPropagation(),q("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${M==="modded"?"active":""}`,onClick:$=>{$.stopPropagation(),q("modded")},disabled:A,children:"Parties moddÃ©es"})]})]}),P==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[j&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{v({selectedPlayer:y.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${y.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:j.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:Ie(j.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{v({selectedPlayer:y.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${y.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:j.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[j.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:G,onChange:$=>t($.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:F,onChange:$=>z($.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(st,{selectedPlayerName:y.name,groupingMethod:G,campFilter:F})]}),P==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(it,{selectedPlayerName:y.name})}),P==="maptypes"&&e.jsx("div",{className:"player-history-section",children:e.jsx(nt,{selectedPlayerName:y.name})}),P==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ct,{selectedPlayerName:y.name})}),P==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ot,{selectedPlayerName:y.name})}),P==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(mt,{selectedPlayerName:y.name})}),P==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(yt,{selectedPlayerName:y.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:$=>{$.stopPropagation(),u({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[y.firstGameDate," - ",y.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',a.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>u({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:w.map(y=>e.jsxs("div",{className:`character-card ${y.isHighlighted?"highlighted":""}`,onClick:()=>S(y.name),title:`${y.name} - ${y.totalGames} parties, ${y.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:y.image?e.jsx("img",{src:y.image,alt:`Photo de profil de ${y.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":r[y.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:y.name}),(y.twitch||y.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[y.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),y.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},y.id))})})}),c&&e.jsx(Ze,{clip:c,onClose:()=>h(null),relatedClips:Xe(c,N),nextClip:je(c,N),onNextClip:()=>{const y=je(c,N);y&&h(y)},onRelatedClip:y=>{const $=N.find(W=>W.ClipId===y);$&&h($)}})]})}export{Et as PlayerSelectionPage};
