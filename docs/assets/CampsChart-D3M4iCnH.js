import{u as V,r as C,j as e}from"./index-C3PlggW1.js";import{u as z,b as q,s as G,g as P,d as W,a as _}from"./baseStatsHook-V4nKPFGK.js";import{l as O,a as R}from"./api-beq3FXpM.js";import{b as N,F as T,B as k,C as E,X as M,Y as L,a as D}from"./FullscreenChart-CxG60JtM.js";import{R as S,T as A}from"./CategoricalChart-z32sH3bo.js";import{P as $,a as B}from"./PieChart-TmnCiaBa.js";import{L as K}from"./Legend-bJDUB73W.js";import"./PolarChart-_64kpUVK.js";function I(d,n){if(d.length===0||n.length===0)return null;const y=q(n),h={},m={},r={};let u=0;d.forEach(a=>{const o=a.Game.toString(),i=a["Rôles solo"],c=a["Camp victorieux"],v=a["Liste des joueurs"],F=a["Liste des gagnants"];if(i&&i.toString().trim()!==""&&G(i.toString()).forEach(j=>{const l=j.trim();l!==""&&(h[l]||(h[l]=0),h[l]++)}),c&&c.trim()!==""&&(u++,m[c]||(m[c]=0),m[c]++),o&&v&&c&&F){const b=G(v),j=new Set;b.forEach(l=>{const p=l.trim();if(p){const f=P(y,o,p);j.add(f)}}),j.forEach(l=>{r[l]||(r[l]={totalGames:0,wins:0,winRate:0,players:{}}),r[l].totalGames++}),j.forEach(l=>{W(l,c)&&r[l].wins++}),b.forEach(l=>{const p=l.trim();if(p){const f=P(y,o,l);r[f].players[p]||(r[f].players[p]={games:0,wins:0,winRate:0}),r[f].players[p].games++,_(p,F)&&r[f].players[p].wins++}})}}),Object.keys(r).forEach(a=>{r[a].totalGames>0&&(r[a].winRate=parseFloat((r[a].wins/r[a].totalGames*100).toFixed(2))),Object.keys(r[a].players).forEach(o=>{const i=r[a].players[o];i.games>0&&(i.winRate=parseFloat((i.wins/i.games*100).toFixed(2)))})});const x=[];Object.keys(m).forEach(a=>{x.push({camp:a,wins:m[a],winRate:(m[a]/u*100).toFixed(2)})}),x.sort((a,o)=>o.wins-a.wins);const w=Object.keys(r).map(a=>({camp:a,totalGames:r[a].totalGames,winRate:r[a].winRate.toFixed(2)})),g=new Set;Object.keys(r).forEach(a=>{Object.keys(r[a].players).forEach(o=>{g.add(o)})});const s=g.size,t=[];return Object.keys(h).forEach(a=>{t.push({soloRole:a,appearances:h[a]})}),t.sort((a,o)=>o.appearances-a.appearances),{totalGames:u,campStats:x,soloCamps:t,campAverages:w,totalPlayersAnalyzed:s}}function X(){const{data:d,isLoading:n,error:y}=z(I);return{campWinStats:d,isLoading:n,errorInfo:y}}const Y="#607D8B";function re(){const{navigateToGameDetails:d}=V(),{campWinStats:n,isLoading:y,errorInfo:h}=X(),m=C.useMemo(()=>n?.campAverages?n.campAverages.map(s=>({...s,winRateNum:parseFloat(s.winRate)})).sort((s,t)=>t.winRateNum-s.winRateNum):[],[n]),r=C.useMemo(()=>n?.campStats?.map(s=>({...s,winRateNum:typeof s.winRate=="string"?parseFloat(s.winRate):s.winRate}))||[],[n]),u=C.useMemo(()=>{if(!r.length)return[];const s=5;let t=0;const a=[],o=[];return r.forEach(i=>{i.winRateNum<s?(t+=i.winRateNum,a.push(i)):o.push(i)}),t>0&&o.push({camp:"Autres",wins:a.reduce((i,c)=>i+c.wins,0),winRate:t.toFixed(1),winRateNum:t,_details:a}),o},[r]),x=C.useMemo(()=>m.length?m.slice().filter(s=>s.camp!=="Villageois"&&s.camp!=="Loups").sort((s,t)=>t.totalGames-s.totalGames):[],[m]),w=y,g=h;return w?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques des camps..."}):g?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]}):n?e.jsxs("div",{className:"lycans-camps-container",children:[e.jsx("h2",{children:"Statistiques des Camps"}),n&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camps Analysés"}),e.jsx("div",{className:"lycans-valeur-principale",children:n.campAverages?.length||0}),e.jsx("p",{children:"camps différents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Joueurs Évalués"}),e.jsx("div",{className:"lycans-valeur-principale",children:n.totalPlayersAnalyzed||0}),e.jsx("p",{children:"joueurs analysés"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:n?.totalGames||0}),e.jsx("p",{children:"parties analysées"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[n&&u.length>0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Répartition des Victoires par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Distribution des victoires sur ",n.totalGames," parties"]}),e.jsx("div",{style:{height:450},children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs($,{children:[e.jsx(B,{data:u,cx:"50%",cy:"50%",labelLine:!1,outerRadius:140,fill:"#8884d8",dataKey:"winRateNum",nameKey:"camp",onClick:s=>{if(s&&s.camp)if(s.camp==="Autres"&&s._details){const t=s._details.map(a=>a.camp);d({selectedCamp:"Autres",_smallCamps:t,fromComponent:"Répartition des Victoires par Camp",campFilterMode:"wins-only"})}else d({selectedCamp:s.camp,fromComponent:"Répartition des Victoires par Camp",campFilterMode:"wins-only"})},style:{cursor:"pointer"},label:({camp:s,winRate:t})=>s==="Autres"?`Autres: ${t}%`:`${s}: ${t}%`,children:u.map((s,t)=>e.jsx(N,{fill:s.camp==="Autres"?O:R[s.camp]||Y,onClick:()=>{if(s.camp==="Autres"&&s._details){const a=s._details.map(o=>o.camp);d({selectedCamp:"Autres",_smallCamps:a,fromComponent:"Répartition des Victoires par Camp",campFilterMode:"wins-only"})}else d({selectedCamp:s.camp,fromComponent:"Répartition des Victoires par Camp",campFilterMode:"wins-only"})},style:{cursor:"pointer"}},`cellule-camp-${t}`))}),e.jsx(A,{content:({active:s,payload:t})=>{if(s&&t&&t.length>0){const a=t[0].payload;if(a.camp==="Autres"&&a._details){const o=[...a._details].sort((i,c)=>c.winRateNum-i.winRateNum);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:"Autres"})}),e.jsx("div",{children:o.map((i,c)=>e.jsxs("div",{children:[i.camp,": ",i.wins," victoires (",i.winRate,"%)"]},c))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold"},children:["Total: ",a.wins," victoires (",a.winRate,"%)"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:a.camp}),e.jsxs("div",{children:["Victoires: ",a.wins]}),e.jsxs("div",{children:["Taux de victoire: ",a.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(K,{})]})})})]})}),n?.campAverages&&m.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire Moyen par Camp"}),e.jsx(T,{title:"Taux de Victoire Moyen par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(k,{data:m,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(M,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(L,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(A,{content:({active:s,payload:t})=>{if(s&&t&&t.length>0){const a=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.camp})}),e.jsxs("div",{children:["Parties totales: ",a.totalGames]}),e.jsxs("div",{children:["Taux de victoire: ",a.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(D,{dataKey:"winRateNum",onClick:s=>{s&&s.camp&&d({selectedCamp:s.camp,fromComponent:"Taux de Victoire Moyen par Camp",campFilterMode:"all-assignments"})},style:{cursor:"pointer"},children:m.map((s,t)=>e.jsx(N,{fill:R[s.camp]||`var(--chart-color-${t%6+1})`,onClick:()=>{d({selectedCamp:s.camp,fromComponent:"Taux de Victoire Moyen par Camp",campFilterMode:"all-assignments"})},style:{cursor:"pointer"}},`cell-${t}`))})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Parties par Camp (hors villageois et loups)"}),e.jsx(T,{title:"Distribution des Parties par Camp (hors villageois et loups)",children:e.jsx("div",{style:{height:400},children:e.jsx(S,{width:"100%",height:"100%",children:e.jsxs(k,{data:x,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(M,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(L,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(A,{content:({active:s,payload:t})=>{if(s&&t&&t.length>0){const a=t[0].payload,o=x.reduce((c,v)=>c+v.totalGames,0),i=(a.totalGames/o*100).toFixed(1);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.camp})}),e.jsxs("div",{children:["Parties: ",a.totalGames," (",i,"%)"]}),e.jsxs("div",{children:["Taux victoire: ",a.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(D,{dataKey:"totalGames",onClick:s=>{s&&s.camp&&d({selectedCamp:s.camp,fromComponent:"Distribution des Parties par Camp",campFilterMode:"all-assignments"})},style:{cursor:"pointer"},children:x.map((s,t)=>e.jsx(N,{fill:R[s.camp]||`var(--chart-color-${t%6+1})`,onClick:()=>{d({selectedCamp:s.camp,fromComponent:"Distribution des Parties par Camp",campFilterMode:"all-assignments"})},style:{cursor:"pointer"}},`cell-${t}`))})]})})})})]})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de camp disponible"})}export{re as CampsChart};
