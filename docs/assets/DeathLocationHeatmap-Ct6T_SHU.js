import{r as C,j as t,u as Q,a as oe,e as _}from"./index-DCiOAltF.js";import{u as se,c as ae}from"./useDeathStatisticsFromRaw-CoalcXQV.js";import{g as Z,D as I}from"./datasyncExport-D6_8Fmuy.js";import{a as ie}from"./api-L-491f5v.js";import{F as le,C as ce,X as de,Y as ue,a as fe}from"./FullscreenChart-BDqfXhTV.js";import{g as $}from"./deathTypes-CGUOTngO.js";import{ak as he,al as ee,am as O,an as me,ao as Y,R as pe,T as xe}from"./CategoricalChart-k1xm6MYW.js";import{S as ge,a as ve}from"./ScatterChart-DltguRrz.js";import"./baseStatsHook-CgDVBnDx.js";const ye=be(je);function be(e){return function(i,u,o=u){if(!((u=+u)>=0))throw new RangeError("invalid rx");if(!((o=+o)>=0))throw new RangeError("invalid ry");let{data:r,width:a,height:f}=i;if(!((a=Math.floor(a))>=0))throw new RangeError("invalid width");if(!((f=Math.floor(f!==void 0?f:r.length/a))>=0))throw new RangeError("invalid height");if(!a||!f||!u&&!o)return i;const g=u&&e(u),x=o&&e(o),d=r.slice();return g&&x?(F(g,d,r,a,f),F(g,r,d,a,f),F(g,d,r,a,f),X(x,r,d,a,f),X(x,d,r,a,f),X(x,r,d,a,f)):g?(F(g,r,d,a,f),F(g,d,r,a,f),F(g,r,d,a,f)):x&&(X(x,r,d,a,f),X(x,d,r,a,f),X(x,r,d,a,f)),i}}function F(e,i,u,o,r){for(let a=0,f=o*r;a<f;)e(i,u,a,a+=o,1)}function X(e,i,u,o,r){for(let a=0,f=o*r;a<o;++a)e(i,u,a,a+f,o)}function je(e){const i=Math.floor(e);if(i===e)return Me(e);const u=e-i,o=2*e+1;return(r,a,f,g,x)=>{if(!((g-=x)>=f))return;let d=i*a[f];const l=x*i,y=l+x;for(let h=f,p=f+l;h<p;h+=x)d+=a[Math.min(g,h)];for(let h=f,p=g;h<=p;h+=x)d+=a[Math.min(g,h+l)],r[h]=(d+u*(a[Math.max(f,h-y)]+a[Math.min(g,h+y)]))/o,d-=a[Math.max(f,h-l)]}}function Me(e){const i=2*e+1;return(u,o,r,a,f)=>{if(!((a-=f)>=r))return;let g=e*o[r];const x=f*e;for(let d=r,l=r+x;d<l;d+=f)g+=o[Math.min(a,d)];for(let d=r,l=a;d<=l;d+=f)g+=o[Math.min(a,d+x)],u[d]=g/i,g-=o[Math.max(r,d-x)]}}function Se(e,i){let u=0;for(let o of e)o!=null&&(o=+o)>=o&&++u;return u}function ze(e,i){let u,o;if(i===void 0)for(const r of e)r!=null&&(u===void 0?r>=r&&(u=o=r):(u>r&&(u=r),o<r&&(o=r)));else{let r=-1;for(let a of e)(a=i(a,++r,e))!=null&&(u===void 0?a>=a&&(u=o=a):(u>a&&(u=a),o<a&&(o=a)))}return[u,o]}function Ee(e,i,u){let o;for(;;){const r=he(e,i,u);if(r===o||r===0||!isFinite(r))return[e,i];r>0?(e=Math.floor(e/r)*r,i=Math.ceil(i/r)*r):r<0&&(e=Math.ceil(e*r)/r,i=Math.floor(i*r)/r),o=r}}function Ce(e){return Math.max(1,Math.ceil(Math.log(Se(e))/Math.LN2)+1)}var ke=Array.prototype,te=ke.slice;function we(e,i){return e-i}function De(e){for(var i=0,u=e.length,o=e[u-1][1]*e[0][0]-e[u-1][0]*e[0][1];++i<u;)o+=e[i-1][1]*e[i][0]-e[i-1][0]*e[i][1];return o}const W=e=>()=>e;function Ne(e,i){for(var u=-1,o=i.length,r;++u<o;)if(r=Re(e,i[u]))return r;return 0}function Re(e,i){for(var u=i[0],o=i[1],r=-1,a=0,f=e.length,g=f-1;a<f;g=a++){var x=e[a],d=x[0],l=x[1],y=e[g],h=y[0],p=y[1];if(Ae(x,y,i))return 0;l>o!=p>o&&u<(h-d)*(o-l)/(p-l)+d&&(r=-r)}return r}function Ae(e,i,u){var o;return Le(e,i,u)&&Ie(e[o=+(e[0]===i[0])],u[o],i[o])}function Le(e,i,u){return(i[0]-e[0])*(u[1]-e[1])===(u[0]-e[0])*(i[1]-e[1])}function Ie(e,i,u){return e<=i&&i<=u||u<=i&&i<=e}function Pe(){}var P=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function U(){var e=1,i=1,u=Ce,o=x;function r(d){var l=u(d);if(Array.isArray(l))l=l.slice().sort(we);else{const y=ze(d,We);for(l=ee(...Ee(y[0],y[1],l),l);l[l.length-1]>=y[1];)l.pop();for(;l[1]<y[0];)l.shift()}return l.map(y=>a(d,y))}function a(d,l){const y=l==null?NaN:+l;if(isNaN(y))throw new Error(`invalid value: ${l}`);var h=[],p=[];return f(d,y,function(S){o(S,d,y),De(S)>0?h.push([S]):p.push(S)}),p.forEach(function(S){for(var k=0,m=h.length,n;k<m;++k)if(Ne((n=h[k])[0],S)!==-1){n.push(S);return}}),{type:"MultiPolygon",value:l,coordinates:h}}function f(d,l,y){var h=new Array,p=new Array,S,k,m,n,s,M;for(S=k=-1,n=V(d[0],l),P[n<<1].forEach(b);++S<e-1;)m=n,n=V(d[S+1],l),P[m|n<<1].forEach(b);for(P[n<<0].forEach(b);++k<i-1;){for(S=-1,n=V(d[k*e+e],l),s=V(d[k*e],l),P[n<<1|s<<2].forEach(b);++S<e-1;)m=n,n=V(d[k*e+e+S+1],l),M=s,s=V(d[k*e+S+1],l),P[m|n<<1|s<<2|M<<3].forEach(b);P[n|s<<3].forEach(b)}for(S=-1,s=d[k*e]>=l,P[s<<2].forEach(b);++S<e-1;)M=s,s=V(d[k*e+S+1],l),P[s<<2|M<<3].forEach(b);P[s<<3].forEach(b);function b(z){var E=[z[0][0]+S,z[0][1]+k],w=[z[1][0]+S,z[1][1]+k],D=g(E),R=g(w),c,v;(c=p[D])?(v=h[R])?(delete p[c.end],delete h[v.start],c===v?(c.ring.push(w),y(c.ring)):h[c.start]=p[v.end]={start:c.start,end:v.end,ring:c.ring.concat(v.ring)}):(delete p[c.end],c.ring.push(w),p[c.end=R]=c):(c=h[R])?(v=p[D])?(delete h[c.start],delete p[v.end],c===v?(c.ring.push(w),y(c.ring)):h[v.start]=p[c.end]={start:v.start,end:c.end,ring:v.ring.concat(c.ring)}):(delete h[c.start],c.ring.unshift(E),h[c.start=D]=c):h[D]=p[R]={start:D,end:R,ring:[E,w]}}}function g(d){return d[0]*2+d[1]*(e+1)*4}function x(d,l,y){d.forEach(function(h){var p=h[0],S=h[1],k=p|0,m=S|0,n=G(l[m*e+k]);p>0&&p<e&&k===p&&(h[0]=K(p,G(l[m*e+k-1]),n,y)),S>0&&S<i&&m===S&&(h[1]=K(S,G(l[(m-1)*e+k]),n,y))})}return r.contour=a,r.size=function(d){if(!arguments.length)return[e,i];var l=Math.floor(d[0]),y=Math.floor(d[1]);if(!(l>=0&&y>=0))throw new Error("invalid size");return e=l,i=y,r},r.thresholds=function(d){return arguments.length?(u=typeof d=="function"?d:Array.isArray(d)?W(te.call(d)):W(d),r):u},r.smooth=function(d){return arguments.length?(o=d?x:Pe,r):o===x},r}function We(e){return isFinite(e)?e:NaN}function V(e,i){return e==null?!1:+e>=i}function G(e){return e==null||isNaN(e=+e)?-1/0:e}function K(e,i,u,o){const r=o-i,a=u-i,f=isFinite(r)||isFinite(a)?r/a:Math.sign(r)/Math.sign(a);return isNaN(f)?e:e+f-.5}function Te(e){return e[0]}function Be(e){return e[1]}function Ve(){return 1}function re(){var e=Te,i=Be,u=Ve,o=960,r=500,a=20,f=2,g=a*3,x=o+g*2>>f,d=r+g*2>>f,l=W(20);function y(s){var M=new Float32Array(x*d),b=Math.pow(2,-f),z=-1;for(const N of s){var E=(e(N,++z,s)+g)*b,w=(i(N,z,s)+g)*b,D=+u(N,z,s);if(D&&E>=0&&E<x&&w>=0&&w<d){var R=Math.floor(E),c=Math.floor(w),v=E-R-.5,j=w-c-.5;M[R+c*x]+=(1-v)*(1-j)*D,M[R+1+c*x]+=v*(1-j)*D,M[R+1+(c+1)*x]+=v*j*D,M[R+(c+1)*x]+=(1-v)*j*D}}return ye({data:M,width:x,height:d},a*b),M}function h(s){var M=y(s),b=l(M),z=Math.pow(2,2*f);return Array.isArray(b)||(b=ee(Number.MIN_VALUE,O(M)/z,b)),U().size([x,d]).thresholds(b.map(E=>E*z))(M).map((E,w)=>(E.value=+b[w],p(E)))}h.contours=function(s){var M=y(s),b=U().size([x,d]),z=Math.pow(2,2*f),E=w=>{w=+w;var D=p(b.contour(M,w*z));return D.value=w,D};return Object.defineProperty(E,"max",{get:()=>O(M)/z}),E};function p(s){return s.coordinates.forEach(S),s}function S(s){s.forEach(k)}function k(s){s.forEach(m)}function m(s){s[0]=s[0]*Math.pow(2,f)-g,s[1]=s[1]*Math.pow(2,f)-g}function n(){return g=a*3,x=o+g*2>>f,d=r+g*2>>f,h}return h.x=function(s){return arguments.length?(e=typeof s=="function"?s:W(+s),h):e},h.y=function(s){return arguments.length?(i=typeof s=="function"?s:W(+s),h):i},h.weight=function(s){return arguments.length?(u=typeof s=="function"?s:W(+s),h):u},h.size=function(s){if(!arguments.length)return[o,r];var M=+s[0],b=+s[1];if(!(M>=0&&b>=0))throw new Error("invalid size");return o=M,r=b,n()},h.cellSize=function(s){if(!arguments.length)return 1<<f;if(!((s=+s)>=1))throw new Error("invalid cell size");return f=Math.floor(Math.log(s)/Math.LN2),n()},h.thresholds=function(s){return arguments.length?(l=typeof s=="function"?s:Array.isArray(s)?W(te.call(s)):W(s),h):l},h.bandwidth=function(s){if(!arguments.length)return Math.sqrt(a*(a+1));if(!((s=+s)>=0))throw new Error("invalid bandwidth");return a=(Math.sqrt(4*s*s+1)-1)/2,n()},h}function Fe(e){for(var i=e.length/6|0,u=new Array(i),o=0;o<i;)u[o]="#"+e.slice(o*6,++o*6);return u}const Xe=e=>me(e[e.length-1]);var qe=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Fe);const ne=Xe(qe);function $e(e){return e==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":e}function J(e,i){const u=[],o={x:166.35,z:176.22};return e.forEach(r=>{r.PlayerStats.filter(a=>a.DeathPosition!==null).filter(a=>!i||i==="Tous les camps"?!0:Z(a.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===i).forEach(a=>{if(a.DeathPosition){const f=Z(a.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1}),g=r.MapName==="Village",x=g?a.DeathPosition.x-o.x:a.DeathPosition.x,d=g?a.DeathPosition.z-o.z:a.DeathPosition.z;u.push({x,z:d,playerName:a.Username,deathType:$e(a.DeathType),mapName:r.MapName,killerName:a.KillerName||null,camp:f,gameId:r.DisplayedId,displayedGameId:r.DisplayedId})}})}),u}function He(e){const i=new Set;return e.forEach(u=>{u.PlayerStats.some(r=>r.DeathPosition!==null)&&u.MapName&&i.add(u.MapName)}),Array.from(i).sort()}function Ye({deathLocations:e,xDomain:i,zDomain:u,width:o=800,height:r=600,bandwidth:a=25,onRegionClick:f}){const g=C.useRef(null),x=C.useRef(null),d=C.useRef(null),l=C.useMemo(()=>Y().domain(i).range([0,o]),[i,o]),y=C.useMemo(()=>Y().domain(u).range([r,0]),[u,r]),h=C.useMemo(()=>e.length===0?[]:re().x(n=>l(n.x)).y(n=>y(n.z)).size([o,r]).bandwidth(a).thresholds(15)(e),[e,l,y,o,r,a]),p=C.useMemo(()=>{const m=h.length>0?Math.max(...h.map(n=>n.value)):1;return n=>{const s=n/m;return ne(s)}},[h]);C.useEffect(()=>{const m=g.current;if(!m||h.length===0)return;const n=m.getContext("2d");n&&(n.clearRect(0,0,o,r),h.forEach(s=>{n.fillStyle=p(s.value),n.globalAlpha=.6,s.coordinates.forEach(M=>{M.forEach(b=>{n.beginPath(),b.forEach((z,E)=>{E===0?n.moveTo(z[0],z[1]):n.lineTo(z[0],z[1])}),n.closePath(),n.fill()})})}),n.globalAlpha=1)},[h,o,r,p]),C.useEffect(()=>{const m=x.current;if(!m||e.length===0)return;const n=m.getContext("2d");n&&(n.clearRect(0,0,o,r),e.forEach(s=>{const M=l(s.x),b=y(s.z);n.beginPath(),n.arc(M,b,2,0,2*Math.PI),n.fillStyle="rgba(0, 0, 0, 0.3)",n.fill(),n.strokeStyle="rgba(255, 255, 255, 0.5)",n.lineWidth=.5,n.stroke()}))},[e,l,y,o,r]);const S=m=>{if(!f||!d.current)return;const n=d.current.getBoundingClientRect(),s=m.clientX-n.left,M=m.clientY-n.top,b=30,z=e.filter(E=>{const w=l(E.x),D=y(E.z);return Math.sqrt(Math.pow(w-s,2)+Math.pow(D-M,2))<=b});z.length>0&&f(z)},k=m=>{if(!d.current)return;const n=d.current.getBoundingClientRect(),s=m.clientX-n.left,M=m.clientY-n.top,b=20,z=e.filter(E=>{const w=l(E.x),D=y(E.z);return Math.sqrt(Math.pow(w-s,2)+Math.pow(D-M,2))<=b});d.current&&(d.current.style.cursor=z.length>0?"pointer":"default")};return t.jsxs("div",{ref:d,style:{position:"relative",width:`${o}px`,height:`${r}px`,margin:"0 auto"},onClick:S,onMouseMove:k,children:[t.jsx("canvas",{ref:g,width:o,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),t.jsx("canvas",{ref:x,width:o,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),t.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),t.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),t.jsxs("svg",{width:o,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(m=>{const n=o*m,s=i[0]+(i[1]-i[0])*m;return t.jsxs("g",{children:[t.jsx("line",{x1:n,y1:r,x2:n,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:n,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(s)})]},`x-${m}`)}),[0,.25,.5,.75,1].map(m=>{const n=r*(1-m),s=u[0]+(u[1]-u[0])*m;return t.jsxs("g",{children:[t.jsx("line",{x1:0,y1:n,x2:5,y2:n,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:10,y:n,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(s)})]},`z-${m}`)})]})]})}function Ge({selectedCamp:e,availableDeathTypes:i,deathTypeColors:u}){const{navigateToGameDetails:o}=Q(),{settings:r}=oe(),{data:a,isLoading:f,error:g}=_(),[x,d]=C.useState(""),[l,y]=C.useState("all"),[h,p]=C.useState(null),[S,k]=C.useState("scatter"),m=C.useMemo(()=>{if(!a)return[];const c=He(a),v=J(a,e),j=new Map;return v.forEach(N=>{j.set(N.mapName,(j.get(N.mapName)||0)+1)}),c.sort((N,L)=>{const T=j.get(N)||0;return(j.get(L)||0)-T})},[a,e]),n=m.length>0?m[0]:"";x===""&&n!==""&&d(n);const s=C.useMemo(()=>{if(!a)return[];let c=J(a,e);return x&&(c=c.filter(v=>v.mapName===x)),l!=="all"&&(c=c.filter(v=>v.deathType===l)),c},[a,e,x,l]),M=C.useMemo(()=>{const c=new Map;return s.forEach(v=>{const j=`${Math.round(v.x)}_${Math.round(v.z)}`;c.has(j)||c.set(j,[]),c.get(j).push(v)}),c},[s]),b=C.useMemo(()=>Array.from(M.entries()).map(([c,v])=>({...v[0],deathCount:v.length,allDeaths:v,locationKey:c})),[M]),z=({active:c,payload:v})=>{if(!c||!v||v.length===0)return null;const j=v[0].payload,N=`${Math.round(j.x)}_${Math.round(j.z)}`,L=M.get(N)||[j];if(L.length>1){const B=new Map,q=new Set;return L.forEach(A=>{const H=A.deathType?$(A.deathType):"Inconnu";B.set(H,(B.get(H)||0)+1),q.add(A.gameId)}),t.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[t.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:[L.length," morts Ã  cet endroit"]}),t.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[t.jsxs("div",{style:{marginBottom:"8px"},children:[t.jsx("strong",{children:"Position:"})," (",Math.round(j.x),", ",Math.round(j.z),")"]}),t.jsxs("div",{style:{marginBottom:"8px"},children:[t.jsx("strong",{children:"Types de mort:"}),t.jsx("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:Array.from(B.entries()).map(([A,H])=>t.jsxs("li",{children:[A," (",H,")"]},A))})]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Parties:"})," ",Array.from(q).filter(A=>A).map(A=>`#${A}`).join(", ")]})]}),t.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir une des parties"})]})}return t.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[t.jsx("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:j.playerName}),t.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Camp:"})," ",j.camp]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Type de mort:"})," ",j.deathType?$(j.deathType):"Inconnu"]}),j.killerName&&t.jsxs("div",{children:[t.jsx("strong",{children:"TuÃ© par:"})," ",j.killerName]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Carte:"})," ",j.mapName]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Partie:"})," #",j.gameId]}),t.jsxs("div",{style:{marginTop:"4px",fontSize:"0.85rem",color:"var(--text-secondary)"},children:["Position: (",Math.round(j.x),", ",Math.round(j.z),")"]})]}),t.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})},E=c=>{if(!c)return;const v=c.allDeaths||[c];if(v.length===1)o({selectedGame:v[0].gameId,fromComponent:"Death Location View"});else{const j=v.map(N=>N.gameId).filter(N=>N);o({selectedGameIds:j,fromComponent:"Death Location View"})}},w=c=>c&&u[c]||"var(--text-secondary)",{xDomain:D,zDomain:R}=C.useMemo(()=>{if(b.length===0)return{xDomain:[0,100],zDomain:[0,100]};const c=b.map(A=>A.x),v=b.map(A=>A.z),j=Math.min(...c),N=Math.max(...c),L=Math.min(...v),T=Math.max(...v),B=(N-j)*.1||10,q=(T-L)*.1||10;return{xDomain:[j-B,N+B],zDomain:[L-q,T+q]}},[b]);return f?t.jsx("div",{className:"donnees-attente",children:"Chargement des localisations de mort..."}):g?t.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",g]}):a?t.jsxs("div",{children:[t.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Mode :"}),t.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[t.jsx("button",{onClick:()=>k("scatter"),style:{background:S==="scatter"?"var(--accent-primary)":"transparent",color:S==="scatter"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:S==="scatter"?"bold":"normal",transition:"all 0.2s"},children:"Points"}),t.jsx("button",{onClick:()=>k("heatmap"),style:{background:S==="heatmap"?"var(--accent-primary)":"transparent",color:S==="heatmap"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:S==="heatmap"?"bold":"normal",transition:"all 0.2s"},children:"Carte de chaleur"})]})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),t.jsx("select",{id:"map-select",value:x,onChange:c=>d(c.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:m.map(c=>t.jsx("option",{value:c,children:c},c))})]}),t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"death-type-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Type de mort :"}),t.jsxs("select",{id:"death-type-select",value:l,onChange:c=>y(c.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[t.jsx("option",{value:"all",children:"Tous les types"}),i.map(c=>t.jsx("option",{value:c,children:$(c)},c))]})]})]}),t.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Morts localisÃ©es"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary)"},children:s.length})]}),t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Camp filtrÃ©"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)",fontSize:"1.2rem"},children:e})]}),t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Type de mort"}),t.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-2)",fontSize:"1.2rem"},children:l==="all"?"Tous":$(l)})]})]}),s.length>0?t.jsx(le,{title:S==="scatter"?"Carte des Morts":"Carte de Chaleur des Morts",children:S==="scatter"?t.jsx("div",{style:{height:600,width:800},children:t.jsx(pe,{width:"100%",height:"100%",children:t.jsxs(ge,{margin:{top:20,right:30,left:60,bottom:60},children:[t.jsx(ce,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),t.jsx(de,{dataKey:"x",type:"number",name:"Position X",label:{value:"Position X",position:"bottom",offset:10,style:{fill:"var(--text-secondary)"}},domain:D,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:c=>Math.round(c).toString()}),t.jsx(ue,{dataKey:"z",type:"number",name:"Position Z",label:{value:"Position Z",angle:-90,position:"left",offset:20,style:{fill:"var(--text-secondary)"}},domain:R,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:c=>Math.round(c).toString()}),t.jsx(xe,{content:t.jsx(z,{}),cursor:{strokeDasharray:"3 3"}}),t.jsx(ve,{data:b,onClick:c=>E(c),onMouseEnter:c=>p(c),onMouseLeave:()=>p(null),style:{cursor:"pointer"},children:b.map((c,v)=>{const j=r.highlightedPlayer===c.playerName,N=h?.playerName===c.playerName&&h?.gameId===c.gameId,L=c.deathCount>1?7:5,T=L+2;return t.jsx(fe,{fill:j?"var(--accent-primary)":w(c.deathType),stroke:j||N?"white":c.deathCount>1?"var(--accent-secondary)":"none",strokeWidth:j?3:N?2:c.deathCount>1?1:0,opacity:j?1:.7,r:j?T:N?L+1:L},`cell-${v}`)})})]})})}):t.jsx("div",{style:{padding:"2rem 0",display:"flex",justifyContent:"center"},children:t.jsx(Ye,{deathLocations:s,xDomain:D,zDomain:R,width:800,height:600,bandwidth:25,onRegionClick:c=>{if(c.length===1)o({selectedGame:c[0].gameId,fromComponent:"Death Location View (Heatmap)"});else{const v=c.map(j=>j.gameId).filter(j=>j);o({selectedGameIds:v,fromComponent:"Death Location View (Heatmap)"})}}})})}):t.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[t.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1rem"},children:"Aucune localisation de mort disponible pour les filtres sÃ©lectionnÃ©s"}),t.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes (non-legacy)."})]}),s.length>0&&t.jsxs("div",{style:{marginTop:"2rem",padding:"1rem",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[t.jsx("h3",{style:{marginBottom:"1rem",color:"var(--text-primary)"},children:"LÃ©gende des types de mort"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem"},children:i.map(c=>{const v=s.filter(j=>j.deathType===c).length;return v===0?null:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.9rem"},children:[t.jsx("div",{style:{width:"16px",height:"16px",borderRadius:"50%",backgroundColor:u[c],flexShrink:0}}),t.jsxs("span",{style:{color:"var(--text-primary)"},children:[$(c)," (",v,")"]})]},c)})})]}),t.jsxs("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:[t.jsx("p",{children:t.jsx("strong",{children:"Ã€ propos de cette visualisation :"})}),t.jsxs("ul",{style:{marginTop:"0.5rem",paddingLeft:"1.5rem"},children:[t.jsx("li",{children:"Les positions sont basÃ©es sur les coordonnÃ©es X et Z (vue 2D de la carte)"}),S==="scatter"?t.jsxs(t.Fragment,{children:[t.jsx("li",{children:"Chaque point reprÃ©sente la mort d'un joueur Ã  un endroit prÃ©cis"}),t.jsx("li",{children:"La couleur indique le type de mort (voir lÃ©gende ci-dessus)"}),t.jsxs("li",{children:["Les joueurs en surbrillance sont affichÃ©s en "," ",t.jsx("span",{style:{color:"var(--accent-primary)",fontWeight:"bold"},children:"couleur primaire"})]}),t.jsx("li",{children:"Cliquez sur un point pour voir les dÃ©tails de la partie"}),t.jsx("li",{children:"Survolez un point pour voir les informations dÃ©taillÃ©es"})]}):t.jsxs(t.Fragment,{children:[t.jsx("li",{children:"La carte de chaleur montre les zones de forte densitÃ© de morts (du jaune au rouge)"}),t.jsx("li",{children:"Les points noirs indiquent l'emplacement exact de chaque mort"}),t.jsx("li",{children:"Les zones rouges indiquent une concentration Ã©levÃ©e de morts"}),t.jsx("li",{children:"Cliquez sur une zone pour voir les dÃ©tails des parties associÃ©es"}),t.jsx("li",{children:'Utilisez le mode "Points" pour voir les dÃ©tails individuels par type de mort'})]})]}),t.jsx("p",{style:{marginTop:"0.5rem",fontStyle:"italic",color:"var(--text-secondary)"},children:"Note : Seules les parties rÃ©centes contiennent des donnÃ©es de position. Les parties legacy sont exclues."})]})]}):t.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function rt({deathLocations:e,xDomain:i,zDomain:u,width:o=800,height:r=600,bandwidth:a=25,onRegionClick:f}){const g=C.useRef(null),x=C.useRef(null),d=C.useRef(null),l=C.useMemo(()=>Y().domain(i).range([0,o]),[i,o]),y=C.useMemo(()=>Y().domain(u).range([r,0]),[u,r]),h=C.useMemo(()=>e.length===0?[]:re().x(n=>l(n.x)).y(n=>y(n.z)).size([o,r]).bandwidth(a).thresholds(15)(e),[e,l,y,o,r,a]),p=C.useMemo(()=>{const m=h.length>0?Math.max(...h.map(n=>n.value)):1;return n=>{const s=n/m;return ne(s)}},[h]);C.useEffect(()=>{const m=g.current;if(!m||h.length===0)return;const n=m.getContext("2d");n&&(n.clearRect(0,0,o,r),h.forEach(s=>{n.fillStyle=p(s.value),n.globalAlpha=.6,s.coordinates.forEach(M=>{M.forEach(b=>{n.beginPath(),b.forEach((z,E)=>{E===0?n.moveTo(z[0],z[1]):n.lineTo(z[0],z[1])}),n.closePath(),n.fill()})})}),n.globalAlpha=1)},[h,o,r,p]),C.useEffect(()=>{const m=x.current;if(!m||e.length===0)return;const n=m.getContext("2d");n&&(n.clearRect(0,0,o,r),e.forEach(s=>{const M=l(s.x),b=y(s.z);n.beginPath(),n.arc(M,b,2,0,2*Math.PI),n.fillStyle="rgba(0, 0, 0, 0.3)",n.fill(),n.strokeStyle="rgba(255, 255, 255, 0.5)",n.lineWidth=.5,n.stroke()}))},[e,l,y,o,r]);const S=m=>{if(!f||!d.current)return;const n=d.current.getBoundingClientRect(),s=m.clientX-n.left,M=m.clientY-n.top,b=30,z=e.filter(E=>{const w=l(E.x),D=y(E.z);return Math.sqrt(Math.pow(w-s,2)+Math.pow(D-M,2))<=b});z.length>0&&f(z)},k=m=>{if(!d.current)return;const n=d.current.getBoundingClientRect(),s=m.clientX-n.left,M=m.clientY-n.top,b=20,z=e.filter(E=>{const w=l(E.x),D=y(E.z);return Math.sqrt(Math.pow(w-s,2)+Math.pow(D-M,2))<=b});d.current&&(d.current.style.cursor=z.length>0?"pointer":"default")};return t.jsxs("div",{ref:d,style:{position:"relative",width:`${o}px`,height:`${r}px`,margin:"0 auto"},onClick:S,onMouseMove:k,children:[t.jsx("canvas",{ref:g,width:o,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),t.jsx("canvas",{ref:x,width:o,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),t.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),t.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),t.jsxs("svg",{width:o,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(m=>{const n=o*m,s=i[0]+(i[1]-i[0])*m;return t.jsxs("g",{children:[t.jsx("line",{x1:n,y1:r,x2:n,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:n,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(s)})]},`x-${m}`)}),[0,.25,.5,.75,1].map(m=>{const n=r*(1-m),s=u[0]+(u[1]-u[0])*m;return t.jsxs("g",{children:[t.jsx("line",{x1:0,y1:n,x2:5,y2:n,stroke:"var(--text-secondary)",strokeWidth:1}),t.jsx("text",{x:10,y:n,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(s)})]},`z-${m}`)})]})]})}function nt(){const{navigationState:e,updateNavigationState:i}=Q(),[u,o]=C.useState(e.deathLocationState?.selectedCamp||"Tous les camps"),{data:r}=se(),{data:a}=_(),f=ie();C.useEffect(()=>{(!e.deathLocationState||e.deathLocationState.selectedCamp!==u)&&i({deathLocationState:{selectedCamp:u}})},[u,e.deathLocationState,i]);const g=C.useMemo(()=>a?ae(a):[],[a]),x=C.useMemo(()=>{const l={};g.forEach(p=>{p===I.BY_WOLF?l[p]=f.Loup:p===I.VOTED?l[p]="var(--chart-color-1)":p===I.BULLET||p===I.BULLET_HUMAN||p===I.BULLET_WOLF?l[p]=f.Chasseur:p===I.BY_ZOMBIE?l[p]=f.Vaudou:p===I.ASSASSIN?l[p]=f.Alchimiste:p===I.AVENGER?l[p]="var(--chart-color-2)":p===I.LOVER_DEATH?l[p]=f.Amoureux:p===I.BY_BEAST?l[p]="var(--chart-color-3)":p===I.SHERIF_SUCCESS&&(l[p]="var(--chart-color-4)")});const y=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let h=0;return g.forEach(p=>{l[p]||(l[p]=y[h%y.length],h++)}),l},[g,f]),d=l=>{o(l),i({deathLocationState:{selectedCamp:l}})};return t.jsxs("div",{className:"lycans-general-stats",children:[t.jsx("h2",{children:"ðŸ—ºï¸ Carte de Chaleur des Morts"}),t.jsx("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:t.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[t.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),t.jsxs("select",{id:"camp-select",value:u,onChange:l=>d(l.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[t.jsx("option",{value:"Tous les camps",children:"Tous les camps"},"tous"),r?.filter(l=>l!=="Tous les camps").map(l=>t.jsx("option",{value:l,children:l},l))]})]})}),t.jsx(Ge,{selectedCamp:u,availableDeathTypes:g,deathTypeColors:x})]})}export{nt as DeathLocationHeatmap,rt as DeathLocationHeatmapCanvas};
