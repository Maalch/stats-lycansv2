import{s as k,k as E,l as V,a as S,r as y,j as e}from"./index-BTTwzeiW.js";import{a as z}from"./baseStatsHook-CvsaAAG3.js";import{a as R,g as w}from"./datasyncExport-BirWLS1z.js";import{b as I,l as L}from"./api-CGa1aEsR.js";import{a as v,F as b,C as F,X as A,Y as N}from"./FullscreenChart-zTZ54EAZ.js";import{R as j,T as C}from"./CategoricalChart-BJ2MHWcm.js";import{P as W,a as D}from"./PieChart-BCvI9Xy4.js";import{B as M,a as P}from"./BarChart-DihPCXVe.js";import"./PolarChart-CcoQVjSy.js";function _(i){const s={};return i.forEach(o=>{const n=o.Id;s[n]||(s[n]={}),o.PlayerStats.forEach(c=>{const l=c.Username,x=c.MainRoleInitial==="Louveteau"?c.MainRoleInitial:R(c.MainRoleInitial,c.MainRoleChanges||[]);let h=w(x);l&&h&&(s[n][l]=h)})}),s}function T(i,s,o){return i[s]?.[o]||"Villageois"}function q(i){const s=[],o=["Villageois","Loup"];return i.PlayerStats.forEach(n=>{const c=n.MainRoleInitial==="Louveteau"?n.MainRoleInitial:R(n.MainRoleInitial,n.MainRoleChanges||[]);let l=w(c);l&&!o.includes(l)&&s.push(l)}),s}function $(i){const s=i.PlayerStats.filter(c=>c.Victorious);if(s.length===0)return null;const o=s[0].MainRoleInitial==="Louveteau"?s[0].MainRoleInitial:R(s[0].MainRoleInitial,s[0].MainRoleChanges||[]);return w(o,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0})}function O(i){return i.PlayerStats.map(s=>s.Username).join(", ")}function B(i){return i.PlayerStats.filter(s=>s.Victorious).map(s=>s.Username).join(", ")}function K(i,s){i.forEach(o=>{const n=o.trim();n!==""&&(s[n]||(s[n]=0),s[n]++)})}function U(i,s){return i&&i.trim()!==""?(s[i]||(s[i]=0),s[i]++,!0):!1}function X(i,s,o,n,c,l){const x=k(s),h=new Set;x.forEach(d=>{const u=d.trim();if(u){const p=T(c,i,u);h.add(p)}}),h.forEach(d=>{l[d]||(l[d]={totalGames:0,wins:0,winRate:0,players:{}}),l[d].totalGames++}),h.forEach(d=>{E(d,o)&&l[d].wins++}),x.forEach(d=>{const u=d.trim();if(u){const p=T(c,i,d);l[p].players[u]||(l[p].players[u]={games:0,wins:0,winRate:0}),l[p].players[u].games++,V(u,n)&&l[p].players[u].wins++}})}function Y(i){Object.keys(i).forEach(s=>{i[s].totalGames>0&&(i[s].winRate=parseFloat((i[s].wins/i[s].totalGames*100).toFixed(2))),Object.keys(i[s].players).forEach(o=>{const n=i[s].players[o];n.games>0&&(n.winRate=parseFloat((n.wins/n.games*100).toFixed(2)))})})}function J(i,s){const o=[];return Object.keys(i).forEach(n=>{o.push({camp:n,wins:i[n],winRate:(i[n]/s*100).toFixed(2)})}),o.sort((n,c)=>c.wins-n.wins),o}function H(i){return Object.keys(i).map(s=>({camp:s,totalGames:i[s].totalGames,wins:i[s].wins,winRate:i[s].winRate.toFixed(2)}))}function Q(i){const s=new Set;return Object.keys(i).forEach(o=>{Object.keys(i[o].players).forEach(n=>{s.add(n)})}),s.size}function Z(i){const s=[];return Object.keys(i).forEach(o=>{s.push({soloRole:o,appearances:i[o]})}),s.sort((o,n)=>n.appearances-o.appearances),s}function ee(i){if(i.length===0)return null;const s=_(i),o={},n={},c={};let l=0;i.forEach(p=>{const t=p.Id,r=q(p),a=$(p),f=O(p),m=B(p);K(r,o),U(a||"",n)&&l++,t&&f&&a&&m&&X(t,f,a,m,s,c)}),Y(c);const x=J(n,l),h=H(c),d=Q(c),u=Z(o);return{totalGames:l,campStats:x,soloCamps:u,campAverages:h,totalPlayersAnalyzed:d}}function se(){const{data:i,isLoading:s,error:o}=z(ee);return{campWinStats:i,isLoading:s,errorInfo:o}}const te="#607D8B";function pe(){const{navigateToGameDetails:i}=S(),{campWinStats:s,isLoading:o,errorInfo:n}=se(),c=I(),l=y.useMemo(()=>s?.campAverages?s.campAverages.map(t=>({...t,winRateNum:parseFloat(t.winRate)})).sort((t,r)=>r.winRateNum-t.winRateNum):[],[s]),x=y.useMemo(()=>s?.campStats?.map(t=>({...t,winRateNum:typeof t.winRate=="string"?parseFloat(t.winRate):t.winRate}))||[],[s]),h=y.useMemo(()=>{if(!x.length)return[];const t=5;let r=0;const a=[],f=[];return x.forEach(m=>{m.winRateNum<t?(r+=m.winRateNum,a.push(m)):f.push(m)}),r>0&&f.push({camp:"Autres",wins:a.reduce((m,g)=>m+g.wins,0),winRate:r.toFixed(1),winRateNum:r,_details:a}),f},[x]),d=y.useMemo(()=>l.length?l.slice().filter(t=>t.camp!=="Villageois"&&t.camp!=="Loup").sort((t,r)=>r.totalGames-t.totalGames):[],[l]),u=o,p=n;return u?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques des camps..."}):p?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",p]}):s?e.jsxs("div",{className:"lycans-camps-container",children:[e.jsx("h2",{children:"Statistiques des Camps"}),s&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camps Analys√©s"}),e.jsx("div",{className:"lycans-valeur-principale",children:s.campAverages?.length||0}),e.jsx("p",{children:"camps diff√©rents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Joueurs √âvalu√©s"}),e.jsx("div",{className:"lycans-valeur-principale",children:s.totalPlayersAnalyzed||0}),e.jsx("p",{children:"joueurs analys√©s"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:s?.totalGames||0}),e.jsx("p",{children:"parties analys√©es"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[s&&h.length>0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"R√©partition des Victoires par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Distribution des victoires sur ",s.totalGames," parties"]}),e.jsx("div",{style:{height:450},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(W,{children:[e.jsx(D,{data:h,cx:"50%",cy:"50%",labelLine:!1,outerRadius:140,fill:"#8884d8",dataKey:"winRateNum",nameKey:"camp",onClick:t=>{if(t&&t.camp)if(t.camp==="Autres"&&t._details){const r=t._details.map(a=>a.camp);i({campFilter:{selectedCamp:"Autres",campFilterMode:"wins-only",_smallCamps:r},fromComponent:"R√©partition des Victoires par Camp"})}else i({campFilter:{selectedCamp:t.camp,campFilterMode:"wins-only"},fromComponent:"R√©partition des Victoires par Camp"})},style:{cursor:"pointer"},label:({payload:t})=>{if(!t)return"";const{camp:r,winRate:a}=t;return r==="Autres"?`Autres: ${a}%`:`${r}: ${a}%`},children:h.map((t,r)=>e.jsx(v,{fill:t.camp==="Autres"?L:c[t.camp]||te,onClick:()=>{if(t.camp==="Autres"&&t._details){const a=t._details.map(f=>f.camp);i({campFilter:{selectedCamp:"Autres",campFilterMode:"wins-only",_smallCamps:a},fromComponent:"R√©partition des Victoires par Camp"})}else i({campFilter:{selectedCamp:t.camp,campFilterMode:"wins-only"},fromComponent:"R√©partition des Victoires par Camp"})},style:{cursor:"pointer"}},`cellule-camp-${r}`))}),e.jsx(C,{content:({active:t,payload:r})=>{if(t&&r&&r.length>0){const a=r[0].payload;if(a.camp==="Autres"&&a._details){const f=[...a._details].sort((m,g)=>g.winRateNum-m.winRateNum);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:"Autres"})}),e.jsx("div",{children:f.map((m,g)=>e.jsxs("div",{children:[m.camp,": ",m.wins," victoires (",m.winRate,"%)"]},g))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold"},children:["Total: ",a.wins," victoires (",a.winRate,"%)"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:a.camp}),e.jsxs("div",{children:["Victoires: ",a.wins]}),e.jsxs("div",{children:["Taux de victoire: ",a.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}})]})})})]})}),s?.campAverages&&l.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire Moyen par Camp"}),e.jsx(b,{title:"Taux de Victoire Moyen par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(M,{data:l,margin:{top:50,right:30,left:20,bottom:0},children:[e.jsx(F,{strokeDasharray:"3 3"}),e.jsx(A,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11,tick:({x:t,y:r,payload:a})=>e.jsx("text",{x:t,y:r,dy:14,textAnchor:"end",fill:"var(--text-secondary)",fontSize:11,transform:`rotate(-45 ${t} ${r})`,children:a.value})}),e.jsx(N,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(C,{content:({active:t,payload:r})=>{if(t&&r&&r.length>0){const a=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.camp})}),e.jsxs("div",{children:["Victoires : ",a.wins," / ",a.totalGames]}),e.jsxs("div",{children:["Taux de victoire: ",a.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(P,{dataKey:"winRateNum",onClick:t=>{t&&t.camp&&i({campFilter:{selectedCamp:t.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Taux de Victoire Moyen par Camp"})},style:{cursor:"pointer"},children:l.map((t,r)=>e.jsx(v,{fill:c[t.camp]||`var(--chart-color-${r%6+1})`,onClick:()=>{i({campFilter:{selectedCamp:t.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Taux de Victoire Moyen par Camp"})},style:{cursor:"pointer"}},`cell-${r}`))})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Parties par Camp (hors villageois et loups)"}),e.jsx(b,{title:"Distribution des Parties par Camp (hors villageois et loups)",children:e.jsx("div",{style:{height:400},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(M,{data:d,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(F,{strokeDasharray:"3 3"}),e.jsx(A,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11,tick:({x:t,y:r,payload:a})=>e.jsx("text",{x:t,y:r,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:11,transform:`rotate(-45 ${t} ${r})`,children:a.value})}),e.jsx(N,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(C,{content:({active:t,payload:r})=>{if(t&&r&&r.length>0){const a=r[0].payload,f=d.reduce((g,G)=>g+G.totalGames,0),m=(a.totalGames/f*100).toFixed(1);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.camp})}),e.jsxs("div",{children:["Parties: ",a.totalGames," (",m,"%)"]}),e.jsxs("div",{children:["Taux victoire: ",a.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),e.jsx(P,{dataKey:"totalGames",onClick:t=>{t&&t.camp&&i({campFilter:{selectedCamp:t.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Distribution des Parties par Camp"})},style:{cursor:"pointer"},children:d.map((t,r)=>e.jsx(v,{fill:c[t.camp]||`var(--chart-color-${r%6+1})`,onClick:()=>{i({campFilter:{selectedCamp:t.camp,campFilterMode:"all-assignments",_smallCamps:[]},fromComponent:"Distribution des Parties par Camp"})},style:{cursor:"pointer"}},`cell-${r}`))})]})})})})]})]})]}),e.jsx("div",{className:"lycans-stats-note",style:{marginTop:"2rem",padding:"1rem",textAlign:"center",color:"var(--text-secondary)",fontSize:"0.9rem",fontStyle:"italic"},children:"Statistiques bas√©es sur les r√¥les effectifs des joueurs √† la fin des parties."})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de camp disponible"})}export{pe as CampsChart};
