import{a as pe,r as D,g as te,f as ze,u as ne,j as e,d as he,e as $e,q as Le}from"./index-B1pCjTsu.js";import{u as ue}from"./useJoueursData-ahiuiFfN.js";import{u as ve}from"./baseStatsHook-DiYyJfGB.js";import{g as We}from"./gameUtils-rkfcKAVy.js";import{a as ke,g as ce,c as Te,b as Ie}from"./datasyncExport-BirWLS1z.js";import{u as ge,g as qe,b as oe,l as Ge,C as ie,f as je}from"./api-XewFc6Ck.js";import{f as re,d as Ee}from"./durationFormatters-C9UyWcKX.js";import{F as Y,C as J,X as Q,Y as X,a as Z}from"./FullscreenChart-Bul9-nX6.js";import{R as K,T as H}from"./CategoricalChart-Bkc-fuOV.js";import{L as Ve,a as Be}from"./LineChart-CxSzkVVW.js";import{B as ee,a as O}from"./BarChart-B40daLtz.js";import{P as Ne,a as Pe}from"./PieChart-t_bEey71.js";import{g as de}from"./deathTypes-gHH1w6_X.js";import{i as be,g as Ce,V as Oe,a as Ke}from"./roleUtils-g252S1-m.js";import{L as De}from"./Legend-DsofLywM.js";import{S as He,R as ae,e as _e,f as Ue,h as me,a as Ye,b as Je,d as Qe}from"./deathLocationUtils-CzErAolu.js";import{a as Xe,u as Ze}from"./useClips-CypdeU7k.js";import{C as et,f as Se,a as tt}from"./ClipViewer-D92E65yq.js";import"./ActivePoints-BsHR5RfB.js";import"./PolarChart-C-3tJfNy.js";function st(s){const{settings:c}=pe(),{joueursData:g}=ue(),[y,j]=D.useState(null),[a,h]=D.useState(!1),[p,i]=D.useState(null);D.useEffect(()=>{let d=!0;return(async()=>{try{h(!0),i(null);const l=c.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",r=await fetch(l);if(!r.ok)throw new Error(`Failed to load achievements: ${r.status} ${r.statusText}`);const u=await r.json();d&&j(u)}catch(l){d&&i(l instanceof Error?l.message:"Failed to load achievements")}finally{d&&h(!1)}})(),()=>{d=!1}},[c.dataSource]);const n=(()=>{if(!s||!y)return null;const o=g?.Players?.find(l=>l.Joueur===s)?.SteamID;return o&&y.achievements[o]||null})();return D.useEffect(()=>{s&&y&&g&&g.Players?.find(l=>l.Joueur===s)?.SteamID},[s,y,g,c.dataSource]),{data:n,isLoading:a,error:p,metadata:{generatedAt:y?.generatedAt||null,totalPlayers:y?.totalPlayers||0,totalGames:y?.totalGames||0,totalModdedGames:y?.totalModdedGames||0}}}function rt(s,c,g){if(!s||s.trim()===""||c.length===0)return null;const y=[];let j=s;c.forEach(o=>{const l=o.PlayerStats.find(r=>te(r)===s||r.Username.toLowerCase()===s.toLowerCase());if(l){j=l.Username;const r=l.MainRoleInitial==="Louveteau"?l.MainRoleInitial:ke(l.MainRoleInitial,l.MainRoleChanges||[]),u=ce(r);if(g&&g!=="Tous les camps"&&u!==g)return;const w=We(o),m=l.Victorious,R=ze(new Date(o.StartDate)),k=Te(o.StartDate,o.EndDate)||0;y.push({gameId:o.Id,date:R,camp:u,won:m,winnerCamp:w,playersInGame:o.PlayerStats.length,mapName:o.MapName,duration:k})}}),y.sort((o,l)=>{const r=u=>{const w=u.split("/");return w.length===3?new Date(parseInt(w[2]),parseInt(w[1])-1,parseInt(w[0])):new Date(u)};return r(l.date).getTime()-r(o.date).getTime()});const a=y.length,h=y.filter(o=>o.won).length,p=a>0?(h/a*100).toFixed(2):"0.00",i={};y.forEach(o=>{i[o.camp]||(i[o.camp]={appearances:0,wins:0,winRate:"0.00"}),i[o.camp].appearances++,o.won&&i[o.camp].wins++}),Object.keys(i).forEach(o=>{const l=i[o];l.winRate=l.appearances>0?(l.wins/l.appearances*100).toFixed(2):"0.00"});const n={};y.forEach(o=>{n[o.mapName]||(n[o.mapName]={appearances:0,wins:0,winRate:"0.00"}),n[o.mapName].appearances++,o.won&&n[o.mapName].wins++}),Object.keys(n).forEach(o=>{const l=n[o];l.winRate=l.appearances>0?(l.wins/l.appearances*100).toFixed(2):"0.00"});const d=y.reduce((o,l)=>o+l.duration,0);return{playerName:j,totalGames:a,totalWins:h,winRate:p,totalPlayTime:d,games:y,campStats:i,mapStats:n}}function xe(s,c){const{data:g,isLoading:y,error:j}=ve(a=>s?rt(s,a,c):null);return{data:g,isLoading:y,error:j}}function at(s){const{settings:c}=pe(),[g,y]=D.useState(null),[j,a]=D.useState(null),[h,p]=D.useState(!0),[i,n]=D.useState(null);return D.useEffect(()=>{(async()=>{p(!0),n(null);try{const o=c.dataSource==="discord"?"/data/discord/playerTitles.json":"/data/playerTitles.json",l=await fetch(o);if(!l.ok){if(l.status===404)y(null),a(null),n("Les titres n'ont pas encore Ã©tÃ© gÃ©nÃ©rÃ©s. Ils seront disponibles aprÃ¨s la prochaine synchronisation hebdomadaire.");else throw new Error(`HTTP error! status: ${l.status}`);return}const r=await l.json();if(y(r),s&&r.players){const u=Object.entries(r.players).find(([w,m])=>m.playerName===s);a(u?u[1]:null)}else a(null)}catch(o){console.error("Error loading player titles:",o),n(o instanceof Error?o.message:"Erreur inconnue"),y(null),a(null)}finally{p(!1)}})()},[c.dataSource,s]),{data:g,playerData:j,isLoading:h,error:i}}function it({achievements:s,title:c,emptyMessage:g,achievementType:y="all"}){const{navigateToTab:j,updateNavigationState:a,clearNavigation:h}=ne(),{settings:p,updateSettings:i}=pe(),{joueursData:n}=ue(),d=ge(n),o=(t,P)=>{if(P.stopPropagation(),!t.redirectTo)return;h();const W=p.highlightedPlayer;if(i(y==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:W,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:W,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const C=p.highlightedPlayer||"",f=l(t.description,C);f&&a({playerComparisonState:{selectedPlayer1:C,selectedPlayer2:f,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const C=t.description.toLowerCase().includes("loup");a({selectedPairingTab:C?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const C=t.description.match(/(Villageois|Loups|Autres)/i);C&&a({deathStatsSelectedCamp:C[1]});let f=10;const x=t.description.match(/min\.\s*(\d+)/);x&&(f=parseInt(x[1],10));let S="totalKills",v="killers";const T=t.redirectTo.chartSection;T&&(T==="killers-total"?(S="totalKills",v="killers"):T==="killers-average"?(S="averageKills",v="killers"):T==="deaths-total"?(S="totalDeaths",v="deaths"):T==="survivors-average"?(S="survivalRate",v="deaths"):(T==="hunters-good"||T==="hunters-bad")&&(v="hunter",S="averageKills")),a({deathStatisticsState:{selectedCamp:C?.[1]||"Tous les camps",minGamesForAverage:f,selectedView:v,focusChart:S}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const C=t.redirectTo.mapFilter||"all";let f=10;const x=t.description.match(/min\.\s*(\d+)/);x&&(f=parseInt(x[1])),i(y==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:C,playerFilter:{mode:"none",players:[]},highlightedPlayer:W,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:C,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:C,playerFilter:{mode:"none",players:[]},highlightedPlayer:W,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:C,playerFilter:{mode:"none",players:[]}}}),a({playersGeneralState:{minGamesForWinRate:f,winRateOrder:"best",focusChart:"winRate"}}),j("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&a({selectedPlayerName:p.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let C="wins";const f=t.title.toLowerCase(),x=t.description.toLowerCase();f.includes("dÃ©faite")||x.includes("dÃ©faite")?C="losses":f.includes("loup")||x.includes("loup")?C="loup":f.includes("villageois")||x.includes("villageois")?C="villageois":(f.includes("victoire")||x.includes("victoire"))&&(C="wins"),a({selectedSeriesType:C})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let C=10;const f=t.description.match(/min\.\s*(\d+)/);f&&(C=parseInt(f[1],10));let x="winRate",S="best";const v=t.title.toLowerCase(),T=t.description.toLowerCase();v.includes("participation")||T.includes("participation")?x="participation":(v.includes("taux de victoire")||T.includes("taux de victoire"))&&(x="winRate",(v.includes("moins bon")||v.includes("mauvais")||T.includes("moins bon")||T.includes("mauvais"))&&(S="worst")),a({playersGeneralState:{minGamesForWinRate:C,winRateOrder:S,focusChart:x}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const C=t.redirectTo.chartSection;let f="Villageois",x=1;C&&(C==="camp-loup"?f="Loup":C==="camp-villageois"?f="Villageois":C==="camp-idiot"?f="Idiot du Village":C==="camp-amoureux"?f="Amoureux":(C==="solo-roles"||C==="hall-of-fame")&&(f="Villageois"));const S=t.description.match(/min\.\s*(\d+)/);S&&(x=parseInt(S[1],10)),C==="solo-roles"?f="RÃ´les spÃ©ciaux":C==="hall-of-fame"&&(f="Tous les camps"),a({campPerformanceState:{selectedCampPerformanceCamp:f,selectedCampPerformanceMinGames:x,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const C=t.title.toLowerCase();let f="overview",x="behavior";C.includes("agressivitÃ©")?(f="overview",x="behavior"):C.includes("taux de vote")?(f="behavior",x="voteRate"):C.includes("prÃ©cision")&&(f="overview",x="accuracy"),a({votingStatsState:{selectedCategory:f,selectedView:x}})}if(t.category==="loot"&&t.redirectTo.subTab==="lootStats"){const C=t.redirectTo,f=C.minGames||5,x=C.view||"normalized";a({lootStatsState:{minGames:f,campFilter:"all",view:x}})}j(t.redirectTo.tab,t.redirectTo.subTab)},l=(t,P)=>{const W=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const C of W){const f=t.match(C);if(f&&f[1]){const x=f[1].trim();if(x!==P)return x}}return null},r=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const C=t.description.match(/min\.\s*(\d+)/),f=C?parseInt(C[1],10):10,x=t.title.toLowerCase(),S=y==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return x.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${f} parties)${S}`:x.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${S}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${S}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const C=t.redirectTo.mapFilter,f=C==="village"?"Village":C==="chateau"?"ChÃ¢teau":"map",x=y==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${f}${x}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${l(t.description,p.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const C=t.description.match(/(Villageois|Loups|Autres)/i),f=t.description.match(/min\.\s*(\d+)/),x=f?parseInt(f[1],10):10,S=C?.[1]||"Tous les camps",v=t.redirectTo.chartSection;let T="kills et morts";return v==="killers-total"?T="total des kills":v==="killers-average"?T=`moyenne des kills (min. ${x} parties)`:v==="deaths-total"?T="total des morts":v==="survivors-average"&&(T=`taux de survie (min. ${x} parties)`),`Cliquez pour voir les statistiques de ${T} ${S!=="Tous les camps"?`en ${S}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const C=t.title.toLowerCase(),f=t.description.toLowerCase();return C.includes("dÃ©faite")||f.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":C.includes("loup")||f.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":C.includes("villageois")||f.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":C.includes("victoire")||f.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const C=t.redirectTo.chartSection,f=y==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return C==="camp-loup"?`Cliquez pour voir les performances camp Loup${f}`:C==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${f}`:C==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${f}`:C==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${f}`:C==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${f}`:C==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${f}`:`Cliquez pour voir les performances par camp${f}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const C=t.description.match(/min\.\s*(\d+)/),f=C?parseInt(C[1],10):25,x=y==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",S=t.title.toLowerCase();return S.includes("agressivitÃ©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${f} meetings)${x}`:S.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${f} meetings)${x}`:S.includes("prÃ©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${x}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${x}`}break;case"loot":if(t.redirectTo.subTab==="lootStats"){const C=t.description.match(/min\.\s*(\d+)/),f=C?parseInt(C[1],10):25,x=y==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de rÃ©colte (min. ${f} parties)${x}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(y==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},u=t=>d[t]||qe(t),w=t=>{const P=[/avec ([^:]+?):/,/contre ([^:]+?):/];let W=t;return P.forEach(C=>{const f=t.match(C);if(f&&f[1]){const x=f[1].trim(),v=`<span class="player-name-highlight" style="color: ${u(x)};">${x}</span>`;W=W.replace(x,v)}}),W};if(s.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:c}),e.jsx("p",{children:g||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const m=t=>t===1?"ðŸ¥‡":t===2?"ðŸ¥ˆ":t===3?"ðŸ¥‰":"",R=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",k=(t,P)=>{if(!t||t<=3||!P)return;const W=t-3,C=P-3;return C<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(W-1)/(C-1))}, 70%, 50%)`},I=(t,P)=>{if(!t||!P)return;if(P<=1)return"hsl(0, 70%, 50%)";const W=(t-1)/(P-1),C=W*15,f=50-W*15;return`hsl(${C}, 70%, ${f}%)`},N=t=>{if(!t)return;const P=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(P){const[,W,C]=P;return`hsl(${W}, ${C}%, 40%)`}return t},M=s.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,P)=>(t.rank??999)-(P.rank??999)),z=s.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,P)=>(t.rank??999)-(P.rank??999)),V=s.filter(t=>t.category==="comparison"),$=[...M,...z].sort((t,P)=>(t.rank??999)-(P.rank??999)),F=M.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:c}),F>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:M.filter(t=>t.rank&&t.rank<=3).map((t,P)=>e.jsxs("div",{className:`top3-card ${R(t.rank)} animate-slide-in`,style:{animationDelay:`${P*.15}s`},onClick:W=>o(t,W),title:r(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:m(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:t.title}),e.jsx("p",{className:"top3-achievement-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},t.id))})]}),$.length>0&&e.jsxs("div",{className:"achievements-section unified-rankings",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:$.filter(t=>t.type==="bad"?!0:!t.rank||t.rank>3).map((t,P)=>{const W=t.type==="bad",C=W?I(t.rank,t.totalRanked):k(t.rank,t.totalRanked),f=N(C),x=W?"":R(t.rank);return e.jsxs("div",{className:`achievement-card ${W?"bad":"good"} ${x}`,onClick:S=>o(t,S),title:r(t),style:{animationDelay:`${P*.05}s`,borderLeftColor:f,borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsxs("span",{className:"achievement-title",children:[W&&"ðŸ’€ ",t.title]}),e.jsxs("span",{className:"achievement-rank",style:C?{backgroundColor:C}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:t.description})]},t.id)})})]}),V.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques CoÃ©quipiers et Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:V.map(t=>e.jsxs("div",{className:"achievement-card comparison",onClick:P=>o(t,P),title:r(t),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:t.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:w(t.description)}})]},t.id))})]})]})}function nt({selectedPlayerName:s,groupingMethod:c,campFilter:g="all"}){const{navigateToGameDetails:y}=ne(),{data:j,isLoading:a,error:h}=xe(s),p=D.useMemo(()=>{switch(c){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[c]),i=D.useMemo(()=>{if(!j?.games)return new Map;const l=new Map;return j.games.forEach(r=>{if(!l.has(r.date)){const u=r.date.split("/");u.length===3?l.set(r.date,new Date(parseInt(u[2]),parseInt(u[1])-1,parseInt(u[0])).getTime()):l.set(r.date,new Date(r.date).getTime())}}),l},[j?.games]),n=D.useMemo(()=>{if(!j?.games)return[];const l={};return j.games.forEach(r=>{if(g!=="all"){if(g==="solo"){if(r.camp==="Villageois"||r.camp==="Loup")return}else if(r.camp!==g)return}let u;const w=r.date.split("/");if(c==="month")if(w.length===3)u=`${w[1].padStart(2,"0")}/${w[2]}`;else{const m=new Date(r.date);u=`${String(m.getMonth()+1).padStart(2,"0")}/${m.getFullYear()}`}else if(c==="quarter")if(w.length===3){const m=parseInt(w[1],10);u=`T${Math.floor((m-1)/3)+1}/${w[2]}`}else{const m=new Date(r.date);u=`T${Math.floor(m.getMonth()/3)+1}/${m.getFullYear()}`}else c==="year"?w.length===3?u=`${w[2]}`:u=`${new Date(r.date).getFullYear()}`:u=r.date;l[u]||(l[u]={games:[],wins:0,total:0}),l[u].games.push(r),l[u].total++,r.won&&l[u].wins++}),Object.entries(l).map(([r,u])=>({period:r,totalGames:u.total,victories:u.wins,defeats:u.total-u.wins,winRate:u.total>0?(u.wins/u.total*100).toFixed(1):"0.0",winRateNum:u.total>0?u.wins/u.total*100:0})).sort((r,u)=>{if(c==="month"){const[w,m]=r.period.split("/"),[R,k]=u.period.split("/"),I=new Date(parseInt(m),parseInt(w)-1,1),N=new Date(parseInt(k),parseInt(R)-1,1);return I.getTime()-N.getTime()}else if(c==="quarter"){const[w,m]=r.period.split("/"),[R,k]=u.period.split("/"),I=parseInt(w.replace(/\D/g,""),10)||1,N=parseInt(R.replace(/\D/g,""),10)||1,M=new Date(parseInt(m,10),(I-1)*3,1),z=new Date(parseInt(k,10),(N-1)*3,1);return M.getTime()-z.getTime()}else if(c==="year"){const w=parseInt(r.period,10),m=parseInt(u.period,10);return w-m}else{const w=i.get(r.period)||0,m=i.get(u.period)||0;return w-m}})},[j,c,i,g]),o=(l=>l<=15?{fontSize:12,angle:-45,height:80,interval:0}:l<=30?{fontSize:12,angle:-45,height:85,interval:1}:l<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(l/12)})(n.length);return a?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):h?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",h]}):j?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",p]}),e.jsx(Y,{title:`Ã‰volution des Performances ${p}`,children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Ve,{data:n,margin:{top:20,right:30,left:20,bottom:20},onClick:l=>{if(l&&l.activeLabel){const r=n.find(u=>u.period===l.activeLabel);r&&y({selectedPlayer:s,selectedDate:r.period,fromComponent:`Ã‰volution des Performances ${p}`})}},style:{cursor:"pointer"},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"period",angle:o.angle,textAnchor:"end",height:o.height,interval:o.interval,fontSize:o.fontSize}),e.jsx(X,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(H,{content:({active:l,payload:r})=>{if(l&&r&&r.length>0){const u=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:u.period})}),e.jsxs("div",{children:["Parties: ",u.totalGames]}),e.jsxs("div",{children:["Victoires: ",u.victories]}),e.jsxs("div",{children:["Taux: ",u.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Be,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",p]}),e.jsx(Y,{title:`RÃ©partition Victoires/DÃ©faites ${p}`,children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:n,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"period",angle:o.angle,textAnchor:"end",height:o.height,interval:o.interval,fontSize:o.fontSize}),e.jsx(X,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:l,payload:r})=>{if(l&&r&&r.length>0){const u=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:u.period})}),e.jsxs("div",{children:["Total: ",u.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",u.victories]}),e.jsxs("div",{children:["DÃ©faites: ",u.defeats]}),e.jsxs("div",{children:["Taux: ",u.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(O,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:n.map((l,r)=>e.jsx(Z,{fill:"var(--accent-tertiary)",onClick:()=>{y({selectedPlayer:s,selectedDate:l.period,fromComponent:`Historique Joueur - Victoires ${p}`})},style:{cursor:"pointer"}},`cell-victories-${r}`))}),e.jsx(O,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:n.map((l,r)=>e.jsx(Z,{fill:"var(--chart-color-4)",onClick:()=>{y({selectedPlayer:s,selectedDate:l.period,fromComponent:`Historique Joueur - DÃ©faites ${p}`})},style:{cursor:"pointer"}},`cell-defeats-${r}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function ot({selectedPlayerName:s}){const{navigateToGameDetails:c}=ne(),{data:g,isLoading:y,error:j}=xe(s),a=oe(),h=D.useMemo(()=>g?.campStats?Object.entries(g.campStats).map(([i,n])=>({name:i,value:n.appearances,winRate:n.winRate,winRateDisplay:Math.max(parseFloat(n.winRate),1),wins:n.wins,percentage:(n.appearances/g.totalGames*100).toFixed(1)})):[],[g]),p=D.useMemo(()=>{if(!h.length)return[];const i=5;let n=0;const d=[],o=[];if(h.forEach(l=>{parseFloat(l.percentage)<i?(n+=Number(l.value),d.push(l)):o.push(l)}),n>0){const l=h.reduce((r,u)=>r+Number(u.value),0);o.push({name:"Autres",value:n,winRate:"0.0",winRateDisplay:1,wins:d.reduce((r,u)=>r+u.wins,0),percentage:(n/l*100).toFixed(1),_details:d})}return o},[h]);return y?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):j?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",j]}):g?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Ne,{children:[e.jsx(Pe,{data:p,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:i=>{const n=i.percent!==void 0?i.percent:0;return i.name==="Autres"?`Autres : ${i.value} (${(n*100).toFixed(1)}%)`:`${i.name}: ${i.value} (${(n*100).toFixed(1)}%)`},children:p.map((i,n)=>e.jsx(Z,{fill:i.name==="Autres"?Ge:a[i.name]||`var(--chart-color-${n%6+1})`,onClick:()=>{if(i.name==="Autres"){const d=i._details?.map(o=>o.name)||[];c({selectedPlayer:s,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:d},fromComponent:"Distribution par Camps"})}else i.name==="TraÃ®tre"||i.name==="Louveteau"?c({selectedPlayer:s,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):i.name==="Loup"?c({selectedPlayer:s,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):c({selectedPlayer:s,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${n}`))}),e.jsx(H,{content:({active:i,payload:n})=>{if(i&&n&&n.length>0){const d=n[0].payload;if(d.name==="Autres"&&d._details){const o=[...d._details].sort((l,r)=>r.value-l.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",d.value," parties (",d.percentage,"%)"]})}),e.jsx("div",{children:o.map((l,r)=>e.jsxs("div",{children:[l.name,": ",l.value," parties (",l.percentage,"%)"]},r))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[d.name," - ",d.value," parties (",d.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(Y,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:h,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(H,{content:({active:i,payload:n})=>{if(i&&n&&n.length>0){const d=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:d.name})}),e.jsxs("div",{children:["Victoires: ",d.wins," / ",d.value]}),e.jsxs("div",{children:["Taux: ",d.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(O,{dataKey:"winRateDisplay",children:h.map((i,n)=>e.jsx(Z,{fill:parseFloat(i.winRate)===0?`${a[i.name]||`var(--chart-color-${n%6+1})`}50`:a[i.name]||`var(--chart-color-${n%6+1})`,onClick:()=>{i.name==="TraÃ®tre"||i.name==="Louveteau"?c({selectedPlayer:s,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):i.name==="Loup"?c({selectedPlayer:s,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):c({selectedPlayer:s,campFilter:{selectedCamp:i.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${n}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function lt({selectedPlayerName:s}){const{gameData:c}=he(),{joueursData:g}=ue(),y=ge(g),j=oe(),a=D.useMemo(()=>{if(!c||!s)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const p={},i={},n={},d=new Set;c.forEach(w=>{const m=w.PlayerStats.find(R=>R.Username.toLowerCase()===s.toLowerCase());if(m&&(w.PlayerStats.forEach(R=>{R.KillerName?.toLowerCase()===s.toLowerCase()&&(p[R.Username]=(p[R.Username]||0)+1)}),m.KillerName&&(i[m.KillerName]=(i[m.KillerName]||0)+1),m.DeathType)){const R=m.DeathType,k=de(R);n[k]||(n[k]={count:0,byDeathType:{}}),n[k].count+=1,n[k].byDeathType[R]=(n[k].byDeathType[R]||0)+1,d.add(R)}});const o=Object.entries(p).map(([w,m])=>({player:w,kills:m})).sort((w,m)=>m.kills-w.kills).slice(0,ie.TOP_10),l=Object.entries(i).map(([w,m])=>({player:w,kills:m})).sort((w,m)=>m.kills-w.kills).slice(0,ie.TOP_10),r=Object.entries(n).map(([w,m])=>{const R={deathType:w,count:m.count};return R[w]=m.count,R}).sort((w,m)=>m.count-w.count).slice(0,ie.TOP_10),u=Object.keys(n);return{playersKilled:o,killedBy:l,deathTypes:r,availableDeathTypes:u}},[c,s]),h=D.useMemo(()=>{const p={};a.availableDeathTypes.forEach(d=>{d==="TuÃ© par Loup"?p[d]=j.Loup:d==="Mort aux votes"?p[d]="var(--chart-color-1)":d.includes("Chasseur")?p[d]=j.Chasseur:d==="TuÃ© par Zombie"?p[d]=j.Vaudou:d==="TuÃ© par potion assassin"?p[d]=j.Alchimiste:d==="TuÃ© par Vengeur"?p[d]="var(--chart-color-2)":d==="Amoureux mort"?p[d]=j.Amoureux:d==="TuÃ© par La BÃªte"?p[d]="var(--chart-color-3)":d==="TuÃ© par ShÃ©rif"&&(p[d]="var(--chart-color-4)")});const i=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let n=0;return a.availableDeathTypes.forEach(d=>{p[d]||(p[d]=i[n%i.length],n++)}),p},[a.availableDeathTypes,j]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[a.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(Y,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:p,payload:i})=>{if(p&&i&&i.length>0){const n=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.player})}),e.jsxs("div",{children:["TuÃ© ",n.kills," fois par ",s]})]})}return null}}),e.jsx(O,{dataKey:"kills",children:a.playersKilled.map((p,i)=>e.jsx(Z,{fill:y[p.player]||"var(--chart-color-3)"},`cell-killed-${i}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[s," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),a.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(Y,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:p,payload:i})=>{if(p&&i&&i.length>0){const n=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.player})}),e.jsxs("div",{children:["A tuÃ© ",s," ",n.kills," fois"]})]})}return null}}),e.jsx(O,{dataKey:"kills",children:a.killedBy.map((p,i)=>e.jsx(Z,{fill:y[p.player]||"var(--chart-color-4)"},`cell-killer-${i}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[s," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),a.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(Y,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:p,payload:i})=>{if(p&&i&&i.length>0){const n=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.deathType})}),e.jsxs("div",{children:[s," est mort ",n.count," fois ainsi"]})]})}return null}}),a.availableDeathTypes.map(p=>e.jsx(O,{dataKey:p,name:p,stackId:"deaths",fill:h[p]||"var(--chart-color-5)"},p))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",s,"."]})]})]})}function ct(s,c){if(!s||s.trim()===""||c.length===0)return null;const g=new Map,y=new Map,j=new Map;c.forEach(n=>{if(!n.Modded)return;const d=n.PlayerStats.find(o=>te(o)===s||o.Username.toLowerCase()===s.toLowerCase());if(d){if(d.MainRoleInitial==="Inconnu")return;const o=d.Victorious,r=ke(d.MainRoleInitial,d.MainRoleChanges||[])!==d.MainRoleInitial,u=ce(d.MainRoleInitial),w=u==="Loup"||u==="TraÃ®tre"||u==="Louveteau";if(u==="Villageois"&&be(d)){const m=Ce(d);if(m&&Oe.includes(m)){const R=g.get(m)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};g.set(m,{appearances:R.appearances+1,wins:R.wins+(o?1:0),winsWithoutRoleChange:R.winsWithoutRoleChange+(!r&&o?1:0),gamesWithoutRoleChange:R.gamesWithoutRoleChange+(r?0:1)})}}else if(d.Power&&d.Power.trim()!==""&&d.Power!=="Inconnu"){if(u==="Villageois"){const m=g.get(d.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};g.set(d.Power,{appearances:m.appearances+1,wins:m.wins+(o?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!r&&o?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(r?0:1)})}else if(w){const m=y.get(d.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},R=m.roleBreakdown;R.set(d.MainRoleInitial,(R.get(d.MainRoleInitial)||0)+1),y.set(d.Power,{appearances:m.appearances+1,wins:m.wins+(o?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!r&&o?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(r?0:1),roleBreakdown:R})}}else if((u==="Villageois"||w)&&d.Power!=="Inconnu")if(u==="Villageois"){const m=g.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};g.set("Aucun pouvoir",{appearances:m.appearances+1,wins:m.wins+(o?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!r&&o?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(r?0:1)})}else{const m=y.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},R=m.roleBreakdown;R.set(d.MainRoleInitial,(R.get(d.MainRoleInitial)||0)+1),y.set("Aucun pouvoir",{appearances:m.appearances+1,wins:m.wins+(o?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!r&&o?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(r?0:1),roleBreakdown:R})}if(d.SecondaryRole&&d.SecondaryRole.trim()!==""&&d.SecondaryRole!=="Inconnu"){const m=j.get(d.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};j.set(d.SecondaryRole,{appearances:m.appearances+1,wins:m.wins+(o?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!r&&o?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(r?0:1)})}}});const a=new Map;c.forEach(n=>{const d=n.PlayerStats.find(o=>te(o)===s||o.Username.toLowerCase()===s.toLowerCase());if(d&&be(d)){const o=Ce(d);o&&a.set(o,(a.get(o)||0)+1)}});const h=n=>Array.from(n.entries()).map(([d,o])=>({name:d,appearances:o.appearances,wins:o.wins,winsWithoutRoleChange:o.winsWithoutRoleChange,gamesWithoutRoleChange:o.gamesWithoutRoleChange,winRate:o.gamesWithoutRoleChange>0?(o.winsWithoutRoleChange/o.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...a.has(d)&&{totalGamesAllModes:a.get(d)}})).sort((d,o)=>o.appearances-d.appearances),p=n=>Array.from(n.entries()).map(([d,o])=>({name:d,appearances:o.appearances,wins:o.wins,winsWithoutRoleChange:o.winsWithoutRoleChange,gamesWithoutRoleChange:o.gamesWithoutRoleChange,winRate:o.gamesWithoutRoleChange>0?(o.winsWithoutRoleChange/o.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(o.roleBreakdown.entries()).map(([l,r])=>({role:l,count:r})).sort((l,r)=>r.count-l.count)})).sort((d,o)=>o.appearances-d.appearances),i=n=>Array.from(n.entries()).map(([d,o])=>({name:d,appearances:o.appearances,wins:o.wins,winsWithoutRoleChange:o.winsWithoutRoleChange,gamesWithoutRoleChange:o.gamesWithoutRoleChange,winRate:o.gamesWithoutRoleChange>0?(o.winsWithoutRoleChange/o.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((d,o)=>o.appearances-d.appearances);return{villageoisPowers:h(g),loupPowers:p(y),secondaryRoles:i(j)}}function dt({selectedPlayerName:s}){const{navigateToGameDetails:c,navigationState:g,updateNavigationState:y}=ne(),j=oe(),[a,h]=D.useState(g.playerHistoryRolesState?.chartMode||"appearances"),{data:p,isLoading:i,error:n}=ve(k=>ct(s,k));D.useEffect(()=>{(!g.playerHistoryRolesState||g.playerHistoryRolesState.chartMode!==a)&&y({playerHistoryRolesState:{chartMode:a}})},[a,g.playerHistoryRolesState,y]);const d=k=>{h(k),y({playerHistoryRolesState:{chartMode:k}})},o=D.useCallback(k=>{if(!p)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const I=1,N=1,M=a==="winRate"?($,F)=>parseFloat(F.winRate)-parseFloat($.winRate):($,F)=>F.appearances-$.appearances,z=$=>({...$,winRateDisplay:Math.max(parseFloat($.winRate),1)}),V=$=>k===null?$:$.slice(0,k);return{villageoisPowers:V(p.villageoisPowers.filter($=>$.appearances>=I).map(z).sort(M)),loupPowers:V(p.loupPowers.filter($=>$.appearances>=I).map(z).sort(M)),secondaryRoles:V(p.secondaryRoles.filter($=>$.appearances>=N).map(z).sort(M))}},[p,a]),l=D.useMemo(()=>o(15),[o]);if(i)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(n)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",n]});if(!p)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const r=l.villageoisPowers.length>0,u=l.loupPowers.length>0,w=l.secondaryRoles.length>0;if(!r&&!u&&!w)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const m=({active:k,payload:I})=>{if(k&&I&&I.length>0){const N=I[0].payload,M=N.gamesWithoutRoleChange<N.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:N.name})}),e.jsxs("div",{children:["Apparitions: ",N.appearances]}),M&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",N.appearances-N.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",N.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",N.winRate,"%"]})}),N.totalGamesAllModes&&N.totalGamesAllModes!==N.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",N.totalGamesAllModes,")"]}),N.roleBreakdown&&N.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),N.roleBreakdown.map((z,V)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",z.role,": ",z.count]},V))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},R=(k,I,N,M,z)=>{const V=a==="appearances"?"appearances":"winRateDisplay",$=a==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",F=a==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:I}),e.jsx(Y,{title:I,children:t=>{const W=o(t?null:15)[k];return e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:W,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(X,{label:{value:$,angle:270,position:"left",style:{textAnchor:"middle"}},domain:F}),e.jsx(H,{content:e.jsx(m,{})}),e.jsx(O,{dataKey:V,label:a==="winRate"?C=>{const{x:f,y:x,width:S,payload:v}=C;if(f===void 0||x===void 0||S===void 0||!v)return null;const T=v.winRate||"0";return e.jsxs("text",{x:f+S/2,y:x-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[T,"%"]})}:void 0,children:W.map((C,f)=>e.jsx(Z,{fill:z?z(C.name,f):N,onClick:()=>M(C.name),style:{cursor:"pointer"}},`cell-${f}`))})]})})})}})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:a,onChange:k=>d(k.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[r&&R("villageoisPowers","Camp Villageois","var(--chart-color-1)",k=>{c({selectedPlayer:s,campFilter:{selectedCamp:"Villageois",campFilterMode:a==="winRate"?"wins-only":"all-assignments"},selectedPower:k,fromComponent:`Historique des RÃ´les - Pouvoir: ${k}`})},k=>k==="Chasseur"&&j.Chasseur?j.Chasseur:k==="Alchimiste"&&j.Alchimiste?j.Alchimiste:k==="Protecteur"&&j.Protecteur?j.Protecteur:k==="Disciple"&&j.Disciple?j.Disciple:k==="Inquisiteur"&&j.Inquisiteur?j.Inquisiteur:"var(--chart-color-1)"),u&&R("loupPowers","Camp Loups","var(--chart-color-2)",k=>{c({selectedPlayer:s,campFilter:{selectedCamp:"Loup",campFilterMode:a==="winRate"?"wins-only":"all-assignments"},selectedPower:k,fromComponent:`Historique des RÃ´les - Pouvoir: ${k}`})},()=>j.Loup||"var(--chart-color-2)"),w&&R("secondaryRoles","RÃ´les Secondaires","var(--chart-color-3)",k=>{c({selectedPlayer:s,selectedSecondaryRole:k,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${k}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}const we=["UseGadget","DrinkPotion"],ut={UseGadget:"Utilisation Gadget",DrinkPotion:"Potion bue"},mt={UseGadget:"var(--chart-color-1, #8884d8)",DrinkPotion:"var(--chart-color-3, #ffc658)"};function pt({selectedPlayerName:s}){const{gameData:c}=he(),g=D.useMemo(()=>{if(!c||!s)return{actionTypeCounts:[],gadgetDetails:[],potionDetails:[],totalGamesWithActions:0,totalGamesPlayed:0};const j={UseGadget:0,DrinkPotion:0},a={},h={};let p=0,i=0;c.forEach(l=>{const r=l.PlayerStats.find(m=>m.Username.toLowerCase()===s.toLowerCase());if(!r)return;i++;let u=!1;(r.Actions||[]).forEach(m=>{const R=m.ActionType;we.includes(R)&&(j[R]++,u=!0,R==="UseGadget"&&m.ActionName&&m.ActionName!=="Balle"&&(a[m.ActionName]=(a[m.ActionName]||0)+1),R==="DrinkPotion"&&m.ActionName&&(h[m.ActionName]=(h[m.ActionName]||0)+1))}),u&&p++});const n=we.filter(l=>j[l]>0).map(l=>({actionType:l,label:ut[l],count:j[l],color:mt[l]})).sort((l,r)=>r.count-l.count),d=Object.entries(a).map(([l,r])=>({gadgetName:l,count:r})).sort((l,r)=>r.count-l.count).slice(0,ie.TOP_10),o=Object.entries(h).map(([l,r])=>({potionName:l,count:r})).sort((l,r)=>r.count-l.count).slice(0,ie.TOP_10);return{actionTypeCounts:n,gadgetDetails:d,potionDetails:o,totalGamesWithActions:p,totalGamesPlayed:i}},[c,s]);return g.actionTypeCounts.length>0?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",style:{width:"100%",flexBasis:"100%"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ® Parties avec actions"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:g.totalGamesWithActions}),e.jsxs("p",{children:["sur ",g.totalGamesPlayed," parties analysÃ©es"]})]}),g.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ”§ Gadgets utilisÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:g.gadgetDetails.reduce((j,a)=>j+a.count,0)}),e.jsxs("p",{children:[g.gadgetDetails.length," types diffÃ©rents"]})]}),g.potionDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ§ª Potions bues"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:g.potionDetails.reduce((j,a)=>j+a.count,0)}),e.jsxs("p",{children:[g.potionDetails.length," types diffÃ©rents"]})]})]}),g.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Gadgets UtilisÃ©s"}),e.jsx(Y,{title:"Gadgets UtilisÃ©s",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:g.gadgetDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"gadgetName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Utilisations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:j,payload:a})=>{if(j&&a&&a.length>0){const h=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:h.gadgetName})}),e.jsxs("div",{children:["UtilisÃ© ",h.count," fois"]})]})}return null}}),e.jsx(O,{dataKey:"count",fill:"var(--chart-color-1)",children:g.gadgetDetails.map((j,a)=>e.jsx(Z,{fill:`hsl(${200+a*20}, 70%, 50%)`},`cell-gadget-${a}`))})]})})})})]}),g.potionDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Potions Bues"}),e.jsx(Y,{title:"Potions Bues",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:g.potionDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"potionName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Consommations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:j,payload:a})=>{if(j&&a&&a.length>0){const h=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:h.potionName})}),e.jsxs("div",{children:["Bue ",h.count," fois"]})]})}return null}}),e.jsx(O,{dataKey:"count",fill:"var(--chart-color-3)",children:g.potionDetails.map((j,a)=>e.jsx(Z,{fill:`hsl(${40+a*15}, 80%, 55%)`},`cell-potion-${a}`))})]})})})})]})]}):e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune donnÃ©e d'actions disponible pour ",s,"."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es d'actions (gadgets, potions) ne sont disponibles que pour les parties rÃ©centes."})]})}function ht(s){if(!s||typeof s!="string")return null;const c=s.trim().toUpperCase();if(c.length<2)return null;const g=c.charAt(0),y=parseInt(c.slice(1),10);return!["J","N","M","U"].includes(g)||isNaN(y)||y<1?null:{phase:g,number:y}}function gt(s,c){const g=s||c;if(!g)return 0;const y=ht(g);if(!y)return 0;const{phase:j,number:a}=y;return j==="N"?a:j==="J"||j==="M"?a-1:j==="U"?Math.max(0,Math.floor((a-1)/2)):0}function xt(s){return["Loup"].includes(s)}function ft({selectedPlayerName:s}){const{gameData:c}=he(),{joueursData:g}=ue(),y=oe(),j=ge(g),a=D.useMemo(()=>{if(!c||!s)return{hunterTargets:[],hunterMissedShots:0,hunterTotalShots:0,transformCount:0,untransformCount:0,transformationsPerGame:0,totalGamesWithActions:0,totalGamesPlayed:0,totalNightsAsWolf:0,transformsPerNight:0};const p={};let i=0,n=0,d=0,o=0,l=0,r=0;c.forEach(N=>{const M=N.PlayerStats.find(F=>F.Username.toLowerCase()===s.toLowerCase());if(!M)return;l++;let z=!1;const V=parseFloat(N.Version||"0");if(xt(M.MainRoleInitial)&&N.Modded&&V>=.217){const F=gt(M.DeathTiming,N.EndTiming);r+=F}(M.Actions||[]).forEach(F=>{F.ActionType==="HunterShoot"?(d++,z=!0,F.ActionTarget&&(p[F.ActionTarget]=(p[F.ActionTarget]||0)+1)):F.ActionType==="Transform"?(i++,z=!0):F.ActionType==="Untransform"&&(n++,z=!0)}),z&&o++});const u=Object.entries(p).map(([N,M])=>({target:N,count:M})).sort((N,M)=>M.count-N.count).slice(0,ie.TOP_10),w=Object.values(p).reduce((N,M)=>N+M,0),m=d-w,R=i>0?Math.max(1,c.filter(N=>{const M=N.PlayerStats.find(V=>V.Username.toLowerCase()===s.toLowerCase());return M?(M.Actions||[]).some(V=>V.ActionType==="Transform"):!1}).length):0,k=R>0?i/R:0,I=r>0?i/r:0;return{hunterTargets:u,hunterMissedShots:m,hunterTotalShots:d,transformCount:i,untransformCount:n,transformationsPerGame:k,totalGamesWithActions:o,totalGamesPlayed:l,totalNightsAsWolf:r,transformsPerNight:I}},[c,s]);return a.hunterTotalShots>0||a.transformCount>0||a.untransformCount>0?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[a.hunterTotalShots>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Statistiques du Chasseur"}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"âœ… Tirs rÃ©ussis"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:y.Chasseur||"var(--chart-color-2)"},children:a.hunterTotalShots-a.hunterMissedShots}),e.jsx("p",{children:"cibles touchÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"âŒ Tirs manquÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--text-secondary)"},children:a.hunterMissedShots}),e.jsx("p",{children:"tirs sans cible"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š PrÃ©cision"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:y.Chasseur||"var(--chart-color-2)"},children:[a.hunterTotalShots>0?((a.hunterTotalShots-a.hunterMissedShots)/a.hunterTotalShots*100).toFixed(1):"0","%"]}),e.jsx("p",{children:"taux de rÃ©ussite"})]})]}),a.hunterTargets.length>0&&e.jsx(Y,{title:"Cibles Ã‰liminÃ©es par le Chasseur",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:a.hunterTargets,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"target",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12}),e.jsx(X,{label:{value:"Nombre de tirs",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:p,payload:i})=>{if(p&&i&&i.length>0){const n=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.target})}),e.jsxs("div",{children:["TuÃ© par le chasseur ",n.count," fois"]})]})}return null}}),e.jsx(O,{dataKey:"count",fill:y.Chasseur||"var(--chart-color-2)",children:a.hunterTargets.map((p,i)=>e.jsx(Z,{fill:j[p.target]||y.Chasseur||`hsl(${120+i*15}, 60%, 45%)`},`cell-hunter-${i}`))})]})})})})]}),(a.transformCount>0||a.untransformCount>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Habitudes de Transformation (Loup)"}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Ratio"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:(()=>{const p=a.transformCount,i=a.untransformCount;return p===0?"0%":`${(i/p*100).toFixed(0)}%`})()}),e.jsx("p",{children:"dÃ©transformations / transformations"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŒ™ Nuits totales"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:a.totalNightsAsWolf}),e.jsx("p",{children:"nuits vÃ©cues en loup (opportunitÃ©s)"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¯ Ratio / nuit"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:y.Loup||"var(--wolf-color)"},children:a.transformsPerNight.toFixed(2)}),e.jsx("p",{children:"transformations par nuit vÃ©cue"})]})]}),e.jsx(Y,{title:"Statistiques de Transformation",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:[{name:"Statistiques Loup","Nuits vÃ©cues":a.totalNightsAsWolf,Transformations:a.transformCount,DÃ©transformations:a.untransformCount}],margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",fontSize:14}),e.jsx(X,{label:{value:"Compte",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:p,payload:i})=>!p||!i||i.length===0?null:e.jsx("div",{className:"custom-tooltip",style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border-primary)",borderRadius:"4px",padding:"10px"},children:i.map((n,d)=>e.jsxs("div",{style:{color:n.color,marginBottom:"4px"},children:[e.jsxs("strong",{children:[n.name,":"]})," ",n.value]},d))})}),e.jsx(De,{}),e.jsx(O,{dataKey:"Nuits vÃ©cues",fill:"var(--chart-color-4, #a4de6c)"}),e.jsx(O,{dataKey:"Transformations",fill:y.Loup||"var(--wolf-color)"}),e.jsx(O,{dataKey:"DÃ©transformations",fill:"var(--accent-secondary)"})]})})})})]})]}):e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune donnÃ©e d'actions de rÃ´le disponible pour ",s,"."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es d'actions de rÃ´le (Chasseur, Loup) ne sont disponibles que pour les parties rÃ©centes."})]})}function yt({viewMode:s,setViewMode:c,selectedMap:g,setSelectedMap:y,availableMaps:j,clusterRadius:a,setClusterRadius:h,availableDeathTypes:p,selectedDeathTypes:i,setSelectedDeathTypes:n,deathTypeColors:d,isDeathTypesExpanded:o,setIsDeathTypesExpanded:l}){return e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>c("deaths"),style:{background:s==="deaths"?"var(--accent-primary)":"transparent",color:s==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:s==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"ðŸ’€ Morts"}),e.jsx("button",{type:"button",onClick:()=>c("kills"),style:{background:s==="kills"?"var(--accent-primary)":"transparent",color:s==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:s==="kills"?"bold":"normal",transition:"all 0.2s"},children:"âš”ï¸ Kills"}),e.jsx("button",{type:"button",onClick:()=>c("transformations"),style:{background:s==="transformations"?"var(--accent-primary)":"transparent",color:s==="transformations"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:s==="transformations"?"bold":"normal",transition:"all 0.2s"},children:"ðŸº Transfos"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:g,onChange:r=>y(r.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:j.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:a,onChange:r=>h(parseInt(r.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:a===0?"Aucun":`${a} unitÃ©${a>1?"s":""}`})]}),s!=="transformations"&&e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>l(!o),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:o?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:o?"rotate(90deg)":"rotate(0deg)"},children:"â–¶"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[i.length," / ",p.length," sÃ©lectionnÃ©",i.length>1?"s":""]})]}),o&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),n(p)},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),n([])},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:p.map(r=>{const u=i.includes(r),w=d[r]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",background:u?"var(--bg-tertiary)":"transparent",borderRadius:"4px",border:`1px solid ${u?w:"var(--border-color)"}`,cursor:"pointer",transition:"all 0.2s",fontSize:"0.9rem"},onClick:m=>{m.stopPropagation(),n(u?R=>R.filter(k=>k!==r):R=>[...R,r])},children:[e.jsx("input",{type:"checkbox",checked:u,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:w,flexShrink:0}}),e.jsx("span",{children:de(r)})]},r)})})]})]})]})}function vt({zoneAnalysis:s,selectedMap:c,viewMode:g,selectedPlayerName:y,hoveredZone:j,setHoveredZone:a}){return!s||c!=="Village"||g!=="deaths"?null:e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"0rem",padding:"1.5rem",background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",borderRadius:"12px",border:"2px solid var(--accent-primary)",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",color:"var(--accent-primary)",fontSize:"1.3rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"ðŸ“Š Analyse par zone (Village)"}),e.jsx("p",{style:{fontSize:"0.95rem",marginBottom:"1rem",color:"var(--text-secondary)",lineHeight:"1.5"},children:"Distribution des morts (selon les types sÃ©lectionnÃ©s) comparÃ©e Ã  la moyenne de tous les joueurs:"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:s.zoneStats.map(h=>{const p=h.zone===s.dominantZone&&s.maxDeviation>10;return e.jsxs("div",{onMouseEnter:()=>a(h.zone),onMouseLeave:()=>a(null),style:{padding:"1rem",background:"var(--bg-primary)",borderRadius:"8px",border:j===h.zone?"1px solid var(--accent-primary)":"1px solid var(--border-color)",color:"var(--text-primary)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.95rem"},children:h.zone}),e.jsxs("div",{style:{fontSize:"0.85rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[y,": ",e.jsxs("strong",{children:[h.playerPercent.toFixed(1),"%"]})," (",h.playerCount,")"]}),e.jsxs("div",{style:{opacity:.85},children:["Moyenne: ",h.avgPercent.toFixed(1),"%"]}),e.jsxs("div",{style:{marginTop:"0.25rem",color:p?"var(--accent-secondary)":h.deviation>0?"var(--accent-primary)":"var(--text-secondary)",fontWeight:Math.abs(h.deviation)>5?"bold":"normal"},children:[h.deviation>0?"+":"",h.deviation.toFixed(1),"% vs moyenne"]})]})]},h.zone)})}),s.dominantZone&&s.maxDeviation>10&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",fontSize:"0.95rem",color:"var(--accent-primary)",fontWeight:"bold",background:"var(--bg-primary)",borderRadius:"8px",border:"2px solid var(--accent-primary)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"âš ï¸"}),e.jsxs("span",{children:[y," meurt significativement plus souvent en zone ",s.dominantZone,"(","+"+s.maxDeviation.toFixed(1),"% par rapport Ã  la moyenne)"]})]})]})}function jt({locationData:s,clusteredData:c,viewMode:g,selectedPlayerName:y,selectedMap:j,mapConfig:a,xDomain:h,zDomain:p,hoveredZone:i,getDeathColor:n,handleLocationClick:d}){const o=({active:l,payload:r})=>{if(!l||!r||r.length===0)return null;const u=r[0].payload,w=u.allLocations||[u],m=w.length>1,R=g==="transformations";if(m){const I=new Map,N=new Map,M=new Set,z=new Map;w.forEach(t=>{if(I.set(t.victimName,(I.get(t.victimName)||0)+1),R)z.set(t.camp,(z.get(t.camp)||0)+1);else{const P=t.deathType?de(t.deathType):"Inconnu";N.set(P,(N.get(P)||0)+1)}M.add(t.gameId)});const V=Array.from(I.entries()).sort((t,P)=>P[1]-t[1]).slice(0,3),$=Array.from(N.entries()).sort((t,P)=>P[1]-t[1]).slice(0,3),F=Array.from(z.entries()).sort((t,P)=>P[1]-t[1]);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[R?"ðŸº":g==="deaths"?"ðŸ’€":"âš”ï¸"," ",w.length," ",R?"transformations":g==="deaths"?"morts":"kills"," Ã  cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[R?e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Camps loup:"}),F.map(([t,P])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",P,"Ã—)"]},t))]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:g==="deaths"?"Victimes:":"Kills sur:"}),V.map(([t,P])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",P,"Ã—)"]},t))]}),e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Types de mort:"}),$.map(([t,P])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",P,"Ã—)"]},t))]})]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["ðŸ“ ",M.size," partie",M.size>1?"s":""," diffÃ©rente",M.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const k=w[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[R?"ðŸº":g==="deaths"?"ðŸ’€":"âš”ï¸"," ",R?"Transformation de":g==="deaths"?"Mort de":"Kill de"," ",y]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[R?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ‘¤ ",e.jsx("strong",{children:"Joueur:"})," ",k.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp loup:"})," ",k.camp]}),e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",k.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",k.gameId]})]}):g==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Victime:"})," ",k.victimName]}),e.jsxs("div",{children:["âš”ï¸ ",e.jsx("strong",{children:"Tueur:"})," ",k.killerName||"Inconnu"]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",k.deathType?de(k.deathType):"Inconnu"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Victime:"})," ",k.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp victime:"})," ",k.camp]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",k.deathType?de(k.deathType):"Inconnu"]})]}),!R&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",k.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",k.gameId]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})};return e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:s.length>0?e.jsx(Y,{title:g==="deaths"?`Carte des Morts de ${y}`:`Carte des Kills de ${y}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(He,{margin:{top:20,right:30,left:60,bottom:20},children:[a&&e.jsx(ae,{x1:a.zMin,x2:a.zMax,y1:a.xMin,y2:a.xMax,fill:"transparent",stroke:"none",shape:l=>{const{x:r,y:u,width:w,height:m}=l;return e.jsx("image",{x:r,y:u,width:w,height:m,href:a.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),j==="Village"&&i&&e.jsxs(e.Fragment,{children:[i==="Ruines"&&e.jsx(ae,{x1:-220,x2:200,y1:100,y2:450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Village Principal"&&e.jsx(ae,{x1:-250,x2:100,y1:-120,y2:-450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Ferme"&&e.jsx(ae,{x1:-550,x2:-250,y1:150,y2:-150,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Village PÃªcheur"&&e.jsx(ae,{x1:150,x2:500,y1:80,y2:-320,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),i==="Reste de la Carte"&&e.jsx(ae,{x1:a?.zMin??-600,x2:a?.zMax??600,y1:a?.xMin??-500,y2:a?.xMax??500,fill:"var(--accent-primary)",fillOpacity:.15,stroke:"var(--accent-primary)",strokeWidth:2,strokeDasharray:"5 5"})]}),e.jsx(J,{strokeDasharray:"3 3",stroke:a?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(Q,{dataKey:"z",type:"number",name:"Position Z",domain:p,hide:!0}),e.jsx(X,{dataKey:"x",type:"number",name:"Position X",domain:h,hide:!0}),e.jsx(H,{content:e.jsx(o,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(_e,{data:c,onClick:l=>d(l),style:{cursor:"pointer"},isAnimationActive:!1,children:c.map((l,r)=>{const u=Math.min(Math.log2(l.count+1)*3+5,18),w=Math.round(u);return e.jsx(Z,{fill:n(l.deathType,l.camp),stroke:l.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:l.count>1?2:1,opacity:.85,r:w},`cell-${r}`)})})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:g==="deaths"?`Aucune mort localisÃ©e pour ${y} sur cette carte.`:g==="kills"?`Aucun kill localisÃ© pour ${y} sur cette carte.`:`Aucune transformation en loup localisÃ©e pour ${y} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes."})]})})}function Re(s,c){return c>=-250&&c<=100&&s>=-450&&s<=-120?"Village Principal":c>=-550&&c<=-250&&s>=-150&&s<=150?"Ferme":c>=150&&c<=500&&s>=-320&&s<=80?"Village PÃªcheur":c>=-220&&c<=200&&s>=100&&s<=450?"Ruines":"Reste de la Carte"}function le(s){return s==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":s}function bt({selectedPlayerName:s}){const{navigateToGameDetails:c}=ne(),{gameData:g,isLoading:y,error:j}=he(),a=oe(),[h,p]=D.useState("deaths"),[i,n]=D.useState(""),[d,o]=D.useState(0),[l,r]=D.useState(null),[u,w]=D.useState([]),[m,R]=D.useState(!1),{data:k}=xe(s,"Tous les camps"),I=D.useMemo(()=>{if(!g)return[];const S=new Set;return g.forEach(v=>{const T=v.PlayerStats.find(A=>A.Username.toLowerCase()===s.toLowerCase());T&&(T.DeathPosition!==null&&v.MapName&&S.add(v.MapName),v.PlayerStats.forEach(A=>{A.KillerName?.toLowerCase()===s.toLowerCase()&&A.DeathPosition!==null&&v.MapName&&S.add(v.MapName)}),T.Actions&&Array.isArray(T.Actions)&&T.Actions.some(A=>A.ActionType==="Transform")&&v.MapName&&S.add(v.MapName))}),Array.from(S).filter(v=>v==="Village"||v==="ChÃ¢teau").sort((v,T)=>v==="Village"?-1:T==="Village"?1:v.localeCompare(T))},[g,s]),N=I.length>0?I[0]:"";i===""&&N!==""&&n(N);const{availableDeathTypes:M,deathTypeColors:z}=D.useMemo(()=>{if(!g||!s)return{availableDeathTypes:[],deathTypeColors:{}};const S=new Set,v={};return g.forEach(T=>{const A=T.PlayerStats.find(L=>L.Username.toLowerCase()===s.toLowerCase());if(A){if(A.DeathPosition&&A.DeathType){const L=le(A.DeathType);L&&S.add(L)}T.PlayerStats.forEach(L=>{if(L.KillerName?.toLowerCase()===s.toLowerCase()&&L.DeathPosition&&L.DeathType){const B=le(L.DeathType);B&&S.add(B)}})}}),S.forEach(T=>{v[T]=Ue(T,a)}),{availableDeathTypes:Array.from(S).sort(),deathTypeColors:v}},[g,s,a]),V=(S,v)=>h==="transformations"&&v?a[v]||"var(--text-secondary)":S&&z[S]||"var(--text-secondary)";D.useEffect(()=>{if(u.length===0&&M.length>0){const S=M.filter(v=>v!=="VOTED");w(S)}},[M.length]);const $=D.useMemo(()=>{if(!g||!s)return[];const S=[];return g.forEach(v=>{if(i&&v.MapName!==i)return;const T=v.PlayerStats.find(A=>A.Username.toLowerCase()===s.toLowerCase());if(T)if(h==="deaths"){if(T.DeathPosition){const A=ce(T.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),L=me(T.DeathPosition.x,T.DeathPosition.z,v.MapName);S.push({x:L.x,z:L.z,victimName:T.Username,killerName:T.KillerName||null,deathType:le(T.DeathType),mapName:v.MapName,camp:A,gameId:v.DisplayedId,displayedGameId:v.DisplayedId})}}else h==="kills"?v.PlayerStats.forEach(A=>{if(A.KillerName?.toLowerCase()===s.toLowerCase()&&A.DeathPosition){const L=ce(A.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),B=me(A.DeathPosition.x,A.DeathPosition.z,v.MapName);S.push({x:B.x,z:B.z,victimName:A.Username,killerName:s,deathType:le(A.DeathType),mapName:v.MapName,camp:L,gameId:v.DisplayedId,displayedGameId:v.DisplayedId})}}):h==="transformations"&&T.Actions&&Array.isArray(T.Actions)&&T.Actions.forEach(A=>{if(A.ActionType==="Transform"&&A.Position){const L=ce(T.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),B=me(A.Position.x,A.Position.z,v.MapName);S.push({x:B.x,z:B.z,victimName:T.Username,killerName:null,deathType:null,mapName:v.MapName,camp:L,gameId:v.DisplayedId,displayedGameId:v.DisplayedId})}})}),h!=="transformations"&&u.length>0&&u.length<M.length?S.filter(v=>v.deathType&&u.includes(v.deathType)):S},[g,s,h,i,u,M]),F=D.useMemo(()=>{if(i!=="Village"||h!=="deaths"||$.length===0)return null;const S={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};if($.forEach(E=>{const G=Re(E.x,E.z);S[G]=(S[G]||0)+1}),!g)return null;const v={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};g.forEach(E=>{E.MapName==="Village"&&E.PlayerStats.forEach(G=>{if(!G.DeathPosition)return;const _=le(G.DeathType);if(u.length>0&&u.length<M.length&&(!_||!u.includes(_)))return;const U=me(G.DeathPosition.x,G.DeathPosition.z,"Village"),fe=Re(U.x,U.z);v[fe]=(v[fe]||0)+1})});const T=Object.values(v).reduce((E,G)=>E+G,0),A=Object.values(S).reduce((E,G)=>E+G,0);if(T===0||A===0)return null;const L=["Village Principal","Village PÃªcheur","Ferme","Ruines","Reste de la Carte"];let B=0,b=null;const q=L.map(E=>{const G=S[E]/A*100,_=v[E]/T*100,U=G-_;return U>B&&S[E]>=2&&(B=U,b=E),{zone:E,playerCount:S[E],playerPercent:G,avgPercent:_,deviation:U}});return{totalPlayerDeaths:A,totalAllDeaths:T,zoneStats:q,dominantZone:b,maxDeviation:B}},[$,i,h,g,u,M]),t=D.useMemo(()=>Ye($,d).map((v,T)=>{const A=v.items[0],L=Je(v.items);return{x:v.centroidX,z:v.centroidZ,count:v.items.length,allLocations:v.items,victimName:v.items.length===1?A.victimName:null,killerName:v.items.length===1?A.killerName:null,deathType:L,mapName:A.mapName,camp:A.camp,gameId:v.items.length===1?A.gameId:null,displayedGameId:v.items.length===1?A.displayedGameId:null,clusterIndex:T}}),[$,d]),P=D.useMemo(()=>Qe(i),[i]),{xDomain:W,zDomain:C}=D.useMemo(()=>{if(P)return{xDomain:[P.xMin,P.xMax],zDomain:[P.zMin,P.zMax]};if(t.length===0)return{xDomain:[0,100],zDomain:[0,100]};const S=t.map(E=>E.x),v=t.map(E=>E.z),T=Math.min(...S),A=Math.max(...S),L=Math.min(...v),B=Math.max(...v),b=(A-T)*.1||10,q=(B-L)*.1||10;return{xDomain:[T-b,A+b],zDomain:[L-q,B+q]}},[t,P]),f=S=>{if(!S)return;const v=S.allLocations||[S];if(v.length===1)c({selectedGame:v[0].gameId,fromComponent:"Player Death Map"});else{const T=v.map(A=>A.gameId).filter(A=>A);c({selectedGameIds:T,fromComponent:"Player Death Map"})}},x=D.useMemo(()=>{if(!k?.mapStats||!i)return null;const S=k.mapStats[i];return S?{winRate:S.winRate,wins:S.wins,total:S.appearances}:null},[k,i]);return y?e.jsx("div",{className:"donnees-attente",children:"Chargement des donnÃ©es..."}):j?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",j]}):g?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsx(yt,{viewMode:h,setViewMode:p,selectedMap:i,setSelectedMap:n,availableMaps:I,clusterRadius:d,setClusterRadius:o,availableDeathTypes:M,selectedDeathTypes:u,setSelectedDeathTypes:w,deathTypeColors:z,isDeathTypesExpanded:m,setIsDeathTypesExpanded:R}),e.jsx(jt,{locationData:$,clusteredData:t,viewMode:h,selectedPlayerName:s,selectedMap:i,mapConfig:P,xDomain:W,zDomain:C,hoveredZone:l,getDeathColor:V,handleLocationClick:f}),e.jsx(vt,{zoneAnalysis:F,selectedMap:i,viewMode:h,selectedPlayerName:s,hoveredZone:l,setHoveredZone:r}),x&&e.jsxs("div",{style:{flex:"1 1 100%",textAlign:"center",padding:"0.75rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)",marginTop:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginRight:"1rem"},children:["Taux de victoire sur ",e.jsx("strong",{children:i})," :"]}),e.jsxs("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:parseFloat(x.winRate)>=50?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[x.winRate,"%"]}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["(",x.wins," / ",x.total," victoires)"]})]}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"Ã€ propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",h==="deaths"?`les emplacements oÃ¹ ${s} est mort`:h==="kills"?`les emplacements oÃ¹ ${s} a Ã©liminÃ© d'autres joueurs`:`les emplacements oÃ¹ ${s} s'est transformÃ© en loup`," au cours des parties.",h!=="transformations"&&"Les couleurs indiquent le type de mort."," Cliquez sur un point pour voir les dÃ©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroupÃ©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’€ Morts:"})," OÃ¹ le joueur a Ã©tÃ© Ã©liminÃ©",e.jsx("br",{}),e.jsx("strong",{children:"âš”ï¸ Kills:"})," OÃ¹ le joueur a Ã©liminÃ© d'autres joueurs",e.jsx("br",{}),e.jsx("strong",{children:"ðŸº Transformations:"})," OÃ¹ le joueur s'est transformÃ© en loup"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function Ae(s){return s.PlayerStats.some(c=>c.SecondsTalkedOutsideMeeting>0||c.SecondsTalkedDuringMeeting>0)}function ye(s,c){const g=c.DeathDateIrl||s.EndDate,y=Te(s.StartDate,g);return y&&y>0?y:0}function Ct(s){const c=s.filter(Ae),g=new Map;return c.forEach(y=>{y.PlayerStats.forEach(j=>{const a=te(j),h=$e(j),p=ye(y,j);if(p<=0)return;g.has(a)||g.set(a,{displayName:h,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const i=g.get(a);i.gamesPlayed++,i.totalSecondsAll+=(j.SecondsTalkedOutsideMeeting||0)+(j.SecondsTalkedDuringMeeting||0),i.totalGameDuration+=p})}),{playerStats:g,gamesWithTalkingData:c.length}}function St(s,c){if(!c||c.length===0||!s)return null;const g=Ct(c),y=c.filter(Ae);if(y.length===0||g.playerStats.size===0)return null;let j=null;for(const[f,x]of g.playerStats)if(x.displayName===s){j=f;break}if(!j)return null;let a=0,h=0,p=0,i=0;const n={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},d=new Map;let o=0,l=0,r=0,u=0;if(y.forEach(f=>{const x=f.PlayerStats.find(q=>te(q)===j);if(!x)return;const S=ye(f,x);if(S<=0)return;a++;const v=x.SecondsTalkedOutsideMeeting||0,T=x.SecondsTalkedDuringMeeting||0,A=v+T;h+=v,p+=T,i+=S;const L=Ie(x.MainRoleInitial,x.Power);n[L].gamesPlayed++,n[L].secondsOutside+=v,n[L].secondsDuring+=T,n[L].gameDuration+=S;const B=Ke(x);d.has(B)||d.set(B,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const b=d.get(B);b.gamesPlayed++,b.totalSecondsAll+=A,b.totalGameDuration+=S}),a===0||i<=0)return null;const w=3600/i,m=h*w,R=p*w,k=(h+p)*w,I=h+p>0?p/(h+p)*100:0,N=[];for(const[f,x]of Object.entries(n)){if(x.gamesPlayed===0)continue;const S=x.gameDuration>0?3600/x.gameDuration:0,v=x.secondsOutside+x.secondsDuring;N.push({camp:f,gamesPlayed:x.gamesPlayed,totalSecondsOutside:x.secondsOutside,totalSecondsDuring:x.secondsDuring,totalSecondsAll:v,totalGameDurationSeconds:x.gameDuration,secondsOutsidePer60Min:x.secondsOutside*S,secondsDuringPer60Min:x.secondsDuring*S,secondsAllPer60Min:v*S,meetingRatio:v>0?x.secondsDuring/v*100:0})}N.sort((f,x)=>x.gamesPlayed-f.gamesPlayed);const M=Array.from(d.entries()).filter(([f,x])=>x.gamesPlayed>=1).map(([f,x])=>({role:f,gamesPlayed:x.gamesPlayed,secondsAllPer60Min:x.totalGameDuration>0?x.totalSecondsAll/x.totalGameDuration*3600:0,totalSecondsAll:x.totalSecondsAll})).sort((f,x)=>x.secondsAllPer60Min-f.secondsAllPer60Min),z=[];for(const[f,x]of g.playerStats)x.totalGameDuration>0&&z.push({id:f,name:x.displayName,per60:x.totalSecondsAll/x.totalGameDuration*3600});z.sort((f,x)=>x.per60-f.per60);const V=z.reduce((f,x)=>f+x.per60,0),$=z.length>0?V/z.length:0,F=z.findIndex(f=>f.id===j)+1,t=z.length,P=t>0?Math.round((1-(F-1)/t)*100):0,W=k;y.forEach(f=>{const x=f.PlayerStats.find(A=>te(A)===j);if(!x)return;const S=ye(f,x);if(S<=0)return;((x.SecondsTalkedOutsideMeeting||0)+(x.SecondsTalkedDuringMeeting||0))/S*3600>=W?(o++,x.Victorious&&l++):(r++,x.Victorious&&u++)});const C={gamesAboveAverage:o,winsAboveAverage:l,winRateAboveAverage:o>0?l/o*100:0,gamesBelowAverage:r,winsBelowAverage:u,winRateBelowAverage:r>0?u/r*100:0};return{playerName:s,gamesPlayed:a,gamesWithTalkingData:g.gamesWithTalkingData,totalSecondsOutside:h,totalSecondsDuring:p,totalSecondsAll:h+p,totalGameDurationSeconds:i,secondsOutsidePer60Min:m,secondsDuringPer60Min:R,secondsAllPer60Min:k,meetingRatio:I,campBreakdown:N,globalAverageSecondsAllPer60Min:$,playerRank:F,totalPlayersWithData:t,percentile:P,roleBreakdown:M,winCorrelation:C}}function wt(s,c){return s?s.roleBreakdown.slice(0,c):[]}function Rt(s){const{data:c,isLoading:g,error:y}=ve(j=>s?St(s,j):null);return{data:c,isLoading:g,error:y}}function kt({selectedPlayerName:s}){const{data:c,isLoading:g,error:y}=Rt(s),j=oe(),[a,h]=D.useState("both"),p=D.useMemo(()=>c?.campBreakdown?c.campBreakdown.map(r=>({camp:r.camp,"Hors rÃ©union":Math.round(r.secondsOutsidePer60Min),"En rÃ©union":Math.round(r.secondsDuringPer60Min),total:Math.round(r.secondsAllPer60Min),gamesPlayed:r.gamesPlayed,meetingRatio:r.meetingRatio.toFixed(1)})):[],[c]),i=D.useMemo(()=>c?[{name:"En rÃ©union",value:c.totalSecondsDuring,color:"#2196F3"},{name:"Hors rÃ©union",value:c.totalSecondsOutside,color:"#FF9800"}]:[],[c]);if(g)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(y)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",y]});if(!c)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de temps de parole ne sont disponibles que pour les parties rÃ©centes."})]});const n=c.secondsAllPer60Min-c.globalAverageSecondsAllPer60Min,d=c.globalAverageSecondsAllPer60Min>0?(n/c.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",o=n>0,l=c.winCorrelation.winRateAboveAverage-c.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¤ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:re(c.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:o?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[o?"+":"",d,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",c.playerRank," / ",c.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-c.percentile+1,"% ",c.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“ˆ Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:c.gamesPlayed}),e.jsxs("p",{children:["sur ",c.gamesWithTalkingData," avec donnÃ©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ—£ï¸ Ratio en rÃ©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[c.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),p.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(Y,{title:"Temps de parole par camp (par 60min de jeu)",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>h("meeting"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="meeting"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="meeting"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="meeting"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="meeting"?"bold":"normal"},children:"En rÃ©union"}),e.jsx("button",{onClick:()=>h("outside"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="outside"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="outside"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="outside"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="outside"?"bold":"normal"},children:"Hors rÃ©union"}),e.jsx("button",{onClick:()=>h("both"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:a==="both"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:a==="both"?"var(--accent-primary)":"var(--bg-secondary)",color:a==="both"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:a==="both"?"bold":"normal"},children:"Les deux"})]}),e.jsx("div",{style:{height:350},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:p,layout:"vertical",children:[e.jsx(J,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(Q,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:r=>`${Math.floor(r/60)}m`}),e.jsx(X,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(H,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(r,u)=>[re(r),u],labelFormatter:r=>{const u=p.find(w=>w.camp===r);return`${r} (${u?.gamesPlayed||0} parties)`}}),e.jsx(De,{}),(a==="both"||a==="outside")&&e.jsx(O,{dataKey:"Hors rÃ©union",stackId:"talk",fill:"#FF9800"}),(a==="both"||a==="meeting")&&e.jsx(O,{dataKey:"En rÃ©union",stackId:"talk",fill:"#2196F3"})]})})})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:(()=>{const r=p.find(R=>R.camp==="Villageois"),u=p.find(R=>R.camp==="Loup");if(!r||!u)return e.jsx("p",{children:"ðŸ’¡ Pas assez de donnÃ©es pour comparer les camps Villageois et Loups."});const w=r.total-u.total,m=u.total>0?(Math.abs(w)/u.total*100).toFixed(0):"0";return w>0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:s})," parle"," ",e.jsxs("strong",{style:{color:je("Villageois")},children:[re(w)," de plus (+",m,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Villageois"})," qu'en tant que"," ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]}):w<0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:s})," parle"," ",e.jsxs("strong",{style:{color:je("Loup")},children:[re(Math.abs(w))," de plus (+",m,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Loup"})," qu'en tant que"," ",e.jsx("strong",{children:"Villageois"})," (par heure de jeu)."]}):e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:s})," parle exactement autant en tant que"," ",e.jsx("strong",{children:"Villageois"})," qu'en tant que ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(Y,{title:"RÃ©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Ne,{children:[e.jsx(Pe,{data:i,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:r=>`${r.name}: ${((r.percent||0)*100).toFixed(1)}%`,children:i.map((r,u)=>e.jsx(Z,{fill:r.color},`cell-${u}`))}),e.jsx(H,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:r=>re(r)})]})})})})}),c&&c.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(Y,{title:r=>r?"Top 15 rÃ´les les plus bavards (par 60min)":"Top 5 rÃ´les les plus bavards (par 60min)",children:r=>{const w=wt(c,r?15:5).map(m=>({role:m.role,secondsPer60Min:Math.round(m.secondsAllPer60Min),gamesPlayed:m.gamesPlayed}));return e.jsx("div",{style:{height:r?400:300},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(ee,{data:w,children:[e.jsx(J,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(Q,{dataKey:"role",tick:{fill:"var(--text-primary)",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(X,{tick:{fill:"var(--text-secondary)"},tickFormatter:m=>`${Math.floor(m/60)}m`}),e.jsx(H,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:m=>[re(m),"Temps de parole"],labelFormatter:m=>{const R=w.find(k=>k.role===m);return`${m} (${R?.gamesPlayed||0} parties)`}}),e.jsx(O,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",children:w.map((m,R)=>e.jsx(Z,{fill:j[m.role]||j.Villageois},`cell-${R}`))})]})})})}})}),(c.winCorrelation.gamesAboveAverage>0||c.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"ðŸŽ¯ CorrÃ©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[c.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",c.winCorrelation.winsAboveAverage,"/",c.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[c.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",c.winCorrelation.winsBelowAverage,"/",c.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(l)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:s})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:l>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[l>0?"supÃ©rieur":"infÃ©rieur"," de ",Math.abs(l).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function Tt({playerTitles:s,titlesLoading:c}){if(c)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des titres..."})]})});if(!s||s.titles.length===0)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-empty",children:[e.jsx("p",{children:"ðŸ“œ Aucun titre disponible"}),e.jsx("p",{className:"empty-subtitle",children:s?.gamesPlayed?`${s.gamesPlayed} parties jouÃ©es - minimum 25 parties requises pour obtenir des titres`:"Les titres sont gÃ©nÃ©rÃ©s chaque dimanche pour les joueurs avec 25+ parties en mode moddÃ©"})]})});const g=[...s.titles].sort((h,p)=>{const i=s.titles.indexOf(h),d=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(h.category||"")?100-(h.percentile||50):h.percentile||50,o=(h.priority||0)*1e3+d*10-i,l=s.titles.indexOf(p),u=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(p.category||"")?100-(p.percentile||50):p.percentile||50;return(p.priority||0)*1e3+u*10-l-o}),y=g.filter(h=>!h.primaryOwner),j=g.filter(h=>h.primaryOwner),a=(h,p)=>{const i=s.primaryTitle?.id===h.id;return e.jsxs("div",{className:`title-card ${h.type} ${i?"primary":""} ${h.primaryOwner?"awarded-elsewhere":""}`,title:`${h.description}${h.percentile!==void 0?`
MeilleurÂ·e que ${h.percentile.toFixed(1)}% des joueurs`:""}`,children:[e.jsx("div",{className:"title-rank",children:p+1}),i&&e.jsx("div",{className:"title-crown",children:"ðŸ‘‘"}),e.jsx("div",{className:"title-emoji",children:h.emoji}),e.jsxs("div",{className:"title-info",children:[e.jsx("div",{className:"title-name",children:h.title}),e.jsx("div",{className:"title-description",children:h.description}),h.percentile!==void 0&&h.type!=="combination"&&e.jsxs("div",{className:"title-percentile",children:["Top ",(100-h.percentile).toFixed(0),"%"]}),e.jsx("div",{className:"title-type-badge",children:h.type==="combination"?"Combo":h.type==="role"?"RÃ´le":"Stat"}),!i&&h.primaryOwner&&e.jsxs("div",{className:"title-primary-owner",children:["ðŸ‘¤ Titre principal de: ",e.jsx("strong",{children:h.primaryOwner})]}),h.type==="combination"&&h.conditions&&h.conditions.length>0&&e.jsxs("div",{className:"title-conditions-breakdown",children:[e.jsx("div",{className:"breakdown-header",children:"Conditions:"}),h.conditions.map((n,d)=>e.jsxs("div",{className:"condition-item",children:[e.jsxs("span",{className:"condition-stat",children:[n.stat==="winRate"?"Victoires":n.stat==="loot"?"RÃ©colte":n.stat==="lootVillageois"?"RÃ©colte (Villageois)":n.stat==="lootLoup"?"RÃ©colte (Loup)":n.stat==="survival"?"Survie":n.stat==="killRate"?"Kills":n.stat==="talking"?"Parole":n.stat==="talkingOutsideMeeting"?"Parole (hors dÃ©bats)":n.stat==="talkingDuringMeeting"?"Parole (meeting)":n.stat==="votingAggressive"?"Vote agressif":n.stat==="votingAccuracy"?"PrÃ©cision vote":n.stat==="votingFirst"?"Vote rapide":n.stat==="survivalDay1"?"Survie J1":n.stat==="winRateVillageois"?"Victoires Villageois":n.stat==="winRateLoup"?"Victoires Loup":n.stat==="winRateSolo"?"Victoires Solo":n.stat==="hunterAccuracy"?"PrÃ©cision cible chasseur":n.stat==="hunterShotAccuracy"?"PrÃ©cision tir chasseur":n.stat==="zoneVillagePrincipal"?"Village Principal":n.stat==="zoneFerme"?"Ferme":n.stat==="zoneVillagePecheur"?"Village PÃªcheur":n.stat==="zoneRuines"?"Ruines":n.stat==="zoneResteCarte"?"Reste de la carte":n.stat==="zoneDominantPercentage"?"Dominance zone":n.stat,":"]}),e.jsx("span",{className:`condition-category ${n.category?.toLowerCase()}`,children:n.category}),n.actualPercentile!==void 0&&e.jsxs("span",{className:"condition-percentile",children:["(Top ",(100-n.actualPercentile).toFixed(0),"%)"]})]},d))]})]})]},h.id)};return e.jsxs("div",{className:"titles-section",children:[e.jsxs("div",{className:"titles-header",children:[e.jsx("h3",{children:"ðŸ·ï¸ Titres actuels"}),e.jsxs("p",{className:"titles-info",children:[s.titles.length," titre",s.titles.length>1?"s":""," â€¢ ",s.gamesPlayed," parties jouÃ©es"]})]}),y.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"titles-subsection-header",children:[e.jsxs("h4",{children:["âœ¨ Vos Titres (",y.length,")"]}),e.jsx("p",{children:"Titres que vous possÃ©dez ou partagez"})]}),e.jsx("div",{className:"titles-grid",children:y.map((h,p)=>a(h,p))})]}),j.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"titles-subsection-header secondary",children:[e.jsxs("h4",{children:["ðŸ–ï¸ Titres QualifiÃ©s (",j.length,")"]}),e.jsx("p",{children:"Vous remplissez les conditions, mais un autre joueur a une meilleure revendication"})]}),e.jsx("div",{className:"titles-grid awarded-elsewhere-grid",children:j.map((h,p)=>a(h,y.length+p))})]})]})}function Ut(){const{settings:s,updateSettings:c}=pe(),{navigateToGameDetails:g,navigationState:y,updateNavigationState:j}=ne(),{data:a,isLoading:h,error:p}=Le(),{joueursData:i,isLoading:n}=ue(),{data:d,isLoading:o,error:l}=st(s.highlightedPlayer),{playerData:r,isLoading:u}=at(s.highlightedPlayer),w=ge(i),[m,R]=D.useState(""),[k,I]=D.useState(null),{clips:N}=Xe(s.highlightedPlayer),{clips:M}=Ze(),[z,V]=D.useState(()=>s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled?s.independentFilters.gameFilter==="modded"?"modded":"all":s.gameFilter==="modded"?"modded":"all"),$=D.useMemo(()=>s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled?s.independentFilters.gameFilter==="modded":s.gameFilter==="modded",[s.useIndependentFilters,s.independentFilters?.gameTypeEnabled,s.independentFilters?.gameFilter,s.gameFilter]),[F,t]=D.useState(s.selectedPlayerSelectionView||y.selectedPlayerSelectionView||"achievements"),[P,W]=D.useState("session"),[C,f]=D.useState("all");D.useEffect(()=>{if(s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled){const b=s.independentFilters.gameFilter==="modded"?"modded":"all";V(b)}else if(!s.useIndependentFilters){const b=s.gameFilter==="modded"?"modded":"all";V(b)}},[s.gameFilter,s.useIndependentFilters,s.independentFilters?.gameTypeEnabled,s.independentFilters?.gameFilter]),D.useEffect(()=>{$&&z!=="modded"&&V("modded")},[$,z]),D.useEffect(()=>{const b=s.selectedPlayerSelectionView||y.selectedPlayerSelectionView;b&&b!==F&&t(b)},[s.selectedPlayerSelectionView,y.selectedPlayerSelectionView]);const{data:x}=xe(s.highlightedPlayer||""),S=D.useMemo(()=>{if(!a||!a.GameStats)return[];const b=$?a.GameStats.filter(E=>E.Modded===!0):a.GameStats,q=new Map;return b.forEach(E=>{const G=new Date(E.StartDate);E.PlayerStats.forEach(_=>{const U=te(_),Me=i?.Players?.find(Fe=>Fe.SteamID===U)?.Joueur||_.Username;q.has(U)||q.set(U,{games:0,wins:0,firstDate:G,lastDate:G,displayName:Me});const se=q.get(U);se.games++,_.Victorious&&se.wins++,G<se.firstDate&&(se.firstDate=G),G>se.lastDate&&(se.lastDate=G)})}),Array.from(q.entries()).map(([E,G])=>{let _=i?.Players?.find(U=>U.SteamID===E);return _||(_=i?.Players?.find(U=>U.Joueur===G.displayName)),{id:E,name:G.displayName,totalGames:G.games,totalWins:G.wins,winRate:G.games>0?G.wins/G.games*100:0,firstGameDate:G.firstDate.toLocaleDateString("fr-FR"),lastGameDate:G.lastDate.toLocaleDateString("fr-FR"),isHighlighted:G.displayName===s.highlightedPlayer,image:_?.Image||null,twitch:_?.Twitch||null,youtube:_?.Youtube||null}})},[a,s.highlightedPlayer,i,$]),v=D.useMemo(()=>{if(!m.trim())return S;const b=m.toLowerCase();return S.filter(q=>q.name.toLowerCase().includes(b))},[S,m]),T=D.useMemo(()=>[...v].sort((b,q)=>q.totalGames-b.totalGames),[v]),A=b=>{c({highlightedPlayer:b}),R("")},L=b=>{t(b),j({selectedPlayerSelectionView:b}),c({selectedPlayerSelectionView:b,tab:"playerSelection"})},B=()=>{if(N.length===0)return;const b=Math.floor(Math.random()*N.length);I(N[b])};return h||n?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):p?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",p]})]}):!a||S.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!s.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:m,onChange:b=>R(b.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[v.length," joueur",v.length!==1?"s":"",m&&` (filtrÃ©${v.length!==1?"s":""} de ${S.length})`]})]})]}),e.jsx("div",{className:"player-display",children:m?v.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>R(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:T.map(b=>e.jsxs("button",{type:"button",className:`suggestion-btn ${b.isHighlighted?"highlighted":""}`,onClick:()=>A(b.name),children:[b.image?e.jsx("img",{src:b.image,alt:`Photo de profil de ${b.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":w[b.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[b.name,b.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[b.totalGames," parties â€¢ ",b.winRate.toFixed(1),"% victoires"]})]})]},b.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',m,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>R(""),children:"Effacer la recherche"})]}):s.highlightedPlayer?(()=>{const b=S.find(q=>q.name===s.highlightedPlayer);return b?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:b.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[b.image?e.jsx("img",{src:b.image,alt:`Photo de profil de ${b.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":w[b.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[b.totalGames," parties â€¢ ",b.totalWins," victoires â€¢ ",b.winRate.toFixed(1),"% taux de victoire"]}),r?.primaryTitle?e.jsxs("div",{className:"player-primary-title",title:r.primaryTitle.description,style:{marginTop:"0.5rem",display:"inline-flex",alignItems:"center",gap:"0.3rem",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("span",{className:"title-emoji",children:r.primaryTitle.emoji}),e.jsx("span",{className:"title-text",children:r.primaryTitle.title})]}):e.jsx("div",{className:"player-no-title",style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic"},children:"ðŸ“œ 25 parties moddÃ©es minimum pour obtenir un titre"}),(b.twitch||b.youtube||N.length>0)&&e.jsxs("div",{className:"social-links",children:[b.twitch&&e.jsx("a",{href:b.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),b.youtube&&e.jsx("a",{href:b.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"}),N.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:q=>{q.stopPropagation(),B()},title:`${N.length} clip${N.length>1?"s":""} disponible${N.length>1?"s":""}`,children:["ðŸŽ¬ Clip alÃ©atoire (",N.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="achievements"?"active":""}`,onClick:()=>L("achievements"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="titles"?"active":""}`,onClick:()=>L("titles"),children:"Titres"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="evolution"?"active":""}`,onClick:()=>L("evolution"),children:"Ã‰volution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="camps"?"active":""}`,onClick:()=>L("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="roles"?"active":""}`,onClick:()=>L("roles"),children:"RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="actions"?"active":""}`,onClick:()=>L("actions"),children:"Actions"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="roleactions"?"active":""}`,onClick:()=>L("roleactions"),children:"RÃ´les SpÃ©ciaux"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="kills"?"active":""}`,onClick:()=>L("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="deathmap"?"active":""}`,onClick:()=>L("deathmap"),children:"Cartes"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${F==="talkingtime"?"active":""}`,onClick:()=>L("talkingtime"),children:"Parole"})]}),F==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[o?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):l?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",l]})}):d?e.jsx(it,{achievements:z==="all"?d.allGamesAchievements:d.moddedOnlyAchievements,title:z==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:z}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[!$&&e.jsx("button",{type:"button",className:`filter-btn ${z==="all"?"active":""}`,onClick:q=>{q.stopPropagation(),V("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${z==="modded"?"active":""}`,onClick:q=>{q.stopPropagation(),V("modded")},disabled:$,children:"Parties moddÃ©es"})]})]}),F==="titles"&&e.jsx(Tt,{playerTitles:r,titlesLoading:u}),F==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[x&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{g({selectedPlayer:b.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${b.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:x.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:Ee(x.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{g({selectedPlayer:b.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${b.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:x.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[x.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:P,onChange:q=>W(q.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:C,onChange:q=>f(q.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(nt,{selectedPlayerName:b.name,groupingMethod:P,campFilter:C})]}),F==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ot,{selectedPlayerName:b.name})}),F==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(dt,{selectedPlayerName:b.name})}),F==="actions"&&e.jsx("div",{className:"player-history-section",children:e.jsx(pt,{selectedPlayerName:b.name})}),F==="roleactions"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ft,{selectedPlayerName:b.name})}),F==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(lt,{selectedPlayerName:b.name})}),F==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(bt,{selectedPlayerName:b.name})}),F==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(kt,{selectedPlayerName:b.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:q=>{q.stopPropagation(),c({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[b.firstGameDate," - ",b.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',s.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>c({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:T.map(b=>e.jsxs("div",{className:`character-card ${b.isHighlighted?"highlighted":""}`,onClick:()=>A(b.name),title:`${b.name} - ${b.totalGames} parties, ${b.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:b.image?e.jsx("img",{src:b.image,alt:`Photo de profil de ${b.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":w[b.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:b.name}),(b.twitch||b.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[b.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),b.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},b.id))})})}),k&&e.jsx(et,{clip:k,onClose:()=>I(null),relatedClips:tt(k,M),nextClip:Se(k,M),onNextClip:()=>{const b=Se(k,M);b&&I(b)},onRelatedClip:b=>{const q=M.find(E=>E.ClipId===b);q&&I(q)}})]})}export{Ut as PlayerSelectionPage};
