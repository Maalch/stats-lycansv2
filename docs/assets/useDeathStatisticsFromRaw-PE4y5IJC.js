import{u as L}from"./baseStatsHook-CUr325ff.js";import{g as R,a as C}from"./datasyncExport-D6_8Fmuy.js";import{i as k,D as l}from"./deathTypes-CGUOTngO.js";import{c as v}from"./api-p1ThVxJG.js";import{g as A}from"./index-DKvcuTxH.js";function K(n,u){if(!n||!u)return!1;const r=n.split(".").map(Number),c=u.split(".").map(Number);for(let a=0;a<Math.max(r.length,c.length);a++){const e=r[a]||0,i=c[a]||0;if(e>i)return!0;if(e<i)return!1}return!0}function V(n){return n===l.SURVIVALIST_NOT_SAVED?l.BY_WOLF:n}function M(n){const u=new Set;n.forEach(a=>{a.PlayerStats.forEach(e=>{const i=R(e.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});u.add(i)})});const r=Array.from(u);return[...v.filter(a=>r.includes(a)),...r.filter(a=>!v.includes(a)).sort()]}function F(n){switch(n){case l.VOTED:return"Mort aux votes";case l.BY_WOLF:case l.SURVIVALIST_NOT_SAVED:return"Kill en Loup";case l.BY_ZOMBIE:return"Kill en Zombie";case l.BY_BEAST:return"Kill en Bête";case l.BY_AVATAR_CHAIN:return"Mort d'Avatar";case l.BULLET:return"Tir de Chasseur";case l.BULLET_HUMAN:return"Kill de Chasseur (sur humain)";case l.BULLET_WOLF:return"Kill de Chasseur (sur loup)";case l.SHERIF_SUCCESS:return"Kill de Shérif";case l.OTHER_AGENT:return"Kill d'Agent";case l.AVENGER:return"Kill de Vengeur";case l.SEER:return"Kill de Devin";case l.HANTED:return"Kill avec Potion hantée";case l.ASSASSIN:return"Kill avec Potion (Assassin)";case l.LOVER_DEATH:return"Kill d'amoureux";case l.BOMB:return"Explosion";case l.CRUSHED:return"Écrasement";case l.STARVATION:return"Famine";case l.STARVATION_AS_BEAST:return"Tuerie bestiale";case l.FALL:return"Chute mortelle";case l.UNKNOWN:return"Kill inconnu";default:return""}}function j(n){const u=new Set;n.forEach(a=>{a.PlayerStats.forEach(e=>{if(e.DeathType&&k(e.DeathType)){const i=V(e.DeathType);i&&u.add(i)}})});const r=Array.from(u),c=[l.BY_WOLF,l.VOTED,l.BULLET,l.BULLET_HUMAN,l.BULLET_WOLF,l.BY_ZOMBIE,l.ASSASSIN,l.AVENGER,l.LOVER_DEATH];return[...c.filter(a=>r.includes(a)),...r.filter(a=>!c.includes(a)).sort()]}function O(n,u){return n.PlayerStats.filter(r=>r.DeathType&&k(r.DeathType)&&(r.DeathTiming||r.DeathType)).map(r=>{let c=null,a=null;if(r.KillerName){const e=n.PlayerStats.find(i=>i.Username===r.KillerName);if(e){a=A(e);const i=C(e.MainRoleInitial,e.MainRoleChanges||[]);c=R(i,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1}),i&&i!==e.MainRoleInitial&&(i==="Loup"?c="Loup":i==="Zombie"&&(c="Vaudou"))}}return{playerId:A(r),playerName:r.Username,deathType:V(r.DeathType),killerId:a,killerName:r.KillerName,killerCamp:c}}).filter(r=>{if(!u||u==="Tous les camps")return!0;const c=n.PlayerStats.find(e=>e.Username===r.playerName);return c?R(c.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===u:!1})}function U(n,u,r){const c=[];n.PlayerStats.forEach(e=>{if(e.KillerName&&e.DeathType){if(e.DeathType===l.VOTED||e.DeathType===l.STARVATION||e.DeathType===l.FALL||e.DeathType===l.BY_AVATAR_CHAIN)return;const i=n.PlayerStats.find(m=>m.Username===e.KillerName);if(!i)return;let E=R(i.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});const B=C(i.MainRoleInitial,i.MainRoleChanges||[]);B&&B!==i.MainRoleInitial&&(B==="Loup"?E="Loup":B==="Zombie"&&(E="Vaudou"));const p=R(e.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0});c.push({killerId:A(i),killerName:i.Username,victimId:A(e),victimName:e.Username,deathType:V(e.DeathType),killerCamp:E,victimCamp:p})}});let a=c;return u&&u!=="Tous les camps"&&(a=a.filter(e=>e.killerCamp===u)),r&&r!=="Tous les camps"&&(a=a.filter(e=>r==="Roles solo"?e.victimCamp!=="Villageois"&&e.victimCamp!=="Loup":e.victimCamp===r)),a}function _(n,u,r){if(n.length===0||n.length===0)return null;const c=[],a={},e={};n.forEach(s=>{O(s,u).forEach(t=>{c.push({...t,gameId:s.Id})}),s.PlayerStats.forEach(t=>{const T=A(t),D=t.Username;e[T]=D,(!u||u==="Tous les camps"||R(t.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===u)&&(a[T]=(a[T]||0)+1)})});const i=c.length,E=n.length,B=E>0?i/E:0,p={};c.forEach(s=>{p[s.deathType]=(p[s.deathType]||0)+1});const m=Object.entries(p).map(([s,o])=>({type:s,count:o||0,percentage:i>0?(o||0)/i*100:0})).sort((s,o)=>o.count-s.count),h={};n.forEach(s=>{U(s,u,r).forEach(t=>{e[t.killerId]=t.killerName,e[t.victimId]=t.victimName,h[t.killerId]||(h[t.killerId]={kills:0,victims:new Set,killsByDeathType:{}}),h[t.killerId].kills++,h[t.killerId].victims.add(t.victimId),h[t.killerId].killsByDeathType[t.deathType]=(h[t.killerId].killsByDeathType[t.deathType]||0)+1})});const g=Object.entries(h).map(([s,o])=>{const t=a[s]||0,T=t>0?o.kills/t:0;return{killerName:e[s]||s,kills:o.kills,victims:Array.from(o.victims).map(D=>e[D]||D),percentage:i>0?o.kills/i*100:0,gamesPlayed:t,averageKillsPerGame:T,killsByDeathType:o.killsByDeathType}}).sort((s,o)=>o.kills-s.kills),d={};c.forEach(s=>{d[s.playerId]||(d[s.playerId]={totalDeaths:0,deathsByType:{},killedById:{},deathDays:[]});const o=d[s.playerId];o.totalDeaths++,o.deathsByType[s.deathType]=(o.deathsByType[s.deathType]||0)+1,s.killerId&&(o.killedById[s.killerId]=(o.killedById[s.killerId]||0)+1)});const f=[];Object.entries(d).forEach(([s,o])=>{const t=e[s]||s,T={};Object.entries(o.killedById).forEach(([D,N])=>{const P=e[D]||D;T[P]=(T[P]||0)+N}),f.push({playerName:t,totalDeaths:o.totalDeaths,deathsByType:o.deathsByType,killedBy:T,deathRate:a[s]>0?o.totalDeaths/a[s]:0,gamesPlayed:a[s]||0})}),Object.entries(a).forEach(([s,o])=>{d[s]||f.push({playerName:e[s]||s,totalDeaths:0,deathsByType:{},killedBy:{},deathRate:0,gamesPlayed:o})});const y=f.sort((s,o)=>o.totalDeaths-s.totalDeaths),S=m.length>0?m[0].type:null,I=g.length>0?g[0].killerName:null;return{totalDeaths:i,totalGames:E,averageDeathsPerGame:B,deathsByType:m,killerStats:g,playerDeathStats:y,mostCommonDeathType:S,mostDeadlyKiller:I}}function b(n,u){const r={},c={},a=n.length,e=[l.BULLET,l.BULLET_HUMAN,l.BULLET_WOLF];n.forEach(p=>{const m=new Set;p.PlayerStats.forEach(h=>{const g=h.MainRoleInitial,d=C(h.MainRoleInitial,h.MainRoleChanges||[]);if(g==="Chasseur"||d==="Chasseur"){const f=A(h);c[f]=h.Username,m.add(f),r[f]||(r[f]={kills:[],gamesPlayed:0,victimsCamps:[],gameVersions:[],gameModded:[]}),r[f].gamesPlayed++}}),p.PlayerStats.forEach(h=>{const g=h.DeathType,d=h.KillerName,f=d?p.PlayerStats.find(S=>S.Username===d):null,y=f?A(f):null;if(y&&f&&(c[y]=f.Username),g&&e.includes(g)&&y&&m.has(y)){const S=R(h.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});r[y].kills.push(g),r[y].victimsCamps.push(S),r[y].gameVersions.push(p.Version),r[y].gameModded.push(p.Modded)}})});const i=Object.entries(r).map(([p,m])=>{const h=m.kills.length,g={};m.kills.forEach(t=>{g[t]=(g[t]||0)+1});const d={};m.victimsCamps.forEach(t=>{d[t]=(d[t]||0)+1});let f=0,y=0;const S={},I={};m.victimsCamps.forEach((t,T)=>{const D=m.gameVersions[T],N=m.gameModded[T];t==="Idiot du Village"?N&&K(D,"0.202")?(y++,I[t]=(I[t]||0)+1):(f++,S[t]=(S[t]||0)+1):t==="Villageois"?(y++,I[t]=(I[t]||0)+1):(f++,S[t]=(S[t]||0)+1)});const s=m.gamesPlayed>0?h/m.gamesPlayed:0,o=m.gamesPlayed>0?f/m.gamesPlayed:0;return{hunterName:c[p]||p,totalKills:h,nonVillageoisKills:f,villageoisKills:y,gamesPlayedAsHunter:m.gamesPlayed,averageKillsPerGame:s,averageNonVillageoisKillsPerGame:o,killsByDeathType:g,victimsByCamp:d,goodVictimsByCamp:S,badVictimsByCamp:I}}).sort((p,m)=>m.totalKills-p.totalKills),E=i.length>0?i[0].hunterName:null,B=i.length>0?i.sort((p,m)=>m.averageNonVillageoisKillsPerGame-p.averageNonVillageoisKillsPerGame)[0].hunterName:null;return{totalHunters:i.length,totalGames:a,hunterStats:i,bestHunter:E,bestAverageHunter:B}}function x(n,u){return L(r=>_(r,n,u))}function Z(){return L(n=>M(n))}function z(n){return L(u=>b(u))}export{x as a,z as b,j as c,F as g,Z as u};
