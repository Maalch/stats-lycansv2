import{g as K,r as M,a as _,j as a,u as ae}from"./index-BOXU045d.js";import{b as se}from"./baseStatsHook-BmuYPeOk.js";import{g as W,a as te}from"./gameUtils-CCGRmivF.js";import{g as P,a as v}from"./datasyncExport-D6_8Fmuy.js";import{a as E,b as ne,c as B}from"./api-B4lykzOQ.js";import{g as re}from"./deathTypes-CGUOTngO.js";import{c as le}from"./durationFormatters-C9UyWcKX.js";function ie(e,t){if(!e)return null;try{const n=new URL(e);let l="",s=0;if(n.hostname==="youtu.be"){l=n.pathname.slice(1);const d=n.searchParams.get("t");d&&(s=parseInt(d,10)||0)}else if(n.hostname==="www.youtube.com"||n.hostname==="youtube.com"){l=n.searchParams.get("v")||"";const d=n.searchParams.get("t");d&&(s=parseInt(d,10)||0)}return l?`https://www.youtube.com/embed/${l}?start=${s}`:null}catch(n){return console.warn("Failed to create YouTube embed URL:",e,n),null}}function oe(e){if(!e||Object.keys(e).length===0)return null;const t={};return Object.entries(e).forEach(([n,l])=>{if(l&&typeof l=="string"&&l.trim()){const s=ie(l,null);s&&(t[n]=s)}}),Object.keys(t).length>0?t:null}function ce(e,t){if(!e||!t)return null;try{const n=new Date(e),l=new Date(t);if(isNaN(n.getTime())||isNaN(l.getTime()))return console.warn("Invalid date format:",e,t),null;const s=l.getTime()-n.getTime();return s>0?Math.round(s/1e3):null}catch(n){return console.warn("Failed to calculate game duration:",e,t,n),null}}function ue(e,t,n=!1,l=!1){const s=e.toLowerCase(),r=t.PlayerStats.find(u=>u.Username.toLowerCase()===s);return r?P(v(r.MainRoleInitial,r.MainRoleChanges||[]),{regroupLovers:!0,regroupVillagers:!l,regroupWolfSubRoles:!n}):"Villageois"}function de(e,t,n){const l=e.toLowerCase(),s=n.PlayerStats.find(d=>d.Username.toLowerCase()===l);return s?P(v(s.MainRoleInitial,s.MainRoleChanges||[]))===t:!1}function Y(e,t,n){const l=e.filter(s=>s.PlayerStats.some(r=>r.Username.toLowerCase()===t.toLowerCase()));return!n||n==="all-assignments"?l:n==="wins-only"?l.filter(s=>s.PlayerStats.some(r=>r.Username.toLowerCase()===t.toLowerCase()&&r.Victorious)):l}function me(e,t){return e.filter(n=>n.DisplayedId===t)}function he(e,t){return e.filter(n=>t.includes(n.DisplayedId))}function pe(e,t){return e.filter(n=>{const s=new Date(n.StartDate).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});if(t.includes("/")&&t.split("/").length===2){const[r,d]=t.split("/"),u=s.split("/");if(u.length===3){const[,h,p]=u;return h===r&&p===d}}else return s===t;return!1})}function ye(e,t){return e.filter(n=>n.LegacyData?.VictoryType===t)}function fe(e,t){return e.filter(n=>t==="Village"||t==="Ch√¢teau"?n.MapName===t:t==="Autres"?n.MapName!=="Village"&&n.MapName!=="Ch√¢teau":n.MapName===t)}function ge(e,t,n){return e.filter(l=>!l.Modded||l.LegacyData&&l.LegacyData.deathInformationFilled!==!0?!1:l.PlayerStats.some(s=>{if(s.MainRoleInitial==="Inconnu"||n&&!(K(s)===n||s.Username.toLowerCase()===n.toLowerCase()))return!1;const r=P(s.MainRoleInitial),d=r==="Loup"||r==="Tra√Ætre"||r==="Louveteau";return r==="Villageois"&&(s.MainRoleInitial==="Chasseur"||s.MainRoleInitial==="Alchimiste")?s.MainRoleInitial===t:t==="Aucun pouvoir"?(r==="Villageois"||d)&&(!s.Power||s.Power.trim()==="")&&s.Power!=="Inconnu":s.Power===t}))}function Ce(e,t,n){return e.filter(l=>!l.Modded||!l.LegacyData||l.LegacyData.deathInformationFilled!==!0?!1:l.PlayerStats.some(s=>s.MainRoleInitial==="Inconnu"||n&&!(K(s)===n||s.Username.toLowerCase()===n.toLowerCase())?!1:s.SecondaryRole===t))}function xe(e,t){return e.filter(n=>{const l=n.HarvestGoal,s=n.HarvestDone;if(l==null||s===null||s===void 0||l===0)return!1;const r=s/l*100;switch(t){case"0-25%":return r>=0&&r<=25;case"26-50%":return r>25&&r<=50;case"51-75%":return r>50&&r<=75;case"76-99%":return r>75&&r<=99;case"100%":return r>=100;default:return!0}})}function je(e,t){return e.filter(n=>{if(!n.EndTiming)return!1;const l=n.EndTiming.match(/(?:Nuit|Jour)\s+(\d+)/);return l?parseInt(l[1],10)===t:!1})}function ve(e,t,n){const{selectedCamp:l,campFilterMode:s,_smallCamps:r,excludeWolfSubRoles:d}=t;return e.filter(u=>{if(n){if(l==="Autres"&&r)return r.some(o=>de(n,o,u))?s==="wins-only"?u.PlayerStats.find(g=>g.Username.toLowerCase()===n.toLowerCase())?.Victorious===!0:!0:!1;const h=ue(n,u,d);let p=!1;return l==="Loup"&&d?p=h==="Loup"&&!u.PlayerStats.some(i=>i.Username.toLowerCase()===n.toLowerCase()&&(v(i.MainRoleInitial,i.MainRoleChanges||[])==="Tra√Ætre"||v(i.MainRoleInitial,i.MainRoleChanges||[])==="Louveteau")):p=h===l,p?s==="wins-only"?u.PlayerStats.find(o=>o.Username.toLowerCase()===n.toLowerCase())?.Victorious===!0:!0:!1}else if(s==="wins-only"){const h=W(u);return l==="Autres"&&r?r.includes(h):h===l}else return l==="Autres"&&r?r.some(h=>u.PlayerStats.some(p=>P(v(p.MainRoleInitial,p.MainRoleChanges||[]))===h)):u.PlayerStats.some(h=>P(v(h.MainRoleInitial,h.MainRoleChanges||[]))===l)})}function Pe(e,t,n){const{selectedPlayers:l,playersFilterMode:s,winnerPlayer:r}=t;return e.filter(d=>{const u=d.PlayerStats.flatMap(i=>[i.Username.toLowerCase(),(i.ID??i.Username).toLowerCase()]);if(!l.every(i=>u.includes(i.toLowerCase())))return!1;const p=l.map(i=>{const o=i.toLowerCase(),g=d.PlayerStats.find(C=>{const m=(C.ID??C.Username).toLowerCase();return C.Username.toLowerCase()===o||m===o}),y=v(g?.MainRoleInitial||"",g?.MainRoleChanges||[]);return P(y,{regroupWolfSubRoles:n?.excludeWolfSubRoles||!1})});switch(s){case"all-common-games":if(r){const m=r.toLowerCase();return d.PlayerStats.find(x=>{const I=(x.ID??x.Username).toLowerCase();return x.Username.toLowerCase()===m||I===m})?.Victorious===!0}return!0;case"opposing-camps":if(!([...new Set(p)].length>1))return!1;if(r){const m=l.findIndex(N=>N.toLowerCase()===r.toLowerCase());if(m!==-1){const N=p[m],x=W(d);return N==="Agent"&&x==="Agent"?d.PlayerStats.find(L=>L.Username.toLowerCase()===r.toLowerCase())?.Victorious===!0:N===x}}return!0;case"same-camp":if(!([...new Set(p)].length===1))return!1;const C=p[0];if(n&&n.selectedCamp){const m=n.selectedCamp;if(C!==m)return!1}if(r){const m=W(d);return C==="Agent"&&m==="Agent"?l.every(N=>d.PlayerStats.find(I=>I.Username.toLowerCase()===N.toLowerCase())?.Victorious===!0):C===m}return!0;default:return!0}})}function we(e,t){const{selectedPlayerPair:n,selectedPairRole:l}=t;return n.length!==2?e:e.filter(s=>{const r=s.PlayerStats.flatMap(u=>[u.Username.toLowerCase(),(u.ID??u.Username).toLowerCase()]);if(!n.every(u=>r.includes(u.toLowerCase())))return!1;switch(l){case"wolves":return n.every(u=>{const h=u.toLowerCase(),p=s.PlayerStats.find(i=>{const o=(i.ID??i.Username).toLowerCase();return i.Username.toLowerCase()===h||o===h});return P(v(p?.MainRoleInitial||"",p?.MainRoleChanges||[]))==="Loup"});case"lovers":return n.every(u=>{const h=u.toLowerCase(),p=s.PlayerStats.find(i=>{const o=(i.ID??i.Username).toLowerCase();return i.Username.toLowerCase()===h||o===h});return P(v(p?.MainRoleInitial||"",p?.MainRoleChanges||[]))==="Amoureux"});default:return!0}})}function Ne(e,t,n){const l=t&&(t.selectedPlayer||t.selectedGame||t.selectedVictoryType||t.selectedDate||t.selectedHarvestRange||t.selectedGameDuration||t.selectedGameIds&&t.selectedGameIds.length>0||t.selectedMapName||t.selectedPower||t.selectedSecondaryRole||t.campFilter||t.playerPairFilter||t.multiPlayerFilter);if(!l&&n)return Y(e,n,"all-assignments");if(!l)return e;let s=[...e];return t.selectedPlayer&&(s=Y(s,t.selectedPlayer,t.selectedPlayerWinMode)),t.selectedGame&&(s=me(s,t.selectedGame)),t.selectedGameIds&&(s=he(s,t.selectedGameIds)),t.campFilter&&(s=ve(s,t.campFilter,t.selectedPlayer)),t.selectedDate&&(s=pe(s,t.selectedDate)),t.selectedHarvestRange&&(s=xe(s,t.selectedHarvestRange)),t.selectedVictoryType&&(s=ye(s,t.selectedVictoryType)),t.selectedGameDuration&&(s=je(s,t.selectedGameDuration)),t.selectedMapName&&(s=fe(s,t.selectedMapName)),t.selectedPower&&(s=ge(s,t.selectedPower,t.selectedPlayer)),t.selectedSecondaryRole&&(s=Ce(s,t.selectedSecondaryRole,t.selectedPlayer)),t.multiPlayerFilter&&(s=Pe(s,t.multiPlayerFilter,t.campFilter)),t.playerPairFilter&&(s=we(s,t.playerPairFilter)),s}function be(e,t,n){return e.length===0?null:Ne(e,t,n).map(s=>{const r=s.PlayerStats.length,d=s.PlayerStats.filter(f=>P(v(f.MainRoleInitial,f.MainRoleChanges||[]))==="Loup"),u=s.PlayerStats.filter(f=>P(v(f.MainRoleInitial,f.MainRoleChanges||[]))==="Tra√Ætre"),h=s.PlayerStats.filter(f=>P(v(f.MainRoleInitial,f.MainRoleChanges||[]))==="Louveteau"),p=s.PlayerStats.filter(f=>P(v(f.MainRoleInitial,f.MainRoleChanges||[]))==="Amoureux"),i=s.PlayerStats.filter(f=>f.Victorious),o=d.length+u.length+h.length,g=W(s),y=["Loup","Villageois","Tra√Ætre","Louveteau"],C=s.PlayerStats.filter(f=>!y.includes(P(v(f.MainRoleInitial,f.MainRoleChanges||[])))),m=C.length>0?C.map(f=>P(v(f.MainRoleInitial,f.MainRoleChanges||[]))).join(", "):null,x=new Date(s.StartDate).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});let I=0;if(s.EndTiming){const f=s.EndTiming.match(/[UNJMC](\d+)/);f&&(I=parseInt(f[1],10))}let L=null;return s.HarvestGoal&&s.HarvestGoal>0&&(L=s.HarvestDone/s.HarvestGoal),{gameId:s.DisplayedId,date:x,isModded:s.Modded||!1,playerCount:r,wolfCount:o,hasTraitor:u.length>0,traitorsCount:u.length,hasWolfCub:h.length>0,wolfCubsCount:h.length,hasLovers:p.length>0,soloRoles:m,winningCamp:g,dayCount:I,winners:i.map(f=>f.Username).join(", "),harvest:s.HarvestDone,totalHarvest:s.HarvestGoal,harvestPercentage:L,playersList:s.PlayerStats.map(f=>f.Username).join(", "),versions:s.Version||null,map:s.MapName,victoryType:s.LegacyData?.VictoryType||null,playerVODs:oe(s.LegacyData?.PlayerVODs),gameDuration:ce(s.StartDate,s.EndDate),playerData:s.PlayerStats}})}function Re(e,t){const{data:n,isLoading:l,error:s}=se(r=>be(r,e,t));return{data:n||[],isLoading:l,error:s}}const Ie=({playerData:e})=>{const t=E(),n=ne(),l=e.reduce((r,d)=>{const u=P(v(d.MainRoleInitial,d.MainRoleChanges||[]));return r[u]||(r[u]=[]),r[u].push(d),r},{}),s=Object.entries(l).sort(([r,d],[u,h])=>{const p=B.includes(r),i=B.includes(u);return p&&!i?-1:!p&&i?1:h.length-d.length});return a.jsxs("div",{className:"lycans-game-detail-section full-width",children:[a.jsx("h4",{children:"Composition des Camps"}),a.jsx("div",{className:"camps-grid",children:s.map(([r,d])=>{const u=d,h=t[r]||"#666",i=u.filter(o=>o.Victorious).length>0;return a.jsxs("div",{className:`camp-group ${i?"winning-camp":""}`,style:{borderColor:h,backgroundColor:`${h}15`,boxShadow:i?`0 0 10px ${h}40`:"none"},children:[a.jsx("div",{className:"camp-header",style:{backgroundColor:`${h}25`},children:a.jsxs("h5",{style:{color:h},children:[r," (",u.length,")",i&&a.jsx("span",{className:"victory-crown",children:"üëë"})]})}),a.jsx("div",{className:"camp-players",children:u.sort((o,g)=>o.Username.localeCompare(g.Username)).map(o=>{let g=h;o.Color&&n[o.Color]&&(g=n[o.Color]);let y="";return o.DeathTiming&&(y=` (Mort ${te(o.DeathTiming)}`,o.DeathType&&(y+=` - ${re(o.DeathType)}`),o.KillerName&&(y+=` - Tueur ${o.KillerName}`),y+=")"),a.jsxs("div",{className:`player-badge ${o.Victorious?"winner":""} ${o.DeathTiming?"dead":"alive"}`,style:{borderColor:g},title:`${o.Username} - ${P(o.MainRoleInitial)!==P(v(o.MainRoleInitial,o.MainRoleChanges||[]))?`${P(o.MainRoleInitial)} puis ${P(v(o.MainRoleInitial,o.MainRoleChanges||[]))}`:P(o.MainRoleInitial)}${y}`,children:[a.jsx("span",{className:"player-name",children:o.Username}),o.DeathTiming&&a.jsx("span",{className:"death-indicator",children:"üíÄ"}),o.Victorious&&a.jsx("span",{className:"victory-indicator",children:"‚≠ê"})]},o.Username)})})]},r)})})]})};function De(e){if(e===null||e<=0)return"N/A";const t=Math.floor(e/60),n=e%60;return t===0?`${n}s`:n===0?`${t}m`:`${t}m ${n}s`}function Me({game:e}){const[t,n]=M.useState(!1),[l,s]=M.useState(null),r=E(),{settings:d}=_(),u=M.useMemo(()=>{const i=[];return e.playerVODs&&typeof e.playerVODs=="object"&&Object.entries(e.playerVODs).forEach(([o,g])=>{if(typeof g=="string"&&g.trim()){const y=e.playerData?.find(x=>x.ID===o),C=y?.Username||o;let m="#666",N="#666";if(y){const x=P(v(y.MainRoleInitial,y.MainRoleChanges||[])),I=v(y.MainRoleInitial,y.MainRoleChanges||[]);m=r[x]||"#666",N=r[I]||"#666",N==="#666"&&(N=r[x]||"#666")}i.push({label:`${C}`,url:g,playerId:o,borderColor:m,textColor:N})}}),i},[e.playerVODs,e.playerData,r]);M.useEffect(()=>{if(t&&u.length>0&&!l){if(u.length===1)s(u[0].url);else if(d.highlightedPlayer){const i=u.find(o=>o.label.toLowerCase()===d.highlightedPlayer?.toLowerCase());i&&s(i.url)}}},[t,u,l,d.highlightedPlayer]);const h=u.length>0,p=u.length>1;return a.jsx("div",{className:"lycans-game-detail-view",children:a.jsxs("div",{className:"lycans-game-detail-grid",children:[a.jsxs("div",{className:"lycans-game-detail-section",children:[a.jsx("h4",{children:"Informations G√©n√©rales"}),a.jsxs("div",{className:"lycans-game-detail-stats",children:[a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Nombre de joueurs:"}),a.jsx("span",{className:"value",children:e.playerCount})]}),a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Nombre de loups:"}),a.jsx("span",{className:"value",children:e.wolfCount})]}),(e.hasTraitor||e.hasWolfCub)&&a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"R√¥les sp√©ciaux loup:"}),a.jsx("span",{className:"value",children:[e.hasTraitor&&`Tra√Ætre (${e.traitorsCount})`,e.hasWolfCub&&`Louveteau (${e.wolfCubsCount})`].filter(Boolean).join(", ")})]}),e.soloRoles&&a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"R√¥les solo:"}),a.jsx("span",{className:"value",children:e.soloRoles})]})]})]}),a.jsxs("div",{className:"lycans-game-detail-section",children:[a.jsx("h4",{children:"Informations Suppl√©mentaires"}),a.jsxs("div",{className:"lycans-game-detail-stats",children:[e.victoryType!==null&&a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Type de victoire:"}),a.jsx("span",{className:"value",children:e.victoryType})]}),a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Jours de jeu:"}),a.jsx("span",{className:"value",children:e.dayCount})]}),e.gameDuration!==null&&a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Dur√©e de la partie:"}),a.jsx("span",{className:"value",children:De(e.gameDuration)})]}),e.versions&&a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Version:"}),a.jsxs("span",{className:"value",children:[e.versions,e.isModded?" (modd√©e)":""]})]}),e.map&&a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Map:"}),a.jsx("span",{className:"value",children:e.map})]})]})]}),e.harvest!==null&&a.jsxs("div",{className:"lycans-game-detail-section",children:[a.jsx("h4",{children:"R√©colte"}),a.jsxs("div",{className:"lycans-game-detail-stats",children:[a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"R√©colte:"}),a.jsx("span",{className:"value",children:e.harvest})]}),a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Total possible:"}),a.jsx("span",{className:"value",children:e.totalHarvest})]}),a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Pourcentage:"}),a.jsx("span",{className:"value",children:typeof e.harvestPercentage=="number"?(e.harvestPercentage*100).toFixed(1)+"%":"N/A"})]})]})]}),a.jsx(Ie,{playerData:e.playerData}),a.jsxs("div",{className:"lycans-game-detail-section full-width",children:[a.jsx("h4",{children:"R√¥les des Joueurs"}),a.jsx("div",{className:"lycans-player-roles-grid",children:e.playerData.sort((i,o)=>{const g=P(v(i.MainRoleInitial,i.MainRoleChanges||[])),y=P(v(o.MainRoleInitial,o.MainRoleChanges||[])),C=B.indexOf(g),m=B.indexOf(y);return C!==-1&&m!==-1?C-m:C!==-1?-1:m!==-1?1:g!==y?g.localeCompare(y):i.Username.localeCompare(o.Username)}).map(i=>{const o=P(i.MainRoleInitial),g=i.MainRoleInitial,y=P(v(i.MainRoleInitial,i.MainRoleChanges||[])),C=v(i.MainRoleInitial,i.MainRoleChanges||[]),m=i.Power,N=i.SecondaryRole;let x=o;g&&g!==o&&(x+=` - ${g}`),m&&m.trim()&&(x+=` - ${m}`),N&&N.trim()&&(x+=` + ${N}`),C&&C!==g&&(x+=` (devient ${C})`);let I=r[v(i.MainRoleInitial,i.MainRoleChanges||[])]||"#666";I==="#666"&&(I=r[y]||"#666");const L=r[y]||"#666",f=i.DeathTiming,D=i.Victorious;return a.jsxs("div",{className:`lycans-player-role-item ${D?"victorious":""}`,style:{borderColor:L},children:[a.jsxs("div",{className:"lycans-player-name",style:{color:I,textAlign:"left"},children:[i.Username,f&&a.jsx("span",{className:"death-skull",children:"üíÄ"})]}),a.jsx("div",{className:"lycans-player-camp",style:{textAlign:"left"},children:x})]},i.Username)})})]}),h&&a.jsx("div",{className:"lycans-game-detail-section full-width",children:a.jsx("button",{onClick:()=>n(!t),className:"lycans-video-toggle-btn",children:t?"üìπ Masquer la vid√©o":"üé• Voir la vid√©o"})}),h&&t&&a.jsxs("div",{className:"lycans-game-detail-section full-width",children:[a.jsx("h4",{children:"Vid√©o de la Partie"}),p&&a.jsx("nav",{className:"lycans-vod-menu",children:u.map((i,o)=>a.jsx("button",{className:`lycans-vod-btn${l===i.url?" active":""}`,onClick:()=>s(i.url),type:"button",title:i.label,style:{borderColor:i.borderColor,color:l===i.url?"white":i.textColor},children:i.label},o))}),a.jsx("div",{className:"lycans-youtube-container",children:l?a.jsx("iframe",{src:l,title:`Partie Lycans #${e.gameId}`,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"lycans-youtube-iframe"}):a.jsx("div",{className:"lycans-vod-placeholder",children:a.jsx("p",{children:"S√©lectionnez une VOD de joueur pour commencer"})})})]})]})})}function Ue(){const{navigationFilters:e,navigateBack:t}=ae(),{settings:n}=_(),l=!!(e.selectedPlayer||e.selectedGame||e.selectedVictoryType||e.selectedDate||e.selectedHarvestRange||e.selectedGameDuration||e.selectedGameIds&&e.selectedGameIds.length>0||e.selectedMapName||e.selectedPower||e.campFilter||e.playerPairFilter||e.multiPlayerFilter),s=l?null:n.highlightedPlayer,{data:r,isLoading:d,error:u}=Re(e,s),h=E(),[p,i]=M.useState("date"),[o,g]=M.useState("desc"),[y,C]=M.useState(null),[m,N]=M.useState(1),[x,I]=M.useState(25),L=M.useRef(!1),D=e.selectedPlayer?[e.selectedPlayer]:e.playerPairFilter?.selectedPlayerPair?e.playerPairFilter.selectedPlayerPair:e.multiPlayerFilter?.selectedPlayers?e.multiPlayerFilter.selectedPlayers:n.highlightedPlayer?[n.highlightedPlayer]:[],k=D.length>0,Q=()=>D.length===0?"Vainqueur":D.length===1?D[0]+" (victoire)":D.length===2?D.join(" & ")+" (victoires)":`${D.slice(0,2).join(" & ")} (+${D.length-2}) (victoires)`,O=c=>{if(!k)return"";if(!l&&s)return(c.winners?c.winners.split(",").map(q=>q.trim()):[]).filter(q=>D.some(ee=>ee.toLowerCase()===q.toLowerCase())).length>0?"‚úÖ":"‚ùå";const w=c.playersList?c.playersList.split(",").map(R=>R.trim()):[];return D.filter(R=>w.some(G=>G.toLowerCase()===R.toLowerCase())).length===0?"Pas dans la partie":(c.winners?c.winners.split(",").map(R=>R.trim()):[]).filter(R=>D.some(G=>G.toLowerCase()===R.toLowerCase())).length>0?"‚úÖ":"‚ùå"},V=M.useMemo(()=>r?[...r].sort((c,w)=>{let j,b;switch(p){case"date":j=new Date(c.date.split("/").reverse().join("-")).getTime(),b=new Date(w.date.split("/").reverse().join("-")).getTime();break;case"gameId":j=parseInt(c.gameId,10),b=parseInt(w.gameId,10);break;case"playerCount":j=c.playerCount,b=w.playerCount;break;case"gameDuration":j=c.gameDuration||0,b=w.gameDuration||0;break;case"winningCamp":j=c.winningCamp,b=w.winningCamp;break;case"winner":j=O(c),b=O(w);break;default:return 0}let S;if(o==="asc"?S=j>b?1:j<b?-1:0:S=j<b?1:j>b?-1:0,S===0){const R=parseInt(c.gameId,10),G=parseInt(w.gameId,10);return o==="asc"?R-G:G-R}return S}):[],[r,p,o]),F=Math.ceil(V.length/x),A=(m-1)*x,H=A+x,X=V.slice(A,H);M.useEffect(()=>{if(L.current){L.current=!1;return}N(1),C(null)},[r]),M.useEffect(()=>{N(1),C(null)},[p,o]);const T=c=>{L.current=!0,N(c),C(null)},Z=c=>{L.current=!0,I(c),N(1),C(null)},J=c=>{L.current=!0,C(y===c?null:c)},$=c=>{p===c?g(o==="asc"?"desc":"asc"):(i(c),g("desc"))},U=c=>p!==c?"‚ÜïÔ∏è":o==="asc"?"‚ÜóÔ∏è":"‚ÜòÔ∏è",z=()=>{const c=[];if(e.selectedPlayer&&e.campFilter){const w=e.selectedPlayerWinMode==="wins-only"?" (victoires uniquement)":"";let j=e.campFilter.selectedCamp;e.campFilter.selectedCamp==="Loup"&&e.campFilter.excludeWolfSubRoles?j="Loups sans Tra√Ætre/Louveteau":e.campFilter.selectedCamp==="Villageois"&&e.campFilter.excludeVillagers&&(j="Villageois sans Chasseur/Alchimiste"),c.push(`${e.selectedPlayer} jouant ${j}${w}`)}else{if(e.selectedPlayer){const w=e.selectedPlayerWinMode==="wins-only"?" (victoires uniquement)":e.selectedPlayerWinMode==="all-assignments"?" (toutes parties)":"";c.push(`Joueur: ${e.selectedPlayer}${w}`)}if(e.campFilter){const{campFilterMode:w}=e.campFilter;let j=e.campFilter.selectedCamp;e.campFilter.selectedCamp==="Loup"&&e.campFilter.excludeWolfSubRoles?j="Loups sans Tra√Ætre/Louveteau":e.campFilter.selectedCamp==="Villageois"&&e.campFilter.excludeVillagers&&(j="Villageois sans Chasseur/Alchimiste");const b=`Camp: ${j}`,S=w==="wins-only"?" (victoires uniquement)":w==="all-assignments"?" (toutes assignations)":"";c.push(b+S)}}if(e.selectedMapName){const w=e.selectedMapName==="Autres"?"autres cartes":e.selectedMapName;c.push(`Carte: ${w}`)}if(e.selectedPower&&c.push(`Pouvoir: ${e.selectedPower}`),e.selectedSecondaryRole&&c.push(`R√¥le Secondaire: ${e.selectedSecondaryRole}`),e.playerPairFilter){const{selectedPlayerPair:w,selectedPairRole:j}=e.playerPairFilter,b=w.join(" & "),S=j==="wolves"?"loups":"amoureux";c.push(`Paire ${S}: ${b}`)}if(e.multiPlayerFilter){const{selectedPlayers:w,playersFilterMode:j,winnerPlayer:b}=e.multiPlayerFilter,S=w.join(" & ");let R="";j==="all-common-games"?R="toutes les parties communes":j==="opposing-camps"?R="affrontements uniquement":j==="same-camp"&&(R="parties en √©quipe (m√™me camp)");const G=b?` (victoires de ${b})`:"";c.push(`${S} (${R}${G})`)}return e.selectedVictoryType&&c.push(`Victoire: ${e.selectedVictoryType}`),e.selectedHarvestRange&&c.push(`R√©colte: ${e.selectedHarvestRange}`),e.selectedGameDuration&&c.push(`Dur√©e: ${e.selectedGameDuration} jour${e.selectedGameDuration>1?"s":""}`),e.selectedGame&&c.push(`Partie ${e.selectedGame}`),e.selectedDate&&(e.selectedDate.includes("/")&&e.selectedDate.split("/").length===2?c.push(`Mois: ${e.selectedDate}`):c.push(`Date: ${e.selectedDate}`)),e.selectedGameIds&&e.selectedGameIds.length>0&&c.push(`${e.selectedGameIds.length} parties s√©lectionn√©e${e.selectedGameIds.length>1?"s":""}`),c};return d?a.jsx("div",{className:"statistiques-chargement",children:"Chargement des d√©tails des parties..."}):u?a.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",u]}):!r||r.length===0?a.jsxs("div",{className:"lycans-empty-section",children:[a.jsx("h2",{children:"Aucune partie trouv√©e"}),a.jsx("p",{children:"Aucune partie ne correspond aux crit√®res s√©lectionn√©s."}),e.fromComponent&&a.jsxs("button",{onClick:t,className:"lycans-submenu-btn",style:{marginTop:"1rem"},children:["‚Üê Retour √† ",e.fromComponent]})]}):a.jsxs("div",{className:"lycans-game-details",children:[a.jsxs("div",{className:"lycans-game-details-header",children:[a.jsxs("div",{className:"lycans-game-details-navigation",children:[e.fromComponent&&a.jsxs("button",{onClick:t,className:"lycans-submenu-btn",style:{marginRight:"1rem"},children:["‚Üê Retour √† ",e.fromComponent]}),a.jsxs("h2",{children:["D√©tails des Parties (",r.length," partie",r.length>1?"s":"",")"]})]}),z().length>0&&a.jsxs("div",{className:"lycans-active-filters",children:[a.jsx("strong",{children:"Filtres actifs:"})," ",z().join(", ")]})]}),F>1&&a.jsxs("div",{className:"lycans-pagination-container",children:[a.jsxs("div",{className:"lycans-pagination-info",children:["Affichage de ",A+1," √† ",Math.min(H,V.length)," sur ",V.length," parties"]}),a.jsxs("div",{className:"lycans-pagination-controls",children:[a.jsxs("select",{value:x,onChange:c=>Z(Number(c.target.value)),className:"lycans-pagination-select",children:[a.jsx("option",{value:10,children:"10 par page"}),a.jsx("option",{value:25,children:"25 par page"}),a.jsx("option",{value:50,children:"50 par page"}),a.jsx("option",{value:100,children:"100 par page"})]}),a.jsxs("div",{className:"lycans-pagination-buttons",children:[a.jsx("button",{onClick:()=>T(1),disabled:m===1,className:"lycans-pagination-btn",children:"¬´¬´"}),a.jsx("button",{onClick:()=>T(m-1),disabled:m===1,className:"lycans-pagination-btn",children:"‚Äπ"}),a.jsxs("span",{className:"lycans-pagination-current",children:["Page ",m," sur ",F]}),a.jsx("button",{onClick:()=>T(m+1),disabled:m===F,className:"lycans-pagination-btn",children:"‚Ä∫"}),a.jsx("button",{onClick:()=>T(F),disabled:m===F,className:"lycans-pagination-btn",children:"¬ª¬ª"})]})]})]}),a.jsx("div",{className:"lycans-games-table-container",children:a.jsxs("table",{className:"lycans-games-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsxs("th",{onClick:()=>$("gameId"),className:"sortable",children:["Partie ",U("gameId")]}),a.jsxs("th",{onClick:()=>$("date"),className:"sortable",children:["Date ",U("date")]}),a.jsxs("th",{onClick:()=>$("playerCount"),className:"sortable",children:["Joueurs ",U("playerCount")]}),a.jsxs("th",{onClick:()=>$("gameDuration"),className:"sortable",children:["Dur√©e ",U("gameDuration")]}),a.jsxs("th",{onClick:()=>$("winningCamp"),className:"sortable",children:["Camp Vainqueur ",U("winningCamp")]}),k&&a.jsxs("th",{onClick:()=>$("winner"),className:"sortable",children:[Q()," ",U("winner")]}),a.jsx("th",{children:"D√©tails"})]})}),a.jsx("tbody",{children:X.map(c=>a.jsxs(a.Fragment,{children:[a.jsxs("tr",{className:`${y===c.gameId?"selected":""} clickable-row`,onClick:()=>J(c.gameId),style:{cursor:"pointer"},children:[a.jsxs("td",{children:["#",c.gameId]}),a.jsx("td",{children:c.date}),a.jsx("td",{children:c.playerCount}),a.jsx("td",{children:le(c.gameDuration)}),a.jsx("td",{style:{color:h[c.winningCamp]||"#fff"},children:c.winningCamp}),k&&a.jsx("td",{style:{textAlign:"left",fontSize:"1.2rem",verticalAlign:"middle"},children:O(c)}),a.jsx("td",{children:a.jsx("button",{onClick:w=>{w.stopPropagation(),J(c.gameId)},className:"lycans-details-btn",children:y===c.gameId?"Masquer":"Voir"})})]},c.gameId),y===c.gameId&&a.jsx("tr",{className:"game-details-row",children:a.jsx("td",{colSpan:k?8:7,children:a.jsx(Me,{game:c})})},`${c.gameId}-details`)]}))})]})}),F>1&&a.jsxs("div",{className:"lycans-pagination-container",children:[a.jsxs("div",{className:"lycans-pagination-info",children:["Affichage de ",A+1," √† ",Math.min(H,V.length)," sur ",V.length," parties"]}),a.jsx("div",{className:"lycans-pagination-controls",children:a.jsxs("div",{className:"lycans-pagination-buttons",children:[a.jsx("button",{onClick:()=>T(1),disabled:m===1,className:"lycans-pagination-btn",children:"¬´¬´"}),a.jsx("button",{onClick:()=>T(m-1),disabled:m===1,className:"lycans-pagination-btn",children:"‚Äπ"}),a.jsxs("span",{className:"lycans-pagination-current",children:["Page ",m," sur ",F]}),a.jsx("button",{onClick:()=>T(m+1),disabled:m===F,className:"lycans-pagination-btn",children:"‚Ä∫"}),a.jsx("button",{onClick:()=>T(F),disabled:m===F,className:"lycans-pagination-btn",children:"¬ª¬ª"})]})})]})]})}export{Ue as GameDetailsChart};
