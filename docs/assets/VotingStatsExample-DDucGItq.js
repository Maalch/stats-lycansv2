import{j as t}from"./index-DOV8jD4L.js";import{a as b}from"./baseStatsHook-ClJOw9Ev.js";function C(d){if(d.length===0)return null;let a=0,o=0,e=0;d.forEach(r=>{let c=!1;r.PlayerStats.forEach(l=>{l.Votes&&l.Votes.length>0&&(c=!0,l.Votes.forEach(m=>{m.Target==="Passé"?o++:a++}))}),c&&e++});const i=a+o;return{totalVotes:a,totalAbstentions:o,participationRate:i>0?a/i*100:0,averageVotesPerGame:e>0?a/e:0,averageAbstentionsPerGame:e>0?o/e:0,totalGamesWithVotes:e}}function E(d){if(d.length===0)return[];const a={};return d.forEach(o=>{o.PlayerStats.forEach(e=>{const i=e.Username.trim();if(!i||!e.Votes)return;a[i]||(a[i]={player:i,role:e.MainRoleInitial,totalVotesCast:0,totalAbstentions:0,participationRate:0,averageVotesPerGame:0,votesPerMeeting:[],targetsVoted:{},mostTargetedPlayer:null,targetsVotedCount:0,gamesParticipated:0,survivedToMeeting:[],earlyVoter:!1,roleBasedBehavior:{asVillageois:{},asLoup:{},asOther:{}}});const r=a[i];r.gamesParticipated++;const c=e.Votes.length;r.survivedToMeeting.push(c),e.Votes.forEach(h=>{h.Target==="Passé"?r.totalAbstentions++:(r.totalVotesCast++,r.targetsVoted[h.Target]||(r.targetsVoted[h.Target]=0),r.targetsVoted[h.Target]++)});const l=e.MainRoleInitial==="Villageois"?"asVillageois":e.MainRoleInitial==="Loup"?"asLoup":"asOther";r.roleBasedBehavior[l].totalVotesCast||(r.roleBasedBehavior[l]={totalVotesCast:0,totalAbstentions:0,targetsVoted:{},gamesParticipated:0});const m=r.roleBasedBehavior[l];m.gamesParticipated!==void 0&&m.gamesParticipated++})}),Object.values(a).forEach(o=>{const e=o.totalVotesCast+o.totalAbstentions;o.participationRate=e>0?o.totalVotesCast/e*100:0,o.averageVotesPerGame=o.gamesParticipated>0?o.totalVotesCast/o.gamesParticipated:0;let i=0,r=null;Object.entries(o.targetsVoted).forEach(([c,l])=>{l>i&&(i=l,r=c)}),o.mostTargetedPlayer=r,o.targetsVotedCount=Object.keys(o.targetsVoted).length}),Object.values(a).sort((o,e)=>e.totalVotesCast-o.totalVotesCast)}function w(d){if(d.length===0)return[];const a={},o=new Set;return d.forEach(e=>{e.PlayerStats.forEach(i=>{o.add(i.Username.trim())})}),o.forEach(e=>{e&&(a[e]={player:e,timesTargeted:0,targetedByPlayers:{},targetedByRoles:{},targetingPressure:0,survivalAfterBeingTargeted:0,mostFrequentAttacker:null,gamesTargeted:0})}),d.forEach(e=>{const i=new Set;e.PlayerStats.forEach(r=>{r.Votes&&r.Votes.forEach(c=>{if(c.Target!=="Passé"&&a[c.Target]){const l=a[c.Target];l.timesTargeted++,i.add(c.Target),l.targetedByPlayers[r.Username]||(l.targetedByPlayers[r.Username]=0),l.targetedByPlayers[r.Username]++,l.targetedByRoles[r.MainRoleInitial]||(l.targetedByRoles[r.MainRoleInitial]=0),l.targetedByRoles[r.MainRoleInitial]++}})}),i.forEach(r=>{a[r].gamesTargeted++})}),Object.values(a).forEach(e=>{e.targetingPressure=e.gamesTargeted>0?e.timesTargeted/e.gamesTargeted:0;let i=0,r=null;Object.entries(e.targetedByPlayers).forEach(([c,l])=>{l>i&&(i=l,r=c)}),e.mostFrequentAttacker=r}),Object.values(a).filter(e=>e.timesTargeted>0).sort((e,i)=>i.timesTargeted-e.timesTargeted)}function M(d){return d.map(a=>{const o=[],e=Math.max(...a.PlayerStats.map(s=>s.Votes?s.Votes.length:0));for(let s=0;s<e;s++){const x=[],f=new Set;a.PlayerStats.forEach(g=>{g.Votes&&g.Votes[s]&&(f.add(g.Username),x.push({voter:g.Username,target:g.Votes[s].Target,role:g.MainRoleInitial}))});const u=x.filter(g=>g.target!=="Passé").length,j=x.filter(g=>g.target==="Passé").length,y={};x.forEach(g=>{g.target!=="Passé"&&(y[g.target]=(y[g.target]||0)+1)});const v=Object.entries(y).sort(([,g],[,B])=>B-g)[0]?.[0]||null,T=u,A=Math.max(...Object.values(y),0),R=T>0?A/T:0;o.push({meetingNumber:s+1,totalParticipants:f.size,totalVotesCast:u,totalAbstentions:j,participationRate:f.size>0?u/f.size*100:0,playersWhoVoted:x.filter(g=>g.target!=="Passé").map(g=>g.voter),playersWhoAbstained:x.filter(g=>g.target==="Passé").map(g=>g.voter),voteTargets:y,mostTargetedPlayer:v,consensusLevel:R})}const i=a.PlayerStats.flatMap(s=>s.Votes||[]),r=i.filter(s=>s.Target!=="Passé").length,c=i.length,m=a.PlayerStats.map(s=>({player:s.Username,votes:s.Votes?s.Votes.filter(x=>x.Target!=="Passé").length:0})).sort((s,x)=>x.votes-s.votes)[0]?.player||null,h={};i.forEach(s=>{s.Target!=="Passé"&&(h[s.Target]=(h[s.Target]||0)+1)});const P=Object.entries(h).sort(([,s],[,x])=>x-s)[0]?.[0]||null,V=a.PlayerStats.filter(s=>s.Victorious),n=V.length>0?V[0].MainRoleInitial:"Unknown",p={};return a.PlayerStats.forEach(s=>{const x=s.MainRoleInitial;if(p[x]||(p[x]={totalVotes:0,totalAbstentions:0,participationRate:0}),s.Votes){const f=s.Votes.filter(j=>j.Target!=="Passé").length,u=s.Votes.filter(j=>j.Target==="Passé").length;p[x].totalVotes+=f,p[x].totalAbstentions+=u}}),Object.values(p).forEach(s=>{const x=s.totalVotes+s.totalAbstentions;s.participationRate=x>0?s.totalVotes/x*100:0}),{gameId:a.Id,gameDate:a.StartDate,totalMeetings:e,meetingAnalysis:o,overallParticipation:c>0?r/c*100:0,mostActiveVoter:m,mostTargetedPlayer:P,winningCamp:n,votingPatternsByRole:p}})}function S(){return b(d=>C(d))}function G(){return b(d=>E(d))}function k(){return b(d=>w(d))}function F(){return b(d=>M(d))}function L(){const{data:d,isLoading:a,error:o}=S(),{data:e,isLoading:i,error:r}=G(),{data:c,isLoading:l,error:m}=k(),{data:h,isLoading:P,error:V}=F();return a||i||l||P?t.jsx("div",{children:"Loading voting statistics..."}):o||r||m||V?t.jsx("div",{children:"Error loading voting statistics"}):t.jsxs("div",{style:{padding:"20px",maxWidth:"1200px",margin:"0 auto"},children:[t.jsx("h1",{children:"Voting Statistics Dashboard"}),d&&t.jsxs("section",{style:{marginBottom:"30px",padding:"15px",border:"1px solid #ddd",borderRadius:"8px"},children:[t.jsx("h2",{children:"Overall Voting Statistics"}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"15px"},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Total Votes:"})," ",d.totalVotes]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Total Abstentions:"})," ",d.totalAbstentions]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Participation Rate:"})," ",d.participationRate.toFixed(1),"%"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Avg Votes/Game:"})," ",d.averageVotesPerGame.toFixed(1)]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Games with Votes:"})," ",d.totalGamesWithVotes]})]})]}),e&&e.length>0&&t.jsxs("section",{style:{marginBottom:"30px",padding:"15px",border:"1px solid #ddd",borderRadius:"8px"},children:[t.jsx("h2",{children:"Most Active Voters (Top 10)"}),t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:"#f5f5f5"},children:[t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Player"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Role"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Total Votes"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Abstentions"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Participation %"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Avg Votes/Game"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Most Targeted"})]})}),t.jsx("tbody",{children:e.slice(0,10).map((n,p)=>t.jsxs("tr",{style:{backgroundColor:p%2===0?"#f9f9f9":"white"},children:[t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:n.player}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:n.role}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:n.totalVotesCast}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:n.totalAbstentions}),t.jsxs("td",{style:{padding:"8px",border:"1px solid #ddd"},children:[n.participationRate.toFixed(1),"%"]}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:n.averageVotesPerGame.toFixed(1)}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:n.mostTargetedPlayer||"N/A"})]},n.player))})]})})]}),c&&c.length>0&&t.jsxs("section",{style:{marginBottom:"30px",padding:"15px",border:"1px solid #ddd",borderRadius:"8px"},children:[t.jsx("h2",{children:"Most Targeted Players (Top 10)"}),t.jsx("div",{style:{overflowX:"auto"},children:t.jsxs("table",{style:{width:"100%",borderCollapse:"collapse"},children:[t.jsx("thead",{children:t.jsxs("tr",{style:{backgroundColor:"#f5f5f5"},children:[t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Player"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Times Targeted"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Games Targeted"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Targeting Pressure"}),t.jsx("th",{style:{padding:"8px",border:"1px solid #ddd"},children:"Most Frequent Attacker"})]})}),t.jsx("tbody",{children:c.slice(0,10).map((n,p)=>t.jsxs("tr",{style:{backgroundColor:p%2===0?"#f9f9f9":"white"},children:[t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:n.player}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:n.timesTargeted}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:n.gamesTargeted}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:n.targetingPressure.toFixed(1)}),t.jsx("td",{style:{padding:"8px",border:"1px solid #ddd"},children:n.mostFrequentAttacker||"N/A"})]},n.player))})]})})]}),h&&h.length>0&&t.jsxs("section",{style:{marginBottom:"30px",padding:"15px",border:"1px solid #ddd",borderRadius:"8px"},children:[t.jsx("h2",{children:"Recent Game Voting Analysis (Last 3 Games)"}),h.slice(-3).map(n=>t.jsxs("div",{style:{marginBottom:"20px",padding:"10px",backgroundColor:"#f9f9f9",borderRadius:"5px"},children:[t.jsxs("h3",{children:["Game ",n.gameId]}),t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"10px",marginBottom:"15px"},children:[t.jsxs("div",{children:[t.jsx("strong",{children:"Total Meetings:"})," ",n.totalMeetings]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Overall Participation:"})," ",n.overallParticipation.toFixed(1),"%"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Most Active Voter:"})," ",n.mostActiveVoter||"N/A"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Most Targeted:"})," ",n.mostTargetedPlayer||"N/A"]}),t.jsxs("div",{children:[t.jsx("strong",{children:"Winning Camp:"})," ",n.winningCamp]})]}),t.jsx("h4",{children:"Meeting Breakdown:"}),t.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"8px"},children:n.meetingAnalysis.map(p=>t.jsxs("div",{style:{padding:"5px",backgroundColor:"white",borderRadius:"3px",fontSize:"0.9em"},children:[t.jsxs("strong",{children:["Meeting ",p.meetingNumber]}),t.jsx("br",{}),"Participants: ",p.totalParticipants,t.jsx("br",{}),"Votes: ",p.totalVotesCast,t.jsx("br",{}),"Participation: ",p.participationRate.toFixed(0),"%",t.jsx("br",{}),p.mostTargetedPlayer&&t.jsxs("span",{children:["Target: ",p.mostTargetedPlayer]})]},p.meetingNumber))})]},n.gameId))]}),t.jsxs("section",{style:{marginBottom:"30px",padding:"15px",border:"1px solid #ddd",borderRadius:"8px",backgroundColor:"#f0f8ff"},children:[t.jsx("h2",{children:"How to Use These Hooks"}),t.jsx("p",{children:"The voting statistics system provides several hooks for different analysis needs:"}),t.jsxs("ul",{children:[t.jsxs("li",{children:[t.jsx("strong",{children:"useVotingStatsFromRaw()"})," - Overall voting statistics across all games"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"usePlayerVotingBehaviorFromRaw()"})," - Individual player voting behavior and patterns"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"useVoteTargetingAnalysisFromRaw()"})," - Analysis of who gets voted for most often"]}),t.jsxs("li",{children:[t.jsx("strong",{children:"useGameVotingAnalysisFromRaw()"})," - Detailed game-by-game voting breakdown"]})]}),t.jsx("p",{children:"All hooks follow the base hook pattern and automatically respect filter settings from SettingsContext."})]})]})}export{L as default};
