import{r as C,j as e}from"./index-BCxlLBj3.js";import{q as O,t as _,R as T,p as P,T as D,B as K,C as z,X,Y,o as J}from"./useRawGameData-Du09rk6G.js";import{l as q,a as k}from"./api-DftpR04q.js";import{P as V,a as B}from"./PieChart-Dmjc5QGa.js";import{L as H}from"./Legend-R6oyYbJv.js";function Q(){const{data:d,isLoading:E,error:N}=O(),{data:x,isLoading:y,error:w}=_();return{campWinStats:C.useMemo(()=>{if(!d||d.length===0||!x||x.length===0)return null;const a=s=>s?s.split(",").map(i=>i.trim()).filter(Boolean):[],t=(s,i,c)=>s[i]&&s[i][c]||"Villageois",r=(s,i)=>i&&i.trim()!==""?a(i).some(g=>g.toLowerCase()===s.toLowerCase()):!1,m=(s,i)=>s===i||s==="Traître"&&i==="Loups",n={};x.forEach(s=>{const i=s.Game;if(!i)return;n[i]||(n[i]={});const c=(h,u)=>{h&&h.trim()&&(n[i][h.trim()]=u)},g=s.Loups;g&&a(g).forEach(h=>{n[i][h]="Loups"}),c(s.Traître,"Traître"),c(s["Idiot du village"],"Idiot du Village"),c(s.Cannibale,"Cannibale"),c(s.Espion,"Espion"),c(s["La Bête"],"La Bête"),c(s["Chasseur de primes"],"Chasseur de primes"),c(s.Vaudou,"Vaudou");const R=s.Agent;R&&a(R).forEach(h=>{n[i][h]="Agent"});const b=s.Scientifique;b&&a(b).forEach(h=>{n[i][h]="Scientifique"});const j=s.Amoureux;j&&a(j).forEach(h=>{n[i][h]="Amoureux"})});const o={},p={},l={};let L=0;d.forEach(s=>{const i=s.Game,c=s["Rôles solo"],g=s["Camp victorieux"],R=s["Liste des joueurs"],b=s["Liste des gagnants"];if(c&&c.toString().trim()!==""&&a(c.toString()).forEach(h=>{const u=h.trim();u!==""&&(o[u]||(o[u]=0),o[u]++)}),g&&g.trim()!==""&&(L++,p[g]||(p[g]=0),p[g]++),i&&R&&g&&b){const j=a(R),h=new Set;j.forEach(u=>{const f=u.trim();if(f){const v=t(n,i,f);h.add(v)}}),h.forEach(u=>{l[u]||(l[u]={totalGames:0,wins:0,winRate:0,players:{}}),l[u].totalGames++}),h.forEach(u=>{m(u,g)&&l[u].wins++}),j.forEach(u=>{const f=u.trim();if(f){const v=t(n,i,u);l[v].players[f]||(l[v].players[f]={games:0,wins:0,winRate:0}),l[v].players[f].games++,r(f,b)&&l[v].players[f].wins++}})}}),Object.keys(l).forEach(s=>{l[s].totalGames>0&&(l[s].winRate=parseFloat((l[s].wins/l[s].totalGames*100).toFixed(2))),Object.keys(l[s].players).forEach(i=>{const c=l[s].players[i];c.games>0&&(c.winRate=parseFloat((c.wins/c.games*100).toFixed(2)))})});const S=[];Object.keys(p).forEach(s=>{S.push({camp:s,wins:p[s],winRate:(p[s]/L*100).toFixed(2)})}),S.sort((s,i)=>i.wins-s.wins);const I=Object.keys(l).map(s=>({camp:s,totalGames:l[s].totalGames,winRate:l[s].winRate.toFixed(2)})),$=new Set;Object.keys(l).forEach(s=>{Object.keys(l[s].players).forEach(i=>{$.add(i)})});const M=$.size,F=[];return Object.keys(o).forEach(s=>{F.push({soloRole:s,appearances:o[s]})}),F.sort((s,i)=>i.appearances-s.appearances),{totalGames:L,campStats:S,soloCamps:F,campAverages:I,totalPlayersAnalyzed:M}},[d,x]),isLoading:E||y,errorInfo:N||w}}const U="#607D8B";function ne(){const{campWinStats:d,isLoading:E,errorInfo:N}=Q(),x=C.useMemo(()=>d?.campAverages?d.campAverages.map(a=>({...a,winRateNum:parseFloat(a.winRate)})).sort((a,t)=>t.winRateNum-a.winRateNum):[],[d]),y=C.useMemo(()=>d?.campStats?.map(a=>({...a,winRateNum:typeof a.winRate=="string"?parseFloat(a.winRate):a.winRate}))||[],[d]),w=C.useMemo(()=>{if(!y.length)return[];const a=5;let t=0;const r=[],m=[];return y.forEach(n=>{n.winRateNum<a?(t+=n.winRateNum,r.push(n)):m.push(n)}),t>0&&m.push({camp:"Autres",wins:r.reduce((n,o)=>n+o.wins,0),winRate:t.toFixed(1),winRateNum:t,_details:r}),m},[y]),A=C.useMemo(()=>{if(!x.length)return[];const a=5,t=x.reduce((o,p)=>o+p.totalGames,0);let r=0;const m=[],n=[];if(x.forEach(o=>{const p=o.totalGames/t*100;p<a?(r+=o.totalGames,m.push({...o,winRate:p.toFixed(1)})):n.push(o)}),r>0){const o=m.length>0?(m.reduce((p,l)=>p+l.winRateNum,0)/m.length).toFixed(1):"0.0";n.push({camp:"Autres",totalGames:r,winRate:o,winRateNum:parseFloat(o),_details:m})}return n},[x]),W=E,G=N;return W?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques des camps..."}):G?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",G]}):d?e.jsxs("div",{className:"lycans-camps-container",children:[e.jsx("h2",{children:"Statistiques des Camps"}),d&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camps Analysés"}),e.jsx("div",{className:"lycans-valeur-principale",children:d.campAverages?.length||0}),e.jsx("p",{children:"camps différents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Joueurs Évalués"}),e.jsx("div",{className:"lycans-valeur-principale",children:d.totalPlayersAnalyzed||0}),e.jsx("p",{children:"joueurs analysés"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:d?.totalGames||0}),e.jsx("p",{children:"parties analysées"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[d&&w.length>0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Répartition des Victoires par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Distribution des victoires sur ",d.totalGames," parties"]}),e.jsx("div",{style:{height:450},children:e.jsx(T,{width:"100%",height:"100%",children:e.jsxs(V,{children:[e.jsx(B,{data:w,cx:"50%",cy:"50%",labelLine:!1,outerRadius:140,fill:"#8884d8",dataKey:"winRateNum",nameKey:"camp",label:({camp:a,winRate:t})=>a==="Autres"?`Autres: ${t}%`:`${a}: ${t}%`,children:w.map((a,t)=>e.jsx(P,{fill:a.camp==="Autres"?q:k[a.camp]||U},`cellule-camp-${t}`))}),e.jsx(D,{content:({active:a,payload:t})=>{if(a&&t&&t.length>0){const r=t[0].payload;if(r.camp==="Autres"&&r._details){const m=[...r._details].sort((n,o)=>o.winRateNum-n.winRateNum);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:"Autres"})}),e.jsx("div",{children:m.map((n,o)=>e.jsxs("div",{children:[n.camp,": ",n.wins," victoires (",n.winRate,"%)"]},o))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold"},children:["Total: ",r.wins," victoires (",r.winRate,"%)"]})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:r.camp}),e.jsxs("div",{children:["Victoires: ",r.wins]}),e.jsxs("div",{children:["Taux de victoire: ",r.winRate,"%"]})]})}return null}}),e.jsx(H,{})]})})})]})}),d?.campAverages&&x.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire Moyen par Camp"}),e.jsx("div",{style:{height:400},children:e.jsx(T,{width:"100%",height:"100%",children:e.jsxs(K,{data:x,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(z,{strokeDasharray:"3 3"}),e.jsx(X,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(Y,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(D,{content:({active:a,payload:t})=>{if(a&&t&&t.length>0){const r=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.camp})}),e.jsxs("div",{children:["Parties totales: ",r.totalGames]}),e.jsxs("div",{children:["Taux de victoire: ",r.winRate,"%"]})]})}return null}}),e.jsx(J,{dataKey:"winRateNum",children:x.map((a,t)=>e.jsx(P,{fill:k[a.camp]||`var(--chart-color-${t%6+1})`},`cell-${t}`))})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Parties par Camp"}),e.jsx("div",{style:{height:400},children:e.jsx(T,{width:"100%",height:"100%",children:e.jsxs(V,{children:[e.jsx(B,{data:A,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"totalGames",label:({camp:a,totalGames:t,percent:r})=>{const m=r!==void 0?r:0;return a==="Autres"?`Autres: ${t} (${(m*100).toFixed(1)}%)`:`${a}: ${t} (${(m*100).toFixed(1)}%)`},children:A.map((a,t)=>e.jsx(P,{fill:a.camp==="Autres"?q:k[a.camp]||`var(--chart-color-${t%6+1})`},`cell-${t}`))}),e.jsx(D,{content:({active:a,payload:t})=>{if(a&&t&&t.length>0){const r=t[0].payload;if(r.camp==="Autres"&&r._details){const m=[...r._details].sort((n,o)=>o.totalGames-n.totalGames);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:"Autres"})}),e.jsx("div",{children:m.map((n,o)=>e.jsxs("div",{children:[n.camp,": ",n.totalGames," parties"]},o))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold"},children:["Total: ",r.totalGames," parties"]})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.camp})}),e.jsxs("div",{children:["Parties: ",r.totalGames]}),e.jsxs("div",{children:["Taux victoire: ",r.winRate,"%"]})]})}return null}})]})})})]})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de camp disponible"})}export{ne as CampsChart};
