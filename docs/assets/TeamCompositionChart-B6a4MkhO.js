import{r as C,j as e}from"./index-CRVotvbE.js";import{a as N}from"./baseStatsHook-B0G-DkG5.js";import{a as W,g as b}from"./datasyncExport-BirWLS1z.js";import{g as F}from"./gameUtils-rkfcKAVy.js";import{F as S,C as R,X as A,Y as B,a as $}from"./FullscreenChart-CvK6X1_C.js";import{R as w,T as L}from"./CategoricalChart-I4QsiQeR.js";import{B as z,a as g}from"./BarChart-DqFoxfsr.js";import{L as V}from"./Legend-8O679eCR.js";function k(s){const l=s.PlayerStats.length;let x=0,p=0,u=0;const h=s.PlayerStats.filter(i=>{const m=W(i.MainRoleInitial,i.MainRoleChanges||[]),r=b(m,{regroupWolfSubRoles:!1}),t=r==="Loup"||r==="TraÃ®tre"||r==="Louveteau";return t&&(r==="Loup"?x++:r==="TraÃ®tre"?p++:r==="Louveteau"&&u++),t}),a=s.PlayerStats.filter(i=>{const m=W(i.MainRoleInitial,i.MainRoleChanges||[]),r=b(m);return r!=="Villageois"&&r!=="Loup"});return{playerCount:l,wolfCount:h.length,pureWolfCount:x,traitreCount:p,louveteuCount:u,soloCount:a.length,villageoisCount:l-h.length-a.length}}function T(s){if(s.length===0)return null;const l={};s.forEach(u=>{const h=k(u),{playerCount:a,wolfCount:i,pureWolfCount:m,traitreCount:r,louveteuCount:t,soloCount:n,villageoisCount:o}=h;l[a]||(l[a]={});const d=`${m}L-${r}T-${t}Lou`,y=`${i}w-${n}s-${d}`;l[a][y]||(l[a][y]={wolfCount:i,pureWolfCount:m,traitreCount:r,louveteuCount:t,soloCount:n,villageoisCount:o,appearances:0,winsByWolves:0,winsByVillageois:0,winsBySolo:0,wolfWinRate:0,villageoisWinRate:0,soloWinRate:0,configKey:y,wolfBreakdownKey:d}),l[a][y].appearances++;const f=F(u);f==="Loup"?l[a][y].winsByWolves++:f==="Villageois"?l[a][y].winsByVillageois++:l[a][y].winsBySolo++});const x=[];let p=0;return Object.keys(l).map(Number).sort((u,h)=>u-h).forEach(u=>{const h=l[u],a=[];Object.values(h).forEach(o=>{const d=o.appearances>0?o.winsByWolves/o.appearances*100:0,y=o.appearances>0?o.winsByVillageois/o.appearances*100:0,f=o.appearances>0?o.winsBySolo/o.appearances*100:0;a.push({...o,wolfWinRate:d,villageoisWinRate:y,soloWinRate:f}),o.appearances>=5&&p++}),a.sort((o,d)=>d.appearances-o.appearances);const i=a.filter(o=>o.appearances>=5),m=i.length>0?i[0]:void 0,r=i.length>0?i.reduce((o,d)=>d.wolfWinRate>o.wolfWinRate?d:o):void 0,t=i.length>0?i.reduce((o,d)=>d.villageoisWinRate>o.villageoisWinRate?d:o):void 0,n=a.reduce((o,d)=>o+d.appearances,0);x.push({playerCount:u,totalGames:n,configurations:a,mostCommon:m,bestWolfWinRate:r,bestVillageoisWinRate:t})}),{compositionsByPlayerCount:x,totalGamesAnalyzed:s.length,configurationsWithMinAppearances:p}}function P(){const{data:s,isLoading:l,error:x}=N(T);return{teamCompositionStats:s,isLoading:l,error:x}}const c={wolf:"#dc2626",villageois:"#16a34a",solo:"#f59e0b",bar:"var(--chart-color-1)",barInactive:"var(--text-secondary)"};function j(s){const l=[];return s.pureWolfCount>0&&l.push(`${s.pureWolfCount}L`),s.traitreCount>0&&l.push(`${s.traitreCount}T`),s.louveteuCount>0&&l.push(`${s.louveteuCount}Lou`),l.length>0?l.join("+"):"0L"}function v(s){const l=[];return s.pureWolfCount>0&&l.push(`${s.pureWolfCount} Loup${s.pureWolfCount>1?"s":""}`),s.traitreCount>0&&l.push(`${s.traitreCount} TraÃ®tre${s.traitreCount>1?"s":""}`),s.louveteuCount>0&&l.push(`${s.louveteuCount} Louveteau${s.louveteuCount>1?"x":""}`),s.soloCount>0&&l.push(`${s.soloCount} Solo`),s.villageoisCount>0&&l.push(`${s.villageoisCount} Villageois`),l.join(", ")||"N/A"}function J(){const{teamCompositionStats:s,isLoading:l,error:x}=P(),[p,u]=C.useState(null),[h,a]=C.useState("overview");if(l)return e.jsx("div",{className:"donnees-attente",children:"Chargement des compositions d'Ã©quipe..."});if(x)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",x]});if(!s||s.compositionsByPlayerCount.length===0)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de composition disponible"});const i=s.compositionsByPlayerCount.map(t=>{const n=t.mostCommon;return{playerCount:t.playerCount,totalGames:t.totalGames,mostCommonConfig:n?`${j(n)}/${n.soloCount}S`:"N/A",mostCommonWolfBreakdown:n?j(n):"N/A",mostCommonAppearances:n?n.appearances:0,mostCommonWolfWinRate:n?n.wolfWinRate:0,mostCommonVillageoisWinRate:n?n.villageoisWinRate:0,mostCommonSoloWinRate:n?n.soloWinRate:0,hasEnoughData:n&&n.appearances>=5,mostCommonFullConfig:n}}),m=p!==null?s.compositionsByPlayerCount.find(t=>t.playerCount===p):null,r=m?m.configurations.filter(t=>t.appearances>=5):[];return e.jsxs("div",{className:"lycans-camps-container",children:[e.jsx("h2",{children:"Statistiques des Compositions d'Ã‰quipe"}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:s.totalGamesAnalyzed}),e.jsx("p",{children:"parties analysÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Configurations FrÃ©quentes"}),e.jsx("div",{className:"lycans-valeur-principale",children:s.configurationsWithMinAppearances}),e.jsx("p",{children:"â‰¥5 parties"})]})]}),e.jsxs("div",{className:"lycans-submenu",children:[e.jsx("button",{type:"button",className:`lycans-submenu-btn ${h==="overview"?"active":""}`,onClick:()=>{a("overview"),u(null)},children:"ðŸ“Š Vue d'ensemble"}),e.jsx("button",{type:"button",className:`lycans-submenu-btn ${h==="detailed"?"active":""}`,onClick:()=>a("detailed"),children:"ðŸ” Vue dÃ©taillÃ©e"})]}),e.jsx("div",{className:"lycans-graphiques-groupe",children:h==="overview"?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(S,{title:"Compositions les Plus FrÃ©quentes par Nombre de Joueurs",children:[e.jsx("p",{className:"lycans-stats-info",children:"Configuration la plus jouÃ©e pour chaque nombre de joueurs (minimum 5 parties). Cliquez sur une barre pour voir les dÃ©tails."}),e.jsx("div",{style:{height:400},children:e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(z,{data:i,margin:{top:20,right:30,left:20,bottom:25},children:[e.jsx(R,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(A,{dataKey:"playerCount",tick:{fill:"var(--text-secondary)"},label:{value:"Nombre de joueurs",position:"insideBottom",offset:-5,fill:"var(--text-secondary)"}}),e.jsx(B,{tick:{fill:"var(--text-secondary)"},label:{value:"Nombre de parties",angle:-90,position:"insideLeft",fill:"var(--text-secondary)"}}),e.jsx(L,{content:({active:t,payload:n})=>{if(t&&n&&n.length>0){const o=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:8},children:[o.playerCount," joueurs"]}),e.jsxs("p",{style:{fontSize:"0.875rem",color:"var(--text-secondary)"},children:["Total: ",o.totalGames," parties"]}),o.hasEnoughData?e.jsxs(e.Fragment,{children:[e.jsxs("p",{style:{fontSize:"0.875rem",fontWeight:500,marginTop:8},children:["Config la + frÃ©quente: ",o.mostCommonConfig]}),o.mostCommonFullConfig&&e.jsxs("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(",v(o.mostCommonFullConfig),")"]}),e.jsxs("p",{style:{fontSize:"0.875rem"},children:["Parties: ",o.mostCommonAppearances]}),e.jsxs("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:2},children:[e.jsxs("p",{style:{color:c.wolf,fontSize:"0.875rem"},children:["ðŸº Loups: ",o.mostCommonWolfWinRate.toFixed(1),"%"]}),e.jsxs("p",{style:{color:c.villageois,fontSize:"0.875rem"},children:["ðŸ˜ï¸ Villageois: ",o.mostCommonVillageoisWinRate.toFixed(1),"%"]}),e.jsxs("p",{style:{color:c.solo,fontSize:"0.875rem"},children:["ðŸŽ­ Solo: ",o.mostCommonSoloWinRate.toFixed(1),"%"]})]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.75rem",fontWeight:"bold",textAlign:"center"},children:"ðŸ–±ï¸ Cliquez pour les dÃ©tails"})]}):e.jsx("p",{style:{fontSize:"0.875rem",fontStyle:"italic",marginTop:8,color:"var(--text-secondary)"},children:"Pas assez de donnÃ©es (minimum 5 parties requises)"})]})}return null}}),e.jsx(g,{dataKey:"mostCommonAppearances",name:"Parties",radius:[4,4,0,0],children:i.map((t,n)=>e.jsx($,{cursor:t.hasEnoughData?"pointer":"default",fill:t.hasEnoughData?c.bar:c.barInactive,opacity:t.hasEnoughData?1:.3,onClick:()=>{t.hasEnoughData&&(u(t.playerCount),a("detailed"))}},`cell-${n}`))})]})})})]}),e.jsx("div",{className:"lycans-stats-table",style:{marginTop:"1.5rem"},children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"center"},children:"Joueurs"}),e.jsx("th",{style:{textAlign:"center"},children:"Total Parties"}),e.jsx("th",{style:{textAlign:"center"},children:"Configuration FrÃ©quente"}),e.jsx("th",{style:{textAlign:"center"},children:"Parties"}),e.jsx("th",{style:{textAlign:"center"},children:"ðŸº Loups"}),e.jsx("th",{style:{textAlign:"center"},children:"ðŸ˜ï¸ Villageois"}),e.jsx("th",{style:{textAlign:"center"},children:"ðŸŽ­ Solo"})]})}),e.jsx("tbody",{children:i.map(t=>e.jsxs("tr",{className:"lycans-clickable",onClick:()=>{u(t.playerCount),a("detailed")},children:[e.jsx("td",{style:{textAlign:"center",fontWeight:600},children:t.playerCount}),e.jsx("td",{style:{textAlign:"center"},children:t.totalGames}),e.jsx("td",{style:{textAlign:"center",fontSize:"0.85rem"},children:t.hasEnoughData&&t.mostCommonFullConfig?v(t.mostCommonFullConfig):e.jsx("span",{style:{color:"var(--text-secondary)",fontStyle:"italic"},children:"DonnÃ©es insuffisantes"})}),e.jsx("td",{style:{textAlign:"center"},children:t.hasEnoughData?t.mostCommonAppearances:"-"}),e.jsx("td",{style:{textAlign:"center",fontWeight:500,color:t.hasEnoughData?c.wolf:"var(--text-secondary)"},children:t.hasEnoughData?`${t.mostCommonWolfWinRate.toFixed(1)}%`:"-"}),e.jsx("td",{style:{textAlign:"center",fontWeight:500,color:t.hasEnoughData?c.villageois:"var(--text-secondary)"},children:t.hasEnoughData?`${t.mostCommonVillageoisWinRate.toFixed(1)}%`:"-"}),e.jsx("td",{style:{textAlign:"center",fontWeight:500,color:t.hasEnoughData?c.solo:"var(--text-secondary)"},children:t.hasEnoughData?`${t.mostCommonSoloWinRate.toFixed(1)}%`:"-"})]},t.playerCount))})]})})]}):e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{marginBottom:"1rem"},children:[e.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-primary)",fontWeight:500,fontSize:"0.9rem"},children:"SÃ©lectionner le nombre de joueurs:"}),e.jsxs("select",{value:p||"",onChange:t=>u(t.target.value?Number(t.target.value):null),style:{background:"var(--bg-primary)",color:"var(--text-primary)",border:"2px solid var(--border-color)",borderRadius:"8px",padding:"10px 12px",fontSize:"0.9rem",width:"100%",cursor:"pointer"},children:[e.jsx("option",{value:"",children:"-- Choisir --"}),s.compositionsByPlayerCount.map(t=>e.jsxs("option",{value:t.playerCount,children:[t.playerCount," joueurs (",t.totalGames," parties)"]},t.playerCount))]})]}),p!==null&&m&&e.jsxs(S,{title:`Configurations pour ${p} joueurs (${m.totalGames} parties)`,children:[e.jsx("p",{className:"lycans-stats-info",children:"Toutes les configurations jouÃ©es au moins 5 fois. Format: L=Loup pur, T=TraÃ®tre, Lou=Louveteau / S=RÃ´les Solo / V=Villageois"}),r.length===0?e.jsxs("div",{className:"donnees-manquantes",children:["Aucune configuration jouÃ©e au moins 5 fois pour ",p," joueurs"]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{height:400},children:e.jsx(w,{width:"100%",height:"100%",children:e.jsxs(z,{data:r.map(t=>({name:`${j(t)}/${t.soloCount}S`,config:t,Loups:t.wolfWinRate,Villageois:t.villageoisWinRate,Solo:t.soloWinRate})),margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(R,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(A,{dataKey:"name",tick:{fill:"var(--text-secondary)"}}),e.jsx(B,{tick:{fill:"var(--text-secondary)"},label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft",fill:"var(--text-secondary)"}}),e.jsx(L,{content:({active:t,payload:n})=>{if(t&&n&&n.length>0){const o=n[0].payload.config;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsxs("p",{style:{fontWeight:"bold",marginBottom:4},children:[j(o)," / ",o.soloCount,"S / ",o.villageoisCount,"V"]}),e.jsx("p",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",fontStyle:"italic",marginBottom:8},children:v(o)}),e.jsxs("p",{style:{fontSize:"0.875rem"},children:["Parties jouÃ©es: ",o.appearances]}),e.jsxs("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:4},children:[e.jsxs("p",{style:{fontSize:"0.875rem",color:c.wolf},children:["ðŸº Loups: ",o.winsByWolves," victoires (",o.wolfWinRate.toFixed(1),"%)"]}),e.jsxs("p",{style:{fontSize:"0.875rem",color:c.villageois},children:["ðŸ˜ï¸ Villageois: ",o.winsByVillageois," victoires (",o.villageoisWinRate.toFixed(1),"%)"]}),e.jsxs("p",{style:{fontSize:"0.875rem",color:c.solo},children:["ðŸŽ­ Solo: ",o.winsBySolo," victoires (",o.soloWinRate.toFixed(1),"%)"]})]})]})}return null}}),e.jsx(V,{wrapperStyle:{color:"var(--text-primary)"}}),e.jsx(g,{dataKey:"Loups",fill:c.wolf,radius:[4,4,0,0]}),e.jsx(g,{dataKey:"Villageois",fill:c.villageois,radius:[4,4,0,0]}),e.jsx(g,{dataKey:"Solo",fill:c.solo,radius:[4,4,0,0]})]})})}),e.jsx("div",{className:"lycans-stats-table",style:{marginTop:"1.5rem"},children:e.jsxs("table",{children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{textAlign:"center"},children:"Configuration"}),e.jsx("th",{style:{textAlign:"center"},children:"Parties"}),e.jsx("th",{style:{textAlign:"center"},children:"ðŸº V. Loups"}),e.jsx("th",{style:{textAlign:"center"},children:"ðŸ˜ï¸ V. Villageois"}),e.jsx("th",{style:{textAlign:"center"},children:"ðŸŽ­ V. Solo"})]})}),e.jsx("tbody",{children:r.map(t=>e.jsxs("tr",{children:[e.jsx("td",{style:{textAlign:"center",fontSize:"0.85rem"},children:v(t)}),e.jsx("td",{style:{textAlign:"center"},children:t.appearances}),e.jsxs("td",{style:{textAlign:"center"},children:[e.jsxs("span",{style:{color:c.wolf,fontWeight:700,fontSize:"1rem"},children:[t.wolfWinRate.toFixed(1),"%"]}),e.jsxs("span",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginLeft:"0.25rem",display:"block"},children:["(",t.winsByWolves," victoires)"]})]}),e.jsxs("td",{style:{textAlign:"center"},children:[e.jsxs("span",{style:{color:c.villageois,fontWeight:700,fontSize:"1rem"},children:[t.villageoisWinRate.toFixed(1),"%"]}),e.jsxs("span",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginLeft:"0.25rem",display:"block"},children:["(",t.winsByVillageois," victoires)"]})]}),e.jsxs("td",{style:{textAlign:"center"},children:[e.jsxs("span",{style:{color:c.solo,fontWeight:700,fontSize:"1rem"},children:[t.soloWinRate.toFixed(1),"%"]}),e.jsxs("span",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginLeft:"0.25rem",display:"block"},children:["(",t.winsBySolo," victoires)"]})]})]},t.configKey))})]})})]})]})]})})]})}export{J as TeamCompositionChart};
