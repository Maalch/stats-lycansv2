import{a as P,r as c,j as e,g as L,t as G,D as I}from"./index-CzlnCdE0.js";function $(){const{generateUrlWithSettings:t}=P(),[i,h]=c.useState(!1),g=async()=>{const F=t();try{await navigator.clipboard.writeText(F),h(!0),setTimeout(()=>h(!1),2e3)}catch{const d=document.createElement("textarea");d.value=F,document.body.appendChild(d),d.select(),document.execCommand("copy"),document.body.removeChild(d),h(!0),setTimeout(()=>h(!1),2e3)}};return e.jsx("div",{className:"shareable-url-container",children:e.jsx("button",{onClick:g,className:"shareable-url-btn",type:"button",title:"Copier le lien avec les filtres actuels",children:i?"âœ… CopiÃ©!":"ğŸ”— Copier le lien"})})}function q(){const{settings:t,updateSettings:i,resetSettings:h}=P(),[g,F]=c.useState(null);c.useEffect(()=>{t.independentFilters||i({useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}})},[t,i]),c.useEffect(()=>{(async()=>{try{const s=t.dataSource,l=G(s,I.GAME_LOG),r=await(await fetch(l)).json();F(r.GameStats||[])}catch{}})()},[t.dataSource]);const N=n=>{if(!n)return null;try{return new Date(n)}catch{return null}},d=c.useMemo(()=>!g||!t.independentFilters?[]:g.filter(n=>{const s=t.independentFilters;if(s.gameTypeEnabled&&s.gameFilter!=="all"&&(s.gameFilter==="modded"&&!n.Modded||s.gameFilter==="non-modded"&&n.Modded))return!1;if(s.dateRangeEnabled&&(s.dateRange.start||s.dateRange.end)){const l=N(n.StartDate);if(!l)return!1;if(s.dateRange.start){const a=new Date(s.dateRange.start);if(l<a)return!1}if(s.dateRange.end){const a=new Date(s.dateRange.end);if(l>a)return!1}}if(s.mapNameEnabled&&s.mapNameFilter!=="all"){const l=n.MapName||"";if(s.mapNameFilter==="village"&&l!=="Village"||s.mapNameFilter==="chateau"&&l!=="ChÃ¢teau"||s.mapNameFilter==="others"&&(l==="Village"||l==="ChÃ¢teau"))return!1}if(s.playerFilter.mode!=="none"&&s.playerFilter.players.length>0){const l=n.PlayerStats.map(r=>r.Username.toLowerCase()),a=n.PlayerStats.map(r=>L(r).toLowerCase());if(s.playerFilter.mode==="include"){if(!s.playerFilter.players.every(m=>{const o=String(m).toLowerCase();return a.includes(o)||l.includes(o)}))return!1}else if(s.playerFilter.mode==="exclude"&&s.playerFilter.players.some(m=>{const o=String(m).toLowerCase();return a.includes(o)||l.includes(o)}))return!1}return!0}),[g,t.independentFilters]),b=c.useMemo(()=>{const n=new Set;return d.forEach(s=>{s.PlayerStats.forEach(l=>{n.add(l.Username)})}),Array.from(n).sort()},[d]),v=c.useMemo(()=>{const n={};return d.forEach(s=>{const l=s.PlayerStats.map(a=>a.Username);l.forEach(a=>{n[a]||(n[a]=new Set),l.forEach(r=>{a!==r&&n[a].add(r)})})}),n},[d]),{availablePlayers:C,selectablePlayers:x}=c.useMemo(()=>{const n=b;if(!t.independentFilters?.playerFilter||t.independentFilters.playerFilter.mode==="none"||t.independentFilters.playerFilter.players.length===0)return{availablePlayers:n,selectablePlayers:new Set(n)};const s=new Set,l=t.independentFilters.playerFilter;return l.mode==="include"?n.forEach(a=>{(l.players.includes(a)||l.players.every(m=>v[a]?.has(m)||!1))&&s.add(a)}):l.mode==="exclude"&&n.forEach(a=>{(l.players.includes(a)||d.some(m=>{const o=m.PlayerStats.flatMap(u=>[u.Username.toLowerCase(),(u.ID??u.Username).toLowerCase()]);return o.includes(a.toLowerCase())?!l.players.some(u=>o.includes(u.toLowerCase())):!1}))&&s.add(a)}),{availablePlayers:n,selectablePlayers:s}},[b,t.independentFilters?.playerFilter,v,d]),S=n=>{t.independentFilters&&i({independentFilters:{...t.independentFilters,gameTypeEnabled:n}})},f=n=>{t.independentFilters&&i({independentFilters:{...t.independentFilters,gameFilter:n}})},R=n=>{t.independentFilters&&i({independentFilters:{...t.independentFilters,dateRangeEnabled:n}})},E=(n,s)=>{t.independentFilters&&i({independentFilters:{...t.independentFilters,dateRange:{...t.independentFilters.dateRange,[n]:s||null}}})},k=n=>{t.independentFilters&&i({independentFilters:{...t.independentFilters,mapNameEnabled:n}})},y=n=>{t.independentFilters&&i({independentFilters:{...t.independentFilters,mapNameFilter:n}})},j=n=>{t.independentFilters&&i({independentFilters:{...t.independentFilters,playerFilter:{...t.independentFilters.playerFilter,mode:n}}})},T=n=>{if(!t.independentFilters)return;const s=t.independentFilters.playerFilter.players;if(s.includes(n)){const a=s.filter(r=>r!==n);i({independentFilters:{...t.independentFilters,playerFilter:{...t.independentFilters.playerFilter,players:a}}})}else i({independentFilters:{...t.independentFilters,playerFilter:{...t.independentFilters.playerFilter,players:[...s,n]}}})},w=()=>{t.independentFilters&&i({independentFilters:{...t.independentFilters,playerFilter:{...t.independentFilters.playerFilter,players:[...x]}}})},D=()=>{t.independentFilters&&i({independentFilters:{...t.independentFilters,playerFilter:{...t.independentFilters.playerFilter,players:[]}}})},A=n=>{i({highlightedPlayer:n||null})},M=()=>{h()},p=c.useMemo(()=>{if(!t.independentFilters)return 0;let n=0;return t.independentFilters.gameTypeEnabled&&t.independentFilters.gameFilter!=="all"&&n++,t.independentFilters.dateRangeEnabled&&(t.independentFilters.dateRange.start||t.independentFilters.dateRange.end)&&n++,t.independentFilters.mapNameEnabled&&t.independentFilters.mapNameFilter!=="all"&&n++,t.independentFilters.playerFilter.mode!=="none"&&t.independentFilters.playerFilter.players.length>0&&n++,n},[t.independentFilters]);return t.independentFilters?e.jsxs("div",{className:"settings-panel",children:[e.jsxs("div",{className:"settings-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"ParamÃ¨tres de Filtrage"}),p>0&&e.jsxs("p",{style:{margin:"0.5rem 0 0 0",color:"var(--accent-primary)",fontSize:"0.9rem",fontWeight:"500"},children:[p," filtre",p>1?"s":""," actif",p>1?"s":""]})]}),e.jsx("div",{children:e.jsx("button",{onClick:M,className:"settings-reset-btn",type:"button",children:"RÃ©initialiser"})})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("div",{className:"settings-section-header",children:e.jsx("h3",{children:"ğŸ¯ Joueur Ã  Mettre en Ã‰vidence"})}),e.jsxs("div",{className:"settings-group",children:[e.jsx("p",{className:"settings-explanation",children:"SÃ©lectionnez un joueur qui sera toujours affichÃ© et mis en Ã©vidence dans tous les graphiques gÃ©nÃ©raux, mÃªme s'il n'est pas dans le top classement."}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("label",{htmlFor:"highlighted-player-select",className:"settings-label",children:"Joueur Ã  mettre en Ã©vidence :"}),e.jsxs("select",{id:"highlighted-player-select",value:t.highlightedPlayer||"",onChange:n=>A(n.target.value),className:"settings-select",children:[e.jsx("option",{value:"",children:"Aucun joueur sÃ©lectionnÃ©"}),C.map(n=>e.jsx("option",{value:n,children:n},n))]}),t.highlightedPlayer&&e.jsxs("p",{className:"settings-info-text",children:['Le joueur "',t.highlightedPlayer,'" sera mis en Ã©vidence dans tous les graphiques.']})]})]})]}),e.jsxs("div",{className:"settings-filters-container",children:[e.jsxs("div",{className:`settings-filter-card ${t.independentFilters.gameTypeEnabled?"active":""}`,children:[e.jsxs("div",{className:"settings-filter-header",children:[e.jsxs("label",{className:"settings-toggle",children:[e.jsx("input",{type:"checkbox",checked:t.independentFilters.gameTypeEnabled,onChange:n=>S(n.target.checked)}),e.jsx("span",{className:"toggle-slider"})]}),e.jsx("h4",{children:"ğŸ® Filtrer par Type de Partie"}),e.jsx("div",{className:"settings-filter-status",children:t.independentFilters.gameTypeEnabled&&t.independentFilters.gameFilter!=="all"&&e.jsx("span",{className:"filter-active-badge",children:t.independentFilters.gameFilter==="modded"?"ModdÃ©es":"Non-moddÃ©es"})})]}),t.independentFilters.gameTypeEnabled&&e.jsx("div",{className:"settings-filter-content",children:e.jsxs("div",{className:"settings-radio-group-inline",children:[e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"all",checked:t.independentFilters.gameFilter==="all",onChange:()=>f("all")}),e.jsx("span",{children:"Toutes"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"modded",checked:t.independentFilters.gameFilter==="modded",onChange:()=>f("modded")}),e.jsx("span",{children:"ModdÃ©es"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"non-modded",checked:t.independentFilters.gameFilter==="non-modded",onChange:()=>f("non-modded")}),e.jsx("span",{children:"Non-moddÃ©es"})]})]})})]}),e.jsxs("div",{className:`settings-filter-card ${t.independentFilters.dateRangeEnabled?"active":""}`,children:[e.jsxs("div",{className:"settings-filter-header",children:[e.jsxs("label",{className:"settings-toggle",children:[e.jsx("input",{type:"checkbox",checked:t.independentFilters.dateRangeEnabled,onChange:n=>R(n.target.checked)}),e.jsx("span",{className:"toggle-slider"})]}),e.jsx("h4",{children:"ğŸ“… Filtrer par PÃ©riode"}),e.jsx("div",{className:"settings-filter-status",children:t.independentFilters.dateRangeEnabled&&(t.independentFilters.dateRange.start||t.independentFilters.dateRange.end)&&e.jsxs("span",{className:"filter-active-badge",children:[t.independentFilters.dateRange.start||"DÃ©but"," - ",t.independentFilters.dateRange.end||"Fin"]})})]}),t.independentFilters.dateRangeEnabled&&e.jsxs("div",{className:"settings-filter-content",children:[e.jsxs("div",{className:"settings-date-inputs",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-start",className:"settings-label",children:"Du :"}),e.jsx("input",{id:"date-start",type:"date",value:t.independentFilters.dateRange.start||"",onChange:n=>E("start",n.target.value),className:"settings-input"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-end",className:"settings-label",children:"Au :"}),e.jsx("input",{id:"date-end",type:"date",value:t.independentFilters.dateRange.end||"",onChange:n=>E("end",n.target.value),className:"settings-input"})]})]}),e.jsx("small",{className:"settings-hint",children:"Laissez vide pour ne pas limiter le dÃ©but ou la fin de la pÃ©riode."})]})]}),e.jsxs("div",{className:`settings-filter-card ${t.independentFilters.mapNameEnabled?"active":""}`,children:[e.jsxs("div",{className:"settings-filter-header",children:[e.jsxs("label",{className:"settings-toggle",children:[e.jsx("input",{type:"checkbox",checked:t.independentFilters.mapNameEnabled,onChange:n=>k(n.target.checked)}),e.jsx("span",{className:"toggle-slider"})]}),e.jsx("h4",{children:"ğŸ—ºï¸ Filtrer par Carte"}),e.jsx("div",{className:"settings-filter-status",children:t.independentFilters.mapNameEnabled&&t.independentFilters.mapNameFilter!=="all"&&e.jsx("span",{className:"filter-active-badge",children:t.independentFilters.mapNameFilter==="village"?"Village":t.independentFilters.mapNameFilter==="chateau"?"ChÃ¢teau":"Autres"})})]}),t.independentFilters.mapNameEnabled&&e.jsx("div",{className:"settings-filter-content",children:e.jsxs("div",{className:"settings-radio-group-inline",children:[e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"mapNameFilter",value:"all",checked:t.independentFilters.mapNameFilter==="all",onChange:()=>y("all")}),e.jsx("span",{children:"Toutes"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"mapNameFilter",value:"village",checked:t.independentFilters.mapNameFilter==="village",onChange:()=>y("village")}),e.jsx("span",{children:"Village"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"mapNameFilter",value:"chateau",checked:t.independentFilters.mapNameFilter==="chateau",onChange:()=>y("chateau")}),e.jsx("span",{children:"ChÃ¢teau"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"mapNameFilter",value:"others",checked:t.independentFilters.mapNameFilter==="others",onChange:()=>y("others")}),e.jsx("span",{children:"Autres"})]})]})})]}),e.jsxs("div",{className:`settings-filter-card ${t.independentFilters.playerFilter.mode!=="none"?"active":""}`,children:[e.jsxs("div",{className:"settings-filter-header",children:[e.jsxs("label",{className:"settings-toggle",children:[e.jsx("input",{type:"checkbox",checked:t.independentFilters.playerFilter.mode!=="none",onChange:n=>j(n.target.checked?"include":"none")}),e.jsx("span",{className:"toggle-slider"})]}),e.jsx("h4",{children:"ğŸ‘¥ Filtrer par Joueurs"}),e.jsx("div",{className:"settings-filter-status",children:t.independentFilters.playerFilter.mode!=="none"&&t.independentFilters.playerFilter.players.length>0&&e.jsxs("span",{className:"filter-active-badge",children:[t.independentFilters.playerFilter.players.length," joueur",t.independentFilters.playerFilter.players.length>1?"s":""]})})]}),t.independentFilters.playerFilter.mode!=="none"&&e.jsxs("div",{className:"settings-filter-content",children:[e.jsxs("div",{className:"settings-radio-group-inline",style:{marginBottom:"1rem"},children:[e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"playerFilterMode",value:"include",checked:t.independentFilters.playerFilter.mode==="include",onChange:()=>j("include")}),e.jsx("span",{children:"Inclure"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"playerFilterMode",value:"exclude",checked:t.independentFilters.playerFilter.mode==="exclude",onChange:()=>j("exclude")}),e.jsx("span",{children:"Exclure"})]})]}),e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{className:"settings-label",children:["Joueurs (",t.independentFilters.playerFilter.players.length," sÃ©lectionnÃ©",t.independentFilters.playerFilter.players.length>1?"s":"",") :"]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:w,className:"settings-btn-small",disabled:x.size===0,children:"Tous"}),e.jsx("button",{type:"button",onClick:D,className:"settings-btn-small",disabled:t.independentFilters.playerFilter.players.length===0,children:"Aucun"})]})]})}),e.jsx("div",{className:"settings-player-grid",children:C.map(n=>{const s=t.independentFilters.playerFilter.players.includes(n),l=x.has(n);return e.jsxs("label",{className:`settings-player-option ${s?"selected":""} ${l?"":"disabled"}`,children:[e.jsx("input",{type:"checkbox",checked:s,disabled:!l,onChange:()=>T(n)}),e.jsx("span",{children:n})]},n)})}),e.jsxs("small",{className:"settings-hint",children:["SÃ©lectionnez les joueurs Ã  ",t.independentFilters.playerFilter.mode==="include"?"inclure dans":"exclure du"," le filtrage."]})]})]})]}),e.jsx("div",{className:"settings-info",children:e.jsxs("p",{children:[e.jsx("strong",{children:"RÃ©sumÃ©:"})," ",d.length," partie",d.length>1?"s":"",p>0?` (avec ${p} filtre${p>1?"s":""} actif${p>1?"s":""})`:" (aucun filtre actif)",t.highlightedPlayer&&` â€¢ "${t.highlightedPlayer}" mis en Ã©vidence`,t.dataSource==="discord"&&" â€¢ ğŸ“Š Ã‰quipe Discord"]})}),e.jsxs("div",{className:"settings-section",children:[e.jsx("div",{className:"settings-section-header",children:e.jsx("h3",{children:"ğŸ”— Partage des Filtres"})}),e.jsxs("div",{className:"settings-group",children:[e.jsx("p",{className:"settings-explanation",children:"Copiez le lien ci-dessous pour partager les filtres actuels avec d'autres personnes. Ils pourront ouvrir le site avec ces mÃªmes filtres appliquÃ©s."}),e.jsx($,{})]})]})]}):e.jsx("div",{children:"Chargement des paramÃ¨tres..."})}export{q as SettingsPanel};
