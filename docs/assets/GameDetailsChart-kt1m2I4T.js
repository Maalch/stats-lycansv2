import{r as I,a as _,j as a,u as ee}from"./index-BAJJOb2N.js";import{b as ae}from"./baseStatsHook-kOHjZUEW.js";import{g as O,a as se}from"./gameUtils-CCGRmivF.js";import{g as N,a as j}from"./datasyncExport-D6_8Fmuy.js";import{a as E,b as te,c as W}from"./api-DoI83REE.js";import{c as ne}from"./durationFormatters-Br-IfF5C.js";function le(e,s){if(!e)return null;try{const n=new URL(e);let i="",t=0;if(n.hostname==="youtu.be"){i=n.pathname.slice(1);const m=n.searchParams.get("t");m&&(t=parseInt(m,10)||0)}else if(n.hostname==="www.youtube.com"||n.hostname==="youtube.com"){i=n.searchParams.get("v")||"";const m=n.searchParams.get("t");m&&(t=parseInt(m,10)||0)}return i?`https://www.youtube.com/embed/${i}?start=${t}`:null}catch(n){return console.warn("Failed to create YouTube embed URL:",e,n),null}}function re(e){if(!e||Object.keys(e).length===0)return null;const s={};return Object.entries(e).forEach(([n,i])=>{if(i&&typeof i=="string"&&i.trim()){const t=le(i,null);t&&(s[n]=t)}}),Object.keys(s).length>0?s:null}function ie(e,s){if(!e||!s)return null;try{const n=new Date(e),i=new Date(s);if(isNaN(n.getTime())||isNaN(i.getTime()))return console.warn("Invalid date format:",e,s),null;const t=i.getTime()-n.getTime();return t>0?Math.round(t/1e3):null}catch(n){return console.warn("Failed to calculate game duration:",e,s,n),null}}function oe(e,s,n=!1,i=!1){const t=e.toLowerCase(),l=s.PlayerStats.find(d=>d.Username.toLowerCase()===t);return l?N(j(l.MainRoleInitial,l.MainRoleChanges||[]),{regroupLovers:!0,regroupVillagers:!i,regroupWolfSubRoles:!n}):"Villageois"}function ce(e,s,n){const i=e.toLowerCase(),t=n.PlayerStats.find(m=>m.Username.toLowerCase()===i);return t?N(j(t.MainRoleInitial,t.MainRoleChanges||[]))===s:!1}function Y(e,s,n){const i=e.filter(t=>t.PlayerStats.some(l=>l.Username.toLowerCase()===s.toLowerCase()));return!n||n==="all-assignments"?i:n==="wins-only"?i.filter(t=>t.PlayerStats.some(l=>l.Username.toLowerCase()===s.toLowerCase()&&l.Victorious)):i}function de(e,s){return e.filter(n=>n.DisplayedId===s)}function ue(e,s){return e.filter(n=>s.includes(n.DisplayedId))}function me(e,s){return e.filter(n=>{const t=new Date(n.StartDate).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});if(s.includes("/")&&s.split("/").length===2){const[l,m]=s.split("/"),d=t.split("/");if(d.length===3){const[,h,p]=d;return h===l&&p===m}}else return t===s;return!1})}function he(e,s){return e.filter(n=>n.LegacyData?.VictoryType===s)}function pe(e,s){return e.filter(n=>s==="Village"||s==="Ch√¢teau"?n.MapName===s:s==="Autres"?n.MapName!=="Village"&&n.MapName!=="Ch√¢teau":n.MapName===s)}function ye(e,s){return e.filter(n=>{const i=n.HarvestGoal,t=n.HarvestDone;if(i==null||t===null||t===void 0||i===0)return!1;const l=t/i*100;switch(s){case"0-25%":return l>=0&&l<=25;case"26-50%":return l>25&&l<=50;case"51-75%":return l>50&&l<=75;case"76-99%":return l>75&&l<=99;case"100%":return l>=100;default:return!0}})}function fe(e,s){return e.filter(n=>{if(!n.EndTiming)return!1;const i=n.EndTiming.match(/(?:Nuit|Jour)\s+(\d+)/);return i?parseInt(i[1],10)===s:!1})}function ge(e,s,n){const{selectedCamp:i,campFilterMode:t,_smallCamps:l,excludeWolfSubRoles:m}=s;return e.filter(d=>{if(n){if(i==="Autres"&&l)return l.some(o=>ce(n,o,d))?t==="wins-only"?d.PlayerStats.find(f=>f.Username.toLowerCase()===n.toLowerCase())?.Victorious===!0:!0:!1;const h=oe(n,d,m);let p=!1;return i==="Loup"&&m?p=h==="Loup"&&!d.PlayerStats.some(r=>r.Username.toLowerCase()===n.toLowerCase()&&(j(r.MainRoleInitial,r.MainRoleChanges||[])==="Tra√Ætre"||j(r.MainRoleInitial,r.MainRoleChanges||[])==="Louveteau")):p=h===i,p?t==="wins-only"?d.PlayerStats.find(o=>o.Username.toLowerCase()===n.toLowerCase())?.Victorious===!0:!0:!1}else if(t==="wins-only"){const h=O(d);return i==="Autres"&&l?l.includes(h):h===i}else return i==="Autres"&&l?l.some(h=>d.PlayerStats.some(p=>N(j(p.MainRoleInitial,p.MainRoleChanges||[]))===h)):d.PlayerStats.some(h=>N(j(h.MainRoleInitial,h.MainRoleChanges||[]))===i)})}function Ce(e,s,n){const{selectedPlayers:i,playersFilterMode:t,winnerPlayer:l}=s;return e.filter(m=>{const d=m.PlayerStats.flatMap(r=>[r.Username.toLowerCase(),(r.ID??r.Username).toLowerCase()]);if(!i.every(r=>d.includes(r.toLowerCase())))return!1;const p=i.map(r=>{const o=r.toLowerCase(),f=m.PlayerStats.find(g=>{const u=(g.ID??g.Username).toLowerCase();return g.Username.toLowerCase()===o||u===o}),P=j(f?.MainRoleInitial||"",f?.MainRoleChanges||[]);return N(P,{regroupWolfSubRoles:n?.excludeWolfSubRoles||!1})});switch(t){case"all-common-games":if(l){const u=l.toLowerCase();return m.PlayerStats.find(C=>{const R=(C.ID??C.Username).toLowerCase();return C.Username.toLowerCase()===u||R===u})?.Victorious===!0}return!0;case"opposing-camps":if(!([...new Set(p)].length>1))return!1;if(l){const u=i.findIndex(w=>w.toLowerCase()===l.toLowerCase());if(u!==-1){const w=p[u],C=O(m);return w==="Agent"&&C==="Agent"?m.PlayerStats.find(L=>L.Username.toLowerCase()===l.toLowerCase())?.Victorious===!0:w===C}}return!0;case"same-camp":if(!([...new Set(p)].length===1))return!1;const g=p[0];if(n&&n.selectedCamp){const u=n.selectedCamp;if(g!==u)return!1}if(l){const u=O(m);return g==="Agent"&&u==="Agent"?i.every(w=>m.PlayerStats.find(R=>R.Username.toLowerCase()===w.toLowerCase())?.Victorious===!0):g===u}return!0;default:return!0}})}function xe(e,s){const{selectedPlayerPair:n,selectedPairRole:i}=s;return n.length!==2?e:e.filter(t=>{const l=t.PlayerStats.flatMap(d=>[d.Username.toLowerCase(),(d.ID??d.Username).toLowerCase()]);if(!n.every(d=>l.includes(d.toLowerCase())))return!1;switch(i){case"wolves":return n.every(d=>{const h=d.toLowerCase(),p=t.PlayerStats.find(r=>{const o=(r.ID??r.Username).toLowerCase();return r.Username.toLowerCase()===h||o===h});return N(j(p?.MainRoleInitial||"",p?.MainRoleChanges||[]))==="Loup"});case"lovers":return n.every(d=>{const h=d.toLowerCase(),p=t.PlayerStats.find(r=>{const o=(r.ID??r.Username).toLowerCase();return r.Username.toLowerCase()===h||o===h});return N(j(p?.MainRoleInitial||"",p?.MainRoleChanges||[]))==="Amoureux"});default:return!0}})}function je(e,s,n){const i=s&&(s.selectedPlayer||s.selectedGame||s.selectedVictoryType||s.selectedDate||s.selectedHarvestRange||s.selectedGameDuration||s.selectedGameIds&&s.selectedGameIds.length>0||s.selectedMapName||s.campFilter||s.playerPairFilter||s.multiPlayerFilter);if(!i&&n)return Y(e,n,"all-assignments");if(!i)return e;let t=[...e];return s.selectedPlayer&&(t=Y(t,s.selectedPlayer,s.selectedPlayerWinMode)),s.selectedGame&&(t=de(t,s.selectedGame)),s.selectedGameIds&&(t=ue(t,s.selectedGameIds)),s.campFilter&&(t=ge(t,s.campFilter,s.selectedPlayer)),s.selectedDate&&(t=me(t,s.selectedDate)),s.selectedHarvestRange&&(t=ye(t,s.selectedHarvestRange)),s.selectedVictoryType&&(t=he(t,s.selectedVictoryType)),s.selectedGameDuration&&(t=fe(t,s.selectedGameDuration)),s.selectedMapName&&(t=pe(t,s.selectedMapName)),s.multiPlayerFilter&&(t=Ce(t,s.multiPlayerFilter,s.campFilter)),s.playerPairFilter&&(t=xe(t,s.playerPairFilter)),t}function ve(e,s,n){return e.length===0?null:je(e,s,n).map(t=>{const l=t.PlayerStats.length,m=t.PlayerStats.filter(y=>N(j(y.MainRoleInitial,y.MainRoleChanges||[]))==="Loup"),d=t.PlayerStats.filter(y=>N(j(y.MainRoleInitial,y.MainRoleChanges||[]))==="Tra√Ætre"),h=t.PlayerStats.filter(y=>N(j(y.MainRoleInitial,y.MainRoleChanges||[]))==="Louveteau"),p=t.PlayerStats.filter(y=>N(j(y.MainRoleInitial,y.MainRoleChanges||[]))==="Amoureux"),r=t.PlayerStats.filter(y=>y.Victorious),o=m.length+d.length+h.length,f=O(t),P=["Loup","Villageois","Amoureux"],g=t.PlayerStats.filter(y=>!P.includes(N(j(y.MainRoleInitial,y.MainRoleChanges||[])))),u=g.length>0?g.map(y=>N(j(y.MainRoleInitial,y.MainRoleChanges||[]))).join(", "):null,C=new Date(t.StartDate).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});let R=0;if(t.EndTiming){const y=t.EndTiming.match(/[UNJMC](\d+)/);y&&(R=parseInt(y[1],10))}let L=null;return t.HarvestGoal&&t.HarvestGoal>0&&(L=t.HarvestDone/t.HarvestGoal),{gameId:t.DisplayedId,date:C,isModded:t.Modded||!1,playerCount:l,wolfCount:o,hasTraitor:d.length>0,hasWolfCub:h.length>0,hasLovers:p.length>0,soloRoles:u,winningCamp:f,dayCount:R,winners:r.map(y=>y.Username).join(", "),harvest:t.HarvestDone,totalHarvest:t.HarvestGoal,harvestPercentage:L,playersList:t.PlayerStats.map(y=>y.Username).join(", "),versions:t.Version||null,map:t.MapName,victoryType:t.LegacyData?.VictoryType||null,playerVODs:re(t.LegacyData?.PlayerVODs),gameDuration:ie(t.StartDate,t.EndDate),playerData:t.PlayerStats}})}function Ne(e,s){const{data:n,isLoading:i,error:t}=ae(l=>ve(l,e,s));return{data:n||[],isLoading:i,error:t}}const Pe=({playerData:e})=>{const s=E(),n=te(),i=e.reduce((l,m)=>{const d=N(j(m.MainRoleInitial,m.MainRoleChanges||[]));return l[d]||(l[d]=[]),l[d].push(m),l},{}),t=Object.entries(i).sort(([l,m],[d,h])=>{const p=W.includes(l),r=W.includes(d);return p&&!r?-1:!p&&r?1:h.length-m.length});return a.jsxs("div",{className:"lycans-game-detail-section full-width",children:[a.jsx("h4",{children:"Composition des Camps"}),a.jsx("div",{className:"camps-grid",children:t.map(([l,m])=>{const d=m,h=s[l]||"#666",r=d.filter(o=>o.Victorious).length>0;return a.jsxs("div",{className:`camp-group ${r?"winning-camp":""}`,style:{borderColor:h,backgroundColor:`${h}15`,boxShadow:r?`0 0 10px ${h}40`:"none"},children:[a.jsx("div",{className:"camp-header",style:{backgroundColor:`${h}25`},children:a.jsxs("h5",{style:{color:h},children:[l," (",d.length,")",r&&a.jsx("span",{className:"victory-crown",children:"üëë"})]})}),a.jsx("div",{className:"camp-players",children:d.sort((o,f)=>o.Username.localeCompare(f.Username)).map(o=>{let f=h;return o.Color&&n[o.Color]&&(f=n[o.Color]),a.jsxs("div",{className:`player-badge ${o.Victorious?"winner":""} ${o.DeathTiming?"dead":"alive"}`,style:{borderColor:f},title:`${o.Username} - ${N(o.MainRoleInitial)!==N(j(o.MainRoleInitial,o.MainRoleChanges||[]))?`${N(o.MainRoleInitial)} puis ${N(j(o.MainRoleInitial,o.MainRoleChanges||[]))}`:N(o.MainRoleInitial)}${o.DeathTiming?` (Mort ${se(o.DeathTiming)})`:""}`,children:[a.jsx("span",{className:"player-name",children:o.Username}),o.DeathTiming&&a.jsx("span",{className:"death-indicator",children:"üíÄ"}),o.Victorious&&a.jsx("span",{className:"victory-indicator",children:"‚≠ê"})]},o.Username)})})]},l)})})]})};function we(e){if(e===null||e<=0)return"N/A";const s=Math.floor(e/60),n=e%60;return s===0?`${n}s`:n===0?`${s}m`:`${s}m ${n}s`}function be({game:e}){const[s,n]=I.useState(!1),[i,t]=I.useState(null),l=E(),{settings:m}=_(),d=I.useMemo(()=>{const r=[];return e.playerVODs&&typeof e.playerVODs=="object"&&Object.entries(e.playerVODs).forEach(([o,f])=>{if(typeof f=="string"&&f.trim()){const P=e.playerData?.find(C=>C.ID===o),g=P?.Username||o;let u="#666",w="#666";if(P){const C=N(j(P.MainRoleInitial,P.MainRoleChanges||[])),R=j(P.MainRoleInitial,P.MainRoleChanges||[]);u=l[C]||"#666",w=l[R]||"#666",w==="#666"&&(w=l[C]||"#666")}r.push({label:`${g}`,url:f,playerId:o,borderColor:u,textColor:w})}}),r},[e.playerVODs,e.playerData,l]);I.useEffect(()=>{if(s&&d.length>0&&!i){if(d.length===1)t(d[0].url);else if(m.highlightedPlayer){const r=d.find(o=>o.label.toLowerCase()===m.highlightedPlayer?.toLowerCase());r&&t(r.url)}}},[s,d,i,m.highlightedPlayer]);const h=d.length>0,p=d.length>1;return a.jsx("div",{className:"lycans-game-detail-view",children:a.jsxs("div",{className:"lycans-game-detail-grid",children:[a.jsxs("div",{className:"lycans-game-detail-section",children:[a.jsx("h4",{children:"Informations G√©n√©rales"}),a.jsxs("div",{className:"lycans-game-detail-stats",children:[a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Nombre de joueurs:"}),a.jsx("span",{className:"value",children:e.playerCount})]}),a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Nombre de loups:"}),a.jsx("span",{className:"value",children:e.wolfCount})]}),a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Tra√Ætre:"}),a.jsx("span",{className:"value",children:e.hasTraitor?"Oui":"Non"})]}),a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Louveteau:"}),a.jsx("span",{className:"value",children:e.hasWolfCub?"Oui":"Non"})]}),a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Amoureux:"}),a.jsx("span",{className:"value",children:e.hasLovers?"Oui":"Non"})]}),e.soloRoles&&a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"R√¥les solo:"}),a.jsx("span",{className:"value",children:e.soloRoles})]})]})]}),a.jsxs("div",{className:"lycans-game-detail-section",children:[a.jsx("h4",{children:"Informations Suppl√©mentaires"}),a.jsxs("div",{className:"lycans-game-detail-stats",children:[e.victoryType!==null&&a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Type de victoire:"}),a.jsx("span",{className:"value",children:e.victoryType})]}),a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Jours de jeu:"}),a.jsx("span",{className:"value",children:e.dayCount})]}),e.gameDuration!==null&&a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Dur√©e de la partie:"}),a.jsx("span",{className:"value",children:we(e.gameDuration)})]}),e.versions&&a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Version:"}),a.jsxs("span",{className:"value",children:[e.versions,e.isModded?" (modd√©e)":""]})]}),e.map&&a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Map:"}),a.jsx("span",{className:"value",children:e.map})]})]})]}),e.harvest!==null&&a.jsxs("div",{className:"lycans-game-detail-section",children:[a.jsx("h4",{children:"R√©colte"}),a.jsxs("div",{className:"lycans-game-detail-stats",children:[a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"R√©colte:"}),a.jsx("span",{className:"value",children:e.harvest})]}),a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Total possible:"}),a.jsx("span",{className:"value",children:e.totalHarvest})]}),a.jsxs("div",{className:"lycans-stat-item",children:[a.jsx("span",{className:"label",children:"Pourcentage:"}),a.jsx("span",{className:"value",children:typeof e.harvestPercentage=="number"?(e.harvestPercentage*100).toFixed(1)+"%":"N/A"})]})]})]}),a.jsx(Pe,{playerData:e.playerData}),a.jsxs("div",{className:"lycans-game-detail-section full-width",children:[a.jsx("h4",{children:"R√¥les des Joueurs"}),a.jsx("div",{className:"lycans-player-roles-grid",children:e.playerData.sort((r,o)=>{const f=N(j(r.MainRoleInitial,r.MainRoleChanges||[])),P=N(j(o.MainRoleInitial,o.MainRoleChanges||[])),g=W.indexOf(f),u=W.indexOf(P);return g!==-1&&u!==-1?g-u:g!==-1?-1:u!==-1?1:f!==P?f.localeCompare(P):r.Username.localeCompare(o.Username)}).map(r=>{const o=N(r.MainRoleInitial),f=r.MainRoleInitial,P=N(j(r.MainRoleInitial,r.MainRoleChanges||[])),g=j(r.MainRoleInitial,r.MainRoleChanges||[]),u=r.Power,w=r.SecondaryRole;let C=o;f&&f!==o&&(C+=` - ${f}`),u&&u.trim()&&(C+=` - ${u}`),w&&w.trim()&&(C+=` + ${w}`),g&&g!==f&&(C+=` (devient ${g})`);let R=l[j(r.MainRoleInitial,r.MainRoleChanges||[])]||"#666";R==="#666"&&(R=l[P]||"#666");const L=l[P]||"#666",y=r.DeathTiming,M=r.Victorious;return a.jsxs("div",{className:`lycans-player-role-item ${M?"victorious":""}`,style:{borderColor:L},children:[a.jsxs("div",{className:"lycans-player-name",style:{color:R,textAlign:"left"},children:[r.Username,y&&a.jsx("span",{className:"death-skull",children:"üíÄ"})]}),a.jsx("div",{className:"lycans-player-camp",style:{textAlign:"left"},children:C})]},r.Username)})})]}),h&&a.jsx("div",{className:"lycans-game-detail-section full-width",children:a.jsx("button",{onClick:()=>n(!s),className:"lycans-video-toggle-btn",children:s?"üìπ Masquer la vid√©o":"üé• Voir la vid√©o"})}),h&&s&&a.jsxs("div",{className:"lycans-game-detail-section full-width",children:[a.jsx("h4",{children:"Vid√©o de la Partie"}),p&&a.jsx("nav",{className:"lycans-vod-menu",children:d.map((r,o)=>a.jsx("button",{className:`lycans-vod-btn${i===r.url?" active":""}`,onClick:()=>t(r.url),type:"button",title:r.label,style:{borderColor:r.borderColor,color:i===r.url?"white":r.textColor},children:r.label},o))}),a.jsx("div",{className:"lycans-youtube-container",children:i?a.jsx("iframe",{src:i,title:`Partie Lycans #${e.gameId}`,allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0,className:"lycans-youtube-iframe"}):a.jsx("div",{className:"lycans-vod-placeholder",children:a.jsx("p",{children:"S√©lectionnez une VOD de joueur pour commencer"})})})]})]})})}function Se(){const{navigationFilters:e,navigateBack:s}=ee(),{settings:n}=_(),i=!!(e.selectedPlayer||e.selectedGame||e.selectedVictoryType||e.selectedDate||e.selectedHarvestRange||e.selectedGameDuration||e.selectedGameIds&&e.selectedGameIds.length>0||e.selectedMapName||e.campFilter||e.playerPairFilter||e.multiPlayerFilter),t=i?null:n.highlightedPlayer,{data:l,isLoading:m,error:d}=Ne(e,t),h=E(),[p,r]=I.useState("date"),[o,f]=I.useState("desc"),[P,g]=I.useState(null),[u,w]=I.useState(1),[C,R]=I.useState(25),L=I.useRef(!1),M=e.selectedPlayer?[e.selectedPlayer]:e.playerPairFilter?.selectedPlayerPair?e.playerPairFilter.selectedPlayerPair:e.multiPlayerFilter?.selectedPlayers?e.multiPlayerFilter.selectedPlayers:n.highlightedPlayer?[n.highlightedPlayer]:[],k=M.length>0,K=()=>M.length===0?"Vainqueur":M.length===1?M[0]+" (victoire)":M.length===2?M.join(" & ")+" (victoires)":`${M.slice(0,2).join(" & ")} (+${M.length-2}) (victoires)`,B=c=>{if(!k)return"";if(!i&&t)return(c.winners?c.winners.split(",").map(q=>q.trim()):[]).filter(q=>M.some(Z=>Z.toLowerCase()===q.toLowerCase())).length>0?"‚úÖ":"‚ùå";const v=c.playersList?c.playersList.split(",").map(D=>D.trim()):[];return M.filter(D=>v.some(G=>G.toLowerCase()===D.toLowerCase())).length===0?"Pas dans la partie":(c.winners?c.winners.split(",").map(D=>D.trim()):[]).filter(D=>M.some(G=>G.toLowerCase()===D.toLowerCase())).length>0?"‚úÖ":"‚ùå"},V=I.useMemo(()=>l?[...l].sort((c,v)=>{let x,b;switch(p){case"date":x=new Date(c.date.split("/").reverse().join("-")).getTime(),b=new Date(v.date.split("/").reverse().join("-")).getTime();break;case"gameId":x=parseInt(c.gameId,10),b=parseInt(v.gameId,10);break;case"playerCount":x=c.playerCount,b=v.playerCount;break;case"gameDuration":x=c.gameDuration||0,b=v.gameDuration||0;break;case"winningCamp":x=c.winningCamp,b=v.winningCamp;break;case"winner":x=B(c),b=B(v);break;default:return 0}let F;if(o==="asc"?F=x>b?1:x<b?-1:0:F=x<b?1:x>b?-1:0,F===0){const D=parseInt(c.gameId,10),G=parseInt(v.gameId,10);return o==="asc"?D-G:G-D}return F}):[],[l,p,o]),S=Math.ceil(V.length/C),A=(u-1)*C,H=A+C,Q=V.slice(A,H);I.useEffect(()=>{if(L.current){L.current=!1;return}w(1),g(null)},[l]),I.useEffect(()=>{w(1),g(null)},[p,o]);const T=c=>{L.current=!0,w(c),g(null)},X=c=>{L.current=!0,R(c),w(1),g(null)},J=c=>{L.current=!0,g(P===c?null:c)},$=c=>{p===c?f(o==="asc"?"desc":"asc"):(r(c),f("desc"))},U=c=>p!==c?"‚ÜïÔ∏è":o==="asc"?"‚ÜóÔ∏è":"‚ÜòÔ∏è",z=()=>{const c=[];if(e.selectedPlayer&&e.campFilter){const v=e.selectedPlayerWinMode==="wins-only"?" (victoires uniquement)":"";let x=e.campFilter.selectedCamp;e.campFilter.selectedCamp==="Loup"&&e.campFilter.excludeWolfSubRoles?x="Loups sans Tra√Ætre/Louveteau":e.campFilter.selectedCamp==="Villageois"&&e.campFilter.excludeVillagers&&(x="Villageois sans Chasseur/Alchimiste"),c.push(`${e.selectedPlayer} jouant ${x}${v}`)}else{if(e.selectedPlayer){const v=e.selectedPlayerWinMode==="wins-only"?" (victoires uniquement)":e.selectedPlayerWinMode==="all-assignments"?" (toutes parties)":"";c.push(`Joueur: ${e.selectedPlayer}${v}`)}if(e.campFilter){const{campFilterMode:v}=e.campFilter;let x=e.campFilter.selectedCamp;e.campFilter.selectedCamp==="Loup"&&e.campFilter.excludeWolfSubRoles?x="Loups sans Tra√Ætre/Louveteau":e.campFilter.selectedCamp==="Villageois"&&e.campFilter.excludeVillagers&&(x="Villageois sans Chasseur/Alchimiste");const b=`Camp: ${x}`,F=v==="wins-only"?" (victoires uniquement)":v==="all-assignments"?" (toutes assignations)":"";c.push(b+F)}}if(e.selectedMapName){const v=e.selectedMapName==="Autres"?"autres cartes":e.selectedMapName;c.push(`Carte: ${v}`)}if(e.playerPairFilter){const{selectedPlayerPair:v,selectedPairRole:x}=e.playerPairFilter,b=v.join(" & "),F=x==="wolves"?"loups":"amoureux";c.push(`Paire ${F}: ${b}`)}if(e.multiPlayerFilter){const{selectedPlayers:v,playersFilterMode:x,winnerPlayer:b}=e.multiPlayerFilter,F=v.join(" & ");let D="";x==="all-common-games"?D="toutes les parties communes":x==="opposing-camps"?D="affrontements uniquement":x==="same-camp"&&(D="parties en √©quipe (m√™me camp)");const G=b?` (victoires de ${b})`:"";c.push(`${F} (${D}${G})`)}return e.selectedVictoryType&&c.push(`Victoire: ${e.selectedVictoryType}`),e.selectedHarvestRange&&c.push(`R√©colte: ${e.selectedHarvestRange}`),e.selectedGameDuration&&c.push(`Dur√©e: ${e.selectedGameDuration} jour${e.selectedGameDuration>1?"s":""}`),e.selectedGame&&c.push(`Partie ${e.selectedGame}`),e.selectedDate&&(e.selectedDate.includes("/")&&e.selectedDate.split("/").length===2?c.push(`Mois: ${e.selectedDate}`):c.push(`Date: ${e.selectedDate}`)),e.selectedGameIds&&e.selectedGameIds.length>0&&c.push(`${e.selectedGameIds.length} parties s√©lectionn√©e${e.selectedGameIds.length>1?"s":""}`),c};return m?a.jsx("div",{className:"statistiques-chargement",children:"Chargement des d√©tails des parties..."}):d?a.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",d]}):!l||l.length===0?a.jsxs("div",{className:"lycans-empty-section",children:[a.jsx("h2",{children:"Aucune partie trouv√©e"}),a.jsx("p",{children:"Aucune partie ne correspond aux crit√®res s√©lectionn√©s."}),e.fromComponent&&a.jsxs("button",{onClick:s,className:"lycans-submenu-btn",style:{marginTop:"1rem"},children:["‚Üê Retour √† ",e.fromComponent]})]}):a.jsxs("div",{className:"lycans-game-details",children:[a.jsxs("div",{className:"lycans-game-details-header",children:[a.jsxs("div",{className:"lycans-game-details-navigation",children:[e.fromComponent&&a.jsxs("button",{onClick:s,className:"lycans-submenu-btn",style:{marginRight:"1rem"},children:["‚Üê Retour √† ",e.fromComponent]}),a.jsxs("h2",{children:["D√©tails des Parties (",l.length," partie",l.length>1?"s":"",")"]})]}),z().length>0&&a.jsxs("div",{className:"lycans-active-filters",children:[a.jsx("strong",{children:"Filtres actifs:"})," ",z().join(", ")]})]}),S>1&&a.jsxs("div",{className:"lycans-pagination-container",children:[a.jsxs("div",{className:"lycans-pagination-info",children:["Affichage de ",A+1," √† ",Math.min(H,V.length)," sur ",V.length," parties"]}),a.jsxs("div",{className:"lycans-pagination-controls",children:[a.jsxs("select",{value:C,onChange:c=>X(Number(c.target.value)),className:"lycans-pagination-select",children:[a.jsx("option",{value:10,children:"10 par page"}),a.jsx("option",{value:25,children:"25 par page"}),a.jsx("option",{value:50,children:"50 par page"}),a.jsx("option",{value:100,children:"100 par page"})]}),a.jsxs("div",{className:"lycans-pagination-buttons",children:[a.jsx("button",{onClick:()=>T(1),disabled:u===1,className:"lycans-pagination-btn",children:"¬´¬´"}),a.jsx("button",{onClick:()=>T(u-1),disabled:u===1,className:"lycans-pagination-btn",children:"‚Äπ"}),a.jsxs("span",{className:"lycans-pagination-current",children:["Page ",u," sur ",S]}),a.jsx("button",{onClick:()=>T(u+1),disabled:u===S,className:"lycans-pagination-btn",children:"‚Ä∫"}),a.jsx("button",{onClick:()=>T(S),disabled:u===S,className:"lycans-pagination-btn",children:"¬ª¬ª"})]})]})]}),a.jsx("div",{className:"lycans-games-table-container",children:a.jsxs("table",{className:"lycans-games-table",children:[a.jsx("thead",{children:a.jsxs("tr",{children:[a.jsxs("th",{onClick:()=>$("gameId"),className:"sortable",children:["Partie ",U("gameId")]}),a.jsxs("th",{onClick:()=>$("date"),className:"sortable",children:["Date ",U("date")]}),a.jsxs("th",{onClick:()=>$("playerCount"),className:"sortable",children:["Joueurs ",U("playerCount")]}),a.jsxs("th",{onClick:()=>$("gameDuration"),className:"sortable",children:["Dur√©e ",U("gameDuration")]}),a.jsxs("th",{onClick:()=>$("winningCamp"),className:"sortable",children:["Camp Vainqueur ",U("winningCamp")]}),k&&a.jsxs("th",{onClick:()=>$("winner"),className:"sortable",children:[K()," ",U("winner")]}),a.jsx("th",{children:"D√©tails"})]})}),a.jsx("tbody",{children:Q.map(c=>a.jsxs(a.Fragment,{children:[a.jsxs("tr",{className:`${P===c.gameId?"selected":""} clickable-row`,onClick:()=>J(c.gameId),style:{cursor:"pointer"},children:[a.jsxs("td",{children:["#",c.gameId]}),a.jsx("td",{children:c.date}),a.jsx("td",{children:c.playerCount}),a.jsx("td",{children:ne(c.gameDuration)}),a.jsx("td",{style:{color:h[c.winningCamp]||"#fff"},children:c.winningCamp}),k&&a.jsx("td",{style:{textAlign:"left",fontSize:"1.2rem",verticalAlign:"middle"},children:B(c)}),a.jsx("td",{children:a.jsx("button",{onClick:v=>{v.stopPropagation(),J(c.gameId)},className:"lycans-details-btn",children:P===c.gameId?"Masquer":"Voir"})})]},c.gameId),P===c.gameId&&a.jsx("tr",{className:"game-details-row",children:a.jsx("td",{colSpan:k?8:7,children:a.jsx(be,{game:c})})},`${c.gameId}-details`)]}))})]})}),S>1&&a.jsxs("div",{className:"lycans-pagination-container",children:[a.jsxs("div",{className:"lycans-pagination-info",children:["Affichage de ",A+1," √† ",Math.min(H,V.length)," sur ",V.length," parties"]}),a.jsx("div",{className:"lycans-pagination-controls",children:a.jsxs("div",{className:"lycans-pagination-buttons",children:[a.jsx("button",{onClick:()=>T(1),disabled:u===1,className:"lycans-pagination-btn",children:"¬´¬´"}),a.jsx("button",{onClick:()=>T(u-1),disabled:u===1,className:"lycans-pagination-btn",children:"‚Äπ"}),a.jsxs("span",{className:"lycans-pagination-current",children:["Page ",u," sur ",S]}),a.jsx("button",{onClick:()=>T(u+1),disabled:u===S,className:"lycans-pagination-btn",children:"‚Ä∫"}),a.jsx("button",{onClick:()=>T(S),disabled:u===S,className:"lycans-pagination-btn",children:"¬ª¬ª"})]})})]})]})}export{Se as GameDetailsChart};
