import{u as L}from"./baseStatsHook-DACp2zvb.js";import{g as N,a as C}from"./datasyncExport-Sk8THFwE.js";import{i as K,D as r}from"./deathTypes-T5wVOxX_.js";import{c as v}from"./api-BCVJ6fWK.js";import{g as R}from"./index-ChcOUgiP.js";function k(n,u){if(!n||!u)return!1;const l=n.split(".").map(Number),c=u.split(".").map(Number);for(let a=0;a<Math.max(l.length,c.length);a++){const e=l[a]||0,i=c[a]||0;if(e>i)return!0;if(e<i)return!1}return!0}function P(n){return n?n===r.SURVIVALIST_NOT_SAVED?r.BY_WOLF:n:r.UNKNOWN}function M(n){const u=new Set;n.forEach(a=>{a.PlayerStats.forEach(e=>{const i=N(e.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});u.add(i)})});const l=Array.from(u);return[...v.filter(a=>l.includes(a)),...l.filter(a=>!v.includes(a)).sort()]}function F(n){switch(n){case r.VOTED:return"Mort aux votes";case r.BY_WOLF:case r.SURVIVALIST_NOT_SAVED:return"Kill en Loup";case r.BY_ZOMBIE:return"Kill en Zombie";case r.BY_BEAST:return"Kill en Bête";case r.BY_AVATAR_CHAIN:return"Mort d'Avatar";case r.BULLET:return"Tir de Chasseur";case r.BULLET_HUMAN:return"Kill de Chasseur (sur humain)";case r.BULLET_WOLF:return"Kill de Chasseur (sur loup)";case r.SHERIF_SUCCESS:return"Kill de Shérif";case r.OTHER_AGENT:return"Kill d'Agent";case r.AVENGER:return"Kill de Vengeur";case r.SEER:return"Kill de Devin";case r.HANTED:return"Kill avec Potion hantée";case r.ASSASSIN:return"Kill avec Potion (Assassin)";case r.LOVER_DEATH:return"Kill d'amoureux";case r.BOMB:return"Explosion";case r.CRUSHED:return"Écrasement";case r.STARVATION:return"Famine";case r.STARVATION_AS_BEAST:return"Tuerie bestiale";case r.FALL:return"Chute mortelle";case r.UNKNOWN:return"Kill inconnu";default:return""}}function j(n){const u=new Set;n.forEach(a=>{a.PlayerStats.forEach(e=>{if(e.DeathType&&K(e.DeathType)){const i=P(e.DeathType);i&&u.add(i)}})});const l=Array.from(u),c=[r.BY_WOLF,r.VOTED,r.BULLET,r.BULLET_HUMAN,r.BULLET_WOLF,r.BY_ZOMBIE,r.ASSASSIN,r.AVENGER,r.LOVER_DEATH];return[...c.filter(a=>l.includes(a)),...l.filter(a=>!c.includes(a)).sort()]}function O(n,u){return n.PlayerStats.filter(l=>l.DeathType&&K(l.DeathType)&&(l.DeathTiming||l.DeathType)).map(l=>{let c=null,a=null;if(l.KillerName){const e=n.PlayerStats.find(i=>i.Username===l.KillerName);if(e){a=R(e);const i=C(e.MainRoleInitial,e.MainRoleChanges||[]);c=N(i,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1}),i&&i!==e.MainRoleInitial&&(i==="Loup"?c="Loup":i==="Zombie"&&(c="Vaudou"))}}return{playerId:R(l),playerName:l.Username,deathType:P(l.DeathType),killerId:a,killerName:l.KillerName,killerCamp:c}}).filter(l=>{if(!u||u==="Tous les camps")return!0;const c=n.PlayerStats.find(e=>e.Username===l.playerName);return c?N(c.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===u:!1})}function U(n,u,l){const c=[];n.PlayerStats.forEach(e=>{if(e.KillerName&&e.DeathType){if(e.DeathType===r.VOTED||e.DeathType===r.STARVATION||e.DeathType===r.FALL||e.DeathType===r.BY_AVATAR_CHAIN)return;const i=n.PlayerStats.find(m=>m.Username===e.KillerName);if(!i)return;let E=N(i.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});const B=C(i.MainRoleInitial,i.MainRoleChanges||[]);B&&B!==i.MainRoleInitial&&(B==="Loup"?E="Loup":B==="Zombie"&&(E="Vaudou"));const p=N(e.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0});c.push({killerId:R(i),killerName:i.Username,victimId:R(e),victimName:e.Username,deathType:P(e.DeathType),killerCamp:E,victimCamp:p})}});let a=c;return u&&u!=="Tous les camps"&&(a=a.filter(e=>e.killerCamp===u)),l&&l!=="Tous les camps"&&(a=a.filter(e=>l==="Roles solo"?e.victimCamp!=="Villageois"&&e.victimCamp!=="Loup":e.victimCamp===l)),a}function _(n,u,l){if(n.length===0||n.length===0)return null;const c=[],a={},e={};n.forEach(s=>{O(s,u).forEach(t=>{c.push({...t,gameId:s.Id})}),s.PlayerStats.forEach(t=>{const g=R(t),D=t.Username;e[g]=D,(!u||u==="Tous les camps"||N(t.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1})===u)&&(a[g]=(a[g]||0)+1)})});const i=c.length,E=n.length,B=E>0?i/E:0,p={};c.forEach(s=>{p[s.deathType]=(p[s.deathType]||0)+1});const m=Object.entries(p).map(([s,o])=>({type:s,count:o||0,percentage:i>0?(o||0)/i*100:0})).sort((s,o)=>o.count-s.count),h={};n.forEach(s=>{U(s,u,l).forEach(t=>{e[t.killerId]=t.killerName,e[t.victimId]=t.victimName,h[t.killerId]||(h[t.killerId]={kills:0,victims:new Set,killsByDeathType:{}}),h[t.killerId].kills++,h[t.killerId].victims.add(t.victimId),h[t.killerId].killsByDeathType[t.deathType]=(h[t.killerId].killsByDeathType[t.deathType]||0)+1})});const d=Object.entries(h).map(([s,o])=>{const t=a[s]||0,g=t>0?o.kills/t:0;return{killerName:e[s]||s,kills:o.kills,victims:Array.from(o.victims).map(D=>e[D]||D),percentage:i>0?o.kills/i*100:0,gamesPlayed:t,averageKillsPerGame:g,killsByDeathType:o.killsByDeathType}}).sort((s,o)=>o.kills-s.kills),y={};c.forEach(s=>{y[s.playerId]||(y[s.playerId]={totalDeaths:0,deathsByType:{},killedById:{},deathDays:[]});const o=y[s.playerId];o.totalDeaths++,o.deathsByType[s.deathType]=(o.deathsByType[s.deathType]||0)+1,s.killerId&&(o.killedById[s.killerId]=(o.killedById[s.killerId]||0)+1)});const T=[];Object.entries(y).forEach(([s,o])=>{const t=e[s]||s,g={};Object.entries(o.killedById).forEach(([D,A])=>{const V=e[D]||D;g[V]=(g[V]||0)+A}),T.push({playerName:t,totalDeaths:o.totalDeaths,deathsByType:o.deathsByType,killedBy:g,deathRate:a[s]>0?o.totalDeaths/a[s]:0,gamesPlayed:a[s]||0})}),Object.entries(a).forEach(([s,o])=>{y[s]||T.push({playerName:e[s]||s,totalDeaths:0,deathsByType:{},killedBy:{},deathRate:0,gamesPlayed:o})});const f=T.sort((s,o)=>o.totalDeaths-s.totalDeaths),S=m.length>0?m[0].type:null,I=d.length>0?d[0].killerName:null;return{totalDeaths:i,totalGames:E,averageDeathsPerGame:B,deathsByType:m,killerStats:d,playerDeathStats:f,mostCommonDeathType:S,mostDeadlyKiller:I}}function b(n,u){const l={},c={},a=n.length,e=[r.BULLET,r.BULLET_HUMAN,r.BULLET_WOLF];n.forEach(p=>{const m=new Set;p.PlayerStats.forEach(h=>{const d=h.MainRoleInitial,y=C(h.MainRoleInitial,h.MainRoleChanges||[]);if(d==="Chasseur"||y==="Chasseur"||d==="Villageois Élite"&&h.Power==="Chasseur"){const f=R(h);c[f]=h.Username,m.add(f),l[f]||(l[f]={kills:[],gamesPlayed:0,victimsCamps:[],gameVersions:[],gameModded:[]}),l[f].gamesPlayed++}}),p.PlayerStats.forEach(h=>{const d=h.DeathType,y=h.KillerName,T=y?p.PlayerStats.find(S=>S.Username===y):null,f=T?R(T):null;if(f&&T&&(c[f]=T.Username),d&&e.includes(d)&&f&&m.has(f)){const S=N(h.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1});l[f].kills.push(d),l[f].victimsCamps.push(S),l[f].gameVersions.push(p.Version),l[f].gameModded.push(p.Modded)}})});const i=Object.entries(l).map(([p,m])=>{const h=m.kills.length,d={};m.kills.forEach(t=>{d[t]=(d[t]||0)+1});const y={};m.victimsCamps.forEach(t=>{y[t]=(y[t]||0)+1});let T=0,f=0;const S={},I={};m.victimsCamps.forEach((t,g)=>{const D=m.gameVersions[g],A=m.gameModded[g];t==="Idiot du Village"?A&&k(D,"0.202")?(f++,I[t]=(I[t]||0)+1):(T++,S[t]=(S[t]||0)+1):t==="Villageois"?(f++,I[t]=(I[t]||0)+1):(T++,S[t]=(S[t]||0)+1)});const s=m.gamesPlayed>0?h/m.gamesPlayed:0,o=m.gamesPlayed>0?T/m.gamesPlayed:0;return{hunterName:c[p]||p,totalKills:h,nonVillageoisKills:T,villageoisKills:f,gamesPlayedAsHunter:m.gamesPlayed,averageKillsPerGame:s,averageNonVillageoisKillsPerGame:o,killsByDeathType:d,victimsByCamp:y,goodVictimsByCamp:S,badVictimsByCamp:I}}).sort((p,m)=>m.totalKills-p.totalKills),E=i.length>0?i[0].hunterName:null,B=i.length>0?i.sort((p,m)=>m.averageNonVillageoisKillsPerGame-p.averageNonVillageoisKillsPerGame)[0].hunterName:null;return{totalHunters:i.length,totalGames:a,hunterStats:i,bestHunter:E,bestAverageHunter:B}}function x(n,u){return L(l=>_(l,n,u))}function Z(){return L(n=>M(n))}function z(n){return L(u=>b(u))}export{x as a,z as b,j as c,F as g,Z as u};
