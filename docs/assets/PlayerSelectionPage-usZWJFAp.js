import{a as f,u as P,m as D,r as h,l as b,j as e}from"./index-UfX0X43e.js";function C(){const{settings:c,updateSettings:o}=f(),{navigateToTab:j}=P(),{data:d,isLoading:x,error:m}=D(),[r,g]=h.useState(""),t=h.useMemo(()=>{if(!d||!d.GameStats)return[];const s=new Map;return d.GameStats.forEach(l=>{const a=new Date(l.StartDate);l.PlayerStats.forEach(p=>{const u=b(p.Username);s.has(u)||s.set(u,{games:0,wins:0,firstDate:a,lastDate:a});const n=s.get(u);n.games++,p.Victorious&&n.wins++,a<n.firstDate&&(n.firstDate=a),a>n.lastDate&&(n.lastDate=a)})}),Array.from(s.entries()).map(([l,a])=>({name:l,totalGames:a.games,totalWins:a.wins,winRate:a.games>0?a.wins/a.games*100:0,firstGameDate:a.firstDate.toLocaleDateString("fr-FR"),lastGameDate:a.lastDate.toLocaleDateString("fr-FR"),isHighlighted:l===c.highlightedPlayer}))},[d,c.highlightedPlayer]),i=h.useMemo(()=>{if(!r.trim())return t;const s=r.toLowerCase();return t.filter(l=>l.name.toLowerCase().includes(s))},[t,r]),v=h.useMemo(()=>[...i].sort((s,l)=>l.totalGames-s.totalGames),[i]),N=s=>{o({highlightedPlayer:s})},y=s=>{o({highlightedPlayer:s}),j("players","history")};return x?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):m?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les données des joueurs: ",m]})]}):!d||t.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnée disponible"}),e.jsx("p",{children:"Aucun joueur trouvé dans les données."})]}):e.jsxs("div",{className:"player-selection-container",children:[e.jsxs("div",{className:"player-selection-header",children:[e.jsx("h1",{children:"Sélection de Joueur"}),e.jsx("p",{className:"header-description",children:"Choisissez un joueur pour le mettre en évidence dans tous les graphiques. Cliquez sur une carte pour voir l'historique détaillé du joueur."}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:r,onChange:s=>g(s.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"🔍"})]}),e.jsxs("div",{className:"player-count",children:[i.length," joueur",i.length!==1?"s":"",r&&` (filtré${i.length!==1?"s":""} de ${t.length})`]})]})]}),e.jsx("div",{className:"player-display",children:c.highlightedPlayer?(()=>{const s=t.find(l=>l.name===c.highlightedPlayer);return s?e.jsxs("div",{className:"single-player-card highlighted",onClick:()=>y(s.name),children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:s.name}),e.jsx("span",{className:"highlight-badge",children:"★ Mis en évidence"})]}),e.jsxs("div",{className:"player-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Parties"}),e.jsx("span",{className:"stat-value",children:s.totalGames})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Victoires"}),e.jsx("span",{className:"stat-value",children:s.totalWins})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Taux de victoire"}),e.jsxs("span",{className:"stat-value",children:[s.winRate.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"Période d'activité:"}),e.jsxs("span",{className:"period-range",children:[s.firstGameDate," - ",s.lastGameDate]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsx("button",{className:"highlight-btn active",onClick:l=>{l.stopPropagation(),o({highlightedPlayer:null})},children:"★ Retirer la mise en évidence"}),e.jsxs("div",{className:"achievements-placeholder",children:[e.jsx("span",{className:"achievements-label",children:"Succès:"}),e.jsx("span",{className:"achievements-coming-soon",children:"À venir..."})]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',c.highlightedPlayer,`" n'a pas été trouvé dans les données.`]}),e.jsx("button",{className:"clear-selection-btn",onClick:()=>o({highlightedPlayer:null}),children:"Effacer la sélection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"Sélectionnez un joueur"}),e.jsx("p",{children:"Utilisez la recherche ci-dessus pour trouver et sélectionner un joueur à mettre en évidence."}),i.length>0&&e.jsxs("div",{className:"suggested-players",children:[e.jsx("h3",{children:"Joueurs suggérés:"}),e.jsx("div",{className:"suggestion-list",children:v.slice(0,5).map(s=>e.jsxs("button",{className:"suggestion-btn",onClick:()=>N(s.name),children:[s.name," (",s.totalGames," parties)"]},s.name))})]})]})})}),i.length===0&&r&&e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvé pour "',r,'"']}),e.jsx("button",{className:"clear-search-btn",onClick:()=>g(""),children:"Effacer la recherche"})]})]})}export{C as PlayerSelectionPage};
