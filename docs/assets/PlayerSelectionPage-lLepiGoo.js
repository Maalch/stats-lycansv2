import{b as pe,r as k,g as te,f as Fe,a as ne,j as e,u as he,h as $e,e as Le,v as We}from"./index-MtJ8cbMy.js";import{u as ue}from"./useJoueursData-j60E84F-.js";import{u as ve}from"./baseStatsHook-BfjcoLi0.js";import{g as Ie}from"./gameUtils-rkfcKAVy.js";import{a as Te,g as ce,c as Pe,b as qe}from"./datasyncExport-BirWLS1z.js";import{u as ge,g as Ge,b as oe,l as Ee,C as ie,f as je}from"./api-C62hZ3wT.js";import{f as re,d as Ve}from"./durationFormatters-C9UyWcKX.js";import{F as Y,C as J,X as Q,Y as X}from"./FullscreenChart-BJ2cN-2x.js";import{R as K,T as H,a as ee}from"./CategoricalChart-DXaK5Xzl.js";import{L as Be,a as Oe}from"./LineChart-dcQPAoSE.js";import{B as Z,a as O}from"./BarChart-DCkBQjRx.js";import{P as De,a as Ae}from"./PieChart-CNeygPr8.js";import{g as de}from"./deathTypes-gHH1w6_X.js";import{i as be,g as Ce,V as Ke,a as He}from"./roleUtils-g252S1-m.js";import{i as _e,c as Ue}from"./wolfTransformUtils-DiCKErCz.js";import{L as Re}from"./Legend-BV0vvX-o.js";import{S as Ye,R as ae,e as Je,f as Qe,h as me,a as Xe,b as Ze,d as et}from"./deathLocationUtils-D8YVWWKu.js";import{a as tt,u as st}from"./useClips-By3WS_4I.js";import{C as rt,f as Se,a as at}from"./ClipViewer-B2EMQGgc.js";import"./ActivePoints-WawAmZQx.js";import"./PolarChart-Dyi8U5lc.js";import"./CartesianScaleHelper-B5QcuZLv.js";function it(s){const{settings:p}=pe(),{joueursData:f}=ue(),[C,j]=k.useState(null),[i,h]=k.useState(!1),[d,u]=k.useState(null);k.useEffect(()=>{let o=!0;return(async()=>{try{h(!0),u(null);const n=p.dataSource==="discord"?"/data/discord/playerRankings.json":"/data/playerRankings.json",r=await fetch(n);if(!r.ok)throw new Error(`Failed to load Rankings: ${r.status} ${r.statusText}`);const l=await r.json();o&&j(l)}catch(n){o&&u(n instanceof Error?n.message:"Failed to load Rankings")}finally{o&&h(!1)}})(),()=>{o=!1}},[p.dataSource]);const m=(()=>{if(!s||!C)return null;const a=f?.Players?.find(n=>n.Joueur===s)?.SteamID;return a&&C.Rankings[a]||null})();return k.useEffect(()=>{s&&C&&f&&f.Players?.find(n=>n.Joueur===s)?.SteamID},[s,C,f,p.dataSource]),{data:m,isLoading:i,error:d,metadata:{generatedAt:C?.generatedAt||null,totalPlayers:C?.totalPlayers||0,totalGames:C?.totalGames||0,totalModdedGames:C?.totalModdedGames||0}}}function nt(s,p,f){if(!s||s.trim()===""||p.length===0)return null;const C=[];let j=s;p.forEach(a=>{const n=a.PlayerStats.find(r=>te(r)===s||r.Username.toLowerCase()===s.toLowerCase());if(n){j=n.Username;const r=n.MainRoleInitial==="Louveteau"?n.MainRoleInitial:Te(n.MainRoleInitial,n.MainRoleChanges||[]),l=ce(r);if(f&&f!=="Tous les camps"&&l!==f)return;const y=Ie(a),c=n.Victorious,b=Fe(new Date(a.StartDate)),T=Pe(a.StartDate,a.EndDate)||0;C.push({gameId:a.Id,date:b,camp:l,won:c,winnerCamp:y,playersInGame:a.PlayerStats.length,mapName:a.MapName,duration:T})}}),C.sort((a,n)=>{const r=l=>{const y=l.split("/");return y.length===3?new Date(parseInt(y[2]),parseInt(y[1])-1,parseInt(y[0])):new Date(l)};return r(n.date).getTime()-r(a.date).getTime()});const i=C.length,h=C.filter(a=>a.won).length,d=i>0?(h/i*100).toFixed(2):"0.00",u={};C.forEach(a=>{u[a.camp]||(u[a.camp]={appearances:0,wins:0,winRate:"0.00"}),u[a.camp].appearances++,a.won&&u[a.camp].wins++}),Object.keys(u).forEach(a=>{const n=u[a];n.winRate=n.appearances>0?(n.wins/n.appearances*100).toFixed(2):"0.00"});const m={};C.forEach(a=>{m[a.mapName]||(m[a.mapName]={appearances:0,wins:0,winRate:"0.00"}),m[a.mapName].appearances++,a.won&&m[a.mapName].wins++}),Object.keys(m).forEach(a=>{const n=m[a];n.winRate=n.appearances>0?(n.wins/n.appearances*100).toFixed(2):"0.00"});const o=C.reduce((a,n)=>a+n.duration,0);return{playerName:j,totalGames:i,totalWins:h,winRate:d,totalPlayTime:o,games:C,campStats:u,mapStats:m}}function xe(s,p){const{data:f,isLoading:C,error:j}=ve(i=>s?nt(s,i,p):null);return{data:f,isLoading:C,error:j}}function ot(s){const{settings:p}=pe(),[f,C]=k.useState(null),[j,i]=k.useState(null),[h,d]=k.useState(!0),[u,m]=k.useState(null);return k.useEffect(()=>{(async()=>{d(!0),m(null);try{const a=p.dataSource==="discord"?"/data/discord/playerTitles.json":"/data/playerTitles.json",n=await fetch(a);if(!n.ok){if(n.status===404)C(null),i(null),m("Les titres n'ont pas encore Ã©tÃ© gÃ©nÃ©rÃ©s. Ils seront disponibles aprÃ¨s la prochaine synchronisation hebdomadaire.");else throw new Error(`HTTP error! status: ${n.status}`);return}const r=await n.json();if(C(r),s&&r.players){const l=Object.entries(r.players).find(([y,c])=>c.playerName===s);i(l?l[1]:null)}else i(null)}catch(a){console.error("Error loading player titles:",a),m(a instanceof Error?a.message:"Erreur inconnue"),C(null),i(null)}finally{d(!1)}})()},[p.dataSource,s]),{data:f,playerData:j,isLoading:h,error:u}}function lt({rankings:s,title:p,emptyMessage:f,rankingType:C="all"}){const{navigateToTab:j,updateNavigationState:i,clearNavigation:h}=ne(),{settings:d,updateSettings:u}=pe(),{joueursData:m}=ue(),o=ge(m),a=(t,A)=>{if(A.stopPropagation(),!t.redirectTo)return;h();const I=d.highlightedPlayer;if(u(C==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:I,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:I,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const S=d.highlightedPlayer||"",x=n(t.description,S);x&&i({playerComparisonState:{selectedPlayer1:S,selectedPlayer2:x,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const S=t.description.toLowerCase().includes("loup");i({selectedPairingTab:S?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const S=t.description.match(/(Villageois|Loups|Autres)/i);S&&i({deathStatsSelectedCamp:S[1]});let x=10;const g=t.description.match(/min\.\s*(\d+)/);g&&(x=parseInt(g[1],10));let N="totalKills",v="killers";const P=t.redirectTo.chartSection;P&&(P==="killers-total"?(N="totalKills",v="killers"):P==="killers-average"?(N="averageKills",v="killers"):P==="deaths-total"?(N="totalDeaths",v="deaths"):P==="survivors-average"?(N="survivalRate",v="deaths"):(P==="hunters-good"||P==="hunters-bad")&&(v="hunter",N="averageKills")),i({deathStatisticsState:{selectedCamp:S?.[1]||"Tous les camps",minGamesForAverage:x,selectedView:v,focusChart:N}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const S=t.redirectTo.mapFilter||"all";let x=10;const g=t.description.match(/min\.\s*(\d+)/);g&&(x=parseInt(g[1])),u(C==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:S,playerFilter:{mode:"none",players:[]},highlightedPlayer:I,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:S,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:S,playerFilter:{mode:"none",players:[]},highlightedPlayer:I,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:S,playerFilter:{mode:"none",players:[]}}}),i({playersGeneralState:{minGamesForWinRate:x,winRateOrder:"best",focusChart:"winRate"}}),j("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&i({selectedPlayerName:d.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let S="wins";const x=t.title.toLowerCase(),g=t.description.toLowerCase();x.includes("dÃ©faite")||g.includes("dÃ©faite")?S="losses":x.includes("loup")||g.includes("loup")?S="loup":x.includes("villageois")||g.includes("villageois")?S="villageois":(x.includes("victoire")||g.includes("victoire"))&&(S="wins"),i({selectedSeriesType:S})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let S=10;const x=t.description.match(/min\.\s*(\d+)/);x&&(S=parseInt(x[1],10));let g="winRate",N="best";const v=t.title.toLowerCase(),P=t.description.toLowerCase();v.includes("participation")||P.includes("participation")?g="participation":(v.includes("taux de victoire")||P.includes("taux de victoire"))&&(g="winRate",(v.includes("moins bon")||v.includes("mauvais")||P.includes("moins bon")||P.includes("mauvais"))&&(N="worst")),i({playersGeneralState:{minGamesForWinRate:S,winRateOrder:N,focusChart:g}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const S=t.redirectTo.chartSection;let x="Villageois",g=1;S&&(S==="camp-loup"?x="Loup":S==="camp-villageois"?x="Villageois":S==="camp-idiot"?x="Idiot du Village":S==="camp-amoureux"?x="Amoureux":(S==="solo-roles"||S==="hall-of-fame")&&(x="Villageois"));const N=t.description.match(/min\.\s*(\d+)/);N&&(g=parseInt(N[1],10)),S==="solo-roles"?x="RÃ´les spÃ©ciaux":S==="hall-of-fame"&&(x="Tous les camps"),i({campPerformanceState:{selectedCampPerformanceCamp:x,selectedCampPerformanceMinGames:g,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const S=t.title.toLowerCase();let x="overview",g="behavior";S.includes("agressivitÃ©")?(x="overview",g="behavior"):S.includes("taux de vote")?(x="behavior",g="voteRate"):S.includes("prÃ©cision")&&(x="overview",g="accuracy"),i({votingStatsState:{selectedCategory:x,selectedView:g}})}if(t.category==="loot"&&t.redirectTo.subTab==="lootStats"){const S=t.redirectTo,x=S.minGames||5,g=S.view||"normalized";i({lootStatsState:{minGames:x,campFilter:"all",view:g}})}j(t.redirectTo.tab,t.redirectTo.subTab)},n=(t,A)=>{const I=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const S of I){const x=t.match(S);if(x&&x[1]){const g=x[1].trim();if(g!==A)return g}}return null},r=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const S=t.description.match(/min\.\s*(\d+)/),x=S?parseInt(S[1],10):10,g=t.title.toLowerCase(),N=C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return g.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${x} parties)${N}`:g.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${N}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${N}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const S=t.redirectTo.mapFilter,x=S==="village"?"Village":S==="chateau"?"ChÃ¢teau":"map",g=C==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${x}${g}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${n(t.description,d.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const S=t.description.match(/(Villageois|Loups|Autres)/i),x=t.description.match(/min\.\s*(\d+)/),g=x?parseInt(x[1],10):10,N=S?.[1]||"Tous les camps",v=t.redirectTo.chartSection;let P="kills et morts";return v==="killers-total"?P="total des kills":v==="killers-average"?P=`moyenne des kills (min. ${g} parties)`:v==="deaths-total"?P="total des morts":v==="survivors-average"&&(P=`taux de survie (min. ${g} parties)`),`Cliquez pour voir les statistiques de ${P} ${N!=="Tous les camps"?`en ${N}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const S=t.title.toLowerCase(),x=t.description.toLowerCase();return S.includes("dÃ©faite")||x.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":S.includes("loup")||x.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":S.includes("villageois")||x.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":S.includes("victoire")||x.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const S=t.redirectTo.chartSection,x=C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return S==="camp-loup"?`Cliquez pour voir les performances camp Loup${x}`:S==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${x}`:S==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${x}`:S==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${x}`:S==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${x}`:S==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${x}`:`Cliquez pour voir les performances par camp${x}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const S=t.description.match(/min\.\s*(\d+)/),x=S?parseInt(S[1],10):25,g=C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",N=t.title.toLowerCase();return N.includes("agressivitÃ©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${x} meetings)${g}`:N.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${x} meetings)${g}`:N.includes("prÃ©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${g}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${g}`}break;case"loot":if(t.redirectTo.subTab==="lootStats"){const S=t.description.match(/min\.\s*(\d+)/),x=S?parseInt(S[1],10):25,g=C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de rÃ©colte (min. ${x} parties)${g}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(C==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},l=t=>o[t]||Ge(t),y=t=>{const A=[/avec ([^:]+?):/,/contre ([^:]+?):/];let I=t;return A.forEach(S=>{const x=t.match(S);if(x&&x[1]){const g=x[1].trim(),v=`<span class="player-name-highlight" style="color: ${l(g)};">${g}</span>`;I=I.replace(g,v)}}),I};if(s.length===0)return e.jsxs("div",{className:"rankings-empty",children:[e.jsx("h4",{children:p}),e.jsx("p",{children:f||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const c=t=>t===1?"ðŸ¥‡":t===2?"ðŸ¥ˆ":t===3?"ðŸ¥‰":"",b=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",T=(t,A)=>{if(!t||t<=3||!A)return;const I=t-3,S=A-3;return S<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(I-1)/(S-1))}, 70%, 50%)`},W=(t,A)=>{if(!t||!A)return;if(A<=1)return"hsl(0, 70%, 50%)";const I=(t-1)/(A-1),S=I*15,x=50-I*15;return`hsl(${S}, 70%, ${x}%)`},D=t=>{if(!t)return;const A=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(A){const[,I,S]=A;return`hsl(${I}, ${S}%, 40%)`}return t},M=s.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,A)=>(t.rank??999)-(A.rank??999)),z=s.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,A)=>(t.rank??999)-(A.rank??999)),E=s.filter(t=>t.category==="comparison"),F=[...M,...z].sort((t,A)=>(t.rank??999)-(A.rank??999)),L=M.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"rankings-container",children:[e.jsx("h4",{children:p}),L>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:M.filter(t=>t.rank&&t.rank<=3).map((t,A)=>e.jsxs("div",{className:`top3-card ${b(t.rank)} animate-slide-in`,style:{animationDelay:`${A*.15}s`},onClick:I=>a(t,I),title:r(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:c(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-ranking-title",children:t.title}),e.jsx("p",{className:"top3-ranking-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},t.id))})]}),F.length>0&&e.jsxs("div",{className:"rankings-section unified-rankings",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"rankings-grid",children:F.filter(t=>t.type==="bad"?!0:!t.rank||t.rank>3).map((t,A)=>{const I=t.type==="bad",S=I?W(t.rank,t.totalRanked):T(t.rank,t.totalRanked),x=D(S),g=I?"":b(t.rank);return e.jsxs("div",{className:`ranking-card ${I?"bad":"good"} ${g}`,onClick:N=>a(t,N),title:r(t),style:{animationDelay:`${A*.05}s`,borderLeftColor:x,borderLeftWidth:"4px"},children:[e.jsxs("div",{className:"ranking-header",children:[e.jsxs("span",{className:"ranking-title",children:[I&&"ðŸ’€ ",t.title]}),e.jsxs("span",{className:"ranking-rank",style:S?{backgroundColor:S}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"ranking-description",children:t.description})]},t.id)})})]}),E.length>0&&e.jsxs("div",{className:"rankings-section comparison-rankings",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques CoÃ©quipiers et Face-Ã -Face"}),e.jsx("div",{className:"rankings-grid",children:E.map(t=>e.jsxs("div",{className:"ranking-card comparison",onClick:A=>a(t,A),title:r(t),children:[e.jsx("div",{className:"ranking-header",children:e.jsx("span",{className:"ranking-title",children:t.title})}),e.jsx("p",{className:"ranking-description",dangerouslySetInnerHTML:{__html:y(t.description)}})]},t.id))})]})]})}function ct({selectedPlayerName:s,groupingMethod:p,campFilter:f="all"}){const{navigateToGameDetails:C}=ne(),{data:j,isLoading:i,error:h}=xe(s),d=k.useMemo(()=>{switch(p){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[p]),u=k.useMemo(()=>{if(!j?.games)return new Map;const n=new Map;return j.games.forEach(r=>{if(!n.has(r.date)){const l=r.date.split("/");l.length===3?n.set(r.date,new Date(parseInt(l[2]),parseInt(l[1])-1,parseInt(l[0])).getTime()):n.set(r.date,new Date(r.date).getTime())}}),n},[j?.games]),m=k.useMemo(()=>{if(!j?.games)return[];const n={};return j.games.forEach(r=>{if(f!=="all"){if(f==="solo"){if(r.camp==="Villageois"||r.camp==="Loup")return}else if(r.camp!==f)return}let l;const y=r.date.split("/");if(p==="month")if(y.length===3)l=`${y[1].padStart(2,"0")}/${y[2]}`;else{const c=new Date(r.date);l=`${String(c.getMonth()+1).padStart(2,"0")}/${c.getFullYear()}`}else if(p==="quarter")if(y.length===3){const c=parseInt(y[1],10);l=`T${Math.floor((c-1)/3)+1}/${y[2]}`}else{const c=new Date(r.date);l=`T${Math.floor(c.getMonth()/3)+1}/${c.getFullYear()}`}else p==="year"?y.length===3?l=`${y[2]}`:l=`${new Date(r.date).getFullYear()}`:l=r.date;n[l]||(n[l]={games:[],wins:0,total:0}),n[l].games.push(r),n[l].total++,r.won&&n[l].wins++}),Object.entries(n).map(([r,l])=>({period:r,totalGames:l.total,victories:l.wins,defeats:l.total-l.wins,winRate:l.total>0?(l.wins/l.total*100).toFixed(1):"0.0",winRateNum:l.total>0?l.wins/l.total*100:0})).sort((r,l)=>{if(p==="month"){const[y,c]=r.period.split("/"),[b,T]=l.period.split("/"),W=new Date(parseInt(c),parseInt(y)-1,1),D=new Date(parseInt(T),parseInt(b)-1,1);return W.getTime()-D.getTime()}else if(p==="quarter"){const[y,c]=r.period.split("/"),[b,T]=l.period.split("/"),W=parseInt(y.replace(/\D/g,""),10)||1,D=parseInt(b.replace(/\D/g,""),10)||1,M=new Date(parseInt(c,10),(W-1)*3,1),z=new Date(parseInt(T,10),(D-1)*3,1);return M.getTime()-z.getTime()}else if(p==="year"){const y=parseInt(r.period,10),c=parseInt(l.period,10);return y-c}else{const y=u.get(r.period)||0,c=u.get(l.period)||0;return y-c}})},[j,p,u,f]),a=(n=>n<=15?{fontSize:12,angle:-45,height:80,interval:0}:n<=30?{fontSize:12,angle:-45,height:85,interval:1}:n<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(n/12)})(m.length);return i?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):h?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",h]}):j?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",d]}),e.jsx(Y,{title:`Ã‰volution des Performances ${d}`,children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Be,{data:m,margin:{top:20,right:30,left:20,bottom:20},onClick:n=>{if(n&&n.activeLabel){const r=m.find(l=>l.period===n.activeLabel);r&&C({selectedPlayer:s,selectedDate:r.period,fromComponent:`Ã‰volution des Performances ${d}`})}},style:{cursor:"pointer"},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"period",angle:a.angle,textAnchor:"end",height:a.height,interval:a.interval,fontSize:a.fontSize,tick:({x:n,y:r,payload:l})=>e.jsx("text",{x:n,y:r,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:a.fontSize,fontStyle:"italic",transform:`rotate(${a.angle} ${n} ${r})`,children:l.value})}),e.jsx(X,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(H,{content:({active:n,payload:r})=>{if(n&&r&&r.length>0){const l=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:l.period})}),e.jsxs("div",{children:["Parties: ",l.totalGames]}),e.jsxs("div",{children:["Victoires: ",l.victories]}),e.jsxs("div",{children:["Taux: ",l.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(Oe,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",d]}),e.jsx(Y,{title:`RÃ©partition Victoires/DÃ©faites ${d}`,children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:m,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"period",angle:a.angle,textAnchor:"end",height:a.height,interval:a.interval,fontSize:a.fontSize,tick:({x:n,y:r,payload:l})=>e.jsx("text",{x:n,y:r,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:a.fontSize,fontStyle:"italic",transform:`rotate(${a.angle} ${n} ${r})`,children:l.value})}),e.jsx(X,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:n,payload:r})=>{if(n&&r&&r.length>0){const l=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:l.period})}),e.jsxs("div",{children:["Total: ",l.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",l.victories]}),e.jsxs("div",{children:["DÃ©faites: ",l.defeats]}),e.jsxs("div",{children:["Taux: ",l.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(O,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",shape:n=>{const{x:r,y:l,width:y,height:c,payload:b}=n,T=b;return e.jsx(ee,{x:r,y:l,width:y,height:c,fill:"var(--accent-tertiary)",onClick:()=>{C({selectedPlayer:s,selectedDate:T.period,fromComponent:`Historique Joueur - Victoires ${d}`})},style:{cursor:"pointer"}})}}),e.jsx(O,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",shape:n=>{const{x:r,y:l,width:y,height:c,payload:b}=n,T=b;return e.jsx(ee,{x:r,y:l,width:y,height:c,fill:"var(--chart-color-4)",onClick:()=>{C({selectedPlayer:s,selectedDate:T.period,fromComponent:`Historique Joueur - DÃ©faites ${d}`})},style:{cursor:"pointer"}})}})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function dt({selectedPlayerName:s}){const{navigateToGameDetails:p}=ne(),{data:f,isLoading:C,error:j}=xe(s),i=oe(),h=o=>{if(o.name==="Autres"){const a=o._details?.map(n=>n.name)||[];p({selectedPlayer:s,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:a},fromComponent:"Distribution par Camps"})}else o.name==="TraÃ®tre"||o.name==="Louveteau"?p({selectedPlayer:s,campFilter:{selectedCamp:o.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):o.name==="Loup"?p({selectedPlayer:s,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):p({selectedPlayer:s,campFilter:{selectedCamp:o.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},d=k.useMemo(()=>f?.campStats?Object.entries(f.campStats).map(([o,a])=>({name:o,value:a.appearances,winRate:a.winRate,winRateDisplay:Math.max(parseFloat(a.winRate),1),wins:a.wins,percentage:(a.appearances/f.totalGames*100).toFixed(1)})):[],[f]),u=k.useMemo(()=>{if(!d.length)return[];const o=5;let a=0;const n=[],r=[];if(d.forEach(l=>{parseFloat(l.percentage)<o?(a+=Number(l.value),n.push(l)):r.push(l)}),a>0){const l=d.reduce((y,c)=>y+Number(c.value),0);r.push({name:"Autres",value:a,winRate:"0.0",winRateDisplay:1,wins:n.reduce((y,c)=>y+c.wins,0),percentage:(a/l*100).toFixed(1),_details:n})}return r},[d]),m=k.useMemo(()=>u.map((o,a)=>({...o,fill:o.name==="Autres"?Ee:i[o.name]||`var(--chart-color-${a%6+1})`})),[u,i]);return C?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):j?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",j]}):f?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(De,{children:[e.jsx(Ae,{data:m,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:o=>{const a=o.percent!==void 0?o.percent:0;return o.name==="Autres"?`Autres : ${o.value} (${(a*100).toFixed(1)}%)`:`${o.name}: ${o.value} (${(a*100).toFixed(1)}%)`},onClick:o=>h(o)}),e.jsx(H,{content:({active:o,payload:a})=>{if(o&&a&&a.length>0){const n=a[0].payload;if(n.name==="Autres"&&n._details){const r=[...n._details].sort((l,y)=>y.value-l.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",n.value," parties (",n.percentage,"%)"]})}),e.jsx("div",{children:r.map((l,y)=>e.jsxs("div",{children:[l.name,": ",l.value," parties (",l.percentage,"%)"]},y))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[n.name," - ",n.value," parties (",n.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(Y,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:d,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14,tick:({x:o,y:a,payload:n})=>e.jsx("text",{x:o,y:a,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:14,fontStyle:"italic",transform:`rotate(-45 ${o} ${a})`,children:n.value})}),e.jsx(X,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(H,{content:({active:o,payload:a})=>{if(o&&a&&a.length>0){const n=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:n.name})}),e.jsxs("div",{children:["Victoires: ",n.wins," / ",n.value]}),e.jsxs("div",{children:["Taux: ",n.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(O,{dataKey:"winRateDisplay",shape:o=>{const{x:a,y:n,width:r,height:l,payload:y,index:c}=o,b=y,T=i[b.name]||`var(--chart-color-${(c??0)%6+1})`,W=parseFloat(b.winRate)===0?`${T}50`:T;return e.jsx(ee,{x:a,y:n,width:r,height:l,fill:W,onClick:()=>{b.name==="TraÃ®tre"||b.name==="Louveteau"?p({selectedPlayer:s,campFilter:{selectedCamp:b.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):b.name==="Loup"?p({selectedPlayer:s,campFilter:{selectedCamp:b.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):p({selectedPlayer:s,campFilter:{selectedCamp:b.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}})}})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function ut({selectedPlayerName:s}){const{gameData:p}=he(),{joueursData:f}=ue(),C=ge(f),j=oe(),i=k.useMemo(()=>{if(!p||!s)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const d={},u={},m={},o=new Set;p.forEach(y=>{const c=y.PlayerStats.find(b=>b.Username.toLowerCase()===s.toLowerCase());if(c&&(y.PlayerStats.forEach(b=>{b.KillerName?.toLowerCase()===s.toLowerCase()&&(d[b.Username]=(d[b.Username]||0)+1)}),c.KillerName&&(u[c.KillerName]=(u[c.KillerName]||0)+1),c.DeathType)){const b=c.DeathType,T=de(b);m[T]||(m[T]={count:0,byDeathType:{}}),m[T].count+=1,m[T].byDeathType[b]=(m[T].byDeathType[b]||0)+1,o.add(b)}});const a=Object.entries(d).map(([y,c])=>({player:y,kills:c})).sort((y,c)=>c.kills-y.kills).slice(0,ie.TOP_10),n=Object.entries(u).map(([y,c])=>({player:y,kills:c})).sort((y,c)=>c.kills-y.kills).slice(0,ie.TOP_10),r=Object.entries(m).map(([y,c])=>{const b={deathType:y,count:c.count};return b[y]=c.count,b}).sort((y,c)=>c.count-y.count).slice(0,ie.TOP_10),l=Object.keys(m);return{playersKilled:a,killedBy:n,deathTypes:r,availableDeathTypes:l}},[p,s]),h=k.useMemo(()=>{const d={};i.availableDeathTypes.forEach(o=>{o==="TuÃ© par Loup"?d[o]=j.Loup:o==="Mort aux votes"?d[o]="var(--chart-color-1)":o.includes("Chasseur")?d[o]=j.Chasseur:o==="TuÃ© par Zombie"?d[o]=j.Vaudou:o==="TuÃ© par potion assassin"?d[o]=j.Alchimiste:o==="TuÃ© par Vengeur"?d[o]="var(--chart-color-2)":o==="Amoureux mort"?d[o]=j.Amoureux:o==="TuÃ© par La BÃªte"?d[o]="var(--chart-color-3)":o==="TuÃ© par ShÃ©rif"&&(d[o]="var(--chart-color-4)")});const u=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let m=0;return i.availableDeathTypes.forEach(o=>{d[o]||(d[o]=u[m%u.length],m++)}),d},[i.availableDeathTypes,j]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[i.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(Y,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:i.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14,tick:({x:d,y:u,payload:m})=>e.jsx("text",{x:d,y:u,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:14,fontStyle:"italic",transform:`rotate(-45 ${d} ${u})`,children:m.value})}),e.jsx(X,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:d,payload:u})=>{if(d&&u&&u.length>0){const m=u[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.player})}),e.jsxs("div",{children:["TuÃ© ",m.kills," fois par ",s]})]})}return null}}),e.jsx(O,{dataKey:"kills",shape:d=>{const{x:u,y:m,width:o,height:a,payload:n}=d,l=C[n.player]||"var(--chart-color-3)";return e.jsx(ee,{x:u,y:m,width:o,height:a,fill:l})}})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[s," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),i.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(Y,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:i.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14,tick:({x:d,y:u,payload:m})=>e.jsx("text",{x:d,y:u,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:14,fontStyle:"italic",transform:`rotate(-45 ${d} ${u})`,children:m.value})}),e.jsx(X,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:d,payload:u})=>{if(d&&u&&u.length>0){const m=u[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.player})}),e.jsxs("div",{children:["A tuÃ© ",s," ",m.kills," fois"]})]})}return null}}),e.jsx(O,{dataKey:"kills",shape:d=>{const{x:u,y:m,width:o,height:a,payload:n}=d,l=C[n.player]||"var(--chart-color-4)";return e.jsx(ee,{x:u,y:m,width:o,height:a,fill:l})}})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[s," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),i.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(Y,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:i.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12,tick:({x:d,y:u,payload:m})=>e.jsx("text",{x:d,y:u,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,fontStyle:"italic",transform:`rotate(-45 ${d} ${u})`,children:m.value})}),e.jsx(X,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:d,payload:u})=>{if(d&&u&&u.length>0){const m=u[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.deathType})}),e.jsxs("div",{children:[s," est mort ",m.count," fois ainsi"]})]})}return null}}),i.availableDeathTypes.map(d=>e.jsx(O,{dataKey:d,name:d,stackId:"deaths",fill:h[d]||"var(--chart-color-5)"},d))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",s,"."]})]})]})}function mt(s,p){if(!s||s.trim()===""||p.length===0)return null;const f=new Map,C=new Map,j=new Map;p.forEach(m=>{if(!m.Modded)return;const o=m.PlayerStats.find(a=>te(a)===s||a.Username.toLowerCase()===s.toLowerCase());if(o){if(o.MainRoleInitial==="Inconnu")return;const a=o.Victorious,r=Te(o.MainRoleInitial,o.MainRoleChanges||[])!==o.MainRoleInitial,l=ce(o.MainRoleInitial),y=l==="Loup"||l==="TraÃ®tre"||l==="Louveteau";if(l==="Villageois"&&be(o)){const c=Ce(o);if(c&&Ke.includes(c)){const b=f.get(c)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};f.set(c,{appearances:b.appearances+1,wins:b.wins+(a?1:0),winsWithoutRoleChange:b.winsWithoutRoleChange+(!r&&a?1:0),gamesWithoutRoleChange:b.gamesWithoutRoleChange+(r?0:1)})}}else if(o.Power&&o.Power.trim()!==""&&o.Power!=="Inconnu"){if(l==="Villageois"){const c=f.get(o.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};f.set(o.Power,{appearances:c.appearances+1,wins:c.wins+(a?1:0),winsWithoutRoleChange:c.winsWithoutRoleChange+(!r&&a?1:0),gamesWithoutRoleChange:c.gamesWithoutRoleChange+(r?0:1)})}else if(y){const c=C.get(o.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},b=c.roleBreakdown;b.set(o.MainRoleInitial,(b.get(o.MainRoleInitial)||0)+1),C.set(o.Power,{appearances:c.appearances+1,wins:c.wins+(a?1:0),winsWithoutRoleChange:c.winsWithoutRoleChange+(!r&&a?1:0),gamesWithoutRoleChange:c.gamesWithoutRoleChange+(r?0:1),roleBreakdown:b})}}else if((l==="Villageois"||y)&&o.Power!=="Inconnu")if(l==="Villageois"){const c=f.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};f.set("Aucun pouvoir",{appearances:c.appearances+1,wins:c.wins+(a?1:0),winsWithoutRoleChange:c.winsWithoutRoleChange+(!r&&a?1:0),gamesWithoutRoleChange:c.gamesWithoutRoleChange+(r?0:1)})}else{const c=C.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},b=c.roleBreakdown;b.set(o.MainRoleInitial,(b.get(o.MainRoleInitial)||0)+1),C.set("Aucun pouvoir",{appearances:c.appearances+1,wins:c.wins+(a?1:0),winsWithoutRoleChange:c.winsWithoutRoleChange+(!r&&a?1:0),gamesWithoutRoleChange:c.gamesWithoutRoleChange+(r?0:1),roleBreakdown:b})}if(o.SecondaryRole&&o.SecondaryRole.trim()!==""&&o.SecondaryRole!=="Inconnu"){const c=j.get(o.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};j.set(o.SecondaryRole,{appearances:c.appearances+1,wins:c.wins+(a?1:0),winsWithoutRoleChange:c.winsWithoutRoleChange+(!r&&a?1:0),gamesWithoutRoleChange:c.gamesWithoutRoleChange+(r?0:1)})}}});const i=new Map;p.forEach(m=>{const o=m.PlayerStats.find(a=>te(a)===s||a.Username.toLowerCase()===s.toLowerCase());if(o&&be(o)){const a=Ce(o);a&&i.set(a,(i.get(a)||0)+1)}});const h=m=>Array.from(m.entries()).map(([o,a])=>({name:o,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...i.has(o)&&{totalGamesAllModes:i.get(o)}})).sort((o,a)=>a.appearances-o.appearances),d=m=>Array.from(m.entries()).map(([o,a])=>({name:o,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(a.roleBreakdown.entries()).map(([n,r])=>({role:n,count:r})).sort((n,r)=>r.count-n.count)})).sort((o,a)=>a.appearances-o.appearances),u=m=>Array.from(m.entries()).map(([o,a])=>({name:o,appearances:a.appearances,wins:a.wins,winsWithoutRoleChange:a.winsWithoutRoleChange,gamesWithoutRoleChange:a.gamesWithoutRoleChange,winRate:a.gamesWithoutRoleChange>0?(a.winsWithoutRoleChange/a.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((o,a)=>a.appearances-o.appearances);return{villageoisPowers:h(f),loupPowers:d(C),secondaryRoles:u(j)}}function pt({selectedPlayerName:s}){const{navigateToGameDetails:p,navigationState:f,updateNavigationState:C}=ne(),j=oe(),[i,h]=k.useState(f.playerHistoryRolesState?.chartMode||"appearances"),{data:d,isLoading:u,error:m}=ve(T=>mt(s,T));k.useEffect(()=>{(!f.playerHistoryRolesState||f.playerHistoryRolesState.chartMode!==i)&&C({playerHistoryRolesState:{chartMode:i}})},[i,f.playerHistoryRolesState,C]);const o=T=>{h(T),C({playerHistoryRolesState:{chartMode:T}})},a=k.useCallback(T=>{if(!d)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const W=1,D=1,M=i==="winRate"?(F,L)=>parseFloat(L.winRate)-parseFloat(F.winRate):(F,L)=>L.appearances-F.appearances,z=F=>({...F,winRateDisplay:Math.max(parseFloat(F.winRate),1)}),E=F=>T===null?F:F.slice(0,T);return{villageoisPowers:E(d.villageoisPowers.filter(F=>F.appearances>=W).map(z).sort(M)),loupPowers:E(d.loupPowers.filter(F=>F.appearances>=W).map(z).sort(M)),secondaryRoles:E(d.secondaryRoles.filter(F=>F.appearances>=D).map(z).sort(M))}},[d,i]),n=k.useMemo(()=>a(15),[a]);if(u)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(m)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",m]});if(!d)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const r=n.villageoisPowers.length>0,l=n.loupPowers.length>0,y=n.secondaryRoles.length>0;if(!r&&!l&&!y)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const c=({active:T,payload:W})=>{if(T&&W&&W.length>0){const D=W[0].payload,M=D.gamesWithoutRoleChange<D.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:D.name})}),e.jsxs("div",{children:["Apparitions: ",D.appearances]}),M&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",D.appearances-D.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",D.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",D.winRate,"%"]})}),D.totalGamesAllModes&&D.totalGamesAllModes!==D.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",D.totalGamesAllModes,")"]}),D.roleBreakdown&&D.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),D.roleBreakdown.map((z,E)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",z.role,": ",z.count]},E))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},b=(T,W,D,M,z)=>{const E=i==="appearances"?"appearances":"winRateDisplay",F=i==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",L=i==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:W}),e.jsx(Y,{title:W,children:t=>{const I=a(t?null:15)[T];return e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:I,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14,tick:({x:S,y:x,payload:g})=>e.jsx("text",{x:S,y:x,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:14,fontStyle:"italic",transform:`rotate(-45 ${S} ${x})`,children:g.value})}),e.jsx(X,{label:{value:F,angle:270,position:"left",style:{textAnchor:"middle"}},domain:L}),e.jsx(H,{content:e.jsx(c,{})}),e.jsx(O,{dataKey:E,label:i==="winRate"?S=>{const{x,y:g,width:N,payload:v}=S;if(x===void 0||g===void 0||N===void 0||!v)return null;const P=v.winRate||"0";return e.jsxs("text",{x:x+N/2,y:g-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[P,"%"]})}:void 0,shape:S=>{const{x,y:g,width:N,height:v,payload:P,index:R}=S,$=P,B=z?z($.name,R??0):D;return e.jsx(ee,{x,y:g,width:N,height:v,fill:B,onClick:()=>M($.name),style:{cursor:"pointer"}})}})]})})})}})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:i,onChange:T=>o(T.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[r&&b("villageoisPowers","Camp Villageois","var(--chart-color-1)",T=>{p({selectedPlayer:s,campFilter:{selectedCamp:"Villageois",campFilterMode:i==="winRate"?"wins-only":"all-assignments"},selectedPower:T,fromComponent:`Historique des RÃ´les - Pouvoir: ${T}`})},T=>T==="Chasseur"&&j.Chasseur?j.Chasseur:T==="Alchimiste"&&j.Alchimiste?j.Alchimiste:T==="Protecteur"&&j.Protecteur?j.Protecteur:T==="Disciple"&&j.Disciple?j.Disciple:T==="Inquisiteur"&&j.Inquisiteur?j.Inquisiteur:"var(--chart-color-1)"),l&&b("loupPowers","Camp Loups","var(--chart-color-2)",T=>{p({selectedPlayer:s,campFilter:{selectedCamp:"Loup",campFilterMode:i==="winRate"?"wins-only":"all-assignments"},selectedPower:T,fromComponent:`Historique des RÃ´les - Pouvoir: ${T}`})},()=>j.Loup||"var(--chart-color-2)"),y&&b("secondaryRoles","RÃ´les Secondaires","var(--chart-color-3)",T=>{p({selectedPlayer:s,selectedSecondaryRole:T,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${T}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}const we=["UseGadget","DrinkPotion"],ht={UseGadget:"Utilisation Gadget",DrinkPotion:"Potion bue"},gt={UseGadget:"var(--chart-color-1, #8884d8)",DrinkPotion:"var(--chart-color-3, #ffc658)"};function xt({selectedPlayerName:s}){const{gameData:p}=he(),f=k.useMemo(()=>{if(!p||!s)return{actionTypeCounts:[],gadgetDetails:[],potionDetails:[],totalGamesWithActions:0,totalGamesPlayed:0};const j={UseGadget:0,DrinkPotion:0},i={},h={};let d=0,u=0;p.forEach(n=>{const r=n.PlayerStats.find(c=>c.Username.toLowerCase()===s.toLowerCase());if(!r)return;u++;let l=!1;(r.Actions||[]).forEach(c=>{const b=c.ActionType;we.includes(b)&&(j[b]++,l=!0,b==="UseGadget"&&c.ActionName&&c.ActionName!=="Balle"&&(i[c.ActionName]=(i[c.ActionName]||0)+1),b==="DrinkPotion"&&c.ActionName&&(h[c.ActionName]=(h[c.ActionName]||0)+1))}),l&&d++});const m=we.filter(n=>j[n]>0).map(n=>({actionType:n,label:ht[n],count:j[n],color:gt[n]})).sort((n,r)=>r.count-n.count),o=Object.entries(i).map(([n,r])=>({gadgetName:n,count:r})).sort((n,r)=>r.count-n.count).slice(0,ie.TOP_10),a=Object.entries(h).map(([n,r])=>({potionName:n,count:r})).sort((n,r)=>r.count-n.count).slice(0,ie.TOP_10);return{actionTypeCounts:m,gadgetDetails:o,potionDetails:a,totalGamesWithActions:d,totalGamesPlayed:u}},[p,s]);return f.actionTypeCounts.length>0?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",style:{width:"100%",flexBasis:"100%"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ® Parties avec actions"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:f.totalGamesWithActions}),e.jsxs("p",{children:["sur ",f.totalGamesPlayed," parties analysÃ©es"]})]}),f.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ”§ Gadgets utilisÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:f.gadgetDetails.reduce((j,i)=>j+i.count,0)}),e.jsxs("p",{children:[f.gadgetDetails.length," types diffÃ©rents"]})]}),f.potionDetails.length>0&&e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ§ª Potions bues"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:f.potionDetails.reduce((j,i)=>j+i.count,0)}),e.jsxs("p",{children:[f.potionDetails.length," types diffÃ©rents"]})]})]}),f.gadgetDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Gadgets UtilisÃ©s"}),e.jsx(Y,{title:"Gadgets UtilisÃ©s",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:f.gadgetDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"gadgetName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12,tick:({x:j,y:i,payload:h})=>e.jsx("text",{x:j,y:i,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,fontStyle:"italic",transform:`rotate(-45 ${j} ${i})`,children:h.value})}),e.jsx(X,{label:{value:"Utilisations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:j,payload:i})=>{if(j&&i&&i.length>0){const h=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:h.gadgetName})}),e.jsxs("div",{children:["UtilisÃ© ",h.count," fois"]})]})}return null}}),e.jsx(O,{dataKey:"count",fill:"var(--chart-color-1)",shape:j=>{const{x:i,y:h,width:d,height:u,index:m}=j,o=`hsl(${200+(m??0)*20}, 70%, 50%)`;return e.jsx(ee,{x:i,y:h,width:d,height:u,fill:o})}})]})})})})]}),f.potionDetails.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Potions Bues"}),e.jsx(Y,{title:"Potions Bues",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:f.potionDetails,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"potionName",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12,tick:({x:j,y:i,payload:h})=>e.jsx("text",{x:j,y:i,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,fontStyle:"italic",transform:`rotate(-45 ${j} ${i})`,children:h.value})}),e.jsx(X,{label:{value:"Consommations",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:j,payload:i})=>{if(j&&i&&i.length>0){const h=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:h.potionName})}),e.jsxs("div",{children:["Bue ",h.count," fois"]})]})}return null}}),e.jsx(O,{dataKey:"count",fill:"var(--chart-color-3)",shape:j=>{const{x:i,y:h,width:d,height:u,index:m}=j,o=`hsl(${40+(m??0)*15}, 80%, 55%)`;return e.jsx(ee,{x:i,y:h,width:d,height:u,fill:o})}})]})})})})]})]}):e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune donnÃ©e d'actions disponible pour ",s,"."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es d'actions (gadgets, potions) ne sont disponibles que pour les parties rÃ©centes."})]})}function ft({selectedPlayerName:s}){const{gameData:p}=he(),{joueursData:f}=ue(),C=oe(),j=ge(f),i=k.useMemo(()=>{if(!p||!s)return{hunterTargets:[],hunterMissedShots:0,hunterTotalShots:0,transformCount:0,untransformCount:0,transformationsPerGame:0,totalGamesWithActions:0,totalGamesPlayed:0,totalNightsAsWolf:0,transformsPerNight:0};const d={};let u=0,m=0,o=0,a=0,n=0,r=0;p.forEach(D=>{const M=D.PlayerStats.find(t=>t.Username.toLowerCase()===s.toLowerCase());if(!M)return;n++;let z=!1;const E=D.Modded&&$e(D.Version||"0","0.243");let F=!1;if(E)F=!0;else{const A=(M.Actions||[]).some(S=>S.ActionType==="Transform"||S.ActionType==="Untransform"),I=M.LegacyActionsIncomplete===!0;F=A&&!I}if(_e(M.MainRoleInitial)&&F){const t=Ue(M.DeathTiming,D.EndTiming);r+=t}(M.Actions||[]).forEach(t=>{t.ActionType==="HunterShoot"?(o++,z=!0,t.ActionTarget&&(d[t.ActionTarget]=(d[t.ActionTarget]||0)+1)):t.ActionType==="Transform"?(u++,z=!0):t.ActionType==="Untransform"&&(m++,z=!0)}),z&&a++});const l=Object.entries(d).map(([D,M])=>({target:D,count:M})).sort((D,M)=>M.count-D.count).slice(0,ie.TOP_10),y=Object.values(d).reduce((D,M)=>D+M,0),c=o-y,b=u>0?Math.max(1,p.filter(D=>{const M=D.PlayerStats.find(E=>E.Username.toLowerCase()===s.toLowerCase());return M?(M.Actions||[]).some(E=>E.ActionType==="Transform"):!1}).length):0,T=b>0?u/b:0,W=r>0?u/r:0;return{hunterTargets:l,hunterMissedShots:c,hunterTotalShots:o,transformCount:u,untransformCount:m,transformationsPerGame:T,totalGamesWithActions:a,totalGamesPlayed:n,totalNightsAsWolf:r,transformsPerNight:W}},[p,s]);return i.hunterTotalShots>0||i.transformCount>0||i.untransformCount>0?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[i.hunterTotalShots>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Statistiques du Chasseur"}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"âœ… Tirs rÃ©ussis"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:C.Chasseur||"var(--chart-color-2)"},children:i.hunterTotalShots-i.hunterMissedShots}),e.jsx("p",{children:"cibles touchÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"âŒ Tirs manquÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--text-secondary)"},children:i.hunterMissedShots}),e.jsx("p",{children:"tirs sans cible"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š PrÃ©cision"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:C.Chasseur||"var(--chart-color-2)"},children:[i.hunterTotalShots>0?((i.hunterTotalShots-i.hunterMissedShots)/i.hunterTotalShots*100).toFixed(1):"0","%"]}),e.jsx("p",{children:"taux de rÃ©ussite"})]})]}),i.hunterTargets.length>0&&e.jsx(Y,{title:"Cibles Ã‰liminÃ©es par le Chasseur",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:i.hunterTargets,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"target",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:12,tick:({x:d,y:u,payload:m})=>e.jsx("text",{x:d,y:u,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,fontStyle:"italic",transform:`rotate(-45 ${d} ${u})`,children:m.value})}),e.jsx(X,{label:{value:"Nombre de tirs",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:d,payload:u})=>{if(d&&u&&u.length>0){const m=u[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.target})}),e.jsxs("div",{children:["TuÃ© par le chasseur ",m.count," fois"]})]})}return null}}),e.jsx(O,{dataKey:"count",fill:C.Chasseur||"var(--chart-color-2)",shape:d=>{const{x:u,y:m,width:o,height:a,payload:n,index:r}=d,y=j[n.target]||C.Chasseur||`hsl(${120+(r??0)*15}, 60%, 45%)`;return e.jsx(ee,{x:u,y:m,width:o,height:a,fill:y})}})]})})})})]}),(i.transformCount>0||i.untransformCount>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Habitudes de Transformation (Loup)"}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Ratio"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:(()=>{const d=i.transformCount,u=i.untransformCount;return d===0?"0%":`${(u/d*100).toFixed(0)}%`})()}),e.jsx("p",{children:"dÃ©transformations / transformations"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŒ™ Nuits totales"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:i.totalNightsAsWolf}),e.jsx("p",{children:"nuits vÃ©cues en loup (opportunitÃ©s)"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¯ Ratio / nuit"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:C.Loup||"var(--wolf-color)"},children:i.transformsPerNight.toFixed(2)}),e.jsx("p",{children:"transformations par nuit vÃ©cue"})]})]}),e.jsx(Y,{title:"Statistiques de Transformation",children:e.jsx("div",{style:{height:400},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:[{name:"Statistiques Loup","Nuits vÃ©cues":i.totalNightsAsWolf,Transformations:i.transformCount,DÃ©transformations:i.untransformCount}],margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Q,{dataKey:"name",fontSize:14}),e.jsx(X,{label:{value:"Compte",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(H,{content:({active:d,payload:u})=>!d||!u||u.length===0?null:e.jsx("div",{className:"custom-tooltip",style:{backgroundColor:"var(--bg-primary)",border:"1px solid var(--border-primary)",borderRadius:"4px",padding:"10px"},children:u.map((m,o)=>e.jsxs("div",{style:{color:m.color,marginBottom:"4px"},children:[e.jsxs("strong",{children:[m.name,":"]})," ",m.value]},o))})}),e.jsx(Re,{}),e.jsx(O,{dataKey:"Nuits vÃ©cues",fill:"var(--chart-color-4, #a4de6c)"}),e.jsx(O,{dataKey:"Transformations",fill:C.Loup||"var(--wolf-color)"}),e.jsx(O,{dataKey:"DÃ©transformations",fill:"var(--accent-secondary)"})]})})})})]})]}):e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune donnÃ©e d'actions de rÃ´le disponible pour ",s,"."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es d'actions de rÃ´le (Chasseur, Loup) ne sont disponibles que pour les parties rÃ©centes."})]})}function yt({viewMode:s,setViewMode:p,selectedMap:f,setSelectedMap:C,availableMaps:j,clusterRadius:i,setClusterRadius:h,availableDeathTypes:d,selectedDeathTypes:u,setSelectedDeathTypes:m,deathTypeColors:o,isDeathTypesExpanded:a,setIsDeathTypesExpanded:n}){return e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>p("deaths"),style:{background:s==="deaths"?"var(--accent-primary)":"transparent",color:s==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:s==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"ðŸ’€ Morts"}),e.jsx("button",{type:"button",onClick:()=>p("kills"),style:{background:s==="kills"?"var(--accent-primary)":"transparent",color:s==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:s==="kills"?"bold":"normal",transition:"all 0.2s"},children:"âš”ï¸ Kills"}),e.jsx("button",{type:"button",onClick:()=>p("transformations"),style:{background:s==="transformations"?"var(--accent-primary)":"transparent",color:s==="transformations"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:s==="transformations"?"bold":"normal",transition:"all 0.2s"},children:"ðŸº Transfos"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:f,onChange:r=>C(r.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:j.map(r=>e.jsx("option",{value:r,children:r},r))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:i,onChange:r=>h(parseInt(r.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:i===0?"Aucun":`${i} unitÃ©${i>1?"s":""}`})]}),s!=="transformations"&&e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>n(!a),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:a?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:a?"rotate(90deg)":"rotate(0deg)"},children:"â–¶"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[u.length," / ",d.length," sÃ©lectionnÃ©",u.length>1?"s":""]})]}),a&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),m(d)},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:r=>{r.stopPropagation(),m([])},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:d.map(r=>{const l=u.includes(r),y=o[r]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",background:l?"var(--bg-tertiary)":"transparent",borderRadius:"4px",border:`1px solid ${l?y:"var(--border-color)"}`,cursor:"pointer",transition:"all 0.2s",fontSize:"0.9rem"},onClick:c=>{c.stopPropagation(),m(l?b=>b.filter(T=>T!==r):b=>[...b,r])},children:[e.jsx("input",{type:"checkbox",checked:l,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:y,flexShrink:0}}),e.jsx("span",{children:de(r)})]},r)})})]})]})]})}function vt({zoneAnalysis:s,selectedMap:p,viewMode:f,selectedPlayerName:C,hoveredZone:j,setHoveredZone:i}){return!s||p!=="Village"||f!=="deaths"?null:e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"0rem",padding:"1.5rem",background:"linear-gradient(135deg, var(--bg-secondary) 0%, var(--bg-tertiary) 100%)",borderRadius:"12px",border:"2px solid var(--accent-primary)",boxShadow:"0 4px 12px rgba(0,0,0,0.15)"},children:[e.jsx("h3",{style:{marginTop:0,marginBottom:"1rem",color:"var(--accent-primary)",fontSize:"1.3rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:"ðŸ“Š Analyse par zone (Village)"}),e.jsx("p",{style:{fontSize:"0.95rem",marginBottom:"1rem",color:"var(--text-secondary)",lineHeight:"1.5"},children:"Distribution des morts (selon les types sÃ©lectionnÃ©s) comparÃ©e Ã  la moyenne de tous les joueurs:"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:"1rem"},children:s.zoneStats.map(h=>{const d=h.zone===s.dominantZone&&s.maxDeviation>10;return e.jsxs("div",{onMouseEnter:()=>i(h.zone),onMouseLeave:()=>i(null),style:{padding:"1rem",background:"var(--bg-primary)",borderRadius:"8px",border:j===h.zone?"1px solid var(--accent-primary)":"1px solid var(--border-color)",color:"var(--text-primary)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"0.5rem",fontSize:"0.95rem"},children:h.zone}),e.jsxs("div",{style:{fontSize:"0.85rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[C,": ",e.jsxs("strong",{children:[h.playerPercent.toFixed(1),"%"]})," (",h.playerCount,")"]}),e.jsxs("div",{style:{opacity:.85},children:["Moyenne: ",h.avgPercent.toFixed(1),"%"]}),e.jsxs("div",{style:{marginTop:"0.25rem",color:d?"var(--accent-secondary)":h.deviation>0?"var(--accent-primary)":"var(--text-secondary)",fontWeight:Math.abs(h.deviation)>5?"bold":"normal"},children:[h.deviation>0?"+":"",h.deviation.toFixed(1),"% vs moyenne"]})]})]},h.zone)})}),s.dominantZone&&s.maxDeviation>10&&e.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",fontSize:"0.95rem",color:"var(--accent-primary)",fontWeight:"bold",background:"var(--bg-primary)",borderRadius:"8px",border:"2px solid var(--accent-primary)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("span",{style:{fontSize:"1.5rem"},children:"âš ï¸"}),e.jsxs("span",{children:[C," meurt significativement plus souvent en zone ",s.dominantZone,"(","+"+s.maxDeviation.toFixed(1),"% par rapport Ã  la moyenne)"]})]})]})}function jt({locationData:s,clusteredData:p,viewMode:f,selectedPlayerName:C,selectedMap:j,mapConfig:i,xDomain:h,zDomain:d,hoveredZone:u,getDeathColor:m,handleLocationClick:o}){const a=({active:n,payload:r})=>{if(!n||!r||r.length===0)return null;const l=r[0].payload,y=l.allLocations||[l],c=y.length>1,b=f==="transformations";if(c){const W=new Map,D=new Map,M=new Set,z=new Map;y.forEach(t=>{if(W.set(t.victimName,(W.get(t.victimName)||0)+1),b)z.set(t.camp,(z.get(t.camp)||0)+1);else{const A=t.deathType?de(t.deathType):"Inconnu";D.set(A,(D.get(A)||0)+1)}M.add(t.gameId)});const E=Array.from(W.entries()).sort((t,A)=>A[1]-t[1]).slice(0,3),F=Array.from(D.entries()).sort((t,A)=>A[1]-t[1]).slice(0,3),L=Array.from(z.entries()).sort((t,A)=>A[1]-t[1]);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[b?"ðŸº":f==="deaths"?"ðŸ’€":"âš”ï¸"," ",y.length," ",b?"transformations":f==="deaths"?"morts":"kills"," Ã  cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[b?e.jsx(e.Fragment,{children:e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Camps loup:"}),L.map(([t,A])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",A,"Ã—)"]},t))]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:f==="deaths"?"Victimes:":"Kills sur:"}),E.map(([t,A])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",A,"Ã—)"]},t))]}),e.jsxs("div",{style:{marginBottom:"4px"},children:[e.jsx("strong",{children:"Types de mort:"}),F.map(([t,A])=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",t," (",A,"Ã—)"]},t))]})]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["ðŸ“ ",M.size," partie",M.size>1?"s":""," diffÃ©rente",M.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const T=y[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[b?"ðŸº":f==="deaths"?"ðŸ’€":"âš”ï¸"," ",b?"Transformation de":f==="deaths"?"Mort de":"Kill de"," ",C]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[b?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ‘¤ ",e.jsx("strong",{children:"Joueur:"})," ",T.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp loup:"})," ",T.camp]}),e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",T.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",T.gameId]})]}):f==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Victime:"})," ",T.victimName]}),e.jsxs("div",{children:["âš”ï¸ ",e.jsx("strong",{children:"Tueur:"})," ",T.killerName||"Inconnu"]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",T.deathType?de(T.deathType):"Inconnu"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Victime:"})," ",T.victimName]}),e.jsxs("div",{children:["ðŸ•ï¸ ",e.jsx("strong",{children:"Camp victime:"})," ",T.camp]}),e.jsxs("div",{children:["ðŸ’€ ",e.jsx("strong",{children:"Type:"})," ",T.deathType?de(T.deathType):"Inconnu"]})]}),!b&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",T.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",T.gameId]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})};return e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:s.length>0?e.jsx(Y,{title:f==="deaths"?`Carte des Morts de ${C}`:`Carte des Kills de ${C}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Ye,{margin:{top:20,right:30,left:60,bottom:20},children:[i&&e.jsx(ae,{x1:i.zMin,x2:i.zMax,y1:i.xMin,y2:i.xMax,fill:"transparent",stroke:"none",shape:n=>{const{x:r,y:l,width:y,height:c}=n;return e.jsx("image",{x:r,y:l,width:y,height:c,href:i.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),j==="Village"&&u&&e.jsxs(e.Fragment,{children:[u==="Ruines"&&e.jsx(ae,{x1:-220,x2:200,y1:100,y2:450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),u==="Village Principal"&&e.jsx(ae,{x1:-250,x2:100,y1:-120,y2:-450,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),u==="Ferme"&&e.jsx(ae,{x1:-550,x2:-250,y1:150,y2:-150,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),u==="Village PÃªcheur"&&e.jsx(ae,{x1:150,x2:500,y1:80,y2:-320,fill:"var(--accent-primary)",fillOpacity:.2,stroke:"var(--accent-primary)",strokeWidth:3,strokeDasharray:"5 5"}),u==="Reste de la Carte"&&e.jsx(ae,{x1:i?.zMin??-600,x2:i?.zMax??600,y1:i?.xMin??-500,y2:i?.xMax??500,fill:"var(--accent-primary)",fillOpacity:.15,stroke:"var(--accent-primary)",strokeWidth:2,strokeDasharray:"5 5"})]}),e.jsx(J,{strokeDasharray:"3 3",stroke:i?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(Q,{dataKey:"z",type:"number",name:"Position Z",domain:d,hide:!0}),e.jsx(X,{dataKey:"x",type:"number",name:"Position X",domain:h,hide:!0}),e.jsx(H,{content:e.jsx(a,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Je,{data:p,style:{cursor:"pointer"},isAnimationActive:!1,shape:n=>{const{cx:r,cy:l,payload:y}=n,c=y,b=Math.min(Math.log2(c.count+1)*3+5,18),T=Math.round(b);return e.jsx("circle",{cx:r,cy:l,r:T,fill:m(c.deathType,c.camp),stroke:c.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:c.count>1?2:1,opacity:.85,onClick:()=>o(c)})}})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:f==="deaths"?`Aucune mort localisÃ©e pour ${C} sur cette carte.`:f==="kills"?`Aucun kill localisÃ© pour ${C} sur cette carte.`:`Aucune transformation en loup localisÃ©e pour ${C} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes."})]})})}function Ne(s,p){return p>=-250&&p<=100&&s>=-450&&s<=-120?"Village Principal":p>=-550&&p<=-250&&s>=-150&&s<=150?"Ferme":p>=150&&p<=500&&s>=-320&&s<=80?"Village PÃªcheur":p>=-220&&p<=200&&s>=100&&s<=450?"Ruines":"Reste de la Carte"}function le(s){return s==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":s}function bt({selectedPlayerName:s}){const{navigateToGameDetails:p}=ne(),{gameData:f,isLoading:C,error:j}=he(),i=oe(),[h,d]=k.useState("deaths"),[u,m]=k.useState(""),[o,a]=k.useState(0),[n,r]=k.useState(null),[l,y]=k.useState([]),[c,b]=k.useState(!1),{data:T}=xe(s,"Tous les camps"),W=k.useMemo(()=>{if(!f)return[];const N=new Set;return f.forEach(v=>{const P=v.PlayerStats.find(R=>R.Username.toLowerCase()===s.toLowerCase());P&&(P.DeathPosition!==null&&v.MapName&&N.add(v.MapName),v.PlayerStats.forEach(R=>{R.KillerName?.toLowerCase()===s.toLowerCase()&&R.DeathPosition!==null&&v.MapName&&N.add(v.MapName)}),P.Actions&&Array.isArray(P.Actions)&&P.Actions.some(R=>R.ActionType==="Transform")&&v.MapName&&N.add(v.MapName))}),Array.from(N).filter(v=>v==="Village"||v==="ChÃ¢teau").sort((v,P)=>v==="Village"?-1:P==="Village"?1:v.localeCompare(P))},[f,s]),D=W.length>0?W[0]:"";u===""&&D!==""&&m(D);const{availableDeathTypes:M,deathTypeColors:z}=k.useMemo(()=>{if(!f||!s)return{availableDeathTypes:[],deathTypeColors:{}};const N=new Set,v={};return f.forEach(P=>{const R=P.PlayerStats.find($=>$.Username.toLowerCase()===s.toLowerCase());if(R){if(R.DeathPosition&&R.DeathType){const $=le(R.DeathType);$&&N.add($)}P.PlayerStats.forEach($=>{if($.KillerName?.toLowerCase()===s.toLowerCase()&&$.DeathPosition&&$.DeathType){const B=le($.DeathType);B&&N.add(B)}})}}),N.forEach(P=>{v[P]=Qe(P,i)}),{availableDeathTypes:Array.from(N).sort(),deathTypeColors:v}},[f,s,i]),E=(N,v)=>h==="transformations"&&v?i[v]||"var(--text-secondary)":N&&z[N]||"var(--text-secondary)";k.useEffect(()=>{if(l.length===0&&M.length>0){const N=M.filter(v=>v!=="VOTED");y(N)}},[M.length]);const F=k.useMemo(()=>{if(!f||!s)return[];const N=[];return f.forEach(v=>{if(u&&v.MapName!==u)return;const P=v.PlayerStats.find(R=>R.Username.toLowerCase()===s.toLowerCase());if(P)if(h==="deaths"){if(P.DeathPosition){const R=ce(P.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),$=me(P.DeathPosition.x,P.DeathPosition.z,v.MapName);N.push({x:$.x,z:$.z,victimName:P.Username,killerName:P.KillerName||null,deathType:le(P.DeathType),mapName:v.MapName,camp:R,gameId:v.DisplayedId,displayedGameId:v.DisplayedId})}}else h==="kills"?v.PlayerStats.forEach(R=>{if(R.KillerName?.toLowerCase()===s.toLowerCase()&&R.DeathPosition){const $=ce(R.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),B=me(R.DeathPosition.x,R.DeathPosition.z,v.MapName);N.push({x:B.x,z:B.z,victimName:R.Username,killerName:s,deathType:le(R.DeathType),mapName:v.MapName,camp:$,gameId:v.DisplayedId,displayedGameId:v.DisplayedId})}}):h==="transformations"&&P.Actions&&Array.isArray(P.Actions)&&P.Actions.forEach(R=>{if(R.ActionType==="Transform"&&R.Position){const $=ce(P.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),B=me(R.Position.x,R.Position.z,v.MapName);N.push({x:B.x,z:B.z,victimName:P.Username,killerName:null,deathType:null,mapName:v.MapName,camp:$,gameId:v.DisplayedId,displayedGameId:v.DisplayedId})}})}),h!=="transformations"&&l.length>0&&l.length<M.length?N.filter(v=>v.deathType&&l.includes(v.deathType)):N},[f,s,h,u,l,M]),L=k.useMemo(()=>{if(u!=="Village"||h!=="deaths"||F.length===0)return null;const N={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};if(F.forEach(V=>{const G=Ne(V.x,V.z);N[G]=(N[G]||0)+1}),!f)return null;const v={"Village Principal":0,Ferme:0,"Village PÃªcheur":0,Ruines:0,"Reste de la Carte":0};f.forEach(V=>{V.MapName==="Village"&&V.PlayerStats.forEach(G=>{if(!G.DeathPosition)return;const _=le(G.DeathType);if(l.length>0&&l.length<M.length&&(!_||!l.includes(_)))return;const U=me(G.DeathPosition.x,G.DeathPosition.z,"Village"),fe=Ne(U.x,U.z);v[fe]=(v[fe]||0)+1})});const P=Object.values(v).reduce((V,G)=>V+G,0),R=Object.values(N).reduce((V,G)=>V+G,0);if(P===0||R===0)return null;const $=["Village Principal","Village PÃªcheur","Ferme","Ruines","Reste de la Carte"];let B=0,w=null;const q=$.map(V=>{const G=N[V]/R*100,_=v[V]/P*100,U=G-_;return U>B&&N[V]>=2&&(B=U,w=V),{zone:V,playerCount:N[V],playerPercent:G,avgPercent:_,deviation:U}});return{totalPlayerDeaths:R,totalAllDeaths:P,zoneStats:q,dominantZone:w,maxDeviation:B}},[F,u,h,f,l,M]),t=k.useMemo(()=>Xe(F,o).map((v,P)=>{const R=v.items[0],$=Ze(v.items);return{x:v.centroidX,z:v.centroidZ,count:v.items.length,allLocations:v.items,victimName:v.items.length===1?R.victimName:null,killerName:v.items.length===1?R.killerName:null,deathType:$,mapName:R.mapName,camp:R.camp,gameId:v.items.length===1?R.gameId:null,displayedGameId:v.items.length===1?R.displayedGameId:null,clusterIndex:P}}),[F,o]),A=k.useMemo(()=>et(u),[u]),{xDomain:I,zDomain:S}=k.useMemo(()=>{if(A)return{xDomain:[A.xMin,A.xMax],zDomain:[A.zMin,A.zMax]};if(t.length===0)return{xDomain:[0,100],zDomain:[0,100]};const N=t.map(V=>V.x),v=t.map(V=>V.z),P=Math.min(...N),R=Math.max(...N),$=Math.min(...v),B=Math.max(...v),w=(R-P)*.1||10,q=(B-$)*.1||10;return{xDomain:[P-w,R+w],zDomain:[$-q,B+q]}},[t,A]),x=N=>{if(!N)return;const v=N.allLocations||[N];if(v.length===1)p({selectedGame:v[0].gameId,fromComponent:"Player Death Map"});else{const P=v.map(R=>R.gameId).filter(R=>R);p({selectedGameIds:P,fromComponent:"Player Death Map"})}},g=k.useMemo(()=>{if(!T?.mapStats||!u)return null;const N=T.mapStats[u];return N?{winRate:N.winRate,wins:N.wins,total:N.appearances}:null},[T,u]);return C?e.jsx("div",{className:"donnees-attente",children:"Chargement des donnÃ©es..."}):j?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",j]}):f?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsx(yt,{viewMode:h,setViewMode:d,selectedMap:u,setSelectedMap:m,availableMaps:W,clusterRadius:o,setClusterRadius:a,availableDeathTypes:M,selectedDeathTypes:l,setSelectedDeathTypes:y,deathTypeColors:z,isDeathTypesExpanded:c,setIsDeathTypesExpanded:b}),e.jsx(jt,{locationData:F,clusteredData:t,viewMode:h,selectedPlayerName:s,selectedMap:u,mapConfig:A,xDomain:I,zDomain:S,hoveredZone:n,getDeathColor:E,handleLocationClick:x}),e.jsx(vt,{zoneAnalysis:L,selectedMap:u,viewMode:h,selectedPlayerName:s,hoveredZone:n,setHoveredZone:r}),g&&e.jsxs("div",{style:{flex:"1 1 100%",textAlign:"center",padding:"0.75rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)",marginTop:"1rem"},children:[e.jsxs("span",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginRight:"1rem"},children:["Taux de victoire sur ",e.jsx("strong",{children:u})," :"]}),e.jsxs("span",{style:{fontSize:"1.1rem",fontWeight:"bold",color:parseFloat(g.winRate)>=50?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[g.winRate,"%"]}),e.jsxs("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginLeft:"0.5rem"},children:["(",g.wins," / ",g.total," victoires)"]})]}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"Ã€ propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",h==="deaths"?`les emplacements oÃ¹ ${s} est mort`:h==="kills"?`les emplacements oÃ¹ ${s} a Ã©liminÃ© d'autres joueurs`:`les emplacements oÃ¹ ${s} s'est transformÃ© en loup`," au cours des parties.",h!=="transformations"&&"Les couleurs indiquent le type de mort."," Cliquez sur un point pour voir les dÃ©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroupÃ©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’€ Morts:"})," OÃ¹ le joueur a Ã©tÃ© Ã©liminÃ©",e.jsx("br",{}),e.jsx("strong",{children:"âš”ï¸ Kills:"})," OÃ¹ le joueur a Ã©liminÃ© d'autres joueurs",e.jsx("br",{}),e.jsx("strong",{children:"ðŸº Transformations:"})," OÃ¹ le joueur s'est transformÃ© en loup"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function ke(s){return s.PlayerStats.some(p=>p.SecondsTalkedOutsideMeeting>0||p.SecondsTalkedDuringMeeting>0)}function ye(s,p){const f=p.DeathDateIrl||s.EndDate,C=Pe(s.StartDate,f);return C&&C>0?C:0}function Ct(s){const p=s.filter(ke),f=new Map;return p.forEach(C=>{C.PlayerStats.forEach(j=>{const i=te(j),h=Le(j),d=ye(C,j);if(d<=0)return;f.has(i)||f.set(i,{displayName:h,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const u=f.get(i);u.gamesPlayed++,u.totalSecondsAll+=(j.SecondsTalkedOutsideMeeting||0)+(j.SecondsTalkedDuringMeeting||0),u.totalGameDuration+=d})}),{playerStats:f,gamesWithTalkingData:p.length}}function St(s,p){if(!p||p.length===0||!s)return null;const f=Ct(p),C=p.filter(ke);if(C.length===0||f.playerStats.size===0)return null;let j=null;for(const[x,g]of f.playerStats)if(g.displayName===s){j=x;break}if(!j)return null;let i=0,h=0,d=0,u=0;const m={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},o=new Map;let a=0,n=0,r=0,l=0;if(C.forEach(x=>{const g=x.PlayerStats.find(q=>te(q)===j);if(!g)return;const N=ye(x,g);if(N<=0)return;i++;const v=g.SecondsTalkedOutsideMeeting||0,P=g.SecondsTalkedDuringMeeting||0,R=v+P;h+=v,d+=P,u+=N;const $=qe(g.MainRoleInitial,g.Power);m[$].gamesPlayed++,m[$].secondsOutside+=v,m[$].secondsDuring+=P,m[$].gameDuration+=N;const B=He(g);o.has(B)||o.set(B,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const w=o.get(B);w.gamesPlayed++,w.totalSecondsAll+=R,w.totalGameDuration+=N}),i===0||u<=0)return null;const y=3600/u,c=h*y,b=d*y,T=(h+d)*y,W=h+d>0?d/(h+d)*100:0,D=[];for(const[x,g]of Object.entries(m)){if(g.gamesPlayed===0)continue;const N=g.gameDuration>0?3600/g.gameDuration:0,v=g.secondsOutside+g.secondsDuring;D.push({camp:x,gamesPlayed:g.gamesPlayed,totalSecondsOutside:g.secondsOutside,totalSecondsDuring:g.secondsDuring,totalSecondsAll:v,totalGameDurationSeconds:g.gameDuration,secondsOutsidePer60Min:g.secondsOutside*N,secondsDuringPer60Min:g.secondsDuring*N,secondsAllPer60Min:v*N,meetingRatio:v>0?g.secondsDuring/v*100:0})}D.sort((x,g)=>g.gamesPlayed-x.gamesPlayed);const M=Array.from(o.entries()).filter(([x,g])=>g.gamesPlayed>=1).map(([x,g])=>({role:x,gamesPlayed:g.gamesPlayed,secondsAllPer60Min:g.totalGameDuration>0?g.totalSecondsAll/g.totalGameDuration*3600:0,totalSecondsAll:g.totalSecondsAll})).sort((x,g)=>g.secondsAllPer60Min-x.secondsAllPer60Min),z=[];for(const[x,g]of f.playerStats)g.totalGameDuration>0&&z.push({id:x,name:g.displayName,per60:g.totalSecondsAll/g.totalGameDuration*3600});z.sort((x,g)=>g.per60-x.per60);const E=z.reduce((x,g)=>x+g.per60,0),F=z.length>0?E/z.length:0,L=z.findIndex(x=>x.id===j)+1,t=z.length,A=t>0?Math.round((1-(L-1)/t)*100):0,I=T;C.forEach(x=>{const g=x.PlayerStats.find(R=>te(R)===j);if(!g)return;const N=ye(x,g);if(N<=0)return;((g.SecondsTalkedOutsideMeeting||0)+(g.SecondsTalkedDuringMeeting||0))/N*3600>=I?(a++,g.Victorious&&n++):(r++,g.Victorious&&l++)});const S={gamesAboveAverage:a,winsAboveAverage:n,winRateAboveAverage:a>0?n/a*100:0,gamesBelowAverage:r,winsBelowAverage:l,winRateBelowAverage:r>0?l/r*100:0};return{playerName:s,gamesPlayed:i,gamesWithTalkingData:f.gamesWithTalkingData,totalSecondsOutside:h,totalSecondsDuring:d,totalSecondsAll:h+d,totalGameDurationSeconds:u,secondsOutsidePer60Min:c,secondsDuringPer60Min:b,secondsAllPer60Min:T,meetingRatio:W,campBreakdown:D,globalAverageSecondsAllPer60Min:F,playerRank:L,totalPlayersWithData:t,percentile:A,roleBreakdown:M,winCorrelation:S}}function wt(s,p){return s?s.roleBreakdown.slice(0,p):[]}function Nt(s){const{data:p,isLoading:f,error:C}=ve(j=>s?St(s,j):null);return{data:p,isLoading:f,error:C}}function Tt({selectedPlayerName:s}){const{data:p,isLoading:f,error:C}=Nt(s),j=oe(),[i,h]=k.useState("both"),d=k.useMemo(()=>p?.campBreakdown?p.campBreakdown.map(r=>({camp:r.camp,"Hors rÃ©union":Math.round(r.secondsOutsidePer60Min),"En rÃ©union":Math.round(r.secondsDuringPer60Min),total:Math.round(r.secondsAllPer60Min),gamesPlayed:r.gamesPlayed,meetingRatio:r.meetingRatio.toFixed(1)})):[],[p]),u=k.useMemo(()=>p?[{name:"En rÃ©union",value:p.totalSecondsDuring,fill:"#2196F3"},{name:"Hors rÃ©union",value:p.totalSecondsOutside,fill:"#FF9800"}]:[],[p]);if(f)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(C)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",C]});if(!p)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de temps de parole ne sont disponibles que pour les parties rÃ©centes."})]});const m=p.secondsAllPer60Min-p.globalAverageSecondsAllPer60Min,o=p.globalAverageSecondsAllPer60Min>0?(m/p.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",a=m>0,n=p.winCorrelation.winRateAboveAverage-p.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¤ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:re(p.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:a?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[a?"+":"",o,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",p.playerRank," / ",p.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-p.percentile+1,"% ",p.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“ˆ Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:p.gamesPlayed}),e.jsxs("p",{children:["sur ",p.gamesWithTalkingData," avec donnÃ©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ—£ï¸ Ratio en rÃ©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[p.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),d.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs(Y,{title:"Temps de parole par camp (par 60min de jeu)",children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsx("button",{onClick:()=>h("meeting"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:i==="meeting"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:i==="meeting"?"var(--accent-primary)":"var(--bg-secondary)",color:i==="meeting"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:i==="meeting"?"bold":"normal"},children:"En rÃ©union"}),e.jsx("button",{onClick:()=>h("outside"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:i==="outside"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:i==="outside"?"var(--accent-primary)":"var(--bg-secondary)",color:i==="outside"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:i==="outside"?"bold":"normal"},children:"Hors rÃ©union"}),e.jsx("button",{onClick:()=>h("both"),style:{padding:"0.5rem 1rem",borderRadius:"6px",border:i==="both"?"2px solid var(--accent-primary)":"1px solid var(--border-color)",backgroundColor:i==="both"?"var(--accent-primary)":"var(--bg-secondary)",color:i==="both"?"white":"var(--text-primary)",cursor:"pointer",fontSize:"0.9rem",fontWeight:i==="both"?"bold":"normal"},children:"Les deux"})]}),e.jsx("div",{style:{height:350},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:d,layout:"vertical",children:[e.jsx(J,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(Q,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:r=>`${Math.floor(r/60)}m`}),e.jsx(X,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(H,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(r,l)=>{const y=typeof r=="number"?r:Number(r);return[Number.isNaN(y)?`${r}`:re(y),l]},labelFormatter:r=>{const l=d.find(y=>y.camp===r);return`${r} (${l?.gamesPlayed||0} parties)`}}),e.jsx(Re,{}),(i==="both"||i==="outside")&&e.jsx(O,{dataKey:"Hors rÃ©union",stackId:"talk",fill:"#FF9800"}),(i==="both"||i==="meeting")&&e.jsx(O,{dataKey:"En rÃ©union",stackId:"talk",fill:"#2196F3"})]})})})]}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:(()=>{const r=d.find(b=>b.camp==="Villageois"),l=d.find(b=>b.camp==="Loup");if(!r||!l)return e.jsx("p",{children:"ðŸ’¡ Pas assez de donnÃ©es pour comparer les camps Villageois et Loups."});const y=r.total-l.total,c=l.total>0?(Math.abs(y)/l.total*100).toFixed(0):"0";return y>0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:s})," parle"," ",e.jsxs("strong",{style:{color:je("Villageois")},children:[re(y)," de plus (+",c,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Villageois"})," qu'en tant que"," ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]}):y<0?e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:s})," parle"," ",e.jsxs("strong",{style:{color:je("Loup")},children:[re(Math.abs(y))," de plus (+",c,"%)"]})," ","en tant que ",e.jsx("strong",{children:"Loup"})," qu'en tant que"," ",e.jsx("strong",{children:"Villageois"})," (par heure de jeu)."]}):e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:s})," parle exactement autant en tant que"," ",e.jsx("strong",{children:"Villageois"})," qu'en tant que ",e.jsx("strong",{children:"Loup"})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(Y,{title:"RÃ©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(De,{children:[e.jsx(Ae,{data:u,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:r=>`${r.name}: ${((r.percent||0)*100).toFixed(1)}%`}),e.jsx(H,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:r=>{const l=typeof r=="number"?r:Number(r);return Number.isNaN(l)?`${r}`:re(l)}})]})})})})}),p&&p.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(Y,{title:r=>r?"Top 15 rÃ´les les plus bavards (par 60min)":"Top 5 rÃ´les les plus bavards (par 60min)",children:r=>{const y=wt(p,r?15:5).map(c=>({role:c.role,secondsPer60Min:Math.round(c.secondsAllPer60Min),gamesPlayed:c.gamesPlayed}));return e.jsx("div",{style:{height:r?400:300},children:e.jsx(K,{width:"100%",height:"100%",children:e.jsxs(Z,{data:y,children:[e.jsx(J,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(Q,{dataKey:"role",tick:({x:c,y:b,payload:T})=>e.jsx("text",{x:c,y:b,dy:16,textAnchor:"end",fill:"var(--text-secondary)",fontSize:12,fontStyle:"italic",transform:`rotate(-20 ${c} ${b})`,children:T.value}),interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(X,{tick:{fill:"var(--text-secondary)"},tickFormatter:c=>`${Math.floor(c/60)}m`}),e.jsx(H,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:c=>{const b=typeof c=="number"?c:Number(c);return[Number.isNaN(b)?`${c}`:re(b),"Temps de parole"]},labelFormatter:c=>{const b=y.find(T=>T.role===c);return`${c} (${b?.gamesPlayed||0} parties)`}}),e.jsx(O,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",shape:c=>{const{x:b,y:T,width:W,height:D,payload:M}=c,E=j[M.role]||j.Villageois;return e.jsx(ee,{x:b,y:T,width:W,height:D,fill:E})}})]})})})}})}),(p.winCorrelation.gamesAboveAverage>0||p.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"ðŸŽ¯ CorrÃ©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[p.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",p.winCorrelation.winsAboveAverage,"/",p.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[p.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",p.winCorrelation.winsBelowAverage,"/",p.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(n)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:s})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:n>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[n>0?"supÃ©rieur":"infÃ©rieur"," de ",Math.abs(n).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function Pt({playerTitles:s,titlesLoading:p}){if(p)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des titres..."})]})});if(!s||s.titles.length===0)return e.jsx("div",{className:"titles-section",children:e.jsxs("div",{className:"titles-empty",children:[e.jsx("p",{children:"ðŸ“œ Aucun titre disponible"}),e.jsx("p",{className:"empty-subtitle",children:s?.gamesPlayed?`${s.gamesPlayed} parties jouÃ©es - minimum 25 parties requises pour obtenir des titres`:"Les titres sont gÃ©nÃ©rÃ©s chaque dimanche pour les joueurs avec 25+ parties en mode moddÃ©"})]})});const f=[...s.titles].sort((h,d)=>{const u=s.titles.indexOf(h),o=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(h.category||"")?100-(h.percentile||50):h.percentile||50,a=(h.priority||0)*1e3+o*10-u,n=s.titles.indexOf(d),l=["EXTREME_LOW","LOW","BELOW_AVERAGE"].includes(d.category||"")?100-(d.percentile||50):d.percentile||50;return(d.priority||0)*1e3+l*10-n-a}),C=f.filter(h=>!h.primaryOwner),j=f.filter(h=>h.primaryOwner),i=(h,d)=>{const u=s.primaryTitle?.id===h.id;return e.jsxs("div",{className:`title-card ${h.type} ${u?"primary":""} ${h.primaryOwner?"awarded-elsewhere":""}`,title:`${h.description}${h.percentile!==void 0?`
MeilleurÂ·e que ${h.percentile.toFixed(1)}% des joueurs`:""}`,children:[e.jsx("div",{className:"title-rank",children:d+1}),u&&e.jsx("div",{className:"title-crown",children:"ðŸ‘‘"}),e.jsx("div",{className:"title-emoji",children:h.emoji}),e.jsxs("div",{className:"title-info",children:[e.jsx("div",{className:"title-name",children:h.title}),e.jsx("div",{className:"title-description",children:h.description}),h.percentile!==void 0&&h.type!=="combination"&&e.jsxs("div",{className:"title-percentile",children:["Top ",(100-h.percentile).toFixed(0),"%"]}),e.jsx("div",{className:"title-type-badge",children:h.type==="combination"?"Combo":h.type==="role"?"RÃ´le":"Stat"}),!u&&h.primaryOwner&&e.jsxs("div",{className:"title-primary-owner",children:["ðŸ‘¤ Titre principal de: ",e.jsx("strong",{children:h.primaryOwner})]}),h.type==="combination"&&h.conditions&&h.conditions.length>0&&e.jsxs("div",{className:"title-conditions-breakdown",children:[e.jsx("div",{className:"breakdown-header",children:"Conditions:"}),h.conditions.map((m,o)=>e.jsxs("div",{className:"condition-item",children:[e.jsxs("span",{className:"condition-stat",children:[m.stat==="winRate"?"Victoires":m.stat==="loot"?"RÃ©colte":m.stat==="lootVillageois"?"RÃ©colte (Villageois)":m.stat==="lootLoup"?"RÃ©colte (Loup)":m.stat==="survival"?"Survie":m.stat==="killRate"?"Kills":m.stat==="talking"?"Parole":m.stat==="talkingOutsideMeeting"?"Parole (hors dÃ©bats)":m.stat==="talkingDuringMeeting"?"Parole (meeting)":m.stat==="votingAggressive"?"Vote agressif":m.stat==="votingAccuracy"?"PrÃ©cision vote":m.stat==="votingFirst"?"Vote rapide":m.stat==="survivalDay1"?"Survie J1":m.stat==="winRateVillageois"?"Victoires Villageois":m.stat==="winRateLoup"?"Victoires Loup":m.stat==="winRateSolo"?"Victoires Solo":m.stat==="hunterAccuracy"?"PrÃ©cision cible chasseur":m.stat==="hunterShotAccuracy"?"PrÃ©cision tir chasseur":m.stat==="zoneVillagePrincipal"?"Village Principal":m.stat==="zoneFerme"?"Ferme":m.stat==="zoneVillagePecheur"?"Village PÃªcheur":m.stat==="zoneRuines"?"Ruines":m.stat==="zoneResteCarte"?"Reste de la carte":m.stat==="zoneDominantPercentage"?"Dominance zone":m.stat,":"]}),e.jsx("span",{className:`condition-category ${m.category?.toLowerCase()}`,children:m.category}),m.actualPercentile!==void 0&&e.jsxs("span",{className:"condition-percentile",children:["(Top ",(100-m.actualPercentile).toFixed(0),"%)"]})]},o))]})]})]},h.id)};return e.jsxs("div",{className:"titles-section",children:[e.jsxs("div",{className:"titles-header",children:[e.jsx("h3",{children:"ðŸ·ï¸ Titres actuels"}),e.jsxs("p",{className:"titles-info",children:[s.titles.length," titre",s.titles.length>1?"s":""," â€¢ ",s.gamesPlayed," parties jouÃ©es"]})]}),C.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"titles-subsection-header",children:[e.jsxs("h4",{children:["âœ¨ Vos Titres (",C.length,")"]}),e.jsx("p",{children:"Titres que vous possÃ©dez ou partagez"})]}),e.jsx("div",{className:"titles-grid",children:C.map((h,d)=>i(h,d))})]}),j.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"titles-subsection-header secondary",children:[e.jsxs("h4",{children:["ðŸ–ï¸ Titres QualifiÃ©s (",j.length,")"]}),e.jsx("p",{children:"Vous remplissez les conditions, mais un autre joueur a une meilleure revendication"})]}),e.jsx("div",{className:"titles-grid awarded-elsewhere-grid",children:j.map((h,d)=>i(h,C.length+d))})]})]})}function Jt(){const{settings:s,updateSettings:p}=pe(),{navigateToGameDetails:f,navigationState:C,updateNavigationState:j}=ne(),{data:i,isLoading:h,error:d}=We(),{joueursData:u,isLoading:m}=ue(),{data:o,isLoading:a,error:n}=it(s.highlightedPlayer),{playerData:r,isLoading:l}=ot(s.highlightedPlayer),y=ge(u),[c,b]=k.useState(""),[T,W]=k.useState(null),{clips:D}=tt(s.highlightedPlayer),{clips:M}=st(),[z,E]=k.useState(()=>s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled?s.independentFilters.gameFilter==="modded"?"modded":"all":s.gameFilter==="modded"?"modded":"all"),F=k.useMemo(()=>s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled?s.independentFilters.gameFilter==="modded":s.gameFilter==="modded",[s.useIndependentFilters,s.independentFilters?.gameTypeEnabled,s.independentFilters?.gameFilter,s.gameFilter]),[L,t]=k.useState(s.selectedPlayerSelectionView||C.selectedPlayerSelectionView||"rankings"),[A,I]=k.useState("session"),[S,x]=k.useState("all");k.useEffect(()=>{if(s.useIndependentFilters&&s.independentFilters?.gameTypeEnabled){const w=s.independentFilters.gameFilter==="modded"?"modded":"all";E(w)}else if(!s.useIndependentFilters){const w=s.gameFilter==="modded"?"modded":"all";E(w)}},[s.gameFilter,s.useIndependentFilters,s.independentFilters?.gameTypeEnabled,s.independentFilters?.gameFilter]),k.useEffect(()=>{F&&z!=="modded"&&E("modded")},[F,z]),k.useEffect(()=>{const w=s.selectedPlayerSelectionView||C.selectedPlayerSelectionView;w&&w!==L&&t(w)},[s.selectedPlayerSelectionView,C.selectedPlayerSelectionView]);const{data:g}=xe(s.highlightedPlayer||""),N=k.useMemo(()=>{if(!i||!i.GameStats)return[];const w=F?i.GameStats.filter(V=>V.Modded===!0):i.GameStats,q=new Map;return w.forEach(V=>{const G=new Date(V.StartDate);V.PlayerStats.forEach(_=>{const U=te(_),Me=u?.Players?.find(ze=>ze.SteamID===U)?.Joueur||_.Username;q.has(U)||q.set(U,{games:0,wins:0,firstDate:G,lastDate:G,displayName:Me});const se=q.get(U);se.games++,_.Victorious&&se.wins++,G<se.firstDate&&(se.firstDate=G),G>se.lastDate&&(se.lastDate=G)})}),Array.from(q.entries()).map(([V,G])=>{let _=u?.Players?.find(U=>U.SteamID===V);return _||(_=u?.Players?.find(U=>U.Joueur===G.displayName)),{id:V,name:G.displayName,totalGames:G.games,totalWins:G.wins,winRate:G.games>0?G.wins/G.games*100:0,firstGameDate:G.firstDate.toLocaleDateString("fr-FR"),lastGameDate:G.lastDate.toLocaleDateString("fr-FR"),isHighlighted:G.displayName===s.highlightedPlayer,image:_?.Image||null,twitch:_?.Twitch||null,youtube:_?.Youtube||null}})},[i,s.highlightedPlayer,u,F]),v=k.useMemo(()=>{if(!c.trim())return N;const w=c.toLowerCase();return N.filter(q=>q.name.toLowerCase().includes(w))},[N,c]),P=k.useMemo(()=>[...v].sort((w,q)=>q.totalGames-w.totalGames),[v]),R=w=>{p({highlightedPlayer:w}),b("")},$=w=>{t(w),j({selectedPlayerSelectionView:w}),p({selectedPlayerSelectionView:w,tab:"playerSelection"})},B=()=>{if(D.length===0)return;const w=Math.floor(Math.random()*D.length);W(D[w])};return h||m?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):d?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",d]})]}):!i||N.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!s.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:c,onChange:w=>b(w.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[v.length," joueur",v.length!==1?"s":"",c&&` (filtrÃ©${v.length!==1?"s":""} de ${N.length})`]})]})]}),e.jsx("div",{className:"player-display",children:c?v.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>b(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:P.map(w=>e.jsxs("button",{type:"button",className:`suggestion-btn ${w.isHighlighted?"highlighted":""}`,onClick:()=>R(w.name),children:[w.image?e.jsx("img",{src:w.image,alt:`Photo de profil de ${w.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":y[w.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[w.name,w.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[w.totalGames," parties â€¢ ",w.winRate.toFixed(1),"% victoires"]})]})]},w.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',c,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>b(""),children:"Effacer la recherche"})]}):s.highlightedPlayer?(()=>{const w=N.find(q=>q.name===s.highlightedPlayer);return w?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:w.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[w.image?e.jsx("img",{src:w.image,alt:`Photo de profil de ${w.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":y[w.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[w.totalGames," parties â€¢ ",w.totalWins," victoires â€¢ ",w.winRate.toFixed(1),"% taux de victoire"]}),r?.primaryTitle?e.jsxs("div",{className:"player-primary-title",title:r.primaryTitle.description,style:{marginTop:"0.5rem",display:"inline-flex",alignItems:"center",gap:"0.3rem",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("span",{className:"title-emoji",children:r.primaryTitle.emoji}),e.jsx("span",{className:"title-text",children:r.primaryTitle.title})]}):e.jsx("div",{className:"player-no-title",style:{marginTop:"0.5rem",fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic"},children:"ðŸ“œ 25 parties moddÃ©es minimum pour obtenir un titre"}),(w.twitch||w.youtube||D.length>0)&&e.jsxs("div",{className:"social-links",children:[w.twitch&&e.jsx("a",{href:w.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),w.youtube&&e.jsx("a",{href:w.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"}),D.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:q=>{q.stopPropagation(),B()},title:`${D.length} clip${D.length>1?"s":""} disponible${D.length>1?"s":""}`,children:["ðŸŽ¬ Clip alÃ©atoire (",D.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="rankings"?"active":""}`,onClick:()=>$("rankings"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="titles"?"active":""}`,onClick:()=>$("titles"),children:"Titres"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="evolution"?"active":""}`,onClick:()=>$("evolution"),children:"Ã‰volution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="camps"?"active":""}`,onClick:()=>$("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="roles"?"active":""}`,onClick:()=>$("roles"),children:"RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="actions"?"active":""}`,onClick:()=>$("actions"),children:"Actions"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="roleactions"?"active":""}`,onClick:()=>$("roleactions"),children:"Actions des RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="kills"?"active":""}`,onClick:()=>$("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="deathmap"?"active":""}`,onClick:()=>$("deathmap"),children:"Cartes"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${L==="talkingtime"?"active":""}`,onClick:()=>$("talkingtime"),children:"Parole"})]}),L==="rankings"&&e.jsxs("div",{className:"rankings-section",children:[a?e.jsxs("div",{className:"rankings-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):n?e.jsx("div",{className:"rankings-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",n]})}):o?e.jsx(lt,{rankings:z==="all"?o.allGamesRankings:o.moddedOnlyRankings,title:z==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",rankingType:z}):e.jsx("div",{className:"rankings-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"rankings-filter",children:[!F&&e.jsx("button",{type:"button",className:`filter-btn ${z==="all"?"active":""}`,onClick:q=>{q.stopPropagation(),E("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${z==="modded"?"active":""}`,onClick:q=>{q.stopPropagation(),E("modded")},disabled:F,children:"Parties moddÃ©es"})]})]}),L==="titles"&&e.jsx(Pt,{playerTitles:r,titlesLoading:l}),L==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[g&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{f({selectedPlayer:w.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${w.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:g.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:Ve(g.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{f({selectedPlayer:w.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${w.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:g.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[g.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:A,onChange:q=>I(q.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:S,onChange:q=>x(q.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(ct,{selectedPlayerName:w.name,groupingMethod:A,campFilter:S})]}),L==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(dt,{selectedPlayerName:w.name})}),L==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(pt,{selectedPlayerName:w.name})}),L==="actions"&&e.jsx("div",{className:"player-history-section",children:e.jsx(xt,{selectedPlayerName:w.name})}),L==="roleactions"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ft,{selectedPlayerName:w.name})}),L==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(ut,{selectedPlayerName:w.name})}),L==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(bt,{selectedPlayerName:w.name})}),L==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(Tt,{selectedPlayerName:w.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:q=>{q.stopPropagation(),p({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[w.firstGameDate," - ",w.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',s.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>p({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:P.map(w=>e.jsxs("div",{className:`character-card ${w.isHighlighted?"highlighted":""}`,onClick:()=>R(w.name),title:`${w.name} - ${w.totalGames} parties, ${w.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:w.image?e.jsx("img",{src:w.image,alt:`Photo de profil de ${w.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":y[w.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:w.name}),(w.twitch||w.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[w.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),w.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},w.id))})})}),T&&e.jsx(rt,{clip:T,onClose:()=>W(null),relatedClips:at(T,M),nextClip:Se(T,M),onNextClip:()=>{const w=Se(T,M);w&&W(w)},onRelatedClip:w=>{const q=M.find(V=>V.ClipId===w);q&&W(q)}})]})}export{Jt as PlayerSelectionPage};
