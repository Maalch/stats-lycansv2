import{g as B,a as b}from"./datasyncExport-BirWLS1z.js";import{D as L}from"./deathTypes-gHH1w6_X.js";import{h as x,g as E}from"./index-qBYGe3eS.js";function G(p,V){if(!p.DeathTiming)return!0;const T=p.DeathTiming.toUpperCase();if(T.startsWith("M")){const r=parseInt(T.substring(1));return V<=r}if(T.startsWith("N")||T.startsWith("J")){const r=parseInt(T.substring(1));return V<r}return!0}function I(p,V){return p.PlayerStats.filter(T=>G(T,V))}function N(p,V,T){const r=p.PlayerStats.find(s=>E(s)===T);return r?r.DeathType===L.VOTED&&r.DeathTiming===`M${V}`:!1}function $(p){const V=[],T=new Map,r=new Map,s=new Map;p.PlayerStats.forEach(i=>{const a=E(i),M=i.Username;T.set(a,{totalMeetings:0,totalVotes:0,totalSkips:0,totalAbstentions:0,displayName:M}),r.set(a,{totalVotes:0,votesForEnemyCamp:0,votesForOwnCamp:0}),s.set(a,{totalTimesTargeted:0,timesTargetedByEnemyCamp:0,timesTargetedByOwnCamp:0,timesTargetedAsVillager:0,timesTargetedAsWolf:0,timesTargetedAsSpecial:0,eliminationsByVote:0})});const u=Math.max(...p.PlayerStats.flatMap(i=>i.Votes.map(a=>a.Day||0)),0);for(let i=1;i<=u;i++){const a=I(p,i),M=p.PlayerStats.flatMap(n=>{const l=E(n);return n.Votes.filter(d=>d.Day===i).map(d=>({voterId:l,voterName:n.Username,vote:d,voterRole:n.MainRoleInitial}))});if(M.length===0&&p.EndTiming===`M${i}`)continue;const c=M.filter(n=>n.vote.Target!=="Passé").length,y=M.filter(n=>n.vote.Target==="Passé").length,e=a.length-M.length,t=new Map;M.filter(n=>n.vote.Target!=="Passé").forEach(n=>{const l=t.get(n.vote.Target)||0;t.set(n.vote.Target,l+1)});let o=null,g=0;for(const[n,l]of t.entries())l>g&&(o=n,g=l);let h=null;if(o&&g>0){const n=p.PlayerStats.find(l=>l.Username===o);if(n){const l=E(n);N(p,i,l)&&(h=n.Username)}}V.push({meetingNumber:i,totalParticipants:a.length,totalVotes:c,totalSkips:y,totalAbstentions:e,participationRate:a.length>0?(c+y)/a.length*100:0,mostTargetedPlayer:o,mostTargetedCount:g,eliminatedPlayer:h}),a.forEach(n=>{const l=E(n),d=T.get(l);d.totalMeetings++,d.displayName=n.Username;const F=M.find(R=>R.voterId===l);if(F)if(F.vote.Target==="Passé")d.totalSkips++;else{d.totalVotes++;const R=r.get(l);R.totalVotes++;const P=B(b(n.MainRoleInitial,n.MainRoleChanges||[]),{regroupWolfSubRoles:!0}),f=p.PlayerStats.find(C=>C.Username===F.vote.Target);if(f){const C=E(f),O=B(b(f.MainRoleInitial,f.MainRoleChanges||[]),{regroupWolfSubRoles:!0});P===O?R.votesForOwnCamp++:R.votesForEnemyCamp++;const v=s.get(C);v.totalTimesTargeted++,P===O?v.timesTargetedByOwnCamp++:v.timesTargetedByEnemyCamp++;const w=b(f.MainRoleInitial,f.MainRoleChanges||[]),k=B(w,{regroupWolfSubRoles:!0});k==="Villageois"?v.timesTargetedAsVillager++:k==="Loup"?v.timesTargetedAsWolf++:v.timesTargetedAsSpecial++,N(p,i,C)&&v.eliminationsByVote++}}else d.totalAbstentions++})}const m=[],S=[],A=[];return p.PlayerStats.forEach(i=>{const a=E(i),M=i.Username,c=T.get(a),y=c.totalMeetings>0?c.totalVotes/c.totalMeetings*100:0,e=c.totalMeetings>0?c.totalSkips/c.totalMeetings*100:0,t=c.totalMeetings>0?c.totalAbstentions/c.totalMeetings*100:0,o=y-e*.5-t*.7;m.push({playerName:M,totalMeetings:c.totalMeetings,totalVotes:c.totalVotes,totalSkips:c.totalSkips,totalAbstentions:c.totalAbstentions,votingRate:y,skippingRate:e,abstentionRate:t,aggressivenessScore:o});const g=r.get(a),h=g.totalVotes>0?g.votesForEnemyCamp/g.totalVotes*100:0,n=g.totalVotes>0?g.votesForOwnCamp/g.totalVotes*100:0;S.push({playerName:M,totalMeetings:c.totalMeetings,totalVotes:g.totalVotes,votesForEnemyCamp:g.votesForEnemyCamp,votesForOwnCamp:g.votesForOwnCamp,accuracyRate:h,friendlyFireRate:n});const l=s.get(a),d=l.totalTimesTargeted>0?(l.totalTimesTargeted-l.eliminationsByVote)/l.totalTimesTargeted*100:100;A.push({playerName:M,totalMeetings:c.totalMeetings,totalTimesTargeted:l.totalTimesTargeted,timesTargetedByEnemyCamp:l.timesTargetedByEnemyCamp,timesTargetedByOwnCamp:l.timesTargetedByOwnCamp,timesTargetedAsVillager:l.timesTargetedAsVillager,timesTargetedAsWolf:l.timesTargetedAsWolf,timesTargetedAsSpecial:l.timesTargetedAsSpecial,eliminationsByVote:l.eliminationsByVote,survivalRate:d})}),{gameId:p.Id,totalMeetings:u,meetingAnalytics:V,playerBehaviors:m,playerAccuracies:S,playerTargetStats:A}}function _(p){const V=new Map;return p.filter(r=>!r.Modded||!r.Version?!1:x(r.Version,"0.201")).forEach(r=>{const s=new Map;r.PlayerStats.forEach(u=>{!u.Votes||u.Votes.length===0||u.Votes.forEach(m=>{if(!m.Date||m.Target==="Passé")return;const S=s.get(m.Day)||[];S.push({playerName:u.Username,date:new Date(m.Date),target:m.Target}),s.set(m.Day,S)})}),s.forEach(u=>{if(u.length===0)return;const m=[...u].sort((A,i)=>A.date.getTime()-i.date.getTime()),S=m[0].date.getTime();m.forEach((A,i)=>{const a=V.get(A.playerName)||{totalActiveVotes:0,totalTimedVotes:0,positionPercentileSum:0,timesFirstVoter:0,timesLastVoter:0,earlyVotes:0,lateVotes:0,voteDelaySum:0};a.totalActiveVotes++,a.totalTimedVotes++;const M=m.length>1?i/(m.length-1)*100:50;a.positionPercentileSum+=M,i===0&&a.timesFirstVoter++,i===m.length-1&&a.timesLastVoter++;const c=Math.ceil(m.length/3),y=m.length-Math.ceil(m.length/3);i<c&&a.earlyVotes++,i>=y&&a.lateVotes++;const e=(A.date.getTime()-S)/1e3;a.voteDelaySum+=e,V.set(A.playerName,a)})})}),Array.from(V.entries()).map(([r,s])=>{const u=s.totalTimedVotes>0?s.positionPercentileSum/s.totalTimedVotes:50,m=s.totalTimedVotes>0?s.earlyVotes/s.totalTimedVotes*100:0,S=s.totalTimedVotes>0?s.lateVotes/s.totalTimedVotes*100:0,A=s.totalTimedVotes>0?s.voteDelaySum/s.totalTimedVotes:0;return{playerName:r,totalActiveVotes:s.totalActiveVotes,totalTimedVotes:s.totalTimedVotes,averageVotePositionPercentile:u,timesFirstVoter:s.timesFirstVoter,timesLastVoter:s.timesLastVoter,earlyVoterRate:m,lateVoterRate:S,averageVoteDelaySeconds:A}})}function j(p){const V=new Map,T=new Map;let r=0,s=0,u=0,m=0,S=0,A=0,i=0,a=0;p.forEach(y=>{const e=Math.max(...y.PlayerStats.flatMap(t=>t.Votes.map(o=>o.Day)),0);if(e!==0)for(let t=1;t<=e;t++){const o=I(y,t),g=y.PlayerStats.flatMap(f=>f.Votes.filter(C=>C.Day===t).map(C=>({voter:f.Username,vote:C,voterStats:f})));if(g.length===0&&y.EndTiming===`M${t}`)continue;const h=g.filter(f=>f.vote.Target!=="Passé").length,n=g.filter(f=>f.vote.Target==="Passé").length,l=o.length-g.length;r++,s+=h,u+=n,m+=l;const d=o.length>0?h/o.length*100:0,F=o.length>0?n/o.length*100:0,R=o.length>0?l/o.length*100:0;S+=d,A+=F,i+=R,a++;const P=V.get(t)||{meetings:0,totalVotingRates:0,totalSkipRates:0,totalAbstentionRates:0};P.meetings++,P.totalVotingRates+=d,P.totalSkipRates+=F,P.totalAbstentionRates+=R,V.set(t,P),g.filter(f=>f.vote.Target!=="Passé").forEach(({voterStats:f,vote:C})=>{const O=b(f.MainRoleInitial,f.MainRoleChanges||[]),v=B(O,{regroupWolfSubRoles:!0}),w=y.PlayerStats.find(U=>U.Username===C.Target);if(!w)return;const k=b(w.MainRoleInitial,w.MainRoleChanges||[]),W=B(k,{regroupWolfSubRoles:!0}),D=T.get(v)||{totalVotes:0,votesForOppositeCamp:0,votesForOwnCamp:0};D.totalVotes++,v===W?D.votesForOwnCamp++:D.votesForOppositeCamp++,T.set(v,D)})}});const M=Array.from(V.entries()).map(([y,e])=>({meetingDay:y,totalMeetings:e.meetings,averageVotingRate:e.meetings>0?e.totalVotingRates/e.meetings:0,averageSkipRate:e.meetings>0?e.totalSkipRates/e.meetings:0,averageAbstentionRate:e.meetings>0?e.totalAbstentionRates/e.meetings:0})).sort((y,e)=>y.meetingDay-e.meetingDay),c=Array.from(T.entries()).map(([y,e])=>({campName:y,totalVotes:e.totalVotes,votesForOppositeCamp:e.votesForOppositeCamp,votesForOwnCamp:e.votesForOwnCamp,accuracyRate:e.totalVotes>0?e.votesForOppositeCamp/e.totalVotes*100:0,friendlyFireRate:e.totalVotes>0?e.votesForOwnCamp/e.totalVotes*100:0})).sort((y,e)=>e.accuracyRate-y.accuracyRate);return{totalMeetings:r,totalVotes:s,totalSkips:u,totalAbstentions:m,averageVotingRate:a>0?S/a:0,averageSkipRate:a>0?A/a:0,averageAbstentionRate:a>0?i/a:0,meetingDayStats:M,campVotingStats:c}}function q(p){const V=p.map($),T=new Map,r=new Map,s=new Map;let u=0,m=0,S=0,A=0,i=0,a=0;V.forEach(e=>{u+=e.totalMeetings,e.meetingAnalytics.forEach(t=>{m+=t.participationRate,S++,A+=t.totalVotes,i+=t.totalSkips,a+=t.totalAbstentions}),e.playerBehaviors.forEach(t=>{const o=T.get(t.playerName)||{totalMeetings:0,totalVotes:0,totalSkips:0,totalAbstentions:0};T.set(t.playerName,{totalMeetings:o.totalMeetings+t.totalMeetings,totalVotes:o.totalVotes+t.totalVotes,totalSkips:o.totalSkips+t.totalSkips,totalAbstentions:o.totalAbstentions+t.totalAbstentions})}),e.playerAccuracies.forEach(t=>{const o=r.get(t.playerName)||{totalMeetings:0,totalVotes:0,votesForEnemyCamp:0,votesForOwnCamp:0};r.set(t.playerName,{totalMeetings:o.totalMeetings+t.totalMeetings,totalVotes:o.totalVotes+t.totalVotes,votesForEnemyCamp:o.votesForEnemyCamp+t.votesForEnemyCamp,votesForOwnCamp:o.votesForOwnCamp+t.votesForOwnCamp})}),e.playerTargetStats.forEach(t=>{const o=s.get(t.playerName)||{totalMeetings:0,totalTimesTargeted:0,timesTargetedByEnemyCamp:0,timesTargetedByOwnCamp:0,timesTargetedAsVillager:0,timesTargetedAsWolf:0,timesTargetedAsSpecial:0,eliminationsByVote:0};s.set(t.playerName,{totalMeetings:o.totalMeetings+t.totalMeetings,totalTimesTargeted:o.totalTimesTargeted+t.totalTimesTargeted,timesTargetedByEnemyCamp:o.timesTargetedByEnemyCamp+t.timesTargetedByEnemyCamp,timesTargetedByOwnCamp:o.timesTargetedByOwnCamp+t.timesTargetedByOwnCamp,timesTargetedAsVillager:o.timesTargetedAsVillager+t.timesTargetedAsVillager,timesTargetedAsWolf:o.timesTargetedAsWolf+t.timesTargetedAsWolf,timesTargetedAsSpecial:o.timesTargetedAsSpecial+t.timesTargetedAsSpecial,eliminationsByVote:o.eliminationsByVote+t.eliminationsByVote})})});const M=Array.from(T.entries()).map(([e,t])=>{const o=t.totalMeetings>0?t.totalVotes/t.totalMeetings*100:0,g=t.totalMeetings>0?t.totalSkips/t.totalMeetings*100:0,h=t.totalMeetings>0?t.totalAbstentions/t.totalMeetings*100:0,n=o-g*.5-h*.7;return{playerName:e,totalMeetings:t.totalMeetings,totalVotes:t.totalVotes,totalSkips:t.totalSkips,totalAbstentions:t.totalAbstentions,votingRate:o,skippingRate:g,abstentionRate:h,aggressivenessScore:n}}),c=Array.from(r.entries()).map(([e,t])=>{const o=t.totalVotes>0?t.votesForEnemyCamp/t.totalVotes*100:0,g=t.totalVotes>0?t.votesForOwnCamp/t.totalVotes*100:0;return{playerName:e,totalMeetings:t.totalMeetings,totalVotes:t.totalVotes,votesForEnemyCamp:t.votesForEnemyCamp,votesForOwnCamp:t.votesForOwnCamp,accuracyRate:o,friendlyFireRate:g}}),y=Array.from(s.entries()).map(([e,t])=>{const o=t.totalTimesTargeted>0?(t.totalTimesTargeted-t.eliminationsByVote)/t.totalTimesTargeted*100:100;return{playerName:e,totalMeetings:t.totalMeetings,totalTimesTargeted:t.totalTimesTargeted,timesTargetedByEnemyCamp:t.timesTargetedByEnemyCamp,timesTargetedByOwnCamp:t.timesTargetedByOwnCamp,timesTargetedAsVillager:t.timesTargetedAsVillager,timesTargetedAsWolf:t.timesTargetedAsWolf,timesTargetedAsSpecial:t.timesTargetedAsSpecial,eliminationsByVote:t.eliminationsByVote,survivalRate:o}});return{playerBehaviorStats:M,playerAccuracyStats:c,playerTargetStats:y,overallMeetingStats:{totalMeetings:u,averageParticipationRate:S>0?m/S:0,totalVotes:A,totalSkips:i,totalAbstentions:a}}}export{_ as a,j as b,q as c};
