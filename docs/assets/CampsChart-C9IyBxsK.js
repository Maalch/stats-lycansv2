import{r as c,j as e}from"./index-ClHBFAaT.js";import{u as T}from"./useCampWinStatsFromRaw-CvUADS7A.js";import{l as P,a as u}from"./api-DftpR04q.js";import{F as g}from"./FullscreenChart-CaXaPtiE.js";import{R as p,p as x,T as j,B as y,C as f,X as b,Y as R,o as N}from"./useRawGameData-DKu6upLQ.js";import{P as G,a as F}from"./PieChart-DlB2jS8L.js";import{L}from"./Legend-CAMai6os.js";const S="#607D8B";function B(){const{campWinStats:t,isLoading:w,errorInfo:C}=T(),o=c.useMemo(()=>t?.campAverages?t.campAverages.map(s=>({...s,winRateNum:parseFloat(s.winRate)})).sort((s,a)=>a.winRateNum-s.winRateNum):[],[t]),d=c.useMemo(()=>t?.campStats?.map(s=>({...s,winRateNum:typeof s.winRate=="string"?parseFloat(s.winRate):s.winRate}))||[],[t]),h=c.useMemo(()=>{if(!d.length)return[];const s=5;let a=0;const r=[],n=[];return d.forEach(i=>{i.winRateNum<s?(a+=i.winRateNum,r.push(i)):n.push(i)}),a>0&&n.push({camp:"Autres",wins:r.reduce((i,l)=>i+l.wins,0),winRate:a.toFixed(1),winRateNum:a,_details:r}),n},[d]),m=c.useMemo(()=>o.length?o.slice().filter(s=>s.camp!=="Villageois"&&s.camp!=="Loups").sort((s,a)=>a.totalGames-s.totalGames):[],[o]),A=w,v=C;return A?e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques des camps..."}):v?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",v]}):t?e.jsxs("div",{className:"lycans-camps-container",children:[e.jsx("h2",{children:"Statistiques des Camps"}),t&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camps Analysés"}),e.jsx("div",{className:"lycans-valeur-principale",children:t.campAverages?.length||0}),e.jsx("p",{children:"camps différents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Joueurs Évalués"}),e.jsx("div",{className:"lycans-valeur-principale",children:t.totalPlayersAnalyzed||0}),e.jsx("p",{children:"joueurs analysés"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:t?.totalGames||0}),e.jsx("p",{children:"parties analysées"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[t&&h.length>0&&e.jsx(e.Fragment,{children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Répartition des Victoires par Camp"}),e.jsxs("p",{className:"lycans-stats-info",children:["Distribution des victoires sur ",t.totalGames," parties"]}),e.jsx("div",{style:{height:450},children:e.jsx(p,{width:"100%",height:"100%",children:e.jsxs(G,{children:[e.jsx(F,{data:h,cx:"50%",cy:"50%",labelLine:!1,outerRadius:140,fill:"#8884d8",dataKey:"winRateNum",nameKey:"camp",label:({camp:s,winRate:a})=>s==="Autres"?`Autres: ${a}%`:`${s}: ${a}%`,children:h.map((s,a)=>e.jsx(x,{fill:s.camp==="Autres"?P:u[s.camp]||S},`cellule-camp-${a}`))}),e.jsx(j,{content:({active:s,payload:a})=>{if(s&&a&&a.length>0){const r=a[0].payload;if(r.camp==="Autres"&&r._details){const n=[...r._details].sort((i,l)=>l.winRateNum-i.winRateNum);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:"Autres"})}),e.jsx("div",{children:n.map((i,l)=>e.jsxs("div",{children:[i.camp,": ",i.wins," victoires (",i.winRate,"%)"]},l))}),e.jsxs("div",{style:{marginTop:4,fontWeight:"bold"},children:["Total: ",r.wins," victoires (",r.winRate,"%)"]})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:r.camp}),e.jsxs("div",{children:["Victoires: ",r.wins]}),e.jsxs("div",{children:["Taux de victoire: ",r.winRate,"%"]})]})}return null}}),e.jsx(L,{})]})})})]})}),t?.campAverages&&o.length>0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Taux de Victoire Moyen par Camp"}),e.jsx(g,{title:"Taux de Victoire Moyen par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(p,{width:"100%",height:"100%",children:e.jsxs(y,{data:o,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(f,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(R,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(j,{content:({active:s,payload:a})=>{if(s&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.camp})}),e.jsxs("div",{children:["Parties totales: ",r.totalGames]}),e.jsxs("div",{children:["Taux de victoire: ",r.winRate,"%"]})]})}return null}}),e.jsx(N,{dataKey:"winRateNum",children:o.map((s,a)=>e.jsx(x,{fill:u[s.camp]||`var(--chart-color-${a%6+1})`},`cell-${a}`))})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution des Parties par Camp (hors villageois et loups)"}),e.jsx(g,{title:"Distribution des Parties par Camp (hors villageois et loups)",children:e.jsx("div",{style:{height:400},children:e.jsx(p,{width:"100%",height:"100%",children:e.jsxs(y,{data:m,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(f,{strokeDasharray:"3 3"}),e.jsx(b,{dataKey:"camp",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(R,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"}}),e.jsx(j,{content:({active:s,payload:a})=>{if(s&&a&&a.length>0){const r=a[0].payload,n=m.reduce((l,D)=>l+D.totalGames,0),i=(r.totalGames/n*100).toFixed(1);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.camp})}),e.jsxs("div",{children:["Parties: ",r.totalGames," (",i,"%)"]}),e.jsxs("div",{children:["Taux victoire: ",r.winRate,"%"]})]})}return null}}),e.jsx(N,{dataKey:"totalGames",children:m.map((s,a)=>e.jsx(x,{fill:u[s.camp]||`var(--chart-color-${a%6+1})`},`cell-${a}`))})]})})})})]})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de camp disponible"})}export{B as CampsChart};
