import{u as G,r as x,j as a}from"./index-DfpoRKFe.js";import{F as R,R as j,B as D,C as b,X as v,Y as P,T as g,o as y,w as m,p as M}from"./FullscreenChart-JLwVKNUJ.js";import{L as N}from"./Legend-B1Qua5go.js";import{P as K,a as $}from"./PieChart-DfAvUJ2f.js";function F(e){if(!e)return null;const[p,d,c]=e.split("/");return!p||!d||!c?null:new Date(Number(c),Number(d)-1,Number(p))}function S(e){const[p,d]=x.useState(null),[c,h]=x.useState(!0),[r,i]=x.useState(null);return x.useEffect(()=>{(async()=>{try{h(!0);let t;try{if(t=await fetch(`/data/${e}.json`),!t.ok)throw new Error("Static file not found")}catch{try{if(t=await fetch(`/public/data/${e}.json`),!t.ok)throw new Error("Public file not found")}catch{const f="https://script.google.com/macros/s/AKfycbxo92hlxlcCzXtXawsxP4LSspOkNKKI4Yo8OC5aqrAe70EGoIaMcWtFWy7j-RF1iTiu/exec";if(t=await fetch(`${f}?action=${e}`),!t.ok)throw new Error(`API request failed: ${t.status}`)}}const u=await t.json();d(u.data||[])}catch(t){console.error(`Error fetching raw ${e}:`,t),i(t instanceof Error?t.message:"Unknown error")}finally{h(!1)}})()},[e]),{data:p,isLoading:c,error:r}}function k(){const{settings:e}=G(),{data:p,isLoading:d,error:c}=S("rawBRData");return{data:p?.filter(r=>{if(!r.Game||!r.Participants)return!1;if(e.filterMode==="gameType"&&e.gameFilter!=="all"){if(e.gameFilter==="modded"){if(!r["Game Moddée"])return!1}else if(e.gameFilter==="non-modded"&&r["Game Moddée"])return!1}else if(e.filterMode==="dateRange"&&(e.dateRange.start||e.dateRange.end)){const i=F(r.Date);if(!i)return!1;if(e.dateRange.start){const n=new Date(e.dateRange.start);if(i<n)return!1}if(e.dateRange.end){const n=new Date(e.dateRange.end);if(i>n)return!1}}if(e.playerFilter.mode!=="none"&&e.playerFilter.players.length>0){const i=r.Participants.toLowerCase();if(e.playerFilter.mode==="include"){if(!e.playerFilter.players.some(t=>t.toLowerCase()===i))return!1}else if(e.playerFilter.mode==="exclude"&&e.playerFilter.players.some(t=>t.toLowerCase()===i))return!1}return!0})?.map(r=>({Game:r.Game,Participants:r.Participants,Score:r.Score,Gagnant:r.Gagnant}))||null,isLoading:d,error:c}}function A(){const{settings:e}=G(),{data:p,isLoading:d,error:c}=S("rawBRData");return{data:p?.reduce((r,i)=>{if(!i.Game2||!i.Date||r.find(t=>t.Game===i.Game2))return r;if(e.filterMode==="gameType"&&e.gameFilter!=="all"){if(e.gameFilter==="modded"){if(!i["Game Moddée"])return r}else if(e.gameFilter==="non-modded"&&i["Game Moddée"])return r}else if(e.filterMode==="dateRange"&&(e.dateRange.start||e.dateRange.end)){const t=F(i.Date);if(!t)return r;if(e.dateRange.start){const u=new Date(e.dateRange.start);if(t<u)return r}if(e.dateRange.end){const u=new Date(e.dateRange.end);if(t>u)return r}}return r.push({Game:i.Game2,"Nombre de participants":i["Nombre de participants"],Date:i.Date,VOD:i.VOD,"Game Moddée":i["Game Moddée"]}),r},[])||null,isLoading:d,error:c}}function J(){const{data:e,isLoading:p,error:d}=k(),{data:c,isLoading:h,error:r}=A(),i=x.useMemo(()=>{if(!e||!c)return null;const n=c.length,t=e.length,u=e.filter(s=>s.Gagnant).length,f=e.reduce((s,l)=>{const o=l.Participants;return s[o]||(s[o]={name:o,participations:0,wins:0,totalScore:0,averageScore:0,winRate:0}),s[o].participations++,s[o].totalScore+=l.Score,l.Gagnant&&s[o].wins++,s},{});Object.values(f).forEach(s=>{s.averageScore=s.totalScore/s.participations,s.winRate=s.wins/s.participations*100});const B=Object.values(f).sort((s,l)=>l.participations-s.participations).slice(0,10),O=Object.values(f).filter(s=>s.participations>=3).sort((s,l)=>l.winRate-s.winRate).slice(0,10),E=e.reduce((s,l)=>{const o=l.Score,w=o===0?"0":o<=2?"1-2":o<=4?"3-4":o<=6?"5-6":"7+";return s[w]||(s[w]=0),s[w]++,s},{}),C=Object.entries(E).map(([s,l])=>({range:s,count:l,percentage:(l/t*100).toFixed(1)})),L=c.reduce((s,l)=>{const o=l["Nombre de participants"];return s[o]||(s[o]=0),s[o]++,s},{}),T=Object.entries(L).map(([s,l])=>({participants:parseInt(s),games:l,percentage:(l/n*100).toFixed(1)})).sort((s,l)=>s.participants-l.participants);return{totalGames:n,totalParticipations:t,totalWins:u,winRate:(u/t*100).toFixed(1),averageParticipantsPerGame:(t/n).toFixed(1),topPlayersByParticipations:B,topPlayersByWins:O,scoreData:C,participantData:T}},[e,c]);return p||h?a.jsx("div",{className:"statistiques-chargement",children:"Chargement des données Battle Royale..."}):d||r?a.jsxs("div",{className:"statistiques-erreur",children:["Erreur: ",d||r]}):i?a.jsxs("div",{className:"lycans-chart-container",children:[a.jsxs("div",{className:"lycans-chart-header",children:[a.jsx("h2",{children:"Statistiques Battle Royale"}),a.jsxs("p",{children:[i.totalGames," parties • ",i.totalParticipations," participations • ",i.winRate,"% de victoires"]})]}),a.jsxs("div",{className:"lycans-stats-grid",children:[a.jsxs("div",{className:"lycans-stat-card",children:[a.jsx("h3",{children:"Parties totales"}),a.jsx("div",{className:"lycans-stat-value",children:i.totalGames})]}),a.jsxs("div",{className:"lycans-stat-card",children:[a.jsx("h3",{children:"Participations"}),a.jsx("div",{className:"lycans-stat-value",children:i.totalParticipations})]}),a.jsxs("div",{className:"lycans-stat-card",children:[a.jsx("h3",{children:"Taux de victoire global"}),a.jsxs("div",{className:"lycans-stat-value",children:[i.winRate,"%"]})]}),a.jsxs("div",{className:"lycans-stat-card",children:[a.jsx("h3",{children:"Moy. participants/partie"}),a.jsx("div",{className:"lycans-stat-value",children:i.averageParticipantsPerGame})]})]}),a.jsxs("div",{className:"lycans-chart-section",children:[a.jsx("h3",{children:"Top Joueurs - Participations"}),a.jsx(R,{title:"Top Joueurs par Participations - Battle Royale",className:"lycans-chart-wrapper",children:a.jsx(j,{width:"100%",height:400,children:a.jsxs(D,{data:i.topPlayersByParticipations,children:[a.jsx(b,{strokeDasharray:"3 3"}),a.jsx(v,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),a.jsx(P,{}),a.jsx(g,{formatter:(n,t)=>[n,t==="participations"?"Participations":t==="wins"?"Victoires":t]}),a.jsx(N,{}),a.jsx(y,{dataKey:"participations",fill:m.villageois,name:"Participations"}),a.jsx(y,{dataKey:"wins",fill:m.loups,name:"Victoires"})]})})})]}),a.jsxs("div",{className:"lycans-chart-section",children:[a.jsx("h3",{children:"Top Joueurs - Taux de Victoire (min. 3 parties)"}),a.jsx(R,{title:"Top Joueurs par Taux de Victoire - Battle Royale",className:"lycans-chart-wrapper",children:a.jsx(j,{width:"100%",height:400,children:a.jsxs(D,{data:i.topPlayersByWins,children:[a.jsx(b,{strokeDasharray:"3 3"}),a.jsx(v,{dataKey:"name",angle:-45,textAnchor:"end",height:80,fontSize:12}),a.jsx(P,{}),a.jsx(g,{formatter:(n,t)=>[t==="winRate"?`${n.toFixed(1)}%`:n,t==="winRate"?"Taux de victoire":t==="participations"?"Participations":t==="wins"?"Victoires":t]}),a.jsx(N,{}),a.jsx(y,{dataKey:"winRate",fill:m.solo,name:"Taux de victoire (%)"})]})})})]}),a.jsxs("div",{className:"lycans-chart-section",children:[a.jsx("h3",{children:"Distribution des Scores"}),a.jsx(j,{width:"100%",height:400,children:a.jsxs(K,{children:[a.jsx($,{data:i.scoreData,cx:"50%",cy:"50%",labelLine:!1,label:({range:n,percentage:t})=>`${n}: ${t}%`,outerRadius:140,fill:"#8884d8",dataKey:"count",children:i.scoreData.map((n,t)=>a.jsx(M,{fill:Object.values(m)[t%Object.values(m).length]},`cell-${t}`))}),a.jsx(g,{formatter:n=>[n,"Participations"]})]})})]}),a.jsxs("div",{className:"lycans-chart-section",children:[a.jsx("h3",{children:"Répartition par Nombre de Participants"}),a.jsx(R,{title:"Répartition par Nombre de Participants - Battle Royale",className:"lycans-chart-wrapper",children:a.jsx(j,{width:"100%",height:400,children:a.jsxs(D,{data:i.participantData,children:[a.jsx(b,{strokeDasharray:"3 3"}),a.jsx(v,{dataKey:"participants"}),a.jsx(P,{}),a.jsx(g,{formatter:(n,t)=>[n,t==="games"?"Parties":t]}),a.jsx(N,{}),a.jsx(y,{dataKey:"games",fill:m.amoureux,name:"Nombre de parties"})]})})})]})]}):a.jsx("div",{className:"statistiques-vide",children:"Aucune donnée Battle Royale disponible"})}export{J as BRGeneralStatsChart};
