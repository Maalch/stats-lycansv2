import{u as ae,a as Z,b as ee,r as v,g as ne,j as e}from"./index-BTTwzeiW.js";import{u as se}from"./usePlayerStatsFromRaw-DEp6Tv09.js";import{u as te}from"./useJoueursData-Cpfq5bfA.js";import{u as ie,C as $,M as le,m as oe}from"./api-CGa1aEsR.js";import{F as V,C as B,X as O,Y as K,a as _}from"./FullscreenChart-zTZ54EAZ.js";import{R as J,T as L}from"./CategoricalChart-BJ2MHWcm.js";import{B as Y,a as U}from"./BarChart-DihPCXVe.js";import{R as re}from"./ReferenceLine-CFVHQSPB.js";import"./baseStatsHook-CvsaAAG3.js";import"./datasyncExport-BirWLS1z.js";import"./CartesianScaleHelper-B5QcuZLv.js";const G=.4,de=["Janvier","FÃ©vrier","Mars","Avril","Mai","Juin","Juillet","AoÃ»t","Septembre","Octobre","Novembre","DÃ©cembre"];function Q(y){const[A,m]=y.split("-"),C=parseInt(m,10)-1;return`${de[C]} ${A}`}function ce({selectedMonth:y,onMonthChange:A}){const{gameData:m}=ae(),{navigateToGameDetails:C}=Z(),{settings:d}=ee(),{joueursData:H}=te(),n=ie(H),[u,z]=v.useState(null),{months:b,monthKeys:g}=v.useMemo(()=>{if(!m||m.length===0)return{months:new Map,monthKeys:[]};const t=new Map;for(const a of m){const c=new Date(a.StartDate),o=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`;t.has(o)||t.set(o,[]),t.get(o).push(a)}const r=new Map;for(const[a,c]of t){const o=c.length,W=Math.ceil(o*G),x=new Map;for(const h of c)for(const R of h.PlayerStats){const P=ne(R);x.has(P)||x.set(P,{displayName:R.Username,gamesPlayed:0,wins:0});const w=x.get(P);w.gamesPlayed++,R.Victorious&&w.wins++}const p=[];for(const[,h]of x)h.gamesPlayed>=W&&p.push({player:h.displayName,gamesPlayed:h.gamesPlayed,wins:h.wins,winPercent:h.gamesPlayed>0?(h.wins/h.gamesPlayed*100).toFixed(1):"0.0"});p.sort((h,R)=>parseFloat(R.winPercent)-parseFloat(h.winPercent)),r.set(a,{key:a,label:Q(a),totalGames:o,players:p})}const i=[...r.keys()].sort();return{months:r,monthKeys:i}},[m]),f=v.useMemo(()=>y&&g.includes(y)?y:g.length>0?g[g.length-1]:null,[y,g]),l=f?b.get(f):null,{chartData:D,highlightedPlayerAdded:I,averageWinRate:k,minGamesRequired:T}=v.useMemo(()=>{if(!l)return{chartData:[],highlightedPlayerAdded:!1,averageWinRate:"0",minGamesRequired:0};const t=Math.ceil(l.totalGames*G),r=l.players.slice(0,$.TOP_15);let i=0;for(const W of l.players)i+=parseFloat(W.winPercent);const a=l.players.length>0?(i/l.players.length).toFixed(1):"0";let c=[...r],o=!1;if(d.highlightedPlayer&&!r.some(x=>x.player===d.highlightedPlayer)){const x=l.players.find(p=>p.player===d.highlightedPlayer);if(x)c.push({...x,isHighlightedAddition:!0}),o=!0;else if(m){const p=new Date(f+"-01"),h=new Date(p.getFullYear(),p.getMonth(),1),R=new Date(p.getFullYear(),p.getMonth()+1,0,23,59,59);let P=0,w=0;for(const s of m){const j=new Date(s.StartDate);if(j>=h&&j<=R)for(const X of s.PlayerStats)X.Username===d.highlightedPlayer&&(P++,X.Victorious&&w++)}P>0&&(c.push({player:d.highlightedPlayer,gamesPlayed:P,wins:w,winPercent:(w/P*100).toFixed(1),isHighlightedAddition:!0}),o=!0)}}return{chartData:c,highlightedPlayerAdded:o,averageWinRate:a,minGamesRequired:t}},[l,d.highlightedPlayer,m,f]),S=f?g.indexOf(f):-1,M=S>0,F=S<g.length-1,q=v.useCallback(()=>{M&&A(g[S-1])},[M,S,g,A]),E=v.useCallback(()=>{F&&A(g[S+1])},[F,S,g,A]);return!m||m.length===0?e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible pour le classement mensuel"}):g.length===0?e.jsx("div",{className:"donnees-manquantes",children:"Aucun mois avec des parties trouvÃ©"}):e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Classement Mensuel â€” Taux de Victoire"}),I&&d.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',d.highlightedPlayer,'" affichÃ© en plus du classement']})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"1rem",marginBottom:"1rem"},children:[e.jsx("button",{onClick:q,disabled:!M,style:{background:"var(--bg-tertiary)",color:M?"var(--text-primary)":"var(--text-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.4rem 0.8rem",fontSize:"1rem",cursor:M?"pointer":"not-allowed",opacity:M?1:.5},children:"â—€"}),e.jsx("select",{value:f||"",onChange:t=>A(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.95rem",fontWeight:"bold",minWidth:"180px",textAlign:"center"},children:g.map(t=>e.jsx("option",{value:t,children:Q(t)},t))}),e.jsx("button",{onClick:E,disabled:!F,style:{background:"var(--bg-tertiary)",color:F?"var(--text-primary)":"var(--text-secondary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.4rem 0.8rem",fontSize:"1rem",cursor:F?"pointer":"not-allowed",opacity:F?1:.5},children:"â–¶"})]}),e.jsx(V,{title:`Classement Mensuel â€” ${l?.label||""}`,children:e.jsx("div",{style:{height:400},children:D.length===0?e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"var(--text-secondary)",fontSize:"1rem"},children:["Aucun joueur n'a jouÃ© au moins ",T," partie",T>1?"s":""," ce mois-ci (",Math.round(G*100),"% de ",l?.totalGames??0," parties)"]}):e.jsx(J,{width:"100%",height:"100%",children:e.jsxs(Y,{data:D,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:r,payload:i})=>e.jsx("text",{x:t,y:r,dy:16,textAnchor:"end",fill:d.highlightedPlayer===i.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:d.highlightedPlayer===i.value?14:13,fontWeight:d.highlightedPlayer===i.value?"bold":"italic",transform:`rotate(-45 ${t} ${r})`,children:i.value})}),e.jsx(K,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(L,{content:({active:t,payload:r})=>{if(t&&r&&r.length>0){const i=r[0].payload,a=i.isHighlightedAddition,c=d.highlightedPlayer===i.player,o=i.gamesPlayed>=T;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:i.player})}),e.jsxs("div",{children:["Taux de victoire : ",i.winPercent,"%"]}),e.jsxs("div",{children:["Victoires : ",i.wins," / ",i.gamesPlayed," parties"]}),a&&!o&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",T," parties requises)"]}),a&&o&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"}),c&&!a&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(U,{dataKey:"winPercent",name:"Taux de Victoire",fill:"#8884d8",children:D.map(t=>{const r=d.highlightedPlayer===t.player,i=u===t.player,a=t.isHighlightedAddition;return e.jsx(_,{fill:n[t.player]||"#8884d8",stroke:r?"var(--accent-primary)":i?"var(--text-primary)":"none",strokeWidth:r?3:i?2:0,strokeDasharray:a?"5,5":"none",opacity:a?.8:1,onClick:()=>{C({selectedPlayer:t.player,selectedPlayerWinMode:"wins-only",fromComponent:`Classement Mensuel â€” ${l?.label||""}`})},onMouseEnter:()=>z(t.player),onMouseLeave:()=>z(null),style:{cursor:"pointer"}},`cell-monthly-${t.player}`)})}),e.jsx(re,{y:parseFloat(k),stroke:"red",strokeDasharray:"3 3",label:{value:`Moyenne: ${k}%`,position:"insideBottomRight",fill:"red",fontSize:12,fontWeight:"bold"}})]})})})}),e.jsx("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:l&&e.jsxs(e.Fragment,{children:[D.filter(t=>!t.isHighlightedAddition).length," joueur",D.filter(t=>!t.isHighlightedAddition).length>1?"s":""," classÃ©",D.filter(t=>!t.isHighlightedAddition).length>1?"s":""," sur"," ",l.totalGames," partie",l.totalGames>1?"s":""," ce mois"," ","(min. ",T," partie",T>1?"s":""," â€” ",Math.round(G*100),"%)"]})})]})}const he=400;function Se(){const{data:y,isLoading:A,error:m}=se(),{navigateToGameDetails:C,navigationState:d,updateNavigationState:H}=Z(),{settings:n}=ee(),[u,z]=v.useState(d.playersGeneralState?.minGamesForWinRate||le.MEDIUM),[b,g]=v.useState(d.playersGeneralState?.winRateOrder||"best"),[N,f]=v.useState(null),[l,D]=v.useState(d.playersGeneralState?.selectedMonth||null),{joueursData:I}=te(),k=ie(I);v.useEffect(()=>{const t=d.playersGeneralState;(!t||t.minGamesForWinRate!==u||t.winRateOrder!==b||t.selectedMonth!==l)&&H({playersGeneralState:{minGamesForWinRate:u,winRateOrder:b,focusChart:t?.focusChart,selectedMonth:l||void 0}})},[u,b,l,H]);const{participationData:T,winRateData:S,averageWinRate:M,totalEligiblePlayers:F,highlightedPlayerInParticipation:q,highlightedPlayerInWinRate:E}=v.useMemo(()=>{if(!y?.playerStats)return{participationData:[],winRateData:[],averageWinRate:"0",totalEligiblePlayers:0,highlightedPlayerInParticipation:!1,highlightedPlayerInWinRate:!1};const t=y.playerStats,r=[],i=[];let a=0;for(const s of t)a+=parseFloat(s.winPercent),s.gamesPlayed>=u&&r.push(s),s.gamesPlayed>2&&i.push(s);const c=t.length>0?(a/t.length).toFixed(1):"0",o=i.sort((s,j)=>j.gamesPlayed-s.gamesPlayed).slice(0,$.TOP_15),W=n.highlightedPlayer&&o.some(s=>s.player===n.highlightedPlayer);let x=[...o],p=!1;if(n.highlightedPlayer&&!W){const s=i.find(j=>j.player===n.highlightedPlayer);s&&(x.push({...s,isHighlightedAddition:!0}),p=!0)}const h=r.sort((s,j)=>b==="best"?parseFloat(j.winPercent)-parseFloat(s.winPercent):parseFloat(s.winPercent)-parseFloat(j.winPercent)).slice(0,$.TOP_15),R=n.highlightedPlayer&&h.some(s=>s.player===n.highlightedPlayer);let P=[...h],w=!1;if(n.highlightedPlayer&&!R){const s=t.find(j=>j.player===n.highlightedPlayer);s&&(P.push({...s,isHighlightedAddition:!0}),w=!0)}return{participationData:x,winRateData:P,averageWinRate:c,totalEligiblePlayers:r.length,highlightedPlayerInParticipation:p,highlightedPlayerInWinRate:w}},[y,u,b,n.highlightedPlayer]);return A?e.jsx("div",{className:"donnees-attente",children:"RÃ©cupÃ©ration des statistiques des joueurs..."}):m?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",m]}):y?e.jsxs("div",{className:"lycans-players-stats",children:[e.jsx("h2",{children:"Statistiques des Joueurs"}),e.jsxs("p",{className:"lycans-stats-info",children:["Total de ",y.totalGames," parties analysÃ©es avec ",y.playerStats.length," joueurs"]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Top Participations"}),q&&n.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',n.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsx(V,{title:"Top Participations",children:e.jsx("div",{style:{height:450},children:e.jsx(J,{width:"100%",height:"100%",children:e.jsxs(Y,{data:T,margin:{top:100,right:30,left:20,bottom:10},children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:r,payload:i})=>e.jsx("text",{x:t,y:r,dy:16,textAnchor:"end",fill:n.highlightedPlayer===i.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:n.highlightedPlayer===i.value?14:13,fontWeight:n.highlightedPlayer===i.value?"bold":"italic",transform:`rotate(-45 ${t} ${r})`,children:i.value})}),e.jsx(K,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(L,{content:({active:t,payload:r})=>{if(t&&r&&r.length>0){const i=r[0].payload,a=i.isHighlightedAddition,c=n.highlightedPlayer===i.player;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:i.player})}),e.jsxs("div",{children:["Parties jouÃ©es : ",i.gamesPlayed]}),e.jsxs("div",{children:["Pourcentage : ",i.gamesPlayedPercent,"%"]}),a&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection personnelle"}),c&&!a&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(U,{dataKey:"gamesPlayed",name:"Parties jouÃ©es",fill:"#00C49F",children:T.map(t=>{const r=n.highlightedPlayer===t.player,i=N===t.player,a=t.isHighlightedAddition;return e.jsx(_,{fill:k[t.player]||"#00C49F",stroke:r?"var(--accent-primary)":i?"var(--text-primary)":"none",strokeWidth:r?3:i?2:0,strokeDasharray:a?"5,5":"none",opacity:a?.8:1,onClick:()=>{C({selectedPlayer:t.player,fromComponent:"Statistiques Joueurs"})},onMouseEnter:()=>f(t.player),onMouseLeave:()=>f(null),style:{cursor:"pointer"}},`cell-participation-${t.player}`)})})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("div",{children:[e.jsx("h3",{children:b==="best"?"Meilleurs Taux de Victoire":"Moins Bons Taux de Victoire"}),E&&n.highlightedPlayer&&e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--accent-primary-text)",fontStyle:"italic",marginTop:"0.25rem",marginBottom:"0.5rem"},children:['ðŸŽ¯ "',n.highlightedPlayer,'" affichÃ© en plus du top 15']})]}),e.jsxs("div",{className:"lycans-winrate-controls",style:{display:"flex",alignItems:"center",gap:"0.5rem",marginBottom:"1rem"},children:[e.jsxs("select",{value:b,onChange:t=>g(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"best",children:"Meilleurs Taux de Victoire"}),e.jsx("option",{value:"worst",children:"Moins Bons Taux de Victoire"})]}),e.jsx("label",{htmlFor:"min-games-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. parties:"}),e.jsx("select",{id:"min-games-select",value:u,onChange:t=>z(Number(t.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:oe.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsx(V,{title:b==="best"?"Meilleurs Taux de Victoire":"Moins Bons Taux de Victoire",children:e.jsx("div",{style:{height:he},children:e.jsx(J,{width:"100%",height:"100%",children:e.jsxs(Y,{data:S,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(B,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"player",angle:-45,textAnchor:"end",height:80,interval:0,tick:({x:t,y:r,payload:i})=>e.jsx("text",{x:t,y:r,dy:16,textAnchor:"end",fill:n.highlightedPlayer===i.value?"var(--accent-primary-text)":"var(--text-secondary)",fontSize:n.highlightedPlayer===i.value?14:13,fontWeight:n.highlightedPlayer===i.value?"bold":"italic",transform:`rotate(-45 ${t} ${r})`,children:i.value})}),e.jsx(K,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(L,{content:({active:t,payload:r})=>{if(t&&r&&r.length>0){const i=r[0].payload,a=i.isHighlightedAddition,c=n.highlightedPlayer===i.player,o=i.gamesPlayed>=u;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:i.player})}),e.jsxs("div",{children:["Taux de victoire : ",i.winPercent,"%"]}),e.jsxs("div",{children:["Victoires : ",i.wins," / ",i.gamesPlayed]}),a&&!o&&e.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:["ðŸŽ¯ AffichÃ© via sÃ©lection (< ",u," parties)"]}),a&&o&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ AffichÃ© via sÃ©lection (hors top 15)"}),c&&!a&&e.jsx("div",{style:{fontSize:"0.75rem",color:"var(--accent-primary)",marginTop:"0.25rem",fontStyle:"italic"},children:"ðŸŽ¯ Joueur sÃ©lectionnÃ©"}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(U,{dataKey:"winPercent",name:"Taux de Victoire",fill:"#8884d8",children:S.map(t=>{const r=n.highlightedPlayer===t.player,i=N===t.player,a=t.isHighlightedAddition;return e.jsx(_,{fill:k[t.player]||"#8884d8",stroke:r?"var(--accent-primary)":i?"var(--text-primary)":"none",strokeWidth:r?3:i?2:0,strokeDasharray:a?"5,5":"none",opacity:a?.8:1,onClick:()=>{C({selectedPlayer:t.player,selectedPlayerWinMode:"wins-only",fromComponent:"Taux de Victoire"})},onMouseEnter:()=>f(t.player),onMouseLeave:()=>f(null),style:{cursor:"pointer"}},`cell-winrate-${t.player}`)})}),e.jsx(re,{y:parseFloat(M),stroke:"red",strokeDasharray:"3 3",label:{value:`Moyenne: ${M}%`,position:"insideBottomRight",fill:"red",fontSize:12,fontWeight:"bold"}})]})})})}),e.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",textAlign:"center",marginTop:"0.5rem"},children:["Top ",S.length," des joueurs (sur ",F," ayant au moins ",u," partie",u>1?"s":"",")"]})]}),e.jsx(ce,{selectedMonth:l,onMonthChange:D})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de joueur disponible"})}export{Se as PlayersGeneralStatisticsChart};
