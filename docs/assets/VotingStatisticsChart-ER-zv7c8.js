import{r as j,a as $,u as J,j as e}from"./index-D5j6JQ8x.js";import{F as P,B,C as R,X as N,Y as F,a as k,b as w}from"./FullscreenChart-D_pd0yNo.js";import{g as E,a as O,u as K}from"./datasyncExport-MU2uTl3N.js";import{u as G}from"./useJoueursData-DoE8BKrZ.js";import{u as L}from"./api-DbzQHk77.js";import{R as W,T as D}from"./CategoricalChart-BWKGLqs7.js";function X(i,m){if(!i.DeathTiming)return!0;const h=i.DeathTiming.toUpperCase();if(h.startsWith("M")){const g=parseInt(h.substring(1));return m<g}if(h.startsWith("N")||h.startsWith("J")){const g=parseInt(h.substring(1));return m<=g}return!0}function Y(i,m){return i.PlayerStats.filter(h=>X(h,m))}function H(i,m,h){const g=i.PlayerStats.find(y=>y.Username===h);return g?g.DeathType==="VOTED"&&g.DeathTiming===`M${m}`:!1}function Q(i){const m=[],h=new Map,g=new Map,y=new Map;i.PlayerStats.forEach(c=>{h.set(c.Username,{totalMeetings:0,totalVotes:0,totalSkips:0,totalAbstentions:0}),g.set(c.Username,{totalVotes:0,votesForEnemyCamp:0,votesForOwnCamp:0}),y.set(c.Username,{totalTimesTargeted:0,timesTargetedByEnemyCamp:0,timesTargetedByOwnCamp:0,timesTargetedAsVillager:0,timesTargetedAsWolf:0,timesTargetedAsSpecial:0,eliminationsByVote:0})});const u=Math.max(...i.PlayerStats.flatMap(c=>c.Votes.map(l=>l.MeetingNr)),0);for(let c=1;c<=u;c++){const l=Y(i,c),d=i.PlayerStats.flatMap(a=>a.Votes.filter(n=>n.MeetingNr===c).map(n=>({voter:a.Username,vote:n,voterRole:a.MainRoleInitial}))),v=d.filter(a=>a.vote.Target!=="Passé").length,x=d.filter(a=>a.vote.Target==="Passé").length,p=l.length-d.length,t=new Map;d.filter(a=>a.vote.Target!=="Passé").forEach(a=>{const n=t.get(a.vote.Target)||0;t.set(a.vote.Target,n+1)});let o=null,s=0;for(const[a,n]of t.entries())n>s&&(o=a,s=n);let r=null;o&&s>0&&H(i,c,o)&&(r=o),m.push({meetingNumber:c,totalParticipants:l.length,totalVotes:v,totalSkips:x,totalAbstentions:p,participationRate:l.length>0?(v+x)/l.length*100:0,mostTargetedPlayer:o,mostTargetedCount:s,eliminatedPlayer:r}),l.forEach(a=>{const n=h.get(a.Username);n.totalMeetings++;const V=d.find(C=>C.voter===a.Username);if(V)if(V.vote.Target==="Passé")n.totalSkips++;else{n.totalVotes++;const C=g.get(a.Username);C.totalVotes++;const z=E(O(a.MainRoleInitial,a.MainRoleChanges||[])),b=i.PlayerStats.find(M=>M.Username===V.vote.Target);if(b){const M=E(O(b.MainRoleInitial,b.MainRoleChanges||[]));z===M?C.votesForOwnCamp++:C.votesForEnemyCamp++;const A=y.get(V.vote.Target);A.totalTimesTargeted++,z===M?A.timesTargetedByOwnCamp++:A.timesTargetedByEnemyCamp++;const I=O(b.MainRoleInitial,b.MainRoleChanges||[]),U=E(I);U==="Villageois"?A.timesTargetedAsVillager++:U==="Loup"?A.timesTargetedAsWolf++:A.timesTargetedAsSpecial++,H(i,c,V.vote.Target)&&A.eliminationsByVote++}}else n.totalAbstentions++})}const f=[],T=[],S=[];return i.PlayerStats.forEach(c=>{const l=h.get(c.Username),d=l.totalMeetings>0?l.totalVotes/l.totalMeetings*100:0,v=l.totalMeetings>0?l.totalSkips/l.totalMeetings*100:0,x=l.totalMeetings>0?l.totalAbstentions/l.totalMeetings*100:0,p=d-v*.5-x*.7;f.push({playerName:c.Username,totalMeetings:l.totalMeetings,totalVotes:l.totalVotes,totalSkips:l.totalSkips,totalAbstentions:l.totalAbstentions,votingRate:d,skippingRate:v,abstentionRate:x,aggressivenessScore:p});const t=g.get(c.Username),o=t.totalVotes>0?t.votesForEnemyCamp/t.totalVotes*100:0,s=t.totalVotes>0?t.votesForOwnCamp/t.totalVotes*100:0;T.push({playerName:c.Username,totalMeetings:l.totalMeetings,totalVotes:t.totalVotes,votesForEnemyCamp:t.votesForEnemyCamp,votesForOwnCamp:t.votesForOwnCamp,accuracyRate:o,friendlyFireRate:s});const r=y.get(c.Username),a=r.totalTimesTargeted>0?(r.totalTimesTargeted-r.eliminationsByVote)/r.totalTimesTargeted*100:100;S.push({playerName:c.Username,totalTimesTargeted:r.totalTimesTargeted,timesTargetedByEnemyCamp:r.timesTargetedByEnemyCamp,timesTargetedByOwnCamp:r.timesTargetedByOwnCamp,timesTargetedAsVillager:r.timesTargetedAsVillager,timesTargetedAsWolf:r.timesTargetedAsWolf,timesTargetedAsSpecial:r.timesTargetedAsSpecial,eliminationsByVote:r.eliminationsByVote,survivalRate:a})}),{gameId:i.Id,totalMeetings:u,meetingAnalytics:m,playerBehaviors:f,playerAccuracies:T,playerTargetStats:S}}function Z(i){const m=i.map(Q),h=new Map,g=new Map,y=new Map;let u=0,f=0,T=0,S=0,c=0,l=0;m.forEach(p=>{u+=p.totalMeetings,p.meetingAnalytics.forEach(t=>{f+=t.participationRate,T++,S+=t.totalVotes,c+=t.totalSkips,l+=t.totalAbstentions}),p.playerBehaviors.forEach(t=>{const o=h.get(t.playerName)||{totalMeetings:0,totalVotes:0,totalSkips:0,totalAbstentions:0};h.set(t.playerName,{totalMeetings:o.totalMeetings+t.totalMeetings,totalVotes:o.totalVotes+t.totalVotes,totalSkips:o.totalSkips+t.totalSkips,totalAbstentions:o.totalAbstentions+t.totalAbstentions})}),p.playerAccuracies.forEach(t=>{const o=g.get(t.playerName)||{totalMeetings:0,totalVotes:0,votesForEnemyCamp:0,votesForOwnCamp:0};g.set(t.playerName,{totalMeetings:o.totalMeetings+t.totalMeetings,totalVotes:o.totalVotes+t.totalVotes,votesForEnemyCamp:o.votesForEnemyCamp+t.votesForEnemyCamp,votesForOwnCamp:o.votesForOwnCamp+t.votesForOwnCamp})}),p.playerTargetStats.forEach(t=>{const o=y.get(t.playerName)||{totalTimesTargeted:0,timesTargetedByEnemyCamp:0,timesTargetedByOwnCamp:0,timesTargetedAsVillager:0,timesTargetedAsWolf:0,timesTargetedAsSpecial:0,eliminationsByVote:0};y.set(t.playerName,{totalTimesTargeted:o.totalTimesTargeted+t.totalTimesTargeted,timesTargetedByEnemyCamp:o.timesTargetedByEnemyCamp+t.timesTargetedByEnemyCamp,timesTargetedByOwnCamp:o.timesTargetedByOwnCamp+t.timesTargetedByOwnCamp,timesTargetedAsVillager:o.timesTargetedAsVillager+t.timesTargetedAsVillager,timesTargetedAsWolf:o.timesTargetedAsWolf+t.timesTargetedAsWolf,timesTargetedAsSpecial:o.timesTargetedAsSpecial+t.timesTargetedAsSpecial,eliminationsByVote:o.eliminationsByVote+t.eliminationsByVote})})});const d=Array.from(h.entries()).map(([p,t])=>{const o=t.totalMeetings>0?t.totalVotes/t.totalMeetings*100:0,s=t.totalMeetings>0?t.totalSkips/t.totalMeetings*100:0,r=t.totalMeetings>0?t.totalAbstentions/t.totalMeetings*100:0,a=o-s*.5-r*.7;return{playerName:p,totalMeetings:t.totalMeetings,totalVotes:t.totalVotes,totalSkips:t.totalSkips,totalAbstentions:t.totalAbstentions,votingRate:o,skippingRate:s,abstentionRate:r,aggressivenessScore:a}}),v=Array.from(g.entries()).map(([p,t])=>{const o=t.totalVotes>0?t.votesForEnemyCamp/t.totalVotes*100:0,s=t.totalVotes>0?t.votesForOwnCamp/t.totalVotes*100:0;return{playerName:p,totalMeetings:t.totalMeetings,totalVotes:t.totalVotes,votesForEnemyCamp:t.votesForEnemyCamp,votesForOwnCamp:t.votesForOwnCamp,accuracyRate:o,friendlyFireRate:s}}),x=Array.from(y.entries()).map(([p,t])=>{const o=t.totalTimesTargeted>0?(t.totalTimesTargeted-t.eliminationsByVote)/t.totalTimesTargeted*100:100;return{playerName:p,totalTimesTargeted:t.totalTimesTargeted,timesTargetedByEnemyCamp:t.timesTargetedByEnemyCamp,timesTargetedByOwnCamp:t.timesTargetedByOwnCamp,timesTargetedAsVillager:t.timesTargetedAsVillager,timesTargetedAsWolf:t.timesTargetedAsWolf,timesTargetedAsSpecial:t.timesTargetedAsSpecial,eliminationsByVote:t.eliminationsByVote,survivalRate:o}});return{playerBehaviorStats:d,playerAccuracyStats:v,playerTargetStats:x,overallMeetingStats:{totalMeetings:u,averageParticipationRate:T>0?f/T:0,totalVotes:S,totalSkips:c,totalAbstentions:l}}}function q(){return K(i=>{if(!i||i.length===0)return null;const m=i.filter(h=>h.PlayerStats.some(g=>g.Votes&&g.Votes.length>0));return m.length===0?null:Z(m)})}function _(i=5){const{data:m,isLoading:h,error:g}=q();return{data:j.useMemo(()=>m?{...m,playerBehaviorStats:m.playerBehaviorStats.filter(u=>u.totalMeetings>=i),playerAccuracyStats:m.playerAccuracyStats.filter(u=>u.totalVotes>=Math.ceil(i*.6)),playerTargetStats:m.playerTargetStats.filter(u=>u.totalTimesTargeted>=Math.ceil(i*.3))}:null,[m,i]),isLoading:h,error:g}}function oe(){const{settings:i}=$(),{navigateToGameDetails:m}=J(),{joueursData:h}=G(),g=L(h),[y,u]=j.useState("behavior"),[f,T]=j.useState(25),{data:S,isLoading:c,error:l}=q(),{data:d}=_(f),v=s=>{s&&s.playerName&&m({selectedPlayer:s.playerName,fromComponent:"Statistiques de Vote"})},x=j.useMemo(()=>d?d.playerBehaviorStats.map(s=>({...s,isHighlightedAddition:i.highlightedPlayer===s.playerName&&!d.playerBehaviorStats.slice(0,15).some(r=>r.playerName===s.playerName)})).sort((s,r)=>r.aggressivenessScore-s.aggressivenessScore).slice(0,i.highlightedPlayer?16:15):[],[d,i.highlightedPlayer]),p=j.useMemo(()=>d?d.playerAccuracyStats.map(s=>({...s,isHighlightedAddition:i.highlightedPlayer===s.playerName&&!d.playerAccuracyStats.slice(0,15).some(r=>r.playerName===s.playerName)})).sort((s,r)=>r.accuracyRate-s.accuracyRate).slice(0,i.highlightedPlayer?16:15):[],[d,i.highlightedPlayer]),t=j.useMemo(()=>d?d.playerTargetStats.map(s=>({...s,isHighlightedAddition:i.highlightedPlayer===s.playerName&&!d.playerTargetStats.slice(0,15).some(r=>r.playerName===s.playerName)})).sort((s,r)=>r.survivalRate-s.survivalRate).slice(0,i.highlightedPlayer?16:15):[],[d,i.highlightedPlayer]);if(c)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de vote..."});if(l)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",l]});if(!S||!d)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée de vote disponible"});const o=[5,10,25,50,100,200];return e.jsxs("div",{className:"lycans-voting-statistics",children:[e.jsx("h2",{children:"📊 Statistiques de Vote"}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"view-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Vue:"}),e.jsxs("select",{id:"view-select",value:y,onChange:s=>u(s.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"behavior",children:"🗳️ Comportements de vote"}),e.jsx("option",{value:"accuracy",children:"🎯 Précision des votes"}),e.jsx("option",{value:"targets",children:"🔻 Joueurs ciblés"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"min-meetings-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Min. meetings:"}),e.jsx("select",{id:"min-meetings-select",value:f,onChange:s=>T(Number(s.target.value)),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",width:"90px"},children:o.map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[y==="behavior"&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"🗳️ Comportements de Vote - Score d'Agressivité"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",textAlign:"center",marginBottom:"1rem"},children:`Score basé sur le taux de vote, les abstentions et les "passés". Plus c'est haut, plus le joueur vote activement.`}),e.jsx(P,{title:"Comportements de Vote - Score d'Agressivité",children:e.jsx("div",{style:{height:500},children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(B,{data:x,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"playerName",angle:-45,textAnchor:"end",height:110,interval:0,fontSize:13,tick:({x:s,y:r,payload:a})=>{const n=i.highlightedPlayer===a.value;return e.jsx("text",{x:s,y:r,dy:16,textAnchor:"end",fill:n?"var(--accent-primary)":"var(--text-secondary)",fontSize:n?14:13,fontWeight:n?"bold":"italic",transform:`rotate(-45 ${s} ${r})`,children:a.value})}}),e.jsx(F,{label:{value:"Score d'Agressivité (%)",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(D,{content:({active:s,payload:r})=>{if(s&&r&&r.length>0){const a=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.playerName})}),e.jsxs("div",{children:["Réunions: ",a.totalMeetings]}),e.jsxs("div",{children:["Votes: ",a.totalVotes," (",a.votingRate.toFixed(1),"%)"]}),e.jsxs("div",{children:["Passés: ",a.totalSkips," (",a.skippingRate.toFixed(1),"%)"]}),e.jsxs("div",{children:["Absents: ",a.totalAbstentions," (",a.abstentionRate.toFixed(1),"%)"]}),e.jsx("div",{children:e.jsxs("strong",{children:["Score: ",a.aggressivenessScore.toFixed(1),"%"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(k,{dataKey:"aggressivenessScore",style:{cursor:"pointer"},onClick:v,children:x.map((s,r)=>{const a=i.highlightedPlayer===s.playerName,n=s.isHighlightedAddition;return e.jsx(w,{fill:g[s.playerName]||(s.aggressivenessScore>=0?"var(--accent-tertiary)":"var(--accent-danger)"),stroke:a?"var(--accent-primary)":"transparent",strokeWidth:a?3:0,strokeDasharray:n?"5,5":"none",opacity:n?.8:1},`cell-${r}`)})})]})})})})]}),y==="accuracy"&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"🎯 Précision des Votes - Taux de Votes Justes"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",textAlign:"center",marginBottom:"1rem"},children:"Pourcentage de votes dirigés contre le camp adverse (et non contre son propre camp)."}),e.jsx(P,{title:"Précision des Votes - Taux de Votes Justes",children:e.jsx("div",{style:{height:500},children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(B,{data:p,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"playerName",angle:-45,textAnchor:"end",height:110,interval:0,fontSize:13,tick:({x:s,y:r,payload:a})=>{const n=i.highlightedPlayer===a.value;return e.jsx("text",{x:s,y:r,dy:16,textAnchor:"end",fill:n?"var(--accent-primary)":"var(--text-secondary)",fontSize:n?14:13,fontWeight:n?"bold":"italic",transform:`rotate(-45 ${s} ${r})`,children:a.value})}}),e.jsx(F,{label:{value:"Taux de Précision (%)",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(D,{content:({active:s,payload:r})=>{if(s&&r&&r.length>0){const a=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.playerName})}),e.jsxs("div",{children:["Nombre de meetings: ",a.totalMeetings]}),e.jsxs("div",{children:["Total de votes: ",a.totalVotes]}),e.jsxs("div",{children:["Votes justes: ",a.votesForEnemyCamp," (",a.accuracyRate.toFixed(1),"%)"]}),e.jsxs("div",{children:["Feu ami: ",a.votesForOwnCamp," (",a.friendlyFireRate.toFixed(1),"%)"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(k,{dataKey:"accuracyRate",style:{cursor:"pointer"},onClick:v,children:p.map((s,r)=>{const a=i.highlightedPlayer===s.playerName,n=s.isHighlightedAddition;return e.jsx(w,{fill:g[s.playerName]||(s.accuracyRate>=50?"var(--accent-tertiary)":"var(--accent-danger)"),stroke:a?"var(--accent-primary)":"transparent",strokeWidth:a?3:0,strokeDasharray:n?"5,5":"none",opacity:n?.8:1},`cell-${r}`)})})]})})})})]}),y==="targets"&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"🔻 Joueurs Ciblés - Taux de Survie aux Votes"}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",textAlign:"center",marginBottom:"1rem"},children:"Pourcentage de fois où le joueur a survécu après avoir été ciblé par au moins un vote."}),e.jsx(P,{title:"Joueurs Ciblés - Taux de Survie aux Votes",children:e.jsx("div",{style:{height:500},children:e.jsx(W,{width:"100%",height:"100%",children:e.jsxs(B,{data:t,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(R,{strokeDasharray:"3 3"}),e.jsx(N,{dataKey:"playerName",angle:-45,textAnchor:"end",height:110,interval:0,fontSize:13,tick:({x:s,y:r,payload:a})=>{const n=i.highlightedPlayer===a.value;return e.jsx("text",{x:s,y:r,dy:16,textAnchor:"end",fill:n?"var(--accent-primary)":"var(--text-secondary)",fontSize:n?14:13,fontWeight:n?"bold":"italic",transform:`rotate(-45 ${s} ${r})`,children:a.value})}}),e.jsx(F,{label:{value:"Taux de Survie (%)",angle:270,position:"left",style:{textAnchor:"middle"}}}),e.jsx(D,{content:({active:s,payload:r})=>{if(s&&r&&r.length>0){const a=r[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:a.playerName})}),e.jsxs("div",{children:["Fois ciblé: ",a.totalTimesTargeted]}),e.jsxs("div",{children:["Éliminé par vote: ",a.eliminationsByVote]}),e.jsxs("div",{children:["Taux de survie: ",a.survivalRate.toFixed(1),"%"]}),e.jsxs("div",{children:["Par camp ennemi: ",a.timesTargetedByEnemyCamp]}),e.jsxs("div",{children:["Par propre camp: ",a.timesTargetedByOwnCamp]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(k,{dataKey:"survivalRate",style:{cursor:"pointer"},onClick:v,children:t.map((s,r)=>{const a=i.highlightedPlayer===s.playerName,n=s.isHighlightedAddition;return e.jsx(w,{fill:g[s.playerName]||(s.survivalRate>=50?"var(--accent-tertiary)":"var(--accent-danger)"),stroke:a?"var(--accent-primary)":"transparent",strokeWidth:a?3:0,strokeDasharray:n?"5,5":"none",opacity:n?.8:1},`cell-${r}`)})})]})})})})]})]})]})}export{oe as VotingStatisticsChart};
