import{e as se,a as ae,u as le,r as t,j as e}from"./index-DsxT0PBg.js";import{c as ne,d as N,g as k,p as ce,C as ie,f as B,a as te}from"./ClipViewer-Chv5eDX4.js";import{u as re}from"./useJoueursData-DIEPCDiH.js";import{u as oe}from"./api-RtSimuNp.js";function ue(){const{data:w,isLoading:z,error:E}=se(),{joueursData:J}=re(),{settings:S}=ae(),{navigationFilters:R}=le(),[m,C]=t.useState(null),V=oe(J),[u,D]=t.useState(""),[g,F]=t.useState([]),[x,I]=t.useState(""),[f,U]=t.useState("gameNumber"),[b,M]=t.useState("desc"),[c,h]=t.useState(1),[v,W]=t.useState(25);t.useEffect(()=>{const s=R.selectedPlayer||S.highlightedPlayer;s&&I(s)},[R.selectedPlayer,S.highlightedPlayer]);const i=t.useMemo(()=>{if(!w)return[];const s=[];return w.forEach(a=>{a.Clips&&Array.isArray(a.Clips)&&a.Clips.forEach(l=>{s.push({...l,gameId:a.DisplayedId||a.Id,gameDate:a.StartDate,gameNumber:parseInt(a.DisplayedId||a.Id,10)})})}),s},[w]),O=t.useMemo(()=>ne(i).filter(a=>!a.toLowerCase().includes("warning")),[i]),$=t.useMemo(()=>{const s=new Set;return i.forEach(a=>{N(a).forEach(l=>s.add(l))}),Array.from(s).sort()},[i]),d=t.useMemo(()=>{let s=[...i];if(g.length>0&&(s=s.filter(a=>g.some(l=>(a.Tags||[]).some(o=>o.toLowerCase()===l.toLowerCase())))),x&&(s=s.filter(a=>N(a).some(l=>l.toLowerCase()===x.toLowerCase()))),u.trim()){const a=u.toLowerCase();s=s.filter(l=>{const n=k(l).toLowerCase(),o=l.AdditionalInfo?.toLowerCase()||"",A=l.ClipName?.toLowerCase()||"",_=N(l).join(" ").toLowerCase(),ee=l.gameId.toLowerCase();return n.includes(a)||o.includes(a)||A.includes(a)||_.includes(a)||ee.includes(a)})}return s.sort((a,l)=>{let n=0;switch(f){case"gameNumber":n=a.gameNumber-l.gameNumber;break;case"date":n=new Date(a.gameDate).getTime()-new Date(l.gameDate).getTime();break;case"name":n=k(a).localeCompare(k(l));break;case"pov":n=a.POVPlayer.localeCompare(l.POVPlayer);break;case"players":const o=N(a).length,A=N(l).length;n=o-A;break;default:n=0}return b==="asc"?n:-n}),s},[i,g,x,u,f,b]),r=Math.ceil(d.length/v),P=(c-1)*v,T=P+v,G=d.slice(P,T),H=s=>{F(a=>a.includes(s)?a.filter(l=>l!==s):[...a,s]),h(1)},q=()=>{D(""),F([]),I(""),h(1)},K=s=>{C(s)},Q=()=>{if(!m)return;const s=B(m,i);if(s){const a=i.find(l=>l.ClipId===s.ClipId);a&&C(a)}},X=s=>{const a=i.find(l=>l.ClipId===s);a&&C(a)},y=s=>{f===s?M(b==="asc"?"desc":"asc"):(U(s),M("desc")),h(1)},j=s=>f!==s?"â†•ï¸":b==="asc"?"â†—ï¸":"â†˜ï¸",p=s=>{h(s)},Y=s=>{W(s),h(1)},Z=s=>new Date(s).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});if(!S.clipsEnabled)return e.jsx("div",{className:"lycans-clips-page",children:e.jsxs("div",{className:"lycans-clips-disabled",children:[e.jsx("div",{className:"lycans-clips-disabled-icon",children:"ðŸŽ¬"}),e.jsx("h2",{children:"Clips dÃ©sactivÃ©s"}),e.jsx("p",{children:"Cette fonctionnalitÃ© est actuellement dÃ©sactivÃ©e."}),e.jsxs("p",{children:["Ajoutez ",e.jsx("code",{children:"?clipsEnabled=true"})," Ã  l'URL pour l'activer."]})]})});if(z)return e.jsx("div",{className:"lycans-clips-page",children:e.jsxs("div",{className:"lycans-clips-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des clips..."})]})});if(E)return e.jsx("div",{className:"lycans-clips-page",children:e.jsx("div",{className:"lycans-clips-error",children:e.jsxs("p",{children:["Erreur lors du chargement des clips : ",E]})})});if(i.length===0)return e.jsx("div",{className:"lycans-clips-page",children:e.jsxs("div",{className:"lycans-clips-empty",children:[e.jsx("div",{className:"lycans-clips-empty-icon",children:"ðŸŽ¬"}),e.jsx("h2",{children:"Aucun clip disponible"}),e.jsx("p",{children:"Il n'y a actuellement aucun clip enregistrÃ© dans les parties."})]})});const L=u.trim()||g.length>0||x;return e.jsxs("div",{className:"lycans-clips-page",children:[e.jsx("div",{className:"lycans-clips-header",children:e.jsxs("div",{className:"lycans-clips-header-info",children:[e.jsx("h2",{children:"ðŸŽ¬ BibliothÃ¨que de Clips"}),e.jsxs("p",{className:"lycans-clips-count",children:[d.length," clip",d.length!==1?"s":"",L&&` sur ${i.length}`]})]})}),e.jsxs("div",{className:"lycans-clips-filters",children:[e.jsxs("div",{className:"lycans-clips-search",children:[e.jsx("input",{type:"text",placeholder:"Rechercher par nom, description, joueur, partie...",value:u,onChange:s=>{D(s.target.value),h(1)},className:"lycans-clips-search-input"}),u&&e.jsx("button",{className:"lycans-clips-search-clear",onClick:()=>{D(""),h(1)},title:"Effacer la recherche",children:"âœ•"})]}),e.jsxs("div",{className:"lycans-clips-filter-controls",children:[e.jsxs("div",{className:"lycans-clips-filter-group",children:[e.jsx("label",{htmlFor:"player-filter",children:"Joueur :"}),e.jsxs("select",{id:"player-filter",value:x,onChange:s=>{I(s.target.value),h(1)},className:"lycans-clips-select",children:[e.jsx("option",{value:"",children:"Tous les joueurs"}),$.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),L&&e.jsx("button",{className:"lycans-clips-clear-filters",onClick:q,children:"âœ• RÃ©initialiser les filtres"})]}),O.length>0&&e.jsxs("div",{className:"lycans-clips-tags-filter",children:[e.jsx("label",{children:"CatÃ©gories :"}),e.jsx("div",{className:"lycans-clips-tags-list",children:O.map(s=>e.jsxs("button",{className:`lycans-clips-tag-btn ${g.includes(s)?"active":""}`,onClick:()=>H(s),children:[s,g.includes(s)&&e.jsx("span",{className:"tag-check",children:"âœ“"})]},s))})]})]}),d.length===0?e.jsxs("div",{className:"lycans-clips-no-results",children:[e.jsx("div",{className:"lycans-clips-no-results-icon",children:"ðŸ”"}),e.jsx("h3",{children:"Aucun clip trouvÃ©"}),e.jsx("p",{children:"Essayez de modifier vos filtres de recherche."}),L&&e.jsx("button",{className:"lycans-clips-clear-filters-btn",onClick:q,children:"RÃ©initialiser les filtres"})]}):e.jsxs(e.Fragment,{children:[r>1&&e.jsxs("div",{className:"lycans-pagination-container",children:[e.jsxs("div",{className:"lycans-pagination-info",children:["Affichage de ",P+1," Ã  ",Math.min(T,d.length)," sur ",d.length," clips"]}),e.jsxs("div",{className:"lycans-pagination-controls",children:[e.jsxs("select",{value:v,onChange:s=>Y(Number(s.target.value)),className:"lycans-pagination-select",children:[e.jsx("option",{value:10,children:"10 par page"}),e.jsx("option",{value:25,children:"25 par page"}),e.jsx("option",{value:50,children:"50 par page"}),e.jsx("option",{value:100,children:"100 par page"})]}),e.jsxs("div",{className:"lycans-pagination-buttons",children:[e.jsx("button",{onClick:()=>p(1),disabled:c===1,className:"lycans-pagination-btn",children:"Â«Â«"}),e.jsx("button",{onClick:()=>p(c-1),disabled:c===1,className:"lycans-pagination-btn",children:"â€¹"}),e.jsxs("span",{className:"lycans-pagination-current",children:["Page ",c," sur ",r]}),e.jsx("button",{onClick:()=>p(c+1),disabled:c===r,className:"lycans-pagination-btn",children:"â€º"}),e.jsx("button",{onClick:()=>p(r),disabled:c===r,className:"lycans-pagination-btn",children:"Â»Â»"})]})]})]}),e.jsx("div",{className:"lycans-clips-table-container",children:e.jsxs("table",{className:"lycans-clips-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>y("gameNumber"),className:"sortable",children:["Partie ",j("gameNumber")]}),e.jsxs("th",{onClick:()=>y("date"),className:"sortable",children:["Date ",j("date")]}),e.jsxs("th",{onClick:()=>y("name"),className:"sortable",children:["Nom ",j("name")]}),e.jsxs("th",{onClick:()=>y("pov"),className:"sortable",children:["POV ",j("pov")]}),e.jsxs("th",{onClick:()=>y("players"),className:"sortable",children:["Personnes impliquÃ©es ",j("players")]}),e.jsx("th",{children:"Tags"}),e.jsx("th",{children:"Voir"})]})}),e.jsx("tbody",{children:G.map(s=>{const a=ce(s.OthersPlayers),l=(s.Tags||[]).filter(n=>!n.toLowerCase().includes("warning"));return e.jsxs("tr",{children:[e.jsxs("td",{children:["#",s.gameId]}),e.jsx("td",{children:Z(s.gameDate)}),e.jsx("td",{className:"lycans-clip-name-cell",children:k(s)}),e.jsx("td",{children:e.jsx("span",{className:"lycans-clip-pov-badge",style:{backgroundColor:V[s.POVPlayer]||"var(--accent-primary)",color:"white"},children:s.POVPlayer})}),e.jsx("td",{className:"lycans-clip-players-cell",children:a.length>0?a.map((n,o)=>e.jsxs("span",{style:{color:V[n]||"var(--text-secondary)",fontWeight:500},children:[n,o<a.length-1?", ":""]},o)):"-"}),e.jsx("td",{className:"lycans-clip-tags-cell",children:l.length>0?e.jsx("div",{className:"lycans-clip-tags-inline",children:l.map((n,o)=>e.jsx("span",{className:"lycans-clip-tag-small",children:n},o))}):"-"}),e.jsx("td",{children:e.jsx("button",{onClick:()=>K(s),className:"lycans-clip-view-btn",children:"ðŸŽ¬ Voir"})})]},s.ClipId)})})]})}),r>1&&e.jsxs("div",{className:"lycans-pagination-container",children:[e.jsxs("div",{className:"lycans-pagination-info",children:["Affichage de ",P+1," Ã  ",Math.min(T,d.length)," sur ",d.length," clips"]}),e.jsx("div",{className:"lycans-pagination-controls",children:e.jsxs("div",{className:"lycans-pagination-buttons",children:[e.jsx("button",{onClick:()=>p(1),disabled:c===1,className:"lycans-pagination-btn",children:"Â«Â«"}),e.jsx("button",{onClick:()=>p(c-1),disabled:c===1,className:"lycans-pagination-btn",children:"â€¹"}),e.jsxs("span",{className:"lycans-pagination-current",children:["Page ",c," sur ",r]}),e.jsx("button",{onClick:()=>p(c+1),disabled:c===r,className:"lycans-pagination-btn",children:"â€º"}),e.jsx("button",{onClick:()=>p(r),disabled:c===r,className:"lycans-pagination-btn",children:"Â»Â»"})]})})]})]}),m&&e.jsx(ie,{clip:m,onClose:()=>C(null),relatedClips:te(m,i),nextClip:B(m,i),onNextClip:Q,onRelatedClip:X})]})}export{ue as ClipsPage};
