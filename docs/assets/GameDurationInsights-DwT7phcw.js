import{u as G,j as t}from"./index-DCpoS_oe.js";import{a as M}from"./baseStatsHook-CJib86J1.js";import{a as N,l as C}from"./api-beq3FXpM.js";import{F as p,B as v,C as x,X as D,Y as f,a as j,b as A}from"./FullscreenChart-CaBsMOYs.js";import{R as y,T as g,Q as B}from"./CategoricalChart-iECuOcaC.js";import{L as R,a as T}from"./LineChart-B2JEVGDi.js";import{L as k}from"./Legend-D-Rg6lHi.js";import"./ActivePoints-cqQXTzc_.js";function L(e,r){if(!e||!r)return null;try{const n=l=>{const u=new URL(l);let a=0;if(u.hostname==="youtu.be"){const i=u.searchParams.get("t");if(i)if(i.includes("h")||i.includes("m")||i.includes("s")){const c=i.match(/(\d+)h/)?.[1]||"0",m=i.match(/(\d+)m/)?.[1]||"0",d=i.match(/(\d+)s/)?.[1]||"0";a=parseInt(c)*3600+parseInt(m)*60+parseInt(d)}else a=parseInt(i)||0}else if(u.hostname==="www.youtube.com"||u.hostname==="youtube.com"){const i=u.searchParams.get("t");if(i)if(i.includes("h")||i.includes("m")||i.includes("s")){const c=i.match(/(\d+)h/)?.[1]||"0",m=i.match(/(\d+)m/)?.[1]||"0",d=i.match(/(\d+)s/)?.[1]||"0";a=parseInt(c)*3600+parseInt(m)*60+parseInt(d)}else a=parseInt(i)||0}return a},o=n(e),s=n(r);return s>o?s-o:null}catch(n){return console.warn("Failed to calculate game duration:",e,r,n),null}}function h(e){const r=Math.floor(e/3600),n=Math.floor(e%3600/60),o=e%60;return r>0?`${r}h${n.toString().padStart(2,"0")}m${o.toString().padStart(2,"0")}s`:n>0?`${n}m${o.toString().padStart(2,"0")}s`:`${o}s`}function F(e,r=10){const n=Math.round(e/60);return Math.round(n/r)*r}function P(){return{averageDuration:"0s",maxDuration:0,minDuration:1/0,maxDurationGameId:null,minDurationGameId:null,durationDistribution:{},durationsByWinnerCamp:{},durationsByPlayerCount:{},durationsByWolfRatio:{}}}function W(e,r,n){e>n.maxDuration&&(n.maxDuration=e,n.maxDurationGameId=r),e<n.minDuration&&(n.minDuration=e,n.minDurationGameId=r)}function w(e,r){const n=F(e,2);r[n]||(r[n]=0),r[n]++}function $(e,r,n){e&&e.trim()!==""&&(n[e]||(n[e]={totalDuration:0,count:0,average:"0s"}),n[e].totalDuration+=r,n[e].count++)}function q(e,r,n){if(e&&!isNaN(e)&&e>0){const o=e.toString();n[o]||(n[o]={totalDuration:0,count:0,average:"0s"}),n[o].totalDuration+=r,n[o].count++}}function z(e,r,n,o){if(e&&r&&!isNaN(e)&&!isNaN(r)&&e>0){const s=e-r;if(s>0){const l=Math.round(r/s*100),a=(Math.round(l/1)*1).toString();o[a]||(o[a]={totalDuration:0,count:0,average:"0s"}),o[a].totalDuration+=n,o[a].count++}}}function E(e,r,n){const o=e["Camp victorieux"],s=e["Nombre de joueurs"],l=e["Nombre de loups"],u=L(e.D√©but,e.Fin);u&&!isNaN(u)&&u>0&&(n.gamesWithDuration++,n.totalDuration+=u,W(u,e.Game,r),w(u,r.durationDistribution),$(o,u,r.durationsByWinnerCamp),q(s,u,r.durationsByPlayerCount),z(s,l,u,r.durationsByWolfRatio))}function K(e,r){if(r.gamesWithDuration>0){const n=r.totalDuration/r.gamesWithDuration;e.averageDuration=h(Math.round(n)),Object.keys(e.durationsByWinnerCamp).forEach(o=>{const s=e.durationsByWinnerCamp[o];if(s.count>0){const l=s.totalDuration/s.count;s.average=h(Math.round(l))}}),Object.keys(e.durationsByPlayerCount).forEach(o=>{const s=e.durationsByPlayerCount[o];if(s.count>0){const l=s.totalDuration/s.count;s.average=h(Math.round(l))}}),Object.keys(e.durationsByWolfRatio).forEach(o=>{const s=e.durationsByWolfRatio[o];if(s.count>0){const l=s.totalDuration/s.count;s.average=h(Math.round(l))}})}}function O(e){const r=Object.keys(e).map(n=>({duration:parseInt(n),count:e[parseInt(n)]}));return r.sort((n,o)=>n.duration-o.duration),r}function S(e){if(e.length===0)return null;const r=P(),n={totalDuration:0,gamesWithDuration:0};e.forEach(s=>{E(s,r,n)}),K(r,n);const o=O(r.durationDistribution);return{averageDuration:r.averageDuration,maxDuration:r.maxDuration,minDuration:r.minDuration===1/0?0:r.minDuration,maxDurationGameId:r.maxDurationGameId,minDurationGameId:r.minDurationGameId,durationDistribution:o,durationsByWinnerCamp:r.durationsByWinnerCamp,durationsByPlayerCount:r.durationsByPlayerCount,durationsByWolfRatio:r.durationsByWolfRatio}}function V(){const{data:e,isLoading:r,error:n}=M(S);return{durationAnalysis:e,fetchingData:r,apiError:n}}function ee(){const{durationAnalysis:e,fetchingData:r,apiError:n}=V(),{navigateToGameDetails:o}=G();if(r)return t.jsx("div",{className:"statistiques-attente",children:"Analyse des dur√©es de partie en cours..."});if(n)return t.jsxs("div",{className:"statistiques-echec",children:["Probl√®me rencontr√©: ",n]});if(!e)return t.jsx("div",{className:"statistiques-indisponibles",children:"Donn√©es d'analyse non disponibles"});const s=a=>{const i=a.match(/(\d+)h/),c=a.match(/(\d+)m/),m=a.match(/(\d+)s/),d=i?parseInt(i[1]):0,b=c?parseInt(c[1]):0,I=m?parseInt(m[1]):0;return d*60+b+I/60},l=e?Object.entries(e.durationsByWolfRatio).map(([a,i])=>({ratio:parseFloat(a),moyenne:s(i.average),parties:i.count,dureeFormatee:i.average})).sort((a,i)=>a.ratio-i.ratio):[],u=e?Object.entries(e.durationsByWinnerCamp).map(([a,i])=>({camp:a,moyenne:s(i.average),parties:i.count,dureeFormatee:i.average})).sort((a,i)=>i.moyenne-a.moyenne):[];return t.jsxs("div",{className:"lycans-duree-analyse",children:[t.jsx("h2",{children:"Analyse des Dur√©es de Partie"}),t.jsxs("div",{className:"lycans-resume-conteneur",children:[t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Dur√©e Moyenne"}),t.jsx("p",{className:"lycans-valeur-principale",children:e.averageDuration||"N/A"})]}),t.jsxs("div",{className:"lycans-stat-carte",onClick:()=>{e.minDurationGameId&&o({selectedGame:e.minDurationGameId,fromComponent:"Analyse des Dur√©es de Partie"})},style:{cursor:e.minDurationGameId?"pointer":"default",opacity:e.minDurationGameId?1:.7,transition:"transform 0.2s ease, box-shadow 0.2s ease"},onMouseEnter:a=>{e.minDurationGameId&&(a.currentTarget.style.transform="translateY(-2px)",a.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)")},onMouseLeave:a=>{e.minDurationGameId&&(a.currentTarget.style.transform="translateY(0)",a.currentTarget.style.boxShadow="")},title:e.minDurationGameId?"Cliquez pour voir cette partie":"Aucune partie trouv√©e",children:[t.jsx("h3",{children:"Dur√©e Minimum"}),t.jsxs("p",{className:"lycans-valeur-principale",children:[Math.floor(e.minDuration/60),"min ",e.minDuration%60,"s"]}),e.minDurationGameId&&t.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:["üñ±Ô∏è Partie #",e.minDurationGameId]})]}),t.jsxs("div",{className:"lycans-stat-carte",onClick:()=>{e.maxDurationGameId&&o({selectedGame:e.maxDurationGameId,fromComponent:"Analyse des Dur√©es de Partie"})},style:{cursor:e.maxDurationGameId?"pointer":"default",opacity:e.maxDurationGameId?1:.7,transition:"transform 0.2s ease, box-shadow 0.2s ease"},onMouseEnter:a=>{e.maxDurationGameId&&(a.currentTarget.style.transform="translateY(-2px)",a.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)")},onMouseLeave:a=>{e.maxDurationGameId&&(a.currentTarget.style.transform="translateY(0)",a.currentTarget.style.boxShadow="")},title:e.maxDurationGameId?"Cliquez pour voir cette partie":"Aucune partie trouv√©e",children:[t.jsx("h3",{children:"Dur√©e Maximum"}),t.jsxs("p",{className:"lycans-valeur-principale",children:[Math.floor(e.maxDuration/60),"min ",e.maxDuration%60,"s"]}),e.maxDurationGameId&&t.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:["üñ±Ô∏è Partie #",e.maxDurationGameId]})]})]}),t.jsxs("div",{className:"lycans-graphiques-section",children:[t.jsxs("div",{className:"lycans-graphique-element",children:[t.jsx("h3",{children:"Distribution des Dur√©es de Partie"}),t.jsx(p,{title:"Distribution des Dur√©es de Partie",children:t.jsx("div",{style:{height:300},children:t.jsx(y,{width:"100%",height:"100%",children:t.jsxs(v,{data:e?.durationDistribution||[],margin:{top:20,right:30,left:20,bottom:5},children:[t.jsx(x,{strokeDasharray:"3 3"}),t.jsx(D,{dataKey:"duration",label:{value:"Dur√©e (minutes)",position:"insideBottom",offset:-5},tickFormatter:a=>`${a}min`}),t.jsx(f,{label:{value:"Nombre de Parties",angle:-90,position:"insideLeft"}}),t.jsx(g,{content:({active:a,payload:i})=>{if(a&&i&&i.length>0){const c=i[0].payload;return t.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[t.jsx("div",{children:t.jsxs("strong",{children:["~",c.duration," minutes"]})}),t.jsxs("div",{children:[c.count," parties"]}),t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:"Dur√©es regroup√©es par intervalles de 2 minutes"})]})}return null}}),t.jsx(j,{dataKey:"count",name:"Nombre de Parties",fill:"var(--chart-color-2)"})]})})})})]}),t.jsxs("div",{className:"lycans-graphique-element",children:[t.jsx("h3",{children:"Dur√©e Moyenne par Ratio Loups/Villageois"}),t.jsx(p,{title:"Dur√©e Moyenne par Ratio Loups/Villageois",children:t.jsx("div",{style:{height:300},children:t.jsx(y,{width:"100%",height:"100%",children:t.jsxs(R,{data:l,margin:{top:20,right:30,left:20,bottom:5},children:[t.jsx(x,{strokeDasharray:"3 3"}),t.jsx(D,{dataKey:"ratio",type:"number",domain:["auto","auto"],allowDecimals:!1,tickFormatter:a=>`${a}%`,label:{value:"Ratio Loups/Joueurs (%)",position:"insideBottom",offset:-5}}),t.jsx(f,{label:{value:"Dur√©e Moyenne (minutes)",angle:-90,position:"insideLeft"},tickFormatter:a=>`${Math.round(a)}min`}),t.jsx(g,{content:({active:a,payload:i})=>{if(a&&i&&i.length>0){const c=i[0].payload;return t.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[t.jsx("div",{children:t.jsxs("strong",{children:["Pourcentage de loups : ",c.ratio,"%"]})}),t.jsxs("div",{children:["Dur√©e moyenne : ",c.dureeFormatee]}),t.jsxs("div",{children:["Nombre de parties : ",c.parties]})]})}return null}}),t.jsx(k,{}),t.jsx(T,{type:"monotone",dataKey:"moyenne",name:"Dur√©e Moyenne",stroke:"var(--chart-color-5)",activeDot:{r:8}})]})})})})]}),t.jsxs("div",{className:"lycans-graphique-element",children:[t.jsx("h3",{children:"Dur√©e Moyenne par Camp Victorieux"}),t.jsx(p,{title:"Dur√©e Moyenne par Camp Victorieux",children:t.jsx("div",{style:{height:300},children:t.jsx(y,{width:"100%",height:"100%",children:t.jsxs(v,{data:u,margin:{top:20,right:30,left:20,bottom:60},children:[t.jsx(x,{strokeDasharray:"3 3"}),t.jsx(D,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0}),t.jsx(f,{label:{value:"Dur√©e Moyenne (minutes)",angle:-90,position:"insideLeft"},tickFormatter:a=>`${Math.round(a)}min`}),t.jsx(g,{content:({active:a,payload:i})=>{if(a&&i&&i.length>0){const c=i[0].payload;return t.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[t.jsx("div",{children:t.jsx("strong",{children:c.camp})}),t.jsxs("div",{children:["Dur√©e moyenne : ",c.dureeFormatee]}),t.jsxs("div",{children:["Nombre de parties : ",c.parties]}),t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})}return null}}),t.jsxs(j,{dataKey:"moyenne",name:"moyenne",isAnimationActive:!1,onClick:a=>{a&&a.camp&&o({campFilter:{selectedCamp:a.camp,campFilterMode:"wins-only"},fromComponent:"Dur√©e Moyenne par Camp Victorieux"})},style:{cursor:"pointer"},children:[u.map(a=>t.jsx(A,{fill:N[a.camp]||C},`cell-${a.camp}`)),t.jsx(B,{dataKey:"moyenne",position:"top",formatter:a=>{const i=typeof a=="number"?a:Number(a);return isNaN(i)?"":`${Math.round(i)}min`},fill:"var(--text-primary)",fontSize:12})]})]})})})})]})]})]})}export{ee as GameDurationInsights};
