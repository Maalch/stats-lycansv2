import{r as M,j as e}from"./index-CGtHA2Ok.js";import{a as J}from"./baseStatsHook-DlvhasQ7.js";import{a as Q,g as Z}from"./datasyncExport-BirWLS1z.js";import{F as k,C as P,X as B,Y as L,a as E}from"./FullscreenChart-CN0QW_SE.js";import{b as ee}from"./api-B5xp375K.js";import{R as F,T as G}from"./CategoricalChart-Dk0YC06Q.js";import{B as V,a as q}from"./BarChart-BKO4CwUO.js";import{R as $}from"./ReferenceLine-Bn-wq5eS.js";function D(a){if(!a)return null;const p=a.match(/\d+/);return p?parseInt(p[0],10):null}function O(a){const p=Q(a.MainRoleInitial,a.MainRoleChanges||[]);return Z(p,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!1},a.Power)}function se(a,p){return a.filter(x=>x.ActionType===p)}function te(a,p){const x=se(a,p);return x.length===0?null:x.sort((f,b)=>new Date(f.Date).getTime()-new Date(b.Date).getTime())[0]}function ie(a){const p=a.filter(i=>i.Modded),x=new Map,f=new Map,b=new Map,j=new Map;let U=0,C=0;p.forEach(i=>{let s=!1;i.PlayerStats.forEach(r=>{const l=O(r),c=r.Victorious,u=r.Actions||[];if(u.length>0&&(s=!0,U+=u.length),u.filter(o=>o.ActionType==="UseGadget"&&o.ActionName&&o.ActionName!=="Balle").forEach(o=>{const h=o.ActionName;x.has(h)||x.set(h,{uses:0,wins:0,camp:new Map});const d=x.get(h);d.uses++,c&&d.wins++,d.camp.has(l)||d.camp.set(l,{uses:0,wins:0});const g=d.camp.get(l);g.uses++,c&&g.wins++}),u.filter(o=>o.ActionType==="DrinkPotion"&&o.ActionName).forEach(o=>{const h=o.ActionName;f.has(h)||f.set(h,{uses:0,wins:0,camp:new Map});const d=f.get(h);d.uses++,c&&d.wins++,d.camp.has(l)||d.camp.set(l,{uses:0,wins:0});const g=d.camp.get(l);g.uses++,c&&g.wins++}),r.MainRoleInitial==="Loup"||r.MainRoleInitial==="TraÃ®tre"||r.MainRoleInitial==="Louveteau"){const o=te(u,"Transform");if(o){const h=D(o.Timing);let d="N3+";h===1?d="N1":h===2&&(d="N2"),b.has(d)||b.set(d,{games:0,wins:0});const g=b.get(d);g.games++,c&&g.wins++}}u.filter(o=>o.ActionType==="UsePower"&&o.ActionName).forEach(o=>{const h=o.ActionName,d=D(o.Timing)||0,g=d<=2;j.has(h)||j.set(h,{uses:0,wins:0,timings:[],earlyUses:0,earlyWins:0,lateUses:0,lateWins:0});const v=j.get(h);v.uses++,c&&v.wins++,v.timings.push(d),g?(v.earlyUses++,c&&v.earlyWins++):(v.lateUses++,c&&v.lateWins++)})}),s&&C++});const y=new Map,w=new Map;let T=0,W=0;p.forEach(i=>{i.PlayerStats.forEach(s=>{const r=O(s);T++,s.Victorious&&W++,w.has(r)||w.set(r,{wins:0,total:0});const l=w.get(r);l.total++,s.Victorious&&l.wins++})}),w.forEach((i,s)=>{y.set(s,i.total>0?i.wins/i.total*100:50)});const N=T>0?W/T*100:50,A=["Loup","TraÃ®tre","Louveteau"],S=["Villageois"],t=i=>{let s=0,r=0;return w.forEach((l,c)=>{i.includes(c)&&(s+=l.wins,r+=l.total)}),r>0?s/r*100:50},n=()=>{let i=0,s=0;return w.forEach((r,l)=>{!S.includes(l)&&!A.includes(l)&&(i+=r.wins,s+=r.total)}),s>0?i/s*100:50},m=t(S),z=t(A),I=n(),K=i=>{let s=0,r=0;i.forEach((g,v)=>{S.includes(v)&&(s+=g.uses,r+=g.wins)});const l=s>0?r/s*100:0;let c=0,u=0;i.forEach((g,v)=>{A.includes(v)&&(c+=g.uses,u+=g.wins)});const R=c>0?u/c*100:0;let o=0,h=0;i.forEach((g,v)=>{!S.includes(v)&&!A.includes(v)&&(o+=g.uses,h+=g.wins)});const d=o>0?h/o*100:0;return{villageois:{uses:s,wins:r,winRate:l,baselineWinRate:m,delta:l-m},loups:{uses:c,wins:u,winRate:R,baselineWinRate:z,delta:R-z},autres:{uses:o,wins:h,winRate:d,baselineWinRate:I,delta:d-I}}},X=Array.from(x.entries()).map(([i,s])=>{const r=s.uses>0?s.wins/s.uses*100:0,l=Array.from(s.camp.entries()).map(([c,u])=>{const R=u.uses>0?u.wins/u.uses*100:0,o=y.get(c)||50;return{camp:c,winRate:R,uses:u.uses,wins:u.wins,delta:R-o}});return{itemName:i,actionType:"UseGadget",totalUses:s.uses,winRate:r,wins:s.wins,losses:s.uses-s.wins,baselineWinRate:N,delta:r-N,campBreakdown:l,aggregatedCampStats:K(s.camp)}}).sort((i,s)=>s.totalUses-i.totalUses),Y=Array.from(f.entries()).map(([i,s])=>{const r=s.uses>0?s.wins/s.uses*100:0,l=Array.from(s.camp.entries()).map(([c,u])=>{const R=u.uses>0?u.wins/u.uses*100:0,o=y.get(c)||50;return{camp:c,winRate:R,uses:u.uses,wins:u.wins,delta:R-o}});return{itemName:i,actionType:"DrinkPotion",totalUses:s.uses,winRate:r,wins:s.wins,losses:s.uses-s.wins,baselineWinRate:N,delta:r-N,campBreakdown:l,aggregatedCampStats:K(s.camp)}}).sort((i,s)=>s.totalUses-i.totalUses),H=["N1","N2","N3+"].map(i=>{const s=b.get(i)||{games:0,wins:0};return{timing:i,gamesCount:s.games,wins:s.wins,losses:s.games-s.wins,winRate:s.games>0?s.wins/s.games*100:0}}).filter(i=>i.gamesCount>0),_=Array.from(j.entries()).map(([i,s])=>{const r=s.timings.length>0?s.timings.reduce((l,c)=>l+c,0)/s.timings.length:0;return{powerName:i,totalUses:s.uses,averageTiming:r,winRate:s.uses>0?s.wins/s.uses*100:0,earlyUseWinRate:s.earlyUses>0?s.earlyWins/s.earlyUses*100:0,lateUseWinRate:s.lateUses>0?s.lateWins/s.lateUses*100:0}}).filter(i=>i.totalUses>=5).sort((i,s)=>s.totalUses-i.totalUses);return{gadgetStats:X,potionStats:Y,wolfTransformTiming:H,powerUsageStats:_,overallStats:{totalGamesAnalyzed:p.length,totalActionsRecorded:U,averageActionsPerGame:p.length>0?U/p.length:0,gamesWithActions:C}}}function ne(){const{data:a,isLoading:p,error:x}=J(ie);return{actionMetaStats:a,isLoading:p,error:x}}function ge(){const{actionMetaStats:a,isLoading:p,error:x}=ne(),[f,b]=M.useState("gadgets"),[j,U]=M.useState("all"),C=ee(),y=10,w=M.useMemo(()=>a?a.gadgetStats.map(t=>{if(j==="all")return t.totalUses>=y?{name:t.itemName,delta:t.delta,winRate:t.winRate,uses:t.totalUses}:null;const n=t.aggregatedCampStats[j];return n.uses>=y?{name:t.itemName,delta:n.delta,winRate:n.winRate,uses:n.uses}:null}).filter(t=>t!==null).sort((t,n)=>n.uses-t.uses):[],[a,y,j]),T=M.useMemo(()=>a?a.potionStats.map(t=>{if(j==="all")return t.totalUses>=y?{name:t.itemName,delta:t.delta,winRate:t.winRate,uses:t.totalUses}:null;const n=t.aggregatedCampStats[j];return n.uses>=y?{name:t.itemName,delta:n.delta,winRate:n.winRate,uses:n.uses}:null}).filter(t=>t!==null).sort((t,n)=>n.uses-t.uses):[],[a,y,j]);if(p)return e.jsx("div",{className:"lycans-chargement",children:"Chargement des statistiques d'actions..."});if(x)return e.jsxs("div",{className:"lycans-erreur",children:["Erreur: ",x]});if(!a)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"});const W=()=>e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"ðŸŽ® Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.overallStats.totalGamesAnalyzed}),e.jsx("p",{children:"parties moddÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"âš¡ Actions totales"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.overallStats.totalActionsRecorded}),e.jsxs("p",{children:[a.overallStats.averageActionsPerGame.toFixed(1)," par partie"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"ï¿½ðŸ”§ Gadgets uniques"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.gadgetStats.length}),e.jsx("p",{children:"types diffÃ©rents"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"ðŸ§ª Potions uniques"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.potionStats.length}),e.jsx("p",{children:"types diffÃ©rents"})]})]}),N=()=>w.length===0?e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucun gadget avec au moins ",y," utilisations."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"RÃ©duisez le filtre d'utilisations minimales pour voir plus de donnÃ©es."})]}):e.jsxs(k,{title:"Impact des Gadgets sur le Taux de Victoire",children:[e.jsx("div",{style:{height:Math.max(400,w.length*30)},children:e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(V,{data:w,layout:"vertical",margin:{top:20,right:100,left:150,bottom:20},children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(B,{type:"number",label:{value:"DiffÃ©rence du taux de victoire (%)",position:"bottom",style:{textAnchor:"middle"}},domain:[-20,20],tickFormatter:t=>Math.round(t).toString()}),e.jsx(L,{type:"category",dataKey:"name",width:140,tick:{fontSize:12}}),e.jsx($,{x:0,stroke:"var(--text-secondary)",strokeWidth:2}),e.jsx(G,{content:({active:t,payload:n})=>{if(t&&n&&n.length>0){const m=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.name})}),e.jsxs("div",{children:["Taux de victoire: ",m.winRate.toFixed(1),"%"]}),e.jsxs("div",{children:["Impact: ",m.delta>0?"+":"",m.delta.toFixed(1),"%"]}),e.jsxs("div",{children:["Utilisations: ",m.uses]})]})}return null}}),e.jsx(q,{dataKey:"delta",children:w.map((t,n)=>e.jsx(E,{fill:t.delta>0?"var(--success-color, #82ca9d)":"var(--danger-color, #ff6b6b)"},`cell-${n}`))})]})})}),e.jsxs("div",{style:{marginTop:20,fontSize:"0.85rem",color:"var(--text-secondary)"},children:[e.jsx("p",{children:"ðŸ’¡ Les valeurs positives indiquent que l'utilisation du gadget est corrÃ©lÃ©e Ã  un taux de victoire supÃ©rieur Ã  la moyenne."}),e.jsx("p",{children:"Les valeurs nÃ©gatives suggÃ¨rent une corrÃ©lation avec un taux de victoire infÃ©rieur."})]})]}),A=()=>T.length===0?e.jsxs("div",{className:"donnees-manquantes",children:[e.jsxs("p",{children:["Aucune potion avec au moins ",y," utilisations."]}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"RÃ©duisez le filtre d'utilisations minimales pour voir plus de donnÃ©es."})]}):e.jsxs(k,{title:"Impact des Potions sur le Taux de Victoire",children:[e.jsx("div",{style:{height:Math.max(400,T.length*30)},children:e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(V,{data:T,layout:"vertical",margin:{top:20,right:100,left:150,bottom:20},children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(B,{type:"number",label:{value:"DiffÃ©rence du taux de victoire (%)",position:"bottom",style:{textAnchor:"middle"}},domain:[-20,20],tickFormatter:t=>Math.round(t).toString()}),e.jsx(L,{type:"category",dataKey:"name",width:140,tick:{fontSize:12}}),e.jsx($,{x:0,stroke:"var(--text-secondary)",strokeWidth:2}),e.jsx(G,{content:({active:t,payload:n})=>{if(t&&n&&n.length>0){const m=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:m.name})}),e.jsxs("div",{children:["Taux de victoire: ",m.winRate.toFixed(1),"%"]}),e.jsxs("div",{children:["Impact: ",m.delta>0?"+":"",m.delta.toFixed(1),"%"]}),e.jsxs("div",{children:["Utilisations: ",m.uses]})]})}return null}}),e.jsx(q,{dataKey:"delta",children:T.map((t,n)=>e.jsx(E,{fill:t.delta>0?"var(--success-color, #82ca9d)":"var(--danger-color, #ff6b6b)"},`cell-${n}`))})]})})}),e.jsxs("div",{style:{marginTop:20,fontSize:"0.85rem",color:"var(--text-secondary)"},children:[e.jsx("p",{children:"ðŸ’¡ Les valeurs positives indiquent que l'utilisation de la potion est corrÃ©lÃ©e Ã  un taux de victoire supÃ©rieur Ã  la moyenne."}),e.jsx("p",{children:"Les valeurs nÃ©gatives suggÃ¨rent une corrÃ©lation avec un taux de victoire infÃ©rieur."})]})]}),S=()=>a.wolfTransformTiming.length===0?e.jsx("div",{className:"donnees-manquantes",children:e.jsx("p",{children:"Aucune donnÃ©e de transformation de loup disponible."})}):e.jsxs(k,{title:"Impact du Timing de PremiÃ¨re Transformation (Loups)",children:[e.jsx("div",{style:{height:400},children:e.jsx(F,{width:"100%",height:"100%",children:e.jsxs(V,{data:a.wolfTransformTiming,margin:{top:20,right:30,left:60,bottom:60},children:[e.jsx(P,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(B,{dataKey:"timing",label:{value:"Timing de premiÃ¨re transformation",position:"bottom",offset:0}}),e.jsx(L,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(G,{content:({active:t,payload:n})=>{if(t&&n&&n.length>0){const m=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Transformation en ",m.timing]})}),e.jsxs("div",{children:["Taux de victoire: ",m.winRate.toFixed(1),"%"]}),e.jsxs("div",{children:["Parties: ",m.gamesCount]}),e.jsxs("div",{children:["Victoires: ",m.wins," / DÃ©faites: ",m.losses]})]})}return null}}),e.jsx(q,{dataKey:"winRate",fill:C.Loup||"var(--wolf-color)",children:a.wolfTransformTiming.map((t,n)=>e.jsx(E,{},`cell-${n}`))})]})})}),e.jsxs("div",{style:{marginTop:20,fontSize:"0.85rem",color:"var(--text-secondary)"},children:[e.jsx("p",{children:"ðŸº Analyse du moment de la premiÃ¨re transformation en loup et son impact sur les chances de victoire."}),e.jsx("p",{children:"N1 = Nuit 1, N2 = Nuit 2, N3+ = Nuit 3 ou plus tard"})]})]});return e.jsxs("div",{children:[W(),e.jsxs("div",{className:"lycans-submenu",children:[e.jsx("button",{type:"button",className:`lycans-submenu-btn ${f==="gadgets"?"active":""}`,onClick:()=>b("gadgets"),children:"ðŸ”§ Gadgets"}),e.jsx("button",{type:"button",className:`lycans-submenu-btn ${f==="potions"?"active":""}`,onClick:()=>b("potions"),children:"ðŸ§ª Potions"}),e.jsx("button",{type:"button",className:`lycans-submenu-btn ${f==="wolfTiming"?"active":""}`,onClick:()=>b("wolfTiming"),children:"ðŸº Timing Loups"})]}),(f==="gadgets"||f==="potions")&&e.jsx("div",{className:"lycans-controles-groupe",style:{marginBottom:"1rem"},children:e.jsxs("div",{className:"lycans-filtre-groupe",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-action",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-action",value:j,onChange:t=>U(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.25rem 0.5rem",fontSize:"0.9rem"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"villageois",children:"Camp Villageois"}),e.jsx("option",{value:"loups",children:"Camp Loups"}),e.jsx("option",{value:"autres",children:"Autres (Solo)"})]})]})}),e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[f==="gadgets"&&N(),f==="potions"&&A(),f==="wolfTiming"&&S()]})})]})}export{ge as ActionMetaStatsChart};
