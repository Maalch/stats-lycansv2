import{r as j,u as G,a as S,j as s,l as R,k as w}from"./index-D8Q_iex3.js";import{u as A,g as L}from"./api-D_eto6MP.js";function E(n){const[m,k]=j.useState(null),[p,C]=j.useState(!1),[h,v]=j.useState(null);j.useEffect(()=>{let c=!0;return(async()=>{try{C(!0),v(null);const d=await fetch("/data/playerAchievements.json");if(!d.ok)throw new Error(`Failed to load achievements: ${d.status} ${d.statusText}`);const f=await d.json();c&&(k(f),console.log("✅ Pre-calculated achievements loaded:",{totalPlayers:f.totalPlayers,totalGames:f.totalGames,generatedAt:f.generatedAt,playersWithAchievements:Object.keys(f.achievements).length}))}catch(d){c&&(v(d instanceof Error?d.message:"Failed to load achievements"),console.error("Error loading pre-calculated achievements:",d))}finally{c&&C(!1)}})(),()=>{c=!1}},[]);const b=n&&m?.achievements[n]||null;return j.useEffect(()=>{if(n&&m){const c=m.achievements[n];c?console.log(`🏆 Achievements for ${n}:`,{allGames:c.allGamesAchievements.length,moddedOnly:c.moddedOnlyAchievements.length,categories:[...new Set([...c.allGamesAchievements.map(g=>g.category),...c.moddedOnlyAchievements.map(g=>g.category)])]}):console.log(`❌ No achievements found for ${n}`)}},[n,m]),{data:b,isLoading:p,error:h,metadata:{generatedAt:m?.generatedAt||null,totalPlayers:m?.totalPlayers||0,totalGames:m?.totalGames||0,totalModdedGames:m?.totalModdedGames||0}}}function q({achievements:n,title:m,emptyMessage:k,achievementType:p="all"}){const{navigateToTab:C,updateNavigationState:h,clearNavigation:v}=G(),{settings:b,updateSettings:c}=S(),g=A(),d=(e,i)=>{if(i.stopPropagation(),!e.redirectTo)return;v();const l=b.highlightedPlayer;if(c(p==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:l,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:l,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),e.category==="comparison"&&e.redirectTo.subTab==="comparison"){const a=b.highlightedPlayer||"",t=f(e.description,a);t&&h({playerComparisonState:{selectedPlayer1:a,selectedPlayer2:t,showDetailedStats:!0}})}if(e.category==="comparison"&&e.redirectTo.subTab==="pairing"){const a=e.description.toLowerCase().includes("loup");h({selectedPairingTab:a?"wolves":"lovers"})}if(e.category==="kills"&&e.redirectTo.subTab==="deathStats"){const a=e.description.match(/(Villageois|Loups|Autres)/i);a&&h({deathStatsSelectedCamp:a[1]});let t=10;const r=e.description.match(/min\.\s*(\d+)/);r&&(t=parseInt(r[1],10));let o="totalKills";const u=e.redirectTo.chartSection;u&&(u==="killers-total"?o="totalKills":u==="killers-average"?o="averageKills":u==="deaths-total"?o="totalDeaths":u==="survivors-average"&&(o="survivalRate")),h({deathStatisticsState:{selectedCamp:a?.[1]||"Tous les camps",minGamesForAverage:t,focusChart:o}})}if(e.category==="map"&&e.redirectTo.subTab==="playersGeneral"){const a=e.redirectTo.mapFilter||"all";let t=10;const r=e.description.match(/min\.\s*(\d+)/);r&&(t=parseInt(r[1])),c(p==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:a,playerFilter:{mode:"none",players:[]},highlightedPlayer:l,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:a,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:a,playerFilter:{mode:"none",players:[]},highlightedPlayer:l,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:a,playerFilter:{mode:"none",players:[]}}}),h({playersGeneralState:{minGamesForWinRate:t,winRateOrder:"best",focusChart:"winRate"}}),C("players","playersGeneral");return}if(e.category==="history"&&e.redirectTo.subTab==="history"&&h({selectedPlayerName:b.highlightedPlayer||"",groupingMethod:"session"}),e.category==="series"&&e.redirectTo.subTab==="series"){let a="wins";const t=e.title.toLowerCase(),r=e.description.toLowerCase();t.includes("défaite")||r.includes("défaite")?a="losses":t.includes("loup")||r.includes("loup")?a="loup":t.includes("villageois")||r.includes("villageois")?a="villageois":(t.includes("victoire")||r.includes("victoire"))&&(a="wins"),h({selectedSeriesType:a})}if(e.category==="general"&&e.redirectTo.subTab==="playersGeneral"){let a=10;const t=e.description.match(/min\.\s*(\d+)/);t&&(a=parseInt(t[1],10));let r="winRate",o="best";const u=e.title.toLowerCase(),y=e.description.toLowerCase();u.includes("participation")||y.includes("participation")?r="participation":(u.includes("taux de victoire")||y.includes("taux de victoire"))&&(r="winRate",(u.includes("moins bon")||u.includes("mauvais")||y.includes("moins bon")||y.includes("mauvais"))&&(o="worst")),h({playersGeneralState:{minGamesForWinRate:a,winRateOrder:o,focusChart:r}})}if(e.category==="performance"&&e.redirectTo.subTab==="campPerformance"){const a=e.redirectTo.chartSection;let t="Villageois",r=1;a&&(a==="camp-loup"?t="Loup":a==="camp-villageois"?t="Villageois":a==="camp-idiot"?t="Idiot du Village":a==="camp-amoureux"?t="Amoureux":(a==="solo-roles"||a==="hall-of-fame")&&(t="Villageois"));const o=e.description.match(/min\.\s*(\d+)/);o&&(r=parseInt(o[1],10)),a==="solo-roles"?t="Rôles spéciaux":a==="hall-of-fame"&&(t="Tous les camps"),h({campPerformanceState:{selectedCampPerformanceCamp:t,selectedCampPerformanceMinGames:r}})}C(e.redirectTo.tab,e.redirectTo.subTab)},f=(e,i)=>{const l=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const a of l){const t=e.match(a);if(t&&t[1]){const r=t[1].trim();if(r!==i)return r}}return null},T=e=>{if(!e.redirectTo)return"Aucune navigation disponible";switch(e.category){case"general":if(e.redirectTo.subTab==="playersGeneral"){const a=e.description.match(/min\.\s*(\d+)/),t=a?parseInt(a[1],10):10,r=e.title.toLowerCase(),o=p==="modded"?" (Filtre parties moddées activé)":" (Filtres réinitialisés)";return r.includes("taux de victoire")?`Classement: ${e.rank}${e.totalRanked?`/${e.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${t} parties)${o}`:r.includes("participation")?`Classement: ${e.rank}${e.totalRanked?`/${e.totalRanked} joueurs`:""} - Cliquez pour voir les participations${o}`:`Classement: ${e.rank}${e.totalRanked?`/${e.totalRanked} joueurs`:""} - Cliquez pour voir le classement général des joueurs${o}`}break;case"map":if(e.redirectTo.subTab==="playersGeneral"){const a=e.redirectTo.mapFilter,t=a==="village"?"Village":a==="chateau"?"Château":"map",r=p==="modded"?" (Filtres parties moddées + map activés)":" (Filtre map activé)";return`Classement: ${e.rank}${e.totalRanked?`/${e.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques générales filtrées sur ${t}${r}`}break;case"history":if(e.redirectTo.subTab==="history")return"Cliquez pour voir l'historique détaillé du joueur par map";break;case"comparison":if(e.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${f(e.description,b.highlightedPlayer||"")||"ce joueur"}`;if(e.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(e.redirectTo.subTab==="deathStats"){const a=e.description.match(/(Villageois|Loups|Autres)/i),t=e.description.match(/min\.\s*(\d+)/),r=t?parseInt(t[1],10):10,o=a?.[1]||"Tous les camps",u=e.redirectTo.chartSection;let y="kills et morts";return u==="killers-total"?y="total des kills":u==="killers-average"?y=`moyenne des kills (min. ${r} parties)`:u==="deaths-total"?y="total des morts":u==="survivors-average"&&(y=`taux de survie (min. ${r} parties)`),`Cliquez pour voir les statistiques de ${y} ${o!=="Tous les camps"?`en ${o}`:""}`}break;case"series":if(e.redirectTo.subTab==="series"){const a=e.title.toLowerCase(),t=e.description.toLowerCase();return a.includes("défaite")||t.includes("défaite")?"Cliquez pour voir les séries de défaites":a.includes("loup")||t.includes("loup")?"Cliquez pour voir les séries Loups":a.includes("villageois")||t.includes("villageois")?"Cliquez pour voir les séries Villageois":a.includes("victoire")||t.includes("victoire")?"Cliquez pour voir les séries de victoires":"Cliquez pour voir les séries consécutives"}break;case"performance":if(e.redirectTo.subTab==="campPerformance"){const a=e.redirectTo.chartSection,t=p==="modded"?" (Filtre parties moddées activé)":" (Filtres réinitialisés)";return a==="camp-loup"?`Cliquez pour voir les performances camp Loup${t}`:a==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${t}`:a==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${t}`:a==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${t}`:a==="solo-roles"?`Cliquez pour voir le classement (rôles spéciaux)${t}`:a==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${t}`:`Cliquez pour voir les performances par camp${t}`}break}return`Cliquez pour voir ${e.redirectTo.subTab}`+(p==="modded"?" (Filtre parties moddées activé)":" (Filtres réinitialisés)")},N=e=>g[e]||L(e),x=e=>{const i=[/avec ([^:]+?):/,/contre ([^:]+?):/];let l=e;return i.forEach(a=>{const t=e.match(a);if(t&&t[1]){const r=t[1].trim(),u=`<span class="player-name-highlight" style="color: ${N(r)};">${r}</span>`;l=l.replace(r,u)}}),l};if(n.length===0)return s.jsxs("div",{className:"achievements-empty",children:[s.jsx("h4",{children:m}),s.jsx("p",{children:k||"Aucun succès dans cette catégorie"})]});const P=n.filter(e=>e.category!=="comparison"&&e.type==="good").sort((e,i)=>(e.rank??999)-(i.rank??999)),F=n.filter(e=>e.category!=="comparison"&&e.type==="bad").sort((e,i)=>(e.rank??999)-(i.rank??999)),$=n.filter(e=>e.category==="comparison");return s.jsxs("div",{className:"achievements-container",children:[s.jsx("h4",{children:m}),P.length>0&&s.jsxs("div",{className:"achievements-section good-achievements",children:[s.jsx("h5",{children:"🏆 Classements"}),s.jsx("div",{className:"achievements-grid",children:P.map(e=>s.jsxs("div",{className:`achievement-card good rank-${e.rank}`,onClick:i=>d(e,i),title:T(e),children:[s.jsxs("div",{className:"achievement-header",children:[s.jsx("span",{className:"achievement-title",children:e.title}),s.jsxs("span",{className:"achievement-rank",children:["#",e.rank,e.totalRanked?`/${e.totalRanked}`:""]})]}),s.jsx("p",{className:"achievement-description",children:e.description})]},e.id))})]}),F.length>0&&s.jsxs("div",{className:"achievements-section bad-achievements",children:[s.jsx("h5",{children:"💀 Classements (Inversés)"}),s.jsx("div",{className:"achievements-grid",children:F.map(e=>s.jsxs("div",{className:`achievement-card bad rank-${e.rank}`,onClick:i=>d(e,i),title:T(e),children:[s.jsxs("div",{className:"achievement-header",children:[s.jsx("span",{className:"achievement-title",children:e.title}),s.jsxs("span",{className:"achievement-rank",children:["#",e.rank,e.totalRanked?`/${e.totalRanked}`:""]})]}),s.jsx("p",{className:"achievement-description",children:e.description})]},e.id))})]}),$.length>0&&s.jsxs("div",{className:"achievements-section comparison-achievements",children:[s.jsx("h5",{children:"📊 Statistiques Face-à-Face"}),s.jsx("div",{className:"achievements-grid",children:$.map(e=>s.jsxs("div",{className:"achievement-card comparison",onClick:i=>d(e,i),title:T(e),children:[s.jsx("div",{className:"achievement-header",children:s.jsx("span",{className:"achievement-title",children:e.title})}),s.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:x(e.description)}})]},e.id))})]})]})}function I(){const{settings:n,updateSettings:m}=S(),{navigateToTab:k}=G(),{data:p,isLoading:C,error:h}=R(),{data:v,isLoading:b,error:c}=E(n.highlightedPlayer),[g,d]=j.useState(""),[f,T]=j.useState("all"),N=j.useMemo(()=>{if(!p||!p.GameStats)return[];const e=new Map;return p.GameStats.forEach(i=>{const l=new Date(i.StartDate);i.PlayerStats.forEach(a=>{const t=w(a.Username);e.has(t)||e.set(t,{games:0,wins:0,firstDate:l,lastDate:l});const r=e.get(t);r.games++,a.Victorious&&r.wins++,l<r.firstDate&&(r.firstDate=l),l>r.lastDate&&(r.lastDate=l)})}),Array.from(e.entries()).map(([i,l])=>({name:i,totalGames:l.games,totalWins:l.wins,winRate:l.games>0?l.wins/l.games*100:0,firstGameDate:l.firstDate.toLocaleDateString("fr-FR"),lastGameDate:l.lastDate.toLocaleDateString("fr-FR"),isHighlighted:i===n.highlightedPlayer}))},[p,n.highlightedPlayer]),x=j.useMemo(()=>{if(!g.trim())return N;const e=g.toLowerCase();return N.filter(i=>i.name.toLowerCase().includes(e))},[N,g]),P=j.useMemo(()=>[...x].sort((e,i)=>i.totalGames-e.totalGames),[x]),F=e=>{m({highlightedPlayer:e}),d("")},$=e=>{m({highlightedPlayer:e}),k("players","history")};return C?s.jsxs("div",{className:"player-selection-loading",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Chargement des joueurs..."})]}):h?s.jsxs("div",{className:"player-selection-error",children:[s.jsx("h2",{children:"Erreur"}),s.jsxs("p",{children:["Impossible de charger les données des joueurs: ",h]})]}):!p||N.length===0?s.jsxs("div",{className:"player-selection-empty",children:[s.jsx("h2",{children:"Aucune donnée disponible"}),s.jsx("p",{children:"Aucun joueur trouvé dans les données."})]}):s.jsxs("div",{className:"player-selection-container",children:[s.jsxs("div",{className:"player-selection-header",children:[s.jsx("h2",{children:"Sélection de Joueur"}),s.jsx("p",{className:"header-description",children:"Choisissez un joueur pour le mettre en évidence dans tous les graphiques."}),s.jsxs("div",{className:"search-controls",children:[s.jsxs("div",{className:"search-box",children:[s.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:g,onChange:e=>d(e.target.value),className:"search-input"}),s.jsx("span",{className:"search-icon",children:"🔍"})]}),s.jsxs("div",{className:"player-count",children:[x.length," joueur",x.length!==1?"s":"",g&&` (filtré${x.length!==1?"s":""} de ${N.length})`]})]})]}),s.jsx("div",{className:"player-display",children:g?x.length>0?s.jsxs("div",{className:"search-results",children:[s.jsxs("div",{className:"search-results-header",children:[s.jsx("h3",{children:"Résultats de recherche:"}),s.jsx("button",{className:"clear-search-btn",onClick:()=>d(""),children:"Effacer la recherche"})]}),s.jsx("div",{className:"suggestion-list",children:P.map(e=>s.jsxs("button",{className:`suggestion-btn ${e.isHighlighted?"highlighted":""}`,onClick:()=>F(e.name),children:[e.name," (",e.totalGames," parties, ",e.winRate.toFixed(1),"% victoires)",e.isHighlighted&&s.jsx("span",{className:"highlight-indicator",children:" ★"})]},e.name))})]}):s.jsxs("div",{className:"no-results",children:[s.jsxs("p",{children:['Aucun joueur trouvé pour "',g,'"']}),s.jsx("button",{className:"clear-search-btn",onClick:()=>d(""),children:"Effacer la recherche"})]}):n.highlightedPlayer?(()=>{const e=N.find(i=>i.name===n.highlightedPlayer);return e?s.jsxs("div",{className:"single-player-card highlighted",onClick:()=>$(e.name),children:[s.jsxs("div",{className:"player-card-header",children:[s.jsx("h3",{className:"player-name",children:e.name}),s.jsx("span",{className:"highlight-badge",children:"★ Mis en évidence"})]}),s.jsxs("div",{className:"player-actions",children:[s.jsxs("div",{className:"achievements-section",children:[b?s.jsxs("div",{className:"achievements-loading",children:[s.jsx("div",{className:"loading-spinner"}),s.jsx("p",{children:"Chargement des classements..."})]}):c?s.jsx("div",{className:"achievements-error",children:s.jsxs("p",{children:["❌ Erreur lors du chargement des classements: ",c]})}):v?s.jsx(q,{achievements:f==="all"?v.allGamesAchievements:v.moddedOnlyAchievements,title:f==="all"?"Classements - Toutes les parties":"Classements - Parties moddées",emptyMessage:"Aucun classement dans cette catégorie",achievementType:f}):s.jsx("div",{className:"achievements-empty",children:s.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),s.jsxs("div",{className:"achievements-filter",children:[s.jsx("button",{className:`filter-btn ${f==="all"?"active":""}`,onClick:i=>{i.stopPropagation(),T("all")},children:"Toutes les parties"}),s.jsx("button",{className:`filter-btn ${f==="modded"?"active":""}`,onClick:i=>{i.stopPropagation(),T("modded")},children:"Parties moddées"})]}),s.jsx("button",{className:"highlight-btn active",onClick:i=>{i.stopPropagation(),m({highlightedPlayer:null})},children:"★ Retirer la mise en évidence"})]}),s.jsxs("div",{className:"player-period",children:[s.jsx("span",{className:"period-label",children:"Période d'activité:"}),s.jsxs("span",{className:"period-range",children:[e.firstGameDate," - ",e.lastGameDate]})]})]})]}):s.jsxs("div",{className:"no-player-found",children:[s.jsxs("p",{children:['Le joueur "',n.highlightedPlayer,`" n'a pas été trouvé dans les données.`]}),s.jsx("button",{className:"clear-selection-btn",onClick:()=>m({highlightedPlayer:null}),children:"Effacer la sélection"})]})})():s.jsx("div",{className:"player-selection-prompt",children:s.jsxs("div",{className:"selection-prompt-content",children:[s.jsx("h2",{children:"Sélectionnez un joueur"}),s.jsx("p",{children:"Utilisez la recherche ci-dessus pour trouver et sélectionner un joueur à mettre en évidence."}),x.length>0&&s.jsxs("div",{className:"suggested-players",children:[s.jsx("h3",{children:"Joueurs suggérés:"}),s.jsx("div",{className:"suggestion-list",children:P.slice(0,5).map(e=>s.jsxs("button",{className:"suggestion-btn",onClick:()=>F(e.name),children:[e.name," (",e.totalGames," parties)"]},e.name))})]})]})})})]})}export{I as PlayerSelectionPage};
