import{u as W,r as P,j as e}from"./index-BnMfkUOW.js";import{b as E,s as F,g as V,f as B,d as H,u as K}from"./baseStatsHook-B7Qeo-jQ.js";import{u as J}from"./usePlayerStatsFromRaw-20HiONon.js";import{l as _,a as q}from"./api-beq3FXpM.js";import{F as N,C as M,X as T,Y as k,B as G,a as z,b as D}from"./FullscreenChart-CzTQQWrz.js";import{R as A,T as R}from"./CategoricalChart-DbTomGcB.js";import{L as O,a as X}from"./LineChart-D-tX7HVg.js";import{P as Y,a as Q}from"./PieChart-CItBR8ue.js";import"./ActivePoints-DUbLQ_e3.js";import"./PolarChart-BWCM4Spu.js";function U(l,u,x,n){return u==="Agent"&&x==="Agent"?n&&n.trim()!==""?F(n).some(g=>g.toLowerCase()===l.toLowerCase()):!1:H(u,x)}function Z(l,u,x){if(l.trim()===""||u.length===0||x.length===0)return null;const n=E(x),a=[];u.forEach(o=>{const m=o.Game?.toString(),j=o.Date,v=o["Liste des joueurs"],p=o["Camp victorieux"],f=o["Liste des gagnants"];if(m&&v&&j&&f){const C=F(v.toString());if(C.some(h=>h.toLowerCase()===l.toLowerCase())){const h=V(n,m,l),t=U(l,h,p,f?.toString()),i=B(j);a.push({gameId:m,date:i,camp:h,won:t,winnerCamp:p?.toString()||"",playersInGame:C.length})}}}),a.sort((o,m)=>{const j=v=>{const p=v.split("/");return p.length===3?new Date(parseInt(p[2]),parseInt(p[1])-1,parseInt(p[0])):new Date(v)};return j(m.date).getTime()-j(o.date).getTime()});const g=a.length,S=a.filter(o=>o.won).length,b=g>0?(S/g*100).toFixed(2):"0.00",s={};return a.forEach(o=>{s[o.camp]||(s[o.camp]={appearances:0,wins:0,winRate:"0.00"}),s[o.camp].appearances++,o.won&&s[o.camp].wins++}),Object.keys(s).forEach(o=>{const m=s[o];m.winRate=m.appearances>0?(m.wins/m.appearances*100).toFixed(2):"0.00"}),{playerName:l,totalGames:g,totalWins:S,winRate:b,games:a,campStats:s}}function ee(l){const{data:u,isLoading:x,error:n}=K((a,g)=>Z(l,a,g));return{data:u,isLoading:x,error:n}}function pe(){const{navigateToGameDetails:l,navigationState:u,updateNavigationState:x}=W(),n=u.selectedPlayerName||"Ponce",a=u.groupingMethod||"session",g=t=>{x({selectedPlayerName:t})},S=t=>{x({groupingMethod:t})},{data:b}=J(),{data:s,isLoading:o,error:m}=ee(n),j=P.useMemo(()=>b?.playerStats?b.playerStats.filter(t=>t.gamesPlayed>0).map(t=>t.player).sort():["Ponce"],[b]),v=P.useMemo(()=>{if(!s?.games)return new Map;const t=new Map;return s.games.forEach(i=>{if(!t.has(i.date)){const r=i.date.split("/");r.length===3?t.set(i.date,new Date(parseInt(r[2]),parseInt(r[1])-1,parseInt(r[0])).getTime()):t.set(i.date,new Date(i.date).getTime())}}),t},[s?.games]),p=P.useMemo(()=>{if(!s?.games)return[];const t={};return s.games.forEach(i=>{let r;if(a==="month"){const c=i.date.split("/");c.length===3?r=`${c[1]}/${c[2]}`:r=i.date}else r=i.date;t[r]||(t[r]={games:[],wins:0,total:0}),t[r].games.push(i),t[r].total++,i.won&&t[r].wins++}),Object.entries(t).map(([i,r])=>({period:i,totalGames:r.total,victories:r.wins,defeats:r.total-r.wins,winRate:r.total>0?(r.wins/r.total*100).toFixed(1):"0.0",winRateNum:r.total>0?r.wins/r.total*100:0})).sort((i,r)=>{if(a==="month"){const[c,d]=i.period.split("/"),[y,w]=r.period.split("/"),I=new Date(parseInt(d),parseInt(c)-1,1),L=new Date(parseInt(w),parseInt(y)-1,1);return I.getTime()-L.getTime()}else{const c=v.get(i.period)||0,d=v.get(r.period)||0;return c-d}})},[s,a,v]),f=P.useMemo(()=>s?.campStats?Object.entries(s.campStats).map(([t,i])=>({name:t,value:i.appearances,winRate:i.winRate,wins:i.wins,percentage:(i.appearances/s.totalGames*100).toFixed(1)})):[],[s]),C=P.useMemo(()=>{if(!f.length)return[];const t=5;let i=0;const r=[],c=[];if(f.forEach(d=>{parseFloat(d.percentage)<t?(i+=Number(d.value),r.push(d)):c.push(d)}),i>0){const d=f.reduce((y,w)=>y+Number(w.value),0);c.push({name:"Autres",value:i,winRate:"0.0",wins:r.reduce((y,w)=>y+w.wins,0),percentage:(i/d*100).toFixed(1),_details:r})}return c},[f]),h=(t=>t<=15?{fontSize:11,angle:-45,height:80,interval:0}:t<=30?{fontSize:10,angle:-45,height:85,interval:1}:t<=50?{fontSize:9,angle:-60,height:95,interval:2}:{fontSize:8,angle:-75,height:105,interval:Math.floor(t/12)})(p.length);return o?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):m?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",m]}):s?e.jsxs("div",{className:"lycans-player-history",children:[e.jsx("h2",{children:"Historique Détaillé d'un Joueur"}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Joueur:"}),e.jsx("select",{id:"player-select",value:n,onChange:t=>g(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:j.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:a,onChange:t=>S(t.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"})]})]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{l({selectedPlayer:n,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${n}`,children:s.totalGames}),e.jsx("p",{children:"parties jouées"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{l({selectedPlayer:n,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${n}`,children:s.totalWins}),e.jsx("p",{children:"parties gagnées"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",children:[s.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Évolution des Performances ",a==="month"?"par Mois":"par Session"]}),e.jsx(N,{title:`Évolution des Performances ${a==="month"?"par Mois":"par Session"}`,children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(O,{data:p,margin:{top:20,right:30,left:20,bottom:60},onClick:t=>{if(t&&t.activeLabel){const i=p.find(r=>r.period===t.activeLabel);i&&l({selectedPlayer:n,selectedDate:i.period,fromComponent:`Évolution des Performances ${a==="month"?"par Mois":"par Session"}`})}},style:{cursor:"pointer"},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(T,{dataKey:"period",angle:h.angle,textAnchor:"end",height:h.height,interval:h.interval,fontSize:h.fontSize}),e.jsx(k,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(R,{content:({active:t,payload:i})=>{if(t&&i&&i.length>0){const r=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.period})}),e.jsxs("div",{children:["Parties: ",r.totalGames]}),e.jsxs("div",{children:["Victoires: ",r.victories]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(X,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Répartition Victoires/Défaites ",a==="month"?"par Mois":"par Session"]}),e.jsx(N,{title:`Répartition Victoires/Défaites ${a==="month"?"par Mois":"par Session"}`,children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(G,{data:p,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(T,{dataKey:"period",angle:h.angle,textAnchor:"end",height:h.height,interval:h.interval,fontSize:h.fontSize}),e.jsx(k,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"},allowDecimals:!1}),e.jsx(R,{content:({active:t,payload:i})=>{if(t&&i&&i.length>0){const r=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.period})}),e.jsxs("div",{children:["Total: ",r.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",r.victories]}),e.jsxs("div",{children:["Défaites: ",r.defeats]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(z,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:p.map((t,i)=>e.jsx(D,{fill:"var(--accent-tertiary)",onClick:()=>{l({selectedPlayer:n,selectedDate:t.period,fromComponent:`Historique Joueur - Victoires ${a==="month"?"par Mois":"par Session"}`})},style:{cursor:"pointer"}},`cell-victories-${i}`))}),e.jsx(z,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"Défaites",children:p.map((t,i)=>e.jsx(D,{fill:"var(--chart-color-4)",onClick:()=>{l({selectedPlayer:n,selectedDate:t.period,fromComponent:`Historique Joueur - Défaites ${a==="month"?"par Mois":"par Session"}`})},style:{cursor:"pointer"}},`cell-defeats-${i}`))})]})})})})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(Y,{children:[e.jsx(Q,{data:C,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:({name:t,value:i,percent:r})=>{const c=r!==void 0?r:0;return t==="Autres"?`Autres : ${i} (${(c*100).toFixed(1)}%)`:`${t}: ${i} (${(c*100).toFixed(1)}%)`},children:C.map((t,i)=>e.jsx(D,{fill:t.name==="Autres"?_:q[t.name]||`var(--chart-color-${i%6+1})`,onClick:()=>{if(t.name==="Autres"){const r=t._details?.map(c=>c.name)||[];l({selectedPlayer:n,campFilter:{selectedCamp:"Autres",campFilterMode:"wins-only",_smallCamps:r},fromComponent:"Distribution par Camps"})}else l({selectedPlayer:n,campFilter:{selectedCamp:t.name,campFilterMode:"wins-only"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${i}`))}),e.jsx(R,{content:({active:t,payload:i})=>{if(t&&i&&i.length>0){const r=i[0].payload;if(r.name==="Autres"&&r._details){const c=[...r._details].sort((d,y)=>y.value-d.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",r.value," parties (",r.percentage,"%)"]})}),e.jsx("div",{children:c.map((d,y)=>e.jsxs("div",{children:[d.name,": ",d.value," parties (",d.percentage,"%)"]},y))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[r.name," (",r.percentage,"%)"]})}),e.jsxs("div",{children:["Apparitions: ",r.value]}),e.jsxs("div",{children:["Victoires: ",r.wins," (",r.winRate,"%)"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(N,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(G,{data:f,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(M,{strokeDasharray:"3 3"}),e.jsx(T,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(k,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(R,{content:({active:t,payload:i})=>{if(t&&i&&i.length>0){const r=i[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.name})}),e.jsxs("div",{children:["Victoires: ",r.wins," / ",r.value]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),e.jsx(z,{dataKey:"winRate",children:f.map((t,i)=>e.jsx(D,{fill:q[t.name]||`var(--chart-color-${i%6+1})`,onClick:()=>{l({selectedPlayer:n,campFilter:{selectedCamp:t.name,campFilterMode:"wins-only"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${i}`))})]})})})})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée d'historique disponible"})}export{pe as PlayerGameHistoryChart};
