import{r as d,j as s}from"./index-o-b159Lt.js";import{aP as S,aR as p,aS as f,_ as v,aQ as y}from"./PieChart-DAgWCt3a.js";function g(){const[t,h]=d.useState([]),[o,n]=d.useState(!0),[i,a]=d.useState(null);return d.useEffect(()=>{(async()=>{try{n(!0);const r=await fetch("https://script.google.com/macros/s/AKfycbzqIFCxtyZFLnen3Hv3LVSfhIUIlRR921hVeMwxtKvkBzHkNBZmIleTsAkCqcsKmYR-/exec?action=sessionStats");if(!r.ok)throw new Error(`Erreur HTTP: ${r.status}`);const e=await r.json();h(e)}catch(l){a(l instanceof Error?l:new Error(String(l))),console.error("Erreur lors de la récupération des stats de session:",l)}finally{n(!1)}})()},[]),{gameSessionData:t,isDataFetching:o,fetchError:i}}function N(t){const[h,o]=d.useState(null),[n,i]=d.useState(!1),[a,c]=d.useState(null);return d.useEffect(()=>{if(!t){o(null),i(!1),c(null);return}i(!0),c(null),fetch(`https://script.google.com/macros/s/AKfycbzqIFCxtyZFLnen3Hv3LVSfhIUIlRR921hVeMwxtKvkBzHkNBZmIleTsAkCqcsKmYR-/exec?action=playerStatsBySession&sessionDate=${encodeURIComponent(t)}`).then(async r=>{if(!r.ok)throw new Error(`Erreur HTTP: ${r.status}`);const e=await r.json();o(e)}).catch(r=>c(r instanceof Error?r:new Error(String(r)))).finally(()=>i(!1))},[t]),{playerStatsBySession:h,loading:n,error:a}}const x=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d"];function b({playerStatsBySession:t,loading:h,error:o}){return h?s.jsx("div",{children:"Chargement des statistiques des joueurs..."}):o?s.jsx("div",{className:"info-message error",children:s.jsxs("p",{children:["Erreur: ",o.message]})}):!t||t.length===0?s.jsx("div",{className:"info-message",children:s.jsx("p",{children:"Aucune donnée de joueur disponible pour cette session."})}):s.jsxs("div",{className:"lycans-session-player-stats",children:[s.jsx("h3",{children:"Statistiques des joueurs pour cette session"}),s.jsx("div",{className:"player-session-cards",children:t.map(n=>s.jsxs("div",{className:"player-session-card",children:[s.jsx("h4",{children:n.JoueurID}),s.jsxs("div",{className:"player-session-stats",children:[s.jsxs("div",{className:"player-stat",children:[s.jsx("span",{children:"Parties:"}),s.jsx("strong",{children:n.PartiesSession})]}),s.jsxs("div",{className:"player-stat",children:[s.jsx("span",{children:"Victoires:"}),s.jsxs("strong",{children:[n.VictoiresSession," (",(n.TauxVictoireSession*100).toFixed(1),"%)"]})]}),s.jsxs("div",{className:"player-stat",children:[s.jsx("span",{children:"Survie:"}),s.jsxs("strong",{children:[n.SurvivantSession," (",(n.TauxSurvieSession*100).toFixed(1),"%)"]})]})]}),n.DistributionRolesSession.length>0&&s.jsxs("div",{className:"player-roles-chart",children:[s.jsx("h5",{children:"Rôles joués"}),s.jsx(S,{width:"100%",height:100,children:s.jsxs(p,{children:[s.jsx(f,{data:n.DistributionRolesSession.slice(0,5),cx:"50%",cy:"50%",innerRadius:15,outerRadius:30,dataKey:"Count",nameKey:"RoleName",children:n.DistributionRolesSession.slice(0,5).map((i,a)=>s.jsx(v,{fill:x[a%x.length]},`cell-${a}`))}),s.jsx(y,{formatter:(i,a,c)=>{const l=c?.payload?.RoleName||"";return[`${i} fois`,`${l}`]}})]})}),s.jsx("div",{className:"role-legend",children:n.DistributionRolesSession.slice(0,8).map((i,a)=>s.jsxs("div",{className:"role-item",children:[s.jsx("span",{className:"role-color",style:{backgroundColor:x[a%x.length]}}),s.jsx("span",{className:"role-name",children:i.RoleName})]},a))})]})]},n.JoueurID))})]})}function R(){const{gameSessionData:t,isDataFetching:h,fetchError:o}=g(),[n,i]=d.useState(null),{playerStatsBySession:a,loading:c,error:l}=N(n);if(h)return s.jsx("div",{children:"Chargement des statistiques des sessions..."});if(o)return s.jsxs("div",{children:["Erreur: ",o.message]});if(!t||t.length===0)return s.jsx("div",{children:"Aucune donnée de session disponible"});const r=n?t.find(e=>e.DateSession===n):null;return s.jsxs("div",{className:"lycans-session-stats",children:[s.jsx("h2",{children:"Statistiques par Session de Jeu"}),s.jsxs("div",{className:"lycans-session-selector",children:[s.jsx("label",{children:"Sélectionner une session: "}),s.jsxs("select",{value:n||"",onChange:e=>i(e.target.value||null),className:"lycans-selector",children:[s.jsx("option",{value:"",children:"Toutes les sessions"}),t.map(e=>s.jsxs("option",{value:e.DateSession,children:[e.DateSession," (",e.NombreParties," parties)"]},e.DateSession))]})]}),!n&&s.jsxs("div",{className:"lycans-sessions-table",children:[s.jsx("h3",{children:"Vue d'ensemble des sessions"}),s.jsx("div",{className:"table-container",children:s.jsxs("table",{className:"lycans-stats-table",children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"Date"}),s.jsx("th",{children:"Parties"}),s.jsx("th",{children:"Durée moyenne"}),s.jsx("th",{children:"Temps total"}),s.jsx("th",{children:"Joueurs/partie"}),s.jsx("th",{children:"Versions"}),s.jsx("th",{children:"Lien Youtube"})]})}),s.jsx("tbody",{children:t.map(e=>s.jsxs("tr",{onClick:()=>i(e.DateSession),className:"clickable-row",children:[s.jsx("td",{children:e.DateSession}),s.jsx("td",{children:e.NombreParties}),s.jsx("td",{children:e.DureeMoyenne}),s.jsx("td",{children:e.TempsJeuTotal}),s.jsx("td",{children:e.JoueursMoyen}),s.jsx("td",{children:e.Versions&&e.Versions.length>0?e.Versions.join(", "):s.jsx("span",{children:"-"})}),s.jsx("td",{children:e.VideosYoutube&&e.VideosYoutube.length>0?e.VideosYoutube.map((u,j)=>s.jsx("a",{href:u,target:"_blank",rel:"noopener noreferrer",onClick:m=>m.stopPropagation(),className:"video-link",children:j+1},j)):s.jsx("span",{children:"-"})})]},e.DateSession))})]})})]}),r&&s.jsxs("div",{className:"lycans-session-detail",children:[s.jsxs("h3",{children:["Session du ",r.DateSession]}),s.jsxs("div",{className:"lycans-stats-summary",children:[s.jsxs("div",{className:"lycans-stat-box",children:[s.jsx("h4",{children:"Nombre de Parties"}),s.jsx("p",{children:r.NombreParties})]}),s.jsxs("div",{className:"lycans-stat-box",children:[s.jsx("h4",{children:"Durée Moyenne"}),s.jsx("p",{children:r.DureeMoyenne})]}),s.jsxs("div",{className:"lycans-stat-box",children:[s.jsx("h4",{children:"Temps de Jeu Total"}),s.jsx("p",{children:r.TempsJeuTotal})]}),s.jsxs("div",{className:"lycans-stat-box",children:[s.jsx("h4",{children:"Nombre Moyen de Joueurs"}),s.jsx("p",{children:r.JoueursMoyen})]})]}),r.VideosYoutube&&r.VideosYoutube.length>0&&s.jsxs("div",{className:"lycans-video-links",children:[s.jsx("h4",{children:"Liens Youtube de la session"}),s.jsx("div",{className:"lycans-video-grid",children:r.VideosYoutube.map((e,u)=>s.jsxs("a",{href:e,target:"_blank",rel:"noopener noreferrer",className:"lycans-video-button",children:["Lien ",u+1]},u))})]}),s.jsxs("div",{className:"lycans-session-player-stats",children:[s.jsx("h3",{children:"Statistiques des joueurs pour cette session"}),c&&s.jsx("div",{children:"Chargement des statistiques des joueurs..."}),l&&s.jsx("div",{className:"info-message error",children:s.jsxs("p",{children:["Erreur: ",l.message]})}),!c&&!l&&a&&s.jsx(b,{playerStatsBySession:a,loading:c,error:l})]})]})]})}export{R as default};
