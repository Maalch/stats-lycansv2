import{u as f,j as e}from"./index-iPJCRIrI.js";import{h as D}from"./baseStatsHook--6aOJIne.js";import{a as v,l as g}from"./api-beq3FXpM.js";import{F as d,B as x,C as u,X as y,Y as m,a as j,b}from"./FullscreenChart-CuGzK3ME.js";import{R as h,T as p,Q as N}from"./CategoricalChart-tykwOv4n.js";import{L as C,a as B}from"./LineChart-BkWu9EKK.js";import{L as R}from"./Legend-PMED22SS.js";import"./ActivePoints-DuBLWtpN.js";function A(){return{averageDays:"0",maxDays:0,minDays:99,dayDistribution:{},daysByWinnerCamp:{},daysByPlayerCount:{},daysByWolfRatio:{}}}function M(a,s){a>s.maxDays&&(s.maxDays=a),a<s.minDays&&(s.minDays=a)}function L(a,s){s[a]||(s[a]=0),s[a]++}function W(a,s,i){a&&a.trim()!==""&&(i[a]||(i[a]={totalDays:0,count:0,average:"0"}),i[a].totalDays+=s,i[a].count++)}function k(a,s,i){if(a&&!isNaN(a)&&a>0){const r=a.toString();i[r]||(i[r]={totalDays:0,count:0,average:"0"}),i[r].totalDays+=s,i[r].count++}}function F(a,s,i,r){if(a&&s&&!isNaN(a)&&!isNaN(s)&&a>0){const l=Math.round(s/a*100),t=(Math.round(l/1)*1).toString();r[t]||(r[t]={totalDays:0,count:0,average:"0"}),r[t].totalDays+=i,r[t].count++}}function q(a,s,i){const r=a["Nombre de journées"],l=a["Camp victorieux"],c=a["Nombre de joueurs"],t=a["Nombre de loups"];r&&!isNaN(r)&&r>0&&(i.gamesWithDays++,i.totalDays+=r,M(r,s),L(r,s.dayDistribution),W(l,r,s.daysByWinnerCamp),k(c,r,s.daysByPlayerCount),F(c,t,r,s.daysByWolfRatio))}function K(a,s){s.gamesWithDays>0&&(a.averageDays=(s.totalDays/s.gamesWithDays).toFixed(1),Object.keys(a.daysByWinnerCamp).forEach(i=>{const r=a.daysByWinnerCamp[i];r.count>0&&(r.average=(r.totalDays/r.count).toFixed(1))}),Object.keys(a.daysByPlayerCount).forEach(i=>{const r=a.daysByPlayerCount[i];r.count>0&&(r.average=(r.totalDays/r.count).toFixed(1))}),Object.keys(a.daysByWolfRatio).forEach(i=>{const r=a.daysByWolfRatio[i];r.count>0&&(r.average=(r.totalDays/r.count).toFixed(1))}))}function P(a){const s=Object.keys(a).map(i=>({days:parseInt(i),count:a[parseInt(i)]}));return s.sort((i,r)=>i.days-r.days),s}function E(a){if(a.length===0)return null;const s=A(),i={totalDays:0,gamesWithDays:0};a.forEach(l=>{q(l,s,i)}),K(s,i);const r=P(s.dayDistribution);return{averageDays:s.averageDays,maxDays:s.maxDays,minDays:s.minDays,dayDistribution:r,daysByWinnerCamp:s.daysByWinnerCamp,daysByPlayerCount:s.daysByPlayerCount,daysByWolfRatio:s.daysByWolfRatio}}function G(){const{data:a,isLoading:s,error:i}=D(E);return{durationAnalysis:a,fetchingData:s,apiError:i}}function X(){const{durationAnalysis:a,fetchingData:s,apiError:i}=G(),{navigateToGameDetails:r}=f();if(s)return e.jsx("div",{className:"statistiques-attente",children:"Analyse des durées de partie en cours..."});if(i)return e.jsxs("div",{className:"statistiques-echec",children:["Problème rencontré: ",i]});if(!a)return e.jsx("div",{className:"statistiques-indisponibles",children:"Données d'analyse non disponibles"});const l=a?Object.entries(a.daysByWolfRatio).map(([t,n])=>({ratio:parseFloat(t),moyenne:parseFloat(n.average),parties:n.count})).sort((t,n)=>t.ratio-n.ratio):[],c=a?Object.entries(a.daysByWinnerCamp).map(([t,n])=>({camp:t,moyenne:parseFloat(n.average),parties:n.count})).sort((t,n)=>n.moyenne-t.moyenne):[];return e.jsxs("div",{className:"lycans-duree-analyse",children:[e.jsx("h2",{children:"Analyse des Durées de Partie"}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Moyenne"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[a.averageDays," jours"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Minimum"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[a.minDays," jours"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Maximum"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[a.maxDays," jours"]})]})]}),e.jsxs("div",{className:"lycans-graphiques-section",children:[e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Distribution des Durées de Partie"}),e.jsx(d,{title:"Distribution des Durées de Partie",children:e.jsx("div",{style:{height:300},children:e.jsx(h,{width:"100%",height:"100%",children:e.jsxs(x,{data:a?.dayDistribution||[],margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(u,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"days",label:{value:"Nombre de Jours",position:"insideBottom",offset:-5}}),e.jsx(m,{label:{value:"Nombre de Parties",angle:-90,position:"insideLeft"}}),e.jsx(p,{content:({active:t,payload:n})=>{if(t&&n&&n.length>0){const o=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsxs("strong",{children:[o.days," jours"]})}),e.jsxs("div",{children:[o.count," parties"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(j,{dataKey:"count",name:"Nombre de Parties",fill:"var(--chart-color-2)",onClick:t=>{t&&t.days&&r({selectedGameDuration:t.days,fromComponent:"Distribution des Durées de Partie"})},style:{cursor:"pointer"}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Durée Moyenne par Ratio Loups/Joueurs"}),e.jsx(d,{title:"Durée Moyenne par Ratio Loups/Joueurs",children:e.jsx("div",{style:{height:300},children:e.jsx(h,{width:"100%",height:"100%",children:e.jsxs(C,{data:l,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(u,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"ratio",type:"number",domain:["auto","auto"],allowDecimals:!1,tickFormatter:t=>`${t}%`,label:{value:"Ratio Loups/Joueurs (%)",position:"insideBottom",offset:-5}}),e.jsx(m,{label:{value:"Durée Moyenne (jours)",angle:-90,position:"insideLeft"}}),e.jsx(p,{content:({active:t,payload:n})=>{if(t&&n&&n.length>0){const o=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Pourcentage de loups : ",o.ratio]})}),e.jsxs("div",{children:["Durée moyenne : ",o.moyenne," jours"]}),e.jsxs("div",{children:["Nombre de parties : ",o.parties]})]})}return null}}),e.jsx(R,{}),e.jsx(B,{type:"monotone",dataKey:"moyenne",name:"Durée Moyenne",stroke:"var(--chart-color-5)",activeDot:{r:8}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Durée Moyenne par Camp Victorieux"}),e.jsx(d,{title:"Durée Moyenne par Camp Victorieux",children:e.jsx("div",{style:{height:300},children:e.jsx(h,{width:"100%",height:"100%",children:e.jsxs(x,{data:c,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(u,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(m,{label:{value:"Durée Moyenne (jours)",angle:-90,position:"insideLeft"}}),e.jsx(p,{content:({active:t,payload:n})=>{if(t&&n&&n.length>0){const o=n[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:o.camp})}),e.jsxs("div",{children:["Durée moyenne : ",o.moyenne," jours"]}),e.jsxs("div",{children:["Nombre de parties : ",o.parties]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsxs(j,{dataKey:"moyenne",name:"moyenne",isAnimationActive:!1,onClick:t=>{t&&t.camp&&r({selectedCamp:t.camp,campFilterMode:"wins-only",fromComponent:"Durée Moyenne par Camp Victorieux"})},style:{cursor:"pointer"},children:[c.map(t=>e.jsx(b,{fill:v[t.camp]||g},`cell-${t.camp}`)),e.jsx(N,{dataKey:"moyenne",position:"top",formatter:t=>{const n=typeof t=="number"?t:Number(t);return isNaN(n)?"":`${n.toFixed(1)}j`},fill:"var(--text-primary)",fontSize:12})]})]})})})})]})]})]})}export{X as GameDurationInsights};
