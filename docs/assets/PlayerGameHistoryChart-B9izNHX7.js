import{r as o,j as e}from"./index-DyW9r6sL.js";import{u as G}from"./usePlayerStats-CEyA4bp-.js";import{l as R}from"./api-BWHeASPZ.js";import{R as j,T as v,C as S}from"./CategoricalChart-CKvhOwnP.js";import{L as I,a as A}from"./LineChart-_3piNo81.js";import{C as b,X as w,Y as P,B as C,a as N}from"./BarChart-CnZjb-tf.js";import{P as K,a as $}from"./PieChart-DXDuzpFU.js";function q(c){const[g,i]=o.useState(null),[y,d]=o.useState(!1),[a,p]=o.useState(null);return o.useEffect(()=>{if(!c||c.trim()===""){i(null),p(null),d(!1);return}(async()=>{d(!0),p(null);try{const h="https://script.google.com/macros/s/AKfycbxo92hlxlcCzXtXawsxP4LSspOkNKKI4Yo8OC5aqrAe70EGoIaMcWtFWy7j-RF1iTiu/exec",u=`${h}?action=playerGameHistory&playerName=${encodeURIComponent(c)}`,l=await fetch(u);if(!l.ok)throw new Error(`HTTP error! status: ${l.status}`);const s=await l.json();if(s.error)throw new Error(s.error);i(s)}catch(h){const u=h instanceof Error?h.message:"Unknown error occurred";p(u),i(null)}finally{d(!1)}})()},[c]),{data:g,isLoading:y,error:a}}function F(){const[c,g]=o.useState("Ponce"),[i,y]=o.useState("session"),{playerStatsData:d}=G(),{data:a,isLoading:p,error:f}=q(c),h=o.useMemo(()=>d?.playerStats?d.playerStats.filter(s=>s.gamesPlayed>0).map(s=>s.player).sort():["Ponce"],[d]),u=o.useMemo(()=>{if(!a?.games)return[];const s={};return a.games.forEach(t=>{let r;if(i==="month"){const n=t.date.split("/");n.length===3?r=`${n[1]}/${n[2]}`:r=t.date}else r=t.date;s[r]||(s[r]={games:[],wins:0,total:0}),s[r].games.push(t),s[r].total++,t.won&&s[r].wins++}),Object.entries(s).map(([t,r])=>({period:t,totalGames:r.total,victories:r.wins,winRate:r.total>0?(r.wins/r.total*100).toFixed(1):"0.0",winRateNum:r.total>0?r.wins/r.total*100:0})).sort((t,r)=>{if(i==="month"){const[n,m]=t.period.split("/"),[x,T]=r.period.split("/"),D=new Date(parseInt(m),parseInt(n)-1,1),k=new Date(parseInt(T),parseInt(x)-1,1);return D.getTime()-k.getTime()}else{const n=m=>{const x=m.split("/");return x.length===3?new Date(parseInt(x[2]),parseInt(x[1])-1,parseInt(x[0])):new Date(m)};return n(t.period).getTime()-n(r.period).getTime()}})},[a,i]),l=o.useMemo(()=>a?.campStats?Object.entries(a.campStats).map(([s,t])=>({name:s,value:t.appearances,winRate:t.winRate,wins:t.wins})):[],[a]);return p?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):f?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",f]}):a?e.jsxs("div",{className:"lycans-player-history",children:[e.jsx("h2",{children:"Historique Détaillé d'un Joueur"}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Joueur:"}),e.jsx("select",{id:"player-select",value:c,onChange:s=>g(s.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:h.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:i,onChange:s=>y(s.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"})]})]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.totalGames}),e.jsx("p",{children:"parties jouées"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale",children:a.totalWins}),e.jsx("p",{children:"parties gagnées"})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",children:[a.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Évolution des Performances ",i==="month"?"par Mois":"par Session"]}),e.jsx("div",{style:{height:400},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(I,{data:u,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(w,{dataKey:"period",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:11}),e.jsx(P,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(v,{content:({active:s,payload:t})=>{if(s&&t&&t.length>0){const r=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.period})}),e.jsxs("div",{children:["Parties: ",r.totalGames]}),e.jsxs("div",{children:["Victoires: ",r.victories]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]})]})}return null}}),e.jsx(A,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Nombre de Parties ",i==="month"?"par Mois":"par Session"]}),e.jsx("div",{style:{height:400},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(C,{data:u,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(w,{dataKey:"period",angle:-45,textAnchor:"end",height:80,interval:0,fontSize:11}),e.jsx(P,{label:{value:"Nombre de parties",angle:-90,position:"insideLeft"},allowDecimals:!1}),e.jsx(v,{content:({active:s,payload:t})=>{if(s&&t&&t.length>0){const r=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.period})}),e.jsxs("div",{children:["Total parties: ",r.totalGames]}),e.jsxs("div",{children:["Victoires: ",r.victories]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]})]})}return null}}),e.jsx(N,{dataKey:"totalGames",fill:"var(--chart-color-2)"}),e.jsx(N,{dataKey:"victories",fill:"var(--accent-tertiary)"})]})})})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(K,{children:[e.jsx($,{data:l,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:({name:s,value:t,percent:r})=>`${s}: ${t} (${((r!==void 0?r:0)*100).toFixed(1)}%)`,children:l.map((s,t)=>e.jsx(S,{fill:R[s.name]||`var(--chart-color-${t%6+1})`},`cell-${t}`))}),e.jsx(v,{content:({active:s,payload:t})=>{if(s&&t&&t.length>0){const r=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.name})}),e.jsxs("div",{children:["Apparitions: ",r.value]}),e.jsxs("div",{children:["Victoires: ",r.wins]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx("div",{style:{height:400},children:e.jsx(j,{width:"100%",height:"100%",children:e.jsxs(C,{data:l,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(w,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:11}),e.jsx(P,{label:{value:"Taux de victoire (%)",angle:-90,position:"insideLeft"},domain:[0,100]}),e.jsx(v,{content:({active:s,payload:t})=>{if(s&&t&&t.length>0){const r=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.name})}),e.jsxs("div",{children:["Victoires: ",r.wins," / ",r.value]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]})]})}return null}}),e.jsx(N,{dataKey:"winRate",children:l.map((s,t)=>e.jsx(S,{fill:R[s.name]||`var(--chart-color-${t%6+1})`},`cell-${t}`))})]})})})]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnée d'historique disponible"})}export{F as PlayerGameHistoryChart};
