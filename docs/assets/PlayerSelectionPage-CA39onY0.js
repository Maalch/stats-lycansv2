import{a as ce,r as T,g as Z,f as Pe,u as Q,j as e,c as ye,d as Ne,n as Ae}from"./index-Byn0jXxk.js";import{u as ne}from"./useJoueursData-ChZtPXpr.js";import{u as de}from"./baseStatsHook-CjbcAppl.js";import{g as De}from"./gameUtils-DYpUb-C5.js";import{a as ve,g as ie,c as je,b as Te}from"./datasyncExport-CjB7UYqV.js";import{u as ue,g as Me,a as se,l as be}from"./api-xwV9f9-o.js";import{f as ae,d as Fe}from"./durationFormatters-C9UyWcKX.js";import{F as B,C as K,X as O,Y as H,a as U}from"./FullscreenChart-tQh2-SIV.js";import{R as G,T as V}from"./CategoricalChart-DqhaVbQW.js";import{L as $e,a as ze}from"./LineChart-B0itOmkR.js";import{B as J,a as _}from"./BarChart-BpEvW4AV.js";import{P as Ce,a as we}from"./PieChart-CGMk48jc.js";import{u as Ie}from"./useDeathStatisticsFromRaw-B7KjLd3L.js";import{R as pe}from"./ReferenceLine-Bg_7GLLF.js";import{g as re}from"./deathTypes-gHH1w6_X.js";import{i as me,g as he,V as Le,a as We}from"./roleUtils-CLjkiQQc.js";import{e as ge,a as qe,b as Ee,d as Ge,R as Ve}from"./deathLocationUtils-Ri2fHsc4.js";import{S as Be,a as Ke}from"./ScatterChart-CxFE2sFv.js";import{L as Oe}from"./Legend-EBl3_ced.js";import{a as He,u as _e}from"./useClips-BuS5i-QD.js";import{C as Ue,f as xe,a as Ye}from"./ClipViewer-DMMRNF9E.js";import"./ActivePoints-j6YRERuA.js";import"./PolarChart-DWvtSOBs.js";function Je(n){const{settings:d}=ce(),{joueursData:R}=ne(),[b,h]=T.useState(null),[g,N]=T.useState(!1),[f,c]=T.useState(null);T.useEffect(()=>{let l=!0;return(async()=>{try{N(!0),c(null);const o=d.dataSource==="discord"?"/data/discord/playerAchievements.json":"/data/playerAchievements.json",a=await fetch(o);if(!a.ok)throw new Error(`Failed to load achievements: ${a.status} ${a.statusText}`);const r=await a.json();l&&h(r)}catch(o){l&&c(o instanceof Error?o.message:"Failed to load achievements")}finally{l&&N(!1)}})(),()=>{l=!1}},[d.dataSource]);const p=(()=>{if(!n||!b)return null;const s=R?.Players?.find(o=>o.Joueur===n)?.SteamID;return s&&b.achievements[s]||null})();return T.useEffect(()=>{n&&b&&R&&R.Players?.find(o=>o.Joueur===n)?.SteamID},[n,b,R,d.dataSource]),{data:p,isLoading:g,error:f,metadata:{generatedAt:b?.generatedAt||null,totalPlayers:b?.totalPlayers||0,totalGames:b?.totalGames||0,totalModdedGames:b?.totalModdedGames||0}}}function Xe(n,d,R){if(!n||n.trim()===""||d.length===0)return null;const b=[];let h=n;d.forEach(s=>{const o=s.PlayerStats.find(a=>Z(a)===n||a.Username.toLowerCase()===n.toLowerCase());if(o){h=o.Username;const a=o.MainRoleInitial==="Louveteau"?o.MainRoleInitial:ve(o.MainRoleInitial,o.MainRoleChanges||[]),r=ie(a);if(R&&R!=="Tous les camps"&&r!==R)return;const x=De(s),i=o.Victorious,m=Pe(new Date(s.StartDate)),D=je(s.StartDate,s.EndDate)||0;b.push({gameId:s.Id,date:m,camp:r,won:i,winnerCamp:x,playersInGame:s.PlayerStats.length,mapName:s.MapName,duration:D})}}),b.sort((s,o)=>{const a=r=>{const x=r.split("/");return x.length===3?new Date(parseInt(x[2]),parseInt(x[1])-1,parseInt(x[0])):new Date(r)};return a(o.date).getTime()-a(s.date).getTime()});const g=b.length,N=b.filter(s=>s.won).length,f=g>0?(N/g*100).toFixed(2):"0.00",c={};b.forEach(s=>{c[s.camp]||(c[s.camp]={appearances:0,wins:0,winRate:"0.00"}),c[s.camp].appearances++,s.won&&c[s.camp].wins++}),Object.keys(c).forEach(s=>{const o=c[s];o.winRate=o.appearances>0?(o.wins/o.appearances*100).toFixed(2):"0.00"});const p={};b.forEach(s=>{p[s.mapName]||(p[s.mapName]={appearances:0,wins:0,winRate:"0.00"}),p[s.mapName].appearances++,s.won&&p[s.mapName].wins++}),Object.keys(p).forEach(s=>{const o=p[s];o.winRate=o.appearances>0?(o.wins/o.appearances*100).toFixed(2):"0.00"});const l=b.reduce((s,o)=>s+o.duration,0);return{playerName:h,totalGames:g,totalWins:N,winRate:f,totalPlayTime:l,games:b,campStats:c,mapStats:p}}function Ze(n){const d={};let R=0,b=0;return Object.entries(n).forEach(([h,g])=>{h==="Village"||h==="ChÃ¢teau"?d[h]={...g}:(R+=g.appearances,b+=g.wins)}),R>=10&&(d.Autres={appearances:R,wins:b,winRate:R>0?(b/R*100).toFixed(2):"0.00"}),d}function oe(n,d){const{data:R,isLoading:b,error:h}=de(g=>n?Xe(n,g,d):null);return{data:R,isLoading:b,error:h}}function Qe({achievements:n,title:d,emptyMessage:R,achievementType:b="all"}){const{navigateToTab:h,updateNavigationState:g,clearNavigation:N}=Q(),{settings:f,updateSettings:c}=ce(),{joueursData:p}=ne(),l=ue(p),s=(t,C)=>{if(C.stopPropagation(),!t.redirectTo)return;N();const A=f.highlightedPlayer;if(c(b==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:A,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:"all",playerFilter:{mode:"none",players:[]},highlightedPlayer:A,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}}),t.category==="comparison"&&t.redirectTo.subTab==="comparison"){const u=f.highlightedPlayer||"",v=o(t.description,u);v&&g({playerComparisonState:{selectedPlayer1:u,selectedPlayer2:v,showDetailedStats:!0}})}if(t.category==="comparison"&&t.redirectTo.subTab==="pairing"){const u=t.description.toLowerCase().includes("loup");g({selectedPairingTab:u?"wolves":"lovers"})}if(t.category==="kills"&&t.redirectTo.subTab==="deathStats"){const u=t.description.match(/(Villageois|Loups|Autres)/i);u&&g({deathStatsSelectedCamp:u[1]});let v=10;const P=t.description.match(/min\.\s*(\d+)/);P&&(v=parseInt(P[1],10));let k="totalKills",w="killers";const F=t.redirectTo.chartSection;F&&(F==="killers-total"?(k="totalKills",w="killers"):F==="killers-average"?(k="averageKills",w="killers"):F==="deaths-total"?(k="totalDeaths",w="deaths"):F==="survivors-average"?(k="survivalRate",w="deaths"):(F==="hunters-good"||F==="hunters-bad")&&(w="hunter",k="averageKills")),g({deathStatisticsState:{selectedCamp:u?.[1]||"Tous les camps",minGamesForAverage:v,selectedView:w,focusChart:k}})}if(t.category==="map"&&t.redirectTo.subTab==="playersGeneral"){const u=t.redirectTo.mapFilter||"all";let v=10;const P=t.description.match(/min\.\s*(\d+)/);P&&(v=parseInt(P[1])),c(b==="modded"?{gameFilter:"modded",dateRange:{start:null,end:null},mapNameFilter:u,playerFilter:{mode:"none",players:[]},highlightedPlayer:A,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!0,gameFilter:"modded",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:u,playerFilter:{mode:"none",players:[]}}}:{gameFilter:"all",dateRange:{start:null,end:null},mapNameFilter:u,playerFilter:{mode:"none",players:[]},highlightedPlayer:A,useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!0,mapNameFilter:u,playerFilter:{mode:"none",players:[]}}}),g({playersGeneralState:{minGamesForWinRate:v,winRateOrder:"best",focusChart:"winRate"}}),h("players","playersGeneral");return}if(t.category==="history"&&t.redirectTo.subTab==="history"&&g({selectedPlayerName:f.highlightedPlayer||"",groupingMethod:"session"}),t.category==="series"&&t.redirectTo.subTab==="series"){let u="wins";const v=t.title.toLowerCase(),P=t.description.toLowerCase();v.includes("dÃ©faite")||P.includes("dÃ©faite")?u="losses":v.includes("loup")||P.includes("loup")?u="loup":v.includes("villageois")||P.includes("villageois")?u="villageois":(v.includes("victoire")||P.includes("victoire"))&&(u="wins"),g({selectedSeriesType:u})}if(t.category==="general"&&t.redirectTo.subTab==="playersGeneral"){let u=10;const v=t.description.match(/min\.\s*(\d+)/);v&&(u=parseInt(v[1],10));let P="winRate",k="best";const w=t.title.toLowerCase(),F=t.description.toLowerCase();w.includes("participation")||F.includes("participation")?P="participation":(w.includes("taux de victoire")||F.includes("taux de victoire"))&&(P="winRate",(w.includes("moins bon")||w.includes("mauvais")||F.includes("moins bon")||F.includes("mauvais"))&&(k="worst")),g({playersGeneralState:{minGamesForWinRate:u,winRateOrder:k,focusChart:P}})}if(t.category==="performance"&&t.redirectTo.subTab==="campStats"){const u=t.redirectTo.chartSection;let v="Villageois",P=1;u&&(u==="camp-loup"?v="Loup":u==="camp-villageois"?v="Villageois":u==="camp-idiot"?v="Idiot du Village":u==="camp-amoureux"?v="Amoureux":(u==="solo-roles"||u==="hall-of-fame")&&(v="Villageois"));const k=t.description.match(/min\.\s*(\d+)/);k&&(P=parseInt(k[1],10)),u==="solo-roles"?v="RÃ´les spÃ©ciaux":u==="hall-of-fame"&&(v="Tous les camps"),g({campPerformanceState:{selectedCampPerformanceCamp:v,selectedCampPerformanceMinGames:P,viewMode:"performance"}})}if(t.category==="voting"&&t.redirectTo.subTab==="votingStats"){const u=t.title.toLowerCase();let v="overview",P="behavior";u.includes("agressivitÃ©")?(v="overview",P="behavior"):u.includes("taux de vote")?(v="behavior",P="voteRate"):u.includes("prÃ©cision")&&(v="overview",P="accuracy"),g({votingStatsState:{selectedCategory:v,selectedView:P}})}if(t.category==="loot"&&t.redirectTo.subTab==="lootStats"){const u=t.redirectTo,v=u.minGames||5,P=u.view||"normalized";g({lootStatsState:{minGames:v,campFilter:"all",view:P}})}h(t.redirectTo.tab,t.redirectTo.subTab)},o=(t,C)=>{const A=[/avec ([^:]+?):/,/contre ([^:]+?):/];for(const u of A){const v=t.match(u);if(v&&v[1]){const P=v[1].trim();if(P!==C)return P}}return null},a=t=>{if(!t.redirectTo)return"Aucune navigation disponible";switch(t.category){case"general":if(t.redirectTo.subTab==="playersGeneral"){const u=t.description.match(/min\.\s*(\d+)/),v=u?parseInt(u[1],10):10,P=t.title.toLowerCase(),k=b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return P.includes("taux de victoire")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les taux de victoire (min. ${v} parties)${k}`:P.includes("participation")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les participations${k}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le classement gÃ©nÃ©ral des joueurs${k}`}break;case"map":if(t.redirectTo.subTab==="playersGeneral"){const u=t.redirectTo.mapFilter,v=u==="village"?"Village":u==="chateau"?"ChÃ¢teau":"map",P=b==="modded"?" (Filtres parties moddÃ©es + map activÃ©s)":" (Filtre map activÃ©)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques gÃ©nÃ©rales filtrÃ©es sur ${v}${P}`}break;case"history":if(t.redirectTo.subTab==="history")return"Cliquez pour voir l'historique dÃ©taillÃ© du joueur par map";break;case"comparison":if(t.redirectTo.subTab==="comparison")return`Cliquez pour comparer avec ${o(t.description,f.highlightedPlayer||"")||"ce joueur"}`;if(t.redirectTo.subTab==="pairing")return"Cliquez pour voir les statistiques de paires";break;case"kills":if(t.redirectTo.subTab==="deathStats"){const u=t.description.match(/(Villageois|Loups|Autres)/i),v=t.description.match(/min\.\s*(\d+)/),P=v?parseInt(v[1],10):10,k=u?.[1]||"Tous les camps",w=t.redirectTo.chartSection;let F="kills et morts";return w==="killers-total"?F="total des kills":w==="killers-average"?F=`moyenne des kills (min. ${P} parties)`:w==="deaths-total"?F="total des morts":w==="survivors-average"&&(F=`taux de survie (min. ${P} parties)`),`Cliquez pour voir les statistiques de ${F} ${k!=="Tous les camps"?`en ${k}`:""}`}break;case"series":if(t.redirectTo.subTab==="series"){const u=t.title.toLowerCase(),v=t.description.toLowerCase();return u.includes("dÃ©faite")||v.includes("dÃ©faite")?"Cliquez pour voir les sÃ©ries de dÃ©faites":u.includes("loup")||v.includes("loup")?"Cliquez pour voir les sÃ©ries Loups":u.includes("villageois")||v.includes("villageois")?"Cliquez pour voir les sÃ©ries Villageois":u.includes("victoire")||v.includes("victoire")?"Cliquez pour voir les sÃ©ries de victoires":"Cliquez pour voir les sÃ©ries consÃ©cutives"}break;case"performance":if(t.redirectTo.subTab==="campStats"){const u=t.redirectTo.chartSection,v=b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return u==="camp-loup"?`Cliquez pour voir les performances camp Loup${v}`:u==="camp-villageois"?`Cliquez pour voir les performances camp Villageois${v}`:u==="camp-idiot"?`Cliquez pour voir les performances camp Idiot du Village${v}`:u==="camp-amoureux"?`Cliquez pour voir les performances camp Amoureux${v}`:u==="solo-roles"?`Cliquez pour voir le classement (rÃ´les spÃ©ciaux)${v}`:u==="hall-of-fame"?`Cliquez pour voir le Hall of Fame (toutes performances)${v}`:`Cliquez pour voir les performances par camp${v}`}break;case"voting":if(t.redirectTo.subTab==="votingStats"){const u=t.description.match(/min\.\s*(\d+)/),v=u?parseInt(u[1],10):25,P=b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)",k=t.title.toLowerCase();return k.includes("agressivitÃ©")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le score d'agressivitÃ© (min. ${v} meetings)${P}`:k.includes("taux de vote")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de vote (min. ${v} meetings)${P}`:k.includes("prÃ©cision")?`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir la prÃ©cision des votes${P}`:`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir les statistiques de vote${P}`}break;case"loot":if(t.redirectTo.subTab==="lootStats"){const u=t.description.match(/min\.\s*(\d+)/),v=u?parseInt(u[1],10):25,P=b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)";return`Classement: ${t.rank}${t.totalRanked?`/${t.totalRanked} joueurs`:""} - Cliquez pour voir le taux de rÃ©colte (min. ${v} parties)${P}`}break}return`Cliquez pour voir ${t.redirectTo.subTab}`+(b==="modded"?" (Filtre parties moddÃ©es activÃ©)":" (Filtres rÃ©initialisÃ©s)")},r=t=>l[t]||Me(t),x=t=>{const C=[/avec ([^:]+?):/,/contre ([^:]+?):/];let A=t;return C.forEach(u=>{const v=t.match(u);if(v&&v[1]){const P=v[1].trim(),w=`<span class="player-name-highlight" style="color: ${r(P)};">${P}</span>`;A=A.replace(P,w)}}),A};if(n.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:d}),e.jsx("p",{children:R||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const i=t=>t===1?"ðŸ¥‡":t===2?"ðŸ¥ˆ":t===3?"ðŸ¥‰":"",m=t=>t===1?"rank-1":t===2?"rank-2":t===3?"rank-3":t&&t<=10?"rank-top-10":"",D=(t,C)=>{if(!t||t<=3||!C)return;const A=t-3,u=C-3;return u<=1?"hsl(120, 70%, 50%)":`hsl(${120*(1-(A-1)/(u-1))}, 70%, 50%)`},M=t=>{if(!t)return;const C=t.match(/hsl\((\d+),\s*(\d+)%,\s*(\d+)%\)/);if(C){const[,A,u]=C;return`hsl(${A}, ${u}%, 40%)`}return t},$=n.filter(t=>t.category!=="comparison"&&(t.type==="good"||t.type==="neutral")).sort((t,C)=>(t.rank??999)-(C.rank??999)),L=n.filter(t=>t.category!=="comparison"&&t.type==="bad").sort((t,C)=>(t.rank??999)-(C.rank??999)),y=n.filter(t=>t.category==="comparison"),S=$.filter(t=>t.rank&&t.rank<=3).length;return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:d}),S>0&&e.jsxs("div",{className:"top3-showcase",children:[e.jsx("h5",{className:"top3-title",children:"âœ¨ Podium d'Excellence âœ¨"}),e.jsx("div",{className:"top3-grid",children:$.filter(t=>t.rank&&t.rank<=3).map((t,C)=>e.jsxs("div",{className:`top3-card ${m(t.rank)} animate-slide-in`,style:{animationDelay:`${C*.15}s`},onClick:A=>s(t,A),title:a(t),children:[e.jsx("div",{className:"top3-medal-container",children:e.jsx("span",{className:"top3-medal",children:i(t.rank)})}),e.jsxs("div",{className:"top3-content",children:[e.jsxs("div",{className:"top3-rank-badge",children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]}),e.jsx("h6",{className:"top3-achievement-title",children:t.title}),e.jsx("p",{className:"top3-achievement-description",children:t.description})]}),e.jsxs("div",{className:"top3-sparkles",children:[e.jsx("span",{className:"sparkle sparkle-1",children:"âœ¨"}),e.jsx("span",{className:"sparkle sparkle-2",children:"â­"}),e.jsx("span",{className:"sparkle sparkle-3",children:"âœ¨"})]})]},t.id))})]}),$.length>0&&e.jsxs("div",{className:"achievements-section good-achievements",children:[e.jsx("h5",{children:"ðŸ† Classements"}),e.jsx("div",{className:"achievements-grid",children:$.filter(t=>!t.rank||t.rank>3).map((t,C)=>{const A=D(t.rank,t.totalRanked),u=M(A);return e.jsxs("div",{className:`achievement-card good ${m(t.rank)}`,onClick:v=>s(t,v),title:a(t),style:{animationDelay:`${C*.05}s`,borderLeftColor:u,...A&&{borderLeftWidth:"4px"}},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:t.title}),e.jsxs("span",{className:"achievement-rank",style:A?{backgroundColor:A}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:t.description})]},t.id)})})]}),L.length>0&&e.jsxs("div",{className:"achievements-section bad-achievements",children:[e.jsx("h5",{children:"ðŸ’€ Classements (InversÃ©s)"}),e.jsx("div",{className:"achievements-grid",children:L.map(t=>{const C=D(t.rank,t.totalRanked),A=M(C);return e.jsxs("div",{className:`achievement-card bad rank-${t.rank}`,onClick:u=>s(t,u),title:a(t),style:{borderLeftColor:A,...C&&{borderLeftWidth:"4px"}},children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:t.title}),e.jsxs("span",{className:"achievement-rank",style:C?{backgroundColor:C}:{},children:["#",t.rank,t.totalRanked?`/${t.totalRanked}`:""]})]}),e.jsx("p",{className:"achievement-description",children:t.description})]},t.id)})})]}),y.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:y.map(t=>e.jsxs("div",{className:"achievement-card comparison",onClick:C=>s(t,C),title:a(t),children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:t.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:x(t.description)}})]},t.id))})]})]})}function et({selectedPlayerName:n,groupingMethod:d,campFilter:R="all"}){const{navigateToGameDetails:b}=Q(),{data:h,isLoading:g,error:N}=oe(n),f=T.useMemo(()=>{switch(d){case"month":return"par Mois";case"quarter":return"par Trimestre";case"year":return"par AnnÃ©e";default:return"par Session"}},[d]),c=T.useMemo(()=>{if(!h?.games)return new Map;const o=new Map;return h.games.forEach(a=>{if(!o.has(a.date)){const r=a.date.split("/");r.length===3?o.set(a.date,new Date(parseInt(r[2]),parseInt(r[1])-1,parseInt(r[0])).getTime()):o.set(a.date,new Date(a.date).getTime())}}),o},[h?.games]),p=T.useMemo(()=>{if(!h?.games)return[];const o={};return h.games.forEach(a=>{if(R!=="all"){if(R==="solo"){if(a.camp==="Villageois"||a.camp==="Loup")return}else if(a.camp!==R)return}let r;const x=a.date.split("/");if(d==="month")if(x.length===3)r=`${x[1].padStart(2,"0")}/${x[2]}`;else{const i=new Date(a.date);r=`${String(i.getMonth()+1).padStart(2,"0")}/${i.getFullYear()}`}else if(d==="quarter")if(x.length===3){const i=parseInt(x[1],10);r=`T${Math.floor((i-1)/3)+1}/${x[2]}`}else{const i=new Date(a.date);r=`T${Math.floor(i.getMonth()/3)+1}/${i.getFullYear()}`}else d==="year"?x.length===3?r=`${x[2]}`:r=`${new Date(a.date).getFullYear()}`:r=a.date;o[r]||(o[r]={games:[],wins:0,total:0}),o[r].games.push(a),o[r].total++,a.won&&o[r].wins++}),Object.entries(o).map(([a,r])=>({period:a,totalGames:r.total,victories:r.wins,defeats:r.total-r.wins,winRate:r.total>0?(r.wins/r.total*100).toFixed(1):"0.0",winRateNum:r.total>0?r.wins/r.total*100:0})).sort((a,r)=>{if(d==="month"){const[x,i]=a.period.split("/"),[m,D]=r.period.split("/"),M=new Date(parseInt(i),parseInt(x)-1,1),$=new Date(parseInt(D),parseInt(m)-1,1);return M.getTime()-$.getTime()}else if(d==="quarter"){const[x,i]=a.period.split("/"),[m,D]=r.period.split("/"),M=parseInt(x.replace(/\D/g,""),10)||1,$=parseInt(m.replace(/\D/g,""),10)||1,L=new Date(parseInt(i,10),(M-1)*3,1),y=new Date(parseInt(D,10),($-1)*3,1);return L.getTime()-y.getTime()}else if(d==="year"){const x=parseInt(a.period,10),i=parseInt(r.period,10);return x-i}else{const x=c.get(a.period)||0,i=c.get(r.period)||0;return x-i}})},[h,d,c,R]),s=(o=>o<=15?{fontSize:12,angle:-45,height:80,interval:0}:o<=30?{fontSize:12,angle:-45,height:85,interval:1}:o<=50?{fontSize:12,angle:-60,height:95,interval:2}:{fontSize:12,angle:-75,height:105,interval:Math.floor(o/12)})(p.length);return g?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):N?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",N]}):h?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Ã‰volution des Performances ",f]}),e.jsx(B,{title:`Ã‰volution des Performances ${f}`,children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs($e,{data:p,margin:{top:20,right:30,left:20,bottom:20},onClick:o=>{if(o&&o.activeLabel){const a=p.find(r=>r.period===o.activeLabel);a&&b({selectedPlayer:n,selectedDate:a.period,fromComponent:`Ã‰volution des Performances ${f}`})}},style:{cursor:"pointer"},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"period",angle:s.angle,textAnchor:"end",height:s.height,interval:s.interval,fontSize:s.fontSize}),e.jsx(H,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(V,{content:({active:o,payload:a})=>{if(o&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.period})}),e.jsxs("div",{children:["Parties: ",r.totalGames]}),e.jsxs("div",{children:["Victoires: ",r.victories]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(ze,{type:"monotone",dataKey:"winRateNum",stroke:"var(--accent-primary)",strokeWidth:2,dot:{fill:"var(--accent-primary)",strokeWidth:2,r:4}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["RÃ©partition Victoires/DÃ©faites ",f]}),e.jsx(B,{title:`RÃ©partition Victoires/DÃ©faites ${f}`,children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:p,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"period",angle:s.angle,textAnchor:"end",height:s.height,interval:s.interval,fontSize:s.fontSize}),e.jsx(H,{label:{value:"Nombre de parties",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(V,{content:({active:o,payload:a})=>{if(o&&a&&a.length>0){const r=a[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.period})}),e.jsxs("div",{children:["Total: ",r.totalGames," parties"]}),e.jsxs("div",{children:["Victoires: ",r.victories]}),e.jsxs("div",{children:["DÃ©faites: ",r.defeats]}),e.jsxs("div",{children:["Taux: ",r.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(_,{dataKey:"victories",stackId:"games",fill:"var(--accent-tertiary)",name:"Victoires",children:p.map((o,a)=>e.jsx(U,{fill:"var(--accent-tertiary)",onClick:()=>{b({selectedPlayer:n,selectedDate:o.period,fromComponent:`Historique Joueur - Victoires ${f}`})},style:{cursor:"pointer"}},`cell-victories-${a}`))}),e.jsx(_,{dataKey:"defeats",stackId:"games",fill:"var(--chart-color-4)",name:"DÃ©faites",children:p.map((o,a)=>e.jsx(U,{fill:"var(--chart-color-4)",onClick:()=>{b({selectedPlayer:n,selectedDate:o.period,fromComponent:`Historique Joueur - DÃ©faites ${f}`})},style:{cursor:"pointer"}},`cell-defeats-${a}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function tt({selectedPlayerName:n}){const{navigateToGameDetails:d}=Q(),{data:R,isLoading:b,error:h}=oe(n),g=se(),N=T.useMemo(()=>R?.campStats?Object.entries(R.campStats).map(([c,p])=>({name:c,value:p.appearances,winRate:p.winRate,winRateDisplay:Math.max(parseFloat(p.winRate),1),wins:p.wins,percentage:(p.appearances/R.totalGames*100).toFixed(1)})):[],[R]),f=T.useMemo(()=>{if(!N.length)return[];const c=5;let p=0;const l=[],s=[];if(N.forEach(o=>{parseFloat(o.percentage)<c?(p+=Number(o.value),l.push(o)):s.push(o)}),p>0){const o=N.reduce((a,r)=>a+Number(r.value),0);s.push({name:"Autres",value:p,winRate:"0.0",winRateDisplay:1,wins:l.reduce((a,r)=>a+r.wins,0),percentage:(p/o*100).toFixed(1),_details:l})}return s},[N]);return b?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):h?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",h]}):R?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Distribution par Camps"}),e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(Ce,{children:[e.jsx(we,{data:f,cx:"50%",cy:"50%",labelLine:!1,outerRadius:120,fill:"#8884d8",dataKey:"value",label:c=>{const p=c.percent!==void 0?c.percent:0;return c.name==="Autres"?`Autres : ${c.value} (${(p*100).toFixed(1)}%)`:`${c.name}: ${c.value} (${(p*100).toFixed(1)}%)`},children:f.map((c,p)=>e.jsx(U,{fill:c.name==="Autres"?be:g[c.name]||`var(--chart-color-${p%6+1})`,onClick:()=>{if(c.name==="Autres"){const l=c._details?.map(s=>s.name)||[];d({selectedPlayer:n,campFilter:{selectedCamp:"Autres",campFilterMode:"all-assignments",_smallCamps:l},fromComponent:"Distribution par Camps"})}else c.name==="TraÃ®tre"||c.name==="Louveteau"?d({selectedPlayer:n,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):c.name==="Loup"?d({selectedPlayer:n,campFilter:{selectedCamp:"Loup",campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Distribution par Camps"}):d({selectedPlayer:n,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments"},fromComponent:"Distribution par Camps"})},style:{cursor:"pointer"}},`cell-${p}`))}),e.jsx(V,{content:({active:c,payload:p})=>{if(c&&p&&p.length>0){const l=p[0].payload;if(l.name==="Autres"&&l._details){const s=[...l._details].sort((o,a)=>a.value-o.value);return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Autres - ",l.value," parties (",l.percentage,"%)"]})}),e.jsx("div",{children:s.map((o,a)=>e.jsxs("div",{children:[o.name,": ",o.value," parties (",o.percentage,"%)"]},a))}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir toutes les parties de ces camps"})]})}return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsxs("strong",{children:[l.name," - ",l.value," parties (",l.percentage,"%)"]})}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Performance par Camp"}),e.jsx(B,{title:"Performance par Camp",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:N,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(V,{content:({active:c,payload:p})=>{if(c&&p&&p.length>0){const l=p[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:l.name})}),e.jsxs("div",{children:["Victoires: ",l.wins," / ",l.value]}),e.jsxs("div",{children:["Taux: ",l.winRate,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(_,{dataKey:"winRateDisplay",children:N.map((c,p)=>e.jsx(U,{fill:parseFloat(c.winRate)===0?`${g[c.name]||`var(--chart-color-${p%6+1})`}50`:g[c.name]||`var(--chart-color-${p%6+1})`,onClick:()=>{c.name==="TraÃ®tre"||c.name==="Louveteau"?d({selectedPlayer:n,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):c.name==="Loup"?d({selectedPlayer:n,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments",excludeWolfSubRoles:!0},fromComponent:"Performance par Camp"}):d({selectedPlayer:n,campFilter:{selectedCamp:c.name,campFilterMode:"all-assignments"},fromComponent:"Performance par Camp"})},style:{cursor:"pointer"}},`cell-${p}`))})]})})})})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function at({selectedPlayerName:n}){const{navigateToGameDetails:d,navigationState:R,updateNavigationState:b}=Q(),[h,g]=T.useState(R.playerHistoryMapState?.selectedCamp||"Tous les camps"),{data:N}=Ie(),{data:f,isLoading:c,error:p}=oe(n,h);T.useEffect(()=>{(!R.playerHistoryMapState||R.playerHistoryMapState.selectedCamp!==h)&&b({playerHistoryMapState:{selectedCamp:h}})},[h,R.playerHistoryMapState,b]);const l=o=>{g(o),b({playerHistoryMapState:{selectedCamp:o}})},s=T.useMemo(()=>{if(!f?.mapStats)return[];const o=Ze(f.mapStats);return Object.entries(o).map(([a,r])=>({name:a,value:r.appearances,winRate:r.winRate,winRateDisplay:Math.max(parseFloat(r.winRate),.1),wins:r.wins,percentage:(r.appearances/f.totalGames*100).toFixed(1)}))},[f]);return c?e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique du joueur..."}):p?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",p]}):f?e.jsx("div",{className:"lycans-graphiques-groupe",children:e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsxs("h3",{children:["Performance par Carte",h!=="Tous les camps"?` (${h})`:""]}),e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select-map",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select-map",value:h,onChange:o=>l(o.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"}),N?.map(o=>e.jsx("option",{value:o,children:o},o))]})]}),s.length===0?e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de carte disponible"}),e.jsx("p",{children:"Aucune statistique de carte n'est disponible pour ce joueur avec le camp sÃ©lectionnÃ©."})]}):e.jsx(B,{title:"Performance par Carte",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:s,margin:{top:20,right:140,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Taux de victoire (%)",angle:270,position:"left",style:{textAnchor:"middle"}},domain:[0,100]}),e.jsx(pe,{y:50,stroke:"var(--text-secondary)",strokeDasharray:"5 5",strokeOpacity:.5}),(()=>{if(s.length>0){const o=s.reduce((x,i)=>x+i.value,0),a=s.reduce((x,i)=>x+i.wins,0),r=o>0?a/o*100:0;if(r!==50)return e.jsx(pe,{y:r,stroke:"var(--accent-primary)",strokeDasharray:"3 3",strokeOpacity:.7,label:{value:`Moyenne: ${r.toFixed(1)}%`,position:"right",offset:5,style:{fill:"var(--accent-primary)"}}})}return null})(),e.jsx(V,{content:({active:o,payload:a})=>{if(o&&a&&a.length>0){const r=a[0].payload,x=[];return s.forEach(i=>{if(i.name!==r.name&&i.value>=5){const m=parseFloat(r.winRate)-parseFloat(i.winRate);Math.abs(m)>=2&&x.push({map:i.name,diff:m,better:m>0})}}),e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)",maxWidth:"250px"},children:[e.jsx("div",{children:e.jsx("strong",{children:r.name})}),e.jsxs("div",{children:["Parties: ",r.value]}),e.jsxs("div",{children:["Victoires: ",r.wins]}),e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("strong",{children:["Taux: ",r.winRate,"%"]})}),x.length>0&&e.jsxs("div",{style:{borderTop:"1px solid var(--border-color)",paddingTop:"0.5rem",marginTop:"0.5rem"},children:[e.jsx("div",{style:{fontSize:"0.8rem",fontWeight:"bold",marginBottom:"0.25rem"},children:"Comparaisons:"}),x.map((i,m)=>e.jsxs("div",{style:{fontSize:"0.75rem",color:i.better?"var(--accent-tertiary)":"var(--chart-color-4)"},children:[i.better?"â†—":"â†˜"," ",Math.abs(i.diff).toFixed(1),"% vs ",i.map]},m))]}),e.jsx("div",{style:{fontSize:"0.7rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null}}),e.jsx(_,{dataKey:"winRateDisplay",label:o=>{const{x:a,y:r,width:x,payload:i}=o;if(a===void 0||r===void 0||x===void 0||!i)return null;const m=i.winRate||"0";return e.jsxs("text",{x:a+x/2,y:r-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[m,"%"]})},onClick:o=>{if(o&&o.name){const a={selectedPlayer:n,selectedMapName:o.name,fromComponent:"Performance par Carte"};h!=="Tous les camps"&&(a.campFilter={selectedCamp:h,campFilterMode:"all-assignments"}),d(a)}},children:s.map((o,a)=>{let r;o.name==="Village"?r="var(--accent-secondary)":o.name==="ChÃ¢teau"?r="var(--accent-tertiary)":o.name==="Autres"?r=be:r=`var(--chart-color-${a%6+1})`;const x=Math.max(...s.map(m=>parseFloat(m.winRate))),i=parseFloat(o.winRate)===x&&x>0;return e.jsx(U,{fill:parseFloat(o.winRate)===0?`${r}30`:r,stroke:"transparent",strokeWidth:i?3:1,style:{cursor:"pointer"}},`cell-map-${a}`)})})]})})})})]})}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e d'historique disponible"})}function st({selectedPlayerName:n}){const{gameData:d}=ye(),{joueursData:R}=ne(),b=ue(R),h=se(),g=T.useMemo(()=>{if(!d||!n)return{playersKilled:[],killedBy:[],deathTypes:[],availableDeathTypes:[]};const f={},c={},p={},l=new Set;d.forEach(x=>{const i=x.PlayerStats.find(m=>m.Username.toLowerCase()===n.toLowerCase());if(i&&(x.PlayerStats.forEach(m=>{m.KillerName?.toLowerCase()===n.toLowerCase()&&(f[m.Username]=(f[m.Username]||0)+1)}),i.KillerName&&(c[i.KillerName]=(c[i.KillerName]||0)+1),i.DeathType)){const m=i.DeathType,D=re(m);p[D]||(p[D]={count:0,byDeathType:{}}),p[D].count+=1,p[D].byDeathType[m]=(p[D].byDeathType[m]||0)+1,l.add(m)}});const s=Object.entries(f).map(([x,i])=>({player:x,kills:i})).sort((x,i)=>i.kills-x.kills).slice(0,10),o=Object.entries(c).map(([x,i])=>({player:x,kills:i})).sort((x,i)=>i.kills-x.kills).slice(0,10),a=Object.entries(p).map(([x,i])=>{const m={deathType:x,count:i.count};return m[x]=i.count,m}).sort((x,i)=>i.count-x.count).slice(0,10),r=Object.keys(p);return{playersKilled:s,killedBy:o,deathTypes:a,availableDeathTypes:r}},[d,n]),N=T.useMemo(()=>{const f={};g.availableDeathTypes.forEach(l=>{l==="TuÃ© par Loup"?f[l]=h.Loup:l==="Mort aux votes"?f[l]="var(--chart-color-1)":l.includes("Chasseur")?f[l]=h.Chasseur:l==="TuÃ© par Zombie"?f[l]=h.Vaudou:l==="TuÃ© par potion assassin"?f[l]=h.Alchimiste:l==="TuÃ© par Vengeur"?f[l]="var(--chart-color-2)":l==="Amoureux mort"?f[l]=h.Amoureux:l==="TuÃ© par La BÃªte"?f[l]="var(--chart-color-3)":l==="TuÃ© par ShÃ©rif"&&(f[l]="var(--chart-color-4)")});const c=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let p=0;return g.availableDeathTypes.forEach(l=>{f[l]||(f[l]=c[p%c.length],p++)}),f},[g.availableDeathTypes,h]);return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[g.playersKilled.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Victimes"}),e.jsx(B,{title:"Les Victimes",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:g.playersKilled,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(V,{content:({active:f,payload:c})=>{if(f&&c&&c.length>0){const p=c[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:p.player})}),e.jsxs("div",{children:["TuÃ© ",p.kills," fois par ",n]})]})}return null}}),e.jsx(_,{dataKey:"kills",children:g.playersKilled.map((f,c)=>e.jsx(U,{fill:b[f.player]||"var(--chart-color-3)"},`cell-killed-${c}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucun kill enregistrÃ©"}),e.jsxs("p",{children:[n," n'a tuÃ© aucun joueur dans les parties enregistrÃ©es."]})]}),g.killedBy.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Les Tueurs"}),e.jsx(B,{title:"Les Tueurs",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:g.killedBy,margin:{top:20,right:30,left:20,bottom:20},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"player",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:"Nombre de kills",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(V,{content:({active:f,payload:c})=>{if(f&&c&&c.length>0){const p=c[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:p.player})}),e.jsxs("div",{children:["A tuÃ© ",n," ",p.kills," fois"]})]})}return null}}),e.jsx(_,{dataKey:"kills",children:g.killedBy.map((f,c)=>e.jsx(U,{fill:b[f.player]||"var(--chart-color-4)"},`cell-killer-${c}`))})]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune mort par kill"}),e.jsxs("p",{children:[n," n'a jamais Ã©tÃ© tuÃ© par un autre joueur dans les parties enregistrÃ©es."]})]}),g.deathTypes.length>0?e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"Types de Mort les Plus FrÃ©quents"}),e.jsx(B,{title:"Types de Mort les Plus FrÃ©quents",children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:g.deathTypes,margin:{top:20,right:30,left:20,bottom:90},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"deathType",angle:-45,textAnchor:"end",height:120,interval:0,fontSize:12}),e.jsx(H,{label:{value:"Nombre de morts",angle:270,position:"left",style:{textAnchor:"middle"}},allowDecimals:!1}),e.jsx(V,{content:({active:f,payload:c})=>{if(f&&c&&c.length>0){const p=c[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:p.deathType})}),e.jsxs("div",{children:[n," est mort ",p.count," fois ainsi"]})]})}return null}}),g.availableDeathTypes.map(f=>e.jsx(_,{dataKey:f,name:f,stackId:"deaths",fill:N[f]||"var(--chart-color-5)"},f))]})})})})]}):e.jsxs("div",{className:"lycans-empty-section",children:[e.jsx("h3",{children:"Aucune donnÃ©e de mort"}),e.jsxs("p",{children:["Aucune information de mort disponible pour ",n,"."]})]})]})}function rt(n,d){if(!n||n.trim()===""||d.length===0)return null;const R=new Map,b=new Map,h=new Map;d.forEach(p=>{if(!p.Modded)return;const l=p.PlayerStats.find(s=>Z(s)===n||s.Username.toLowerCase()===n.toLowerCase());if(l){if(l.MainRoleInitial==="Inconnu")return;const s=l.Victorious,a=ve(l.MainRoleInitial,l.MainRoleChanges||[])!==l.MainRoleInitial,r=ie(l.MainRoleInitial),x=r==="Loup"||r==="TraÃ®tre"||r==="Louveteau";if(r==="Villageois"&&me(l)){const i=he(l);if(i&&Le.includes(i)){const m=R.get(i)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};R.set(i,{appearances:m.appearances+1,wins:m.wins+(s?1:0),winsWithoutRoleChange:m.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:m.gamesWithoutRoleChange+(a?0:1)})}}else if(l.Power&&l.Power.trim()!==""&&l.Power!=="Inconnu"){if(r==="Villageois"){const i=R.get(l.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};R.set(l.Power,{appearances:i.appearances+1,wins:i.wins+(s?1:0),winsWithoutRoleChange:i.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:i.gamesWithoutRoleChange+(a?0:1)})}else if(x){const i=b.get(l.Power)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},m=i.roleBreakdown;m.set(l.MainRoleInitial,(m.get(l.MainRoleInitial)||0)+1),b.set(l.Power,{appearances:i.appearances+1,wins:i.wins+(s?1:0),winsWithoutRoleChange:i.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:i.gamesWithoutRoleChange+(a?0:1),roleBreakdown:m})}}else if((r==="Villageois"||x)&&l.Power!=="Inconnu")if(r==="Villageois"){const i=R.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};R.set("Aucun pouvoir",{appearances:i.appearances+1,wins:i.wins+(s?1:0),winsWithoutRoleChange:i.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:i.gamesWithoutRoleChange+(a?0:1)})}else{const i=b.get("Aucun pouvoir")||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0,roleBreakdown:new Map},m=i.roleBreakdown;m.set(l.MainRoleInitial,(m.get(l.MainRoleInitial)||0)+1),b.set("Aucun pouvoir",{appearances:i.appearances+1,wins:i.wins+(s?1:0),winsWithoutRoleChange:i.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:i.gamesWithoutRoleChange+(a?0:1),roleBreakdown:m})}if(l.SecondaryRole&&l.SecondaryRole.trim()!==""&&l.SecondaryRole!=="Inconnu"){const i=h.get(l.SecondaryRole)||{appearances:0,wins:0,winsWithoutRoleChange:0,gamesWithoutRoleChange:0};h.set(l.SecondaryRole,{appearances:i.appearances+1,wins:i.wins+(s?1:0),winsWithoutRoleChange:i.winsWithoutRoleChange+(!a&&s?1:0),gamesWithoutRoleChange:i.gamesWithoutRoleChange+(a?0:1)})}}});const g=new Map;d.forEach(p=>{const l=p.PlayerStats.find(s=>Z(s)===n||s.Username.toLowerCase()===n.toLowerCase());if(l&&me(l)){const s=he(l);s&&g.set(s,(g.get(s)||0)+1)}});const N=p=>Array.from(p.entries()).map(([l,s])=>({name:l,appearances:s.appearances,wins:s.wins,winsWithoutRoleChange:s.winsWithoutRoleChange,gamesWithoutRoleChange:s.gamesWithoutRoleChange,winRate:s.gamesWithoutRoleChange>0?(s.winsWithoutRoleChange/s.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Villageois",...g.has(l)&&{totalGamesAllModes:g.get(l)}})).sort((l,s)=>s.appearances-l.appearances),f=p=>Array.from(p.entries()).map(([l,s])=>({name:l,appearances:s.appearances,wins:s.wins,winsWithoutRoleChange:s.winsWithoutRoleChange,gamesWithoutRoleChange:s.gamesWithoutRoleChange,winRate:s.gamesWithoutRoleChange>0?(s.winsWithoutRoleChange/s.gamesWithoutRoleChange*100).toFixed(1):"0.0",camp:"Loup",roleBreakdown:Array.from(s.roleBreakdown.entries()).map(([o,a])=>({role:o,count:a})).sort((o,a)=>a.count-o.count)})).sort((l,s)=>s.appearances-l.appearances),c=p=>Array.from(p.entries()).map(([l,s])=>({name:l,appearances:s.appearances,wins:s.wins,winsWithoutRoleChange:s.winsWithoutRoleChange,gamesWithoutRoleChange:s.gamesWithoutRoleChange,winRate:s.gamesWithoutRoleChange>0?(s.winsWithoutRoleChange/s.gamesWithoutRoleChange*100).toFixed(1):"0.0"})).sort((l,s)=>s.appearances-l.appearances);return{villageoisPowers:N(R),loupPowers:f(b),secondaryRoles:c(h)}}function it({selectedPlayerName:n}){const{navigateToGameDetails:d,navigationState:R,updateNavigationState:b}=Q(),h=se(),[g,N]=T.useState(R.playerHistoryRolesState?.chartMode||"appearances"),{data:f,isLoading:c,error:p}=de(m=>rt(n,m));T.useEffect(()=>{(!R.playerHistoryRolesState||R.playerHistoryRolesState.chartMode!==g)&&b({playerHistoryRolesState:{chartMode:g}})},[g,R.playerHistoryRolesState,b]);const l=m=>{N(m),b({playerHistoryRolesState:{chartMode:m}})},s=T.useMemo(()=>{if(!f)return{villageoisPowers:[],loupPowers:[],secondaryRoles:[]};const m=1,D=1,M=15,$=g==="winRate"?(y,S)=>parseFloat(S.winRate)-parseFloat(y.winRate):(y,S)=>S.appearances-y.appearances,L=y=>({...y,winRateDisplay:Math.max(parseFloat(y.winRate),1)});return{villageoisPowers:f.villageoisPowers.filter(y=>y.appearances>=m).map(L).sort($).slice(0,M),loupPowers:f.loupPowers.filter(y=>y.appearances>=m).map(L).sort($).slice(0,M),secondaryRoles:f.secondaryRoles.filter(y=>y.appearances>=D).map(L).sort($).slice(0,M)}},[f,g]);if(c)return e.jsx("div",{className:"donnees-attente",children:"Chargement de l'historique des rÃ´les..."});if(p)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",p]});if(!f)return e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e de rÃ´le disponible"});const o=s.villageoisPowers.length>0,a=s.loupPowers.length>0,r=s.secondaryRoles.length>0;if(!o&&!a&&!r)return e.jsx("div",{className:"donnees-manquantes",children:"Aucun pouvoir ou rÃ´le secondaire trouvÃ©"});const x=({active:m,payload:D})=>{if(m&&D&&D.length>0){const M=D[0].payload,$=M.gamesWithoutRoleChange<M.appearances;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:8,border:"1px solid var(--border-color)"},children:[e.jsx("div",{children:e.jsx("strong",{children:M.name})}),e.jsxs("div",{children:["Apparitions: ",M.appearances]}),$&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:["dont ",M.appearances-M.gamesWithoutRoleChange," avec changement de rÃ´le (exclu du calcul)"]}),e.jsxs("div",{children:["Victoires: ",M.winsWithoutRoleChange]}),e.jsx("div",{children:e.jsxs("strong",{children:["Taux de victoire: ",M.winRate,"%"]})}),M.totalGamesAllModes&&M.totalGamesAllModes!==M.appearances&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic"},children:["(Total avec parties non moddÃ©es: ",M.totalGamesAllModes,")"]}),M.roleBreakdown&&M.roleBreakdown.length>0&&e.jsxs("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:[e.jsx("div",{style:{fontStyle:"italic"},children:"RÃ©partition par rÃ´le:"}),M.roleBreakdown.map((L,y)=>e.jsxs("div",{style:{marginLeft:"0.5rem"},children:["â€¢ ",L.role,": ",L.count]},y))]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"ðŸ–±ï¸ Cliquez pour voir les parties"})]})}return null},i=(m,D,M,$,L)=>{const y=g==="appearances"?"appearances":"winRateDisplay",S=g==="appearances"?"Nombre d'apparitions":"Taux de victoire (%)",t=g==="winRate"?[0,100]:void 0;return e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:D}),e.jsx(B,{title:D,children:e.jsx("div",{style:{height:400},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:m,margin:{top:20,right:30,left:20,bottom:80},children:[e.jsx(K,{strokeDasharray:"3 3"}),e.jsx(O,{dataKey:"name",angle:-45,textAnchor:"end",height:90,interval:0,fontSize:14}),e.jsx(H,{label:{value:S,angle:270,position:"left",style:{textAnchor:"middle"}},domain:t}),e.jsx(V,{content:e.jsx(x,{})}),e.jsx(_,{dataKey:y,label:g==="winRate"?C=>{const{x:A,y:u,width:v,payload:P}=C;if(A===void 0||u===void 0||v===void 0||!P)return null;const k=P.winRate||"0";return e.jsxs("text",{x:A+v/2,y:u-5,fill:"var(--text-primary)",textAnchor:"middle",fontSize:"12",fontWeight:"bold",children:[k,"%"]})}:void 0,children:m.map((C,A)=>e.jsx(U,{fill:L?L(C.name,A):M,onClick:()=>$(C.name),style:{cursor:"pointer"}},`cell-${A}`))})]})})})})]})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"chart-mode-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Affichage :"}),e.jsxs("select",{id:"chart-mode-select",value:g,onChange:m=>l(m.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"appearances",children:"Apparitions"}),e.jsx("option",{value:"winRate",children:"Taux de victoire"})]})]}),e.jsxs("div",{className:"lycans-graphiques-groupe",children:[o&&i(s.villageoisPowers,"Camp Villageois","var(--chart-color-1)",m=>{d({selectedPlayer:n,campFilter:{selectedCamp:"Villageois",campFilterMode:g==="winRate"?"wins-only":"all-assignments"},selectedPower:m,fromComponent:`Historique des RÃ´les - Pouvoir: ${m}`})},m=>m==="Chasseur"&&h.Chasseur?h.Chasseur:m==="Alchimiste"&&h.Alchimiste?h.Alchimiste:m==="Protecteur"&&h.Protecteur?h.Protecteur:m==="Disciple"&&h.Disciple?h.Disciple:"var(--chart-color-1)"),a&&i(s.loupPowers,"Camp Loups","var(--chart-color-2)",m=>{d({selectedPlayer:n,campFilter:{selectedCamp:"Loup",campFilterMode:g==="winRate"?"wins-only":"all-assignments"},selectedPower:m,fromComponent:`Historique des RÃ´les - Pouvoir: ${m}`})},()=>h.Loup||"var(--chart-color-2)"),r&&i(s.secondaryRoles,"RÃ´les Secondaires","var(--chart-color-3)",m=>{d({selectedPlayer:n,selectedSecondaryRole:m,fromComponent:`Historique des RÃ´les - RÃ´le Secondaire: ${m}`})}),e.jsx("div",{style:{fontSize:"0.9rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"16px",padding:"8px",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:"â„¹ï¸ Les victoires et le taux de victoire excluent les parties oÃ¹ le rÃ´le principal a changÃ© en cours de partie (ex: Garde en Chasseur, rÃ©ssucitÃ© en Zombie par un Vaudou, etc...)."})]})]})}function fe(n){return n==="SURVIVALIST_NOT_SAVED"?"BY_WOLF":n}function nt({selectedPlayerName:n}){const{navigateToGameDetails:d}=Q(),{gameData:R,isLoading:b,error:h}=ye(),g=se(),[N,f]=T.useState("deaths"),[c,p]=T.useState(""),[l,s]=T.useState(0),o=T.useMemo(()=>{if(!R)return[];const y=new Set;return R.forEach(S=>{const t=S.PlayerStats.find(C=>C.Username.toLowerCase()===n.toLowerCase());t&&(t.DeathPosition!==null&&S.MapName&&y.add(S.MapName),S.PlayerStats.forEach(C=>{C.KillerName?.toLowerCase()===n.toLowerCase()&&C.DeathPosition!==null&&S.MapName&&y.add(S.MapName)}))}),Array.from(y).filter(S=>S==="Village"||S==="ChÃ¢teau").sort((S,t)=>S==="Village"?-1:t==="Village"?1:S.localeCompare(t))},[R,n]),a=o.length>0?o[0]:"";c===""&&a!==""&&p(a);const r=T.useMemo(()=>{if(!R||!n)return[];const y=[];return R.forEach(S=>{if(c&&S.MapName!==c)return;const t=S.PlayerStats.find(C=>C.Username.toLowerCase()===n.toLowerCase());if(t)if(N==="deaths"){if(t.DeathPosition){const C=ie(t.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),A=ge(t.DeathPosition.x,t.DeathPosition.z,S.MapName);y.push({x:A.x,z:A.z,victimName:t.Username,killerName:t.KillerName||null,deathType:fe(t.DeathType),mapName:S.MapName,camp:C,gameId:S.DisplayedId,displayedGameId:S.DisplayedId})}}else S.PlayerStats.forEach(C=>{if(C.KillerName?.toLowerCase()===n.toLowerCase()&&C.DeathPosition){const A=ie(C.MainRoleInitial,{regroupLovers:!0,regroupVillagers:!0,regroupWolfSubRoles:!0}),u=ge(C.DeathPosition.x,C.DeathPosition.z,S.MapName);y.push({x:u.x,z:u.z,victimName:C.Username,killerName:n,deathType:fe(C.DeathType),mapName:S.MapName,camp:A,gameId:S.DisplayedId,displayedGameId:S.DisplayedId})}})}),y},[R,n,N,c]),x=T.useMemo(()=>qe(r,l).map((S,t)=>{const C=S.items[0],A=Ee(S.items);return{x:S.centroidX,z:S.centroidZ,count:S.items.length,allLocations:S.items,victimName:S.items.length===1?C.victimName:null,killerName:S.items.length===1?C.killerName:null,deathType:A,mapName:C.mapName,camp:C.camp,gameId:S.items.length===1?C.gameId:null,displayedGameId:S.items.length===1?C.displayedGameId:null,clusterIndex:t}}),[r,l]),i=T.useMemo(()=>Ge(c),[c]),{xDomain:m,zDomain:D}=T.useMemo(()=>{if(i)return{xDomain:[i.xMin,i.xMax],zDomain:[i.zMin,i.zMax]};if(x.length===0)return{xDomain:[0,100],zDomain:[0,100]};const y=x.map(k=>k.x),S=x.map(k=>k.z),t=Math.min(...y),C=Math.max(...y),A=Math.min(...S),u=Math.max(...S),v=(C-t)*.1||10,P=(u-A)*.1||10;return{xDomain:[t-v,C+v],zDomain:[A-P,u+P]}},[x,i]),M=y=>y?y==="BY_WOLF"||y==="SURVIVALIST_NOT_SAVED"?g.Loup:y==="VOTED"?"var(--chart-color-1)":y==="BULLET"||y==="BULLET_HUMAN"||y==="BULLET_WOLF"?g.Chasseur:y==="BY_ZOMBIE"?g.Vaudou:y==="ASSASSIN"?g.Alchimiste:y==="AVENGER"?"var(--chart-color-2)":y==="LOVER_DEATH"?g.Amoureux:y==="BY_BEAST"?"var(--chart-color-3)":y==="SHERIF_SUCCESS"?"var(--chart-color-4)":y==="SMUGGLER_HUNT_KILL"?g.Contrebandier:"var(--accent-primary-text)":"var(--text-secondary)",$=({active:y,payload:S})=>{if(!y||!S||S.length===0)return null;const t=S[0].payload,C=t.allLocations||[t];if(C.length>1){const v=new Map,P=new Map,k=new Set;C.forEach(z=>{v.set(z.victimName,(v.get(z.victimName)||0)+1);const W=z.deathType?re(z.deathType):"Inconnu";P.set(W,(P.get(W)||0)+1),k.add(z.gameId)});const w=Array.from(v.entries()).sort((z,W)=>W[1]-z[1]).slice(0,3),F=Array.from(P.entries()).sort((z,W)=>W[1]-z[1]).slice(0,3);return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[N==="deaths"?"ðŸ’€":"âš”ï¸"," ",C.length," ",N==="deaths"?"morts":"kills"," Ã  cet endroit"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:N==="deaths"?"Par:":"Victimes:"}),w.map(([z,W])=>e.jsxs("div",{style:{paddingLeft:"0.5rem"},children:["â€¢ ",z," (",W,"x)"]},z)),v.size>3&&e.jsxs("div",{style:{paddingLeft:"0.5rem",color:"var(--text-secondary)"},children:["+",v.size-3," autres..."]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Types de mort:"}),F.map(([z,W])=>e.jsxs("div",{style:{paddingLeft:"0.5rem"},children:["â€¢ ",z," (",W,"x)"]},z))]}),e.jsxs("div",{style:{marginTop:"8px",color:"var(--text-secondary)"},children:["ðŸ“ ",k.size," partie",k.size>1?"s":""," diffÃ©rente",k.size>1?"s":""]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const u=C[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[N==="deaths"?"ðŸ’€":"âš”ï¸"," ",N==="deaths"?"Mort de":"Kill de"," ",n]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[N==="deaths"?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"TuÃ© par:"})," ",u.killerName||"Inconnu"]}),e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Cause:"})," ",u.deathType?re(u.deathType):"Inconnue"]})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["ðŸŽ¯ ",e.jsx("strong",{children:"Victime:"})," ",u.victimName]}),e.jsxs("div",{children:["âš°ï¸ ",e.jsx("strong",{children:"Cause:"})," ",u.deathType?re(u.deathType):"Inconnue"]}),e.jsxs("div",{children:["ðŸ‘¥ ",e.jsx("strong",{children:"Camp victime:"})," ",u.camp]})]}),e.jsxs("div",{children:["ðŸ—ºï¸ ",e.jsx("strong",{children:"Carte:"})," ",u.mapName]}),e.jsxs("div",{children:["ðŸŽ® ",e.jsx("strong",{children:"Partie:"})," #",u.gameId]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})},L=y=>{if(!y)return;const S=y.allLocations||[y];if(S.length===1)d({selectedGame:S[0].gameId,fromComponent:"Player Death Map"});else{const t=S.map(C=>C.gameId).filter(C=>C);d({selectedGameIds:t,fromComponent:"Player Death Map"})}};return b?e.jsx("div",{className:"donnees-attente",children:"Chargement des donnÃ©es..."}):h?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",h]}):R?e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{style:{flex:"1 1 100%",marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Afficher :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>f("deaths"),style:{background:N==="deaths"?"var(--accent-primary)":"transparent",color:N==="deaths"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:N==="deaths"?"bold":"normal",transition:"all 0.2s"},children:"ðŸ’€ Morts"}),e.jsx("button",{type:"button",onClick:()=>f("kills"),style:{background:N==="kills"?"var(--accent-primary)":"transparent",color:N==="kills"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:N==="kills"?"bold":"normal",transition:"all 0.2s"},children:"âš”ï¸ Kills"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"player-map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"player-map-select",value:c,onChange:y=>p(y.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"120px"},children:o.map(y=>e.jsx("option",{value:y,children:y},y))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-slider",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-slider",type:"range",min:"0",max:"50",step:"5",value:l,onChange:y=>s(parseInt(y.target.value)),style:{width:"80px"}}),e.jsx("span",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",minWidth:"60px"},children:l===0?"Aucun":`${l} unitÃ©${l>1?"s":""}`})]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{flex:"1 1 100%",marginBottom:"1.5rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:N==="deaths"?"Morts localisÃ©es":"Kills localisÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:N==="deaths"?"var(--accent-secondary)":"var(--accent-primary-text)"},children:r.length}),l>0&&x.length<r.length&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"4px"},children:["â†’ ",x.length," points groupÃ©s"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Carte"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-2)",fontSize:"1.2rem"},children:c||"Aucune"})]})]}),e.jsx("div",{className:"lycans-graphique-section",style:{flex:"1 1 100%",minWidth:"100%"},children:r.length>0?e.jsx(B,{title:N==="deaths"?`Carte des Morts de ${n}`:`Carte des Kills de ${n}`,children:e.jsx("div",{style:{width:"100%",margin:"0 auto",aspectRatio:"1640 / 922"},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(Be,{margin:{top:20,right:30,left:60,bottom:60},children:[i&&e.jsx(Ve,{x1:i.zMin,x2:i.zMax,y1:i.xMin,y2:i.xMax,fill:"transparent",stroke:"none",shape:y=>{const{x:S,y:t,width:C,height:A}=y;return e.jsx("image",{x:S,y:t,width:C,height:A,href:i.src,preserveAspectRatio:"xMidYMid slice",style:{opacity:.85}})}}),e.jsx(K,{strokeDasharray:"3 3",stroke:i?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(O,{dataKey:"z",type:"number",name:"Position Z",domain:D,hide:!0}),e.jsx(H,{dataKey:"x",type:"number",name:"Position X",domain:m,hide:!0}),e.jsx(V,{content:e.jsx($,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Ke,{data:x,onClick:y=>L(y),style:{cursor:"pointer"},isAnimationActive:!1,children:x.map((y,S)=>{const t=Math.min(Math.log2(y.count+1)*3+5,18),C=Math.round(t);return e.jsx(U,{fill:M(y.deathType),stroke:y.count>1?"white":"rgba(255,255,255,0.5)",strokeWidth:y.count>1?2:1,opacity:.85,r:C},`cell-${S}`)})})]})})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"0.5rem"},children:N==="deaths"?`Aucune mort localisÃ©e pour ${n} sur cette carte.`:`Aucun kill localisÃ© pour ${n} sur cette carte.`}),e.jsx("p",{style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes."})]})}),e.jsxs("div",{className:"lycans-section-description",style:{flex:"1 1 100%",marginTop:"1.5rem"},children:[e.jsx("h4",{children:"Ã€ propos de cette carte"}),e.jsxs("p",{children:["Cette carte affiche ",N==="deaths"?`les emplacements oÃ¹ ${n} est mort`:`les emplacements oÃ¹ ${n} a Ã©liminÃ© d'autres joueurs`," au cours des parties. Les couleurs indiquent le type de mort. Cliquez sur un point pour voir les dÃ©tails de la partie."]}),e.jsxs("p",{style:{marginTop:"0.5rem"},children:["Les points regroupÃ©s ont une petite bordure blanche.",e.jsx("br",{}),e.jsx("strong",{children:"ðŸ’€ Morts:"})," OÃ¹ le joueur a Ã©tÃ© Ã©liminÃ©",e.jsx("br",{}),e.jsx("strong",{children:"âš”ï¸ Kills:"})," OÃ¹ le joueur a Ã©liminÃ© d'autres joueurs"]})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function Se(n){return n.PlayerStats.some(d=>d.SecondsTalkedOutsideMeeting>0||d.SecondsTalkedDuringMeeting>0)}function le(n,d){const R=d.DeathDateIrl||n.EndDate,b=je(n.StartDate,R);return b&&b>0?b:0}function ot(n){const d=n.filter(Se),R=new Map;return d.forEach(b=>{b.PlayerStats.forEach(h=>{const g=Z(h),N=Ne(h),f=le(b,h);if(f<=0)return;R.has(g)||R.set(g,{displayName:N,gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const c=R.get(g);c.gamesPlayed++,c.totalSecondsAll+=(h.SecondsTalkedOutsideMeeting||0)+(h.SecondsTalkedDuringMeeting||0),c.totalGameDuration+=f})}),{playerStats:R,gamesWithTalkingData:d.length}}function lt(n,d){if(!d||d.length===0||!n)return null;const R=ot(d),b=d.filter(Se);if(b.length===0||R.playerStats.size===0)return null;let h=null;for(const[k,w]of R.playerStats)if(w.displayName===n){h=k;break}if(!h)return null;let g=0,N=0,f=0,c=0;const p={Villageois:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Loup:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0},Autres:{gamesPlayed:0,secondsOutside:0,secondsDuring:0,gameDuration:0}},l=new Map;let s=0,o=0,a=0,r=0;if(b.forEach(k=>{const w=k.PlayerStats.find(q=>Z(q)===h);if(!w)return;const F=le(k,w);if(F<=0)return;g++;const z=w.SecondsTalkedOutsideMeeting||0,W=w.SecondsTalkedDuringMeeting||0,te=z+W;N+=z,f+=W,c+=F;const j=Te(w.MainRoleInitial,w.Power);p[j].gamesPlayed++,p[j].secondsOutside+=z,p[j].secondsDuring+=W,p[j].gameDuration+=F;const I=We(w);l.has(I)||l.set(I,{gamesPlayed:0,totalSecondsAll:0,totalGameDuration:0});const E=l.get(I);E.gamesPlayed++,E.totalSecondsAll+=te,E.totalGameDuration+=F}),g===0||c<=0)return null;const x=3600/c,i=N*x,m=f*x,D=(N+f)*x,M=N+f>0?f/(N+f)*100:0,$=[];for(const[k,w]of Object.entries(p)){if(w.gamesPlayed===0)continue;const F=w.gameDuration>0?3600/w.gameDuration:0,z=w.secondsOutside+w.secondsDuring;$.push({camp:k,gamesPlayed:w.gamesPlayed,totalSecondsOutside:w.secondsOutside,totalSecondsDuring:w.secondsDuring,totalSecondsAll:z,totalGameDurationSeconds:w.gameDuration,secondsOutsidePer60Min:w.secondsOutside*F,secondsDuringPer60Min:w.secondsDuring*F,secondsAllPer60Min:z*F,meetingRatio:z>0?w.secondsDuring/z*100:0})}$.sort((k,w)=>w.gamesPlayed-k.gamesPlayed);const L=Array.from(l.entries()).filter(([k,w])=>w.gamesPlayed>=1).map(([k,w])=>({role:k,gamesPlayed:w.gamesPlayed,secondsAllPer60Min:w.totalGameDuration>0?w.totalSecondsAll/w.totalGameDuration*3600:0,totalSecondsAll:w.totalSecondsAll})).sort((k,w)=>w.secondsAllPer60Min-k.secondsAllPer60Min),y=[];for(const[k,w]of R.playerStats)w.totalGameDuration>0&&y.push({id:k,name:w.displayName,per60:w.totalSecondsAll/w.totalGameDuration*3600});y.sort((k,w)=>w.per60-k.per60);const S=y.reduce((k,w)=>k+w.per60,0),t=y.length>0?S/y.length:0,C=y.findIndex(k=>k.id===h)+1,A=y.length,u=A>0?Math.round((1-(C-1)/A)*100):0,v=D;b.forEach(k=>{const w=k.PlayerStats.find(te=>Z(te)===h);if(!w)return;const F=le(k,w);if(F<=0)return;((w.SecondsTalkedOutsideMeeting||0)+(w.SecondsTalkedDuringMeeting||0))/F*3600>=v?(s++,w.Victorious&&o++):(a++,w.Victorious&&r++)});const P={gamesAboveAverage:s,winsAboveAverage:o,winRateAboveAverage:s>0?o/s*100:0,gamesBelowAverage:a,winsBelowAverage:r,winRateBelowAverage:a>0?r/a*100:0};return{playerName:n,gamesPlayed:g,gamesWithTalkingData:R.gamesWithTalkingData,totalSecondsOutside:N,totalSecondsDuring:f,totalSecondsAll:N+f,totalGameDurationSeconds:c,secondsOutsidePer60Min:i,secondsDuringPer60Min:m,secondsAllPer60Min:D,meetingRatio:M,campBreakdown:$,globalAverageSecondsAllPer60Min:t,playerRank:C,totalPlayersWithData:A,percentile:u,roleBreakdown:L,winCorrelation:P}}function ct(n,d){return n?n.roleBreakdown.slice(0,d):[]}function dt(n){const{data:d,isLoading:R,error:b}=de(h=>n?lt(n,h):null);return{data:d,isLoading:R,error:b}}const ut={Villageois:"var(--camp-villageois)",Loup:"var(--camp-loup)",Autres:"var(--camp-autres)"},pt={Villageois:"#4CAF50",Loup:"#F44336",Autres:"#9C27B0"};function mt({selectedPlayerName:n}){const{data:d,isLoading:R,error:b}=dt(n),h=se(),g=T.useMemo(()=>d?.campBreakdown?d.campBreakdown.map(a=>({camp:a.camp,"Hors rÃ©union":Math.round(a.secondsOutsidePer60Min),"En rÃ©union":Math.round(a.secondsDuringPer60Min),total:Math.round(a.secondsAllPer60Min),gamesPlayed:a.gamesPlayed,meetingRatio:a.meetingRatio.toFixed(1)})):[],[d]),N=T.useMemo(()=>d?[{name:"En rÃ©union",value:d.totalSecondsDuring,color:"#2196F3"},{name:"Hors rÃ©union",value:d.totalSecondsOutside,color:"#FF9800"}]:[],[d]),f=a=>{const r=a;return h[a]||ut[r]||pt[r]||"#888888"},c=a=>{const r={Chasseur:h.Chasseur||"#FF5722",Alchimiste:h.Alchimiste||"#9C27B0",Protecteur:h.Protecteur||"#4CAF50",Disciple:h.Disciple||"#2196F3","Aucun pouvoir":h.Villageois||"#8BC34A",Villageois:h.Villageois||"#4CAF50",Loup:h.Loup||"#F44336","Idiot du Village":h["Idiot du Village"]||"#FFC107",TraÃ®tre:h.TraÃ®tre||"#E91E63",Louveteau:h.Louveteau||"#FF5722"};return a in h?h[a]||r[a]||h.Villageois||"#4CAF50":r[a]||h.Villageois||"#4CAF50"};if(R)return e.jsx("div",{className:"donnees-attente",children:"Chargement des statistiques de temps de parole..."});if(b)return e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",b]});if(!d)return e.jsxs("div",{className:"donnees-manquantes",children:[e.jsx("p",{children:"Aucune donnÃ©e de temps de parole disponible pour ce joueur."}),e.jsx("p",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de temps de parole ne sont disponibles que pour les parties rÃ©centes."})]});const p=d.secondsAllPer60Min-d.globalAverageSecondsAllPer60Min,l=d.globalAverageSecondsAllPer60Min>0?(p/d.globalAverageSecondsAllPer60Min*100).toFixed(0):"0",s=p>0,o=d.winCorrelation.winRateAboveAverage-d.winCorrelation.winRateBelowAverage;return e.jsxs("div",{className:"lycans-graphiques-groupe",children:[e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸŽ¤ Temps de parole / 60min"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:ae(d.secondsAllPer60Min)}),e.jsxs("p",{style:{fontSize:"0.8rem",color:s?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[s?"+":"",l,"% vs moyenne"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“Š Classement"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:["#",d.playerRank," / ",d.totalPlayersWithData]}),e.jsxs("p",{children:["Top ",100-d.percentile+1,"% ",d.percentile>=50?"bavard":"discret"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ“ˆ Parties analysÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:d.gamesPlayed}),e.jsxs("p",{children:["sur ",d.gamesWithTalkingData," avec donnÃ©es"]})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"ðŸ—£ï¸ Ratio en rÃ©union"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[d.meetingRatio.toFixed(1),"%"]}),e.jsx("p",{children:"du temps de parole"})]})]}),g.length>0&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx(B,{title:"Temps de parole par camp (par 60min de jeu)",children:e.jsx("div",{style:{height:350},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:g,layout:"vertical",children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(O,{type:"number",tick:{fill:"var(--text-secondary)"},tickFormatter:a=>`${Math.floor(a/60)}m`}),e.jsx(H,{type:"category",dataKey:"camp",tick:{fill:"var(--text-primary)"},width:100}),e.jsx(V,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:(a,r)=>[ae(a),r],labelFormatter:a=>{const r=g.find(x=>x.camp===a);return`${a} (${r?.gamesPlayed||0} parties)`}}),e.jsx(Oe,{}),e.jsx(_,{dataKey:"Hors rÃ©union",stackId:"talk",fill:"#FF9800"}),e.jsx(_,{dataKey:"En rÃ©union",stackId:"talk",fill:"#2196F3"})]})})})}),e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:g.length>=2&&(()=>{const a=[...g].sort((m,D)=>D.total-m.total),r=a[0],x=a[a.length-1],i=r.total-x.total;return e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:n})," parle"," ",e.jsxs("strong",{style:{color:f(r.camp)},children:[ae(i)," de plus"]})," ","en tant que ",e.jsx("strong",{children:r.camp})," qu'en tant que"," ",e.jsx("strong",{children:x.camp})," (par heure de jeu)."]})})()})]}),e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(B,{title:"RÃ©partition du temps de parole",children:e.jsx("div",{style:{height:300},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(Ce,{children:[e.jsx(we,{data:N,cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,dataKey:"value",label:a=>`${a.name}: ${((a.percent||0)*100).toFixed(1)}%`,children:N.map((a,r)=>e.jsx(U,{fill:a.color},`cell-${r}`))}),e.jsx(V,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:a=>ae(a)})]})})})})}),d&&d.roleBreakdown.length>0&&e.jsx("div",{className:"lycans-graphique-section",children:e.jsx(B,{title:a=>a?"Top 15 rÃ´les les plus bavards (par 60min)":"Top 5 rÃ´les les plus bavards (par 60min)",children:a=>{const x=ct(d,a?15:5).map(i=>({role:i.role,secondsPer60Min:Math.round(i.secondsAllPer60Min),gamesPlayed:i.gamesPlayed}));return e.jsx("div",{style:{height:a?400:300},children:e.jsx(G,{width:"100%",height:"100%",children:e.jsxs(J,{data:x,children:[e.jsx(K,{strokeDasharray:"3 3",stroke:"var(--border-color)"}),e.jsx(O,{dataKey:"role",tick:{fill:"var(--text-primary)",fontSize:12},interval:0,angle:-20,textAnchor:"end",height:60}),e.jsx(H,{tick:{fill:"var(--text-secondary)"},tickFormatter:i=>`${Math.floor(i/60)}m`}),e.jsx(V,{contentStyle:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"8px"},formatter:i=>[ae(i),"Temps de parole"],labelFormatter:i=>{const m=x.find(D=>D.role===i);return`${i} (${m?.gamesPlayed||0} parties)`}}),e.jsx(_,{dataKey:"secondsPer60Min",fill:"var(--accent-primary, #8884d8)",children:x.map((i,m)=>e.jsx(U,{fill:c(i.role)},`cell-${m}`))})]})})})}})}),(d.winCorrelation.gamesAboveAverage>0||d.winCorrelation.gamesBelowAverage>0)&&e.jsxs("div",{className:"lycans-graphique-section",children:[e.jsx("h3",{children:"ðŸŽ¯ CorrÃ©lation avec les victoires"}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:"1rem",marginTop:"1rem"},children:[e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle + que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[d.winCorrelation.winRateAboveAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",d.winCorrelation.winsAboveAverage,"/",d.winCorrelation.gamesAboveAverage," parties)"]})]}),e.jsxs("div",{style:{padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)"},children:"Quand parle - que sa moyenne"}),e.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:"bold",color:"var(--text-primary)"},children:[d.winCorrelation.winRateBelowAverage.toFixed(1),"%"]}),e.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["de victoires (",d.winCorrelation.winsBelowAverage,"/",d.winCorrelation.gamesBelowAverage," parties)"]})]})]}),Math.abs(o)>5&&e.jsx("div",{style:{marginTop:"1rem",padding:"1rem",backgroundColor:"var(--bg-tertiary)",borderRadius:"8px",fontSize:"0.9rem"},children:e.jsxs("p",{children:["ðŸ’¡ ",e.jsx("strong",{children:n})," a un taux de victoire"," ",e.jsxs("strong",{style:{color:o>0?"var(--success-color, #4CAF50)":"var(--warning-color, #FF9800)"},children:[o>0?"supÃ©rieur":"infÃ©rieur"," de ",Math.abs(o).toFixed(1),"%"]})," ","quand il/elle parle plus que sa moyenne."]})})]})]})}function Wt(){const{settings:n,updateSettings:d}=ce(),{navigateToGameDetails:R,navigationState:b,updateNavigationState:h}=Q(),{data:g,isLoading:N,error:f}=Ae(),{joueursData:c,isLoading:p}=ne(),{data:l,isLoading:s,error:o}=Je(n.highlightedPlayer),a=ue(c),[r,x]=T.useState(""),[i,m]=T.useState(null),{clips:D}=He(n.highlightedPlayer),{clips:M}=_e(),[$,L]=T.useState(()=>n.useIndependentFilters&&n.independentFilters?.gameTypeEnabled?n.independentFilters.gameFilter==="modded"?"modded":"all":n.gameFilter==="modded"?"modded":"all"),y=T.useMemo(()=>n.useIndependentFilters&&n.independentFilters?.gameTypeEnabled?n.independentFilters.gameFilter==="modded":n.gameFilter==="modded",[n.useIndependentFilters,n.independentFilters?.gameTypeEnabled,n.independentFilters?.gameFilter,n.gameFilter]),[S,t]=T.useState(b.selectedPlayerSelectionView||"achievements"),[C,A]=T.useState("session"),[u,v]=T.useState("all");T.useEffect(()=>{if(n.useIndependentFilters&&n.independentFilters?.gameTypeEnabled){const j=n.independentFilters.gameFilter==="modded"?"modded":"all";L(j)}else if(!n.useIndependentFilters){const j=n.gameFilter==="modded"?"modded":"all";L(j)}},[n.gameFilter,n.useIndependentFilters,n.independentFilters?.gameTypeEnabled,n.independentFilters?.gameFilter]),T.useEffect(()=>{y&&$!=="modded"&&L("modded")},[y,$]),T.useEffect(()=>{b.selectedPlayerSelectionView&&t(b.selectedPlayerSelectionView)},[b.selectedPlayerSelectionView]);const{data:P}=oe(n.highlightedPlayer||""),k=T.useMemo(()=>{if(!g||!g.GameStats)return[];const j=y?g.GameStats.filter(E=>E.Modded===!0):g.GameStats,I=new Map;return j.forEach(E=>{const q=new Date(E.StartDate);E.PlayerStats.forEach(Y=>{const X=Z(Y),Re=c?.Players?.find(ke=>ke.SteamID===X)?.Joueur||Y.Username;I.has(X)||I.set(X,{games:0,wins:0,firstDate:q,lastDate:q,displayName:Re});const ee=I.get(X);ee.games++,Y.Victorious&&ee.wins++,q<ee.firstDate&&(ee.firstDate=q),q>ee.lastDate&&(ee.lastDate=q)})}),Array.from(I.entries()).map(([E,q])=>{let Y=c?.Players?.find(X=>X.SteamID===E);return Y||(Y=c?.Players?.find(X=>X.Joueur===q.displayName)),{id:E,name:q.displayName,totalGames:q.games,totalWins:q.wins,winRate:q.games>0?q.wins/q.games*100:0,firstGameDate:q.firstDate.toLocaleDateString("fr-FR"),lastGameDate:q.lastDate.toLocaleDateString("fr-FR"),isHighlighted:q.displayName===n.highlightedPlayer,image:Y?.Image||null,twitch:Y?.Twitch||null,youtube:Y?.Youtube||null}})},[g,n.highlightedPlayer,c,y]),w=T.useMemo(()=>{if(!r.trim())return k;const j=r.toLowerCase();return k.filter(I=>I.name.toLowerCase().includes(j))},[k,r]),F=T.useMemo(()=>[...w].sort((j,I)=>I.totalGames-j.totalGames),[w]),z=j=>{d({highlightedPlayer:j}),x("")},W=j=>{t(j),h({selectedPlayerSelectionView:j})},te=()=>{if(D.length===0)return;const j=Math.floor(Math.random()*D.length);m(D[j])};return N||p?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):f?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",f]})]}):!g||k.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[!n.highlightedPlayer&&e.jsxs("div",{className:"search-controls-header",children:[e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."})]}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:r,onChange:j=>x(j.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[w.length," joueur",w.length!==1?"s":"",r&&` (filtrÃ©${w.length!==1?"s":""} de ${k.length})`]})]})]}),e.jsx("div",{className:"player-display",children:r?w.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>x(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:F.map(j=>e.jsxs("button",{type:"button",className:`suggestion-btn ${j.isHighlighted?"highlighted":""}`,onClick:()=>z(j.name),children:[j.image?e.jsx("img",{src:j.image,alt:`Photo de profil de ${j.name}`,className:"player-avatar"}):e.jsx("div",{className:"player-avatar-default",style:{"--player-color":a[j.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"suggestion-btn-content",children:[e.jsxs("div",{className:"suggestion-btn-name",children:[j.name,j.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]}),e.jsxs("div",{className:"suggestion-btn-stats",children:[j.totalGames," parties â€¢ ",j.winRate.toFixed(1),"% victoires"]})]})]},j.id))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',r,'"']}),e.jsx("button",{type:"button",className:"clear-search-btn",onClick:()=>x(""),children:"Effacer la recherche"})]}):n.highlightedPlayer?(()=>{const j=k.find(I=>I.name===n.highlightedPlayer);return j?e.jsxs("div",{className:"single-player-card highlighted",children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:j.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-info-row",children:[j.image?e.jsx("img",{src:j.image,alt:`Photo de profil de ${j.name}`,className:"player-avatar large"}):e.jsx("div",{className:"player-avatar-default large",style:{"--player-color":a[j.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"player-avatar-overlay"})}),e.jsxs("div",{className:"player-info-text",children:[e.jsxs("div",{className:"player-stats-summary",children:[j.totalGames," parties â€¢ ",j.totalWins," victoires â€¢ ",j.winRate.toFixed(1),"% taux de victoire"]}),(j.twitch||j.youtube||D.length>0)&&e.jsxs("div",{className:"social-links",children:[j.twitch&&e.jsx("a",{href:j.twitch,target:"_blank",rel:"noopener noreferrer",className:"social-link twitch",children:"ðŸ“º Twitch"}),j.youtube&&e.jsx("a",{href:j.youtube,target:"_blank",rel:"noopener noreferrer",className:"social-link youtube",children:"ðŸŽ¬ YouTube"}),D.length>0&&e.jsxs("button",{type:"button",className:"social-link clips-btn",onClick:I=>{I.stopPropagation(),te()},title:`${D.length} clip${D.length>1?"s":""} disponible${D.length>1?"s":""}`,children:["ðŸŽ¬ Clip alÃ©atoire (",D.length,")"]})]})]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsxs("div",{className:"lycans-categories-selection",style:{marginBottom:"1rem"},children:[e.jsx("button",{type:"button",className:`lycans-categorie-btn ${S==="achievements"?"active":""}`,onClick:()=>W("achievements"),children:"Classement"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${S==="evolution"?"active":""}`,onClick:()=>W("evolution"),children:"Ã‰volution"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${S==="camps"?"active":""}`,onClick:()=>W("camps"),children:"Camps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${S==="roles"?"active":""}`,onClick:()=>W("roles"),children:"RÃ´les"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${S==="maps"?"active":""}`,onClick:()=>W("maps"),children:"Maps"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${S==="kills"?"active":""}`,onClick:()=>W("kills"),children:"Kills"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${S==="deathmap"?"active":""}`,onClick:()=>W("deathmap"),children:"Carte"}),e.jsx("button",{type:"button",className:`lycans-categorie-btn ${S==="talkingtime"?"active":""}`,onClick:()=>W("talkingtime"),children:"Parole"})]}),S==="achievements"&&e.jsxs("div",{className:"achievements-section",children:[s?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des classements..."})]}):o?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des classements: ",o]})}):l?e.jsx(Qe,{achievements:$==="all"?l.allGamesAchievements:l.moddedOnlyAchievements,title:$==="all"?"Classements - Toutes les parties":"Classements - Parties moddÃ©es",emptyMessage:"Aucun classement dans cette catÃ©gorie",achievementType:$}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun classement disponible pour ce joueur"})}),e.jsxs("div",{className:"achievements-filter",children:[!y&&e.jsx("button",{type:"button",className:`filter-btn ${$==="all"?"active":""}`,onClick:I=>{I.stopPropagation(),L("all")},children:"Toutes les parties"}),e.jsx("button",{type:"button",className:`filter-btn ${$==="modded"?"active":""}`,onClick:I=>{I.stopPropagation(),L("modded")},disabled:y,children:"Parties moddÃ©es"})]})]}),S==="evolution"&&e.jsxs("div",{className:"player-history-section",children:[P&&e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Total Parties"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{R({selectedPlayer:j.name,fromComponent:"Historique Joueur - Total Parties"})},title:`Cliquer pour voir toutes les parties de ${j.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:P.totalGames}),e.jsx("p",{children:"parties jouÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Temps de jeu cumulÃ©s"}),e.jsx("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:Fe(P.totalPlayTime)}),e.jsx("p",{children:"temps total de jeu"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Victoires"}),e.jsx("div",{className:"lycans-valeur-principale lycans-clickable",onClick:()=>{R({selectedPlayer:j.name,selectedPlayerWinMode:"wins-only",fromComponent:"Historique Joueur - Victoires"})},title:`Cliquer pour voir toutes les victoires de ${j.name}`,style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:P.totalWins}),e.jsx("p",{children:"parties gagnÃ©es"})]}),e.jsxs("div",{className:"lycans-stat-carte",style:{fontSize:"0.9rem"},children:[e.jsx("h3",{children:"Taux de Victoire"}),e.jsxs("div",{className:"lycans-valeur-principale",style:{fontSize:"1.3rem",color:"var(--accent-primary-text)"},children:[P.winRate,"%"]}),e.jsx("p",{children:"pourcentage global"})]})]}),e.jsxs("div",{className:"lycans-controls-section",style:{display:"flex",gap:"2rem",marginBottom:"2rem",justifyContent:"center",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"grouping-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Groupement:"}),e.jsxs("select",{id:"grouping-select",value:C,onChange:I=>A(I.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"session",children:"Par session"}),e.jsx("option",{value:"month",children:"Par mois"}),e.jsx("option",{value:"quarter",children:"Par trimestre"}),e.jsx("option",{value:"year",children:"Par annÃ©e"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-filter-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem"},children:"Camp:"}),e.jsxs("select",{id:"camp-filter-select",value:u,onChange:I=>v(I.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"160px"},children:[e.jsx("option",{value:"all",children:"Tous les camps"}),e.jsx("option",{value:"Villageois",children:"Villageois"}),e.jsx("option",{value:"Loup",children:"Loups"}),e.jsx("option",{value:"solo",children:"RÃ´les solo"})]})]})]}),e.jsx(et,{selectedPlayerName:j.name,groupingMethod:C,campFilter:u})]}),S==="camps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(tt,{selectedPlayerName:j.name})}),S==="maps"&&e.jsx("div",{className:"player-history-section",children:e.jsx(at,{selectedPlayerName:j.name})}),S==="roles"&&e.jsx("div",{className:"player-history-section",children:e.jsx(it,{selectedPlayerName:j.name})}),S==="kills"&&e.jsx("div",{className:"player-history-section",children:e.jsx(st,{selectedPlayerName:j.name})}),S==="deathmap"&&e.jsx("div",{className:"player-history-section",children:e.jsx(nt,{selectedPlayerName:j.name})}),S==="talkingtime"&&e.jsx("div",{className:"player-history-section",children:e.jsx(mt,{selectedPlayerName:j.name})}),e.jsx("button",{type:"button",className:"highlight-btn active",onClick:I=>{I.stopPropagation(),d({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[j.firstGameDate," - ",j.lastGameDate]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',n.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{type:"button",className:"clear-selection-btn",onClick:()=>d({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsx("div",{className:"character-selection-grid",children:F.map(j=>e.jsxs("div",{className:`character-card ${j.isHighlighted?"highlighted":""}`,onClick:()=>z(j.name),title:`${j.name} - ${j.totalGames} parties, ${j.winRate.toFixed(1)}% victoires`,children:[e.jsx("div",{className:"character-avatar-container",children:j.image?e.jsx("img",{src:j.image,alt:`Photo de profil de ${j.name}`,className:"character-avatar"}):e.jsx("div",{className:"character-avatar-default",style:{"--player-color":a[j.name]||"var(--accent-primary)"},children:e.jsx("div",{className:"character-avatar-overlay"})})}),e.jsx("div",{className:"character-name",children:j.name}),(j.twitch||j.youtube)&&e.jsxs("div",{className:"character-social-indicators",children:[j.twitch&&e.jsx("div",{className:"social-indicator twitch",title:"Twitch",children:"T"}),j.youtube&&e.jsx("div",{className:"social-indicator youtube",title:"YouTube",children:"Y"})]})]},j.id))})})}),i&&e.jsx(Ue,{clip:i,onClose:()=>m(null),relatedClips:Ye(i,M),nextClip:xe(i,M),onNextClip:()=>{const j=xe(i,M);j&&m(j)},onRelatedClip:j=>{const I=M.find(E=>E.ClipId===j);I&&m(I)}})]})}export{Wt as PlayerSelectionPage};
