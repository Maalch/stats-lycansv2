import{u as I,j as t}from"./index-Deo8SKi4.js";import{a as C}from"./baseStatsHook-0khRVGVW.js";import{a as N,c as A}from"./gameUtils-DZ2QW-S5.js";import{a as B,l as R}from"./api-gHRvIgLw.js";import{F as h,B as v,C as p,X as x,Y as D,a as j,b as k}from"./FullscreenChart-C5cRF6Y1.js";import{R as y,T as f,Q as T}from"./CategoricalChart-BpirdUqE.js";import{L as W,a as F}from"./LineChart-DfmTlatE.js";import"./ActivePoints-DkjttsNP.js";function d(e){const a=Math.floor(e/3600),n=Math.floor(e%3600/60),i=e%60;return a>0?`${a}h${n.toString().padStart(2,"0")}m${i.toString().padStart(2,"0")}s`:n>0?`${n}m${i.toString().padStart(2,"0")}s`:`${i}s`}function L(e,a=10){const n=Math.round(e/60);return Math.round(n/a)*a}function P(){return{averageDuration:"0s",maxDuration:0,minDuration:1/0,maxDurationGameId:null,minDurationGameId:null,durationDistribution:{},durationsByWinnerCamp:{},durationsByPlayerCount:{},durationsByWolfRatio:{}}}function S(e,a,n){e>n.maxDuration&&(n.maxDuration=e,n.maxDurationGameId=a),e<n.minDuration&&(n.minDuration=e,n.minDurationGameId=a)}function $(e,a){const n=L(e,2);a[n]||(a[n]=0),a[n]++}function q(e,a,n){e&&e.trim()!==""&&(n[e]||(n[e]={totalDuration:0,count:0,average:"0s"}),n[e].totalDuration+=a,n[e].count++)}function E(e,a,n){if(e&&!isNaN(e)&&e>0){const i=e.toString();n[i]||(n[i]={totalDuration:0,count:0,average:"0s"}),n[i].totalDuration+=a,n[i].count++}}function w(e,a,n,i){if(e&&a&&!isNaN(e)&&!isNaN(a)&&e>0){const s=e-a;if(s>0){const c=Math.round(a/s*100),m=(Math.round(c/1)*1).toString();i[m]||(i[m]={totalDuration:0,count:0,average:"0s"}),i[m].totalDuration+=n,i[m].count++}}}function z(e,a,n){const i=e.PlayerStats.length,s=e.PlayerStats.filter(m=>m.MainRoleInitial==="Loup").length;let c=N(e);const l=A(e.StartDate,e.EndDate);l&&!isNaN(l)&&l>0&&(n.gamesWithDuration++,n.totalDuration+=l,S(l,e.DisplayedId,a),$(l,a.durationDistribution),q(c,l,a.durationsByWinnerCamp),E(i,l,a.durationsByPlayerCount),w(i,s,l,a.durationsByWolfRatio))}function K(e,a){if(a.gamesWithDuration>0){const n=a.totalDuration/a.gamesWithDuration;e.averageDuration=d(Math.round(n)),Object.keys(e.durationsByWinnerCamp).forEach(i=>{const s=e.durationsByWinnerCamp[i];if(s.count>0){const c=s.totalDuration/s.count;s.average=d(Math.round(c))}}),Object.keys(e.durationsByPlayerCount).forEach(i=>{const s=e.durationsByPlayerCount[i];if(s.count>0){const c=s.totalDuration/s.count;s.average=d(Math.round(c))}}),Object.keys(e.durationsByWolfRatio).forEach(i=>{const s=e.durationsByWolfRatio[i];if(s.count>0){const c=s.totalDuration/s.count;s.average=d(Math.round(c))}})}}function O(e){const a=Object.keys(e).map(n=>({duration:parseInt(n),count:e[parseInt(n)]}));return a.sort((n,i)=>n.duration-i.duration),a}function V(e){if(e.length===0)return null;const a=P(),n={totalDuration:0,gamesWithDuration:0};e.forEach(s=>{z(s,a,n)}),K(a,n);const i=O(a.durationDistribution);return{averageDuration:a.averageDuration,maxDuration:a.maxDuration,minDuration:a.minDuration===1/0?0:a.minDuration,maxDurationGameId:a.maxDurationGameId,minDurationGameId:a.minDurationGameId,durationDistribution:i,durationsByWinnerCamp:a.durationsByWinnerCamp,durationsByPlayerCount:a.durationsByPlayerCount,durationsByWolfRatio:a.durationsByWolfRatio}}function Y(){const{data:e,isLoading:a,error:n}=C(V);return{durationAnalysis:e,fetchingData:a,apiError:n}}function te(){const{durationAnalysis:e,fetchingData:a,apiError:n}=Y(),{navigateToGameDetails:i}=I(),s=B();if(a)return t.jsx("div",{className:"statistiques-attente",children:"Analyse des durées de partie en cours..."});if(n)return t.jsxs("div",{className:"statistiques-echec",children:["Problème rencontré: ",n]});if(!e)return t.jsx("div",{className:"statistiques-indisponibles",children:"Données d'analyse non disponibles"});const c=r=>{const o=r.match(/(\d+)h/),u=r.match(/(\d+)m/),g=r.match(/(\d+)s/),b=o?parseInt(o[1]):0,M=u?parseInt(u[1]):0,G=g?parseInt(g[1]):0;return b*60+M+G/60},l=e?Object.entries(e.durationsByWolfRatio).map(([r,o])=>({ratio:parseFloat(r),moyenne:c(o.average),parties:o.count,dureeFormatee:o.average})).sort((r,o)=>r.ratio-o.ratio):[],m=e?Object.entries(e.durationsByWinnerCamp).map(([r,o])=>({camp:r,moyenne:c(o.average),parties:o.count,dureeFormatee:o.average})).sort((r,o)=>o.moyenne-r.moyenne):[];return t.jsxs("div",{className:"lycans-duree-analyse",children:[t.jsx("h2",{children:"Analyse des Durées de Partie"}),t.jsxs("div",{className:"lycans-resume-conteneur",children:[t.jsxs("div",{className:"lycans-stat-carte",children:[t.jsx("h3",{children:"Durée Moyenne"}),t.jsx("p",{className:"lycans-valeur-principale",children:e.averageDuration||"N/A"})]}),t.jsxs("div",{className:"lycans-stat-carte",onClick:()=>{e.minDurationGameId&&i({selectedGame:e.minDurationGameId,fromComponent:"Analyse des Durées de Partie"})},style:{cursor:e.minDurationGameId?"pointer":"default",opacity:e.minDurationGameId?1:.7,transition:"transform 0.2s ease, box-shadow 0.2s ease"},onMouseEnter:r=>{e.minDurationGameId&&(r.currentTarget.style.transform="translateY(-2px)",r.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)")},onMouseLeave:r=>{e.minDurationGameId&&(r.currentTarget.style.transform="translateY(0)",r.currentTarget.style.boxShadow="")},title:e.minDurationGameId?"Cliquez pour voir cette partie":"Aucune partie trouvée",children:[t.jsx("h3",{children:"Durée Minimum"}),t.jsxs("p",{className:"lycans-valeur-principale",children:[Math.floor(e.minDuration/60),"min ",e.minDuration%60,"s"]}),e.minDurationGameId&&t.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:["🖱️ Partie #",e.minDurationGameId]})]}),t.jsxs("div",{className:"lycans-stat-carte",onClick:()=>{e.maxDurationGameId&&i({selectedGame:e.maxDurationGameId,fromComponent:"Analyse des Durées de Partie"})},style:{cursor:e.maxDurationGameId?"pointer":"default",opacity:e.maxDurationGameId?1:.7,transition:"transform 0.2s ease, box-shadow 0.2s ease"},onMouseEnter:r=>{e.maxDurationGameId&&(r.currentTarget.style.transform="translateY(-2px)",r.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)")},onMouseLeave:r=>{e.maxDurationGameId&&(r.currentTarget.style.transform="translateY(0)",r.currentTarget.style.boxShadow="")},title:e.maxDurationGameId?"Cliquez pour voir cette partie":"Aucune partie trouvée",children:[t.jsx("h3",{children:"Durée Maximum"}),t.jsxs("p",{className:"lycans-valeur-principale",children:[Math.floor(e.maxDuration/60),"min ",e.maxDuration%60,"s"]}),e.maxDurationGameId&&t.jsxs("p",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:["🖱️ Partie #",e.maxDurationGameId]})]})]}),t.jsxs("div",{className:"lycans-graphiques-section",children:[t.jsxs("div",{className:"lycans-graphique-element",children:[t.jsx("h3",{children:"Distribution des Durées de Partie"}),t.jsx(h,{title:"Distribution des Durées de Partie",children:t.jsx("div",{style:{height:300},children:t.jsx(y,{width:"100%",height:"100%",children:t.jsxs(v,{data:e?.durationDistribution||[],margin:{top:20,right:30,left:20,bottom:10},children:[t.jsx(p,{strokeDasharray:"3 3"}),t.jsx(x,{dataKey:"duration",label:{value:"Durée (minutes)",position:"insideBottom",offset:-5},tickFormatter:r=>`${r}min`}),t.jsx(D,{label:{value:"Nombre de Parties",angle:270,position:"insideLeft",style:{textAnchor:"middle"}}}),t.jsx(f,{content:({active:r,payload:o})=>{if(r&&o&&o.length>0){const u=o[0].payload;return t.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[t.jsx("div",{children:t.jsxs("strong",{children:["~",u.duration," minutes"]})}),t.jsxs("div",{children:[u.count," parties"]}),t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:"Durées regroupées par intervalles de 2 minutes"})]})}return null}}),t.jsx(j,{dataKey:"count",name:"Nombre de Parties",fill:"var(--chart-color-2)"})]})})})})]}),t.jsxs("div",{className:"lycans-graphique-element",children:[t.jsx("h3",{children:"Durée Moyenne par Ratio Loups/Villageois"}),t.jsx(h,{title:"Durée Moyenne par Ratio Loups/Villageois",children:t.jsx("div",{style:{height:300},children:t.jsx(y,{width:"100%",height:"100%",children:t.jsxs(W,{data:l,margin:{top:20,right:30,left:20,bottom:10},children:[t.jsx(p,{strokeDasharray:"3 3"}),t.jsx(x,{dataKey:"ratio",type:"number",domain:["auto","auto"],allowDecimals:!1,tickFormatter:r=>`${r}%`,label:{value:"Ratio Loups/Joueurs (%)",position:"insideBottom",offset:-5}}),t.jsx(D,{label:{value:"Durée Moyenne (minutes)",angle:270,position:"left",style:{textAnchor:"middle"}},tickFormatter:r=>`${Math.round(r)}min`}),t.jsx(f,{content:({active:r,payload:o})=>{if(r&&o&&o.length>0){const u=o[0].payload;return t.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[t.jsx("div",{children:t.jsxs("strong",{children:["Pourcentage de loups : ",u.ratio,"%"]})}),t.jsxs("div",{children:["Durée moyenne : ",u.dureeFormatee]}),t.jsxs("div",{children:["Nombre de parties : ",u.parties]})]})}return null}}),t.jsx(F,{type:"monotone",dataKey:"moyenne",name:"Durée Moyenne",stroke:"var(--chart-color-5)",strokeWidth:2,activeDot:{r:8}})]})})})})]}),t.jsxs("div",{className:"lycans-graphique-element",children:[t.jsx("h3",{children:"Durée Moyenne par Camp Victorieux"}),t.jsx(h,{title:"Durée Moyenne par Camp Victorieux",children:t.jsx("div",{style:{height:300},children:t.jsx(y,{width:"100%",height:"100%",children:t.jsxs(v,{data:m,margin:{top:20,right:30,left:20,bottom:40},children:[t.jsx(p,{strokeDasharray:"3 3"}),t.jsx(x,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0}),t.jsx(D,{label:{value:"Durée Moyenne (minutes)",angle:270,position:"left",style:{textAnchor:"middle"}},tickFormatter:r=>`${Math.round(r)}min`}),t.jsx(f,{content:({active:r,payload:o})=>{if(r&&o&&o.length>0){const u=o[0].payload;return t.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[t.jsx("div",{children:t.jsx("strong",{children:u.camp})}),t.jsxs("div",{children:["Durée moyenne : ",u.dureeFormatee]}),t.jsxs("div",{children:["Nombre de parties : ",u.parties]}),t.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"🖱️ Cliquez pour voir les parties"})]})}return null}}),t.jsxs(j,{dataKey:"moyenne",name:"moyenne",isAnimationActive:!1,onClick:r=>{r&&r.camp&&i({campFilter:{selectedCamp:r.camp,campFilterMode:"wins-only"},fromComponent:"Durée Moyenne par Camp Victorieux"})},style:{cursor:"pointer"},children:[m.map(r=>t.jsx(k,{fill:s[r.camp]||R},`cell-${r.camp}`)),t.jsx(T,{dataKey:"moyenne",position:"top",formatter:r=>{const o=typeof r=="number"?r:Number(r);return isNaN(o)?"":`${Math.round(o)}min`},fill:"var(--text-primary)",fontSize:12})]})]})})})})]})]})]})}export{te as GameDurationInsights};
