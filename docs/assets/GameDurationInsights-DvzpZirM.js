import{r as o,j as e}from"./index-yh1T7mqv.js";import{R as h,T as m}from"./CategoricalChart-8kLdSpOg.js";import{B as p,C as x,X as y,Y as j,a as g,L as f}from"./BarChart-DnXnp5-h.js";import{L as b,a as D}from"./LineChart-BWcdmkeV.js";import{L as v}from"./Legend-Bk5rhxFg.js";function N(){const[t,l]=o.useState(null),[n,i]=o.useState(!0),[c,r]=o.useState(null);return o.useEffect(()=>{(async()=>{try{i(!0),r(null);const d=await fetch("https://script.google.com/macros/s/AKfycbxrhG1mb7N6q7Mg88ogw0mirXgSihPpNPurZwiEOy9miG24Cc3AlGZCn2uoGnygNhck/exec?action=gameDurationAnalysis");if(!d.ok)throw new Error(`Échec de la requête: ${d.statusText}`);const u=await d.json();if(u.error)throw new Error(u.error);l(u)}catch(a){console.error("Impossible de charger les données de durée de partie:",a),r(a instanceof Error?a.message:"Erreur inconnue")}finally{i(!1)}})()},[]),{durationAnalysis:t,fetchingData:n,apiError:c}}function q(){const{durationAnalysis:t,fetchingData:l,apiError:n}=N();if(l)return e.jsx("div",{className:"statistiques-attente",children:"Analyse des durées de partie en cours..."});if(n)return e.jsxs("div",{className:"statistiques-echec",children:["Problème rencontré: ",n]});if(!t)return e.jsx("div",{className:"statistiques-indisponibles",children:"Données d'analyse non disponibles"});const i=Object.entries(t.daysByWolfRatio).map(([r,s])=>({ratio:`${parseFloat(r).toFixed(0)}%`,moyenne:parseFloat(s.average),parties:s.count})).sort((r,s)=>parseFloat(r.ratio)-parseFloat(s.ratio)),c=Object.entries(t.daysByWinnerCamp).map(([r,s])=>({camp:r,moyenne:parseFloat(s.average),parties:s.count})).sort((r,s)=>s.moyenne-r.moyenne);return e.jsxs("div",{className:"lycans-duree-analyse",children:[e.jsx("h2",{children:"Analyse des Durées de Partie"}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Moyenne"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[t.averageDays," jours"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Minimum"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[t.minDays," jours"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Maximum"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[t.maxDays," jours"]})]})]}),e.jsxs("div",{className:"lycans-graphiques-section",children:[e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Distribution des Durées de Partie"}),e.jsx("div",{style:{height:300},children:e.jsx(h,{width:"100%",height:"100%",children:e.jsxs(p,{data:t.dayDistribution,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(x,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"days",label:{value:"Nombre de Jours",position:"insideBottom",offset:-5}}),e.jsx(j,{label:{value:"Nombre de Parties",angle:-90,position:"insideLeft"}}),e.jsx(m,{content:({active:r,payload:s})=>{if(r&&s&&s.length>0){const a=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsxs("strong",{children:[a.days," jours"]})}),e.jsxs("div",{children:[a.count," parties"]})]})}return null}}),e.jsx(g,{dataKey:"count",name:"Nombre de Parties",fill:"var(--chart-color-2)"})]})})})]}),e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Durée Moyenne par Ratio Loups/Joueurs"}),e.jsx("div",{style:{height:300},children:e.jsx(h,{width:"100%",height:"100%",children:e.jsxs(b,{data:i,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(x,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"ratio",label:{value:"Ratio Loups/Joueurs (%)",position:"insideBottom",offset:-5}}),e.jsx(j,{label:{value:"Durée Moyenne (jours)",angle:-90,position:"insideLeft"}}),e.jsx(m,{content:({active:r,payload:s})=>{if(r&&s&&s.length>0){const a=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Pourcentage de loups : ",a.ratio]})}),e.jsxs("div",{children:["Durée moyenne : ",a.moyenne," jours"]}),e.jsxs("div",{children:["Nombre de parties : ",a.parties]})]})}return null}}),e.jsx(v,{}),e.jsx(D,{type:"monotone",dataKey:"moyenne",name:"Durée Moyenne",stroke:"var(--chart-color-5)",activeDot:{r:8}})]})})})]}),e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Durée Moyenne par Camp Victorieux"}),e.jsx("div",{style:{height:300},children:e.jsx(h,{width:"100%",height:"100%",children:e.jsxs(p,{data:c,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(x,{strokeDasharray:"3 3"}),e.jsx(y,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(j,{label:{value:"Durée Moyenne (jours)",angle:-90,position:"insideLeft"}}),e.jsx(m,{content:({active:r,payload:s})=>{if(r&&s&&s.length>0){const a=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:a.camp})}),e.jsxs("div",{children:["Durée moyenne : ",a.moyenne," jours"]}),e.jsxs("div",{children:["Nombre de parties : ",a.parties]})]})}return null}}),e.jsx(v,{formatter:r=>r==="moyenne"?"Durée Moyenne":r}),e.jsx(g,{dataKey:"moyenne",name:"moyenne",fill:"var(--chart-color-4)",children:e.jsx(f,{dataKey:"moyenne",position:"top",formatter:r=>{const s=typeof r=="number"?r:Number(r);return isNaN(s)?"":`${s.toFixed(1)}j`},fill:"var(--text-primary)",fontSize:12})})]})})})]})]})]})}export{q as GameDurationInsights};
