import{r as h,u as S,j as e,a as k,m as D,l as G}from"./index-Du7Q3f4e.js";import{u as E,g as w}from"./api-fB2FJfbo.js";function T(t){const[l,y]=h.useState(null),[m,v]=h.useState(!1),[g,p]=h.useState(null);h.useEffect(()=>{let n=!0;return(async()=>{try{v(!0),p(null);const c=await fetch("/data/playerAchievements.json");if(!c.ok)throw new Error(`Failed to load achievements: ${c.status} ${c.statusText}`);const s=await c.json();n&&(y(s),console.log("âœ… Pre-calculated achievements loaded:",{totalPlayers:s.totalPlayers,totalGames:s.totalGames,generatedAt:s.generatedAt,playersWithAchievements:Object.keys(s.achievements).length}))}catch(c){n&&(p(c instanceof Error?c.message:"Failed to load achievements"),console.error("Error loading pre-calculated achievements:",c))}finally{n&&v(!1)}})(),()=>{n=!1}},[]);const f=t&&l?.achievements[t]||null;return h.useEffect(()=>{if(t&&l){const n=l.achievements[t];n?console.log(`ðŸ† Achievements for ${t}:`,{allGames:n.allGamesAchievements.length,moddedOnly:n.moddedOnlyAchievements.length,categories:[...new Set([...n.allGamesAchievements.map(r=>r.category),...n.moddedOnlyAchievements.map(r=>r.category)])]}):console.log(`âŒ No achievements found for ${t}`)}},[t,l]),{data:f,isLoading:m,error:g,metadata:{generatedAt:l?.generatedAt||null,totalPlayers:l?.totalPlayers||0,totalGames:l?.totalGames||0,totalModdedGames:l?.totalModdedGames||0}}}function L({achievements:t,title:l,emptyMessage:y}){const{navigateToTab:m}=S(),v=E(),g=s=>{s.redirectTo&&m(s.redirectTo.tab,s.redirectTo.subTab)},p=s=>v[s]||w(s),f=s=>{const P=[/avec ([^:]+?):/,/contre ([^:]+?):/];let d=s;return P.forEach(u=>{const j=s.match(u);if(j&&j[1]){const x=j[1].trim(),a=`<span class="player-name-highlight" style="color: ${p(x)};">${x}</span>`;d=d.replace(x,a)}}),d};if(t.length===0)return e.jsxs("div",{className:"achievements-empty",children:[e.jsx("h4",{children:l}),e.jsx("p",{children:y||"Aucun succÃ¨s dans cette catÃ©gorie"})]});const n=t.filter(s=>s.category!=="comparison"&&s.type==="good"),r=t.filter(s=>s.category!=="comparison"&&s.type==="bad"),c=t.filter(s=>s.category==="comparison");return e.jsxs("div",{className:"achievements-container",children:[e.jsx("h4",{children:l}),n.length>0&&e.jsxs("div",{className:"achievements-section good-achievements",children:[e.jsx("h5",{children:"ðŸ† SuccÃ¨s"}),e.jsx("div",{className:"achievements-grid",children:n.map(s=>e.jsxs("div",{className:`achievement-card good rank-${s.rank}`,onClick:()=>g(s),title:"Cliquez pour voir le classement complet",children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:s.title}),e.jsxs("span",{className:"achievement-rank",children:["#",s.rank]})]}),e.jsx("p",{className:"achievement-description",children:s.description})]},s.id))})]}),r.length>0&&e.jsxs("div",{className:"achievements-section bad-achievements",children:[e.jsx("h5",{children:"ðŸ’€ Anti-succÃ¨s"}),e.jsx("div",{className:"achievements-grid",children:r.map(s=>e.jsxs("div",{className:`achievement-card bad rank-${s.rank}`,onClick:()=>g(s),title:"Cliquez pour voir le classement complet",children:[e.jsxs("div",{className:"achievement-header",children:[e.jsx("span",{className:"achievement-title",children:s.title}),e.jsxs("span",{className:"achievement-rank",children:["#",s.rank]})]}),e.jsx("p",{className:"achievement-description",children:s.description})]},s.id))})]}),c.length>0&&e.jsxs("div",{className:"achievements-section comparison-achievements",children:[e.jsx("h5",{children:"ðŸ“Š Statistiques Face-Ã -Face"}),e.jsx("div",{className:"achievements-grid",children:c.map(s=>e.jsxs("div",{className:"achievement-card comparison",onClick:()=>g(s),title:"Cliquez pour voir les comparaisons dÃ©taillÃ©es",children:[e.jsx("div",{className:"achievement-header",children:e.jsx("span",{className:"achievement-title",children:s.title})}),e.jsx("p",{className:"achievement-description",dangerouslySetInnerHTML:{__html:f(s.description)}})]},s.id))})]})]})}function M(){const{settings:t,updateSettings:l}=k(),{navigateToTab:y}=S(),{data:m,isLoading:v,error:g}=D(),{data:p,isLoading:f,error:n}=T(t.highlightedPlayer),[r,c]=h.useState(""),[s,P]=h.useState("all"),d=h.useMemo(()=>{if(!m||!m.GameStats)return[];const a=new Map;return m.GameStats.forEach(i=>{const o=new Date(i.StartDate);i.PlayerStats.forEach(C=>{const b=G(C.Username);a.has(b)||a.set(b,{games:0,wins:0,firstDate:o,lastDate:o});const N=a.get(b);N.games++,C.Victorious&&N.wins++,o<N.firstDate&&(N.firstDate=o),o>N.lastDate&&(N.lastDate=o)})}),Array.from(a.entries()).map(([i,o])=>({name:i,totalGames:o.games,totalWins:o.wins,winRate:o.games>0?o.wins/o.games*100:0,firstGameDate:o.firstDate.toLocaleDateString("fr-FR"),lastGameDate:o.lastDate.toLocaleDateString("fr-FR"),isHighlighted:i===t.highlightedPlayer}))},[m,t.highlightedPlayer]),u=h.useMemo(()=>{if(!r.trim())return d;const a=r.toLowerCase();return d.filter(i=>i.name.toLowerCase().includes(a))},[d,r]),j=h.useMemo(()=>[...u].sort((a,i)=>i.totalGames-a.totalGames),[u]),x=a=>{l({highlightedPlayer:a}),c("")},A=a=>{l({highlightedPlayer:a}),y("players","history")};return v?e.jsxs("div",{className:"player-selection-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des joueurs..."})]}):g?e.jsxs("div",{className:"player-selection-error",children:[e.jsx("h2",{children:"Erreur"}),e.jsxs("p",{children:["Impossible de charger les donnÃ©es des joueurs: ",g]})]}):!m||d.length===0?e.jsxs("div",{className:"player-selection-empty",children:[e.jsx("h2",{children:"Aucune donnÃ©e disponible"}),e.jsx("p",{children:"Aucun joueur trouvÃ© dans les donnÃ©es."})]}):e.jsxs("div",{className:"player-selection-container",children:[e.jsxs("div",{className:"player-selection-header",children:[e.jsx("h2",{children:"SÃ©lection de Joueur"}),e.jsx("p",{className:"header-description",children:"Choisissez un joueur pour le mettre en Ã©vidence dans tous les graphiques."}),e.jsxs("div",{className:"search-controls",children:[e.jsxs("div",{className:"search-box",children:[e.jsx("input",{type:"text",placeholder:"Rechercher un joueur...",value:r,onChange:a=>c(a.target.value),className:"search-input"}),e.jsx("span",{className:"search-icon",children:"ðŸ”"})]}),e.jsxs("div",{className:"player-count",children:[u.length," joueur",u.length!==1?"s":"",r&&` (filtrÃ©${u.length!==1?"s":""} de ${d.length})`]})]})]}),e.jsx("div",{className:"player-display",children:r?u.length>0?e.jsxs("div",{className:"search-results",children:[e.jsxs("div",{className:"search-results-header",children:[e.jsx("h3",{children:"RÃ©sultats de recherche:"}),e.jsx("button",{className:"clear-search-btn",onClick:()=>c(""),children:"Effacer la recherche"})]}),e.jsx("div",{className:"suggestion-list",children:j.map(a=>e.jsxs("button",{className:`suggestion-btn ${a.isHighlighted?"highlighted":""}`,onClick:()=>x(a.name),children:[a.name," (",a.totalGames," parties, ",a.winRate.toFixed(1),"% victoires)",a.isHighlighted&&e.jsx("span",{className:"highlight-indicator",children:" â˜…"})]},a.name))})]}):e.jsxs("div",{className:"no-results",children:[e.jsxs("p",{children:['Aucun joueur trouvÃ© pour "',r,'"']}),e.jsx("button",{className:"clear-search-btn",onClick:()=>c(""),children:"Effacer la recherche"})]}):t.highlightedPlayer?(()=>{const a=d.find(i=>i.name===t.highlightedPlayer);return a?e.jsxs("div",{className:"single-player-card highlighted",onClick:()=>A(a.name),children:[e.jsxs("div",{className:"player-card-header",children:[e.jsx("h3",{className:"player-name",children:a.name}),e.jsx("span",{className:"highlight-badge",children:"â˜… Mis en Ã©vidence"})]}),e.jsxs("div",{className:"player-stats",children:[e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Parties"}),e.jsx("span",{className:"stat-value",children:a.totalGames})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Victoires"}),e.jsx("span",{className:"stat-value",children:a.totalWins})]}),e.jsxs("div",{className:"stat-item",children:[e.jsx("span",{className:"stat-label",children:"Taux de victoire"}),e.jsxs("span",{className:"stat-value",children:[a.winRate.toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"player-period",children:[e.jsx("span",{className:"period-label",children:"PÃ©riode d'activitÃ©:"}),e.jsxs("span",{className:"period-range",children:[a.firstGameDate," - ",a.lastGameDate]})]}),e.jsxs("div",{className:"player-actions",children:[e.jsx("button",{className:"highlight-btn active",onClick:i=>{i.stopPropagation(),l({highlightedPlayer:null})},children:"â˜… Retirer la mise en Ã©vidence"}),e.jsxs("div",{className:"achievements-section",children:[e.jsxs("div",{className:"achievements-filter",children:[e.jsx("button",{className:`filter-btn ${s==="all"?"active":""}`,onClick:i=>{i.stopPropagation(),P("all")},children:"Toutes les parties"}),e.jsx("button",{className:`filter-btn ${s==="modded"?"active":""}`,onClick:i=>{i.stopPropagation(),P("modded")},children:"Parties moddÃ©es"})]}),f?e.jsxs("div",{className:"achievements-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des succÃ¨s..."})]}):n?e.jsx("div",{className:"achievements-error",children:e.jsxs("p",{children:["âŒ Erreur lors du chargement des succÃ¨s: ",n]})}):p?e.jsx(L,{achievements:s==="all"?p.allGamesAchievements:p.moddedOnlyAchievements,title:s==="all"?"SuccÃ¨s - Toutes les parties":"SuccÃ¨s - Parties moddÃ©es",emptyMessage:"Aucun succÃ¨s dans cette catÃ©gorie"}):e.jsx("div",{className:"achievements-empty",children:e.jsx("p",{children:"Aucun succÃ¨s disponible pour ce joueur"})})]})]})]}):e.jsxs("div",{className:"no-player-found",children:[e.jsxs("p",{children:['Le joueur "',t.highlightedPlayer,`" n'a pas Ã©tÃ© trouvÃ© dans les donnÃ©es.`]}),e.jsx("button",{className:"clear-selection-btn",onClick:()=>l({highlightedPlayer:null}),children:"Effacer la sÃ©lection"})]})})():e.jsx("div",{className:"player-selection-prompt",children:e.jsxs("div",{className:"selection-prompt-content",children:[e.jsx("h2",{children:"SÃ©lectionnez un joueur"}),e.jsx("p",{children:"Utilisez la recherche ci-dessus pour trouver et sÃ©lectionner un joueur Ã  mettre en Ã©vidence."}),u.length>0&&e.jsxs("div",{className:"suggested-players",children:[e.jsx("h3",{children:"Joueurs suggÃ©rÃ©s:"}),e.jsx("div",{className:"suggestion-list",children:j.slice(0,5).map(a=>e.jsxs("button",{className:"suggestion-btn",onClick:()=>x(a.name),children:[a.name," (",a.totalGames," parties)"]},a.name))})]})]})})})]})}export{M as PlayerSelectionPage};
