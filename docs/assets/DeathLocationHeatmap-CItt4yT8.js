import{r as C,j as e,u as te,a as ue,e as re}from"./index-DKvcuTxH.js";import{u as fe,c as me}from"./useDeathStatisticsFromRaw-PE4y5IJC.js";import{D as B}from"./datasyncExport-D6_8Fmuy.js";import{a as he}from"./api-p1ThVxJG.js";import{F as xe,C as pe,X as ge,Y as ve,a as ye}from"./FullscreenChart-Du2pPxcZ.js";import{g as be,c as J,a as je,b as Me,d as ze,R as Se}from"./deathLocationUtils-DyDIpIWG.js";import{g as O}from"./deathTypes-CGUOTngO.js";import{ak as Ce,al as ne,am as Q,an as Ee,ao as U,R as ke,T as we}from"./CategoricalChart-D5ApRQ0T.js";import{S as Re,a as Ae}from"./ScatterChart-XYf9H5XW.js";import"./baseStatsHook-CUr325ff.js";const De=Ne(Le);function Ne(t){return function(a,d,n=d){if(!((d=+d)>=0))throw new RangeError("invalid rx");if(!((n=+n)>=0))throw new RangeError("invalid ry");let{data:r,width:c,height:m}=a;if(!((c=Math.floor(c))>=0))throw new RangeError("invalid width");if(!((m=Math.floor(m!==void 0?m:r.length/c))>=0))throw new RangeError("invalid height");if(!c||!m||!d&&!n)return a;const v=d&&t(d),g=n&&t(n),i=r.slice();return v&&g?(Z(v,i,r,c,m),Z(v,r,i,c,m),Z(v,i,r,c,m),G(g,r,i,c,m),G(g,i,r,c,m),G(g,r,i,c,m)):v?(Z(v,r,i,c,m),Z(v,i,r,c,m),Z(v,r,i,c,m)):g&&(G(g,r,i,c,m),G(g,i,r,c,m),G(g,r,i,c,m)),a}}function Z(t,a,d,n,r){for(let c=0,m=n*r;c<m;)t(a,d,c,c+=n,1)}function G(t,a,d,n,r){for(let c=0,m=n*r;c<n;++c)t(a,d,c,c+m,n)}function Le(t){const a=Math.floor(t);if(a===t)return Ie(t);const d=t-a,n=2*t+1;return(r,c,m,v,g)=>{if(!((v-=g)>=m))return;let i=a*c[m];const o=g*a,y=o+g;for(let h=m,x=m+o;h<x;h+=g)i+=c[Math.min(v,h)];for(let h=m,x=v;h<=x;h+=g)i+=c[Math.min(v,h+o)],r[h]=(i+d*(c[Math.max(m,h-y)]+c[Math.min(v,h+y)]))/n,i-=c[Math.max(m,h-o)]}}function Ie(t){const a=2*t+1;return(d,n,r,c,m)=>{if(!((c-=m)>=r))return;let v=t*n[r];const g=m*t;for(let i=r,o=r+g;i<o;i+=m)v+=n[Math.min(c,i)];for(let i=r,o=c;i<=o;i+=m)v+=n[Math.min(c,i+g)],d[i]=v/a,v-=n[Math.max(r,i-g)]}}function Te(t,a){let d=0;for(let n of t)n!=null&&(n=+n)>=n&&++d;return d}function We(t,a){let d,n;if(a===void 0)for(const r of t)r!=null&&(d===void 0?r>=r&&(d=n=r):(d>r&&(d=r),n<r&&(n=r)));else{let r=-1;for(let c of t)(c=a(c,++r,t))!=null&&(d===void 0?c>=c&&(d=n=c):(d>c&&(d=c),n<c&&(n=c)))}return[d,n]}function Pe(t,a,d){let n;for(;;){const r=Ce(t,a,d);if(r===n||r===0||!isFinite(r))return[t,a];r>0?(t=Math.floor(t/r)*r,a=Math.ceil(a/r)*r):r<0&&(t=Math.ceil(t*r)/r,a=Math.floor(a*r)/r),n=r}}function Be(t){return Math.max(1,Math.ceil(Math.log(Te(t))/Math.LN2)+1)}var Fe=Array.prototype,oe=Fe.slice;function Xe(t,a){return t-a}function Ve(t){for(var a=0,d=t.length,n=t[d-1][1]*t[0][0]-t[d-1][0]*t[0][1];++a<d;)n+=t[a-1][1]*t[a][0]-t[a-1][0]*t[a][1];return n}const $=t=>()=>t;function qe(t,a){for(var d=-1,n=a.length,r;++d<n;)if(r=He(t,a[d]))return r;return 0}function He(t,a){for(var d=a[0],n=a[1],r=-1,c=0,m=t.length,v=m-1;c<m;v=c++){var g=t[c],i=g[0],o=g[1],y=t[v],h=y[0],x=y[1];if($e(g,y,a))return 0;o>n!=x>n&&d<(h-i)*(n-o)/(x-o)+i&&(r=-r)}return r}function $e(t,a,d){var n;return Ye(t,a,d)&&Ze(t[n=+(t[0]===a[0])],d[n],a[n])}function Ye(t,a,d){return(a[0]-t[0])*(d[1]-t[1])===(d[0]-t[0])*(a[1]-t[1])}function Ze(t,a,d){return t<=a&&a<=d||d<=a&&a<=t}function Ge(){}var H=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function _(){var t=1,a=1,d=Be,n=g;function r(i){var o=d(i);if(Array.isArray(o))o=o.slice().sort(Xe);else{const y=We(i,Oe);for(o=ne(...Pe(y[0],y[1],o),o);o[o.length-1]>=y[1];)o.pop();for(;o[1]<y[0];)o.shift()}return o.map(y=>c(i,y))}function c(i,o){const y=o==null?NaN:+o;if(isNaN(y))throw new Error(`invalid value: ${o}`);var h=[],x=[];return m(i,y,function(b){n(b,i,y),Ve(b)>0?h.push([b]):x.push(b)}),x.forEach(function(b){for(var E=0,z=h.length,f;E<z;++E)if(qe((f=h[E])[0],b)!==-1){f.push(b);return}}),{type:"MultiPolygon",value:o,coordinates:h}}function m(i,o,y){var h=new Array,x=new Array,b,E,z,f,l,p;for(b=E=-1,f=Y(i[0],o),H[f<<1].forEach(s);++b<t-1;)z=f,f=Y(i[b+1],o),H[z|f<<1].forEach(s);for(H[f<<0].forEach(s);++E<a-1;){for(b=-1,f=Y(i[E*t+t],o),l=Y(i[E*t],o),H[f<<1|l<<2].forEach(s);++b<t-1;)z=f,f=Y(i[E*t+t+b+1],o),p=l,l=Y(i[E*t+b+1],o),H[z|f<<1|l<<2|p<<3].forEach(s);H[f|l<<3].forEach(s)}for(b=-1,l=i[E*t]>=o,H[l<<2].forEach(s);++b<t-1;)p=l,l=Y(i[E*t+b+1],o),H[l<<2|p<<3].forEach(s);H[l<<3].forEach(s);function s(M){var S=[M[0][0]+b,M[0][1]+E],w=[M[1][0]+b,M[1][1]+E],R=v(S),L=v(w),j,D;(j=x[R])?(D=h[L])?(delete x[j.end],delete h[D.start],j===D?(j.ring.push(w),y(j.ring)):h[j.start]=x[D.end]={start:j.start,end:D.end,ring:j.ring.concat(D.ring)}):(delete x[j.end],j.ring.push(w),x[j.end=L]=j):(j=h[L])?(D=x[R])?(delete h[j.start],delete x[D.end],j===D?(j.ring.push(w),y(j.ring)):h[D.start]=x[j.end]={start:D.start,end:j.end,ring:D.ring.concat(j.ring)}):(delete h[j.start],j.ring.unshift(S),h[j.start=R]=j):h[R]=x[L]={start:R,end:L,ring:[S,w]}}}function v(i){return i[0]*2+i[1]*(t+1)*4}function g(i,o,y){i.forEach(function(h){var x=h[0],b=h[1],E=x|0,z=b|0,f=K(o[z*t+E]);x>0&&x<t&&E===x&&(h[0]=ee(x,K(o[z*t+E-1]),f,y)),b>0&&b<a&&z===b&&(h[1]=ee(b,K(o[(z-1)*t+E]),f,y))})}return r.contour=c,r.size=function(i){if(!arguments.length)return[t,a];var o=Math.floor(i[0]),y=Math.floor(i[1]);if(!(o>=0&&y>=0))throw new Error("invalid size");return t=o,a=y,r},r.thresholds=function(i){return arguments.length?(d=typeof i=="function"?i:Array.isArray(i)?$(oe.call(i)):$(i),r):d},r.smooth=function(i){return arguments.length?(n=i?g:Ge,r):n===g},r}function Oe(t){return isFinite(t)?t:NaN}function Y(t,a){return t==null?!1:+t>=a}function K(t){return t==null||isNaN(t=+t)?-1/0:t}function ee(t,a,d,n){const r=n-a,c=d-a,m=isFinite(r)||isFinite(c)?r/c:Math.sign(r)/Math.sign(c);return isNaN(m)?t:t+m-.5}function Ue(t){return t[0]}function Ke(t){return t[1]}function Je(){return 1}function se(){var t=Ue,a=Ke,d=Je,n=960,r=500,c=20,m=2,v=c*3,g=n+v*2>>m,i=r+v*2>>m,o=$(20);function y(l){var p=new Float32Array(g*i),s=Math.pow(2,-m),M=-1;for(const u of l){var S=(t(u,++M,l)+v)*s,w=(a(u,M,l)+v)*s,R=+d(u,M,l);if(R&&S>=0&&S<g&&w>=0&&w<i){var L=Math.floor(S),j=Math.floor(w),D=S-L-.5,F=w-j-.5;p[L+j*g]+=(1-D)*(1-F)*R,p[L+1+j*g]+=D*(1-F)*R,p[L+1+(j+1)*g]+=D*F*R,p[L+(j+1)*g]+=(1-D)*F*R}}return De({data:p,width:g,height:i},c*s),p}function h(l){var p=y(l),s=o(p),M=Math.pow(2,2*m);return Array.isArray(s)||(s=ne(Number.MIN_VALUE,Q(p)/M,s)),_().size([g,i]).thresholds(s.map(S=>S*M))(p).map((S,w)=>(S.value=+s[w],x(S)))}h.contours=function(l){var p=y(l),s=_().size([g,i]),M=Math.pow(2,2*m),S=w=>{w=+w;var R=x(s.contour(p,w*M));return R.value=w,R};return Object.defineProperty(S,"max",{get:()=>Q(p)/M}),S};function x(l){return l.coordinates.forEach(b),l}function b(l){l.forEach(E)}function E(l){l.forEach(z)}function z(l){l[0]=l[0]*Math.pow(2,m)-v,l[1]=l[1]*Math.pow(2,m)-v}function f(){return v=c*3,g=n+v*2>>m,i=r+v*2>>m,h}return h.x=function(l){return arguments.length?(t=typeof l=="function"?l:$(+l),h):t},h.y=function(l){return arguments.length?(a=typeof l=="function"?l:$(+l),h):a},h.weight=function(l){return arguments.length?(d=typeof l=="function"?l:$(+l),h):d},h.size=function(l){if(!arguments.length)return[n,r];var p=+l[0],s=+l[1];if(!(p>=0&&s>=0))throw new Error("invalid size");return n=p,r=s,f()},h.cellSize=function(l){if(!arguments.length)return 1<<m;if(!((l=+l)>=1))throw new Error("invalid cell size");return m=Math.floor(Math.log(l)/Math.LN2),f()},h.thresholds=function(l){return arguments.length?(o=typeof l=="function"?l:Array.isArray(l)?$(oe.call(l)):$(l),h):o},h.bandwidth=function(l){if(!arguments.length)return Math.sqrt(c*(c+1));if(!((l=+l)>=0))throw new Error("invalid bandwidth");return c=(Math.sqrt(4*l*l+1)-1)/2,f()},h}function Qe(t){for(var a=t.length/6|0,d=new Array(a),n=0;n<a;)d[n]="#"+t.slice(n*6,++n*6);return d}const _e=t=>Ee(t[t.length-1]);var et=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(Qe);const ae=_e(et);function tt({deathLocations:t,xDomain:a,zDomain:d,width:n=800,height:r=600,bandwidth:c=25,onRegionClick:m,mapConfig:v}){const g=C.useRef(null),i=C.useRef(null),o=C.useRef(null),y=C.useRef(null),[,h]=C.useState(!1),x=C.useMemo(()=>U().domain(d).range([0,n]),[d,n]),b=C.useMemo(()=>U().domain(a).range([r,0]),[a,r]),E=C.useMemo(()=>t.length===0?[]:se().x(s=>x(s.z)).y(s=>b(s.x)).size([n,r]).bandwidth(c).thresholds(15)(t),[t,b,x,n,r,c]),z=C.useMemo(()=>{const p=E.length>0?Math.max(...E.map(s=>s.value)):1;return s=>{const M=s/p;return ae(M)}},[E]);C.useEffect(()=>{const p=o.current;if(!p||!v){h(!1);return}const s=p.getContext("2d");if(!s)return;s.clearRect(0,0,n,r);const M=new Image;M.onload=()=>{s.globalAlpha=.85,s.drawImage(M,0,0,n,r),s.globalAlpha=1,h(!0)},M.onerror=()=>{h(!1)},M.src=v.src},[v,n,r]),C.useEffect(()=>{const p=g.current;if(!p||E.length===0)return;const s=p.getContext("2d");s&&(s.clearRect(0,0,n,r),E.forEach(M=>{s.fillStyle=z(M.value),s.globalAlpha=.6,M.coordinates.forEach(S=>{S.forEach(w=>{s.beginPath(),w.forEach((R,L)=>{L===0?s.moveTo(R[0],R[1]):s.lineTo(R[0],R[1])}),s.closePath(),s.fill()})})}),s.globalAlpha=1)},[E,n,r,z]),C.useEffect(()=>{const p=i.current;if(!p||t.length===0)return;const s=p.getContext("2d");s&&(s.clearRect(0,0,n,r),t.forEach(M=>{const S=x(M.z),w=b(M.x);s.beginPath(),s.arc(S,w,2,0,2*Math.PI),s.fillStyle="rgba(0, 0, 0, 0.3)",s.fill(),s.strokeStyle="rgba(255, 255, 255, 0.5)",s.lineWidth=.5,s.stroke()}))},[t,b,x,n,r]);const f=p=>{if(!m||!y.current)return;const s=y.current.getBoundingClientRect(),M=p.clientX-s.left,S=p.clientY-s.top,w=30,R=t.filter(L=>{const j=x(L.z),D=b(L.x);return Math.sqrt(Math.pow(j-M,2)+Math.pow(D-S,2))<=w});R.length>0&&m(R)},l=p=>{if(!y.current)return;const s=y.current.getBoundingClientRect(),M=p.clientX-s.left,S=p.clientY-s.top,w=20,R=t.filter(L=>{const j=x(L.z),D=b(L.x);return Math.sqrt(Math.pow(j-M,2)+Math.pow(D-S,2))<=w});y.current&&(y.current.style.cursor=R.length>0?"pointer":"default")};return e.jsxs("div",{ref:y,style:{position:"relative",width:`${n}px`,height:`${r}px`,margin:"0 auto"},onClick:f,onMouseMove:l,children:[e.jsx("canvas",{ref:o,width:n,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),e.jsx("canvas",{ref:g,width:n,height:r,style:{position:"absolute",top:0,left:0,borderRadius:"4px",pointerEvents:"none"}}),e.jsx("canvas",{ref:i,width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),e.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),e.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),e.jsxs("svg",{width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(p=>{const s=n*p,M=d[0]+(d[1]-d[0])*p;return e.jsxs("g",{children:[e.jsx("line",{x1:s,y1:r,x2:s,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:s,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(M)})]},`z-${p}`)}),[0,.25,.5,.75,1].map(p=>{const s=r*(1-p),M=a[0]+(a[1]-a[0])*p;return e.jsxs("g",{children:[e.jsx("line",{x1:0,y1:s,x2:5,y2:s,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:10,y:s,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(M)})]},`x-${p}`)})]})]})}function rt({selectedCamp:t,availableDeathTypes:a,deathTypeColors:d}){const{navigateToGameDetails:n}=te(),{settings:r}=ue(),{data:c,isLoading:m,error:v}=re(),[g,i]=C.useState(""),[o,y]=C.useState("all"),[h,x]=C.useState(null),[b,E]=C.useState("heatmap"),[z,f]=C.useState(20),l=C.useMemo(()=>{if(!c)return[];const u=be(c),N=J(c,t),k=new Map;return N.forEach(A=>{k.set(A.mapName,(k.get(A.mapName)||0)+1)}),u.sort((A,X)=>{const I=k.get(A)||0;return(k.get(X)||0)-I})},[c,t]),p=l.length>0?l[0]:"";g===""&&p!==""&&i(p);const s=C.useMemo(()=>{if(!c)return[];let u=J(c,t);return g&&(u=u.filter(N=>N.mapName===g)),o!=="all"&&(u=u.filter(N=>N.deathType===o)),u},[c,t,g,o]),M=C.useMemo(()=>je(s,z),[s,z]),S=C.useMemo(()=>M.map((u,N)=>{const k=u.items[0],A=Me(u.items);return{x:u.centroidX,z:u.centroidZ,deathCount:u.items.length,allDeaths:u.items,dominantDeathType:A,playerName:u.items.length===1?k.playerName:null,gameId:u.items.length===1?k.gameId:null,camp:k.camp,mapName:k.mapName,deathType:A,killerName:u.items.length===1?k.killerName:null,clusterIndex:N}}),[M]),w=({active:u,payload:N})=>{if(!u||!N||N.length===0)return null;const k=N[0].payload,A=k.allDeaths||[k];if(A.length>1){const W=new Map,V=new Set,q=new Map;A.forEach(T=>{const P=T.deathType?O(T.deathType):"Inconnu";W.set(P,(W.get(P)||0)+1),V.add(T.gameId),q.set(T.playerName,(q.get(T.playerName)||0)+1)});const ie=Array.from(q.entries()).sort((T,P)=>P[1]-T[1]).slice(0,3),le=q.size>3,ce=Array.from(W.entries()).sort((T,P)=>P[1]-T[1]).slice(0,3),de=W.size>3;return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:[A.length," morts dans cette zone"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Centre:"})," (",Math.round(k.x),", ",Math.round(k.z),")"]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Joueurs:"}),e.jsxs("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:[ie.map(([T,P])=>e.jsxs("li",{children:[T," ",P>1?`(${P} morts)`:""]},T)),le&&e.jsxs("li",{style:{color:"var(--text-secondary)"},children:["...et ",q.size-3," autres"]})]})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Types de mort:"}),e.jsxs("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:[ce.map(([T,P])=>e.jsxs("li",{children:[T," (",P,")"]},T)),de&&e.jsxs("li",{style:{color:"var(--text-secondary)"},children:["...et ",W.size-3," autres"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Parties:"})," ",V.size," parties",V.size<=5&&e.jsxs("span",{children:[" (",Array.from(V).filter(T=>T).map(T=>`#${T}`).join(", "),")"]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const I=A[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary)"},children:I.playerName}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Camp:"})," ",I.camp]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type de mort:"})," ",I.deathType?O(I.deathType):"Inconnu"]}),I.killerName&&e.jsxs("div",{children:[e.jsx("strong",{children:"TuÃ© par:"})," ",I.killerName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Carte:"})," ",I.mapName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Partie:"})," #",I.gameId]}),e.jsxs("div",{style:{marginTop:"4px",fontSize:"0.85rem",color:"var(--text-secondary)"},children:["Position: (",Math.round(I.x),", ",Math.round(I.z),")"]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})},R=u=>{if(!u)return;const N=u.allDeaths||[u];if(N.length===1)n({selectedGame:N[0].gameId,fromComponent:"Death Location View"});else{const k=N.map(A=>A.gameId).filter(A=>A);n({selectedGameIds:k,fromComponent:"Death Location View"})}},L=u=>u&&d[u]||"var(--text-secondary)",j=C.useMemo(()=>ze(g),[g]),{xDomain:D,zDomain:F}=C.useMemo(()=>{if(j)return{xDomain:[j.xMin,j.xMax],zDomain:[j.zMin,j.zMax]};if(S.length===0)return{xDomain:[0,100],zDomain:[0,100]};const u=S.map(q=>q.x),N=S.map(q=>q.z),k=Math.min(...u),A=Math.max(...u),X=Math.min(...N),I=Math.max(...N),W=(A-k)*.1||10,V=(I-X)*.1||10;return{xDomain:[k-W,A+W],zDomain:[X-V,I+V]}},[S,j]);return m?e.jsx("div",{className:"donnees-attente",children:"Chargement des localisations de mort..."}):v?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",v]}):c?e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Mode :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{onClick:()=>E("heatmap"),style:{background:b==="heatmap"?"var(--accent-primary)":"transparent",color:b==="heatmap"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:b==="heatmap"?"bold":"normal",transition:"all 0.2s"},children:"Carte de chaleur"}),e.jsx("button",{onClick:()=>E("scatter"),style:{background:b==="scatter"?"var(--accent-primary)":"transparent",color:b==="scatter"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:b==="scatter"?"bold":"normal",transition:"all 0.2s"},children:"Points"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"map-select",value:g,onChange:u=>i(u.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:l.filter(u=>u==="Village"||u==="ChÃ¢teau").map(u=>e.jsx("option",{value:u,children:u},u))})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"death-type-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Type de mort :"}),e.jsxs("select",{id:"death-type-select",value:o,onChange:u=>y(u.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"180px"},children:[e.jsx("option",{value:"all",children:"Tous les types"}),a.map(u=>e.jsx("option",{value:u,children:O(u)},u))]})]}),b==="scatter"&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-radius",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-radius",type:"range",min:"0",max:"60",step:"5",value:z,onChange:u=>f(Number(u.target.value)),style:{width:"100px",cursor:"pointer"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.85rem",minWidth:"70px"},children:z===0?"Aucun":`${z} unitÃ©s`})]})]}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginBottom:"2rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Morts localisÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary)"},children:s.length}),b==="scatter"&&z>0&&S.length<s.length&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"4px"},children:["â†’ ",S.length," points groupÃ©s"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camp filtrÃ©"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)",fontSize:"1.2rem"},children:t})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Type de mort"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-2)",fontSize:"1.2rem"},children:o==="all"?"Tous":O(o)})]})]}),s.length>0?e.jsx(xe,{title:b==="scatter"?"Carte des Morts":"Carte de Chaleur des Morts",children:b==="scatter"?e.jsx("div",{style:{height:700,width:"100%",maxWidth:1e3,margin:"0 auto"},children:e.jsx(ke,{width:"100%",height:"100%",children:e.jsxs(Re,{margin:{top:20,right:30,left:60,bottom:60},children:[j&&e.jsx(Se,{x1:j.zMin,x2:j.zMax,y1:j.xMin,y2:j.xMax,fill:"transparent",stroke:"none",shape:u=>{const{x:N,y:k,width:A,height:X}=u;return e.jsx("image",{x:N,y:k,width:A,height:X,href:j.src,preserveAspectRatio:"none",style:{opacity:.85}})}}),e.jsx(pe,{strokeDasharray:"3 3",stroke:j?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(ge,{dataKey:"z",type:"number",name:"Position Z",label:{value:"Position Z",position:"bottom",offset:10,style:{fill:"var(--text-secondary)"}},domain:F,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:u=>Math.round(u).toString()}),e.jsx(ve,{dataKey:"x",type:"number",name:"Position X",label:{value:"Position X",angle:-90,position:"left",offset:20,style:{fill:"var(--text-secondary)"}},domain:D,stroke:"var(--text-secondary)",tick:{fill:"var(--text-secondary)"},tickFormatter:u=>Math.round(u).toString()}),e.jsx(we,{content:e.jsx(w,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(Ae,{data:S,onClick:u=>R(u),onMouseEnter:u=>x(u),onMouseLeave:()=>x(null),style:{cursor:"pointer"},isAnimationActive:!1,children:S.map((u,N)=>{const k=u.allDeaths.some(V=>r.highlightedPlayer===V.playerName),A=h&&u.clusterIndex===h.clusterIndex,X=Math.min(Math.log2(u.deathCount+1)*3+4,18),I=Math.round(X),W=I+2;return e.jsx(ye,{fill:k?"var(--accent-primary)":L(u.deathType),stroke:k||A?"white":u.deathCount>1?"rgba(255,255,255,0.6)":"none",strokeWidth:k?3:A?2:u.deathCount>1?1.5:0,opacity:k?1:.8,r:k?W:A?I+1:I},`cell-${N}`)})})]})})}):e.jsx("div",{style:{padding:"2rem 0",display:"flex",justifyContent:"center"},children:e.jsx(tt,{deathLocations:s,xDomain:D,zDomain:F,width:1e3,height:700,bandwidth:25,mapConfig:j,onRegionClick:u=>{if(u.length===1)n({selectedGame:u[0].gameId,fromComponent:"Death Location View (Heatmap)"});else{const N=u.map(k=>k.gameId).filter(k=>k);n({selectedGameIds:N,fromComponent:"Death Location View (Heatmap)"})}}})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1rem"},children:"Aucune localisation de mort disponible pour les filtres sÃ©lectionnÃ©s"}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes (non-legacy)."})]}),e.jsxs("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:[e.jsx("p",{children:e.jsx("strong",{children:"Ã€ propos de cette visualisation :"})}),e.jsxs("ul",{style:{marginTop:"0.5rem",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Les positions sont basÃ©es sur les coordonnÃ©es Z (horizontal) et X (vertical) - vue 2D de la carte"}),b==="scatter"?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:'Les morts proches sont regroupÃ©es en un seul point - ajustez le curseur "Regroupement" pour contrÃ´ler la distance'}),e.jsx("li",{children:"Les points regroupÃ©s ont une petite bordure blanche"}),e.jsx("li",{children:"La couleur indique le type de mort dominant dans ce regroupement"}),e.jsx("li",{children:"Survolez un point pour voir tous les joueurs, types de mort et parties concernÃ©s"}),e.jsxs("li",{children:["Le joueur sÃ©lectionnÃ© est affichÃ© en "," ",e.jsx("span",{style:{color:"var(--accent-primary)",fontWeight:"bold"},children:"couleur primaire"})]}),e.jsx("li",{children:"Cliquez sur un point pour voir les dÃ©tails de la ou des parties"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"La carte de chaleur montre les zones de forte densitÃ© de morts (du jaune au rouge)"}),e.jsx("li",{children:"Les points noirs indiquent l'emplacement exact de chaque mort"}),e.jsx("li",{children:"Les zones rouges indiquent une concentration Ã©levÃ©e de morts"}),e.jsx("li",{children:"Cliquez sur une zone pour voir les dÃ©tails des parties associÃ©es"}),e.jsx("li",{children:'Utilisez le mode "Points" pour voir les dÃ©tails individuels par type de mort'})]})]}),e.jsx("p",{style:{marginTop:"0.5rem",fontStyle:"italic",color:"var(--text-secondary)"},children:"Note : Seules les parties rÃ©centes contiennent des donnÃ©es de position."})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function mt({deathLocations:t,xDomain:a,zDomain:d,width:n=800,height:r=600,bandwidth:c=25,onRegionClick:m}){const v=C.useRef(null),g=C.useRef(null),i=C.useRef(null),o=C.useMemo(()=>U().domain(a).range([0,n]),[a,n]),y=C.useMemo(()=>U().domain(d).range([r,0]),[d,r]),h=C.useMemo(()=>t.length===0?[]:se().x(f=>o(f.x)).y(f=>y(f.z)).size([n,r]).bandwidth(c).thresholds(15)(t),[t,o,y,n,r,c]),x=C.useMemo(()=>{const z=h.length>0?Math.max(...h.map(f=>f.value)):1;return f=>{const l=f/z;return ae(l)}},[h]);C.useEffect(()=>{const z=v.current;if(!z||h.length===0)return;const f=z.getContext("2d");f&&(f.clearRect(0,0,n,r),h.forEach(l=>{f.fillStyle=x(l.value),f.globalAlpha=.6,l.coordinates.forEach(p=>{p.forEach(s=>{f.beginPath(),s.forEach((M,S)=>{S===0?f.moveTo(M[0],M[1]):f.lineTo(M[0],M[1])}),f.closePath(),f.fill()})})}),f.globalAlpha=1)},[h,n,r,x]),C.useEffect(()=>{const z=g.current;if(!z||t.length===0)return;const f=z.getContext("2d");f&&(f.clearRect(0,0,n,r),t.forEach(l=>{const p=o(l.x),s=y(l.z);f.beginPath(),f.arc(p,s,2,0,2*Math.PI),f.fillStyle="rgba(0, 0, 0, 0.3)",f.fill(),f.strokeStyle="rgba(255, 255, 255, 0.5)",f.lineWidth=.5,f.stroke()}))},[t,o,y,n,r]);const b=z=>{if(!m||!i.current)return;const f=i.current.getBoundingClientRect(),l=z.clientX-f.left,p=z.clientY-f.top,s=30,M=t.filter(S=>{const w=o(S.x),R=y(S.z);return Math.sqrt(Math.pow(w-l,2)+Math.pow(R-p,2))<=s});M.length>0&&m(M)},E=z=>{if(!i.current)return;const f=i.current.getBoundingClientRect(),l=z.clientX-f.left,p=z.clientY-f.top,s=20,M=t.filter(S=>{const w=o(S.x),R=y(S.z);return Math.sqrt(Math.pow(w-l,2)+Math.pow(R-p,2))<=s});i.current&&(i.current.style.cursor=M.length>0?"pointer":"default")};return e.jsxs("div",{ref:i,style:{position:"relative",width:`${n}px`,height:`${r}px`,margin:"0 auto"},onClick:b,onMouseMove:E,children:[e.jsx("canvas",{ref:v,width:n,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),e.jsx("canvas",{ref:g,width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),e.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),e.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),e.jsxs("svg",{width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(z=>{const f=n*z,l=a[0]+(a[1]-a[0])*z;return e.jsxs("g",{children:[e.jsx("line",{x1:f,y1:r,x2:f,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:f,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(l)})]},`x-${z}`)}),[0,.25,.5,.75,1].map(z=>{const f=r*(1-z),l=d[0]+(d[1]-d[0])*z;return e.jsxs("g",{children:[e.jsx("line",{x1:0,y1:f,x2:5,y2:f,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:10,y:f,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(l)})]},`z-${z}`)})]})]})}function ht(){const{navigationState:t,updateNavigationState:a}=te(),[d,n]=C.useState(t.deathLocationState?.selectedCamp||"Tous les camps"),{data:r}=fe(),{data:c}=re(),m=he();C.useEffect(()=>{(!t.deathLocationState||t.deathLocationState.selectedCamp!==d)&&a({deathLocationState:{selectedCamp:d}})},[d,t.deathLocationState,a]);const v=C.useMemo(()=>c?me(c):[],[c]),g=C.useMemo(()=>{const o={};v.forEach(x=>{x===B.BY_WOLF?o[x]=m.Loup:x===B.VOTED?o[x]="var(--chart-color-1)":x===B.BULLET||x===B.BULLET_HUMAN||x===B.BULLET_WOLF?o[x]=m.Chasseur:x===B.BY_ZOMBIE?o[x]=m.Vaudou:x===B.ASSASSIN?o[x]=m.Alchimiste:x===B.AVENGER?o[x]="var(--chart-color-2)":x===B.LOVER_DEATH?o[x]=m.Amoureux:x===B.BY_BEAST?o[x]="var(--chart-color-3)":x===B.SHERIF_SUCCESS&&(o[x]="var(--chart-color-4)")});const y=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let h=0;return v.forEach(x=>{o[x]||(o[x]=y[h%y.length],h++)}),o},[v,m]),i=o=>{n(o),a({deathLocationState:{selectedCamp:o}})};return e.jsxs("div",{className:"lycans-general-stats",children:[e.jsx("h2",{children:"ðŸ—ºï¸ Carte de Chaleur des Morts"}),e.jsx("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select",value:d,onChange:o=>i(o.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"},"tous"),r?.filter(o=>o!=="Tous les camps").map(o=>e.jsx("option",{value:o,children:o},o))]})]})}),e.jsx(rt,{selectedCamp:d,availableDeathTypes:v,deathTypeColors:g})]})}export{ht as DeathLocationHeatmap,mt as DeathLocationHeatmapCanvas};
