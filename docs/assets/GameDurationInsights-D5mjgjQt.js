import{r as B,j as e}from"./index-DUftcxZ_.js";import{u as N}from"./useRawGameData-DoyiMgXc.js";import{F as p,R as x,B as b,C as j,X as D,Y as f,T as v,o as C,p as R,w as W,v as P,ad as L}from"./FullscreenChart-DSz5mXx5.js";import{L as A,a as F}from"./LineChart-bPvuKti-.js";import{L as M}from"./Legend-D32n-PIb.js";function k(){const{data:n,isLoading:m,error:c}=N();return{durationAnalysis:B.useMemo(()=>{if(!n||n.length===0)return null;const a={averageDays:"0",maxDays:0,minDays:99,dayDistribution:{},daysByWinnerCamp:{},daysByPlayerCount:{},daysByWolfRatio:{}};let r=0,t=0;n.forEach(i=>{const s=i["Nombre de journées"],d=i["Camp victorieux"],l=i["Nombre de joueurs"],h=i["Nombre de loups"];if(s&&!isNaN(s)&&s>0){if(t++,r+=s,s>a.maxDays&&(a.maxDays=s),s<a.minDays&&(a.minDays=s),a.dayDistribution[s]||(a.dayDistribution[s]=0),a.dayDistribution[s]++,d&&d.trim()!==""&&(a.daysByWinnerCamp[d]||(a.daysByWinnerCamp[d]={totalDays:0,count:0,average:"0"}),a.daysByWinnerCamp[d].totalDays+=s,a.daysByWinnerCamp[d].count++),l&&!isNaN(l)&&l>0){const y=l.toString();a.daysByPlayerCount[y]||(a.daysByPlayerCount[y]={totalDays:0,count:0,average:"0"}),a.daysByPlayerCount[y].totalDays+=s,a.daysByPlayerCount[y].count++}if(l&&h&&!isNaN(l)&&!isNaN(h)&&l>0){const y=Math.round(h/l*100),u=(Math.round(y/1)*1).toString();a.daysByWolfRatio[u]||(a.daysByWolfRatio[u]={totalDays:0,count:0,average:"0"}),a.daysByWolfRatio[u].totalDays+=s,a.daysByWolfRatio[u].count++}}}),t>0&&(a.averageDays=(r/t).toFixed(1),Object.keys(a.daysByWinnerCamp).forEach(i=>{const s=a.daysByWinnerCamp[i];s.count>0&&(s.average=(s.totalDays/s.count).toFixed(1))}),Object.keys(a.daysByPlayerCount).forEach(i=>{const s=a.daysByPlayerCount[i];s.count>0&&(s.average=(s.totalDays/s.count).toFixed(1))}),Object.keys(a.daysByWolfRatio).forEach(i=>{const s=a.daysByWolfRatio[i];s.count>0&&(s.average=(s.totalDays/s.count).toFixed(1))}));const o=Object.keys(a.dayDistribution).map(i=>({days:parseInt(i),count:a.dayDistribution[parseInt(i)]}));return o.sort((i,s)=>i.days-s.days),{averageDays:a.averageDays,maxDays:a.maxDays,minDays:a.minDays,dayDistribution:o,daysByWinnerCamp:a.daysByWinnerCamp,daysByPlayerCount:a.daysByPlayerCount,daysByWolfRatio:a.daysByWolfRatio}},[n]),fetchingData:m,apiError:c}}function S(){const{durationAnalysis:n,fetchingData:m,apiError:c}=k();if(m)return e.jsx("div",{className:"statistiques-attente",children:"Analyse des durées de partie en cours..."});if(c)return e.jsxs("div",{className:"statistiques-echec",children:["Problème rencontré: ",c]});if(!n)return e.jsx("div",{className:"statistiques-indisponibles",children:"Données d'analyse non disponibles"});const g=n?Object.entries(n.daysByWolfRatio).map(([r,t])=>({ratio:parseFloat(r),moyenne:parseFloat(t.average),parties:t.count})).sort((r,t)=>r.ratio-t.ratio):[],a=n?Object.entries(n.daysByWinnerCamp).map(([r,t])=>({camp:r,moyenne:parseFloat(t.average),parties:t.count})).sort((r,t)=>t.moyenne-r.moyenne):[];return e.jsxs("div",{className:"lycans-duree-analyse",children:[e.jsx("h2",{children:"Analyse des Durées de Partie"}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Moyenne"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[n.averageDays," jours"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Minimum"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[n.minDays," jours"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Maximum"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[n.maxDays," jours"]})]})]}),e.jsxs("div",{className:"lycans-graphiques-section",children:[e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Distribution des Durées de Partie"}),e.jsx(p,{title:"Distribution des Durées de Partie",children:e.jsx("div",{style:{height:300},children:e.jsx(x,{width:"100%",height:"100%",children:e.jsxs(b,{data:n?.dayDistribution||[],margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(j,{strokeDasharray:"3 3"}),e.jsx(D,{dataKey:"days",label:{value:"Nombre de Jours",position:"insideBottom",offset:-5}}),e.jsx(f,{label:{value:"Nombre de Parties",angle:-90,position:"insideLeft"}}),e.jsx(v,{content:({active:r,payload:t})=>{if(r&&t&&t.length>0){const o=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsxs("strong",{children:[o.days," jours"]})}),e.jsxs("div",{children:[o.count," parties"]})]})}return null}}),e.jsx(C,{dataKey:"count",name:"Nombre de Parties",fill:"var(--chart-color-2)"})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Durée Moyenne par Ratio Loups/Joueurs"}),e.jsx(p,{title:"Durée Moyenne par Ratio Loups/Joueurs",children:e.jsx("div",{style:{height:300},children:e.jsx(x,{width:"100%",height:"100%",children:e.jsxs(A,{data:g,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(j,{strokeDasharray:"3 3"}),e.jsx(D,{dataKey:"ratio",type:"number",domain:["auto","auto"],allowDecimals:!1,tickFormatter:r=>`${r}%`,label:{value:"Ratio Loups/Joueurs (%)",position:"insideBottom",offset:-5}}),e.jsx(f,{label:{value:"Durée Moyenne (jours)",angle:-90,position:"insideLeft"}}),e.jsx(v,{content:({active:r,payload:t})=>{if(r&&t&&t.length>0){const o=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Pourcentage de loups : ",o.ratio]})}),e.jsxs("div",{children:["Durée moyenne : ",o.moyenne," jours"]}),e.jsxs("div",{children:["Nombre de parties : ",o.parties]})]})}return null}}),e.jsx(M,{}),e.jsx(F,{type:"monotone",dataKey:"moyenne",name:"Durée Moyenne",stroke:"var(--chart-color-5)",activeDot:{r:8}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Durée Moyenne par Camp Victorieux"}),e.jsx(p,{title:"Durée Moyenne par Camp Victorieux",children:e.jsx("div",{style:{height:300},children:e.jsx(x,{width:"100%",height:"100%",children:e.jsxs(b,{data:a,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(j,{strokeDasharray:"3 3"}),e.jsx(D,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(f,{label:{value:"Durée Moyenne (jours)",angle:-90,position:"insideLeft"}}),e.jsx(v,{content:({active:r,payload:t})=>{if(r&&t&&t.length>0){const o=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:o.camp})}),e.jsxs("div",{children:["Durée moyenne : ",o.moyenne," jours"]}),e.jsxs("div",{children:["Nombre de parties : ",o.parties]})]})}return null}}),e.jsxs(C,{dataKey:"moyenne",name:"moyenne",isAnimationActive:!1,children:[a.map(r=>e.jsx(R,{fill:W[r.camp]||P},`cell-${r.camp}`)),e.jsx(L,{dataKey:"moyenne",position:"top",formatter:r=>{const t=typeof r=="number"?r:Number(r);return isNaN(t)?"":`${t.toFixed(1)}j`},fill:"var(--text-primary)",fontSize:12})]})]})})})})]})]})]})}export{S as GameDurationInsights};
