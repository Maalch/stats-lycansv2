import{u as b,r as y,j as s}from"./index-HxiczrQZ.js";import{b as D,s as x,e as G,a as N,u as P}from"./baseStatsHook-BiaqIAYl.js";import{p as w}from"./api-beq3FXpM.js";import{F as A,B as E,C as T,X as z,Y as k,a as F,b as $}from"./FullscreenChart-CGeb12zj.js";import{R as B,T as M}from"./CategoricalChart-GZJgZmRQ.js";function R(e){const n=new Set;return e.forEach(l=>{const r=l["Liste des joueurs"];r&&x(r.toString()).forEach(i=>{n.add(i.trim())})}),n}function q(e){const n={};return e.forEach(l=>{n[l]={currentVillageoisSeries:0,currentLoupsSeries:0,longestVillageoisSeries:null,longestLoupsSeries:null,currentWinSeries:0,longestWinSeries:null,currentWinCamps:[],lastCamp:null,lastWon:!1,villageoisSeriesStart:null,loupsSeriesStart:null,winSeriesStart:null}}),n}function O(e,n,l,r,i){l==="Villageois"||l==="Loups"?(l==="Villageois"&&(e.lastCamp==="Villageois"?e.currentVillageoisSeries++:(e.currentVillageoisSeries=1,e.villageoisSeriesStart={game:r,date:i}),(!e.longestVillageoisSeries||e.currentVillageoisSeries>e.longestVillageoisSeries.seriesLength)&&(e.longestVillageoisSeries={player:n,camp:"Villageois",seriesLength:e.currentVillageoisSeries,startGame:e.villageoisSeriesStart?.game||r,endGame:r,startDate:e.villageoisSeriesStart?.date||i,endDate:i}),e.currentLoupsSeries=0,e.loupsSeriesStart=null),l==="Loups"&&(e.lastCamp==="Loups"?e.currentLoupsSeries++:(e.currentLoupsSeries=1,e.loupsSeriesStart={game:r,date:i}),(!e.longestLoupsSeries||e.currentLoupsSeries>e.longestLoupsSeries.seriesLength)&&(e.longestLoupsSeries={player:n,camp:"Loups",seriesLength:e.currentLoupsSeries,startGame:e.loupsSeriesStart?.game||r,endGame:r,startDate:e.loupsSeriesStart?.date||i,endDate:i}),e.currentVillageoisSeries=0,e.villageoisSeriesStart=null),e.lastCamp=l):(e.currentVillageoisSeries=0,e.currentLoupsSeries=0,e.villageoisSeriesStart=null,e.loupsSeriesStart=null,e.lastCamp="Autres")}function J(e,n,l,r,i,o){if(l){if(e.lastWon?(e.currentWinSeries++,e.currentWinCamps.push(r)):(e.currentWinSeries=1,e.currentWinCamps=[r],e.winSeriesStart={game:i,date:o}),!e.longestWinSeries||e.currentWinSeries>e.longestWinSeries.seriesLength){const h={};e.currentWinCamps.forEach(u=>{h[u]=(h[u]||0)+1}),e.longestWinSeries={player:n,seriesLength:e.currentWinSeries,startGame:e.winSeriesStart?.game||i,endGame:i,startDate:e.winSeriesStart?.date||o,endDate:o,campCounts:h}}e.lastWon=!0}else e.currentWinSeries=0,e.currentWinCamps=[],e.winSeriesStart=null,e.lastWon=!1}function K(e){const n=[],l=[],r=[];return Object.values(e).forEach(i=>{i.longestVillageoisSeries&&n.push(i.longestVillageoisSeries),i.longestLoupsSeries&&l.push(i.longestLoupsSeries),i.longestWinSeries&&r.push(i.longestWinSeries)}),n.sort((i,o)=>o.seriesLength-i.seriesLength),l.sort((i,o)=>o.seriesLength-i.seriesLength),r.sort((i,o)=>o.seriesLength-i.seriesLength),{longestVillageoisSeries:n.slice(0,10),longestLoupsSeries:l.slice(0,10),longestWinSeries:r.slice(0,10)}}function X(e,n){const l=[],r=[],i=[];Object.values(e).forEach(t=>{l.push(t.longestVillageoisSeries?.seriesLength||0),r.push(t.longestLoupsSeries?.seriesLength||0),i.push(t.longestWinSeries?.seriesLength||0)});const o=n>0?l.reduce((t,c)=>t+c,0)/n:0,h=n>0?r.reduce((t,c)=>t+c,0)/n:0,u=n>0?i.reduce((t,c)=>t+c,0)/n:0,m=l.filter(t=>t>=5).length,v=r.filter(t=>t>=3).length,g=i.filter(t=>t>=5).length;return{averageVillageoisSeries:Math.round(o*10)/10,averageLoupsSeries:Math.round(h*10)/10,averageWinSeries:Math.round(u*10)/10,eliteVillageoisCount:m,eliteLoupsCount:v,eliteWinCount:g}}function Y(e,n){if(e.length===0||n.length===0)return null;const l=D(n),r=[...e].sort((g,t)=>(g.Game||0)-(t.Game||0)),i=R(r),o=q(i);r.forEach(g=>{const t=g.Game?.toString(),c=g["Liste des joueurs"],d=g["Liste des gagnants"],a=g.Date?.toString()||"";if(!t||!c)return;const f=x(c.toString()),S=parseInt(t);f.forEach(L=>{const p=L.trim();if(!p)return;const j=o[p],C=G(l,t,p),V=N(p,d?.toString()),W=l[t]&&l[t][p]||"Villageois";O(j,p,C,S,a),J(j,p,V,W,S,a)})});const{longestVillageoisSeries:h,longestLoupsSeries:u,longestWinSeries:m}=K(o),v=X(o,i.size);return{longestVillageoisSeries:h,longestLoupsSeries:u,longestWinSeries:m,totalGamesAnalyzed:r.length,totalPlayersCount:i.size,...v}}function U(){const{data:e,isLoading:n,error:l}=P((r,i)=>Y(r,i));return{data:e,isLoading:n,error:l}}function ee(){const{data:e,isLoading:n,error:l}=U(),{navigateToGameDetails:r}=b(),[i,o]=y.useState("villageois");if(n)return s.jsx("div",{className:"donnees-attente",children:"R√©cup√©ration des s√©ries de joueurs..."});if(l)return s.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",l]});if(!e)return s.jsx("div",{className:"donnees-manquantes",children:"Aucune donn√©e de s√©rie disponible"});const u=(()=>{switch(i){case"villageois":return e.longestVillageoisSeries.slice(0,15);case"loups":return e.longestLoupsSeries.slice(0,15);case"wins":return e.longestWinSeries.slice(0,15);default:return[]}})(),m=c=>Object.entries(c).map(([d,a])=>`${d} (${a})`).join(", "),v=()=>{switch(i){case"villageois":return"Plus Longues S√©ries Villageois Cons√©cutives";case"loups":return"Plus Longues S√©ries Loups Cons√©cutives";case"wins":return"Plus Longues S√©ries de Victoires";default:return""}},g=({active:c,payload:d})=>{if(!c||!d||d.length===0)return null;const a=d[0].payload;return i==="wins"?s.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[s.jsx("div",{children:s.jsx("strong",{children:a.player})}),s.jsxs("div",{children:["S√©rie de victoires : ",a.seriesLength," parties"]}),s.jsxs("div",{children:["Du jeu #",a.startGame," au jeu #",a.endGame]}),s.jsxs("div",{children:["Du ",a.startDate," au ",a.endDate]}),s.jsxs("div",{children:["Camps jou√©s : ",m(a.campCounts)]}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]}):s.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:12,borderRadius:6,border:"1px solid var(--border-color)"},children:[s.jsx("div",{children:s.jsx("strong",{children:a.player})}),s.jsxs("div",{children:["S√©rie ",a.camp," : ",a.seriesLength," parties cons√©cutives"]}),s.jsxs("div",{children:["Du jeu #",a.startGame," au jeu #",a.endGame]}),s.jsxs("div",{children:["Du ",a.startDate," au ",a.endDate]}),s.jsx("div",{style:{fontSize:"0.8rem",color:"var(--accent-primary)",marginTop:"0.5rem",fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"üñ±Ô∏è Cliquez pour voir les parties"})]})},t=c=>{if(i==="wins")r({selectedPlayer:c.player,fromComponent:"S√©ries de Victoires"});else{const d=i==="villageois"?"Villageois":"Loups";r({selectedPlayer:c.player,selectedCamp:d,fromComponent:`S√©ries ${d}`})}};return s.jsxs("div",{className:"lycans-players-series",children:[s.jsx("h2",{children:"S√©ries des Joueurs"}),s.jsxs("p",{className:"lycans-stats-info",children:["Bas√© sur ",e.totalGamesAnalyzed," parties analys√©es"]}),s.jsx("div",{className:"lycans-section-description",children:s.jsxs("p",{children:[s.jsx("strong",{children:"S√©ries de camps :"})," Parties cons√©cutives dans le m√™me camp principal (Villageois ou Loups). Jouer dans un autre camp (r√¥les sp√©ciaux) brise la s√©rie.",s.jsx("br",{}),s.jsx("strong",{children:"S√©ries de victoires :"})," Victoires cons√©cutives dans n'importe quel camp. Une d√©faite brise la s√©rie."]})}),s.jsxs("div",{className:"lycans-categories-selection",children:[s.jsx("button",{className:`lycans-categorie-btn ${i==="villageois"?"active":""}`,onClick:()=>o("villageois"),children:"S√©ries Villageois"}),s.jsx("button",{className:`lycans-categorie-btn ${i==="loups"?"active":""}`,onClick:()=>o("loups"),children:"S√©ries Loups"}),s.jsx("button",{className:`lycans-categorie-btn ${i==="wins"?"active":""}`,onClick:()=>o("wins"),children:"S√©ries de Victoires"})]}),s.jsxs("div",{className:"lycans-graphique-section",children:[s.jsx(A,{title:v(),children:s.jsx("div",{style:{height:500},children:s.jsx(B,{width:"100%",height:"100%",children:s.jsxs(E,{data:u,margin:{top:20,right:30,left:20,bottom:10},children:[s.jsx(T,{strokeDasharray:"3 3"}),s.jsx(z,{dataKey:"player",angle:-45,textAnchor:"end",height:120,interval:0}),s.jsx(k,{label:{value:i==="wins"?"Victoires cons√©cutives":"Parties cons√©cutives",angle:-90,position:"insideLeft"}}),s.jsx(M,{content:g}),s.jsx(F,{dataKey:"seriesLength",name:i==="wins"?"Victoires cons√©cutives":"Parties cons√©cutives",fill:i==="villageois"?"#82ca9d":i==="loups"?"#FF8042":"#8884d8",children:u.map((c,d)=>s.jsx($,{fill:w[c.player]||(i==="villageois"?"#82ca9d":i==="loups"?"#FF8042":"#8884d8"),onClick:()=>t(c),style:{cursor:"pointer"}},`cell-${i}-${d}`))})]})})})}),u.length>0&&s.jsxs("div",{className:"lycans-stats-grid",style:{marginTop:"0rem",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))"},children:[s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"üèÜ Record Absolu"}),s.jsx("div",{className:"lycans-stat-value",children:u[0].seriesLength}),s.jsxs("p",{children:["par ",s.jsx("strong",{children:u[0].player})]}),i==="wins"?s.jsxs("p",{className:"lycans-h2h-description",children:["Camps : ",m(u[0].campCounts||{})]}):s.jsxs("p",{className:"lycans-h2h-description",children:["Camp : ",u[0].camp]})]}),s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"üìä Moyenne (tous les joueurs)"}),s.jsx("div",{className:"lycans-stat-value",children:i==="villageois"?e.averageVillageoisSeries:i==="loups"?e.averageLoupsSeries:e.averageWinSeries}),s.jsx("p",{children:"parties en moyenne"}),s.jsxs("p",{className:"lycans-h2h-description",children:["Bas√© sur ",e.totalPlayersCount," joueurs"]})]}),s.jsxs("div",{className:"lycans-stat-card",children:[s.jsx("h3",{children:"‚≠ê Seuil Elite"}),s.jsx("div",{className:"lycans-stat-value",children:i==="villageois"?e.eliteVillageoisCount:i==="loups"?e.eliteLoupsCount:e.eliteWinCount}),s.jsx("p",{children:"joueurs au niveau elite"}),s.jsx("p",{className:"lycans-h2h-description",children:i==="villageois"?"5+ s√©ries Villageois":i==="loups"?"3+ s√©ries Loups":"5+ s√©ries de victoires"})]})]}),u.length===0&&s.jsxs("div",{className:"lycans-empty-section",children:[s.jsx("h3",{children:"Aucune s√©rie trouv√©e"}),s.jsx("p",{children:"Aucune s√©rie n'a √©t√© trouv√©e pour ce type avec les filtres actuels."})]})]})]})}export{ee as PlayerSeriesChart};
