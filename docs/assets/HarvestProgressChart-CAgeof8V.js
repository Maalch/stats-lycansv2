import{u as x,j as e}from"./index-zDsQQI_Z.js";import{a as p,l as y}from"./api-beq3FXpM.js";import{c as g}from"./baseStatsHook-CP81hRHF.js";import{b as h,F as f,B as j,C as b,X as C,Y as H,a as N}from"./FullscreenChart-Dcn5aLJs.js";import{R as v,T as m}from"./CategoricalChart-DklIzZgO.js";import{P as R,a as D}from"./PieChart-BYNnaCDZ.js";import{L as W}from"./Legend-2YBe2pQs.js";import"./PolarChart-DnMvC-80.js";function P(a){if(a.length===0)return null;const t={averageHarvest:0,averageHarvestPercent:"0",gamesWithHarvest:0,harvestDistribution:{"0-25%":0,"26-50%":0,"51-75%":0,"76-99%":0,"100%":0},harvestByWinner:{}};let o=0,c=0;return a.forEach(i=>{const r=i["Camp victorieux"],s=i.Récolte,n=i["Total récolte"],l=i["Pourcentage de récolte"];s!=null&&!isNaN(s)&&(o+=s),n!=null&&!isNaN(n)&&(c+=n),l!=null&&!isNaN(l)&&(t.gamesWithHarvest++,l<=.25?t.harvestDistribution["0-25%"]++:l<=.5?t.harvestDistribution["26-50%"]++:l<=.75?t.harvestDistribution["51-75%"]++:l<=.99?t.harvestDistribution["76-99%"]++:t.harvestDistribution["100%"]++,r&&r.trim()!==""&&(t.harvestByWinner[r]||(t.harvestByWinner[r]={totalPercent:0,count:0,average:"0"}),t.harvestByWinner[r].totalPercent+=l,t.harvestByWinner[r].count++))}),t.gamesWithHarvest>0&&(c>0&&(t.averageHarvestPercent=(o/c*100).toFixed(2)),t.averageHarvest=parseFloat((o/t.gamesWithHarvest).toFixed(2)),Object.keys(t.harvestByWinner).forEach(i=>{const r=t.harvestByWinner[i];r.count>0&&(r.average=(r.totalPercent/r.count*100).toFixed(2))})),{averageHarvest:t.averageHarvest,averageHarvestPercent:t.averageHarvestPercent,gamesWithHarvest:t.gamesWithHarvest,harvestDistribution:t.harvestDistribution,harvestByWinner:t.harvestByWinner}}function B(){const{data:a,isLoading:t,error:o}=g(P);return{harvestStats:a,isLoading:t,errorInfo:o}}const u=["#d32f2f","#f57c00","#fbc02d","#388e3c","#1976d2"];function z(){const{harvestStats:a,isLoading:t,errorInfo:o}=B(),{navigateToGameDetails:c}=x();if(t)return e.jsx("div",{className:"donnees-chargement",children:"Récupération des données de récolte..."});if(o)return e.jsxs("div",{className:"donnees-erreur",children:["Problème: ",o]});if(!a)return e.jsx("div",{className:"donnees-absentes",children:"Données de récolte non disponibles"});const d=a?[{nom:"0-25%",valeur:a.harvestDistribution["0-25%"]},{nom:"26-50%",valeur:a.harvestDistribution["26-50%"]},{nom:"51-75%",valeur:a.harvestDistribution["51-75%"]},{nom:"76-99%",valeur:a.harvestDistribution["76-99%"]},{nom:"100%",valeur:a.harvestDistribution["100%"]}]:[],i=a?Object.entries(a.harvestByWinner).map(([r,s])=>({camp:r,moyenne:parseFloat(s.average)})).sort((r,s)=>s.moyenne-r.moyenne):[];return e.jsxs("div",{className:"lycans-recolte-stats",children:[e.jsx("h2",{children:"Statistiques de Récolte"}),e.jsxs("div",{className:"lycans-recolte-sommaire",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Moyenne de Récolte"}),e.jsxs("p",{className:"lycans-nombre-grand",children:[a.averageHarvestPercent,"%"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Nombre total de parties"}),e.jsx("p",{className:"lycans-nombre-grand",children:a.gamesWithHarvest})]})]}),e.jsxs("div",{className:"lycans-graphiques-conteneur",children:[e.jsxs("div",{className:"lycans-graphique-moitie",children:[e.jsx("h3",{children:"Distribution des Récoltes"}),e.jsx("div",{style:{height:300},children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(R,{children:[e.jsx(D,{data:d,cx:"50%",cy:"50%",labelLine:!0,label:({nom:r,percent:s})=>`${r}: ${((s??0)*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"valeur",nameKey:"nom",onClick:r=>{r&&r.nom&&c({selectedHarvestRange:r.nom,fromComponent:"Distribution des Récoltes"})},style:{cursor:"pointer"},children:d.map((r,s)=>e.jsx(h,{fill:u[s%u.length]},`cellule-${s}`))}),e.jsx(m,{content:({active:r,payload:s})=>{if(r&&s&&s.length>0){const n=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:n.nom})}),e.jsxs("div",{children:["Nombre de parties : ",n.valeur]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(W,{})]})})})]}),e.jsxs("div",{className:"lycans-graphique-moitie",children:[e.jsx("h3",{children:"Moyenne de Récolte au Moment de la Victoire"}),e.jsx(f,{title:"Moyenne de Récolte au Moment de la Victoire",children:e.jsx("div",{style:{height:300},children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(j,{data:i,margin:{top:20,right:30,left:20,bottom:70},children:[e.jsx(b,{strokeDasharray:"3 3"}),e.jsx(C,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(H,{label:{value:"Moyenne de Récolte (%)",angle:-90,position:"insideLeft"}}),e.jsx(m,{content:({active:r,payload:s})=>{if(r&&s&&s.length>0){const n=s[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:4},children:n.camp}),e.jsxs("div",{children:["Moyenne de Récolte : ",n.moyenne,"%"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(N,{dataKey:"moyenne",name:"Moyenne de Récolte",onClick:r=>{r&&r.camp&&c({selectedCamp:r.camp,campFilterMode:"wins-only",fromComponent:"Moyenne de Récolte par Camp"})},style:{cursor:"pointer"},children:i.map(r=>e.jsx(h,{fill:p[r.camp]||y},`cell-${r.camp}`))})]})})})})]})]})]})}export{z as HarvestProgressChart};
