import{e as Z,a as _,u as ee,r as c,j as e}from"./index-CD-xwQSo.js";import{c as se,d as N,g as I,p as ae,C as le,f as ne,a as ie}from"./ClipViewer-qribfniQ.js";function re(){const{data:w,isLoading:B,error:R}=Z(),{settings:S}=_(),{navigationFilters:V}=ee(),[m,C]=c.useState(null),[u,D]=c.useState(""),[g,F]=c.useState([]),[x,T]=c.useState(""),[f,z]=c.useState("gameNumber"),[b,M]=c.useState("desc"),[n,o]=c.useState(1),[v,U]=c.useState(25);c.useEffect(()=>{const s=V.selectedPlayer||S.highlightedPlayer;s&&T(s)},[V.selectedPlayer,S.highlightedPlayer]);const t=c.useMemo(()=>{if(!w)return[];const s=[];return w.forEach(a=>{a.Clips&&Array.isArray(a.Clips)&&a.Clips.forEach(l=>{s.push({...l,gameId:a.DisplayedId||a.Id,gameDate:a.StartDate,gameNumber:parseInt(a.DisplayedId||a.Id,10)})})}),s},[w]),O=c.useMemo(()=>se(t).filter(a=>!a.toLowerCase().includes("warning")),[t]),$=c.useMemo(()=>{const s=new Set;return t.forEach(a=>{N(a).forEach(l=>s.add(l))}),Array.from(s).sort()},[t]),d=c.useMemo(()=>{let s=[...t];if(g.length>0&&(s=s.filter(a=>g.some(l=>(a.Tags||[]).some(p=>p.toLowerCase()===l.toLowerCase())))),x&&(s=s.filter(a=>N(a).some(l=>l.toLowerCase()===x.toLowerCase()))),u.trim()){const a=u.toLowerCase();s=s.filter(l=>{const i=I(l).toLowerCase(),p=l.AdditionalInfo?.toLowerCase()||"",E=l.ClipName?.toLowerCase()||"",X=N(l).join(" ").toLowerCase(),Y=l.gameId.toLowerCase();return i.includes(a)||p.includes(a)||E.includes(a)||X.includes(a)||Y.includes(a)})}return s.sort((a,l)=>{let i=0;switch(f){case"gameNumber":i=a.gameNumber-l.gameNumber;break;case"date":i=new Date(a.gameDate).getTime()-new Date(l.gameDate).getTime();break;case"name":i=I(a).localeCompare(I(l));break;case"pov":i=a.POVPlayer.localeCompare(l.POVPlayer);break;case"players":const p=N(a).length,E=N(l).length;i=p-E;break;default:i=0}return b==="asc"?i:-i}),s},[t,g,x,u,f,b]),r=Math.ceil(d.length/v),P=(n-1)*v,L=P+v,k=d.slice(P,L),G=s=>{F(a=>a.includes(s)?a.filter(l=>l!==s):[...a,s]),o(1)},q=()=>{D(""),F([]),T(""),o(1)},J=s=>{C(s)},W=()=>{if(!m)return;const s=k.findIndex(a=>a.ClipId===m.ClipId);s<k.length-1&&C(k[s+1])},H=s=>{const a=t.find(l=>l.ClipId===s);a&&C(a)},j=s=>{f===s?M(b==="asc"?"desc":"asc"):(z(s),M("desc")),o(1)},y=s=>f!==s?"â†•ï¸":b==="asc"?"â†—ï¸":"â†˜ï¸",h=s=>{o(s)},K=s=>{U(s),o(1)},Q=s=>new Date(s).toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit",year:"numeric"});if(!S.clipsEnabled)return e.jsx("div",{className:"lycans-clips-page",children:e.jsxs("div",{className:"lycans-clips-disabled",children:[e.jsx("div",{className:"lycans-clips-disabled-icon",children:"ðŸŽ¬"}),e.jsx("h2",{children:"Clips dÃ©sactivÃ©s"}),e.jsx("p",{children:"Cette fonctionnalitÃ© est actuellement dÃ©sactivÃ©e."}),e.jsxs("p",{children:["Ajoutez ",e.jsx("code",{children:"?clipsEnabled=true"})," Ã  l'URL pour l'activer."]})]})});if(B)return e.jsx("div",{className:"lycans-clips-page",children:e.jsxs("div",{className:"lycans-clips-loading",children:[e.jsx("div",{className:"loading-spinner"}),e.jsx("p",{children:"Chargement des clips..."})]})});if(R)return e.jsx("div",{className:"lycans-clips-page",children:e.jsx("div",{className:"lycans-clips-error",children:e.jsxs("p",{children:["Erreur lors du chargement des clips : ",R]})})});if(t.length===0)return e.jsx("div",{className:"lycans-clips-page",children:e.jsxs("div",{className:"lycans-clips-empty",children:[e.jsx("div",{className:"lycans-clips-empty-icon",children:"ðŸŽ¬"}),e.jsx("h2",{children:"Aucun clip disponible"}),e.jsx("p",{children:"Il n'y a actuellement aucun clip enregistrÃ© dans les parties."})]})});const A=u.trim()||g.length>0||x;return e.jsxs("div",{className:"lycans-clips-page",children:[e.jsx("div",{className:"lycans-clips-header",children:e.jsxs("div",{className:"lycans-clips-header-info",children:[e.jsx("h2",{children:"ðŸŽ¬ BibliothÃ¨que de Clips"}),e.jsxs("p",{className:"lycans-clips-count",children:[d.length," clip",d.length!==1?"s":"",A&&` sur ${t.length}`]})]})}),e.jsxs("div",{className:"lycans-clips-filters",children:[e.jsxs("div",{className:"lycans-clips-search",children:[e.jsx("input",{type:"text",placeholder:"Rechercher par nom, description, joueur, partie...",value:u,onChange:s=>{D(s.target.value),o(1)},className:"lycans-clips-search-input"}),u&&e.jsx("button",{className:"lycans-clips-search-clear",onClick:()=>{D(""),o(1)},title:"Effacer la recherche",children:"âœ•"})]}),e.jsxs("div",{className:"lycans-clips-filter-controls",children:[e.jsxs("div",{className:"lycans-clips-filter-group",children:[e.jsx("label",{htmlFor:"player-filter",children:"Joueur POV :"}),e.jsxs("select",{id:"player-filter",value:x,onChange:s=>{T(s.target.value),o(1)},className:"lycans-clips-select",children:[e.jsx("option",{value:"",children:"Tous les joueurs"}),$.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),A&&e.jsx("button",{className:"lycans-clips-clear-filters",onClick:q,children:"âœ• RÃ©initialiser les filtres"})]}),O.length>0&&e.jsxs("div",{className:"lycans-clips-tags-filter",children:[e.jsx("label",{children:"CatÃ©gories :"}),e.jsx("div",{className:"lycans-clips-tags-list",children:O.map(s=>e.jsxs("button",{className:`lycans-clips-tag-btn ${g.includes(s)?"active":""}`,onClick:()=>G(s),children:[s,g.includes(s)&&e.jsx("span",{className:"tag-check",children:"âœ“"})]},s))})]})]}),d.length===0?e.jsxs("div",{className:"lycans-clips-no-results",children:[e.jsx("div",{className:"lycans-clips-no-results-icon",children:"ðŸ”"}),e.jsx("h3",{children:"Aucun clip trouvÃ©"}),e.jsx("p",{children:"Essayez de modifier vos filtres de recherche."}),A&&e.jsx("button",{className:"lycans-clips-clear-filters-btn",onClick:q,children:"RÃ©initialiser les filtres"})]}):e.jsxs(e.Fragment,{children:[r>1&&e.jsxs("div",{className:"lycans-pagination-container",children:[e.jsxs("div",{className:"lycans-pagination-info",children:["Affichage de ",P+1," Ã  ",Math.min(L,d.length)," sur ",d.length," clips"]}),e.jsxs("div",{className:"lycans-pagination-controls",children:[e.jsxs("select",{value:v,onChange:s=>K(Number(s.target.value)),className:"lycans-pagination-select",children:[e.jsx("option",{value:10,children:"10 par page"}),e.jsx("option",{value:25,children:"25 par page"}),e.jsx("option",{value:50,children:"50 par page"}),e.jsx("option",{value:100,children:"100 par page"})]}),e.jsxs("div",{className:"lycans-pagination-buttons",children:[e.jsx("button",{onClick:()=>h(1),disabled:n===1,className:"lycans-pagination-btn",children:"Â«Â«"}),e.jsx("button",{onClick:()=>h(n-1),disabled:n===1,className:"lycans-pagination-btn",children:"â€¹"}),e.jsxs("span",{className:"lycans-pagination-current",children:["Page ",n," sur ",r]}),e.jsx("button",{onClick:()=>h(n+1),disabled:n===r,className:"lycans-pagination-btn",children:"â€º"}),e.jsx("button",{onClick:()=>h(r),disabled:n===r,className:"lycans-pagination-btn",children:"Â»Â»"})]})]})]}),e.jsx("div",{className:"lycans-clips-table-container",children:e.jsxs("table",{className:"lycans-clips-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsxs("th",{onClick:()=>j("gameNumber"),className:"sortable",children:["Partie ",y("gameNumber")]}),e.jsxs("th",{onClick:()=>j("date"),className:"sortable",children:["Date ",y("date")]}),e.jsxs("th",{onClick:()=>j("name"),className:"sortable",children:["Nom ",y("name")]}),e.jsxs("th",{onClick:()=>j("pov"),className:"sortable",children:["POV ",y("pov")]}),e.jsxs("th",{onClick:()=>j("players"),className:"sortable",children:["Personnes impliquÃ©es ",y("players")]}),e.jsx("th",{children:"Tags"}),e.jsx("th",{children:"Voir"})]})}),e.jsx("tbody",{children:k.map(s=>{const a=ae(s.OthersPlayers),l=(s.Tags||[]).filter(i=>!i.toLowerCase().includes("warning"));return e.jsxs("tr",{children:[e.jsxs("td",{children:["#",s.gameId]}),e.jsx("td",{children:Q(s.gameDate)}),e.jsx("td",{className:"lycans-clip-name-cell",children:I(s)}),e.jsx("td",{children:e.jsx("span",{className:"lycans-clip-pov-badge",children:s.POVPlayer})}),e.jsx("td",{className:"lycans-clip-players-cell",children:a.length>0?a.join(", "):"-"}),e.jsx("td",{className:"lycans-clip-tags-cell",children:l.length>0?e.jsx("div",{className:"lycans-clip-tags-inline",children:l.map((i,p)=>e.jsx("span",{className:"lycans-clip-tag-small",children:i},p))}):"-"}),e.jsx("td",{children:e.jsx("button",{onClick:()=>J(s),className:"lycans-clip-view-btn",children:"ðŸŽ¬ Voir"})})]},s.ClipId)})})]})}),r>1&&e.jsxs("div",{className:"lycans-pagination-container",children:[e.jsxs("div",{className:"lycans-pagination-info",children:["Affichage de ",P+1," Ã  ",Math.min(L,d.length)," sur ",d.length," clips"]}),e.jsx("div",{className:"lycans-pagination-controls",children:e.jsxs("div",{className:"lycans-pagination-buttons",children:[e.jsx("button",{onClick:()=>h(1),disabled:n===1,className:"lycans-pagination-btn",children:"Â«Â«"}),e.jsx("button",{onClick:()=>h(n-1),disabled:n===1,className:"lycans-pagination-btn",children:"â€¹"}),e.jsxs("span",{className:"lycans-pagination-current",children:["Page ",n," sur ",r]}),e.jsx("button",{onClick:()=>h(n+1),disabled:n===r,className:"lycans-pagination-btn",children:"â€º"}),e.jsx("button",{onClick:()=>h(r),disabled:n===r,className:"lycans-pagination-btn",children:"Â»Â»"})]})})]})]}),m&&e.jsx(le,{clip:m,onClose:()=>C(null),relatedClips:ie(m,t),nextClip:ne(m,t),onNextClip:W,onRelatedClip:H})]})}export{re as ClipsPage};
