import{a as R,r as d,j as e,k as P}from"./index-DYSeRqaa.js";function G(){const{generateUrlWithSettings:n}=R(),[a,p]=d.useState(!1),m=async()=>{const h=n();try{await navigator.clipboard.writeText(h),p(!0),setTimeout(()=>p(!1),2e3)}catch{const r=document.createElement("textarea");r.value=h,document.body.appendChild(r),r.select(),document.execCommand("copy"),document.body.removeChild(r),p(!0),setTimeout(()=>p(!1),2e3)}};return e.jsx("div",{className:"shareable-url-container",children:e.jsx("button",{onClick:m,className:"shareable-url-btn",type:"button",title:"Copier le lien avec les filtres actuels",children:a?"‚úÖ Copi√©!":"üîó Copier le lien"})})}function U(){const{settings:n,updateSettings:a,resetSettings:p}=R(),[m,h]=d.useState(null);d.useEffect(()=>{n.independentFilters||a({useIndependentFilters:!0,independentFilters:{gameTypeEnabled:!1,gameFilter:"all",dateRangeEnabled:!1,dateRange:{start:null,end:null},mapNameEnabled:!1,mapNameFilter:"all",playerFilter:{mode:"none",players:[]}}})},[n,a]),d.useEffect(()=>{(async()=>{try{const l=await(await fetch("/data/gameLog.json")).json();h(l.GameStats||[])}catch(s){console.error("Error fetching game log data:",s)}})()},[]);const f=t=>{if(!t)return null;try{return new Date(t)}catch{return null}},r=d.useMemo(()=>!m||!n.independentFilters?[]:m.filter(t=>{const s=n.independentFilters;if(s.gameTypeEnabled&&s.gameFilter!=="all"&&(s.gameFilter==="modded"&&!t.Modded||s.gameFilter==="non-modded"&&t.Modded))return!1;if(s.dateRangeEnabled&&(s.dateRange.start||s.dateRange.end)){const l=f(t.StartDate);if(!l)return!1;if(s.dateRange.start){const i=new Date(s.dateRange.start);if(l<i)return!1}if(s.dateRange.end){const i=new Date(s.dateRange.end);if(l>i)return!1}}if(s.mapNameEnabled&&s.mapNameFilter!=="all"){const l=t.MapName||"";if(s.mapNameFilter==="village"&&l!=="Village"||s.mapNameFilter==="chateau"&&l!=="Ch√¢teau"||s.mapNameFilter==="others"&&(l==="Village"||l==="Ch√¢teau"))return!1}return!0}),[m,n.independentFilters]),N=d.useMemo(()=>{const t=new Set;return r.forEach(s=>{s.PlayerStats.forEach(l=>{t.add(P(l.Username))})}),Array.from(t).sort()},[r]),b=d.useMemo(()=>{const t={};return r.forEach(s=>{const l=s.PlayerStats.map(i=>P(i.Username));l.forEach(i=>{t[i]||(t[i]=new Set),l.forEach(o=>{i!==o&&t[i].add(o)})})}),t},[r]),{availablePlayers:v,selectablePlayers:u}=d.useMemo(()=>{const t=N;if(!n.independentFilters?.playerFilter||n.independentFilters.playerFilter.mode==="none"||n.independentFilters.playerFilter.players.length===0)return{availablePlayers:t,selectablePlayers:new Set(t)};const s=new Set,l=n.independentFilters.playerFilter;return l.mode==="include"?t.forEach(i=>{(l.players.includes(i)||l.players.every(j=>b[i]?.has(j)||!1))&&s.add(i)}):l.mode==="exclude"&&t.forEach(i=>{(l.players.includes(i)||r.some(j=>{const E=j.PlayerStats.map(y=>y.Username.toLowerCase());return E.includes(i.toLowerCase())?!l.players.some(y=>E.includes(y.toLowerCase())):!1}))&&s.add(i)}),{availablePlayers:t,selectablePlayers:s}},[N,n.independentFilters?.playerFilter,b,r]),k=t=>{n.independentFilters&&a({independentFilters:{...n.independentFilters,gameTypeEnabled:t}})},F=t=>{n.independentFilters&&a({independentFilters:{...n.independentFilters,gameFilter:t}})},S=t=>{n.independentFilters&&a({independentFilters:{...n.independentFilters,dateRangeEnabled:t}})},C=(t,s)=>{n.independentFilters&&a({independentFilters:{...n.independentFilters,dateRange:{...n.independentFilters.dateRange,[t]:s||null}}})},T=t=>{n.independentFilters&&a({independentFilters:{...n.independentFilters,mapNameEnabled:t}})},g=t=>{n.independentFilters&&a({independentFilters:{...n.independentFilters,mapNameFilter:t}})},x=t=>{n.independentFilters&&a({independentFilters:{...n.independentFilters,playerFilter:{...n.independentFilters.playerFilter,mode:t}}})},M=t=>{if(!n.independentFilters)return;const s=n.independentFilters.playerFilter.players;if(s.includes(t)){const i=s.filter(o=>o!==t);a({independentFilters:{...n.independentFilters,playerFilter:{...n.independentFilters.playerFilter,players:i}}})}else a({independentFilters:{...n.independentFilters,playerFilter:{...n.independentFilters.playerFilter,players:[...s,t]}}})},w=()=>{n.independentFilters&&a({independentFilters:{...n.independentFilters,playerFilter:{...n.independentFilters.playerFilter,players:[...u]}}})},D=()=>{n.independentFilters&&a({independentFilters:{...n.independentFilters,playerFilter:{...n.independentFilters.playerFilter,players:[]}}})},A=t=>{a({highlightedPlayer:t||null})},$=()=>{p()},c=d.useMemo(()=>{if(!n.independentFilters)return 0;let t=0;return n.independentFilters.gameTypeEnabled&&n.independentFilters.gameFilter!=="all"&&t++,n.independentFilters.dateRangeEnabled&&(n.independentFilters.dateRange.start||n.independentFilters.dateRange.end)&&t++,n.independentFilters.mapNameEnabled&&n.independentFilters.mapNameFilter!=="all"&&t++,n.independentFilters.playerFilter.mode!=="none"&&n.independentFilters.playerFilter.players.length>0&&t++,t},[n.independentFilters]);return n.independentFilters?e.jsxs("div",{className:"settings-panel",children:[e.jsxs("div",{className:"settings-header",children:[e.jsxs("div",{children:[e.jsx("h3",{children:"Param√®tres de Filtrage"}),c>0&&e.jsxs("p",{style:{margin:"0.5rem 0 0 0",color:"var(--accent-primary)",fontSize:"0.9rem",fontWeight:"500"},children:[c," filtre",c>1?"s":""," actif",c>1?"s":""]})]}),e.jsx("div",{children:e.jsx("button",{onClick:$,className:"settings-reset-btn",type:"button",children:"R√©initialiser"})})]}),e.jsxs("div",{className:"settings-section",children:[e.jsx("div",{className:"settings-section-header",children:e.jsx("h3",{children:"üéØ Joueur √† Mettre en √âvidence"})}),e.jsxs("div",{className:"settings-group",children:[e.jsx("p",{className:"settings-explanation",children:"S√©lectionnez un joueur qui sera toujours affich√© et mis en √©vidence dans tous les graphiques g√©n√©raux, m√™me s'il n'est pas dans le top classement."}),e.jsxs("div",{style:{marginTop:"1rem"},children:[e.jsx("label",{htmlFor:"highlighted-player-select",className:"settings-label",children:"Joueur √† mettre en √©vidence :"}),e.jsxs("select",{id:"highlighted-player-select",value:n.highlightedPlayer||"",onChange:t=>A(t.target.value),className:"settings-select",children:[e.jsx("option",{value:"",children:"Aucun joueur s√©lectionn√©"}),v.map(t=>e.jsx("option",{value:t,children:t},t))]}),n.highlightedPlayer&&e.jsxs("p",{className:"settings-info-text",children:['Le joueur "',n.highlightedPlayer,'" sera mis en √©vidence dans tous les graphiques.']})]})]})]}),e.jsxs("div",{className:"settings-filters-container",children:[e.jsxs("div",{className:`settings-filter-card ${n.independentFilters.gameTypeEnabled?"active":""}`,children:[e.jsxs("div",{className:"settings-filter-header",children:[e.jsxs("label",{className:"settings-toggle",children:[e.jsx("input",{type:"checkbox",checked:n.independentFilters.gameTypeEnabled,onChange:t=>k(t.target.checked)}),e.jsx("span",{className:"toggle-slider"})]}),e.jsx("h4",{children:"üéÆ Filtrer par Type de Partie"}),e.jsx("div",{className:"settings-filter-status",children:n.independentFilters.gameTypeEnabled&&n.independentFilters.gameFilter!=="all"&&e.jsx("span",{className:"filter-active-badge",children:n.independentFilters.gameFilter==="modded"?"Modd√©es":"Non-modd√©es"})})]}),n.independentFilters.gameTypeEnabled&&e.jsx("div",{className:"settings-filter-content",children:e.jsxs("div",{className:"settings-radio-group-inline",children:[e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"all",checked:n.independentFilters.gameFilter==="all",onChange:()=>F("all")}),e.jsx("span",{children:"Toutes"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"modded",checked:n.independentFilters.gameFilter==="modded",onChange:()=>F("modded")}),e.jsx("span",{children:"Modd√©es"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"gameFilter",value:"non-modded",checked:n.independentFilters.gameFilter==="non-modded",onChange:()=>F("non-modded")}),e.jsx("span",{children:"Non-modd√©es"})]})]})})]}),e.jsxs("div",{className:`settings-filter-card ${n.independentFilters.dateRangeEnabled?"active":""}`,children:[e.jsxs("div",{className:"settings-filter-header",children:[e.jsxs("label",{className:"settings-toggle",children:[e.jsx("input",{type:"checkbox",checked:n.independentFilters.dateRangeEnabled,onChange:t=>S(t.target.checked)}),e.jsx("span",{className:"toggle-slider"})]}),e.jsx("h4",{children:"üìÖ Filtrer par P√©riode"}),e.jsx("div",{className:"settings-filter-status",children:n.independentFilters.dateRangeEnabled&&(n.independentFilters.dateRange.start||n.independentFilters.dateRange.end)&&e.jsxs("span",{className:"filter-active-badge",children:[n.independentFilters.dateRange.start||"D√©but"," - ",n.independentFilters.dateRange.end||"Fin"]})})]}),n.independentFilters.dateRangeEnabled&&e.jsxs("div",{className:"settings-filter-content",children:[e.jsxs("div",{className:"settings-date-inputs",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-start",className:"settings-label",children:"Du :"}),e.jsx("input",{id:"date-start",type:"date",value:n.independentFilters.dateRange.start||"",onChange:t=>C("start",t.target.value),className:"settings-input"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date-end",className:"settings-label",children:"Au :"}),e.jsx("input",{id:"date-end",type:"date",value:n.independentFilters.dateRange.end||"",onChange:t=>C("end",t.target.value),className:"settings-input"})]})]}),e.jsx("small",{className:"settings-hint",children:"Laissez vide pour ne pas limiter le d√©but ou la fin de la p√©riode."})]})]}),e.jsxs("div",{className:`settings-filter-card ${n.independentFilters.mapNameEnabled?"active":""}`,children:[e.jsxs("div",{className:"settings-filter-header",children:[e.jsxs("label",{className:"settings-toggle",children:[e.jsx("input",{type:"checkbox",checked:n.independentFilters.mapNameEnabled,onChange:t=>T(t.target.checked)}),e.jsx("span",{className:"toggle-slider"})]}),e.jsx("h4",{children:"üó∫Ô∏è Filtrer par Carte"}),e.jsx("div",{className:"settings-filter-status",children:n.independentFilters.mapNameEnabled&&n.independentFilters.mapNameFilter!=="all"&&e.jsx("span",{className:"filter-active-badge",children:n.independentFilters.mapNameFilter==="village"?"Village":n.independentFilters.mapNameFilter==="chateau"?"Ch√¢teau":"Autres"})})]}),n.independentFilters.mapNameEnabled&&e.jsx("div",{className:"settings-filter-content",children:e.jsxs("div",{className:"settings-radio-group-inline",children:[e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"mapNameFilter",value:"all",checked:n.independentFilters.mapNameFilter==="all",onChange:()=>g("all")}),e.jsx("span",{children:"Toutes"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"mapNameFilter",value:"village",checked:n.independentFilters.mapNameFilter==="village",onChange:()=>g("village")}),e.jsx("span",{children:"Village"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"mapNameFilter",value:"chateau",checked:n.independentFilters.mapNameFilter==="chateau",onChange:()=>g("chateau")}),e.jsx("span",{children:"Ch√¢teau"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"mapNameFilter",value:"others",checked:n.independentFilters.mapNameFilter==="others",onChange:()=>g("others")}),e.jsx("span",{children:"Autres"})]})]})})]}),e.jsxs("div",{className:`settings-filter-card ${n.independentFilters.playerFilter.mode!=="none"?"active":""}`,children:[e.jsxs("div",{className:"settings-filter-header",children:[e.jsxs("label",{className:"settings-toggle",children:[e.jsx("input",{type:"checkbox",checked:n.independentFilters.playerFilter.mode!=="none",onChange:t=>x(t.target.checked?"include":"none")}),e.jsx("span",{className:"toggle-slider"})]}),e.jsx("h4",{children:"üë• Filtrer par Joueurs"}),e.jsx("div",{className:"settings-filter-status",children:n.independentFilters.playerFilter.mode!=="none"&&n.independentFilters.playerFilter.players.length>0&&e.jsxs("span",{className:"filter-active-badge",children:[n.independentFilters.playerFilter.players.length," joueur",n.independentFilters.playerFilter.players.length>1?"s":""]})})]}),n.independentFilters.playerFilter.mode!=="none"&&e.jsxs("div",{className:"settings-filter-content",children:[e.jsxs("div",{className:"settings-radio-group-inline",style:{marginBottom:"1rem"},children:[e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"playerFilterMode",value:"include",checked:n.independentFilters.playerFilter.mode==="include",onChange:()=>x("include")}),e.jsx("span",{children:"Inclure"})]}),e.jsxs("label",{className:"settings-radio-inline",children:[e.jsx("input",{type:"radio",name:"playerFilterMode",value:"exclude",checked:n.independentFilters.playerFilter.mode==="exclude",onChange:()=>x("exclude")}),e.jsx("span",{children:"Exclure"})]})]}),e.jsx("div",{style:{marginBottom:"0.5rem"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("span",{className:"settings-label",children:["Joueurs (",n.independentFilters.playerFilter.players.length," s√©lectionn√©",n.independentFilters.playerFilter.players.length>1?"s":"",") :"]}),e.jsxs("div",{style:{display:"flex",gap:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:w,className:"settings-btn-small",disabled:u.size===0,children:"Tous"}),e.jsx("button",{type:"button",onClick:D,className:"settings-btn-small",disabled:n.independentFilters.playerFilter.players.length===0,children:"Aucun"})]})]})}),e.jsx("div",{className:"settings-player-grid",children:v.map(t=>{const s=n.independentFilters.playerFilter.players.includes(t),l=u.has(t);return e.jsxs("label",{className:`settings-player-option ${s?"selected":""} ${l?"":"disabled"}`,children:[e.jsx("input",{type:"checkbox",checked:s,disabled:!l,onChange:()=>M(t)}),e.jsx("span",{children:t})]},t)})}),e.jsxs("small",{className:"settings-hint",children:["S√©lectionnez les joueurs √† ",n.independentFilters.playerFilter.mode==="include"?"inclure dans":"exclure du"," le filtrage."]})]})]})]}),e.jsx("div",{className:"settings-info",children:e.jsxs("p",{children:[e.jsx("strong",{children:"R√©sum√©:"})," ",r.length," partie",r.length>1?"s":"",c>0?` (avec ${c} filtre${c>1?"s":""} actif${c>1?"s":""})`:" (aucun filtre actif)",n.highlightedPlayer&&` ‚Ä¢ "${n.highlightedPlayer}" mis en √©vidence`]})}),e.jsxs("div",{className:"settings-section",children:[e.jsx("div",{className:"settings-section-header",children:e.jsx("h3",{children:"üîó Partage des Filtres"})}),e.jsxs("div",{className:"settings-group",children:[e.jsx("p",{className:"settings-explanation",children:"Copiez le lien ci-dessous pour partager les filtres actuels avec d'autres personnes. Ils pourront ouvrir le site avec ces m√™mes filtres appliqu√©s."}),e.jsx(G,{})]})]})]}):e.jsx("div",{children:"Chargement des param√®tres..."})}export{U as SettingsPanel};
