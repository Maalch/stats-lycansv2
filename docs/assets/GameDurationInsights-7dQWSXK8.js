import{r as B,u as R,j as e}from"./index-BatqsjNw.js";import{u as W}from"./useRawGameData-DuJAMOIJ.js";import{a as P,l as L}from"./api-beq3FXpM.js";import{F as j,R as f,T as D,U as M}from"./FullscreenChart-C18oaY53.js";import{B as C,C as v,X as g,Y as b,a as N,b as k}from"./BarChart-BBGAOLdG.js";import{L as A,a as F}from"./LineChart-u_fV8X1K.js";import{L as w}from"./Legend-5xCbG__V.js";import"./ActivePoints-DQCKC4zZ.js";function q(){const{data:n,isLoading:p,error:u}=W();return{durationAnalysis:B.useMemo(()=>{if(!n||n.length===0)return null;const a={averageDays:"0",maxDays:0,minDays:99,dayDistribution:{},daysByWinnerCamp:{},daysByPlayerCount:{},daysByWolfRatio:{}};let y=0,s=0;n.forEach(i=>{const r=i["Nombre de journées"],d=i["Camp victorieux"],l=i["Nombre de joueurs"],x=i["Nombre de loups"];if(r&&!isNaN(r)&&r>0){if(s++,y+=r,r>a.maxDays&&(a.maxDays=r),r<a.minDays&&(a.minDays=r),a.dayDistribution[r]||(a.dayDistribution[r]=0),a.dayDistribution[r]++,d&&d.trim()!==""&&(a.daysByWinnerCamp[d]||(a.daysByWinnerCamp[d]={totalDays:0,count:0,average:"0"}),a.daysByWinnerCamp[d].totalDays+=r,a.daysByWinnerCamp[d].count++),l&&!isNaN(l)&&l>0){const c=l.toString();a.daysByPlayerCount[c]||(a.daysByPlayerCount[c]={totalDays:0,count:0,average:"0"}),a.daysByPlayerCount[c].totalDays+=r,a.daysByPlayerCount[c].count++}if(l&&x&&!isNaN(l)&&!isNaN(x)&&l>0){const c=Math.round(x/l*100),m=(Math.round(c/1)*1).toString();a.daysByWolfRatio[m]||(a.daysByWolfRatio[m]={totalDays:0,count:0,average:"0"}),a.daysByWolfRatio[m].totalDays+=r,a.daysByWolfRatio[m].count++}}}),s>0&&(a.averageDays=(y/s).toFixed(1),Object.keys(a.daysByWinnerCamp).forEach(i=>{const r=a.daysByWinnerCamp[i];r.count>0&&(r.average=(r.totalDays/r.count).toFixed(1))}),Object.keys(a.daysByPlayerCount).forEach(i=>{const r=a.daysByPlayerCount[i];r.count>0&&(r.average=(r.totalDays/r.count).toFixed(1))}),Object.keys(a.daysByWolfRatio).forEach(i=>{const r=a.daysByWolfRatio[i];r.count>0&&(r.average=(r.totalDays/r.count).toFixed(1))}));const t=Object.keys(a.dayDistribution).map(i=>({days:parseInt(i),count:a.dayDistribution[parseInt(i)]}));return t.sort((i,r)=>i.days-r.days),{averageDays:a.averageDays,maxDays:a.maxDays,minDays:a.minDays,dayDistribution:t,daysByWinnerCamp:a.daysByWinnerCamp,daysByPlayerCount:a.daysByPlayerCount,daysByWolfRatio:a.daysByWolfRatio}},[n]),fetchingData:p,apiError:u}}function V(){const{durationAnalysis:n,fetchingData:p,apiError:u}=q(),{navigateToGameDetails:h}=R();if(p)return e.jsx("div",{className:"statistiques-attente",children:"Analyse des durées de partie en cours..."});if(u)return e.jsxs("div",{className:"statistiques-echec",children:["Problème rencontré: ",u]});if(!n)return e.jsx("div",{className:"statistiques-indisponibles",children:"Données d'analyse non disponibles"});const a=n?Object.entries(n.daysByWolfRatio).map(([s,t])=>({ratio:parseFloat(s),moyenne:parseFloat(t.average),parties:t.count})).sort((s,t)=>s.ratio-t.ratio):[],y=n?Object.entries(n.daysByWinnerCamp).map(([s,t])=>({camp:s,moyenne:parseFloat(t.average),parties:t.count})).sort((s,t)=>t.moyenne-s.moyenne):[];return e.jsxs("div",{className:"lycans-duree-analyse",children:[e.jsx("h2",{children:"Analyse des Durées de Partie"}),e.jsxs("div",{className:"lycans-resume-conteneur",children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Moyenne"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[n.averageDays," jours"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Minimum"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[n.minDays," jours"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Durée Maximum"}),e.jsxs("p",{className:"lycans-valeur-principale",children:[n.maxDays," jours"]})]})]}),e.jsxs("div",{className:"lycans-graphiques-section",children:[e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Distribution des Durées de Partie"}),e.jsx(j,{title:"Distribution des Durées de Partie",children:e.jsx("div",{style:{height:300},children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(C,{data:n?.dayDistribution||[],margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(g,{dataKey:"days",label:{value:"Nombre de Jours",position:"insideBottom",offset:-5}}),e.jsx(b,{label:{value:"Nombre de Parties",angle:-90,position:"insideLeft"}}),e.jsx(D,{content:({active:s,payload:t})=>{if(s&&t&&t.length>0){const o=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsxs("strong",{children:[o.days," jours"]})}),e.jsxs("div",{children:[o.count," parties"]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsx(N,{dataKey:"count",name:"Nombre de Parties",fill:"var(--chart-color-2)",onClick:s=>{s&&s.days&&h({selectedGameDuration:s.days,fromComponent:"Distribution des Durées de Partie"})},style:{cursor:"pointer"}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Durée Moyenne par Ratio Loups/Joueurs"}),e.jsx(j,{title:"Durée Moyenne par Ratio Loups/Joueurs",children:e.jsx("div",{style:{height:300},children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(A,{data:a,margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(g,{dataKey:"ratio",type:"number",domain:["auto","auto"],allowDecimals:!1,tickFormatter:s=>`${s}%`,label:{value:"Ratio Loups/Joueurs (%)",position:"insideBottom",offset:-5}}),e.jsx(b,{label:{value:"Durée Moyenne (jours)",angle:-90,position:"insideLeft"}}),e.jsx(D,{content:({active:s,payload:t})=>{if(s&&t&&t.length>0){const o=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsxs("strong",{children:["Pourcentage de loups : ",o.ratio]})}),e.jsxs("div",{children:["Durée moyenne : ",o.moyenne," jours"]}),e.jsxs("div",{children:["Nombre de parties : ",o.parties]})]})}return null}}),e.jsx(w,{}),e.jsx(F,{type:"monotone",dataKey:"moyenne",name:"Durée Moyenne",stroke:"var(--chart-color-5)",activeDot:{r:8}})]})})})})]}),e.jsxs("div",{className:"lycans-graphique-element",children:[e.jsx("h3",{children:"Durée Moyenne par Camp Victorieux"}),e.jsx(j,{title:"Durée Moyenne par Camp Victorieux",children:e.jsx("div",{style:{height:300},children:e.jsx(f,{width:"100%",height:"100%",children:e.jsxs(C,{data:y,margin:{top:20,right:30,left:20,bottom:60},children:[e.jsx(v,{strokeDasharray:"3 3"}),e.jsx(g,{dataKey:"camp",angle:-45,textAnchor:"end",height:80,interval:0}),e.jsx(b,{label:{value:"Durée Moyenne (jours)",angle:-90,position:"insideLeft"}}),e.jsx(D,{content:({active:s,payload:t})=>{if(s&&t&&t.length>0){const o=t[0].payload;return e.jsxs("div",{style:{background:"var(--bg-secondary)",color:"var(--text-primary)",padding:8,borderRadius:6},children:[e.jsx("div",{children:e.jsx("strong",{children:o.camp})}),e.jsxs("div",{children:["Durée moyenne : ",o.moyenne," jours"]}),e.jsxs("div",{children:["Nombre de parties : ",o.parties]}),e.jsx("div",{style:{fontSize:"0.8rem",color:"var(--chart-color-1)",marginTop:"0.25rem",fontStyle:"italic"},children:"Cliquez pour voir les parties"})]})}return null}}),e.jsxs(N,{dataKey:"moyenne",name:"moyenne",isAnimationActive:!1,onClick:s=>{s&&s.camp&&h({selectedCamp:s.camp,campFilterMode:"wins-only",fromComponent:"Durée Moyenne par Camp Victorieux"})},style:{cursor:"pointer"},children:[y.map(s=>e.jsx(k,{fill:P[s.camp]||L},`cell-${s.camp}`)),e.jsx(M,{dataKey:"moyenne",position:"top",formatter:s=>{const t=typeof s=="number"?s:Number(s);return isNaN(t)?"":`${t.toFixed(1)}j`},fill:"var(--text-primary)",fontSize:12})]})]})})})})]})]})]})}export{V as GameDurationInsights};
