import{r as z,j as e,u as le,a as pe,i as ce}from"./index-D6mZLxAt.js";import{u as xe,c as ge}from"./useDeathStatisticsFromRaw-DBQUK65F.js";import{D as H}from"./datasyncExport-BirWLS1z.js";import{a as ye,b as ve}from"./api-DoVQVBUp.js";import{F as be,C as je,X as Me,Y as Se}from"./FullscreenChart-CrCRZvAe.js";import{g as ze,c as oe,a as Ee,b as Ce,d as De,S as Re,R as we,e as ke}from"./deathLocationUtils-DqYE_PDf.js";import{g as ee}from"./deathTypes-gHH1w6_X.js";import{aI as Le,aJ as de,aK as se,aL as Ae,aM as K,R as Ne,T as Ie}from"./CategoricalChart-qODt0odR.js";import"./baseStatsHook-Dw23yAEM.js";import"./CartesianScaleHelper-B5QcuZLv.js";const Te=Be(Pe);function Be(t){return function(o,c,n=c){if(!((c=+c)>=0))throw new RangeError("invalid rx");if(!((n=+n)>=0))throw new RangeError("invalid ry");let{data:r,width:i,height:h}=o;if(!((i=Math.floor(i))>=0))throw new RangeError("invalid width");if(!((h=Math.floor(h!==void 0?h:r.length/i))>=0))throw new RangeError("invalid height");if(!i||!h||!c&&!n)return o;const g=c&&t(c),b=n&&t(n),a=r.slice();return g&&b?(U(g,a,r,i,h),U(g,r,a,i,h),U(g,a,r,i,h),O(b,r,a,i,h),O(b,a,r,i,h),O(b,r,a,i,h)):g?(U(g,r,a,i,h),U(g,a,r,i,h),U(g,r,a,i,h)):b&&(O(b,r,a,i,h),O(b,a,r,i,h),O(b,r,a,i,h)),o}}function U(t,o,c,n,r){for(let i=0,h=n*r;i<h;)t(o,c,i,i+=n,1)}function O(t,o,c,n,r){for(let i=0,h=n*r;i<n;++i)t(o,c,i,i+h,n)}function Pe(t){const o=Math.floor(t);if(o===t)return We(t);const c=t-o,n=2*t+1;return(r,i,h,g,b)=>{if(!((g-=b)>=h))return;let a=o*i[h];const f=b*o,u=f+b;for(let d=h,j=h+f;d<j;d+=b)a+=i[Math.min(g,d)];for(let d=h,j=g;d<=j;d+=b)a+=i[Math.min(g,d+f)],r[d]=(a+c*(i[Math.max(h,d-u)]+i[Math.min(g,d+u)]))/n,a-=i[Math.max(h,d-f)]}}function We(t){const o=2*t+1;return(c,n,r,i,h)=>{if(!((i-=h)>=r))return;let g=t*n[r];const b=h*t;for(let a=r,f=r+b;a<f;a+=h)g+=n[Math.min(i,a)];for(let a=r,f=i;a<=f;a+=h)g+=n[Math.min(i,a+b)],c[a]=g/o,g-=n[Math.max(r,a-b)]}}function Fe(t,o){let c=0;for(let n of t)n!=null&&(n=+n)>=n&&++c;return c}function He(t,o){let c,n;if(o===void 0)for(const r of t)r!=null&&(c===void 0?r>=r&&(c=n=r):(c>r&&(c=r),n<r&&(n=r)));else{let r=-1;for(let i of t)(i=o(i,++r,t))!=null&&(c===void 0?i>=i&&(c=n=i):(c>i&&(c=i),n<i&&(n=i)))}return[c,n]}function Ve(t,o,c){let n;for(;;){const r=Le(t,o,c);if(r===n||r===0||!isFinite(r))return[t,o];r>0?(t=Math.floor(t/r)*r,o=Math.ceil(o/r)*r):r<0&&(t=Math.ceil(t*r)/r,o=Math.floor(o*r)/r),n=r}}function Xe(t){return Math.max(1,Math.ceil(Math.log(Fe(t))/Math.LN2)+1)}var qe=Array.prototype,ue=qe.slice;function $e(t,o){return t-o}function Ye(t){for(var o=0,c=t.length,n=t[c-1][1]*t[0][0]-t[c-1][0]*t[0][1];++o<c;)n+=t[o-1][1]*t[o][0]-t[o-1][0]*t[o][1];return n}const Y=t=>()=>t;function Ge(t,o){for(var c=-1,n=o.length,r;++c<n;)if(r=Ue(t,o[c]))return r;return 0}function Ue(t,o){for(var c=o[0],n=o[1],r=-1,i=0,h=t.length,g=h-1;i<h;g=i++){var b=t[i],a=b[0],f=b[1],u=t[g],d=u[0],j=u[1];if(Oe(b,u,o))return 0;f>n!=j>n&&c<(d-a)*(n-f)/(j-f)+a&&(r=-r)}return r}function Oe(t,o,c){var n;return Ze(t,o,c)&&Ke(t[n=+(t[0]===o[0])],c[n],o[n])}function Ze(t,o,c){return(o[0]-t[0])*(c[1]-t[1])===(c[0]-t[0])*(o[1]-t[1])}function Ke(t,o,c){return t<=o&&o<=c||c<=o&&o<=t}function Je(){}var q=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,1.5],[.5,1]],[[1,.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,.5]],[[1.5,1],[1,1.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]];function ae(){var t=1,o=1,c=Xe,n=b;function r(a){var f=c(a);if(Array.isArray(f))f=f.slice().sort($e);else{const u=He(a,Qe);for(f=de(...Ve(u[0],u[1],f),f);f[f.length-1]>=u[1];)f.pop();for(;f[1]<u[0];)f.shift()}return f.map(u=>i(a,u))}function i(a,f){const u=f==null?NaN:+f;if(isNaN(u))throw new Error(`invalid value: ${f}`);var d=[],j=[];return h(a,u,function(p){n(p,a,u),Ye(p)>0?d.push([p]):j.push(p)}),j.forEach(function(p){for(var D=0,y=d.length,m;D<y;++D)if(Ge((m=d[D])[0],p)!==-1){m.push(p);return}}),{type:"MultiPolygon",value:f,coordinates:d}}function h(a,f,u){var d=new Array,j=new Array,p,D,y,m,s,v;for(p=D=-1,m=G(a[0],f),q[m<<1].forEach(l);++p<t-1;)y=m,m=G(a[p+1],f),q[y|m<<1].forEach(l);for(q[m<<0].forEach(l);++D<o-1;){for(p=-1,m=G(a[D*t+t],f),s=G(a[D*t],f),q[m<<1|s<<2].forEach(l);++p<t-1;)y=m,m=G(a[D*t+t+p+1],f),v=s,s=G(a[D*t+p+1],f),q[y|m<<1|s<<2|v<<3].forEach(l);q[m|s<<3].forEach(l)}for(p=-1,s=a[D*t]>=f,q[s<<2].forEach(l);++p<t-1;)v=s,s=G(a[D*t+p+1],f),q[s<<2|v<<3].forEach(l);q[s<<3].forEach(l);function l(M){var E=[M[0][0]+p,M[0][1]+D],R=[M[1][0]+p,M[1][1]+D],C=g(E),A=g(R),S,N;(S=j[C])?(N=d[A])?(delete j[S.end],delete d[N.start],S===N?(S.ring.push(R),u(S.ring)):d[S.start]=j[N.end]={start:S.start,end:N.end,ring:S.ring.concat(N.ring)}):(delete j[S.end],S.ring.push(R),j[S.end=A]=S):(S=d[A])?(N=j[C])?(delete d[S.start],delete j[N.end],S===N?(S.ring.push(R),u(S.ring)):d[N.start]=j[S.end]={start:N.start,end:S.end,ring:N.ring.concat(S.ring)}):(delete d[S.start],S.ring.unshift(E),d[S.start=C]=S):d[C]=j[A]={start:C,end:A,ring:[E,R]}}}function g(a){return a[0]*2+a[1]*(t+1)*4}function b(a,f,u){a.forEach(function(d){var j=d[0],p=d[1],D=j|0,y=p|0,m=te(f[y*t+D]);j>0&&j<t&&D===j&&(d[0]=ie(j,te(f[y*t+D-1]),m,u)),p>0&&p<o&&y===p&&(d[1]=ie(p,te(f[(y-1)*t+D]),m,u))})}return r.contour=i,r.size=function(a){if(!arguments.length)return[t,o];var f=Math.floor(a[0]),u=Math.floor(a[1]);if(!(f>=0&&u>=0))throw new Error("invalid size");return t=f,o=u,r},r.thresholds=function(a){return arguments.length?(c=typeof a=="function"?a:Array.isArray(a)?Y(ue.call(a)):Y(a),r):c},r.smooth=function(a){return arguments.length?(n=a?b:Je,r):n===b},r}function Qe(t){return isFinite(t)?t:NaN}function G(t,o){return t==null?!1:+t>=o}function te(t){return t==null||isNaN(t=+t)?-1/0:t}function ie(t,o,c,n){const r=n-o,i=c-o,h=isFinite(r)||isFinite(i)?r/i:Math.sign(r)/Math.sign(i);return isNaN(h)?t:t+h-.5}function _e(t){return t[0]}function et(t){return t[1]}function tt(){return 1}function fe(){var t=_e,o=et,c=tt,n=960,r=500,i=20,h=2,g=i*3,b=n+g*2>>h,a=r+g*2>>h,f=Y(20);function u(s){var v=new Float32Array(b*a),l=Math.pow(2,-h),M=-1;for(const Z of s){var E=(t(Z,++M,s)+g)*l,R=(o(Z,M,s)+g)*l,C=+c(Z,M,s);if(C&&E>=0&&E<b&&R>=0&&R<a){var A=Math.floor(E),S=Math.floor(R),N=E-A-.5,$=R-S-.5;v[A+S*b]+=(1-N)*(1-$)*C,v[A+1+S*b]+=N*(1-$)*C,v[A+1+(S+1)*b]+=N*$*C,v[A+(S+1)*b]+=(1-N)*$*C}}return Te({data:v,width:b,height:a},i*l),v}function d(s){var v=u(s),l=f(v),M=Math.pow(2,2*h);return Array.isArray(l)||(l=de(Number.MIN_VALUE,se(v)/M,l)),ae().size([b,a]).thresholds(l.map(E=>E*M))(v).map((E,R)=>(E.value=+l[R],j(E)))}d.contours=function(s){var v=u(s),l=ae().size([b,a]),M=Math.pow(2,2*h),E=R=>{R=+R;var C=j(l.contour(v,R*M));return C.value=R,C};return Object.defineProperty(E,"max",{get:()=>se(v)/M}),E};function j(s){return s.coordinates.forEach(p),s}function p(s){s.forEach(D)}function D(s){s.forEach(y)}function y(s){s[0]=s[0]*Math.pow(2,h)-g,s[1]=s[1]*Math.pow(2,h)-g}function m(){return g=i*3,b=n+g*2>>h,a=r+g*2>>h,d}return d.x=function(s){return arguments.length?(t=typeof s=="function"?s:Y(+s),d):t},d.y=function(s){return arguments.length?(o=typeof s=="function"?s:Y(+s),d):o},d.weight=function(s){return arguments.length?(c=typeof s=="function"?s:Y(+s),d):c},d.size=function(s){if(!arguments.length)return[n,r];var v=+s[0],l=+s[1];if(!(v>=0&&l>=0))throw new Error("invalid size");return n=v,r=l,m()},d.cellSize=function(s){if(!arguments.length)return 1<<h;if(!((s=+s)>=1))throw new Error("invalid cell size");return h=Math.floor(Math.log(s)/Math.LN2),m()},d.thresholds=function(s){return arguments.length?(f=typeof s=="function"?s:Array.isArray(s)?Y(ue.call(s)):Y(s),d):f},d.bandwidth=function(s){if(!arguments.length)return Math.sqrt(i*(i+1));if(!((s=+s)>=0))throw new Error("invalid bandwidth");return i=(Math.sqrt(4*s*s+1)-1)/2,m()},d}function rt(t){for(var o=t.length/6|0,c=new Array(o),n=0;n<o;)c[n]="#"+t.slice(n*6,++n*6);return c}const nt=t=>Ae(t[t.length-1]);var ot=new Array(3).concat("ffeda0feb24cf03b20","ffffb2fecc5cfd8d3ce31a1c","ffffb2fecc5cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cf03b20bd0026","ffffb2fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cb10026","ffffccffeda0fed976feb24cfd8d3cfc4e2ae31a1cbd0026800026").map(rt);const me=nt(ot);function st({deathLocations:t,xDomain:o,zDomain:c,width:n=800,height:r=600,bandwidth:i=25,onRegionClick:h,mapConfig:g}){const b=z.useRef(null),a=z.useRef(null),f=z.useRef(null),u=z.useRef(null),[,d]=z.useState(!1),j=z.useMemo(()=>K().domain(c).range([0,n]),[c,n]),p=z.useMemo(()=>K().domain(o).range([r,0]),[o,r]),D=z.useMemo(()=>t.length===0?[]:fe().x(l=>j(l.z)).y(l=>p(l.x)).size([n,r]).bandwidth(i).thresholds(15)(t),[t,p,j,n,r,i]),y=z.useMemo(()=>{const v=D.length>0?Math.max(...D.map(l=>l.value)):1;return l=>{const M=l/v;return me(M)}},[D]);z.useEffect(()=>{const v=f.current;if(!v||!g){d(!1);return}const l=v.getContext("2d");if(!l)return;l.clearRect(0,0,n,r);const M=new Image;M.onload=()=>{l.globalAlpha=.85,l.drawImage(M,0,0,n,r),l.globalAlpha=1,d(!0)},M.onerror=()=>{d(!1)},M.src=g.src},[g,n,r]),z.useEffect(()=>{const v=b.current;if(!v||D.length===0)return;const l=v.getContext("2d");l&&(l.clearRect(0,0,n,r),D.forEach(M=>{l.fillStyle=y(M.value),l.globalAlpha=.6,M.coordinates.forEach(E=>{E.forEach(R=>{l.beginPath(),R.forEach((C,A)=>{A===0?l.moveTo(C[0],C[1]):l.lineTo(C[0],C[1])}),l.closePath(),l.fill()})})}),l.globalAlpha=1)},[D,n,r,y]),z.useEffect(()=>{const v=a.current;if(!v||t.length===0)return;const l=v.getContext("2d");l&&(l.clearRect(0,0,n,r),t.forEach(M=>{const E=j(M.z),R=p(M.x);l.beginPath(),l.arc(E,R,2,0,2*Math.PI),l.fillStyle="rgba(0, 0, 0, 0.3)",l.fill(),l.strokeStyle="rgba(255, 255, 255, 0.5)",l.lineWidth=.5,l.stroke()}))},[t,p,j,n,r]);const m=v=>{if(!h||!u.current)return;const l=u.current.getBoundingClientRect(),M=v.clientX-l.left,E=v.clientY-l.top,R=30,C=t.filter(A=>{const S=j(A.z),N=p(A.x);return Math.sqrt(Math.pow(S-M,2)+Math.pow(N-E,2))<=R});C.length>0&&h(C)},s=v=>{if(!u.current)return;const l=u.current.getBoundingClientRect(),M=v.clientX-l.left,E=v.clientY-l.top,R=20,C=t.filter(A=>{const S=j(A.z),N=p(A.x);return Math.sqrt(Math.pow(S-M,2)+Math.pow(N-E,2))<=R});u.current&&(u.current.style.cursor=C.length>0?"pointer":"default")};return e.jsxs("div",{ref:u,style:{position:"relative",width:`${n}px`,height:`${r}px`,margin:"0 auto"},onClick:m,onMouseMove:s,children:[e.jsx("canvas",{ref:f,width:n,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),e.jsx("canvas",{ref:b,width:n,height:r,style:{position:"absolute",top:0,left:0,borderRadius:"4px",pointerEvents:"none"}}),e.jsx("canvas",{ref:a,width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}})]})}function at({selectedCamp:t,availableDeathTypes:o,deathTypeColors:c}){const{navigateToGameDetails:n,navigationState:r,updateNavigationState:i}=le(),{settings:h}=pe(),{data:g,isLoading:b,error:a}=ce(),[f,u]=z.useState(""),[d,j]=z.useState(r.deathLocationState?.selectedDeathTypes||[]),[p,D]=z.useState(null),[y,m]=z.useState("heatmap"),[s,v]=z.useState(ye.CLUSTER_RADIUS),[l,M]=z.useState(!1);z.useEffect(()=>{if(d.length===0&&o.length>0){const x=o.filter(w=>w!=="VOTED");j(x),i({deathLocationState:{...r.deathLocationState,selectedCamp:t,selectedDeathTypes:x}})}},[o.length]);const E=z.useMemo(()=>{if(!g)return[];const x=ze(g),w=oe(g,t),k=new Map;return w.forEach(L=>{k.set(L.mapName,(k.get(L.mapName)||0)+1)}),x.sort((L,T)=>{const I=k.get(L)||0;return(k.get(T)||0)-I})},[g,t]),R=E.length>0?E[0]:"";f===""&&R!==""&&u(R);const C=z.useMemo(()=>{if(!g)return[];let x=oe(g,t);return f&&(x=x.filter(w=>w.mapName===f)),d.length>0&&(x=x.filter(w=>d.includes(w.deathType))),x},[g,t,f,d]),A=z.useMemo(()=>Ee(C,s),[C,s]),S=z.useMemo(()=>A.map((x,w)=>{const k=x.items[0],L=Ce(x.items);return{x:x.centroidX,z:x.centroidZ,deathCount:x.items.length,allDeaths:x.items,dominantDeathType:L,playerName:x.items.length===1?k.playerName:null,gameId:x.items.length===1?k.gameId:null,camp:k.camp,mapName:k.mapName,deathType:L,killerName:x.items.length===1?k.killerName:null,clusterIndex:w}}),[A]),N=({active:x,payload:w})=>{if(!x||!w||w.length===0)return null;const k=w[0].payload,L=k.allDeaths||[k];if(L.length>1){const W=new Map,X=new Set,F=new Map;L.forEach(B=>{const V=B.deathType?ee(B.deathType):"Inconnu";W.set(V,(W.get(V)||0)+1),X.add(B.gameId),F.set(B.playerName,(F.get(B.playerName)||0)+1)});const J=Array.from(F.entries()).sort((B,V)=>V[1]-B[1]).slice(0,3),Q=F.size>3,_=Array.from(W.entries()).sort((B,V)=>V[1]-B[1]).slice(0,3),he=W.size>3;return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"350px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:[L.length," morts dans cette zone"]}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Centre:"})," (",Math.round(k.x),", ",Math.round(k.z),")"]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Joueurs:"}),e.jsxs("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:[J.map(([B,V])=>e.jsxs("li",{children:[B," ",V>1?`(${V} morts)`:""]},B)),Q&&e.jsxs("li",{style:{color:"var(--text-secondary)"},children:["...et ",F.size-3," autres"]})]})]}),e.jsxs("div",{style:{marginBottom:"8px"},children:[e.jsx("strong",{children:"Types de mort:"}),e.jsxs("ul",{style:{margin:"4px 0 0 0",paddingLeft:"20px"},children:[_.map(([B,V])=>e.jsxs("li",{children:[B," (",V,")"]},B)),he&&e.jsxs("li",{style:{color:"var(--text-secondary)"},children:["...et ",W.size-3," autres"]})]})]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Parties:"})," ",X.size," parties",X.size<=5&&e.jsxs("span",{children:[" (",Array.from(X).filter(B=>B).map(B=>`#${B}`).join(", "),")"]})]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les parties concernÃ©es"})]})}const I=L[0];return e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary)",border:"1px solid var(--border-color)",borderRadius:"6px",padding:"12px",boxShadow:"0 2px 8px rgba(0,0,0,0.2)",maxWidth:"300px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"1rem",color:"var(--accent-primary-text)"},children:I.playerName}),e.jsxs("div",{style:{fontSize:"0.9rem",lineHeight:"1.6"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Camp:"})," ",I.camp]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Type de mort:"})," ",I.deathType?ee(I.deathType):"Inconnu"]}),I.killerName&&e.jsxs("div",{children:[e.jsx("strong",{children:"TuÃ© par:"})," ",I.killerName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Carte:"})," ",I.mapName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Partie:"})," #",I.gameId]}),e.jsxs("div",{style:{marginTop:"4px",fontSize:"0.85rem",color:"var(--text-secondary)"},children:["Position: (",Math.round(I.x),", ",Math.round(I.z),")"]})]}),e.jsx("div",{style:{marginTop:"8px",paddingTop:"8px",borderTop:"1px solid var(--border-color)",fontSize:"0.8rem",color:"var(--text-secondary)"},children:"Cliquez pour voir les dÃ©tails de la partie"})]})},$=x=>{if(!x)return;const w=x.allDeaths||[x];if(w.length===1)n({selectedGame:w[0].gameId,fromComponent:"Death Location View"});else{const k=w.map(L=>L.gameId).filter(L=>L);n({selectedGameIds:k,fromComponent:"Death Location View"})}},Z=x=>x&&c[x]||"var(--text-secondary)",P=z.useMemo(()=>De(f),[f]),{xDomain:re,zDomain:ne}=z.useMemo(()=>{if(P)return{xDomain:[P.xMin,P.xMax],zDomain:[P.zMin,P.zMax]};if(S.length===0)return{xDomain:[0,100],zDomain:[0,100]};const x=S.map(F=>F.x),w=S.map(F=>F.z),k=Math.min(...x),L=Math.max(...x),T=Math.min(...w),I=Math.max(...w),W=(L-k)*.1||10,X=(I-T)*.1||10;return{xDomain:[k-W,L+W],zDomain:[T-X,I+X]}},[S,P]);return b?e.jsx("div",{className:"donnees-attente",children:"Chargement des localisations de mort..."}):a?e.jsxs("div",{className:"donnees-probleme",children:["Erreur: ",a]}):g?e.jsxs("div",{children:[e.jsxs("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Mode :"}),e.jsxs("div",{style:{display:"flex",backgroundColor:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",overflow:"hidden"},children:[e.jsx("button",{type:"button",onClick:()=>m("heatmap"),style:{background:y==="heatmap"?"var(--accent-primary)":"transparent",color:y==="heatmap"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:y==="heatmap"?"bold":"normal",transition:"all 0.2s"},children:"Carte de chaleur"}),e.jsx("button",{type:"button",onClick:()=>m("scatter"),style:{background:y==="scatter"?"var(--accent-primary)":"transparent",color:y==="scatter"?"white":"var(--text-primary)",border:"none",padding:"0.5rem 1rem",fontSize:"0.9rem",cursor:"pointer",fontWeight:y==="scatter"?"bold":"normal",transition:"all 0.2s"},children:"Points"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"map-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Carte :"}),e.jsx("select",{id:"map-select",value:f,onChange:x=>u(x.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:E.filter(x=>x==="Village"||x==="ChÃ¢teau").map(x=>e.jsx("option",{value:x,children:x},x))})]}),e.jsxs("div",{style:{width:"100%",marginTop:"1rem"},children:[e.jsxs("div",{onClick:()=>M(!l),style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:l?"0.5rem":"0",cursor:"pointer",padding:"0.5rem",background:"var(--bg-tertiary)",borderRadius:"4px",border:"1px solid var(--border-color)",transition:"all 0.2s"},children:[e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"1rem",transition:"transform 0.2s",transform:l?"rotate(90deg)":"rotate(0deg)"},children:"â–¶"}),e.jsx("label",{style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold",cursor:"pointer",flexGrow:1},children:"Types de mort"}),e.jsxs("span",{style:{color:"var(--text-secondary)",fontSize:"0.85rem"},children:[d.length," / ",o.length," sÃ©lectionnÃ©",d.length>1?"s":""]})]}),l&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginTop:"0.5rem",marginBottom:"0.5rem"},children:[e.jsx("button",{type:"button",onClick:x=>{x.stopPropagation(),j(o),i({deathLocationState:{...r.deathLocationState,selectedCamp:t,selectedDeathTypes:o}})},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Tous"}),e.jsx("button",{type:"button",onClick:x=>{x.stopPropagation(),j([]),i({deathLocationState:{...r.deathLocationState,selectedCamp:t,selectedDeathTypes:[]}})},style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.3rem 0.8rem",fontSize:"0.85rem",cursor:"pointer",transition:"all 0.2s"},children:"Aucun"})]}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"0.5rem",maxHeight:"300px",overflowY:"auto",padding:"0.5rem",background:"var(--bg-secondary)",borderRadius:"4px",border:"1px solid var(--border-color)"},children:o.map(x=>{const w=d.includes(x),k=c[x]||"var(--chart-primary)";return e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"0.5rem",padding:"0.5rem",background:w?"var(--bg-tertiary)":"transparent",borderRadius:"4px",border:`1px solid ${w?k:"var(--border-color)"}`,cursor:"pointer",transition:"all 0.2s",fontSize:"0.9rem"},onClick:L=>{L.stopPropagation();const T=w?d.filter(I=>I!==x):[...d,x];j(T),i({deathLocationState:{...r.deathLocationState,selectedCamp:t,selectedDeathTypes:T}})},children:[e.jsx("input",{type:"checkbox",checked:w,onChange:()=>{},style:{cursor:"pointer"}}),e.jsx("div",{style:{width:"12px",height:"12px",borderRadius:"2px",backgroundColor:k,flexShrink:0}}),e.jsx("span",{children:ee(x)})]},x)})})]})]}),y==="scatter"&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"cluster-radius",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Regroupement :"}),e.jsx("input",{id:"cluster-radius",type:"range",min:"0",max:"60",step:"5",value:s,onChange:x=>v(Number(x.target.value)),style:{width:"100px",cursor:"pointer"}}),e.jsx("span",{style:{color:"var(--text-primary)",fontSize:"0.85rem",minWidth:"70px"},children:s===0?"Aucun":`${s} unitÃ©s`})]})]}),C.length>0?e.jsx(be,{title:y==="scatter"?"Carte des Morts":"Carte de Chaleur des Morts",children:y==="scatter"?e.jsx("div",{style:{height:700,width:"100%",maxWidth:1e3,margin:"0 auto"},children:e.jsx(Ne,{width:"100%",height:"100%",children:e.jsxs(Re,{margin:{top:20,right:30,left:60,bottom:60},children:[P&&e.jsx(we,{x1:P.zMin,x2:P.zMax,y1:P.xMin,y2:P.xMax,fill:"transparent",stroke:"none",shape:x=>{const{x:w,y:k,width:L,height:T}=x;return e.jsx("image",{x:w,y:k,width:L,height:T,href:P.src,preserveAspectRatio:"none",style:{opacity:.85}})}}),e.jsx(je,{strokeDasharray:"3 3",stroke:P?"rgba(255,255,255,0.3)":"var(--border-color)"}),e.jsx(Me,{dataKey:"z",type:"number",name:"Position Z",domain:ne,hide:!0}),e.jsx(Se,{dataKey:"x",type:"number",name:"Position X",domain:re,hide:!0}),e.jsx(Ie,{content:e.jsx(N,{}),cursor:{strokeDasharray:"3 3"}}),e.jsx(ke,{data:S,style:{cursor:"pointer"},isAnimationActive:!1,shape:x=>{const{cx:w,cy:k,payload:L}=x,T=L,I=T.allDeaths.some(_=>h.highlightedPlayer===_.playerName),W=p&&T.clusterIndex===p.clusterIndex,X=Math.min(Math.log2(T.deathCount+1)*3+4,18),F=Math.round(X),J=F+2,Q=I?J:W?F+1:F;return e.jsx("circle",{cx:w,cy:k,r:Q,fill:I?"var(--accent-primary-text)":Z(T.deathType),stroke:I||W?"white":T.deathCount>1?"rgba(255,255,255,0.6)":"none",strokeWidth:I?3:W?2:T.deathCount>1?1.5:0,opacity:I?1:.8,onClick:()=>$(T),onMouseEnter:()=>D(T),onMouseLeave:()=>D(null)})}})]})})}):e.jsx("div",{style:{padding:"2rem 0",display:"flex",justifyContent:"center"},children:e.jsx(st,{deathLocations:C,xDomain:re,zDomain:ne,width:1e3,height:700,bandwidth:25,mapConfig:P,onRegionClick:x=>{if(x.length===1)n({selectedGame:x[0].gameId,fromComponent:"Death Location View (Heatmap)"});else{const w=x.map(k=>k.gameId).filter(k=>k);n({selectedGameIds:w,fromComponent:"Death Location View (Heatmap)"})}}})})}):e.jsxs("div",{className:"donnees-manquantes",style:{padding:"2rem",textAlign:"center",backgroundColor:"var(--bg-secondary)",borderRadius:"8px"},children:[e.jsx("p",{style:{fontSize:"1.1rem",marginBottom:"1rem"},children:"Aucune localisation de mort disponible pour les filtres sÃ©lectionnÃ©s"}),e.jsx("p",{style:{fontSize:"0.9rem",color:"var(--text-secondary)"},children:"Les donnÃ©es de position ne sont disponibles que pour les parties rÃ©centes (non-legacy)."})]}),e.jsxs("div",{className:"lycans-resume-conteneur",style:{marginTop:"2rem",marginBottom:"2rem"},children:[e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Morts localisÃ©es"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-primary-text)"},children:C.length}),y==="scatter"&&s>0&&S.length<C.length&&e.jsxs("div",{style:{fontSize:"0.85rem",color:"var(--text-secondary)",marginTop:"4px"},children:["â†’ ",S.length," points groupÃ©s"]})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Camp filtrÃ©"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--accent-secondary)",fontSize:"1.2rem"},children:t})]}),e.jsxs("div",{className:"lycans-stat-carte",children:[e.jsx("h3",{children:"Types de mort"}),e.jsx("div",{className:"lycans-valeur-principale",style:{color:"var(--chart-color-2)",fontSize:"1.2rem"},children:d.length===0||d.length===o.length?"Tous":`${d.length} type${d.length>1?"s":""}`})]})]}),e.jsxs("div",{className:"lycans-section-description",style:{marginTop:"1.5rem"},children:[e.jsx("p",{children:e.jsx("strong",{children:"Ã€ propos de cette visualisation :"})}),e.jsxs("ul",{style:{marginTop:"0.5rem",paddingLeft:"1.5rem"},children:[e.jsx("li",{children:"Les positions sont basÃ©es sur les coordonnÃ©es Z (horizontal) et X (vertical) - vue 2D de la carte"}),y==="scatter"?e.jsxs(e.Fragment,{children:[e.jsx("li",{children:'Les morts proches sont regroupÃ©es en un seul point - ajustez le curseur "Regroupement" pour contrÃ´ler la distance'}),e.jsx("li",{children:"Les points regroupÃ©s ont une petite bordure blanche"}),e.jsx("li",{children:"La couleur indique le type de mort dominant dans ce regroupement"}),e.jsx("li",{children:"Survolez un point pour voir tous les joueurs, types de mort et parties concernÃ©s"}),e.jsxs("li",{children:["Le joueur sÃ©lectionnÃ© est affichÃ© en "," ",e.jsx("span",{style:{color:"var(--accent-primary)",fontWeight:"bold"},children:"couleur primaire"})]}),e.jsx("li",{children:"Cliquez sur un point pour voir les dÃ©tails de la ou des parties"})]}):e.jsxs(e.Fragment,{children:[e.jsx("li",{children:"La carte de chaleur montre les zones de forte densitÃ© de morts (du jaune au rouge)"}),e.jsx("li",{children:"Les points noirs indiquent l'emplacement exact de chaque mort"}),e.jsx("li",{children:"Les zones rouges indiquent une concentration Ã©levÃ©e de morts"}),e.jsx("li",{children:"Cliquez sur une zone pour voir les dÃ©tails des parties associÃ©es"}),e.jsx("li",{children:'Utilisez le mode "Points" pour voir les dÃ©tails individuels par type de mort'})]})]}),e.jsx("p",{style:{marginTop:"0.5rem",fontStyle:"italic",color:"var(--text-secondary)"},children:"Note : Seules les parties rÃ©centes contiennent des donnÃ©es de position."})]})]}):e.jsx("div",{className:"donnees-manquantes",children:"Aucune donnÃ©e disponible"})}function gt({deathLocations:t,xDomain:o,zDomain:c,width:n=800,height:r=600,bandwidth:i=25,onRegionClick:h}){const g=z.useRef(null),b=z.useRef(null),a=z.useRef(null),f=z.useMemo(()=>K().domain(o).range([0,n]),[o,n]),u=z.useMemo(()=>K().domain(c).range([r,0]),[c,r]),d=z.useMemo(()=>t.length===0?[]:fe().x(m=>f(m.x)).y(m=>u(m.z)).size([n,r]).bandwidth(i).thresholds(15)(t),[t,f,u,n,r,i]),j=z.useMemo(()=>{const y=d.length>0?Math.max(...d.map(m=>m.value)):1;return m=>{const s=m/y;return me(s)}},[d]);z.useEffect(()=>{const y=g.current;if(!y||d.length===0)return;const m=y.getContext("2d");m&&(m.clearRect(0,0,n,r),d.forEach(s=>{m.fillStyle=j(s.value),m.globalAlpha=.6,s.coordinates.forEach(v=>{v.forEach(l=>{m.beginPath(),l.forEach((M,E)=>{E===0?m.moveTo(M[0],M[1]):m.lineTo(M[0],M[1])}),m.closePath(),m.fill()})})}),m.globalAlpha=1)},[d,n,r,j]),z.useEffect(()=>{const y=b.current;if(!y||t.length===0)return;const m=y.getContext("2d");m&&(m.clearRect(0,0,n,r),t.forEach(s=>{const v=f(s.x),l=u(s.z);m.beginPath(),m.arc(v,l,2,0,2*Math.PI),m.fillStyle="rgba(0, 0, 0, 0.3)",m.fill(),m.strokeStyle="rgba(255, 255, 255, 0.5)",m.lineWidth=.5,m.stroke()}))},[t,f,u,n,r]);const p=y=>{if(!h||!a.current)return;const m=a.current.getBoundingClientRect(),s=y.clientX-m.left,v=y.clientY-m.top,l=30,M=t.filter(E=>{const R=f(E.x),C=u(E.z);return Math.sqrt(Math.pow(R-s,2)+Math.pow(C-v,2))<=l});M.length>0&&h(M)},D=y=>{if(!a.current)return;const m=a.current.getBoundingClientRect(),s=y.clientX-m.left,v=y.clientY-m.top,l=20,M=t.filter(E=>{const R=f(E.x),C=u(E.z);return Math.sqrt(Math.pow(R-s,2)+Math.pow(C-v,2))<=l});a.current&&(a.current.style.cursor=M.length>0?"pointer":"default")};return e.jsxs("div",{ref:a,style:{position:"relative",width:`${n}px`,height:`${r}px`,margin:"0 auto"},onClick:p,onMouseMove:D,children:[e.jsx("canvas",{ref:g,width:n,height:r,style:{position:"absolute",top:0,left:0,border:"1px solid var(--border-color)",borderRadius:"4px",backgroundColor:"var(--bg-tertiary)"}}),e.jsx("canvas",{ref:b,width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"}}),e.jsx("div",{style:{position:"absolute",bottom:"-30px",left:"50%",transform:"translateX(-50%)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position X"}),e.jsx("div",{style:{position:"absolute",left:"-50px",top:"50%",transform:"translateY(-50%) rotate(-90deg)",color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Position Z"}),e.jsxs("svg",{width:n,height:r,style:{position:"absolute",top:0,left:0,pointerEvents:"none"},children:[[0,.25,.5,.75,1].map(y=>{const m=n*y,s=o[0]+(o[1]-o[0])*y;return e.jsxs("g",{children:[e.jsx("line",{x1:m,y1:r,x2:m,y2:r-5,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:m,y:r-10,textAnchor:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(s)})]},`x-${y}`)}),[0,.25,.5,.75,1].map(y=>{const m=r*(1-y),s=c[0]+(c[1]-c[0])*y;return e.jsxs("g",{children:[e.jsx("line",{x1:0,y1:m,x2:5,y2:m,stroke:"var(--text-secondary)",strokeWidth:1}),e.jsx("text",{x:10,y:m,dominantBaseline:"middle",fill:"var(--text-secondary)",fontSize:"0.75rem",children:Math.round(s)})]},`z-${y}`)})]})]})}function yt(){const{navigationState:t,updateNavigationState:o}=le(),[c,n]=z.useState(t.deathLocationState?.selectedCamp||"Tous les camps"),{data:r}=xe(),{data:i}=ce(),h=ve(),g=z.useMemo(()=>i?ge(i):[],[i]),b=z.useMemo(()=>g.filter(u=>u!=="VOTED"),[g]);z.useEffect(()=>{!t.deathLocationState?.selectedDeathTypes&&g.length>0&&o({deathLocationState:{selectedCamp:c,selectedDeathTypes:b}})},[g,b,t.deathLocationState,c,o]);const a=z.useMemo(()=>{const u={};g.forEach(p=>{p===H.BY_WOLF?u[p]=h.Loup:p===H.VOTED?u[p]="var(--chart-color-1)":p===H.BULLET||p===H.BULLET_HUMAN||p===H.BULLET_WOLF?u[p]=h.Chasseur:p===H.BY_ZOMBIE?u[p]=h.Vaudou:p===H.ASSASSIN?u[p]=h.Alchimiste:p===H.AVENGER?u[p]="var(--chart-color-2)":p===H.LOVER_DEATH?u[p]=h.Amoureux:p===H.BY_BEAST?u[p]="var(--chart-color-3)":p===H.SHERIF_SUCCESS?u[p]="var(--chart-color-4)":p===H.SMUGGLER_HUNT_KILL&&(u[p]=h.Contrebandier)});const d=["var(--accent-primary)","var(--accent-secondary)","var(--accent-tertiary)","#8884d8","#82ca9d","#ffc658","#ff7300","#00c49f","#ffbb28"];let j=0;return g.forEach(p=>{u[p]||(u[p]=d[j%d.length],j++)}),u},[g,h]),f=u=>{n(u),o({deathLocationState:{selectedCamp:u}})};return e.jsxs("div",{className:"lycans-general-stats",children:[e.jsx("h2",{children:"ðŸ—ºï¸ Carte de Chaleur des Morts"}),e.jsx("div",{style:{marginBottom:"1.5rem",display:"flex",alignItems:"center",gap:"1rem",flexWrap:"wrap"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[e.jsx("label",{htmlFor:"camp-select",style:{color:"var(--text-secondary)",fontSize:"0.9rem",fontWeight:"bold"},children:"Camp :"}),e.jsxs("select",{id:"camp-select",value:c,onChange:u=>f(u.target.value),style:{background:"var(--bg-tertiary)",color:"var(--text-primary)",border:"1px solid var(--border-color)",borderRadius:"4px",padding:"0.5rem",fontSize:"0.9rem",minWidth:"150px"},children:[e.jsx("option",{value:"Tous les camps",children:"Tous les camps"},"tous"),r?.filter(u=>u!=="Tous les camps").map(u=>e.jsx("option",{value:u,children:u},u))]})]})}),e.jsx(at,{selectedCamp:c,availableDeathTypes:g,deathTypeColors:a})]})}export{yt as DeathLocationHeatmap,gt as DeathLocationHeatmapCanvas};
